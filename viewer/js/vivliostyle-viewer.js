/**
 * @vivliostyle/viewer v2.32.0
 * Vivliostyle Viewer - HTML+CSS typesetting and rich paged viewing with EPUB/Web publications support
 *
 * @author Vivliostyle Foundation
 * @license AGPL-3.0
 * @preserve
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i,n={exports:{}};
/*!
	 * Knockout JavaScript library v3.5.1
	 * (c) The Knockout.js team - http://knockoutjs.com/
	 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
	 */var r,o,s=(i||(i=1,r=n,o=n.exports,function(e){var t=this||(0,eval)("this"),i=t.document,n=t.navigator,s=t.jQuery,a=t.JSON;s||"undefined"==typeof jQuery||(s=jQuery),function(e){e(r.exports||o)}((function(r,o){function l(e,t){return(null===e||typeof e in x)&&e===t}function h(t,i){var n;return function(){n||(n=y.a.setTimeout((function(){n=e,t()}),i))}}function u(e,t){var i;return function(){clearTimeout(i),i=y.a.setTimeout(e,t)}}function c(e,t){t&&"change"!==t?"beforeChange"===t?this.pc(e):this.gb(e,t):this.qc(e)}function d(e,t){null!==t&&t.s&&t.s()}function p(e,t){var i=this.qd,n=i[P];n.ra||(this.Qb&&this.mb[t]?(i.uc(t,e,this.mb[t]),this.mb[t]=null,--this.Qb):n.I[t]||i.uc(t,e,n.J?{da:e}:i.$c(e)),e.Ja&&e.gd())}var f,g,m,b,v,w,y=void 0!==r?r:{};y.b=function(e,t){for(var i=e.split("."),n=y,r=0;r<i.length-1;r++)n=n[i[r]];n[i[i.length-1]]=t},y.L=function(e,t,i){e[t]=i},y.version="3.5.1",y.b("version",y.version),y.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1},y.a=function(){function r(e,t){for(var i in e)u.call(e,i)&&t(i,e[i])}function o(e,t){if(t)for(var i in t)u.call(t,i)&&(e[i]=t[i]);return e}function l(e,t){return e.__proto__=t,e}function h(e,t,i,n){var r=e[t].match(v)||[];y.a.D(i.match(v),(function(e){y.a.Na(r,e,n)})),e[t]=r.join(" ")}var u=Object.prototype.hasOwnProperty,c={__proto__:[]}instanceof Array,d="function"==typeof Symbol,p={},f={};p[n&&/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],p.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),r(p,(function(e,t){if(t.length)for(var i=0,n=t.length;i<n;i++)f[t[i]]=e}));var g,m={propertychange:!0},b=i&&function(){for(var t=3,n=i.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",r[0];);return 4<t?t:e}(),v=/\S+/g;return{Jc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],D:function(e,t,i){for(var n=0,r=e.length;n<r;n++)t.call(i,e[n],n,e)},A:"function"==typeof Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t)}:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},Lb:function(t,i,n){for(var r=0,o=t.length;r<o;r++)if(i.call(n,t[r],r,t))return t[r];return e},Pa:function(e,t){var i=y.a.A(e,t);0<i?e.splice(i,1):0===i&&e.shift()},wc:function(e){var t=[];return e&&y.a.D(e,(function(e){0>y.a.A(t,e)&&t.push(e)})),t},Mb:function(e,t,i){var n=[];if(e)for(var r=0,o=e.length;r<o;r++)n.push(t.call(i,e[r],r));return n},jb:function(e,t,i){var n=[];if(e)for(var r=0,o=e.length;r<o;r++)t.call(i,e[r],r)&&n.push(e[r]);return n},Nb:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var i=0,n=t.length;i<n;i++)e.push(t[i]);return e},Na:function(e,t,i){var n=y.a.A(y.a.bc(e),t);0>n?i&&e.push(t):i||e.splice(n,1)},Ba:c,extend:o,setPrototypeOf:l,Ab:c?l:o,P:r,Ga:function(e,t,i){if(!e)return e;var n,r={};for(n in e)u.call(e,n)&&(r[n]=t.call(i,e[n],n,e));return r},Tb:function(e){for(;e.firstChild;)y.removeNode(e.firstChild)},Yb:function(e){for(var t=((e=y.a.la(e))[0]&&e[0].ownerDocument||i).createElement("div"),n=0,r=e.length;n<r;n++)t.appendChild(y.oa(e[n]));return t},Ca:function(e,t){for(var i=0,n=e.length,r=[];i<n;i++){var o=e[i].cloneNode(!0);r.push(t?y.oa(o):o)}return r},va:function(e,t){if(y.a.Tb(e),t)for(var i=0,n=t.length;i<n;i++)e.appendChild(t[i])},Xc:function(e,t){var i=e.nodeType?[e]:e;if(0<i.length){for(var n=i[0],r=n.parentNode,o=0,s=t.length;o<s;o++)r.insertBefore(t[o],n);for(o=0,s=i.length;o<s;o++)y.removeNode(i[o])}},Ua:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var i=e[0],n=e[e.length-1];for(e.length=0;i!==n;)e.push(i),i=i.nextSibling;e.push(n)}}return e},Zc:function(e,t){7>b?e.setAttribute("selected",t):e.selected=t},Db:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Ud:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},vd:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(1!==e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return!(16&~t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},Sb:function(e){return y.a.vd(e,e.ownerDocument.documentElement)},kd:function(e){return!!y.a.Lb(e,y.a.Sb)},R:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Ac:function(e){return y.onError?function(){try{return e.apply(this,arguments)}catch(e){throw y.onError&&y.onError(e),e}}:e},setTimeout:function(e,t){return setTimeout(y.a.Ac(e),t)},Gc:function(e){setTimeout((function(){throw y.onError&&y.onError(e),e}),0)},B:function(e,t,i){var n=y.a.Ac(i);if(i=m[t],y.options.useOnlyNativeEvents||i||!s)if(i||"function"!=typeof e.addEventListener){if(void 0===e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var r=function(t){n.call(e,t)},o="on"+t;e.attachEvent(o,r),y.a.K.za(e,(function(){e.detachEvent(o,r)}))}else e.addEventListener(t,n,!1);else g||(g="function"==typeof s(e).on?"on":"bind"),s(e)[g](t,n)},Fb:function(e,n){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var r;if(r=!("input"!==y.a.R(e)||!e.type||"click"!=n.toLowerCase()||"checkbox"!=(r=e.type)&&"radio"!=r),y.options.useOnlyNativeEvents||!s||r)if("function"==typeof i.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");(r=i.createEvent(f[n]||"HTMLEvents")).initEvent(n,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(r)}else if(r&&e.click)e.click();else{if(void 0===e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+n)}else s(e).trigger(n)},f:function(e){return y.O(e)?e():e},bc:function(e){return y.O(e)?e.v():e},Eb:function(e,t,i){var n;t&&("object"==typeof e.classList?(n=e.classList[i?"add":"remove"],y.a.D(t.match(v),(function(t){n.call(e.classList,t)}))):"string"==typeof e.className.baseVal?h(e.className,"baseVal",t,i):h(e,"className",t,i))},Bb:function(t,i){var n=y.a.f(i);null!==n&&n!==e||(n="");var r=y.h.firstChild(t);!r||3!=r.nodeType||y.h.nextSibling(r)?y.h.va(t,[t.ownerDocument.createTextNode(n)]):r.data=n,y.a.Ad(t)},Yc:function(e,t){if(e.name=t,7>=b)try{var n=e.name.replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}));e.mergeAttributes(i.createElement("<input name='"+n+"'/>"),!1)}catch(e){}},Ad:function(e){9<=b&&(e=1==e.nodeType?e:e.parentNode).style&&(e.style.zoom=e.style.zoom)},wd:function(e){if(b){var t=e.style.width;e.style.width=0,e.style.width=t}},Pd:function(e,t){e=y.a.f(e),t=y.a.f(t);for(var i=[],n=e;n<=t;n++)i.push(n);return i},la:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(e[i]);return t},Da:function(e){return d?Symbol(e):e},Zd:6===b,$d:7===b,W:b,Lc:function(e,t){for(var i=y.a.la(e.getElementsByTagName("input")).concat(y.a.la(e.getElementsByTagName("textarea"))),n="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},r=[],o=i.length-1;0<=o;o--)n(i[o])&&r.push(i[o]);return r},Nd:function(e){return"string"==typeof e&&(e=y.a.Db(e))?a&&a.parse?a.parse(e):new Function("return "+e)():null},hc:function(e,t,i){if(!a||!a.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return a.stringify(y.a.f(e),t,i)},Od:function(e,t,n){var o=(n=n||{}).params||{},s=n.includeFields||this.Jc,a=e;if("object"==typeof e&&"form"===y.a.R(e)){a=e.action;for(var l=s.length-1;0<=l;l--)for(var h=y.a.Lc(e,s[l]),u=h.length-1;0<=u;u--)o[h[u].name]=h[u].value}t=y.a.f(t);var c=i.createElement("form");for(var d in c.style.display="none",c.action=a,c.method="post",t)(e=i.createElement("input")).type="hidden",e.name=d,e.value=y.a.hc(y.a.f(t[d])),c.appendChild(e);r(o,(function(e,t){var n=i.createElement("input");n.type="hidden",n.name=e,n.value=t,c.appendChild(n)})),i.body.appendChild(c),n.submitter?n.submitter(c):c.submit(),setTimeout((function(){c.parentNode.removeChild(c)}),0)}}}(),y.b("utils",y.a),y.b("utils.arrayForEach",y.a.D),y.b("utils.arrayFirst",y.a.Lb),y.b("utils.arrayFilter",y.a.jb),y.b("utils.arrayGetDistinctValues",y.a.wc),y.b("utils.arrayIndexOf",y.a.A),y.b("utils.arrayMap",y.a.Mb),y.b("utils.arrayPushAll",y.a.Nb),y.b("utils.arrayRemoveItem",y.a.Pa),y.b("utils.cloneNodes",y.a.Ca),y.b("utils.createSymbolOrString",y.a.Da),y.b("utils.extend",y.a.extend),y.b("utils.fieldsIncludedWithJsonPost",y.a.Jc),y.b("utils.getFormFields",y.a.Lc),y.b("utils.objectMap",y.a.Ga),y.b("utils.peekObservable",y.a.bc),y.b("utils.postJson",y.a.Od),y.b("utils.parseJson",y.a.Nd),y.b("utils.registerEventHandler",y.a.B),y.b("utils.stringifyJson",y.a.hc),y.b("utils.range",y.a.Pd),y.b("utils.toggleDomNodeCssClass",y.a.Eb),y.b("utils.triggerEvent",y.a.Fb),y.b("utils.unwrapObservable",y.a.f),y.b("utils.objectForEach",y.a.P),y.b("utils.addOrRemoveItem",y.a.Na),y.b("utils.setTextContent",y.a.Bb),y.b("unwrap",y.a.f),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var i=Array.prototype.slice.call(arguments,1);return function(){var n=i.slice(0);return n.push.apply(n,arguments),t.apply(e,n)}}),y.a.g=new function(){var t,i,n=0,r="__ko__"+(new Date).getTime(),o={};return y.a.W?(t=function(t,i){var s=t[r];if(!s||"null"===s||!o[s]){if(!i)return e;s=t[r]="ko"+n++,o[s]={}}return o[s]},i=function(e){var t=e[r];return!!t&&(delete o[t],e[r]=null,!0)}):(t=function(e,t){var i=e[r];return!i&&t&&(i=e[r]={}),i},i=function(e){return!!e[r]&&(delete e[r],!0)}),{get:function(e,i){var n=t(e,!1);return n&&n[i]},set:function(i,n,r){(i=t(i,r!==e))&&(i[n]=r)},Ub:function(e,i,n){return(e=t(e,!0))[i]||(e[i]=n)},clear:i,Z:function(){return n+++r}}},y.b("utils.domData",y.a.g),y.b("utils.domData.clear",y.a.g.clear),y.a.K=new function(){function t(t,i){var n=y.a.g.get(t,r);return n===e&&i&&(n=[],y.a.g.set(t,r,n)),n}function i(e){if(i=t(e,!1))for(var i=i.slice(0),r=0;r<i.length;r++)i[r](e);y.a.g.clear(e),y.a.K.cleanExternalData(e),a[e.nodeType]&&n(e.childNodes,!0)}function n(e,t){for(var n,r=[],o=0;o<e.length;o++)if((!t||8===e[o].nodeType)&&(i(r[r.length]=n=e[o]),e[o]!==n))for(;o--&&-1==y.a.A(r,e[o]););}var r=y.a.g.Z(),o={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{za:function(e,i){if("function"!=typeof i)throw Error("Callback must be a function");t(e,!0).push(i)},yb:function(i,n){var o=t(i,!1);o&&(y.a.Pa(o,n),0==o.length&&y.a.g.set(i,r,e))},oa:function(e){return y.u.G((function(){o[e.nodeType]&&(i(e),a[e.nodeType]&&n(e.getElementsByTagName("*")))})),e},removeNode:function(e){y.oa(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){s&&"function"==typeof s.cleanData&&s.cleanData([e])}}},y.oa=y.a.K.oa,y.removeNode=y.a.K.removeNode,y.b("cleanNode",y.oa),y.b("removeNode",y.removeNode),y.b("utils.domNodeDisposal",y.a.K),y.b("utils.domNodeDisposal.addDisposeCallback",y.a.K.za),y.b("utils.domNodeDisposal.removeDisposeCallback",y.a.K.yb),f=[0,"",""],v={thead:g=[1,"<table>","</table>"],tbody:g,tfoot:g,tr:[2,"<table><tbody>","</tbody></table>"],td:m=[3,"<table><tbody><tr>","</tr></tbody></table>"],th:m,option:b=[1,"<select multiple='multiple'>","</select>"],optgroup:b},w=8>=y.a.W,y.a.ua=function(e,n){var r;if(s){if(s.parseHTML)r=s.parseHTML(e,n)||[];else if((r=s.clean([e],n))&&r[0]){for(var o=r[0];o.parentNode&&11!==o.parentNode.nodeType;)o=o.parentNode;o.parentNode&&o.parentNode.removeChild(o)}}else{(r=n)||(r=i),o=r.parentWindow||r.defaultView||t;var a,l=y.a.Db(e).toLowerCase(),h=r.createElement("div");for(a=(l=l.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&v[l[1]]||f,l=a[0],a="ignored<div>"+a[1]+e+a[2]+"</div>","function"==typeof o.innerShiv?h.appendChild(o.innerShiv(a)):(w&&r.body.appendChild(h),h.innerHTML=a,w&&h.parentNode.removeChild(h));l--;)h=h.lastChild;r=y.a.la(h.lastChild.childNodes)}return r},y.a.Md=function(e,t){var i=y.a.ua(e,t);return i.length&&i[0].parentElement||y.a.Yb(i)},y.a.fc=function(t,i){if(y.a.Tb(t),null!==(i=y.a.f(i))&&i!==e)if("string"!=typeof i&&(i=i.toString()),s)s(t).html(i);else for(var n=y.a.ua(i,t.ownerDocument),r=0;r<n.length;r++)t.appendChild(n[r])},y.b("utils.parseHtmlFragment",y.a.ua),y.b("utils.setHtml",y.a.fc),y.aa=function(){function t(e,i){if(e)if(8==e.nodeType)null!=(n=y.aa.Uc(e.nodeValue))&&i.push({ud:e,Kd:n});else if(1==e.nodeType)for(var n=0,r=e.childNodes,o=r.length;n<o;n++)t(r[n],i)}var i={};return{Xb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return i[t]=e,"\x3c!--[ko_memo:"+t+"]--\x3e"},bd:function(t,n){var r=i[t];if(r===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete i[t]}},cd:function(e,i){var n=[];t(e,n);for(var r=0,o=n.length;r<o;r++){var s=n[r].ud,a=[s];i&&y.a.Nb(a,i),y.aa.bd(n[r].Kd,a),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Uc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),y.b("memoization",y.aa),y.b("memoization.memoize",y.aa.Xb),y.b("memoization.unmemoize",y.aa.bd),y.b("memoization.parseMemoText",y.aa.Uc),y.b("memoization.unmemoizeDomNodeAndDescendants",y.aa.cd),y.na=function(){function e(){if(s)for(var e,t=s,i=0;l<s;)if(e=o[l++]){if(l>t){if(5e3<=++i){l=s,y.a.Gc(Error("'Too much recursion' after processing "+i+" task groups."));break}t=s}try{e()}catch(e){y.a.Gc(e)}}}function n(){e(),l=s=o.length=0}var r,o=[],s=0,a=1,l=0;return r=t.MutationObserver?function(e){var t=i.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(n):i&&"onreadystatechange"in i.createElement("script")?function(e){var t=i.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,i.documentElement.removeChild(t),t=null,e()},i.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},{scheduler:r,zb:function(e){return s||y.na.scheduler(n),o[s++]=e,a++},cancel:function(e){(e-=a-s)>=l&&e<s&&(o[e]=null)},resetForTesting:function(){var e=s-l;return l=s=o.length=0,e},Sd:e}}(),y.b("tasks",y.na),y.b("tasks.schedule",y.na.zb),y.b("tasks.runEarly",y.na.Sd),y.Ta={throttle:function(e,t){e.throttleEvaluation=t;var i=null;return y.$({read:e,write:function(n){clearTimeout(i),i=y.a.setTimeout((function(){e(n)}),t)}})},rateLimit:function(e,t){var i,n,r;"number"==typeof t?i=t:(i=t.timeout,n=t.method),e.Hb=!1,r="function"==typeof n?n:"notifyWhenChangesStop"==n?u:h,e.ub((function(e){return r(e,i,t)}))},deferred:function(t,i){if(!0!==i)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");t.Hb||(t.Hb=!0,t.ub((function(i){var n,r=!1;return function(){if(!r){y.na.cancel(n),n=y.na.zb(i);try{r=!0,t.notifySubscribers(e,"dirty")}finally{r=!1}}}})))},notify:function(e,t){e.equalityComparer="always"==t?null:l}};var x={undefined:1,boolean:1,number:1,string:1};y.b("extenders",y.Ta),y.ic=function(e,t,i){this.da=e,this.lc=t,this.mc=i,this.Ib=!1,this.fb=this.Jb=null,y.L(this,"dispose",this.s),y.L(this,"disposeWhenNodeIsRemoved",this.l)},y.ic.prototype.s=function(){this.Ib||(this.fb&&y.a.K.yb(this.Jb,this.fb),this.Ib=!0,this.mc(),this.da=this.lc=this.mc=this.Jb=this.fb=null)},y.ic.prototype.l=function(e){this.Jb=e,y.a.K.za(e,this.fb=this.s.bind(this))},y.T=function(){y.a.Ab(this,S),S.qb(this)};var S={qb:function(e){e.U={change:[]},e.sc=1},subscribe:function(e,t,i){var n=this;i=i||"change";var r=new y.ic(n,t?e.bind(t):e,(function(){y.a.Pa(n.U[i],r),n.hb&&n.hb(i)}));return n.Qa&&n.Qa(i),n.U[i]||(n.U[i]=[]),n.U[i].push(r),r},notifySubscribers:function(e,t){if("change"===(t=t||"change")&&this.Gb(),this.Wa(t)){var i="change"===t&&this.ed||this.U[t].slice(0);try{y.u.xc();for(var n,r=0;n=i[r];++r)n.Ib||n.lc(e)}finally{y.u.end()}}},ob:function(){return this.sc},Dd:function(e){return this.ob()!==e},Gb:function(){++this.sc},ub:function(e){var t,i,n,r,o,s=this,a=y.O(s);s.gb||(s.gb=s.notifySubscribers,s.notifySubscribers=c);var l=e((function(){s.Ja=!1,a&&r===s&&(r=s.nc?s.nc():s());var e=i||o&&s.sb(n,r);o=i=t=!1,e&&s.gb(n=r)}));s.qc=function(e,i){i&&s.Ja||(o=!i),s.ed=s.U.change.slice(0),s.Ja=t=!0,r=e,l()},s.pc=function(e){t||(n=e,s.gb(e,"beforeChange"))},s.rc=function(){o=!0},s.gd=function(){s.sb(n,s.v(!0))&&(i=!0)}},Wa:function(e){return this.U[e]&&this.U[e].length},Bd:function(e){if(e)return this.U[e]&&this.U[e].length||0;var t=0;return y.a.P(this.U,(function(e,i){"dirty"!==e&&(t+=i.length)})),t},sb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},toString:function(){return"[object Object]"},extend:function(e){var t=this;return e&&y.a.P(e,(function(e,i){var n=y.Ta[e];"function"==typeof n&&(t=n(t,i)||t)})),t}};y.L(S,"init",S.qb),y.L(S,"subscribe",S.subscribe),y.L(S,"extend",S.extend),y.L(S,"getSubscriptionsCount",S.Bd),y.a.Ba&&y.a.setPrototypeOf(S,Function.prototype),y.T.fn=S,y.Qc=function(e){return null!=e&&"function"==typeof e.subscribe&&"function"==typeof e.notifySubscribers},y.b("subscribable",y.T),y.b("isSubscribable",y.Qc),y.S=y.u=function(){function e(e){n.push(i),i=e}function t(){i=n.pop()}var i,n=[],r=0;return{xc:e,end:t,cc:function(e){if(i){if(!y.Qc(e))throw Error("Only subscribable things can act as dependencies");i.od.call(i.pd,e,e.fd||(e.fd=++r))}},G:function(i,n,r){try{return e(),i.apply(n,r||[])}finally{t()}},qa:function(){if(i)return i.o.qa()},Va:function(){if(i)return i.o.Va()},Ya:function(){if(i)return i.Ya},o:function(){if(i)return i.o}}}(),y.b("computedContext",y.S),y.b("computedContext.getDependenciesCount",y.S.qa),y.b("computedContext.getDependencies",y.S.Va),y.b("computedContext.isInitial",y.S.Ya),y.b("computedContext.registerDependency",y.S.cc),y.b("ignoreDependencies",y.Yd=y.u.G);var C=y.a.Da("_latestValue");y.ta=function(e){function t(){return 0<arguments.length?(t.sb(t[C],arguments[0])&&(t.ya(),t[C]=arguments[0],t.xa()),this):(y.u.cc(t),t[C])}return t[C]=e,y.a.Ba||y.a.extend(t,y.T.fn),y.T.fn.qb(t),y.a.Ab(t,k),y.options.deferUpdates&&y.Ta.deferred(t,!0),t};var k={equalityComparer:l,v:function(){return this[C]},xa:function(){this.notifySubscribers(this[C],"spectate"),this.notifySubscribers(this[C])},ya:function(){this.notifySubscribers(this[C],"beforeChange")}};y.a.Ba&&y.a.setPrototypeOf(k,y.T.fn);var E=y.ta.Ma="__ko_proto__";k[E]=y.ta,y.O=function(e){if((e="function"==typeof e&&e[E])&&e!==k[E]&&e!==y.o.fn[E])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},y.Za=function(e){return"function"==typeof e&&(e[E]===k[E]||e[E]===y.o.fn[E]&&e.Nc)},y.b("observable",y.ta),y.b("isObservable",y.O),y.b("isWriteableObservable",y.Za),y.b("isWritableObservable",y.Za),y.b("observable.fn",k),y.L(k,"peek",k.v),y.L(k,"valueHasMutated",k.xa),y.L(k,"valueWillMutate",k.ya),y.Ha=function(e){if("object"!=typeof(e=e||[])||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=y.ta(e),y.a.Ab(e,y.Ha.fn),e.extend({trackArrayChanges:!0})},y.Ha.fn={remove:function(e){for(var t=this.v(),i=[],n="function"!=typeof e||y.O(e)?function(t){return t===e}:e,r=0;r<t.length;r++){var o=t[r];if(n(o)){if(0===i.length&&this.ya(),t[r]!==o)throw Error("Array modified during remove; cannot remove item");i.push(o),t.splice(r,1),r--}}return i.length&&this.xa(),i},removeAll:function(t){if(t===e){var i=this.v(),n=i.slice(0);return this.ya(),i.splice(0,i.length),this.xa(),n}return t?this.remove((function(e){return 0<=y.a.A(t,e)})):[]},destroy:function(e){var t=this.v(),i="function"!=typeof e||y.O(e)?function(t){return t===e}:e;this.ya();for(var n=t.length-1;0<=n;n--){var r=t[n];i(r)&&(r._destroy=!0)}this.xa()},destroyAll:function(t){return t===e?this.destroy((function(){return!0})):t?this.destroy((function(e){return 0<=y.a.A(t,e)})):[]},indexOf:function(e){var t=this();return y.a.A(t,e)},replace:function(e,t){var i=this.indexOf(e);0<=i&&(this.ya(),this.v()[i]=t,this.xa())},sorted:function(e){var t=this().slice(0);return e?t.sort(e):t.sort()},reversed:function(){return this().slice(0).reverse()}},y.a.Ba&&y.a.setPrototypeOf(y.Ha.fn,y.ta.fn),y.a.D("pop push reverse shift sort splice unshift".split(" "),(function(e){y.Ha.fn[e]=function(){var t=this.v();this.ya(),this.zc(t,e,arguments);var i=t[e].apply(t,arguments);return this.xa(),i===t?this:i}})),y.a.D(["slice"],(function(e){y.Ha.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}})),y.Pc=function(e){return y.O(e)&&"function"==typeof e.remove&&"function"==typeof e.push},y.b("observableArray",y.Ha),y.b("isObservableArray",y.Pc),y.Ta.trackArrayChanges=function(t,i){function n(){function e(){if(h){var e,i=[].concat(t.v()||[]);t.Wa("arrayChange")&&((!l||1<h)&&(l=y.a.Pb(s,i,t.Ob)),e=l),s=i,l=null,h=0,e&&e.length&&t.notifySubscribers(e,"arrayChange")}}a?e():(a=!0,o=t.subscribe((function(){++h}),null,"spectate"),s=[].concat(t.v()||[]),l=null,r=t.subscribe(e))}if(t.Ob={},i&&"object"==typeof i&&y.a.extend(t.Ob,i),t.Ob.sparse=!0,!t.zc){var r,o,s,a=!1,l=null,h=0,u=t.Qa,c=t.hb;t.Qa=function(e){u&&u.call(t,e),"arrayChange"===e&&n()},t.hb=function(i){c&&c.call(t,i),"arrayChange"!==i||t.Wa("arrayChange")||(r&&r.s(),o&&o.s(),o=r=null,a=!1,s=e)},t.zc=function(e,t,i){function n(e,t,i){return r[r.length]={status:e,value:t,index:i}}if(a&&!h){var r=[],o=e.length,s=i.length,u=0;switch(t){case"push":u=o;case"unshift":for(t=0;t<s;t++)n("added",i[t],u+t);break;case"pop":u=o-1;case"shift":o&&n("deleted",e[u],u);break;case"splice":t=Math.min(Math.max(0,0>i[0]?o+i[0]:i[0]),o),o=1===s?o:Math.min(t+(i[1]||0),o),s=t+s-2,u=Math.max(o,s);for(var c=[],d=[],p=2;t<u;++t,++p)t<o&&d.push(n("deleted",e[t],t)),t<s&&c.push(n("added",i[p],t));y.a.Kc(d,c);break;default:return}l=r}}}};var P=y.a.Da("_state");y.o=y.$=function(t,i,n){function r(){if(0<arguments.length){if("function"!=typeof o)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return o.apply(s.nb,arguments),this}return s.ra||y.u.cc(r),(s.ka||s.J&&r.Xa())&&r.ha(),s.X}if("object"==typeof t?n=t:(n=n||{},t&&(n.read=t)),"function"!=typeof n.read)throw Error("Pass a function that returns the value of the ko.computed");var o=n.write,s={X:e,sa:!0,ka:!0,rb:!1,jc:!1,ra:!1,wb:!1,J:!1,Wc:n.read,nb:i||n.owner,l:n.disposeWhenNodeIsRemoved||n.l||null,Sa:n.disposeWhen||n.Sa,Rb:null,I:{},V:0,Ic:null};return r[P]=s,r.Nc="function"==typeof o,y.a.Ba||y.a.extend(r,y.T.fn),y.T.fn.qb(r),y.a.Ab(r,N),n.pure?(s.wb=!0,s.J=!0,y.a.extend(r,T)):n.deferEvaluation&&y.a.extend(r,I),y.options.deferUpdates&&y.Ta.deferred(r,!0),s.l&&(s.jc=!0,s.l.nodeType||(s.l=null)),s.J||n.deferEvaluation||r.ha(),s.l&&r.ja()&&y.a.K.za(s.l,s.Rb=function(){r.s()}),r};var N={equalityComparer:l,qa:function(){return this[P].V},Va:function(){var e=[];return y.a.P(this[P].I,(function(t,i){e[i.Ka]=i.da})),e},Vb:function(e){if(!this[P].V)return!1;var t=this.Va();return-1!==y.a.A(t,e)||!!y.a.Lb(t,(function(t){return t.Vb&&t.Vb(e)}))},uc:function(e,t,i){if(this[P].wb&&t===this)throw Error("A 'pure' computed must not be called recursively");this[P].I[e]=i,i.Ka=this[P].V++,i.La=t.ob()},Xa:function(){var e,t,i=this[P].I;for(e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&(t=i[e],this.Ia&&t.da.Ja||t.da.Dd(t.La)))return!0},Jd:function(){this.Ia&&!this[P].rb&&this.Ia(!1)},ja:function(){var e=this[P];return e.ka||0<e.V},Rd:function(){this.Ja?this[P].ka&&(this[P].sa=!0):this.Hc()},$c:function(e){if(e.Hb){var t=e.subscribe(this.Jd,this,"dirty"),i=e.subscribe(this.Rd,this);return{da:e,s:function(){t.s(),i.s()}}}return e.subscribe(this.Hc,this)},Hc:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[P].Ic),this[P].Ic=y.a.setTimeout((function(){e.ha(!0)}),t)):e.Ia?e.Ia(!0):e.ha(!0)},ha:function(e){var t=this[P],i=t.Sa,n=!1;if(!t.rb&&!t.ra){if(t.l&&!y.a.Sb(t.l)||i&&i()){if(!t.jc)return void this.s()}else t.jc=!1;t.rb=!0;try{n=this.zd(e)}finally{t.rb=!1}return n}},zd:function(t){var i=this[P],n=!1,r=i.wb?e:!i.V;n={qd:this,mb:i.I,Qb:i.V},y.u.xc({pd:n,od:p,o:this,Ya:r}),i.I={},i.V=0;var o=this.yd(i,n);return i.V?n=this.sb(i.X,o):(this.s(),n=!0),n&&(i.J?this.Gb():this.notifySubscribers(i.X,"beforeChange"),i.X=o,this.notifySubscribers(i.X,"spectate"),!i.J&&t&&this.notifySubscribers(i.X),this.rc&&this.rc()),r&&this.notifySubscribers(i.X,"awake"),n},yd:function(e,t){try{var i=e.Wc;return e.nb?i.call(e.nb):i()}finally{y.u.end(),t.Qb&&!e.J&&y.a.P(t.mb,d),e.sa=e.ka=!1}},v:function(e){var t=this[P];return(t.ka&&(e||!t.V)||t.J&&this.Xa())&&this.ha(),t.X},ub:function(e){y.T.fn.ub.call(this,e),this.nc=function(){return this[P].J||(this[P].sa?this.ha():this[P].ka=!1),this[P].X},this.Ia=function(e){this.pc(this[P].X),this[P].ka=!0,e&&(this[P].sa=!0),this.qc(this,!e)}},s:function(){var t=this[P];!t.J&&t.I&&y.a.P(t.I,(function(e,t){t.s&&t.s()})),t.l&&t.Rb&&y.a.K.yb(t.l,t.Rb),t.I=e,t.V=0,t.ra=!0,t.sa=!1,t.ka=!1,t.J=!1,t.l=e,t.Sa=e,t.Wc=e,this.Nc||(t.nb=e)}},T={Qa:function(e){var t=this,i=t[P];if(!i.ra&&i.J&&"change"==e){if(i.J=!1,i.sa||t.Xa())i.I=null,i.V=0,t.ha()&&t.Gb();else{var n=[];y.a.P(i.I,(function(e,t){n[t.Ka]=e})),y.a.D(n,(function(e,n){var r=i.I[e],o=t.$c(r.da);o.Ka=n,o.La=r.La,i.I[e]=o})),t.Xa()&&t.ha()&&t.Gb()}i.ra||t.notifySubscribers(i.X,"awake")}},hb:function(t){var i=this[P];i.ra||"change"!=t||this.Wa("change")||(y.a.P(i.I,(function(e,t){t.s&&(i.I[e]={da:t.da,Ka:t.Ka,La:t.La},t.s())})),i.J=!0,this.notifySubscribers(e,"asleep"))},ob:function(){var e=this[P];return e.J&&(e.sa||this.Xa())&&this.ha(),y.T.fn.ob.call(this)}},I={Qa:function(e){"change"!=e&&"beforeChange"!=e||this.v()}};y.a.Ba&&y.a.setPrototypeOf(N,y.T.fn);var R=y.ta.Ma;N[R]=y.o,y.Oc=function(e){return"function"==typeof e&&e[R]===N[R]},y.Fd=function(e){return y.Oc(e)&&e[P]&&e[P].wb},y.b("computed",y.o),y.b("dependentObservable",y.o),y.b("isComputed",y.Oc),y.b("isPureComputed",y.Fd),y.b("computed.fn",N),y.L(N,"peek",N.v),y.L(N,"dispose",N.s),y.L(N,"isActive",N.ja),y.L(N,"getDependenciesCount",N.qa),y.L(N,"getDependencies",N.Va),y.xb=function(e,t){return"function"==typeof e?y.o(e,t,{pure:!0}):((e=y.a.extend({},e)).pure=!0,y.o(e,t))},y.b("pureComputed",y.xb),function(){function t(n,r,o){if(o=o||new i,"object"!=typeof(n=r(n))||null===n||n===e||n instanceof RegExp||n instanceof Date||n instanceof String||n instanceof Number||n instanceof Boolean)return n;var s=n instanceof Array?[]:{};return o.save(n,s),function(e,t){if(e instanceof Array){for(var i=0;i<e.length;i++)t(i);"function"==typeof e.toJSON&&t("toJSON")}else for(i in e)t(i)}(n,(function(i){var a=r(n[i]);switch(typeof a){case"boolean":case"number":case"string":case"function":s[i]=a;break;case"object":case"undefined":var l=o.get(a);s[i]=l!==e?l:t(a,r,o)}})),s}function i(){this.keys=[],this.values=[]}y.ad=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,(function(e){for(var t=0;y.O(e)&&10>t;t++)e=e();return e}))},y.toJSON=function(e,t,i){return e=y.ad(e),y.a.hc(e,t,i)},i.prototype={constructor:i,save:function(e,t){var i=y.a.A(this.keys,e);0<=i?this.values[i]=t:(this.keys.push(e),this.values.push(t))},get:function(t){return 0<=(t=y.a.A(this.keys,t))?this.values[t]:e}}}(),y.b("toJS",y.ad),y.b("toJSON",y.toJSON),y.Wd=function(e,t,i){function n(t){var n=y.xb(e,i).extend({ma:"always"}),r=n.subscribe((function(e){e&&(r.s(),t(e))}));return n.notifySubscribers(n.v()),r}return"function"!=typeof Promise||t?n(t.bind(i)):new Promise(n)},y.b("when",y.Wd),y.w={M:function(t){switch(y.a.R(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?y.a.g.get(t,y.c.options.$b):7>=y.a.W?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?y.w.M(t.options[t.selectedIndex]):e;default:return t.value}},cb:function(t,i,n){switch(y.a.R(t)){case"option":"string"==typeof i?(y.a.g.set(t,y.c.options.$b,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=i):(y.a.g.set(t,y.c.options.$b,i),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof i?i:"");break;case"select":""!==i&&null!==i||(i=e);for(var r,o=-1,s=0,a=t.options.length;s<a;++s)if((r=y.w.M(t.options[s]))==i||""===r&&i===e){o=s;break}(n||0<=o||i===e&&1<t.size)&&(t.selectedIndex=o,6===y.a.W&&y.a.setTimeout((function(){t.selectedIndex=o}),0));break;default:null!==i&&i!==e||(i=""),t.value=i}}},y.b("selectExtensions",y.w),y.b("selectExtensions.readValue",y.w.M),y.b("selectExtensions.writeValue",y.w.cb),y.m=function(){function e(e){123===(e=y.a.Db(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t,i=[],s=(e+="\n,").match(n),a=[],l=0;if(1<s.length){for(var h,u=0;h=s[u];++u){var c=h.charCodeAt(0);if(44===c){if(0>=l){i.push(t&&a.length?{key:t,value:a.join("")}:{unknown:t||a.join("")}),t=l=0,a=[];continue}}else if(58===c){if(!l&&!t&&1===a.length){t=a.pop();continue}}else{if(47===c&&1<h.length&&(47===h.charCodeAt(1)||42===h.charCodeAt(1)))continue;47===c&&u&&1<h.length?(c=s[u-1].match(r))&&!o[c[0]]&&(s=(e=e.substr(e.indexOf(h)+1)).match(n),u=-1,h="/"):40===c||123===c||91===c?++l:41===c||125===c||93===c?--l:t||a.length||34!==c&&39!==c||(h=h.slice(1,-1))}a.push(h)}if(0<l)throw Error("Unbalanced parentheses, braces, or brackets")}return i}var t=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,n=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),r=/[\])"'A-Za-z0-9_$]+$/,o={in:1,return:1,typeof:1},s={};return{Ra:[],wa:s,ac:e,vb:function(n,r){function o(e,n){var r;if(!u){var c=y.getBindingHandler(e);if(c&&c.preprocess&&!(n=c.preprocess(n,e,o)))return;(c=s[e])&&(r=n,0<=y.a.A(t,r)?r=!1:(c=r.match(i),r=null!==c&&(c[1]?"Object("+c[1]+")"+c[2]:r)),c=r),c&&l.push("'"+("string"==typeof s[e]?s[e]:e)+"':function(_z){"+r+"=_z}")}h&&(n="function(){return "+n+" }"),a.push("'"+e+"':"+n)}var a=[],l=[],h=(r=r||{}).valueAccessors,u=r.bindingParams,c="string"==typeof n?e(n):n;return y.a.D(c,(function(e){o(e.key||e.unknown,e.value)})),l.length&&o("_ko_property_writers","{"+l.join(",")+" }"),a.join(",")},Id:function(e,t){for(var i=0;i<e.length;i++)if(e[i].key==t)return!0;return!1},eb:function(e,t,i,n,r){e&&y.O(e)?!y.Za(e)||r&&e.v()===n||e(n):(e=t.get("_ko_property_writers"))&&e[i]&&e[i](n)}}}(),y.b("expressionRewriting",y.m),y.b("expressionRewriting.bindingRewriteValidators",y.m.Ra),y.b("expressionRewriting.parseObjectLiteral",y.m.ac),y.b("expressionRewriting.preProcessBindings",y.m.vb),y.b("expressionRewriting._twoWayBindings",y.m.wa),y.b("jsonExpressionRewriting",y.m),y.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",y.m.vb),function(){function e(e){return 8==e.nodeType&&s.test(o?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&a.test(o?e.text:e.nodeValue)}function n(i,n){for(var r=i,o=1,s=[];r=r.nextSibling;){if(t(r)&&(y.a.g.set(r,h,!0),0==--o))return s;s.push(r),e(r)&&o++}if(!n)throw Error("Cannot find closing comment tag to match: "+i.nodeValue);return null}function r(e,t){var i=n(e,t);return i?0<i.length?i[i.length-1].nextSibling:e.nextSibling:null}var o=i&&"\x3c!--test--\x3e"===i.createComment("test").text,s=o?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,a=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0},h="__ko_matchedEndComment__";y.h={ea:{},childNodes:function(t){return e(t)?n(t):t.childNodes},Ea:function(t){if(e(t))for(var i=0,n=(t=y.h.childNodes(t)).length;i<n;i++)y.removeNode(t[i]);else y.a.Tb(t)},va:function(t,i){if(e(t)){y.h.Ea(t);for(var n=t.nextSibling,r=0,o=i.length;r<o;r++)n.parentNode.insertBefore(i[r],n)}else y.a.va(t,i)},Vc:function(t,i){var n;e(t)?(n=t.nextSibling,t=t.parentNode):n=t.firstChild,n?i!==n&&t.insertBefore(i,n):t.appendChild(i)},Wb:function(t,i,n){n?(n=n.nextSibling,e(t)&&(t=t.parentNode),n?i!==n&&t.insertBefore(i,n):t.appendChild(i)):y.h.Vc(t,i)},firstChild:function(i){if(e(i))return!i.nextSibling||t(i.nextSibling)?null:i.nextSibling;if(i.firstChild&&t(i.firstChild))throw Error("Found invalid end comment, as the first child of "+i);return i.firstChild},nextSibling:function(i){if(e(i)&&(i=r(i)),i.nextSibling&&t(i.nextSibling)){var n=i.nextSibling;if(t(n)&&!y.a.g.get(n,h))throw Error("Found end comment without a matching opening comment, as child of "+i);return null}return i.nextSibling},Cd:e,Vd:function(e){return(e=(o?e.text:e.nodeValue).match(s))?e[1]:null},Sc:function(i){if(l[y.a.R(i)]){var n=i.firstChild;if(n)do{if(1===n.nodeType){var o,s=null;if(o=n.firstChild)do{if(s)s.push(o);else if(e(o)){var a=r(o,!0);a?o=a:s=[o]}else t(o)&&(s=[o])}while(o=o.nextSibling);if(o=s)for(s=n.nextSibling,a=0;a<o.length;a++)s?i.insertBefore(o[a],s):i.appendChild(o[a])}}while(n=n.nextSibling)}}}}(),y.b("virtualElements",y.h),y.b("virtualElements.allowedBindings",y.h.ea),y.b("virtualElements.emptyNode",y.h.Ea),y.b("virtualElements.insertAfter",y.h.Wb),y.b("virtualElements.prepend",y.h.Vc),y.b("virtualElements.setDomNodeChildren",y.h.va),y.ga=function(){this.nd={}},y.a.extend(y.ga.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||y.j.getComponentNameForNode(e);case 8:return y.h.Cd(e);default:return!1}},getBindings:function(e,t){var i=(i=this.getBindingsString(e,t))?this.parseBindingsString(i,t,e):null;return y.j.tc(i,e,t,!1)},getBindingAccessors:function(e,t){var i=(i=this.getBindingsString(e,t))?this.parseBindingsString(i,t,e,{valueAccessors:!0}):null;return y.j.tc(i,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return y.h.Vd(e);default:return null}},parseBindingsString:function(e,t,i,n){try{var r,o=this.nd,s=e+(n&&n.valueAccessors||"");if(!(r=o[s])){var a,l="with($context){with($data||{}){return{"+y.m.vb(e,n)+"}}}";a=new Function("$context","$element",l),r=o[s]=a}return r(t,i)}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}}}),y.ga.instance=new y.ga,y.b("bindingProvider",y.ga),function(){function n(e){var t=(e=y.a.g.get(e,x))&&e.N;t&&(e.N=null,t.Tc())}function r(e,t,i){this.node=e,this.yc=t,this.kb=[],this.H=!1,t.N||y.a.K.za(e,n),i&&i.N&&(i.N.kb.push(e),this.Kb=i)}function o(e){return function(){return e}}function a(e){return e()}function l(e){return y.a.Ga(y.u.G(e),(function(t,i){return function(){return e()[i]}}))}function h(e,t,i){return"function"==typeof e?l(e.bind(null,t,i)):y.a.Ga(e,o)}function u(e,t){return l(this.getBindings.bind(this,e,t))}function c(e,t){var i=y.h.firstChild(t);if(i){var n,r=y.ga.instance,o=r.preprocessNode;if(o){for(;n=i;)i=y.h.nextSibling(n),o.call(r,n);i=y.h.firstChild(t)}for(;n=i;)i=y.h.nextSibling(n),d(e,n)}y.i.ma(t,y.i.H)}function d(e,t){var i=e,n=1===t.nodeType;n&&y.h.Sc(t),(n||y.ga.instance.nodeHasBindings(t))&&(i=p(t,null,e).bindingContextForDescendants),i&&!v[y.a.R(t)]&&c(i,t)}function p(t,i,n){var r,o=y.a.g.Ub(t,x,{}),s=o.hd;if(!i){if(s)throw Error("You cannot apply bindings multiple times to the same element.");o.hd=!0}if(s||(o.context=n),o.Zb||(o.Zb={}),i&&"function"!=typeof i)r=i;else{var l=y.ga.instance,h=l.getBindingAccessors||u,c=y.$((function(){return(r=i?i(n,t):h.call(l,t,n))&&(n[g]&&n[g](),n[b]&&n[b]()),r}),null,{l:t});r&&c.ja()||(c=null)}var d,p=n;if(r){var f=function(){return y.a.Ga(c?c():r,a)},m=c?function(e){return function(){return a(c()[e])}}:function(e){return r[e]};f.get=function(e){return r[e]&&a(m(e))},f.has=function(e){return e in r},y.i.H in r&&y.i.subscribe(t,y.i.H,(function(){var e=(0,r[y.i.H])();if(e){var i=y.h.childNodes(t);i.length&&e(i,y.Ec(i[0]))}})),y.i.pa in r&&(p=y.i.Cb(t,n),y.i.subscribe(t,y.i.pa,(function(){var e=(0,r[y.i.pa])();e&&y.h.firstChild(t)&&e(t)}))),o=function(e){var t=[],i={},n=[];return y.a.P(e,(function r(o){if(!i[o]){var s=y.getBindingHandler(o);s&&(s.after&&(n.push(o),y.a.D(s.after,(function(t){if(e[t]){if(-1!==y.a.A(n,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+n.join(", "));r(t)}})),n.length--),t.push({key:o,Mc:s})),i[o]=!0}})),t}(r),y.a.D(o,(function(i){var n=i.Mc.init,o=i.Mc.update,s=i.key;if(8===t.nodeType&&!y.h.ea[s])throw Error("The binding '"+s+"' cannot be used with virtual elements");try{"function"==typeof n&&y.u.G((function(){var i=n(t,m(s),f,p.$data,p);if(i&&i.controlsDescendantBindings){if(d!==e)throw Error("Multiple bindings ("+d+" and "+s+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");d=s}})),"function"==typeof o&&y.$((function(){o(t,m(s),f,p.$data,p)}),null,{l:t})}catch(e){throw e.message='Unable to process binding "'+s+": "+r[s]+'"\nMessage: '+e.message,e}}))}return{shouldBindDescendants:o=d===e,bindingContextForDescendants:o&&p}}function f(t,i){return t&&t instanceof y.fa?t:new y.fa(t,e,e,i)}var g=y.a.Da("_subscribable"),m=y.a.Da("_ancestorBindingInfo"),b=y.a.Da("_dataDependency");y.c={};var v={script:!0,textarea:!0,template:!0};y.getBindingHandler=function(e){return y.c[e]};var w={};y.fa=function(t,i,n,r,o){function s(){var e=c?u():u,t=y.a.f(e);return i?(y.a.extend(l,i),m in i&&(l[m]=i[m])):(l.$parents=[],l.$root=t,l.ko=y),l[g]=a,h?t=l.$data:(l.$rawData=e,l.$data=t),n&&(l[n]=t),r&&r(l,i,t),i&&i[g]&&!y.S.o().Vb(i[g])&&i[g](),d&&(l[b]=d),l.$data}var a,l=this,h=t===w,u=h?e:t,c="function"==typeof u&&!y.O(u),d=o&&o.dataDependency;o&&o.exportDependencies?s():((a=y.xb(s)).v(),a.ja()?a.equalityComparer=null:l[g]=e)},y.fa.prototype.createChildContext=function(e,t,i,n){if(!n&&t&&"object"==typeof t&&(t=(n=t).as,i=n.extend),t&&n&&n.noChildContext){var r="function"==typeof e&&!y.O(e);return new y.fa(w,this,null,(function(n){i&&i(n),n[t]=r?e():e}),n)}return new y.fa(e,this,t,(function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),i&&i(e)}),n)},y.fa.prototype.extend=function(e,t){return new y.fa(w,this,null,(function(t){y.a.extend(t,"function"==typeof e?e(t):e)}),t)};var x=y.a.g.Z();r.prototype.Tc=function(){this.Kb&&this.Kb.N&&this.Kb.N.sd(this.node)},r.prototype.sd=function(e){y.a.Pa(this.kb,e),!this.kb.length&&this.H&&this.Cc()},r.prototype.Cc=function(){this.H=!0,this.yc.N&&!this.kb.length&&(this.yc.N=null,y.a.K.yb(this.node,n),y.i.ma(this.node,y.i.pa),this.Tc())},y.i={H:"childrenComplete",pa:"descendantsComplete",subscribe:function(e,t,i,n,r){var o=y.a.g.Ub(e,x,{});return o.Fa||(o.Fa=new y.T),r&&r.notifyImmediately&&o.Zb[t]&&y.u.G(i,n,[e]),o.Fa.subscribe(i,n,t)},ma:function(t,i){var n=y.a.g.get(t,x);if(n&&(n.Zb[i]=!0,n.Fa&&n.Fa.notifySubscribers(t,i),i==y.i.H))if(n.N)n.N.Cc();else if(n.N===e&&n.Fa&&n.Fa.Wa(y.i.pa))throw Error("descendantsComplete event not supported for bindings on this node")},Cb:function(e,t){var i=y.a.g.Ub(e,x,{});return i.N||(i.N=new r(e,i,t[m])),t[m]==i?t:t.extend((function(e){e[m]=i}))}},y.Td=function(e){return(e=y.a.g.get(e,x))&&e.context},y.ib=function(e,t,i){return 1===e.nodeType&&y.h.Sc(e),p(e,t,f(i))},y.ld=function(e,t,i){return i=f(i),y.ib(e,h(t,i,e),i)},y.Oa=function(e,t){1!==t.nodeType&&8!==t.nodeType||c(f(e),t)},y.vc=function(e,n,r){if(!s&&t.jQuery&&(s=t.jQuery),2>arguments.length){if(!(n=i.body))throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!n||1!==n.nodeType&&8!==n.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");d(f(e,r),n)},y.Dc=function(t){return!t||1!==t.nodeType&&8!==t.nodeType?e:y.Td(t)},y.Ec=function(t){return(t=y.Dc(t))?t.$data:e},y.b("bindingHandlers",y.c),y.b("bindingEvent",y.i),y.b("bindingEvent.subscribe",y.i.subscribe),y.b("bindingEvent.startPossiblyAsyncContentBinding",y.i.Cb),y.b("applyBindings",y.vc),y.b("applyBindingsToDescendants",y.Oa),y.b("applyBindingAccessorsToNode",y.ib),y.b("applyBindingsToNode",y.ld),y.b("contextFor",y.Dc),y.b("dataFor",y.Ec)}(),function(e){function t(t,n){var s,a=Object.prototype.hasOwnProperty.call(r,t)?r[t]:e;a?a.subscribe(n):((a=r[t]=new y.T).subscribe(n),i(t,(function(e,i){var n=!(!i||!i.synchronous);o[t]={definition:e,Gd:n},delete r[t],s||n?a.notifySubscribers(e):y.na.zb((function(){a.notifySubscribers(e)}))})),s=!0)}function i(e,t){n("getConfig",[e],(function(i){i?n("loadComponent",[e,i],(function(e){t(e,i)})):t(null,null)}))}function n(t,i,r,o){o||(o=y.j.loaders.slice(0));var s=o.shift();if(s){var a=s[t];if(a){var l=!1;if(a.apply(s,i.concat((function(e){l?r(null):null!==e?r(e):n(t,i,r,o)})))!==e&&(l=!0,!s.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else n(t,i,r,o)}else r(null)}var r={},o={};y.j={get:function(i,n){var r=Object.prototype.hasOwnProperty.call(o,i)?o[i]:e;r?r.Gd?y.u.G((function(){n(r.definition)})):y.na.zb((function(){n(r.definition)})):t(i,n)},Bc:function(e){delete o[e]},oc:n},y.j.loaders=[],y.b("components",y.j),y.b("components.get",y.j.get),y.b("components.clearCachedDefinition",y.j.Bc)}(),function(){function e(e,t,i,n){function r(){0==--s&&n(o)}var o={},s=2,l=i.template;i=i.viewModel,l?a(t,l,(function(t){y.j.oc("loadTemplate",[e,t],(function(e){o.template=e,r()}))})):r(),i?a(t,i,(function(t){y.j.oc("loadViewModel",[e,t],(function(e){o[u]=e,r()}))})):r()}function n(e,t,i){if("function"==typeof t)i((function(e){return new t(e)}));else if("function"==typeof t[u])i(t[u]);else if("instance"in t){var r=t.instance;i((function(){return r}))}else"viewModel"in t?n(e,t.viewModel,i):e("Unknown viewModel value: "+t)}function r(e){switch(y.a.R(e)){case"script":return y.a.ua(e.text);case"textarea":return y.a.ua(e.value);case"template":if(s(e.content))return y.a.Ca(e.content.childNodes)}return y.a.Ca(e.childNodes)}function s(e){return t.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function a(e,i,n){"string"==typeof i.require?o||t.require?(o||t.require)([i.require],(function(e){e&&"object"==typeof e&&e.Xd&&e.default&&(e=e.default),n(e)})):e("Uses require, but no AMD loader is present"):n(i)}function l(e){return function(t){throw Error("Component '"+e+"': "+t)}}var h={};y.j.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(y.j.tb(e))throw Error("Component "+e+" is already registered");h[e]=t},y.j.tb=function(e){return Object.prototype.hasOwnProperty.call(h,e)},y.j.unregister=function(e){delete h[e],y.j.Bc(e)},y.j.Fc={getConfig:function(e,t){t(y.j.tb(e)?h[e]:null)},loadComponent:function(t,i,n){var r=l(t);a(r,i,(function(i){e(t,r,i,n)}))},loadTemplate:function(e,n,o){if(e=l(e),"string"==typeof n)o(y.a.ua(n));else if(n instanceof Array)o(n);else if(s(n))o(y.a.la(n.childNodes));else if(n.element)if(n=n.element,t.HTMLElement?n instanceof HTMLElement:n&&n.tagName&&1===n.nodeType)o(r(n));else if("string"==typeof n){var a=i.getElementById(n);a?o(r(a)):e("Cannot find element with ID "+n)}else e("Unknown element type: "+n);else e("Unknown template value: "+n)},loadViewModel:function(e,t,i){n(l(e),t,i)}};var u="createViewModel";y.b("components.register",y.j.register),y.b("components.isRegistered",y.j.tb),y.b("components.unregister",y.j.unregister),y.b("components.defaultLoader",y.j.Fc),y.j.loaders.push(y.j.Fc),y.j.dd=h}(),function(){function e(e,i){if(n=e.getAttribute("params")){var n=t.parseBindingsString(n,i,e,{valueAccessors:!0,bindingParams:!0}),r=(n=y.a.Ga(n,(function(t){return y.o(t,null,{l:e})})),y.a.Ga(n,(function(t){var i=t.v();return t.ja()?y.o({read:function(){return y.a.f(t())},write:y.Za(i)&&function(e){t()(e)},l:e}):i})));return Object.prototype.hasOwnProperty.call(r,"$raw")||(r.$raw=n),r}return{$raw:{}}}y.j.getComponentNameForNode=function(e){var t=y.a.R(e);if(y.j.tb(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=y.a.W&&e.tagName===t))return t},y.j.tc=function(t,i,n,r){if(1===i.nodeType){var o=y.j.getComponentNameForNode(i);if(o){if((t=t||{}).component)throw Error('Cannot use the "component" binding on a custom element matching a component');var s={name:o,params:e(i,n)};t.component=r?function(){return s}:s}}return t};var t=new y.ga;9>y.a.W&&(y.j.register=function(e){return function(t){return e.apply(this,arguments)}}(y.j.register),i.createDocumentFragment=function(e){return function(){var t=e();return y.j.dd,t}}(i.createDocumentFragment))}(),function(){var e=0;y.c.component={init:function(t,i,n,r,o){function s(){var e=a&&a.dispose;"function"==typeof e&&e.call(a),h&&h.s(),l=a=h=null}var a,l,h,u=y.a.la(y.h.childNodes(t));return y.h.Ea(t),y.a.K.za(t,s),y.o((function(){var n,r,c=y.a.f(i());if("string"==typeof c?n=c:(n=y.a.f(c.name),r=y.a.f(c.params)),!n)throw Error("No component name specified");var d=y.i.Cb(t,o),p=l=++e;y.j.get(n,(function(e){if(l===p){if(s(),!e)throw Error("Unknown component '"+n+"'");!function(e,t,i){if(!(t=t.template))throw Error("Component '"+e+"' has no template");e=y.a.Ca(t),y.h.va(i,e)}(n,e,t);var i=function(e,t,i){var n=e.createViewModel;return n?n.call(e,t,i):t}(e,r,{element:t,templateNodes:u});e=d.createChildContext(i,{extend:function(e){e.$component=i,e.$componentTemplateNodes=u}}),i&&i.koDescendantsComplete&&(h=y.i.subscribe(t,y.i.pa,i.koDescendantsComplete,i)),a=i,y.Oa(e,t)}}))}),null,{l:t}),{controlsDescendantBindings:!0}}},y.h.ea.component=!0}();var _={class:"className",for:"htmlFor"};y.c.attr={update:function(t,i){var n=y.a.f(i())||{};y.a.P(n,(function(i,n){n=y.a.f(n);var r=i.indexOf(":"),o=(r="lookupNamespaceURI"in t&&0<r&&t.lookupNamespaceURI(i.substr(0,r)),!1===n||null===n||n===e);o?r?t.removeAttributeNS(r,i):t.removeAttribute(i):n=n.toString(),8>=y.a.W&&i in _?(i=_[i],o?t.removeAttribute(i):t[i]=n):o||(r?t.setAttributeNS(r,i,n):t.setAttribute(i,n)),"name"===i&&y.a.Yc(t,o?"":n)}))}},y.c.checked={after:["value","attr"],init:function(t,i,n){function r(){var r=t.checked,l=o();if(!y.S.Ya()&&(r||!a&&!y.S.qa())){var c=y.u.G(i);if(h){var p=u?c.v():c,f=d;d=l,f!==l?r&&(y.a.Na(p,l,!0),y.a.Na(p,f,!1)):y.a.Na(p,l,r),u&&y.Za(c)&&c(p)}else s&&(l===e?l=r:r||(l=e)),y.m.eb(c,n,"checked",l,!0)}}var o=y.xb((function(){return n.has("checkedValue")?y.a.f(n.get("checkedValue")):c?n.has("value")?y.a.f(n.get("value")):t.value:void 0})),s="checkbox"==t.type,a="radio"==t.type;if(s||a){var l=i(),h=s&&y.a.f(l)instanceof Array,u=!(h&&l.push&&l.splice),c=a||h,d=h?o():e;a&&!t.name&&y.c.uniqueName.init(t,(function(){return!0})),y.o(r,null,{l:t}),y.a.B(t,"click",r),y.o((function(){var n=y.a.f(i()),r=o();h?(t.checked=0<=y.a.A(n,r),d=r):t.checked=s&&r===e?!!n:o()===n}),null,{l:t}),l=e}}},y.m.wa.checked=!0,y.c.checkedValue={update:function(e,t){e.value=y.a.f(t())}},y.c.class={update:function(e,t){var i=y.a.Db(y.a.f(t()));y.a.Eb(e,e.__ko__cssValue,!1),e.__ko__cssValue=i,y.a.Eb(e,i,!0)}},y.c.css={update:function(e,t){var i=y.a.f(t());null!==i&&"object"==typeof i?y.a.P(i,(function(t,i){i=y.a.f(i),y.a.Eb(e,t,i)})):y.c.class.update(e,t)}},y.c.enable={update:function(e,t){var i=y.a.f(t());i&&e.disabled?e.removeAttribute("disabled"):i||e.disabled||(e.disabled=!0)}},y.c.disable={update:function(e,t){y.c.enable.update(e,(function(){return!y.a.f(t())}))}},y.c.event={init:function(e,t,i,n,r){var o=t()||{};y.a.P(o,(function(o){"string"==typeof o&&y.a.B(e,o,(function(e){var s,a=t()[o];if(a){try{var l=y.a.la(arguments);n=r.$data,l.unshift(n),s=a.apply(n,l)}finally{!0!==s&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===i.get(o+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}}))}))}},y.c.foreach={Rc:function(e){return function(){var t=e(),i=y.a.bc(t);return i&&"number"!=typeof i.length?(y.a.f(t),{foreach:i.data,as:i.as,noChildContext:i.noChildContext,includeDestroyed:i.includeDestroyed,afterAdd:i.afterAdd,beforeRemove:i.beforeRemove,afterRender:i.afterRender,beforeMove:i.beforeMove,afterMove:i.afterMove,templateEngine:y.ba.Ma}):{foreach:t,templateEngine:y.ba.Ma}}},init:function(e,t){return y.c.template.init(e,y.c.foreach.Rc(t))},update:function(e,t,i,n,r){return y.c.template.update(e,y.c.foreach.Rc(t),i,n,r)}},y.m.Ra.foreach=!1,y.h.ea.foreach=!0,y.c.hasfocus={init:function(e,t,i){function n(n){e.__ko_hasfocusUpdating=!0;var r=e.ownerDocument;if("activeElement"in r){var o;try{o=r.activeElement}catch(e){o=r.body}n=o===e}r=t(),y.m.eb(r,i,"hasfocus",n,!0),e.__ko_hasfocusLastValue=n,e.__ko_hasfocusUpdating=!1}var r=n.bind(null,!0),o=n.bind(null,!1);y.a.B(e,"focus",r),y.a.B(e,"focusin",r),y.a.B(e,"blur",o),y.a.B(e,"focusout",o),e.__ko_hasfocusLastValue=!1},update:function(e,t){var i=!!y.a.f(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===i||(i?e.focus():e.blur(),!i&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),y.u.G(y.a.Fb,null,[e,i?"focusin":"focusout"]))}},y.m.wa.hasfocus=!0,y.c.hasFocus=y.c.hasfocus,y.m.wa.hasFocus="hasfocus",y.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){y.a.fc(e,t())}},function(){function e(e,t,i){y.c[e]={init:function(e,n,r,o,s){var a,l,h,u,c,d={};if(t){o=r.get("as");var p=r.get("noChildContext");d={as:o,noChildContext:p,exportDependencies:c=!(o&&p)}}return u=(h="render"==r.get("completeOn"))||r.has(y.i.pa),y.o((function(){var r,o=y.a.f(n()),p=!i!=!o,f=!l;(c||p!==a)&&(u&&(s=y.i.Cb(e,s)),p&&(t&&!c||(d.dataDependency=y.S.o()),r=t?s.createChildContext("function"==typeof o?o:n,d):y.S.qa()?s.extend(null,d):s),f&&y.S.qa()&&(l=y.a.Ca(y.h.childNodes(e),!0)),p?(f||y.h.va(e,y.a.Ca(l)),y.Oa(r,e)):(y.h.Ea(e),h||y.i.ma(e,y.i.H)),a=p)}),null,{l:e}),{controlsDescendantBindings:!0}}},y.m.Ra[e]=!1,y.h.ea[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)}(),y.c.let={init:function(e,t,i,n,r){return t=r.extend(t),y.Oa(t,e),{controlsDescendantBindings:!0}}},y.h.ea.let=!0;var A={};y.c.options={init:function(e){if("select"!==y.a.R(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,n){function r(){return y.a.jb(t.options,(function(e){return e.selected}))}function o(e,t,i){var n=typeof t;return"function"==n?t(e):"string"==n?e[t]:i}function s(e,i){if(f&&u)y.i.ma(t,y.i.H);else if(p.length){var n=0<=y.a.A(p,y.w.M(i[0]));y.a.Zc(i[0],n),f&&!n&&y.u.G(y.a.Fb,null,[t,"change"])}}var a=t.multiple,l=0!=t.length&&a?t.scrollTop:null,h=y.a.f(i()),u=n.get("valueAllowUnset")&&n.has("value"),c=n.get("optionsIncludeDestroyed");i={};var d,p=[];u||(a?p=y.a.Mb(r(),y.w.M):0<=t.selectedIndex&&p.push(y.w.M(t.options[t.selectedIndex]))),h&&(void 0===h.length&&(h=[h]),d=y.a.jb(h,(function(t){return c||t===e||null===t||!y.a.f(t._destroy)})),n.has("optionsCaption")&&null!==(h=y.a.f(n.get("optionsCaption")))&&h!==e&&d.unshift(A));var f=!1;i.beforeRemove=function(e){t.removeChild(e)},h=s,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(h=function(t,i){s(0,i),y.u.G(n.get("optionsAfterRender"),null,[i[0],t!==A?t:e])}),y.a.ec(t,d,(function(i,r,s){return s.length&&(p=!u&&s[0].selected?[y.w.M(s[0])]:[],f=!0),r=t.ownerDocument.createElement("option"),i===A?(y.a.Bb(r,n.get("optionsCaption")),y.w.cb(r,e)):(s=o(i,n.get("optionsValue"),i),y.w.cb(r,y.a.f(s)),i=o(i,n.get("optionsText"),s),y.a.Bb(r,i)),[r]}),i,h),u||(a?p.length&&r().length<p.length:p.length&&0<=t.selectedIndex?y.w.M(t.options[t.selectedIndex])!==p[0]:p.length||0<=t.selectedIndex)&&y.u.G(y.a.Fb,null,[t,"change"]),(u||y.S.Ya())&&y.i.ma(t,y.i.H),y.a.wd(t),l&&20<Math.abs(l-t.scrollTop)&&(t.scrollTop=l)}},y.c.options.$b=y.a.g.Z(),y.c.selectedOptions={init:function(e,t,i){function n(){var n=t(),r=[];y.a.D(e.getElementsByTagName("option"),(function(e){e.selected&&r.push(y.w.M(e))})),y.m.eb(n,i,"selectedOptions",r)}function r(){var i=y.a.f(t()),n=e.scrollTop;i&&"number"==typeof i.length&&y.a.D(e.getElementsByTagName("option"),(function(e){var t=0<=y.a.A(i,y.w.M(e));e.selected!=t&&y.a.Zc(e,t)})),e.scrollTop=n}if("select"!=y.a.R(e))throw Error("selectedOptions binding applies only to SELECT elements");var o;y.i.subscribe(e,y.i.H,(function(){o?n():(y.a.B(e,"change",n),o=y.o(r,null,{l:e}))}),null,{notifyImmediately:!0})},update:function(){}},y.m.wa.selectedOptions=!0,y.c.style={update:function(t,i){var n=y.a.f(i()||{});y.a.P(n,(function(i,n){if(null!==(n=y.a.f(n))&&n!==e&&!1!==n||(n=""),s)s(t).css(i,n);else if(/^--/.test(i))t.style.setProperty(i,n);else{i=i.replace(/-(\w)/g,(function(e,t){return t.toUpperCase()}));var r=t.style[i];t.style[i]=n,n===r||t.style[i]!=r||isNaN(n)||(t.style[i]=n+"px")}}))}},y.c.submit={init:function(e,t,i,n,r){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");y.a.B(e,"submit",(function(i){var n,o=t();try{n=o.call(r.$data,e)}finally{!0!==n&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}}))}},y.c.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){y.a.Bb(e,t())}},y.h.ea.text=!0,function(){if(t&&t.navigator){var i,n,r,o,s,a=function(e){if(e)return parseFloat(e[1])},l=t.navigator.userAgent;(i=t.opera&&t.opera.version&&parseInt(t.opera.version()))||(s=a(l.match(/Edge\/([^ ]+)$/)))||a(l.match(/Chrome\/([^ ]+)/))||(n=a(l.match(/Version\/([^ ]+) Safari/)))||(r=a(l.match(/Firefox\/([^ ]+)/)))||(o=y.a.W||a(l.match(/MSIE ([^ ]+)/)))||(o=a(l.match(/rv:([^ )]+)/)))}if(8<=o&&10>o)var h=y.a.g.Z(),u=y.a.g.Z(),c=function(e){var t=this.activeElement;(t=t&&y.a.g.get(t,u))&&t(e)},d=function(e,t){var i=e.ownerDocument;y.a.g.get(i,h)||(y.a.g.set(i,h,!0),y.a.B(i,"selectionchange",c)),y.a.g.set(e,u,t)};y.c.textInput={init:function(t,a,l){function h(e,i){y.a.B(t,e,i)}function u(){p||(f=t.value,p=y.a.setTimeout(c,4))}function c(){clearTimeout(p),f=p=e;var i=t.value;g!==i&&(g=i,y.m.eb(a(),l,"textInput",i))}var p,f,g=t.value,m=9==y.a.W?u:c,b=!1;o&&h("keypress",c),11>o&&h("propertychange",(function(e){b||"value"!==e.propertyName||m()})),8==o&&(h("keyup",c),h("keydown",c)),d&&(d(t,m),h("dragend",u)),(!o||9<=o)&&h("input",m),5>n&&"textarea"===y.a.R(t)?(h("keydown",u),h("paste",u),h("cut",u)):11>i?h("keydown",u):4>r?(h("DOMAutoComplete",c),h("dragdrop",c),h("drop",c)):s&&"number"===t.type&&h("keydown",u),h("change",c),h("blur",c),y.o((function i(){var n=y.a.f(a());null!==n&&n!==e||(n=""),f!==e&&n===f?y.a.setTimeout(i,4):t.value!==n&&(b=!0,t.value=n,b=!1,g=t.value)}),null,{l:t})}},y.m.wa.textInput=!0,y.c.textinput={preprocess:function(e,t,i){i("textInput",e)}}}(),y.c.uniqueName={init:function(e,t){if(t()){var i="ko_unique_"+ ++y.c.uniqueName.rd;y.a.Yc(e,i)}}},y.c.uniqueName.rd=0,y.c.using={init:function(e,t,i,n,r){var o;return i.has("as")&&(o={as:i.get("as"),noChildContext:i.get("noChildContext")}),t=r.createChildContext(t,o),y.Oa(t,e),{controlsDescendantBindings:!0}}},y.h.ea.using=!0,y.c.value={init:function(t,i,n){var r=y.a.R(t),o="input"==r;if(!o||"checkbox"!=t.type&&"radio"!=t.type){var s=[],a=n.get("valueUpdate"),l=!1,h=null;a&&(s="string"==typeof a?[a]:y.a.wc(a),y.a.Pa(s,"change"));var u,c,d=function(){h=null,l=!1;var e=i(),r=y.w.M(t);y.m.eb(e,n,"value",r)};!y.a.W||!o||"text"!=t.type||"off"==t.autocomplete||t.form&&"off"==t.form.autocomplete||-1!=y.a.A(s,"propertychange")||(y.a.B(t,"propertychange",(function(){l=!0})),y.a.B(t,"focus",(function(){l=!1})),y.a.B(t,"blur",(function(){l&&d()}))),y.a.D(s,(function(e){var i=d;y.a.Ud(e,"after")&&(i=function(){h=y.w.M(t),y.a.setTimeout(d,0)},e=e.substring(5)),y.a.B(t,e,i)})),u=o&&"file"==t.type?function(){var n=y.a.f(i());null===n||n===e||""===n?t.value="":y.u.G(d)}:function(){var o=y.a.f(i()),s=y.w.M(t);null!==h&&o===h?y.a.setTimeout(u,0):o===s&&s!==e||("select"===r?(s=n.get("valueAllowUnset"),y.w.cb(t,o,s),s||o===y.w.M(t)||y.u.G(d)):y.w.cb(t,o))},"select"===r?y.i.subscribe(t,y.i.H,(function(){c?n.get("valueAllowUnset")?u():d():(y.a.B(t,"change",d),c=y.o(u,null,{l:t}))}),null,{notifyImmediately:!0}):(y.a.B(t,"change",d),y.o(u,null,{l:t}))}else y.ib(t,{checkedValue:i})},update:function(){}},y.m.wa.value=!0,y.c.visible={update:function(e,t){var i=y.a.f(t()),n="none"!=e.style.display;i&&!n?e.style.display="":!i&&n&&(e.style.display="none")}},y.c.hidden={update:function(e,t){y.c.visible.update(e,(function(){return!y.a.f(t())}))}},function(e){y.c[e]={init:function(t,i,n,r,o){return y.c.event.init.call(this,t,(function(){var t={};return t[e]=i(),t}),n,r,o)}}}("click"),y.ca=function(){},y.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},y.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},y.ca.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){var n=(t=t||i).getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new y.C.F(n)}if(1==e.nodeType||8==e.nodeType)return new y.C.ia(e);throw Error("Unknown template type: "+e)},y.ca.prototype.renderTemplate=function(e,t,i,n){return e=this.makeTemplateSource(e,n),this.renderTemplateSource(e,t,i,n)},y.ca.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},y.ca.prototype.rewriteTemplate=function(e,t,i){t=t((e=this.makeTemplateSource(e,i)).text()),e.text(t),e.data("isRewritten",!0)},y.b("templateEngine",y.ca),y.kc=function(){function e(e,t,i,n){e=y.m.ac(e);for(var r=y.m.Ra,o=0;o<e.length;o++){var s=e[o].key;if(Object.prototype.hasOwnProperty.call(r,s)){var a=r[s];if("function"==typeof a){if(s=a(e[o].value))throw Error(s)}else if(!a)throw Error("This template engine does not support the '"+s+"' binding within its templates")}}return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+y.m.vb(e,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",n.createJavaScriptEvaluatorBlock(i)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{xd:function(e,t,i){t.isTemplateRewritten(e,i)||t.rewriteTemplate(e,(function(e){return y.kc.Ld(e,t)}),i)},Ld:function(n,r){return n.replace(t,(function(t,i,n,o,s){return e(s,i,n,r)})).replace(i,(function(t,i){return e(i,"\x3c!-- ko --\x3e","#comment",r)}))},md:function(e,t){return y.aa.Xb((function(i,n){var r=i.nextSibling;r&&r.nodeName.toLowerCase()===t&&y.ib(r,e,n)}))}}}(),y.b("__tr_ambtns",y.kc.md),function(){y.C={},y.C.F=function(e){if(this.F=e){var t=y.a.R(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},y.C.F.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.F[e];var t=arguments[0];"innerHTML"===e?y.a.fc(this.F,t):this.F[e]=t};var t=y.a.g.Z()+"_";y.C.F.prototype.data=function(e){if(1===arguments.length)return y.a.g.get(this.F,t+e);y.a.g.set(this.F,t+e,arguments[1])};var i=y.a.g.Z();y.C.F.prototype.nodes=function(){var t=this.F;if(0==arguments.length){var n=y.a.g.get(t,i)||{},r=n.lb||(3===this.ab?t.content:4===this.ab?t:e);if(!r||n.jd){var o=this.text();o&&o!==n.bb&&(r=y.a.Md(o,t.ownerDocument),y.a.g.set(t,i,{lb:r,bb:o,jd:!0}))}return r}n=arguments[0],this.ab!==e&&this.text(""),y.a.g.set(t,i,{lb:n})},y.C.ia=function(e){this.F=e},y.C.ia.prototype=new y.C.F,y.C.ia.prototype.constructor=y.C.ia,y.C.ia.prototype.text=function(){if(0==arguments.length){var t=y.a.g.get(this.F,i)||{};return t.bb===e&&t.lb&&(t.bb=t.lb.innerHTML),t.bb}y.a.g.set(this.F,i,{bb:arguments[0]})},y.b("templateSources",y.C),y.b("templateSources.domElement",y.C.F),y.b("templateSources.anonymousTemplate",y.C.ia)}(),function(){function t(e,t,i){var n;for(t=y.h.nextSibling(t);e&&(n=e)!==t;)i(n,e=y.h.nextSibling(n))}function i(e,i){if(e.length){var n=e[0],r=e[e.length-1],o=n.parentNode,s=y.ga.instance,a=s.preprocessNode;if(a){if(t(n,r,(function(e,t){var i=e.previousSibling,o=a.call(s,e);o&&(e===n&&(n=o[0]||t),e===r&&(r=o[o.length-1]||i))})),e.length=0,!n)return;n===r?e.push(n):(e.push(n,r),y.a.Ua(e,o))}t(n,r,(function(e){1!==e.nodeType&&8!==e.nodeType||y.vc(i,e)})),t(n,r,(function(e){1!==e.nodeType&&8!==e.nodeType||y.aa.cd(e,[i])})),y.a.Ua(e,o)}}function n(e){return e.nodeType?e:0<e.length?e[0]:null}function r(e,t,r,o,a){a=a||{};var l=(e&&n(e)||r||{}).ownerDocument,h=a.templateEngine||s;if(y.kc.xd(r,h,l),"number"!=typeof(r=h.renderTemplate(r,o,a,l)).length||0<r.length&&"number"!=typeof r[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(l=!1,t){case"replaceChildren":y.h.va(e,r),l=!0;break;case"replaceNode":y.a.Xc(e,r),l=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return l&&(i(r,o),a.afterRender&&y.u.G(a.afterRender,null,[r,o[a.as||"$data"]]),"replaceChildren"==t&&y.i.ma(e,y.i.H)),r}function o(e,t,i){return y.O(e)?e():"function"==typeof e?e(t,i):e}var s;y.gc=function(t){if(t!=e&&!(t instanceof y.ca))throw Error("templateEngine must inherit from ko.templateEngine");s=t},y.dc=function(t,i,a,l,h){if(((a=a||{}).templateEngine||s)==e)throw Error("Set a template engine before calling renderTemplate");if(h=h||"replaceChildren",l){var u=n(l);return y.$((function(){var e=i&&i instanceof y.fa?i:new y.fa(i,null,null,null,{exportDependencies:!0}),s=o(t,e.$data,e);e=r(l,h,s,e,a),"replaceNode"==h&&(u=n(l=e))}),null,{Sa:function(){return!u||!y.a.Sb(u)},l:u&&"replaceNode"==h?u.parentNode:u})}return y.aa.Xb((function(e){y.dc(t,i,a,e,"replaceNode")}))},y.Qd=function(t,n,s,a,l){function h(e,t){y.u.G(y.a.ec,null,[a,e,c,s,u,t]),y.i.ma(a,y.i.H)}function u(e,t){i(t,d),s.afterRender&&s.afterRender(t,e),d=null}function c(e,i){d=l.createChildContext(e,{as:p,noChildContext:s.noChildContext,extend:function(e){e.$index=i,p&&(e[p+"Index"]=i)}});var n=o(t,e,d);return r(a,"ignoreTargetNode",n,d,s)}var d,p=s.as,f=!1===s.includeDestroyed||y.options.foreachHidesDestroyed&&!s.includeDestroyed;if(f||s.beforeRemove||!y.Pc(n))return y.$((function(){var t=y.a.f(n)||[];void 0===t.length&&(t=[t]),f&&(t=y.a.jb(t,(function(t){return t===e||null===t||!y.a.f(t._destroy)}))),h(t)}),null,{l:a});h(n.v());var g=n.subscribe((function(e){h(n(),e)}),null,"arrayChange");return g.l(a),g};var a=y.a.g.Z(),l=y.a.g.Z();y.c.template={init:function(e,t){var i=y.a.f(t());if("string"==typeof i||"name"in i)y.h.Ea(e);else if("nodes"in i){if(i=i.nodes||[],y.O(i))throw Error('The "nodes" option must be a plain, non-observable array.');var n=i[0]&&i[0].parentNode;n&&y.a.g.get(n,l)||(n=y.a.Yb(i),y.a.g.set(n,l,!0)),new y.C.ia(e).nodes(n)}else{if(!(0<(i=y.h.childNodes(e)).length))throw Error("Anonymous template defined, but no template content was provided");n=y.a.Yb(i),new y.C.ia(e).nodes(n)}return{controlsDescendantBindings:!0}},update:function(t,i,n,r,o){var s=i();n=!0,r=null,"string"==typeof(i=y.a.f(s))?i={}:(s="name"in i?i.name:t,"if"in i&&(n=y.a.f(i.if)),n&&"ifnot"in i&&(n=!y.a.f(i.ifnot)),n&&!s&&(n=!1)),"foreach"in i?r=y.Qd(s,n&&i.foreach||[],i,t,o):n?(n=o,"data"in i&&(n=o.createChildContext(i.data,{as:i.as,noChildContext:i.noChildContext,exportDependencies:!0})),r=y.dc(s,n,i,t)):y.h.Ea(t),o=r,(i=y.a.g.get(t,a))&&"function"==typeof i.s&&i.s(),y.a.g.set(t,a,!o||o.ja&&!o.ja()?e:o)}},y.m.Ra.template=function(e){return 1==(e=y.m.ac(e)).length&&e[0].unknown||y.m.Id(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},y.h.ea.template=!0}(),y.b("setTemplateEngine",y.gc),y.b("renderTemplate",y.dc),y.a.Kc=function(e,t,i){var n,r,o,s,a;if(e.length&&t.length)for(n=r=0;(!i||n<i)&&(s=e[r]);++r){for(o=0;a=t[o];++o)if(s.value===a.value){s.moved=a.index,a.moved=s.index,t.splice(o,1),n=o=0;break}n+=o}},y.a.Pb=function(){function e(e,t,i,n,r){var o,s,a,l,h,u=Math.min,c=Math.max,d=[],p=e.length,f=t.length,g=f-p||1,m=p+f+1;for(o=0;o<=p;o++)for(l=a,d.push(a=[]),h=u(f,o+g),s=c(0,o-1);s<=h;s++)a[s]=s?o?e[o-1]===t[s-1]?l[s-1]:u(l[s]||m,a[s-1]||m)+1:s+1:o+1;for(u=[],c=[],g=[],o=p,s=f;o||s;)f=d[o][s]-1,s&&f===d[o][s-1]?c.push(u[u.length]={status:i,value:t[--s],index:s}):o&&f===d[o-1][s]?g.push(u[u.length]={status:n,value:e[--o],index:o}):(--s,--o,r.sparse||u.push({status:"retained",value:t[s]}));return y.a.Kc(g,c,!r.dontLimitMoves&&10*p),u.reverse()}return function(t,i,n){return n="boolean"==typeof n?{dontLimitMoves:n}:n||{},i=i||[],(t=t||[]).length<i.length?e(t,i,"added","deleted",n):e(i,t,"deleted","added",n)}}(),y.b("utils.compareArrays",y.a.Pb),function(){function t(t,i,n,r,o){var s=[],a=y.$((function(){var e=i(n,o,y.a.Ua(s,t))||[];0<s.length&&(y.a.Xc(s,e),r&&y.u.G(r,null,[n,e,o])),s.length=0,y.a.Nb(s,e)}),null,{l:t,Sa:function(){return!y.a.kd(s)}});return{Y:s,$:a.ja()?a:e}}var i=y.a.g.Z(),n=y.a.g.Z();y.a.ec=function(r,o,s,a,l,h){function u(e){p={Aa:e,pb:y.ta(S++)},w.push(p),v||N.push(p)}function c(e){p=b[e],S!==p.pb.v()&&P.push(p),p.pb(S++),y.a.Ua(p.Y,r),w.push(p)}function d(e,t){if(e)for(var i=0,n=t.length;i<n;i++)y.a.D(t[i].Y,(function(n){e(n,i,t[i].Aa)}))}void 0===(o=o||[]).length&&(o=[o]),a=a||{};var p,f,g,m,b=y.a.g.get(r,i),v=!b,w=[],x=0,S=0,C=[],k=[],E=[],P=[],N=[],T=0;if(v)y.a.D(o,u);else{if(!h||b&&b._countWaitingForRemove){var I=y.a.Mb(b,(function(e){return e.Aa}));h=y.a.Pb(I,o,{dontLimitMoves:a.dontLimitMoves,sparse:!0})}var R,_,A;for(I=0;R=h[I];I++)switch(_=R.moved,A=R.index,R.status){case"deleted":for(;x<A;)c(x++);_===e&&((p=b[x]).$&&(p.$.s(),p.$=e),y.a.Ua(p.Y,r).length&&(a.beforeRemove&&(w.push(p),T++,p.Aa===n?p=null:E.push(p)),p&&C.push.apply(C,p.Y))),x++;break;case"added":for(;S<A;)c(x++);_!==e?(k.push(w.length),c(_)):u(R.value)}for(;S<o.length;)c(x++);w._countWaitingForRemove=T}y.a.g.set(r,i,w),d(a.beforeMove,P),y.a.D(C,a.beforeRemove?y.oa:y.removeNode);try{m=r.ownerDocument.activeElement}catch(e){}if(k.length)for(;(I=k.shift())!=e;){for(p=w[I],f=e;I;)if((g=w[--I].Y)&&g.length){f=g[g.length-1];break}for(o=0;x=p.Y[o];f=x,o++)y.h.Wb(r,x,f)}for(I=0;p=w[I];I++){for(p.Y||y.a.extend(p,t(r,s,p.Aa,l,p.pb)),o=0;x=p.Y[o];f=x,o++)y.h.Wb(r,x,f);!p.Ed&&l&&(l(p.Aa,p.Y,p.pb),p.Ed=!0,f=p.Y[p.Y.length-1])}for(m&&r.ownerDocument.activeElement!=m&&m.focus(),d(a.beforeRemove,E),I=0;I<E.length;++I)E[I].Aa=n;d(a.afterMove,P),d(a.afterAdd,N)}}(),y.b("utils.setDomNodeChildrenFromArrayMapping",y.a.ec),y.ba=function(){this.allowTemplateRewriting=!1},y.ba.prototype=new y.ca,y.ba.prototype.constructor=y.ba,y.ba.prototype.renderTemplateSource=function(e,t,i,n){return(t=9>y.a.W||!e.nodes?null:e.nodes())?y.a.la(t.cloneNode(!0).childNodes):(e=e.text(),y.a.ua(e,n))},y.ba.Ma=new y.ba,y.gc(y.ba.Ma),y.b("nativeTemplateEngine",y.ba),function(){y.$a=function(){var e=this.Hd=function(){if(!s||!s.tmpl)return 0;try{if(0<=s.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,r,o){if(o=o||i,r=r||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=s.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[n.$data],n=s.extend({koBindingContext:n},r.templateOptions),(n=s.tmpl(a,t,n)).appendTo(o.createElement("div")),s.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){i.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<e&&(s.tmpl.tag.ko_code={open:"__.push($1 || '');"},s.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},y.$a.prototype=new y.ca,y.$a.prototype.constructor=y.$a;var e=new y.$a;0<e.Hd&&y.gc(e),y.b("jqueryTmplTemplateEngine",y.$a)}()}))}()),n.exports),a=t(s);function l(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var h,u={exports:{}};var c,d,p=(h||(h=1,function(e){e.exports=function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){if(!a&&l)return l(s);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,(function(e){var i=t[s][1][e];return r(i||e)}),u,u.exports,e,t,i,n)}return i[s].exports}for(var o=l,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){!function(){var i,n,r;i=void 0!==e?e("i18next"):window.i18n;var o={init:function(e,t,i,r,a){n.utils.domNodeDisposal.addDisposeCallback(e,(function(){var t=s._koElements.indexOf(e);t>=0&&(s._koElements.splice(t,1),s._koCallbacks.splice(t,1))})),s._koElements.push(e),s._koCallbacks.push(n.bindingHandlers.i18n.update.bind(void 0,e,t,i,r,a)),o.update(e,t,i,r,a)},update:function(e,t,r,o,s){var a=n.toJS(t());if("string"==typeof a)e.innerHTML=i.t(a);else if(a.key)e.innerHTML=i.t(a.key,a.options);else for(var l in a){var h,u=a[l];if(h="string"==typeof u?i.t(u):i.t(u.key,n.toJS(u.options)),"html"==l)e.innerHTML=h;else{var c=document.createElement("div");c.innerHTML=h,e.setAttribute(l,c.innerText)}}}},s={_koElements:[],_koCallbacks:[],setLanguage:function(e){i.setLng(e),s._language(e),s._koCallbacks.forEach((function(e){return e.call(void 0)})),void 0!==r&&void 0!==r.fn.i18n&&r("html").i18n()},init:function(e,t,a,l){n=a||window.ko,r=l||window.$,i.init({compatibilityAPI:"v1",lng:t||"en",resStore:e}),n.bindingHandlers.i18n=o,s._language=n.observable(t),s.setLanguage(t)},t:function(){var e=arguments;return n.computed((function(){return s._language(),i.t.apply(i,e)}))},i18n:i};void 0!==t?t.exports=s:window.i18nextko=s}()},{i18next:17}],2:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=function(){function e(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=l(e("./utils")),s=a(e("./logger"));function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function h(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):h(e,t))}function p(e,t){for(var i=e.indexOf(t);-1!==i;)e.splice(i,1),i=e.indexOf(t)}var f=function(e){function t(i,n,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];u(this,t);var a=c(this,e.call(this));return a.backend=i,a.store=n,a.services=r,a.options=o,a.logger=s.default.create("backendConnector"),a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(r,o.backend,o),a}return d(t,e),t.prototype.queueLoad=function(e,t,i){var n=this,r=[],o=[],s=[],a=[];return e.forEach((function(e){var i=!0;t.forEach((function(t){var s=e+"|"+t;n.store.hasResourceBundle(e,t)?n.state[s]=2:n.state[s]<0||(1===n.state[s]?o.indexOf(s)<0&&o.push(s):(n.state[s]=1,i=!1,o.indexOf(s)<0&&o.push(s),r.indexOf(s)<0&&r.push(s),a.indexOf(t)<0&&a.push(t)))})),i||s.push(e)})),(r.length||o.length)&&this.queue.push({pending:o,loaded:{},errors:[],callback:i}),{toLoad:r,pending:o,toLoadLanguages:s,toLoadNamespaces:a}},t.prototype.loaded=function(e,t,i){var n=this,s=e.split("|"),a=r(s,2),l=a[0],h=a[1];t&&this.emit("failedLoading",l,h,t),i&&this.store.addResourceBundle(l,h,i),this.state[e]=t?-1:2,this.queue.forEach((function(i){o.pushPath(i.loaded,[l],h),p(i.pending,e),t&&i.errors.push(t),0!==i.pending.length||i.done||(i.errors.length?i.callback(i.errors):i.callback(),n.emit("loaded",i.loaded),i.done=!0)})),this.queue=this.queue.filter((function(e){return!e.done}))},t.prototype.read=function(e,t,i,n,r,o){var s=this;if(n||(n=0),r||(r=250),!e.length)return o(null,{});this.backend[i](e,t,(function(a,l){a&&l&&n<5?setTimeout((function(){s.read.call(s,e,t,i,++n,2*r,o)}),r):o(a,l)}))},t.prototype.load=function(e,t,i){var s=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();var a=n({},this.backend.options,this.options.backend);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var l,h=this.queueLoad(e,t,i);h.toLoad.length?a.allowMultiLoading&&this.backend.readMulti?this.read(h.toLoadLanguages,h.toLoadNamespaces,"readMulti",null,null,(function(e,t){e&&s.logger.warn("loading namespaces "+h.toLoadNamespaces.join(", ")+" for languages "+h.toLoadLanguages.join(", ")+" via multiloading failed",e),!e&&t&&s.logger.log("loaded namespaces "+h.toLoadNamespaces.join(", ")+" for languages "+h.toLoadLanguages.join(", ")+" via multiloading",t),h.toLoad.forEach((function(i){var n=i.split("|"),a=r(n,2),l=a[0],h=a[1],u=o.getPath(t,[l,h]);if(u)s.loaded(i,e,u);else{var c="loading namespace "+h+" for language "+l+" via multiloading failed";s.loaded(i,c),s.logger.error(c)}}))})):(l=function(e){var t=this,i=e.split("|"),n=r(i,2),o=n[0],s=n[1];this.read(o,s,"read",null,null,(function(i,n){i&&t.logger.warn("loading namespace "+s+" for language "+o+" failed",i),!i&&n&&t.logger.log("loaded namespace "+s+" for language "+o,n),t.loaded(e,i,n)}))},h.toLoad.forEach((function(e){l.call(s,e)}))):h.pending.length||i()},t.prototype.reload=function(e,t){var i=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var s,a=n({},this.backend.options,this.options.backend);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]),a.allowMultiLoading&&this.backend.readMulti?this.read(e,t,"readMulti",null,null,(function(n,r){n&&i.logger.warn("reloading namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading failed",n),!n&&r&&i.logger.log("reloaded namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading",r),e.forEach((function(e){t.forEach((function(t){var s=o.getPath(r,[e,t]);if(s)i.loaded(e+"|"+t,n,s);else{var a="reloading namespace "+t+" for language "+e+" via multiloading failed";i.loaded(e+"|"+t,a),i.logger.error(a)}}))}))})):(s=function(e){var t=this,i=e.split("|"),n=r(i,2),o=n[0],s=n[1];this.read(o,s,"read",null,null,(function(i,n){i&&t.logger.warn("reloading namespace "+s+" for language "+o+" failed",i),!i&&n&&t.logger.log("reloaded namespace "+s+" for language "+o,n),t.loaded(e,i,n)}))},e.forEach((function(e){t.forEach((function(t){s.call(i,e+"|"+t)}))})))},t.prototype.saveMissing=function(e,t,i,n){this.backend&&this.backend.create&&this.backend.create(e,t,i,n),e&&e[0]&&this.store.addResource(e[0],t,i,n)},t}(a(e("./EventEmitter")).default);i.default=f},{"./EventEmitter":4,"./logger":14,"./utils":16}],3:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};s(e("./utils"));var r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):a(e,t))}var c=function(e){function t(i,n,o){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];l(this,t);var a=h(this,e.call(this));return a.cache=i,a.store=n,a.services=o,a.options=s,a.logger=r.default.create("cacheConnector"),a.cache&&a.cache.init&&a.cache.init(o,s.cache,s),a}return u(t,e),t.prototype.load=function(e,t,i){var r=this;if(!this.cache)return i&&i();var o=n({},this.cache.options,this.options.cache);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),o.enabled?this.cache.load(e,(function(t,n){if(t&&r.logger.error("loading languages "+e.join(", ")+" from cache failed",t),n)for(var o in n)for(var s in n[o])if("i18nStamp"!==s){var a=n[o][s];a&&r.store.addResourceBundle(o,s,a)}i&&i()})):i&&i()},t.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},t}(o(e("./EventEmitter")).default);i.default=c},{"./EventEmitter":4,"./logger":14,"./utils":16}],4:[function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(){n(this,e),this.observers={}}return e.prototype.on=function(e,t){var i=this;e.split(" ").forEach((function(e){i.observers[e]=i.observers[e]||[],i.observers[e].push(t)}))},e.prototype.off=function(e,t){var i=this;this.observers[e]&&this.observers[e].forEach((function(){if(t){var n=i.observers[e].indexOf(t);n>-1&&i.observers[e].splice(n,1)}else delete i.observers[e]}))},e.prototype.emit=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.observers[e]&&this.observers[e].forEach((function(e){e.apply(void 0,i)})),this.observers["*"]&&this.observers["*"].forEach((function(t){var n;t.apply(t,(n=[e]).concat.apply(n,i))}))},e}();i.default=r},{}],5:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=s(e("./utils")),r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,e),this.logger=r.default.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];arguments[1]&&(this.options=e,this.format=e.interpolation&&e.interpolation.format||function(e){return e}),e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escapeValue=t.escapeValue,this.prefix=t.prefix?n.regexEscape(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?n.regexEscape(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?n.regexEscape(t.formatSeparator):t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?n.regexEscape(t.nestingPrefix):t.nestingPrefixEscaped||n.regexEscape("$t("),this.nestingSuffix=t.nestingSuffix?n.regexEscape(t.nestingSuffix):t.nestingSuffixEscaped||n.regexEscape(")"),this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var e=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(e,"g");var t=this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(t,"g");var i=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(i,"g")},e.prototype.interpolate=function(e,t,i){var r=this,o=void 0,s=void 0;function a(e){return e.replace(/\$/g,"$$$$")}var l=function(e){if(e.indexOf(r.formatSeparator)<0)return n.getPath(t,e);var o=e.split(r.formatSeparator),s=o.shift().trim(),a=o.join(r.formatSeparator).trim();return r.format(n.getPath(t,s),a,i)};for(this.resetRegExp();o=this.regexpUnescape.exec(e);){var h=l(o[1].trim());e=e.replace(o[0],h),this.regexpUnescape.lastIndex=0}for(;o=this.regexp.exec(e);)"string"!=typeof(s=l(o[1].trim()))&&(s=n.makeString(s)),s||(this.logger.warn("missed to pass in variable "+o[1]+" for interpolating "+e),s=""),s=this.escapeValue?a(n.escape(s)):a(s),e=e.replace(o[0],s),this.regexp.lastIndex=0;return e},e.prototype.nest=function(e,t){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=void 0,o=void 0,s=JSON.parse(JSON.stringify(i));function a(e){return e.replace(/\$/g,"$$$$")}function l(e){if(e.indexOf(",")<0)return e;var t=e.split(",");e=t.shift();var i=t.join(",");i=this.interpolate(i,s);try{s=JSON.parse(i)}catch(t){this.logger.error("failed parsing options string in nesting for key "+e,t)}return e}for(s.applyPostProcessor=!1;r=this.nestingRegexp.exec(e);)"string"!=typeof(o=t(l.call(this,r[1].trim()),s))&&(o=n.makeString(o)),o||(this.logger.warn("missed to pass in variable "+r[1]+" for interpolating "+e),o=""),o=this.escapeValue?a(n.escape(o)):a(o),e=e.replace(r[0],o),this.regexp.lastIndex=0;return e},e}();i.default=l},{"./logger":14,"./utils":16}],6:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=r(e("./logger"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}var a=function(){function e(t){o(this,e),this.options=t,this.whitelist=this.options.whitelist||!1,this.logger=n.default.create("languageUtils")}return e.prototype.getLanguagePartFromCode=function(e){if(e.indexOf("-")<0)return e;var t=["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"],i=e.split("-");return this.formatLanguageCode(t.indexOf(e)>-1?i[1].toLowerCase():i[0])},e.prototype.formatLanguageCode=function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],i=e.split("-");return this.options.lowerCaseLng?i=i.map((function(e){return e.toLowerCase()})):2===i.length?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=s(i[1].toLowerCase()))):3===i.length&&(i[0]=i[0].toLowerCase(),2===i[1].length&&(i[1]=i[1].toUpperCase()),"sgn"!==i[0]&&2===i[2].length&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=s(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=s(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e},e.prototype.isWhitelisted=function(e,t){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist&&!t)&&(e=this.getLanguagePartFromCode(e)),!this.whitelist||!this.whitelist.length||this.whitelist.indexOf(e)>-1},e.prototype.toResolveHierarchy=function(e,t){var i=this;"string"==typeof(t=t||this.options.fallbackLng||[])&&(t=[t]);var n=[],r=function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];i.isWhitelisted(e,t)?n.push(e):i.logger.warn("rejecting non-whitelisted language code: "+e)};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e),!0),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):"string"==typeof e&&r(this.formatLanguageCode(e)),t.forEach((function(e){n.indexOf(e)<0&&r(i.formatLanguageCode(e))})),n},e}();i.default=a},{"./logger":14}],7:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","es_ar","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt","pt_br","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],l={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}};function h(){var e={};return a.forEach((function(t){t.lngs.forEach((function(i){return e[i]={numbers:t.nr,plurals:l[t.fc]}}))})),e}var u=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];s(this,e),this.languageUtils=t,this.options=i,this.logger=r.default.create("pluralResolver"),this.rules=h()}return e.prototype.addRule=function(e,t){this.rules[e]=t},e.prototype.getRule=function(e){return this.rules[this.languageUtils.getLanguagePartFromCode(e)]},e.prototype.needsPlural=function(e){var t=this.getRule(e);return!(t&&t.numbers.length<=1)},e.prototype.getSuffix=function(e,t){var i=this,r=this.getRule(e);if(!r)return this.logger.warn("no plural rule found for: "+e),"";var o=function(){if(1===r.numbers.length)return{v:""};var e=r.noAbs?r.plurals(t):r.plurals(Math.abs(t)),n=r.numbers[e];2===r.numbers.length&&1===r.numbers[0]&&(2===n?n="plural":1===n&&(n=""));var o=function(){return i.options.prepend&&n.toString()?i.options.prepend+n.toString():n.toString()};return"v1"===i.options.compatibilityJSON?1===n?{v:""}:"number"==typeof n?{v:"_plural_"+n.toString()}:{v:o()}:"v2"===i.options.compatibilityJSON||2===r.numbers.length&&1===r.numbers[0]||2===r.numbers.length&&1===r.numbers[0]?{v:o()}:{v:i.options.prepend&&e.toString()?i.options.prepend+e.toString():e.toString()}}();return"object"===(void 0===o?"undefined":n(o))?o.v:void 0},e}();i.default=u},{"./logger":14}],8:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=a(e("./EventEmitter")),o=s(e("./utils"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):l(e,t))}var d=function(e){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?{ns:["translation"],defaultNS:"translation"}:arguments[1];h(this,t);var r=u(this,e.call(this));return r.data=i,r.options=n,r}return c(t,e),t.prototype.addNamespaces=function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)},t.prototype.removeNamespaces=function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)},t.prototype.getResource=function(e,t,i){var n=(arguments.length<=3||void 0===arguments[3]?{}:arguments[3]).keySeparator||this.options.keySeparator;void 0===n&&(n=".");var r=[e,t];return i&&"string"!=typeof i&&(r=r.concat(i)),i&&"string"==typeof i&&(r=r.concat(n?i.split(n):i)),e.indexOf(".")>-1&&(r=e.split(".")),o.getPath(this.data,r)},t.prototype.addResource=function(e,t,i,n){var r=arguments.length<=4||void 0===arguments[4]?{silent:!1}:arguments[4],s=this.options.keySeparator;void 0===s&&(s=".");var a=[e,t];i&&(a=a.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(n=t,t=(a=e.split("."))[1]),this.addNamespaces(t),o.setPath(this.data,a,n),r.silent||this.emit("added",e,t,i,n)},t.prototype.addResources=function(e,t,i){for(var n in i)"string"==typeof i[n]&&this.addResource(e,t,n,i[n],{silent:!0});this.emit("added",e,t,i)},t.prototype.addResourceBundle=function(e,t,i,r,s){var a=[e,t];e.indexOf(".")>-1&&(r=i,i=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var l=o.getPath(this.data,a)||{};r?o.deepExtend(l,i,s):l=n({},l,i),o.setPath(this.data,a,l),this.emit("added",e,t,i)},t.prototype.removeResourceBundle=function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)},t.prototype.hasResourceBundle=function(e,t){return void 0!==this.getResource(e,t)},t.prototype.getResourceBundle=function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?n({},this.getResource(e,t)):this.getResource(e,t)},t.prototype.toJSON=function(){return this.data},t}(r.default);i.default=d},{"./EventEmitter":4,"./utils":16}],9:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=c(e("./logger")),s=c(e("./EventEmitter")),a=c(e("./postProcessor")),l=u(e("./compatibility/v1")),h=u(e("./utils"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):d(e,t))}var m=function(e){function t(i){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];p(this,t);var r=f(this,e.call(this));return h.copy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"],i,r),r.options=n,r.logger=o.default.create("translator"),r}return g(t,e),t.prototype.changeLanguage=function(e){e&&(this.language=e)},t.prototype.exists=function(e){var t=arguments.length<=1||void 0===arguments[1]?{interpolation:{}}:arguments[1];return"v1"===this.options.compatibilityAPI&&(t=l.convertTOptions(t)),void 0!==this.resolve(e,t)},t.prototype.extractFromKey=function(e,t){var i=t.nsSeparator||this.options.nsSeparator;void 0===i&&(i=":");var n=t.ns||this.options.defaultNS;if(i&&e.indexOf(i)>-1){var r=e.split(i);n=r[0],e=r[1]}return"string"==typeof n&&(n=[n]),{key:e,namespaces:n}},t.prototype.translate=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==(void 0===t?"undefined":r(t))?t=this.options.overloadTranslationOptionHandler(arguments):"v1"===this.options.compatibilityAPI&&(t=l.convertTOptions(t)),null==e||""===e)return"";"number"==typeof e&&(e=String(e)),"string"==typeof e&&(e=[e]);var i=t.lng||this.language;if(i&&"cimode"===i.toLowerCase())return e[e.length-1];var o=t.keySeparator||this.options.keySeparator||".",s=this.extractFromKey(e[e.length-1],t),a=s.key,h=s.namespaces,u=h[h.length-1],c=this.resolve(e,t),d=Object.prototype.toString.apply(c),p=["[object Number]","[object Function]","[object RegExp]"],f=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays;if(c&&"string"!=typeof c&&p.indexOf(d)<0&&(!f||"[object Array]"!==d)){if(!t.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(a,c,t):"key '"+a+" ("+this.language+")' returned an object instead of string.";var g="[object Array]"===d?[]:{};for(var m in c)g[m]=this.translate(""+a+o+m,n({joinArrays:!1,ns:h},t));c=g}else if(f&&"[object Array]"===d)(c=c.join(f))&&(c=this.extendTranslation(c,a,t));else{var b=!1,v=!1;if(this.isValidLookup(c)||void 0===t.defaultValue||(b=!0,c=t.defaultValue),this.isValidLookup(c)||(v=!0,c=a),v||b){this.logger.log("missingKey",i,u,a,c);var w=[];if("fallback"===this.options.saveMissingTo&&this.options.fallbackLng&&this.options.fallbackLng[0])for(var y=0;y<this.options.fallbackLng.length;y++)w.push(this.options.fallbackLng[y]);else"all"===this.options.saveMissingTo?w=this.languageUtils.toResolveHierarchy(t.lng||this.language):w.push(t.lng||this.language);this.options.saveMissing&&(this.options.missingKeyHandler?this.options.missingKeyHandler(w,u,a,c):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(w,u,a,c)),this.emit("missingKey",w,u,a,c)}c=this.extendTranslation(c,a,t),v&&c===a&&this.options.appendNamespaceToMissingKey&&(c=u+":"+a),v&&this.options.parseMissingKeyHandler&&(c=this.options.parseMissingKeyHandler(c))}return c},t.prototype.extendTranslation=function(e,t,i){var r=this;i.interpolation&&this.interpolator.init(i);var o=i.replace&&"string"!=typeof i.replace?i.replace:i;this.options.interpolation.defaultVariables&&(o=n({},this.options.interpolation.defaultVariables,o)),e=this.interpolator.interpolate(e,o,this.language),e=this.interpolator.nest(e,(function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.translate.apply(r,t)}),i),i.interpolation&&this.interpolator.reset();var s=i.postProcess||this.options.postProcess,l="string"==typeof s?[s]:s;return void 0!==e&&l&&l.length&&!1!==i.applyPostProcessor&&(e=a.default.handle(l,e,t,i,this)),e},t.prototype.resolve=function(e){var t=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=void 0;return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!t.isValidLookup(n)){var r=t.extractFromKey(e,i),o=r.key,s=r.namespaces;t.options.fallbackNS&&(s=s.concat(t.options.fallbackNS));var a=void 0!==i.count&&"string"!=typeof i.count,l=void 0!==i.context&&"string"==typeof i.context&&""!==i.context,h=i.lngs?i.lngs:t.languageUtils.toResolveHierarchy(i.lng||t.language);s.forEach((function(e){t.isValidLookup(n)||h.forEach((function(r){if(!t.isValidLookup(n)){var s=o,h=[s],u=void 0;a&&(u=t.pluralResolver.getSuffix(r,i.count)),a&&l&&h.push(s+u),l&&h.push(s+=""+t.options.contextSeparator+i.context),a&&h.push(s+=u);for(var c=void 0;c=h.pop();)t.isValidLookup(n)||(n=t.getResource(r,e,c,i))}}))}))}})),n},t.prototype.isValidLookup=function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)},t.prototype.getResource=function(e,t,i){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return this.resourceStore.getResource(e,t,i,n)},t}(s.default);i.default=m},{"./EventEmitter":4,"./compatibility/v1":10,"./logger":14,"./postProcessor":15,"./utils":16}],10:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertAPIOptions=s,i.convertJSONOptions=a,i.convertTOptions=l,i.appendBackwardsAPI=h;var n=r(e("../logger"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return e.interpolation={unescapeSuffix:"HTML"},e.interpolation.prefix=e.interpolationPrefix||"__",e.interpolation.suffix=e.interpolationSuffix||"__",e.interpolation.escapeValue=e.escapeInterpolation||!1,e.interpolation.nestingPrefix=e.reusePrefix||"$t(",e.interpolation.nestingSuffix=e.reuseSuffix||")",e}function s(e){return e.resStore&&(e.resources=e.resStore),e.ns&&e.ns.defaultNs?(e.defaultNS=e.ns.defaultNs,e.ns=e.ns.namespaces):e.defaultNS=e.ns||"translation",e.fallbackToDefaultNS&&e.defaultNS&&(e.fallbackNS=e.defaultNS),e.saveMissing=e.sendMissing,e.saveMissingTo=e.sendMissingTo||"current",e.returnNull=!e.fallbackOnNull,e.returnEmptyString=!e.fallbackOnEmpty,e.returnObjects=e.returnObjectTrees,e.joinArrays="\n",e.returnedObjectHandler=e.objectTreeKeyHandler,e.parseMissingKeyHandler=e.parseMissingKey,e.appendNamespaceToMissingKey=!0,e.nsSeparator=e.nsseparator,e.keySeparator=e.keyseparator,"sprintf"===e.shortcutFunction&&(e.overloadTranslationOptionHandler=function(e){for(var t=[],i=1;i<e.length;i++)t.push(e[i]);return{postProcess:"sprintf",sprintf:t}}),e.whitelist=e.lngWhitelist,e.preload=e.preload,"current"===e.load&&(e.load="currentOnly"),"unspecific"===e.load&&(e.load="languageOnly"),e.backend=e.backend||{},e.backend.loadPath=e.resGetPath||"locales/__lng__/__ns__.json",e.backend.addPath=e.resPostPath||"locales/add/__lng__/__ns__",e.backend.allowMultiLoading=e.dynamicLoad,e.cache=e.cache||{},e.cache.prefix="res_",e.cache.expirationTime=6048e5,e.cache.enabled=!!e.useLocalStorage,(e=o(e)).defaultVariables&&(e.interpolation.defaultVariables=e.defaultVariables),e}function a(e){return(e=o(e)).joinArrays="\n",e}function l(e){return(e.interpolationPrefix||e.interpolationSuffix||e.escapeInterpolation)&&(e=o(e)),e.nsSeparator=e.nsseparator,e.keySeparator=e.keyseparator,e.returnObjects=e.returnObjectTrees,e}function h(e){e.lng=function(){return n.default.deprecate("i18next.lng() can be replaced by i18next.language for detected language or i18next.languages for languages ordered by translation lookup."),e.services.languageUtils.toResolveHierarchy(e.language)[0]},e.preload=function(t,i){n.default.deprecate("i18next.preload() can be replaced with i18next.loadLanguages()"),e.loadLanguages(t,i)},e.setLng=function(t,i,r){if(n.default.deprecate("i18next.setLng() can be replaced with i18next.changeLanguage() or i18next.getFixedT() to get a translation function with fixed language or namespace."),"function"==typeof i&&(r=i,i={}),i||(i={}),!0===i.fixLng&&r)return r(null,e.getFixedT(t));e.changeLanguage(t,r)},e.addPostProcessor=function(t,i){n.default.deprecate("i18next.addPostProcessor() can be replaced by i18next.use({ type: 'postProcessor', name: 'name', process: fc })"),e.use({type:"postProcessor",name:t,process:i})}}},{"../logger":14}],11:[function(e,t,i){function n(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(e){return{defaultValue:e[1]}},interpolation:{escapeValue:!0,format:function(e,t,i){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}}}function r(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&e.whitelist.indexOf("cimode")<0&&e.whitelist.push("cimode"),e}Object.defineProperty(i,"__esModule",{value:!0}),i.get=n,i.transformOptions=r},{}],12:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o=v(e("./logger")),s=v(e("./EventEmitter")),a=v(e("./ResourceStore")),l=v(e("./Translator")),h=v(e("./LanguageUtils")),u=v(e("./PluralResolver")),c=v(e("./Interpolator")),d=v(e("./BackendConnector")),p=v(e("./CacheConnector")),f=e("./defaults"),g=v(e("./postProcessor")),m=b(e("./compatibility/v1"));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}function w(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):w(e,t))}var C=function(e){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];y(this,t);var r=x(this,e.call(this));return r.options=(0,f.transformOptions)(i),r.services={},r.logger=o.default,r.modules={},n&&!r.isInitialized&&r.init(i,n),r}return S(t,e),t.prototype.init=function(e,t){var i=this;function n(e){if(e)return"function"==typeof e?new e:e}if("function"==typeof e&&(t=e,e={}),e||(e={}),"v1"===e.compatibilityAPI?this.options=r({},(0,f.get)(),(0,f.transformOptions)(m.convertAPIOptions(e)),{}):"v1"===e.compatibilityJSON?this.options=r({},(0,f.get)(),(0,f.transformOptions)(m.convertJSONOptions(e)),{}):this.options=r({},(0,f.get)(),this.options,(0,f.transformOptions)(e)),t||(t=function(){}),!this.options.isClone){this.modules.logger?o.default.init(n(this.modules.logger),this.options):o.default.init(null,this.options);var s=new h.default(this.options);this.store=new a.default(this.options.resources,this.options);var g=this.services;g.logger=o.default,g.resourceStore=this.store,g.resourceStore.on("added removed",(function(e,t){g.cacheConnector.save()})),g.languageUtils=s,g.pluralResolver=new u.default(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON}),g.interpolator=new c.default(this.options),g.backendConnector=new d.default(n(this.modules.backend),g.resourceStore,g,this.options),g.backendConnector.on("*",(function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))})),g.backendConnector.on("loaded",(function(e){g.cacheConnector.save()})),g.cacheConnector=new p.default(n(this.modules.cache),g.resourceStore,g,this.options),g.cacheConnector.on("*",(function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))})),this.modules.languageDetector&&(g.languageDetector=n(this.modules.languageDetector),g.languageDetector.init(g,this.options.detection,this.options)),this.translator=new l.default(this.services,this.options),this.translator.on("*",(function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))}))}["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"].forEach((function(e){i[e]=function(){return this.store[e].apply(this.store,arguments)}})),"v1"===this.options.compatibilityAPI&&m.appendBackwardsAPI(this);var b=function(){i.changeLanguage(i.options.lng,(function(e,n){i.emit("initialized",i.options),i.logger.log("initialized",i.options),t(e,n)}))};return this.options.resources||!this.options.initImmediate?b():setTimeout(b,0),this},t.prototype.loadResources=function(e){var t=this;if(e||(e=function(){}),this.options.resources)e(null);else{var i=function(){if(t.language&&"cimode"===t.language.toLowerCase())return{v:e()};var i=[],n=function(e){t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};n(t.language),t.options.preload&&t.options.preload.forEach((function(e){n(e)})),t.services.cacheConnector.load(i,t.options.ns,(function(){t.services.backendConnector.load(i,t.options.ns,e)}))}();if("object"===(void 0===i?"undefined":n(i)))return i.v}},t.prototype.reloadResources=function(e,t){e||(e=this.languages),t||(t=this.options.ns),this.services.backendConnector.reload(e,t)},t.prototype.use=function(e){return"backend"===e.type&&(this.modules.backend=e),"cache"===e.type&&(this.modules.cache=e),("logger"===e.type||e.log&&e.warn&&e.warn)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"postProcessor"===e.type&&g.default.addPostProcessor(e),this},t.prototype.changeLanguage=function(e,t){var i=this,n=function(n){e&&(i.emit("languageChanged",e),i.logger.log("languageChanged",e)),t&&t(n,(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.t.apply(i,t)}))};!e&&this.services.languageDetector&&(e=this.services.languageDetector.detect()),e&&(this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.translator.changeLanguage(e),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage(e)),this.loadResources((function(e){n(e)}))},t.prototype.getFixedT=function(e,t){var i=this,n=function e(t,n){return(n=n||{}).lng=n.lng||e.lng,n.ns=n.ns||e.ns,i.t(t,n)};return n.lng=e,n.ns=t,n},t.prototype.t=function(){return this.translator&&this.translator.translate.apply(this.translator,arguments)},t.prototype.exists=function(){return this.translator&&this.translator.exists.apply(this.translator,arguments)},t.prototype.setDefaultNamespace=function(e){this.options.defaultNS=e},t.prototype.loadNamespaces=function(e,t){var i=this;if(!this.options.ns)return t&&t();"string"==typeof e&&(e=[e]),e.forEach((function(e){i.options.ns.indexOf(e)<0&&i.options.ns.push(e)})),this.loadResources(t)},t.prototype.loadLanguages=function(e,t){"string"==typeof e&&(e=[e]);var i=this.options.preload||[],n=e.filter((function(e){return i.indexOf(e)<0}));if(!n.length)return t();this.options.preload=i.concat(n),this.loadResources(t)},t.prototype.dir=function(e){return e||(e=this.language),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr":"rtl"},t.prototype.createInstance=function(){return new t(arguments.length<=0||void 0===arguments[0]?{}:arguments[0],arguments[1])},t.prototype.cloneInstance=function(){var e=this,i=arguments[1],n=new t(r({},arguments.length<=0||void 0===arguments[0]?{}:arguments[0],this.options,{isClone:!0}),i);return["store","translator","services","language"].forEach((function(t){n[t]=e[t]})),n},t}(s.default);i.default=new C},{"./BackendConnector":2,"./CacheConnector":3,"./EventEmitter":4,"./Interpolator":5,"./LanguageUtils":6,"./PluralResolver":7,"./ResourceStore":8,"./Translator":9,"./compatibility/v1":10,"./defaults":11,"./logger":14,"./postProcessor":15}],13:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=r(e("./i18next"));function r(e){return e&&e.__esModule?e:{default:e}}i.default=n.default},{"./i18next":12}],14:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={type:"logger",log:function(e){this._output("log",e)},warn:function(e){this._output("warn",e)},error:function(e){this._output("error",e)},_output:function(e,t){console&&console[e]&&console[e].apply(console,Array.prototype.slice.call(t))}},s=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e),this.subs=[],this.init(t,i)}return e.prototype.init=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.prefix=t.prefix||"i18next:",this.logger=e||o,this.options=t,this.debug=!1!==t.debug},e.prototype.setDebug=function(e){this.debug=e,this.subs.forEach((function(t){t.setDebug(e)}))},e.prototype.log=function(){this.forward(arguments,"log","",!0)},e.prototype.warn=function(){this.forward(arguments,"warn","",!0)},e.prototype.error=function(){this.forward(arguments,"error","")},e.prototype.deprecate=function(){this.forward(arguments,"warn","WARNING DEPRECATED: ",!0)},e.prototype.forward=function(e,t,i,n){n&&!this.debug||("string"==typeof e[0]&&(e[0]=i+this.prefix+" "+e[0]),this.logger[t](e))},e.prototype.create=function(t){var i=new e(this.logger,n({prefix:this.prefix+":"+t+":"},this.options));return this.subs.push(i),i},e}();i.default=new s},{}],15:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,i,n,r){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,i,n,r))})),t}}},{}],16:[function(e,t,i){function n(e){return null==e?"":""+e}function r(e,t,i){e.forEach((function(e){t[e]&&(i[e]=t[e])}))}function o(e,t,i){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}for(var r="string"!=typeof t?[].concat(t):t.split(".");r.length>1;){if(!e)return{};var o=n(r.shift());!e[o]&&i&&(e[o]=new i),e=e[o]}return e?{obj:e,k:n(r.shift())}:{}}function s(e,t,i){var n=o(e,t,Object);n.obj[n.k]=i}function a(e,t,i,n){var r=o(e,t,Object),s=r.obj,a=r.k;s[a]=s[a]||[],n&&(s[a]=s[a].concat(i)),n||s[a].push(i)}function l(e,t){var i=o(e,t),n=i.obj,r=i.k;if(n)return n[r]}function h(e,t,i){for(var n in t)n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?i&&(e[n]=t[n]):h(e[n],t[n],i):e[n]=t[n];return e}function u(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}Object.defineProperty(i,"__esModule",{value:!0}),i.makeString=n,i.copy=r,i.setPath=s,i.pushPath=a,i.getPath=l,i.deepExtend=h,i.regexEscape=u,i.escape=d;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function d(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return c[e]})):e}},{}],17:[function(e,t,i){t.exports=e("./dist/commonjs/index.js").default},{"./dist/commonjs/index.js":13}]},{},[1])(1)}(u)),u.exports),f=t(p);var g,m=function(){if(d)return c;d=1;var e,t=Object.create,i=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,a=(e,t,o,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of r(t))!s.call(e,l)&&l!==o&&i(e,l,{get:()=>t[l],enumerable:!(a=n(t,l))||a.enumerable});return e},l=(e,t,n)=>((e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),h=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))(((e,t)=>{var i=-1;function n(e,t,f,g,m){if(e===t)return e?[[0,e]]:[];if(null!=f){var b=function(e,t,i){var n="number"==typeof i?{index:i,length:0}:i.oldRange,r="number"==typeof i?null:i.newRange,o=e.length,s=t.length;if(0===n.length&&(null===r||0===r.length)){var a=n.index,l=e.slice(0,a),h=e.slice(a),u=r?r.index:null,c=a+s-o;if(!(null!==u&&u!==c||c<0||c>s)){var d=t.slice(0,c);if((g=t.slice(c))===h){var p=Math.min(a,c);if((b=l.slice(0,p))===(y=d.slice(0,p)))return v(b,l.slice(p),d.slice(p),h)}}if(null===u||u===a){var f=a,g=(d=t.slice(0,f),t.slice(f));if(d===l){var m=Math.min(o-f,s-f);if((w=h.slice(h.length-m))===(x=g.slice(g.length-m)))return v(l,h.slice(0,h.length-m),g.slice(0,g.length-m),w)}}}if(n.length>0&&r&&0===r.length){var b=e.slice(0,n.index),w=e.slice(n.index+n.length);if(!(s<(p=b.length)+(m=w.length))){var y=t.slice(0,p),x=t.slice(s-m);if(b===y&&w===x)return v(b,e.slice(p,o-m),t.slice(p,s-m),w)}}return null}(e,t,f);if(b)return b}var w=o(e,t),y=e.substring(0,w);w=a(e=e.substring(w),t=t.substring(w));var x=e.substring(e.length-w),S=function(e,t){var s;if(!e)return[[1,t]];if(!t)return[[i,e]];var l=e.length>t.length?e:t,h=e.length>t.length?t:e,u=l.indexOf(h);if(-1!==u)return s=[[1,l.substring(0,u)],[0,h],[1,l.substring(u+h.length)]],e.length>t.length&&(s[0][0]=s[2][0]=i),s;if(1===h.length)return[[i,e],[1,t]];var c=function(e,t){var i=e.length>t.length?e:t,n=e.length>t.length?t:e;if(i.length<4||2*n.length<i.length)return null;function r(e,t,i){for(var n,r,s,l,h=e.substring(i,i+Math.floor(e.length/4)),u=-1,c="";-1!==(u=t.indexOf(h,u+1));){var d=o(e.substring(i),t.substring(u)),p=a(e.substring(0,i),t.substring(0,u));c.length<p+d&&(c=t.substring(u-p,u)+t.substring(u,u+d),n=e.substring(0,i-p),r=e.substring(i+d),s=t.substring(0,u-p),l=t.substring(u+d))}return 2*c.length>=e.length?[n,r,s,l,c]:null}var s,l,h,u,c,d=r(i,n,Math.ceil(i.length/4)),p=r(i,n,Math.ceil(i.length/2));if(!d&&!p)return null;s=p?d&&d[4].length>p[4].length?d:p:d,e.length>t.length?(l=s[0],h=s[1],u=s[2],c=s[3]):(u=s[0],c=s[1],l=s[2],h=s[3]);var f=s[4];return[l,h,u,c,f]}(e,t);if(c){var d=c[0],p=c[1],f=c[2],g=c[3],m=c[4],b=n(d,f),v=n(p,g);return b.concat([[0,m]],v)}return function(e,t){for(var n=e.length,o=t.length,s=Math.ceil((n+o)/2),a=s,l=2*s,h=new Array(l),u=new Array(l),c=0;c<l;c++)h[c]=-1,u[c]=-1;h[a+1]=0,u[a+1]=0;for(var d=n-o,p=d%2!=0,f=0,g=0,m=0,b=0,v=0;v<s;v++){for(var w=-v+f;w<=v-g;w+=2){for(var y=a+w,x=(P=w===-v||w!==v&&h[y-1]<h[y+1]?h[y+1]:h[y-1]+1)-w;P<n&&x<o&&e.charAt(P)===t.charAt(x);)P++,x++;if(h[y]=P,P>n)g+=2;else if(x>o)f+=2;else if(p){if((k=a+d-w)>=0&&k<l&&-1!==u[k])if(P>=(C=n-u[k]))return r(e,t,P,x)}}for(var S=-v+m;S<=v-b;S+=2){for(var C,k=a+S,E=(C=S===-v||S!==v&&u[k-1]<u[k+1]?u[k+1]:u[k-1]+1)-S;C<n&&E<o&&e.charAt(n-C-1)===t.charAt(o-E-1);)C++,E++;if(u[k]=C,C>n)b+=2;else if(E>o)m+=2;else if(!p){if((y=a+d-S)>=0&&y<l&&-1!==h[y]){var P;x=a+(P=h[y])-y;if(P>=(C=n-C))return r(e,t,P,x)}}}}return[[i,e],[1,t]]}(e,t)}(e=e.substring(0,e.length-w),t=t.substring(0,t.length-w));return y&&S.unshift([0,y]),x&&S.push([0,x]),p(S,m),g&&function(e){for(var t=!1,n=[],r=0,o=null,f=0,g=0,m=0,b=0,v=0;f<e.length;)0==e[f][0]?(n[r++]=f,g=b,m=v,b=0,v=0,o=e[f][1]):(1==e[f][0]?b+=e[f][1].length:v+=e[f][1].length,o&&o.length<=Math.max(g,m)&&o.length<=Math.max(b,v)&&(e.splice(n[r-1],0,[i,o]),e[n[r-1]+1][0]=1,r--,r--,f=r>0?n[r-1]:-1,g=0,m=0,b=0,v=0,o=null,t=!0)),f++;for(t&&p(e),function(e){function t(e,t){if(!e||!t)return 6;var i=e.charAt(e.length-1),n=t.charAt(0),r=i.match(l),o=n.match(l),s=r&&i.match(h),a=o&&n.match(h),p=s&&i.match(u),f=a&&n.match(u),g=p&&e.match(c),m=f&&t.match(d);return g||m?5:p||f?4:r&&!s&&a?3:s||a?2:r||o?1:0}for(var i=1;i<e.length-1;){if(0==e[i-1][0]&&0==e[i+1][0]){var n=e[i-1][1],r=e[i][1],o=e[i+1][1],s=a(n,r);if(s){var p=r.substring(r.length-s);n=n.substring(0,n.length-s),r=p+r.substring(0,r.length-s),o=p+o}for(var f=n,g=r,m=o,b=t(n,r)+t(r,o);r.charAt(0)===o.charAt(0);){n+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);var v=t(n,r)+t(r,o);v>=b&&(b=v,f=n,g=r,m=o)}e[i-1][1]!=f&&(f?e[i-1][1]=f:(e.splice(i-1,1),i--),e[i][1]=g,m?e[i+1][1]=m:(e.splice(i+1,1),i--))}i++}}(e),f=1;f<e.length;){if(e[f-1][0]==i&&1==e[f][0]){var w=e[f-1][1],y=e[f][1],x=s(w,y),S=s(y,w);x>=S?(x>=w.length/2||x>=y.length/2)&&(e.splice(f,0,[0,y.substring(0,x)]),e[f-1][1]=w.substring(0,w.length-x),e[f+1][1]=y.substring(x),f++):(S>=w.length/2||S>=y.length/2)&&(e.splice(f,0,[0,w.substring(0,S)]),e[f-1][0]=1,e[f-1][1]=y.substring(0,y.length-S),e[f+1][0]=i,e[f+1][1]=w.substring(S),f++),f++}f++}}(S),S}function r(e,t,i,r){var o=e.substring(0,i),s=t.substring(0,r),a=e.substring(i),l=t.substring(r),h=n(o,s),u=n(a,l);return h.concat(u)}function o(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;i<r;)e.substring(o,r)==t.substring(o,r)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return f(e.charCodeAt(r-1))&&r--,r}function s(e,t){var i=e.length,n=t.length;if(0==i||0==n)return 0;i>n?e=e.substring(i-n):i<n&&(t=t.substring(0,i));var r=Math.min(i,n);if(e==t)return r;for(var o=0,s=1;;){var a=e.substring(r-s),l=t.indexOf(a);if(-1==l)return o;s+=l,(0==l||e.substring(r-s)==t.substring(0,s))&&(o=s,s++)}}function a(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;i<r;)e.substring(e.length-r,e.length-o)==t.substring(t.length-r,t.length-o)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return g(e.charCodeAt(e.length-r))&&r--,r}var l=/[^a-zA-Z0-9]/,h=/\s/,u=/[\r\n]/,c=/\n\r?\n$/,d=/^\r?\n\r?\n/;function p(e,t){e.push([0,""]);for(var n,r=0,s=0,l=0,h="",u="";r<e.length;)if(r<e.length-1&&!e[r][1])e.splice(r,1);else switch(e[r][0]){case 1:l++,u+=e[r][1],r++;break;case i:s++,h+=e[r][1],r++;break;case 0:var c=r-l-s-1;if(t){if(c>=0&&b(e[c][1])){var d=e[c][1].slice(-1);if(e[c][1]=e[c][1].slice(0,-1),h=d+h,u=d+u,!e[c][1]){e.splice(c,1),r--;var f=c-1;e[f]&&1===e[f][0]&&(l++,u=e[f][1]+u,f--),e[f]&&e[f][0]===i&&(s++,h=e[f][1]+h,f--),c=f}}if(m(e[r][1])){d=e[r][1].charAt(0);e[r][1]=e[r][1].slice(1),h+=d,u+=d}}if(r<e.length-1&&!e[r][1]){e.splice(r,1);break}if(h.length>0||u.length>0){h.length>0&&u.length>0&&(0!==(n=o(u,h))&&(c>=0?e[c][1]+=u.substring(0,n):(e.splice(0,0,[0,u.substring(0,n)]),r++),u=u.substring(n),h=h.substring(n)),0!==(n=a(u,h))&&(e[r][1]=u.substring(u.length-n)+e[r][1],u=u.substring(0,u.length-n),h=h.substring(0,h.length-n)));var g=l+s;0===h.length&&0===u.length?(e.splice(r-g,g),r-=g):0===h.length?(e.splice(r-g,g,[1,u]),r=r-g+1):0===u.length?(e.splice(r-g,g,[i,h]),r=r-g+1):(e.splice(r-g,g,[i,h],[1,u]),r=r-g+2)}0!==r&&0===e[r-1][0]?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,l=0,s=0,h="",u=""}""===e[e.length-1][1]&&e.pop();var v=!1;for(r=1;r<e.length-1;)0===e[r-1][0]&&0===e[r+1][0]&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)===e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),v=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),v=!0)),r++;v&&p(e,t)}function f(e){return e>=55296&&e<=56319}function g(e){return e>=56320&&e<=57343}function m(e){return g(e.charCodeAt(0))}function b(e){return f(e.charCodeAt(e.length-1))}function v(e,t,n,r){return b(e)||m(r)?null:function(e){for(var t=[],i=0;i<e.length;i++)e[i][1].length>0&&t.push(e[i]);return t}([[0,e],[i,t],[1,n],[0,r]])}function w(e,t,i,r){return n(e,t,i,r,!0)}w.INSERT=1,w.DELETE=i,w.EQUAL=0,t.exports=w})),u={};((e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})})(u,{CoreViewer:()=>hp,HOOKS:()=>N,Navigation:()=>dp,PageProgression:()=>m,PageSide:()=>y,PageViewMode:()=>fp,Profiler:()=>L,ReadyState:()=>x,UserAgentBaseCss:()=>ir,UserAgentPageCss:()=>tr,UserAgentTocCss:()=>nr,UserAgentXml:()=>er,ValidationTxt:()=>Qn,VivliostylePolyfillCss:()=>rr,VivliostyleViewportCss:()=>Jn,VivliostyleViewportScreenCss:()=>Zn,ZoomType:()=>pp,getHooksForName:()=>_,isDebug:()=>p,pageProgressionOf:()=>b,plugin:()=>A,printHTML:()=>mp,profile:()=>U,profiler:()=>V,registerHook:()=>I,removeHook:()=>R,setDebug:()=>f}),e=u,c=a(i({},"__esModule",{value:!0}),e);var p=!1;function f(e){p=e}var g,m=((g=m||{}).LTR="ltr",g.RTL="rtl",g);function b(e){switch(e){case"ltr":return"ltr";case"rtl":return"rtl";default:throw new Error(`unknown PageProgression: ${e}`)}}var v,w,y=(e=>(e.LEFT="left",e.RIGHT="right",e))(y||{}),x=((v=x||{}).LOADING="loading",v.INTERACTIVE="interactive",v.COMPLETE="complete",v),S=((w=S||{})[w.DEBUG=1]="DEBUG",w[w.INFO=2]="INFO",w[w.WARN=3]="WARN",w[w.ERROR=4]="ERROR",w);function C(e){let t=Array.from(e),i=null;return t[0]instanceof Error&&(i=t.shift()),{error:i,messages:t}}function k(e){let t=e.error,i=t&&(t.frameTrace||t.stack),n=[].concat(e.messages);return t&&(n.length>0&&(n=n.concat(["\n"])),n=n.concat([t.toString()]),i&&(n=n.concat(["\n"]).concat(i))),n}var E,P=new class{constructor(e){this.opt_console=e,l(this,"listeners",{})}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){let i=this.listeners[e];i&&i(t)}addListener(e,t){this.listeners[e]=t}debug(...e){let t=C(arguments);this.consoleDebug(k(t)),this.triggerListeners(1,t)}info(...e){let t=C(arguments);this.consoleInfo(k(t)),this.triggerListeners(2,t)}warn(...e){let t=C(arguments);this.consoleWarn(k(t)),this.triggerListeners(3,t)}error(...e){let t=C(arguments);this.consoleError(k(t)),this.triggerListeners(4,t)}},N=((E=N||{}).SIMPLE_PROPERTY="SIMPLE_PROPERTY",E.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",E.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",E.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",E.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",E.CONFIGURATION="CONFIGURATION",E.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",E.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",E.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",E.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK",E),T={};function I(e,t,i){if(N[e]){let n=T[e];n||(n=T[e]=[]),i?n.unshift(t):n.push(t)}else P.warn(new Error(`Skipping unknown plugin hook '${e}'.`))}function R(e,t){if(N[e]){let i=T[e];if(i){let e=i.indexOf(t);e>=0&&i.splice(e,1)}}else P.warn(new Error(`Ignoring unknown plugin hook '${e}'.`))}function _(e){return T[e]||[]}var A={registerHook:I,removeHook:R},L=class{constructor(e){this.performanceInstance=e,l(this,"timestamps",{}),l(this,"registerTiming"),l(this,"registerStartTiming"),l(this,"registerEndTiming"),this.registerTiming=O,this.registerStartTiming=this.registerStartTiming=O,this.registerEndTiming=this.registerEndTiming=O}forceRegisterStartTiming(e,t){F.call(this,e,"start",t)}forceRegisterEndTiming(e,t){F.call(this,e,"end",t)}printTimings(){let e=this.timestamps,t="";Object.keys(e).forEach((i=>{let n=e[i],r=n.length;for(let e=0;e<r;e++){let o=n[e];t+=i,r>1&&(t+=`(${e})`),t+=` => start: ${o.start}, end: ${o.end}, duration: ${o.end-o.start}\n`}})),P.info(t)}disable(){this.registerTiming=O,this.registerStartTiming=this.registerStartTiming=O,this.registerEndTiming=this.registerEndTiming=O}enable(){this.registerTiming=F,this.registerStartTiming=this.registerStartTiming=B,this.registerEndTiming=this.registerEndTiming=M}isEnabled(){return this.registerStartTiming===B}};function O(){}function F(e,t,i){i||(i=this.performanceInstance.now());let n,r=this.timestamps[e];r||(r=this.timestamps[e]=[]);for(let e=r.length-1;e>=0&&(n=r[e],!n||n[t]);e--)n=null;n||(n={},r.push(n)),n[t]=i}function B(e,t){this.registerTiming(e,"start",t)}function M(e,t){this.registerTiming(e,"end",t)}var z={now:Date.now},D=window&&window.performance,V=new L(D||z);V.forceRegisterStartTiming("load_vivliostyle");var U={profiler:{registerStartTiming:V.registerStartTiming,registerEndTiming:V.registerEndTiming,printTimings:V.printTimings,disable:V.disable,enable:V.enable}},H=/^[\s\p{Zs}\p{P}\p{Mn}]*[\p{L}\p{N}]\p{Mn}*(?:[\s\p{Zs}]*\p{P}\p{Mn}*)*/u,$="data-adapt-eloff",j={};function W(e){return JSON.parse(e)}function G(e){let t=e.match(/^([^#]*)/);return t?t[1]:e}var q=window.location.href;function X(e){q=e}var Y=window.location.href;function K(e){Y=e}function Z(e,t){if(/^data:/i.test(t))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);let i;if(t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`),e.match(/^\/\//))return i=t.match(/^(\w{2,}:)\/\//),i?i[1]+e:e;if(e.match(/^\//))return i=t.match(/^(\w{2,}:\/\/[^\/]+)\//),i?i[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=function(e){let t=e.match(/^([^#?]*)/);return t?t[1]:e}(t),e.match(/^#/))return t+e;let n=t.lastIndexOf("/");if(n<0)return e;let r=t.substr(0,n+1)+e,o="";for(i=r.match(/^([^?#]*)([?#].*)$/),i&&(r=i[1],o=i[2]);n=r.indexOf("/../"),!(n<=0);){let e=r.lastIndexOf("/",n-1);if(e<=0)break;r=r.substr(0,e)+r.substr(n+3)}return r.replace(/\/(\.\/)+/g,"/")+o}function J(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}function Q(e){return null==e?e:e.toString()}var ee=class{constructor(){l(this,"queue",[null])}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){let i=Math.floor(t/2),n=this.queue[i];if(n.compare(e)>0)return void(this.queue[t]=e);this.queue[t]=n,t=i}this.queue[1]=e}peek(){return this.queue[1]}remove(){let e=this.queue[1],t=this.queue.pop(),i=this.queue.length;if(i>1){let e=1;for(;;){let n=2*e;if(n>=i)break;if(this.queue[n].compare(t)>0)n+1<i&&this.queue[n+1].compare(this.queue[n])>0&&n++;else{if(!(n+1<i&&this.queue[n+1].compare(t)>0))break;n++}this.queue[e]=this.queue[n],e=n}this.queue[e]=t}return e}},te=["","-webkit-","-moz-"],ie={};function ne(e,t){return CSS.supports(e+t,"unset")}function re(e){let t=ie[e];if(t||null===t)return t;switch(e){case"behavior":case"template":case"ua-list-item-count":case"x-first-pseudo":return ie[e]=null,null;case"text-combine-upright":if(ne("-webkit-","text-combine")&&!ne("","text-combine-upright"))return ie[e]=["-webkit-text-combine"],["-webkit-text-combine"]}for(let i of te)if(ne(i,e))return t=[i+e],ie[e]=t,t;return P.warn("Property not supported by the browser: ",e),ie[e]=null,null}function oe(e,t,i){let n=null==e?void 0:e.style;if(!n)return;if(t.startsWith("--"))return void n.setProperty(t,i||" ");let r=re(t);if(r)for(let e of r){switch(e){case"-webkit-text-combine":if("all"===i)i="horizontal";break;case"text-combine-upright":if("all"===i)n.setProperty("text-indent","0")}n.setProperty(e,i)}}function se(e,t,i){try{let i=ie[t];return e.style.getPropertyValue(i?i[0]:t)}catch(e){}return i||""}function ae(e){let t=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","lang");return!t&&"http://www.w3.org/1999/xhtml"==e.namespaceURI&&(t=e.getAttribute("lang")),t}var le=class{constructor(){l(this,"list",[])}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){let e=this.list.join("");return this.list=[e],e}};function he(e){return`\\${e.charCodeAt(0).toString(16)} `}function ue(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,he)}function ce(e){return e.replace(/[\u0000-\u001F"\\]/g,he)}function de(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function pe(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function fe(e,t){return e.replace(/[^-a-zA-Z0-9_]/g,(function(e){return function(e,t){return(t="string"==typeof t?t:"\\u")+(65536|e.charCodeAt(0)).toString(16).substr(1)}(e,t)}))}function ge(e){return fe(e)}function me(e,t){t="string"==typeof t?t:"\\u";let i=new RegExp(`${ge(t)}[0-9a-fA-F]{4}`,"g");return e.replace(i,(function(e){return function(e,t){return t="string"==typeof t?t:"\\u",0===e.indexOf(t)?String.fromCharCode(parseInt(e.substring(t.length),16)):e}(e,t)}))}function be(e,t){let i=0,n=e;for(;;){if(0==i||t(i-1),n==e||t(n),i==n)return i;let r=i+n>>1;t(r)?n=r:i=r+1}}function ve(e,t){return e-t}function we(e,t){let i={};for(let n of e){let e=t(n);e&&!i[e]&&(i[e]=n)}return i}function ye(e,t){let i={};for(let n of e){let e=t(n);e&&(i[e]?i[e].push(n):i[e]=[n])}return i}var xe=class{constructor(){l(this,"listeners",{})}dispatchEvent(e){let t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let i=0;i<t.length;i++)t[i](e)}}addEventListener(e,t,i){if(i)return;let n=this.listeners[e];n?n.includes(t)||n.push(t):this.listeners[e]=[t]}removeEventListener(e,t,i){if(i)return;let n=this.listeners[e];if(n){let e=n.indexOf(t);e>=0&&n.splice(e,1)}}},Se={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function Ce(e){if(1==e.nodeType){let t=e.getAttribute("id");if(t)return t}return null}function ke(e){return`^${e}`}function Ee(e){return e.replace(/[\[\]\(\),=;^]/g,ke)}function Pe(e){return e.substr(1)}function Ne(e){return e&&e.replace(/\^[\[\]\(\),=;^]/g,Pe)}function Te(e){let t=[];do{let i=e.match(/^(\^,|[^,])*/),n=Ne(i[0]);if(!(e=e.substr(i[0].length+1))&&!t.length)return n;t.push(n)}while(e);return t}function Ie(e){let t={};for(;e;){let i=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!i)return t;t[i[1]]=Te(i[2]),e=e.substr(i[0].length)}return t}var Re=class{appendTo(e){e.append("!")}applyTo(e){return!1}},_e=class{constructor(e,t,i){this.index=e,this.id=t,this.sideBias=i}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(1!=e.node.nodeType)throw new Error("E_CFI_NOT_ELEMENT");let t,i=e.node,n=i.children,r=n.length,o=Math.floor(this.index/2)-1;if(o<0||0==r)t=i.firstChild,e.node=t||i;else{if(t=n[Math.min(o,r-1)],1&this.index){let i=t.nextSibling;i&&1!=i.nodeType?t=i:e.after=!0}e.node=t}if(this.id&&(e.after||this.id!=Ce(e.node))){let t=i.ownerDocument.getElementById(this.id);t?e.node=t:P.warn("E_CFI_ID_MISMATCH:",this.id)}return e.sideBias=this.sideBias,!0}},Ae=class{constructor(e,t,i,n){this.offset=e,this.textBefore=t,this.textAfter=i,this.sideBias=n}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,i=e.node;for(;;){let e=i.nodeType;if(1==e)break;let n=i.nextSibling;if(3<=e&&e<=5){let e=i.textContent.length;if(t<=e)break;if(!n){t=e;break}t-=e}if(!n){t=0;break}i=n}e.node=i,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(Ee(this.textBefore)),e.append(","),this.textAfter&&e.append(Ee(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}},Le=class e{constructor(){l(this,"steps",null)}fromString(e){let t=e.match(/^#?epubcfi\((.*)\)$/);if(!t)throw new Error("E_CFI_NOT_CFI");let i=decodeURIComponent(t[1]),n=0,r=[];for(;;){let e;switch(i.charAt(n)){case"/":{if(n++,t=i.substr(n).match(/^(0|[1-9][0-9]*)(\[(.*?)(;([^\]]|\^\])*)?\])?/),!t)throw new Error("E_CFI_NUMBER_EXPECTED");n+=t[0].length;let o=parseInt(t[1],10),s=t[3];e=Ie(t[4]),r.push(new _e(o,s,Q(e.s)));break}case":":{if(n++,t=i.substr(n).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/),!t)throw new Error("E_CFI_NUMBER_EXPECTED");n+=t[0].length;let o=parseInt(t[1],10),s=t[4];s&&(s=Ne(s));let a=t[7];a&&(a=Ne(a)),e=Ie(t[10]),r.push(new Ae(o,s,a,Q(e.s)));break}case"!":n++,r.push(new Re);break;case"~":case"@":case"":return void(this.steps=r);default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(t){let i={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let t=0;t<this.steps.length;t++)if(!this.steps[t].applyTo(i)){i.ref=new e,i.ref.steps=this.steps.slice(t+1);break}return i}trim(e,t){return e.replace(/\s+/g," ").match(t?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(e,t,i,n){let r=[],o=e.parentNode,s="",a="";for(;e;){switch(e.nodeType){case 3:case 4:case 5:{let n=e.textContent,r=n.length;i?(t+=r,s||(s=n)):(t>r&&(t=r),i=!0,s=n.substr(0,t),a=n.substr(t)),e=e.previousSibling;continue}case 8:e=e.previousSibling;continue}break}for((t>0||s||a)&&(s=this.trim(s,!1),a=this.trim(a,!0),r.push(new Ae(t,s,a,n)),n=null);o&&o&&9!=o.nodeType;){let t=i?null:Ce(e),s=i?1:0;for(;e;)1==e.nodeType&&(s+=2),e=e.previousSibling;r.push(new _e(s,t,n)),n=null,e=o,o=o.parentNode,i=!1}r.reverse(),this.steps?(r.push(new Re),this.steps=r.concat(this.steps)):this.steps=r}toString(){if(!this.steps)return"";let e=new le;e.append("epubcfi(");for(let t=0;t<this.steps.length;t++)this.steps[t].appendTo(e);return e.append(")"),e.toString().replace(/%/g,"%25")}};function Oe(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}var Fe={fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0},Be={};function Me(e,t,i,n){let r=Math.min((e-0)/i,(t-0)/n);return`matrix(${r},0,0,${r},0,0)`}function ze(e){return`"${ce(`${e}`)}"`}function De(e){return ue(`${e}`)}function Ve(e,t){return e?`${ue(e)}.${ue(t)}`:ue(t)}var Ue=0,He=class{constructor(e,t){if(this.parent=e,this.resolver=t,l(this,"scopeKey"),l(this,"children",[]),l(this,"zero"),l(this,"one"),l(this,"_true"),l(this,"_false"),l(this,"values",{}),l(this,"funcs",{}),l(this,"builtIns",{}),this.scopeKey="S"+Ue++,this.zero=new Et(this,0),this.one=new Et(this,1),this._true=new Et(this,!0),this._false=new Et(this,!1),e&&e.children.push(this),!e){let e=this.builtIns;e.floor=Math.floor,e.ceil=Math.ceil,e.round=Math.round,e.sqrt=Math.sqrt,e.min=Math.min,e.max=Math.max,e.letterbox=Me,e["css-string"]=ze,e["css-name"]=De,e.typeof=e=>typeof e,this.defineBuiltInName("page-width",(function(){return this.pageWidth()})),this.defineBuiltInName("page-height",(function(){return this.pageHeight()})),this.defineBuiltInName("pref-font-family",(function(){return this.pref.fontFamily})),this.defineBuiltInName("pref-night-mode",(function(){return this.pref.nightMode})),this.defineBuiltInName("pref-hyphenate",(function(){return this.pref.hyphenate})),this.defineBuiltInName("pref-margin",(function(){return this.pref.margin})),this.defineBuiltInName("pref-line-height",(function(){return this.pref.lineHeight})),this.defineBuiltInName("pref-column-width",(function(){return this.pref.columnWidth*this.fontSize})),this.defineBuiltInName("pref-horizontal",(function(){return this.pref.horizontal})),this.defineBuiltInName("pref-spread-view",(function(){return this.pref.spreadView})),this.defineBuiltInName("pub-title",(function(){return ze(this.pubTitle?this.pubTitle:"")})),this.defineBuiltInName("doc-title",(function(){return ze(this.docTitle?this.docTitle:"")}))}}defineBuiltInName(e,t){this.values[e]=new St(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}};function $e(e){switch(null==e?void 0:e.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}var je={px:1,in:96,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function We(e){switch(e){case"q":return!CSS.supports("font-size","1q");case"lh":return!CSS.supports("line-height","1lh");case"rem":case"rlh":return!0;default:return!1}}var Ge=class{constructor(e,t,i,n){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=i,l(this,"actualPageWidth",null),l(this,"pageWidth"),l(this,"actualPageHeight",null),l(this,"pageHeight"),l(this,"initialFontSize"),l(this,"rootFontSize",null),l(this,"isRelativeRootFontSize",null),l(this,"fontSize"),l(this,"rootLineHeight",null),l(this,"pref"),l(this,"scopes",{}),l(this,"pageAreaWidth",null),l(this,"pageAreaHeight",null),l(this,"pageVertical",null),l(this,"pubTitle",null),l(this,"docTitle",null),this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:i},this.initialFontSize=n,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:n},this.pref=Fe}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t,i){if($e(e)){let t=this.pageWidth()/100,n=this.pageHeight()/100,r=null!=this.pageAreaWidth?this.pageAreaWidth/100:t,o=null!=this.pageAreaHeight?this.pageAreaHeight/100:n,s=null!=i?i:this.pageVertical;switch(e){case"vw":return r;case"vh":return o;case"vi":return s?o:r;case"vb":return s?r:o;case"vmin":return r<o?r:o;case"vmax":return r>o?r:o;case"pvw":return t;case"pvh":return n;case"pvi":return s?n:t;case"pvb":return s?t:n;case"pvmin":return t<n?t:n;case"pvmax":return t>n?t:n}}return"em"==e||"rem"==e?t?this.initialFontSize:this.fontSize():"ex"==e?je.ex*(t?this.initialFontSize:this.fontSize())/je.em:"lh"==e||"rlh"==e?this.rootLineHeight:je[e]}evalName(e,t){do{let i=e.values[t];if(i||e.resolver&&(i=e.resolver.call(this,t,!1),i))return i;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,i,n){do{let r=e.funcs[t];if(r||e.resolver&&(r=e.resolver.call(this,t,!0),r))return r;let o=e.builtIns[t];if(o){if(n)return e.zero;let t=Array(i.length);for(let e=0;e<i.length;e++)t[e]=i[e].evaluate(this);return new Et(e,o.apply(this,t))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){let i="all"===e||!!this.pref.enabledMediaTypes[e];return t?!i:i}evalMediaTest(e,t){let i="",n=e.match(/^(min|max)-(.*)$/);n&&(i=n[1],e=n[2]);let r=null,o=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(r=t.evaluate(this))}switch(e){case"width":o=this.pageWidth();break;case"height":o=this.pageHeight();break;case"device-width":o=window.screen.availWidth;break;case"device-height":o=window.screen.availHeight;break;case"color":o=window.screen.pixelDepth}if(null!=o&&null!=r)switch(i){case"min":return o>=Number(r);case"max":return o<=Number(r);default:return o==r}else if(null!=o&&null==t)return 0!==o;return!1}evalSupportsTest(e,t,i){return!1}queryVal(e,t){let i=e&&this.scopes[e.scopeKey];return i?i[t]:void 0}storeVal(e,t,i){this.getScopeContext(e)[t]=i}},qe=class{constructor(e){this.scope=e,l(this,"key"),this.scope=e,this.key="_"+Ue++}toString(){let e=new le;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,i){return e===this}dependOuter(e,t,i){let n=i[this.key];if(null!=n)return n!==Be&&n;{i[this.key]=Be;let n=this.dependCore(e,t,i);return i[this.key]=n,n}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return void 0!==t||(t=this.evaluateCore(e),this.scope&&e.storeVal(this.scope,this.key,t)),t}isMediaName(){return!1}},Xe=class extends qe{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,i){return e===this||this.val.dependOuter(e,t,i)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){let i=this.val.expand(e,t);return i===this.val?this:new this.constructor(this.scope,i)}},Ye=class extends qe{constructor(e,t,i){super(e),this.lhs=t,this.rhs=i}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.lhs.evaluate(e),i=this.rhs.evaluate(e);return this.evalInfix(t,i)}dependCore(e,t,i){return e===this||this.lhs.dependOuter(e,t,i)||this.rhs.dependOuter(e,t,i)}appendTo(e,t){let i=this.getPriority();i<=t&&e.append("("),this.lhs.appendTo(e,i),e.append(this.getOp()),this.rhs.appendTo(e,i),i<=t&&e.append(")")}expand(e,t){let i=this.lhs.expand(e,t),n=this.rhs.expand(e,t);return i===this.lhs&&n===this.rhs?this:new this.constructor(this.scope,i,n)}},Ke=class extends Ye{constructor(e,t,i){super(e,t,i)}getPriority(){return 1}},Ze=class extends Ye{constructor(e,t,i){super(e,t,i)}getPriority(){return 2}},Je=class extends Ye{constructor(e,t,i){super(e,t,i)}getPriority(){return 3}},Qe=class extends Ye{constructor(e,t,i){super(e,t,i)}getPriority(){return 4}},et=class extends Xe{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}},tt=class extends et{constructor(e,t){super(e,t)}getOp(){return"not "}},it=class extends Xe{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}},nt=class extends Ke{constructor(e,t,i){super(e,t,i)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}},rt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return" and "}},ot=class extends Ke{constructor(e,t,i){super(e,t,i)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}},st=class extends ot{constructor(e,t,i){super(e,t,i)}getOp(){return", "}},at=class extends ot{constructor(e,t,i){super(e,t,i)}getOp(){return" or "}},lt=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return"<"}evalInfix(e,t){return e<t}},ht=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return"<="}evalInfix(e,t){return e<=t}},ut=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return">"}evalInfix(e,t){return e>t}},ct=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return">="}evalInfix(e,t){return e>=t}},dt=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return"=="}evalInfix(e,t){return e==t}},pt=class extends Ze{constructor(e,t,i){super(e,t,i)}getOp(){return"!="}evalInfix(e,t){return e!=t}},ft=class extends Je{constructor(e,t,i){super(e,t,i)}getOp(){return"+"}evalInfix(e,t){return e+t}},gt=class extends Je{constructor(e,t,i){super(e,t,i)}getOp(){return" - "}evalInfix(e,t){return e-t}},mt=class extends Qe{constructor(e,t,i){super(e,t,i)}getOp(){return"*"}evalInfix(e,t){return e*t}},bt=class extends Qe{constructor(e,t,i){super(e,t,i)}getOp(){return"/"}evalInfix(e,t){return e/t}},vt=class extends Qe{constructor(e,t,i){super(e,t,i)}getOp(){return"%"}evalInfix(e,t){return e%t}},wt=class extends qe{constructor(e,t,i){var n;super(e),this.num=t,l(this,"unit"),this.unit=null!=(n=null==i?void 0:i.toLowerCase())?n:""}appendTo(e,t){e.append(this.num.toString()),e.append(ue(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},yt=class extends qe{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,i){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,i)}},xt=class extends qe{constructor(e,t,i){super(e),this.not=t,this.name=i}appendTo(e,t){this.not&&e.append("not "),e.append(ue(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},St=class extends qe{constructor(e,t,i){super(e),this.fn=t,this.str=i}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}},Ct=class e extends qe{constructor(e,t,i){super(e),this.qualifiedName=t,this.params=i}appendTo(e,t){e.append(this.qualifiedName),function(e,t){e.append("(");for(let i=0;i<t.length;i++)i&&e.append(","),t[i].appendTo(e,0);e.append(")")}(e,this.params)}evaluateCore(e){return e.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(e,this.params).evaluate(e)}dependCore(e,t,i){if(e===this)return!0;for(let n=0;n<this.params.length;n++)if(this.params[n].dependOuter(e,t,i))return!0;return t.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(e,t,i)}expand(t,i){let n=function(e,t,i){let n=t;for(let r=0;r<t.length;r++){let o=t[r].expand(e,i);if(t!==n)n[r]=o;else if(o!==t[r]){n=Array(t.length);for(let e=0;e<r;e++)n[e]=t[e];n[r]=o}}return n}(t,this.params,i);return n===this.params?this:new e(this.scope,this.qualifiedName,n)}},kt=class e extends qe{constructor(e,t,i,n){super(e),this.cond=t,this.ifTrue=i,this.ifFalse=n}appendTo(e,t){t>0&&e.append("("),this.cond.appendTo(e,0),e.append("?"),this.ifTrue.appendTo(e,0),e.append(":"),this.ifFalse.appendTo(e,0),t>0&&e.append(")")}evaluateCore(e){return this.cond.evaluate(e)?this.ifTrue.evaluate(e):this.ifFalse.evaluate(e)}dependCore(e,t,i){return e===this||this.cond.dependOuter(e,t,i)||this.ifTrue.dependOuter(e,t,i)||this.ifFalse.dependOuter(e,t,i)}expand(t,i){let n=this.cond.expand(t,i),r=this.ifTrue.expand(t,i),o=this.ifFalse.expand(t,i);return n===this.cond&&r===this.ifTrue&&o===this.ifFalse?this:new e(this.scope,n,r,o)}},Et=class extends qe{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(ce(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}},Pt=class e extends qe{constructor(e,t,i){super(e),this.name=t,this.value=i}appendTo(e,t){e.append("("),e.append(ce(this.name.name)),e.append(":"),this.value.appendTo(e,0),e.append(")")}evaluateCore(e){return e.evalMediaTest(this.name.name,this.value)}dependCore(e,t,i){return e===this||this.value.dependOuter(e,t,i)}expand(t,i){let n=this.value.expand(t,i);return n===this.value?this:new e(this.scope,this.name,n)}},Nt=class extends qe{constructor(e,t,i,n){super(e),this.name=t,this.value=i,this.isFunc=n}appendTo(e,t){this.isFunc&&e.append(this.name),e.append("("),!this.isFunc&&this.name&&(e.append(this.name),e.append(":")),e.append(this.value),e.append(")")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},Tt=class extends qe{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){let i=t[this.index];if(!i)throw new Error(`Parameter missing: ${this.index}`);return i}};function It(e,t,i){return t===e._false||t===e.zero||i==e._false||i==e.zero?e._false:t===e._true||t===e.one?i:i===e._true||i===e.one?t:new nt(e,t,i)}function Rt(e,t,i){return t===e.zero?i:i===e.zero?t:new ft(e,t,i)}function _t(e,t,i){return t===e.zero?new it(e,i):i===e.zero?t:new gt(e,t,i)}function At(e,t,i){return t===e.zero||i===e.zero?e.zero:t===e.one?i:i===e.one?t:new mt(e,t,i)}function Lt(e,t,i){return t===e.zero?e.zero:i===e.one?t:new bt(e,t,i)}var Ot=class{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this);return null}visitEmpty(e){return null}visitSlash(e){return null}visitStr(e){return null}visitIdent(e){return null}visitNumeric(e){return null}visitNum(e){return null}visitInt(e){return this.visitNum(e)}visitHexColor(e){return null}visitURL(e){return null}visitURange(e){return null}visitSpaceList(e){return this.visitValues(e.values),null}visitCommaList(e){return this.visitValues(e.values),null}visitFunc(e){return this.visitValues(e.values),null}visitExpr(e){return null}},Ft=class extends Ot{constructor(){super(),l(this,"error",!1)}visitValues(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i],r=n.visit(this);if(this.error)return[];if(t)t[i]=r;else if(n!==r){t=new Array(e.length);for(let n=0;n<i;n++)t[n]=e[n];t[i]=r}}return t||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let t=this.visitValues(e.values);return this.error?zt:t===e.values?e:new Jt(t)}visitCommaList(e){let t=this.visitValues(e.values);return this.error?zt:t===e.values?e:new Qt(t)}visitFunc(e){let t=this.visitValues(e.values);return this.error?zt:t===e.values?e:new ei(e.name,t)}visitExpr(e){return e}},Bt=class{toString(){let e=new le;return this.appendTo(e,!0),e.toString()}stringValue(){let e=new le;return this.appendTo(e,!1),e.toString()}toExpr(e,t){return null}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){return this}},Mt=class e extends Bt{static get instance(){return this.empty||(this.empty=new e),this.empty}constructor(){super()}toExpr(e,t){return new Et(e,"")}appendTo(e,t){}visit(e){return e.visitEmpty(this)}};l(Mt,"empty");var zt=Mt.instance,Dt=class e extends Bt{static get instance(){return this.slash||(this.slash=new e),this.slash}constructor(){super()}toExpr(e,t){return new Et(e,"/")}appendTo(e,t){e.append("/")}visit(e){return e.visitSlash(this)}};l(Dt,"slash");var Vt=Dt.instance,Ut=class extends Bt{constructor(e){super(),this.str=e}toExpr(e,t){return new Et(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(ce(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}},Ht={},$t=class extends Bt{constructor(e){if(super(),this.name=e,Ht[e])throw new Error("E_INVALID_CALL");Ht[e]=this}toExpr(e,t){return new Et(e,this.name)}appendTo(e,t){t?e.append(ue(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function jt(e){let t=Ht[e];return t||(t=new $t(e)),t}var Wt=class extends Bt{constructor(e,t){var i;super(),this.num=e,l(this,"unit"),this.unit=null!=(i=null==t?void 0:t.toLowerCase())?i:""}toExpr(e,t){return 0==this.num?e.zero:t&&"%"==this.unit?100==this.num?t:new mt(e,t,new Et(e,this.num/100)):new wt(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},Gt=class extends Bt{constructor(e){super(),this.num=e}toExpr(e,t){return 0==this.num?e.zero:1==this.num?e.one:new Et(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},qt=class extends Gt{constructor(e){super(e)}visit(e){return e.visitInt(this)}},Xt=class extends Bt{constructor(e){super(),this.hex=e}appendTo(e,t){e.append("#"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},Yt=class extends Bt{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(ce(this.url)),e.append('")')}visit(e){return e.visitURL(this)}},Kt=class extends Bt{constructor(e){super(),this.urangeText=e}appendTo(e,t){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function Zt(e,t,i,n){var r,o;let s=t.length;if(s>0){null==(r=t[0])||r.appendTo(e,n);for(let r=1;r<s;r++)e.append(i),null==(o=t[r])||o.appendTo(e,n)}}var Jt=class extends Bt{constructor(e){super(),this.values=e}appendTo(e,t){Zt(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},Qt=class extends Bt{constructor(e){super(),this.values=e}appendTo(e,t){Zt(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}},ei=class extends Bt{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(ue(this.name)),e.append("("),Zt(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}},ti=class extends Bt{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){this.expr instanceof Et||this.expr instanceof wt?this.expr.appendTo(e,0):(e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},ii=class extends Bt{constructor(e){super(),this.text=e}appendTo(e,t){e.append(this.text||" ")}};function ni(e,t){if(e){if(e.isNumeric()){let i=e;return t.queryUnitSize(i.unit,!1)*i.num}if(e.isNum())return e.num}return 0}function ri(e,t){return new Wt(ni(e,t),"px")}var oi={absolute:jt("absolute"),all:jt("all"),always:jt("always"),anywhere:jt("anywhere"),auto:jt("auto"),avoid:jt("avoid"),balance:jt("balance"),balance_all:jt("balance-all"),block:jt("block"),block_end:jt("block-end"),block_start:jt("block-start"),both:jt("both"),bottom:jt("bottom"),border_box:jt("border-box"),break_all:jt("break-all"),break_word:jt("break-word"),clip:jt("clip"),crop:jt("crop"),cross:jt("cross"),column:jt("column"),discard:jt("discard"),exclusive:jt("exclusive"),_false:jt("false"),fixed:jt("fixed"),flex:jt("flex"),flow_root:jt("flow-root"),footnote:jt("footnote"),footer:jt("footer"),grid:jt("grid"),header:jt("header"),hidden:jt("hidden"),horizontal_tb:jt("horizontal-tb"),inherit:jt("inherit"),initial:jt("initial"),inline:jt("inline"),inline_block:jt("inline-block"),inline_end:jt("inline-end"),inline_start:jt("inline-start"),keep:jt("keep"),landscape:jt("landscape"),left:jt("left"),line:jt("line"),list_item:jt("list-item"),ltr:jt("ltr"),manual:jt("manual"),max_content:jt("max-content"),min_content:jt("min-content"),none:jt("none"),normal:jt("normal"),oeb_page_foot:jt("oeb-page-foot"),oeb_page_head:jt("oeb-page-head"),padding_box:jt("padding-box"),page:jt("page"),relative:jt("relative"),revert:jt("revert"),right:jt("right"),same:jt("same"),scale:jt("scale"),snap_block:jt("snap-block"),snap_inline:jt("snap-inline"),solid:jt("solid"),spread:jt("spread"),_static:jt("static"),rtl:jt("rtl"),table:jt("table"),table_caption:jt("table-caption"),table_cell:jt("table-cell"),table_footer_group:jt("table-footer-group"),table_header_group:jt("table-header-group"),table_row:jt("table-row"),top:jt("top"),transparent:jt("transparent"),unset:jt("unset"),vertical_lr:jt("vertical-lr"),vertical_rl:jt("vertical-rl"),visible:jt("visible"),_true:jt("true")},si=new Wt(100,"%"),ai=new Wt(100,"pvw"),li=new Wt(100,"pvh"),hi=new Wt(0,"px");new Kt("U+0-10FFFF");var ui={"font-size":1,"line-height":2,color:3};function ci(e){return e===oi.inherit||e===oi.initial||e===oi.revert||e===oi.unset}function di(e,t){return(ui[e]||Number.MAX_VALUE)-(ui[t]||Number.MAX_VALUE)}function pi(e){return(null==e?void 0:e.length)>2&&e.startsWith("--")}var fi=class{constructor(e,t,i,n){this.x1=e,this.y1=t,this.x2=i,this.y2=n}},gi=class{constructor(e,t){this.x=e,this.y=t}},mi=class{constructor(e,t,i,n){this.left=e,this.top=t,this.right=i,this.bottom=n}},bi=class{constructor(e,t,i,n){this.low=e,this.high=t,this.winding=i,this.shapeId=n}},vi=class{constructor(e,t,i,n){this.y1=e,this.y2=t,this.x1=i,this.x2=n,l(this,"left",null),l(this,"right",null)}};function wi(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}var yi=class e{constructor(e){this.points=e}addSegments(e,t){let i=this.points,n=i.length,r=i[n-1];for(let o=0;o<n;o++){let n,s=i[o];n=r.y<s.y?new bi(r,s,1,t):new bi(s,r,-1,t),e.push(n),r=s}}withOffset(t,i){let n=[];for(let e of this.points)n.push(new gi(e.x+t,e.y+i));return new e(n)}};function xi(e,t,i,n){let r=[];for(let o=0;o<20;o++){let s=2*o*Math.PI/20;r.push(new gi(e+i*Math.sin(s),t+n*Math.cos(s)))}return new yi(r)}function Si(e,t,i,n){return new yi([new gi(e,t),new gi(i,t),new gi(i,n),new gi(e,n)])}var Ci=class{constructor(e,t,i,n){this.x=e,this.winding=t,this.shapeId=i,this.lowOrHigh=n}};function ki(e,t){let i=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(i))throw new Error("Bad intersection");return i}function Ei(e,t,i,n){let r,o,s,a;t.high.y<i&&P.warn("Error: inconsistent segment (1)"),t.low.y<=i?(r=ki(t,i),o=t.winding):(r=t.low.x,o=0),t.high.y>=n?(s=ki(t,n),a=t.winding):(s=t.high.x,a=0),r<s?(e.push(new Ci(r,o,t.shapeId,-1)),e.push(new Ci(s,a,t.shapeId,1))):(e.push(new Ci(s,a,t.shapeId,-1)),e.push(new Ci(r,o,t.shapeId,1)))}function Pi(e,t,i){let n,r=t+i,o=Array(r),s=Array(r);for(n=0;n<=r;n++)o[n]=0,s[n]=0;let a=[],l=!1,h=e.length;for(let i=0;i<h;i++){let h=e[i];o[h.shapeId]+=h.winding,s[h.shapeId]+=h.lowOrHigh;let u=!1;for(n=0;n<t;n++)if(o[n]&&!s[n]){u=!0;break}if(u)for(n=t;n<=r;n++)if(o[n]||s[n]){u=!1;break}l!=u&&(a.push(h.x),l=u)}return a}function Ni(e,t){return t?Math.ceil(e/t)*t:e}function Ti(e,t){return t?Math.floor(e/t)*t:e}function Ii(e){return new fi(e.y1,-e.x2,e.y2,-e.x1)}function Ri(e){return new fi(-e.y2,e.x1,-e.y1,e.x2)}function _i(e){return new yi(e.points.map((e=>function(e){return new gi(e.y,-e.x)}(e))))}function Ai(e,t){let i=t.length-1,n=new vi(e.y2,e.y2,e.x1,e.x2);for(;i>=0;){let e=n;n=t[i],(n.y2-n.y1<1||n.x1==e.x1&&n.x2==e.x2)&&(e.y1=n.y1,t.splice(i,1),n=e),i--}}function Li(e,t){let i=0,n=e.length;for(;i<n;){let r=Math.floor((i+n)/2);t>=e[r].y2?i=r+1:n=r}return i}function Oi(e,t){if(!e.length)return t;let i,n,r=t.y1;for(n=0;n<e.length&&(i=e[n],!(i.y2>t.y1&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2));n++)r=Math.max(r,i.y2);let o=r;for(;n<e.length&&(i=e[n],!(i.y1>=t.y2||i.x1-.1>t.x1||i.x2+.1<t.x2));n++)o=i.y2;return o=n===e.length?t.y2:Math.min(o,t.y2),o<=r?null:new fi(t.x1,r,t.x2,o)}function Fi(e,t){if(!e.length)return t;let i,n,r=t.y2;for(n=e.length-1;n>=0&&(i=e[n],!(n===e.length-1&&i.y2<t.y2))&&!(i.y1<t.y2&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2);n--)r=Math.min(r,i.y1);let o=Math.min(r,i.y2);for(;n>=0&&(i=e[n],!(i.y2<=t.y1||i.x1-.1>t.x1||i.x2+.1<t.x2));n--)o=i.y1;return o=Math.max(o,t.y1),r<=o?null:new fi(t.x1,o,t.x2,r)}var Bi=class extends Ot{constructor(){super(),l(this,"propSet",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}},Mi=class extends Ot{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}};function zi(e,t){if(e){let i=new Mi(t);try{return e.visit(i),i.value}catch(e){P.warn(e,"toInt: ")}}return t}var Di=class extends Ot{constructor(){super(),l(this,"collect",!1),l(this,"coords",[]),l(this,"name",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&0==e.num&&this.coords.push(new Wt(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,i,n,r){if(this.coords.length>0){let o=[];switch(this.coords.forEach(((e,t)=>{if("%"==e.unit){let r=t%2==0?i:n;3==t&&"circle"==this.name&&(r=Math.sqrt((i*i+n*n)/2)),o.push(e.num*r/100)}else o.push(e.num*r.queryUnitSize(e.unit,!1))})),this.name){case"polygon":if(o.length%2==0){let i=[];for(let n=0;n<o.length;n+=2)i.push(new gi(e+o[n],t+o[n+1]));return new yi(i)}break;case"rectangle":if(4==o.length)return Si(e+o[0],t+o[1],e+o[0]+o[2],t+o[1]+o[3]);break;case"ellipse":if(4==o.length)return xi(e+o[0],t+o[1],o[2],o[3]);break;case"circle":if(3==o.length)return xi(e+o[0],t+o[1],o[2],o[2])}}return null}};function Vi(e,t,i,n,r,o){if(e){let s=new Di;try{return e.visit(s),s.getShape(t,i,n,r,o)}catch(e){P.warn(e,"toShape:")}}return Si(t,i,t+n,i+r)}var Ui=class extends Ot{constructor(e){super(),this.reset=e,l(this,"counters",{}),l(this,"name",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function Hi(e,t){let i=new Ui(t);try{e.visit(i)}catch(e){P.warn(e,"toCounters:")}return i.counters}var $i=class extends Ft{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new Yt(this.transformer.transformURL(e.url,this.baseUrl))}};function ji(e){let t={};return Object.keys(e).forEach((i=>{t[i]=Array.from(e[i])})),t}var Wi=class{constructor(e,t){this.targetId=e,this.resolved=t,l(this,"pageCounters",null),l(this,"spineIndex",-1),l(this,"pageIndex",-1)}equals(e){return this===e||!!e&&(this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex)}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},Gi=class{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}},qi=class{constructor(e,t,i,n){this.counterStore=e,this.baseURL=t,this.rootScope=i,this.pageScope=n,l(this,"styler",null),l(this,"namedStringValues",{}),l(this,"runningElements",{})}setStyler(e){this.styler=e}getFragment(e){let t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(Z(e,this.baseURL),this.baseURL);return"#"===t.charAt(0)&&(t=t.substring(1)),t}getPageCounterVal(e,t){let i=()=>{let t=this.counterStore.currentPageCounters[e];return t&&t.length?t[t.length-1]:null},n=new St(this.pageScope,(()=>t(i())),`page-counter-${e}`);return this.counterStore.registerPageCounterExpr(e,(e=>t(e[e.length-1])),n),n}getPageCountersVal(e,t){let i=()=>this.counterStore.currentPageCounters[e]||[],n=new St(this.pageScope,(()=>t(i())),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,n),n}getTargetCounters(e,t,i){let n=this.counterStore.countersById[t];return!n&&i&&e&&(this.styler.styleUntilIdIsReached(e),n=this.counterStore.countersById[t]),n||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetCounterVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e),o=this.getTargetCounters(n,r,!1);if(o&&o[t]){let e=o[t];return new Et(this.rootScope,i(e[e.length-1]||null))}let s=new St(this.pageScope,(()=>{if(o=this.getTargetCounters(n,r,!0),o){if(o[t]){let e=o[t];return i(e[e.length-1]||null)}{let e=this.getTargetPageCounters(r);if(e){if(this.counterStore.resolveReference(r),e[t]){let n=e[t];return i(n[n.length-1]||null)}return i(0)}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}),`target-counter-${t}-of-${e}`);return this.counterStore.registerTargetCounterExpr(t,i,s,r),s}getTargetCountersVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e);return new St(this.pageScope,(()=>{let e=this.getTargetPageCounters(r);if(e){this.counterStore.resolveReference(r);let o=e[t]||[],s=this.getTargetCounters(n,r,!0)[t]||[];return i(o.concat(s))}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}),`target-counters-${t}-of-${e}`)}getNamedStringVal(e,t){return new St(this.pageScope,(()=>this.getRunningValue(this.namedStringValues,e,t)),`named-string-${t}-${e}`)}getRunningElementVal(e,t){return new St(this.pageScope,(()=>this.getRunningValue(this.runningElements,e,t)),`running-element-${t}-${e}`)}getRunningValue(e,t,i){let n=e[t];if(!n)return"";let r=Object.keys(n).map((e=>parseInt(e,10))).sort(ve),o=this.counterStore.currentPage,s=o.isBlankPage?o.offset-1:o.offset,a=o.isBlankPage?s:Math.max(s,...Array.from(o.container.querySelectorAll(`[${$}]`)).map((e=>parseInt(e.getAttribute($),10)))),l=-1,h=-1,u=-1,c=-1;for(let e=0;e<r.length;e++){let t=r[e],i=e>0?r[e-1]:-1,n=e<r.length-1?r[e+1]:-1;if(t>a)break;if(t>=s){if(l<0&&(l=t,c=-1),h<0)if(t===s)h=t;else{i<l&&(h=i);let e=o.container.querySelector(`[${$}="${t}"]`);if(e){let i=o.container.querySelector(`[${$}="${s}"]`);if(i||(i=o.container.querySelector(`[${$}="0"]`)),i)for(let n=i;n;n=n.firstElementChild)if(n===e){h=t;break}}else h<0&&(h=t)}u=t}else(n>a||n<0)&&(l=h=u=c=t)}return n[{first:l,start:h,last:u,"first-except":c}[i]]||""}setNamedString(e,t,i){(this.namedStringValues[e]||(this.namedStringValues[e]={}))[i]=t}setRunningElement(e,t){(this.runningElements[e]||(this.runningElements[e]={}))[t]=String(t)}},Xi=class{constructor(e){this.documentURLTransformer=e,l(this,"countersById",{}),l(this,"pageCountersById",{}),l(this,"currentPageCounters",{}),l(this,"previousPageCounters",{}),l(this,"currentPageCountersStack",[]),l(this,"pageIndicesById",{}),l(this,"currentPage",null),l(this,"newReferencesOfCurrentPage",[]),l(this,"referencesToSolve",[]),l(this,"referencesToSolveStack",[]),l(this,"unresolvedReferences",{}),l(this,"resolvedReferences",{}),l(this,"pagesCounterExprs",[]),l(this,"pageCounterExprs",[]),l(this,"targetCounterExprs",[]),this.currentPageCounters.page=[0]}createCounterListener(e){return new Gi(this,e)}createCounterResolver(e,t,i){return new qi(this,e,t,i)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){let t=this.currentPageCounters.page;t&&t.length?t[t.length-1]=e:this.currentPageCounters.page=[e]}updatePageCounters(e,t){this.previousPageCounters=ji(this.currentPageCounters);let i,n=e["counter-reset"];if(n){let e=n.evaluate(t);e&&(i=Hi(e,!0))}if(i)for(let e in i)this.definePageCounter(e,i[e]);let r,o=e["counter-increment"];if(o){let e=o.evaluate(t);e&&(r=Hi(e,!1))}r?"page"in r||(r.page=1):(r={},r.page=1);for(let e in r){this.currentPageCounters[e]||this.definePageCounter(e,0);let t=this.currentPageCounters[e];t[t.length-1]+=r[e]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=ji(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){let t=this.unresolvedReferences[e],i=this.resolvedReferences[e];i||(i=this.resolvedReferences[e]=[]);let n=!1;for(let r=0;r<this.referencesToSolve.length;){let o=this.referencesToSolve[r];if(o.targetId===e){if(o.resolve(),this.referencesToSolve.splice(r,1),t){let e=t.indexOf(o);e>=0&&t.splice(e,1)}i.push(o),n=!0}else r++}n||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some((t=>t.targetId===e))){let i=new Wi(e,t);this.newReferencesOfCurrentPage.push(i)}}finishPage(e,t){let i=Object.keys(this.currentPage.elementsById);if(i.length>0){let n=ji(this.currentPageCounters);i.forEach((i=>{this.pageCountersById[i]=n;let r=this.pageIndicesById[i];if(r&&r.pageIndex<t){let e=this.resolvedReferences[i];if(e){let t,n=this.unresolvedReferences[i];for(n||(n=this.unresolvedReferences[i]=[]);t=e.shift();)t.unresolve(),n.push(t)}}this.pageIndicesById[i]={spineIndex:e,pageIndex:t}}))}let n,r=this.previousPageCounters;for(;n=this.newReferencesOfCurrentPage.shift();){let i;n.pageCounters=r,n.spineIndex=e,n.pageIndex=t,n.isResolved()?(i=this.resolvedReferences[n.targetId],i||(i=this.resolvedReferences[n.targetId]=[])):(i=this.unresolvedReferences[n.targetId],i||(i=this.unresolvedReferences[n.targetId]=[])),i.every((e=>!n.equals(e)))&&i.push(n)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach((e=>{let i=this.unresolvedReferences[e];i&&(t=t.concat(i))})),t.sort(((e,t)=>e.spineIndex-t.spineIndex||e.pageIndex-t.pageIndex));let i=[],n=null;return t.forEach((e=>{n&&n.spineIndex===e.spineIndex&&n.pageIndex===e.pageIndex?n.refs.push(e):(n={spineIndex:e.spineIndex,pageIndex:e.pageIndex,pageCounters:e.pageCounters,refs:[e]},i.push(n))})),i}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,i){"pages"===e?this.pagesCounterExprs.push({expr:i,format:t}):this.pageCounterExprs.push({expr:i,format:t})}registerTargetCounterExpr(e,t,i,n){this.targetCounterExprs.push({name:e,expr:i,format:t,transformedId:n})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,i){if(e instanceof St){if("viv-leader"==e.str){let n=i.createElementNS("http://www.w3.org/1999/xhtml","span");return n.textContent=t,n.setAttribute("data-viv-leader",e.key),n.setAttribute("data-viv-leader-value",t),n}if(e.str.startsWith("running-element-")){let e=t&&i.querySelectorAll(`[${$}="${t}"]`);if(!e||0===e.length)return null;let n=e[e.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(n),n.style.position="",n.style.visibility="",n}if(e.str.startsWith("target-counter-")){let n=i.createElementNS("http://www.w3.org/1999/xhtml","span");return n.textContent=t,n.setAttribute(Zi,e.key),n}}let n=this.pagesCounterExprs.findIndex((t=>t.expr===e))>=0,r=!n&&this.pageCounterExprs.findIndex((t=>t.expr===e))>=0;if(n||r){let r=i.createElementNS("http://www.w3.org/1999/xhtml","span");return r.textContent=t,r.setAttribute(n?Yi:Ki,e.key),r}return null}fixPageCounterInRunningElement(e){let t=e.querySelectorAll(`[${Ki}]`);for(let e of t){let t=e.getAttribute(Ki),i=this.pageCounterExprs.find((e=>e.expr.key===t)),n=(null==i?void 0:i.expr).str,r=null==n?void 0:n.replace(/^page-counters?-/,""),o=this.currentPageCounters[r];o&&(e.textContent=i.format(o))}let i=e.querySelectorAll(`[${Zi}]`);for(let e of i)e.setAttribute(Ji,!0)}finishLastPage(e){let t=e.root.querySelectorAll(`[${Yi}]`),i=e.contentContainer.childElementCount;for(let e of t){let t=e.getAttribute(Yi),n=this.pagesCounterExprs.findIndex((e=>e.expr.key===t));e.textContent=this.pagesCounterExprs[n].format([i])}let n=e.root.querySelectorAll(`[${Ji}]`);for(let e of n){let t=e.getAttribute(Zi),i=this.targetCounterExprs.find((e=>e.expr.key===t));if(i&&i.transformedId){let t=this.pageCountersById[i.transformedId];if(t){let n=t[i.name];n&&(e.textContent=i.format(n[n.length-1]))}}}}createLayoutConstraint(e){return new Qi(this,e)}},Yi="data-vivliostyle-pages-counter",Ki="data-vivliostyle-page-counter",Zi="data-vivliostyle-target-counter",Ji="data-vivliostyle-target-counter-in-running",Qi=class{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;let t=e.viewNode;if(!t||1!==t.nodeType)return!0;let i=t.getAttribute("data-vivliostyle-id")||t.getAttribute("id")||t.getAttribute("name");if(!i||!this.counterStore.resolvedReferences[i]&&!this.counterStore.unresolvedReferences[i])return!0;let n=this.counterStore.pageIndicesById[i];return!n||this.pageIndex>=n.pageIndex}};function en(e){if((e=e.substr(1)).match(/^[^0-9a-fA-F\n\r]$/))return e;let t=parseInt(e,16);return isNaN(t)?"":0===t||t>=55296&&t<=57343||t>1114111?"":String.fromCodePoint(t)}function tn(e){return e.replace(/\\([0-9a-fA-F]{1,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,en)}var nn=class{constructor(){l(this,"type"),l(this,"precededBySpace",!1),l(this,"num",0),l(this,"text",""),l(this,"position",0),this.type=0}toString(){switch(this.type){case 10:return"(";case 11:return")";case 12:return"{";case 13:return"}";case 14:return"[";case 15:return"]";case 16:return",";case 17:return";";case 18:return":";case 19:return"/";case 21:return"%";case 22:return"?";case 23:return"+";case 24:return"-";case 25:return"||";case 26:return"&&";case 31:return"!";case 32:return"$";case 33:return"^";case 34:return"|";case 35:return"~";case 36:return"*";case 37:return">";case 38:return"<";case 39:return"=";case 41:return"!=";case 42:return"$=";case 43:return"^=";case 44:return"|=";case 45:return"~=";case 46:return"*=";case 47:return">=";case 48:return"<=";case 49:return"==";case 50:return"::";case 51:return"\x3c!--";case 52:return"--\x3e";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return"@"+this.text;case 7:return"#"+this.text;case 6:return this.text+"(";case 9:return"."+this.text;case 0:return"/*EOF*/";default:return this.text}}};function rn(e,t){let i,n=Array(128);for(i=0;i<128;i++)n[i]=e;for(n.NaN=35==e?35:72,i=0;i<t.length;i+=2)n[t[i]]=t[i+1];return n}var on=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];on.NaN=80;var sn=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];sn.NaN=43;var an=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];sn.NaN=43;var ln=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];ln.NaN=35;var hn=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];hn.NaN=45;var un=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];un.NaN=37;var cn=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];cn.NaN=38;var dn=rn(35,[61,36]),pn=rn(35,[58,77]),fn=rn(35,[61,36,124,50]),gn=rn(35,[38,51]),mn=rn(35,[42,54]),bn=rn(39,[42,55]),vn=rn(54,[42,55,47,56]),wn=rn(62,[62,82]),yn=rn(35,[61,36,33,70]),xn=rn(62,[45,71]),Sn=rn(63,[45,81]),Cn=rn(76,[10,72,13,72]),kn=rn(39,[39,46,10,72,13,72,92,48]),En=rn(39,[34,46,10,72,13,72,92,49]),Pn=rn(39,[39,47,10,74,13,74,92,48]),Nn=rn(39,[34,47,10,74,13,74,92,49]),Tn=rn(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),In=rn(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),Rn=rn(39,[39,68,10,74,13,74,92,75,NaN,67]),_n=rn(39,[34,68,10,74,13,74,92,75,NaN,67]),An=rn(72,[9,39,10,39,13,39,32,39,41,69]),Ln=class{constructor(e,t){this.input=e,this.handler=t,l(this,"indexMask"),l(this,"buffer"),l(this,"tail",0),l(this,"curr",0),l(this,"position",0),this.indexMask=15,this.buffer=Array(this.indexMask+1);for(let e=0;e<=this.indexMask;e++)this.buffer[e]=new nn}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let e=this.tail,t=this.curr,i=this.indexMask;if(e>=t?t+=i:t--,t==e)throw new Error("F_CSSTOK_INTERNAL");let n=on,r=this.input,o=this.position,s=this.buffer,a=0,l=0,h="",u=0,c=!1,d=s[e],p=-9;for(;;){let f=r.charCodeAt(o);switch(n[f]||n[65]){case 72:h=r.substring(l,o),a=isNaN(f)?0:54,n=on;break;case 1:o++,c=!0;continue;case 2:l=o++,n=un;continue;case 3:a=1,l=o++,n=sn;continue;case 4:l=o++,a=31,n=dn;continue;case 33:a=2,l=++o,n=kn;continue;case 34:a=2,l=++o,n=En;continue;case 6:l=++o,a=7,n=sn;continue;case 7:l=o++,a=32,n=dn;continue;case 8:l=o++,a=21;break;case 9:l=o++,a=32,n=gn;continue;case 10:l=o++,a=10;break;case 11:l=o++,a=11;break;case 12:l=o++,a=36,n=dn;continue;case 13:l=o++,a=23;break;case 14:l=o++,a=16;break;case 15:a=24,l=o++,n=ln;continue;case 16:l=o++,n=an;continue;case 78:l=o++,a=9,n=sn;continue;case 17:l=o++,a=19,n=mn;continue;case 18:l=o++,a=18,n=pn;continue;case 77:o++,a=50;break;case 19:l=o++,a=17;break;case 20:l=o++,a=38,n=yn;continue;case 21:l=o++,a=39,n=dn;continue;case 22:l=o++,a=37,n=dn;continue;case 23:l=o++,a=22;break;case 24:l=++o,a=20,n=sn;continue;case 25:l=o++,a=14;break;case 26:l=o++,a=15;break;case 27:l=o++,a=12;break;case 28:l=o++,a=13;break;case 29:l=o++,p=l,a=1,n=Cn;continue;case 30:l=o++,a=33,n=dn;continue;case 31:l=o++,a=34,n=fn;continue;case 32:l=o++,a=35,n=dn;continue;case 35:break;case 36:o++,a=a+41-31;break;case 37:a=5,u=parseInt(r.substring(l,o),10);break;case 38:a=4,u=parseFloat(r.substring(l,o));break;case 39:o++;continue;case 40:a=3,u=parseFloat(r.substring(l,o)),l=o++,n=sn;continue;case 41:a=3,u=parseFloat(r.substring(l,o)),h="%",l=o++;break;case 42:o++,n=cn;continue;case 43:if(h=tn(r.substring(l,o)),27===a&&63===f||1===a&&"u"===h.toLowerCase()&&/^(\bu\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\s+|\/\*([^*]|\*[^/])*\*\/)+[;}]/i.test(r.substring(o-1))){a=27,o++;continue}break;case 44:p=o++,n=Cn;continue;case 45:h=tn(r.substring(l,o));break;case 46:h=r.substring(l,o),o++;break;case 47:h=tn(r.substring(l,o)),o++;break;case 48:p=o,o+=2,n=Pn;continue;case 49:p=o,o+=2,n=Nn;continue;case 50:o++,a=25;break;case 51:o++,a=26;break;case 52:if(h=r.substring(l,o),1==a){if(o++,"url"==h.toLowerCase()){n=Tn;continue}a=6}break;case 53:if(h=tn(r.substring(l,o)),1==a){if(o++,"url"==h.toLowerCase()){n=Tn;continue}a=6}break;case 54:n=bn,o++;continue;case 55:n=vn,o++;continue;case 56:n=on,o++;continue;case 57:n=wn,o++,">"!==r[o]&&(a=1,n=sn);continue;case 81:a=51,h=r.substring(l,++o),n=on;break;case 82:a=52,h=r.substring(l,++o),n=on;break;case 58:a=5,n=un,o++;continue;case 59:a=4,n=cn,o++;continue;case 60:a=1,n=sn,o++;continue;case 61:a=1,n=Cn,p=o++;continue;case 62:o--;break;case 63:o-=2;break;case 64:l=o++,n=In;continue;case 65:l=++o,n=Rn;continue;case 66:l=++o,n=_n;continue;case 67:a=8,h=tn(r.substring(l,o)),o++;break;case 69:o++;break;case 70:n=xn,o++;continue;case 71:n=Sn,o++;continue;case 79:if(o-p<8&&r.substring(p+1,o+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){o++;continue}case 68:a=8,h=tn(r.substring(l,o)),o++,n=An;continue;case 74:if(o++,o-p<9&&r.substring(p+1,o).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;a=54,h="E_CSS_UNEXPECTED_NEWLINE",n=on;break;case 73:if(o-p<9&&r.substring(p+1,o+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){o++,n=sn;continue}h=tn(r.substring(l,o));break;case 75:p=o++;continue;case 76:o++,n=hn;continue;default:if(n!==on){a=54,h="E_CSS_UNEXPECTED_STATE";break}l=o,a=0}if(d.type=a,d.precededBySpace=c,d.num=u,d.text=h,d.position=l,e++,e>=t)break;n=on,c=!1,d=s[e&i]}this.position=o,this.tail=e&i}},On=null,Fn=null;function Bn(){return On}function Mn(e){if(!On)throw new Error("E_TASK_NO_CONTEXT");On.name||(On.name=e);let t=On,i=new qn(t,t.top,e);return t.top=i,i.state=1,i}function zn(e){return new Wn(e)}function Dn(e,t,i){let n=Mn(e);n.handler=i;try{t(n)}catch(e){n.task.raise(e,n)}return n.result()}function Vn(e,t){return(On?On.getScheduler():Fn||function(e){return new Hn(e||new Un)}()).run(e,t)}var Un=class{currentTime(){return(new Date).valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}},Hn=class{constructor(e){this.timer=e,l(this,"timeout",1),l(this,"slice",25),l(this,"sliceOverTime",0),l(this,"queue"),l(this,"wakeupTime",null),l(this,"timeoutToken",null),l(this,"inTimeSlice",!1),l(this,"order",0),this.queue=new ee,Fn||(Fn=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(null!=this.timeoutToken){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let i=e-t;i<=this.timeout&&(i=this.timeout),this.wakeupTime=t+i,this.timeoutToken=this.timer.setTimeout((()=>{this.timeoutToken=null,this.doTimeSlice()}),i)}schedule(e,t){let i=e,n=this.timer.currentTime();i.order=this.order++,i.scheduledTime=n+(t||0),this.queue.add(i),this.arm()}doTimeSlice(){null!=this.timeoutToken&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){let t=this.queue.peek();if(t.scheduledTime>e||(this.queue.remove(),t.canceled||t.resumeInternal(),e=this.timer.currentTime(),e>=this.sliceOverTime))break}}catch(e){P.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){let i=new jn(this,t||"");i.top=new qn(i,null,"bootstrap"),i.top.state=1,i.top.then((()=>{let t=()=>{i.running=!1;for(let e of i.callbacks)try{e()}catch(e){P.error(e)}};try{e().then((e=>{i.result=e,t()}))}catch(e){i.raise(e),t()}}));let n=On;return On=i,this.schedule(i.top.suspend("bootstrap")),On=n,i}},$n=class{constructor(e){this.task=e,l(this,"scheduledTime",0),l(this,"order",0),l(this,"result",null),l(this,"canceled",!1)}compare(e){let t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){let e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;let t=On;return On=e,e.top.finish(this.result),On=t,!0}return!1}cancel(){this.canceled=!0}},jn=class{constructor(e,t){this.scheduler=e,this.name=t,l(this,"callbacks",[]),l(this,"exception",null),l(this,"running",!0),l(this,"result",null),l(this,"waitTarget",null),l(this,"top",null),l(this,"continuation",null)}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==On&&this.continuation){this.continuation.cancel();let e=new $n(this);this.waitTarget="interrupt",this.continuation=e,this.scheduler.schedule(e)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){let e=Mn("Task.join");if(this.running){let t=e.suspend(this);this.whenDone((()=>{t.schedule(this.result)}))}else e.finish(this.result);return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&P.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let e=this.top;for(;e&&e!=t;)e=e.parent;e==t&&(this.top=e)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}\n\t---- async ---\n`:"";for(let e=this.top;e;e=e.parent)t+="\t",t+=e.getName(),t+="\n";e.frameTrace=t}}},Wn=class e{constructor(e){this.value=e}then(e){e(this.value)}thenAsync(e){return e(this.value)}thenReturn(t){return new e(t)}thenFinish(e){e.finish(this.value)}isPending(){return!1}get(){return this.value}},Gn=class{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){let t=new qn(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=1,this.frame.parent=t,this.frame.then((i=>{e(i).then((e=>{t.finish(e)}))})),t.result()}return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync((()=>new Wn(e))):new Wn(e)}thenFinish(e){this.isPending()?this.then((t=>{e.finish(t)})):e.finish(this.frame.res)}isPending(){return 1==this.frame.state}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}},qn=class{constructor(e,t,i){this.task=e,this.parent=t,this.name=i,l(this,"res",null),l(this,"state"),l(this,"callback",null),l(this,"handler",null),this.state=0}checkEnvironment(){if(!On)throw new Error("F_TASK_NO_CONTEXT");if(this!==On.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new Gn(this)}finish(e){this.checkEnvironment(),On&&!On.exception&&(this.res=e),this.state=2;let t=this.parent;if(On&&(On.top=t),this.callback){try{this.callback(e)}catch(e){this.task.raise(e,t)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case 1:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case 2:{let t=this.task,i=this.parent;try{e(this.res),this.state=3}catch(e){this.state=3,t.raise(e,i)}break}case 3:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let e=Mn("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(P.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){let t=Mn("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){let t=Mn("Frame.loop"),i=n=>{try{for(;n;){let t=e();if(t.isPending())return void t.then(i);t.then((e=>{n=e}))}t.finish(!0)}catch(e){t.task.raise(e,t)}};return i(!0),t.result()}loopWithFrame(e){let t=On;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop((()=>{let i;do{let n=new Xn(t,t.top);t.top=n,n.state=1,e(n),i=n.result()}while(!i.isPending()&&i.get());return i}))}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");let t=new $n(this.task);return this.task.continuation=t,On=null,this.task.waitTarget=e||null,t}},Xn=class extends qn{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}},Yn=class{constructor(e,t){this.fetch=e,l(this,"name"),l(this,"arrived",!1),l(this,"resource",null),l(this,"task",null),l(this,"piggybacks",[]),this.name=t}start(){this.task||(this.task=Bn().getScheduler().run((()=>{let e=Mn("Fetcher.run");return this.fetch().then((t=>{let i=this.piggybacks;if(this.arrived=!0,this.resource=t,this.task=null,this.piggybacks=[],i)for(let e=0;e<i.length;e++)try{i[e](t)}catch(e){P.error(e,"Error:")}e.finish(t)})),e.result()}),this.name))}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?zn(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},Kn=e=>{if(0==e.length)return zn(!0);if(1==e.length)return e[0].get().thenReturn(!0);let t=Mn("waitForFetches"),i=0;return t.loop((()=>{for(;i<e.length;){let t=e[i++];if(!t.hasArrived())return t.get().thenReturn(!0)}return zn(!1)})).then((()=>{t.finish(!0)})),t.result()},Zn='\n@media screen {\n  [data-vivliostyle-viewer-viewport] {\n    background: #aaaaaa;\n  }\n\n  [data-vivliostyle-page-container] {\n    background: white;\n    z-index: 0;\n  }\n\n  [data-vivliostyle-viewer-viewport] {\n    box-sizing: border-box;\n    display: flex;\n    overflow: auto;\n    position: relative;\n  }\n\n  [data-vivliostyle-outer-zoom-box] {\n    margin: auto;\n    overflow: hidden;\n    flex: none;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {\n    display: flex;\n    flex: none;\n    justify-content: center;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="ltr"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="rtl"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row-reverse;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {\n    margin: 0 auto;\n    flex: none;\n    transform-origin: center top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side="left"] {\n    margin-right: 1px;\n    transform-origin: right top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side="right"] {\n    margin-left: 1px;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page="true"] {\n    margin-left: auto;\n    margin-right: auto;\n    transform-origin: center top;\n  }\n}\n',Jn="\n[data-vivliostyle-layout-box] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  z-index: -1;\n  transform-origin: left top;\n}\n\n[data-vivliostyle-debug] [data-vivliostyle-layout-box] {\n  right: auto;\n  bottom: auto;\n  overflow: visible;\n  z-index: auto;\n}\n\n[data-vivliostyle-spread-container] {\n  transform: scale(var(--viv-outputScale,1));\n  transform-origin: left top;\n}\n\n/* Emulate high pixel ratio using zoom & transform:scale() */\n@supports (zoom: 8) {\n  [data-vivliostyle-layout-box] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  [data-vivliostyle-spread-container] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */\n  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {\n    border-width: medium;\n    outline-width: medium;\n    column-rule-width: medium;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {\n    background-color: #f4f4f4;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {\n    border-radius: 4px;\n    background: #c7c7c7;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {\n    background: #7d7d7d;\n  }\n}\n\n[data-vivliostyle-page-container] {\n  position: relative;\n}\n\n[data-vivliostyle-bleed-box] {\n  position: absolute;\n  overflow: hidden;\n  background-origin: content-box !important;\n  box-sizing: border-box;\n}\n\n[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {\n  display: none;\n}\n\n[data-vivliostyle-toc-box] {\n  position: absolute;\n  left: 3px;\n  top: 3px;\n  overflow: scroll;\n  overflow-x: hidden;\n  background: rgba(248, 248, 248, 0.9);\n  border-radius: 2px;\n  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);\n}\n\n@media print {\n  [data-vivliostyle-toc-box] {\n    display: none;\n  }\n\n  [data-vivliostyle-outer-zoom-box],\n  [data-vivliostyle-spread-container] {\n    width: 100% !important;\n    height: 100% !important;\n  }\n\n  [data-vivliostyle-spread-container] {\n    --viv-outputScale: 1 !important;\n    --viv-devicePixelRatio: 1 !important;\n    zoom: normal !important;\n    transform: none !important;\n  }\n\n  @supports (zoom: 8) {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      zoom: var(--viv-outputPixelRatio,1);\n      transform: scale(calc(1 / var(--viv-outputPixelRatio,1)));\n      transform-origin: left top;\n    }\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n    display: block !important;\n    max-height: 100vh;\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {\n    break-after: page;\n  }\n\n  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */\n  @-moz-document url-prefix()  {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {\n      top: -1px;\n      margin-top: 1px;\n      margin-bottom: -1px;\n    }\n    /* Workaround Gecko problem on page break */\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      break-after: auto !important;\n      height: 100% !important;\n    }\n  }\n}\n",Qn="\n/*\n * Copyright 2013 Google, Inc.\n * Copyright 2015 Daishinsha Inc.\n * Copyright 2019 Vivliostyle Foundation\n *\n * CSS property validation.\n */\nNUM = POS_NUM | ZERO | NEGATIVE;\nNNEG_NUM = POS_NUM | ZERO;\nINT = POS_INT | ZERO | NEGATIVE;\nNNEG_INT = POS_INT | ZERO;\nPERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;\nSTRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;\nNNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;\nLENGTH = POS_LENGTH | ZERO | NEGATIVE;\nNNEG_LENGTH = POS_LENGTH | ZERO;\nPLENGTH = LENGTH | PERCENTAGE;\nPPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;\nALENGTH = LENGTH | auto;\nAPLENGTH = PLENGTH | auto;\nPAPLENGTH = PPLENGTH | auto;\nANGLE = POS_ANGLE | ZERO | NEGATIVE;\nLENGTH_OR_NUM = LENGTH | NUM;\nANGLE_OR_NUM = ANGLE | NUM;\nMIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;\nBG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;\nURI_OR_NONE = URI | none;\nIMAGE = URI | IMAGE_FUNCTION | none;\nbackground-attachment = COMMA( [scroll | fixed | local]+ );\nbackground-color = COLOR;\nbackground-image = COMMA( IMAGE+ );\nbackground-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\nbackground-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );\nborder-collapse = collapse | separate;\nBORDER_SIDE_COLOR = COLOR;\nBORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;\nBORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;\nborder-spacing = LENGTH LENGTH?;\nborder-top-color = BORDER_SIDE_COLOR;\nborder-right-color = BORDER_SIDE_COLOR;\nborder-bottom-color = BORDER_SIDE_COLOR;\nborder-left-color = BORDER_SIDE_COLOR;\nborder-top-style = BORDER_SIDE_STYLE;\nborder-right-style = BORDER_SIDE_STYLE;\nborder-bottom-style = BORDER_SIDE_STYLE;\nborder-left-style = BORDER_SIDE_STYLE;\nborder-top-width = BORDER_SIDE_WIDTH;\nborder-right-width = BORDER_SIDE_WIDTH;\nborder-bottom-width = BORDER_SIDE_WIDTH;\nborder-left-width = BORDER_SIDE_WIDTH;\nBORDER_RADIUS = PLENGTH{1,2};\nborder-top-left-radius = BORDER_RADIUS;\nborder-top-right-radius = BORDER_RADIUS;\nborder-bottom-right-radius = BORDER_RADIUS;\nborder-bottom-left-radius = BORDER_RADIUS;\nborder-image-source = IMAGE;\nborder-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */\nborder-image-width = [NUM | PLENGTH | auto]{1,4};\nborder-image-outset = [NUM | LENGTH]{1,4};\nborder-image-repeat = [ stretch | repeat | round | space ]{1,2};\nbottom = APLENGTH;\ncaption-side = top | bottom;\nclear = none | left | right | top | bottom | inline-start | inline-end | block-start | block-end | both | all | same;\nclip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;\ncolor = COLOR;\nLIST_STYLE_TYPE = IDENT;\nTYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;\nATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);\nCONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |\n    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |\n    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |\n    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |\n    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |\n    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |\n    leader([ dotted | solid | space ] | STRING ) |\n    open-quote | close-quote | no-open-quote | no-close-quote |\n    content([ text | before | after | first-letter ]?) |\n    string(IDENT [first | start | last | first-except]?) |\n    element(IDENT [first | start | last | first-except]?) ]+;\nCONTENT = normal | none | CONTENT_LIST;\ncontent = CONTENT;\nCOUNTER = [ IDENT INT? ]+ | none;\ncounter-increment = COUNTER;\ncounter-reset = COUNTER;\ncounter-set = COUNTER;\ncursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |\n    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);\ndirection = ltr | rtl;\ndisplay = inline | block | list-item | inline-block | table | inline-table | table-row-group |\n    table-header-group | table-footer-group | table-row | table-column-group | table-column |\n    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |\n    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |\n    flow-root | grid | inline-grid | contents;\nempty-cells = show | hide;\nFAMILY = SPACE(IDENT+) | STRING;\nFAMILY_LIST = COMMA( FAMILY+ );\nfont-family = FAMILY_LIST;\nfont-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;\nfont-style = normal | italic | oblique;\nfont-weight = normal | bold | bolder | lighter | POS_NUM;\nheight = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nleft = APLENGTH;\nletter-spacing = normal | LENGTH_OR_NUM;\nline-height = normal | POS_NUM | PPLENGTH;\nlist-style-image = IMAGE;\nlist-style-position = inside | outside;\nlist-style-type = LIST_STYLE_TYPE;\nmargin-right = APLENGTH;\nmargin-left = APLENGTH;\nmargin-top = APLENGTH;\nmargin-bottom = APLENGTH;\nNPLENGTH = none | PLENGTH;\nmax-height = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-width = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-height = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-width = APLENGTH | MIN_MAX_FIT_CONTENT;\norphans = POS_INT;\noutline-offset = LENGTH;\noutline-color = COLOR | invert;\noutline-style = BORDER_SIDE_STYLE;\noutline-width = BORDER_SIDE_WIDTH;\noverflow = visible | hidden | scroll | auto | clip;\npadding-right = PPLENGTH;\npadding-left = PPLENGTH;\npadding-top = PPLENGTH;\npadding-bottom = PPLENGTH;\nPAGE_BREAK = auto | always | avoid | left | right | recto | verso;\npage-break-after = PAGE_BREAK;\npage-break-before = PAGE_BREAK;\npage-break-inside = avoid | auto;\nposition = static | relative | absolute | fixed | running(IDENT);\nquotes = [STRING STRING]+ | none | auto;\nright = APLENGTH;\ntable-layout = auto | fixed;\ntext-align = left | right | center | justify | start | end;\ntext-indent = PLENGTH;\ntext-transform = capitalize | uppercase | lowercase | none;\ntop = APLENGTH;\nvertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;\nvisibility = visible | hidden | collapse;\nwhite-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;\nwidows = POS_INT;\nwidth = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nword-spacing = normal | LENGTH_OR_NUM;\nz-index = auto | INT;\n\n[epub,moz,webkit]hyphens = auto | manual | none;\n[webkit]hyphenate-character = auto | STRING;\n\n/* css-logical */\nmargin-block-start = APLENGTH;\nmargin-block-end = APLENGTH;\nmargin-inline-start = APLENGTH;\nmargin-inline-end = APLENGTH;\npadding-block-start = APLENGTH;\npadding-block-end = APLENGTH;\npadding-inline-start = APLENGTH;\npadding-inline-end = APLENGTH;\nborder-block-start-color = BORDER_SIDE_COLOR;\nborder-block-end-color = BORDER_SIDE_COLOR;\nborder-inline-start-color = BORDER_SIDE_COLOR;\nborder-inline-end-color = BORDER_SIDE_COLOR;\nborder-block-start-style = BORDER_SIDE_STYLE;\nborder-block-end-style = BORDER_SIDE_STYLE;\nborder-inline-start-style = BORDER_SIDE_STYLE;\nborder-inline-end-style = BORDER_SIDE_STYLE;\nborder-block-start-width = BORDER_SIDE_WIDTH;\nborder-block-end-width = BORDER_SIDE_WIDTH;\nborder-inline-start-width = BORDER_SIDE_WIDTH;\nborder-inline-end-width = BORDER_SIDE_WIDTH;\nblock-start = APLENGTH;\nblock-end = APLENGTH;\ninline-start = APLENGTH;\ninline-end = APLENGTH;\nblock-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\ninline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;\n\nSHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |\n    polygon( SPACE(PLENGTH+)+ );\n[epubx]shape-inside = SHAPE;\n[epubx,webkit]shape-outside = SHAPE;\n[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;\n\nTRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |\n scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);\n[epub]transform = none | TRANSFORM_FUNCTION+;\n[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */\n\nBOX = border-box | padding-box | content-box;\nSHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */\n[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );\n[webkit]background-origin = COMMA( BOX+ );\n[webkit]background-clip = COMMA( BOX+ );\n[webkit]box-shadow = none | COMMA( SHADOW+ );\ntext-shadow = none |  COMMA( SHADOW+ );\n[webkit]box-decoration-break = slice | clone;\nFILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))\n                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)\n                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);\nFILTER_FUNCTION_LIST = FILTER_FUNCTION+;\n[webkit]filter = none | FILTER_FUNCTION_LIST;\n\nopacity = NUM;\n\n[moz,webkit]column-width = LENGTH | auto;\n[moz,webkit]column-count = INT | auto;\n[moz,webkit]column-gap = LENGTH | normal;\n[moz,webkit]column-rule-color = COLOR;\n[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;\n[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;\nBREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;\nbreak-before = BREAK;\nbreak-after = BREAK;\nbreak-inside = auto | avoid | avoid-page | avoid-column | avoid-region;\n[webkit]column-span = none | auto | all;\n[moz]column-fill = auto | balance | balance-all;\nmargin-break = auto | keep | discard;\n\nsrc = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */\n\n[epubx,webkit]flow-from = IDENT;\n[epubx,webkit]flow-into = IDENT;\n[epubx]flow-linger = INT | none;\n[epubx]flow-priority = INT;\n[epubx]flow-options = none | [ exclusive || last || static ];\n[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */\n[epubx]min-page-width = LENGTH;\n[epubx]min-page-height = LENGTH;\n[epubx]required = true | false;\n[epubx]enabled = true | false;\n[epubx]conflicting-partitions = COMMA(IDENT+);\n[epubx]required-partitions = COMMA(IDENT+);\n[epubx]snap-height = LENGTH | none;\n[epubx]snap-width = LENGTH | none;\n[epubx]flow-consume = all | some;\n[epubx]utilization = NUM;\n[epubx]text-zoom = font-size | scale;\n\n[adapt]template = URI_OR_NONE | footnote;\n[adapt]behavior = IDENT;\n\n/* CSS Fonts */\nCOMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];\nDISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];\nHISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];\nCONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];\nfont-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];\nfont-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;\nNUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];\nNUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];\nNUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];\nfont-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];\nEAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];\nEAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];\nfont-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];\nfont-variant_css2 = normal | small-caps; /* for font shorthand */\nfont-size-adjust = none | NNEG_NUM;\n[webkit]font-kerning = auto | normal | none;\nfont-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );\nFONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;\nfont-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;\nfont-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */\nfont-display = [ auto | block | swap | fallback | optional ];\nunicode-range = COMMA( URANGE+ );\n\n/* CSS Images */\nimage-resolution = RESOLUTION;\nobject-fit = fill | contain | cover | none | scale-down;\nobject-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\n\n/* CSS Paged Media */\nPAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0\n          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0\n          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0\n          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0\n          | letter | legal | ledger;\nbleed = auto | LENGTH;\nmarks = none | [ crop || cross ];\nsize = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];\ncrop-offset = auto | LENGTH;\ncrop-marks-line-color = auto | COLOR;\n\n/* CSS Page Floats */\nfloat-reference = inline | column | region | page;\nfloat = none | footnote | [ block-start || block-end || inline-start || inline-end || snap-block || snap-inline || left || right || top || bottom ];\nfloat-min-wrap-block = PPLENGTH;\n\n/* CSS Ruby */\nruby-align = start | center | space-between | space-around;\nruby-position = over | under | inter-character;\n\n/* CSS Size Adjust */\n[moz,webkit]text-size-adjust = auto | none | POS_PERCENTAGE;\n\n/* CSS Text */\n[webkit]line-break = auto | loose | normal | strict | anywhere;\noverflow-wrap = normal | break-word | anywhere;\n[moz]tab-size = NNEG_INT | NNEG_LENGTH;\n[moz]text-align-last = auto | start | end | left | right | center | justify;\ntext-justify = auto | none | inter-word | inter-character;\nword-break = normal | keep-all | break-all | break-word;\ntext-spacing-trim = auto | normal | space-all | trim-both | trim-auto |\n    [[ trim-start | space-start | space-first ] ||\n     [ trim-end | space-end | allow-end ] ||\n     [ trim-adjacent | space-adjacent ]];\ntext-autospace = normal | auto | no-autospace |\n    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];\nhanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];\n\n/* CSS Text Decoration */\n[webkit]text-decoration-color = COLOR;\n[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];\n[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];\n[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;\n[webkit]text-decoration-thickness = from-font | APLENGTH;\n[epub,webkit]text-emphasis-color = COLOR;\n[webkit]text-emphasis-position = [ over | under ] [ right | left ];\n[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;\n[webkit]text-underline-position = auto | [ under || [ left | right ]];\n\n/* CSS Transforms */\n[webkit]backface-visibility = visible | hidden;\n\n/* CSS UI */\n[moz,webkit]box-sizing = content-box | padding-box | border-box;\ntext-overflow = [clip | ellipsis | STRING]{1,2};\n\n/* CSS Writing Modes */\n[epub,webkit]text-combine = none | horizontal;\ntext-combine-upright = none | all; /* relaxed */\n[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;\nunicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;\n[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;\n\n/* CSS Flex box */\nFLEX_BASIS = content | PAPLENGTH;\nflex-direction = row | row-reverse | column | column-reverse;\nflex-wrap = nowrap | wrap | wrap-reverse;\norder = INT;\nflex-grow = NNEG_NUM;\nflex-shrink = NNEG_NUM;\nflex-basis = FLEX_BASIS;\nflex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];\njustify-content = flex-start | flex-end | center | space-between | space-around;\nalign-items = flex-start | flex-end | center | baseline | stretch;\nalign-self = auto | flex-start | flex-end | center | baseline | stretch;\nalign-content = flex-start | flex-end | center | space-between | space-around | stretch;\n\n/* Pointer Events */\ntouch-action = auto | none | [ pan-x || pan-y ] | manipulation;\n\n/* SVG 2 */\nOPACITY_VALUE = NUM | PERCENTAGE;\nDASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );\nPAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;\ncolor-interpolation = auto | sRGB | linearRGB;\ncolor-rendering = auto | optimizeSpeed | optimizeQuality;\nfill = PAINT;\nfill-opacity = OPACITY_VALUE;\nfill-rule = nonzero | evenodd;\nglyph-orientation-vertical = auto | NUM | ANGLE;\nimage-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;\nmarker-start = none | URI;\nmarker-mid = none | URI;\nmarker-end = none | URI;\npointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;\npaint-order = normal | [ fill || stroke || markers ];\nshape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;\nstop-color = COLOR;\nstop-opacity = OPACITY_VALUE;\nstroke = PAINT;\nstroke-dasharray = none | DASH_ARRAY;\nstroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;\nstroke-linecap = butt | round | square;\nstroke-linejoin = miter | round | bevel;\nstroke-miterlimit = NUM;\nstroke-opacity = OPACITY_VALUE;\nstroke-width = PERCENTAGE | LENGTH_OR_NUM;\ntext-anchor = start | middle | end;\ntext-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;\nvector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );\n\n/* SVG 1.1 */\nalignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;\nbaseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;\ndominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;\nmask = none | URI;\n\n/* css-masking-1 */\nSHAPE_RADIUS = PLENGTH | closest-side | farthest-side;\nFILL_RULE = nonzero | evenodd;\nSHAPE_BOX = BOX | margin-box;\nGEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;\nBASIC_SHAPE =\n    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )\n  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )\n  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )\n  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );\n[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];\nclip-rule = nonzero | evenodd;\n\n/* filters */\nflood-color = COLOR;\nflood-opacity = OPACITY_VALUE;\nlighting-color = COLOR;\n\n/* compositing-1 */\nBLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;\nmix-blend-mode = BLEND_MODE;\nisolation = auto | isolate;\nbackground-blend-mode = COMMA( BLEND_MODE+ );\n\n/* CSS GCPM */\nstring-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );\nfootnote-policy = auto | line;\n\n/* CSS Repeated Headers and Footers */\n[viv]repeat-on-break = auto | none | header | footer;\n\n/* Compatibility */\n[webkit]text-fill-color = COLOR;\n[webkit]text-stroke-color = COLOR;\n[webkit]text-stroke-width = BORDER_SIDE_WIDTH;\n\nDEFAULTS\n\nbackground-attachment: scroll;\nbackground-color: transparent;\nbackground-image: none;\nbackground-repeat: repeat;\nbackground-position: 0% 0%;\nbackground-clip: border-box;\nbackground-origin: padding-box;\nbackground-size: auto;\nborder-top-color: currentColor;\nborder-right-color: currentColor;\nborder-bottom-color: currentColor;\nborder-left-color: currentColor;\nborder-top-style: none;\nborder-right-style: none;\nborder-bottom-style: none;\nborder-left-style: none;\nborder-top-width: 3px;\nborder-right-width: 3px;\nborder-bottom-width: 3px;\nborder-left-width: 3px;\nborder-top-left-radius: 0;\nborder-top-right-radius: 0;\nborder-bottom-right-radius: 0;\nborder-bottom-left-radius: 0;\nborder-image-source: none;\nborder-image-slice: 100%;\nborder-image-width: 1;\nborder-image-outset: 0;\nborder-image-repeat: stretch;\ncolumn-count: auto;\ncolumn-gap: normal;\ncolumn-width: auto;\ncolumn-rule-color: currentColor;\ncolumn-rule-style: none;\ncolumn-rule-width: 3px;\ncolumn-fill: balance;\noutline-color: currentColor;\noutline-style: none;\noutline-width: 3px;\nflex-direction: row;\nflex-wrap: nowrap;\nfont-family: serif;\nfont-style: normal;\nfont-size: medium;\nfont-size-adjust: none;\nfont-kerning: auto;\nfont-feature-settings: normal;\nfont-variant-ligatures: normal;\nfont-variant-caps: normal;\nfont-variant-numeric: normal;\nfont-variant-east-asian: normal;\nfont-weight: normal;\nfont-stretch: normal;\nline-height: normal;\nlist-style-image: none;\nlist-style-position: outside;\nlist-style-type: disc;\nmargin-bottom: auto;\nmargin-left: auto;\nmargin-right: auto;\nmargin-top: auto;\npadding-bottom: auto;\npadding-left: auto;\npadding-right: auto;\npadding-top: auto;\ntext-autospace: normal;\ntext-emphasis-color: currentColor;\ntext-emphasis-style: none;\ntext-spacing-trim: normal;\ntext-stroke-color: currentColor;\ntext-stroke-width: 0;\nmarker-start: none;\nmarker-mid: none;\nmarker-end: none;\n\n/* css-logical */\nborder-block-start-color: currentColor;\nborder-block-end-color: currentColor;\nborder-inline-start-color: currentColor;\nborder-inline-end-color: currentColor;\nborder-block-start-style: none;\nborder-block-end-style: none;\nborder-inline-start-style: none;\nborder-inline-end-style: none;\nborder-block-start-width: 3px;\nborder-block-end-width: 3px;\nborder-inline-start-width: 3px;\nborder-inline-end-width: 3px;\n\nSHORTHANDS\n\nall = ALL;\nbackground = COMMA background-image [background-position [ / background-size ]] background-repeat\n     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */\nborder-top = border-top-width border-top-style border-top-color;\nborder-right = border-right-width border-right-style border-right-color;\nborder-bottom = border-bottom-width border-bottom-style border-bottom-color;\nborder-left = border-left-width border-left-style border-left-color;\nborder-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;\nborder-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;\nborder-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;\nborder = border-width border-style border-color;\nborder-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]\n     border-image-repeat;\nborder-radius = INSETS_SLASH border-top-left-radius border-top-right-radius\n     border-bottom-right-radius border-bottom-left-radius;\n[moz,webkit]columns = column-width column-count;\n[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;\nflex-flow = flex-direction flex-wrap;\noeb-column-number = column-count;\noutline = outline-width outline-style outline-color;\nlist-style = list-style-position list-style-type list-style-image;\nmargin = INSETS margin-top margin-right margin-bottom margin-left;\npadding = INSETS padding-top padding-right padding-bottom padding-left;\nfont = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;\nfont-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;\n[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;\nmarker = INSETS marker-start marker-mid marker-end;\n[webkit]text-stroke = text-stroke-width text-stroke-color;\ntext-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;\ntext-spacing = TEXT_SPACING text-autospace text-spacing-trim;\n\n/* css-logical */\nmargin-block = INSETS margin-block-start margin-block-end;\nmargin-inline = INSETS margin-inline-start margin-inline-end;\npadding-block = INSETS padding-block-start padding-block-end;\npadding-inline = INSETS padding-inline-start padding-inline-end;\nborder-block-width = INSETS border-block-start-width border-block-end-width;\nborder-block-style = INSETS border-block-start-style border-block-end-style;\nborder-block-color = INSETS border-block-start-color border-block-end-color;\nborder-inline-width = INSETS border-inline-start-width border-inline-end-width;\nborder-inline-style = INSETS border-inline-start-style border-inline-end-style;\nborder-inline-color = INSETS border-inline-start-color border-inline-end-color;\nborder-block = border-block-width border-block-style border-block-color;\nborder-inline = border-inline-width border-inline-style border-inline-color;\nborder-block-start = border-block-start-width border-block-start-style border-block-start-color;\nborder-block-end = border-block-end-width border-block-end-style border-block-end-color;\nborder-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;\nborder-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;\ninset-block-start = block-start;\ninset-block-end = block-end;\ninset-inline-start = inline-start;\ninset-inline-end = inline-end;\ninset-block = INSETS block-start block-end;\ninset-inline = INSETS inline-start inline-end;\ninset = INSETS top right bottom left;\n\n/* old names  */\nword-wrap = overflow-wrap;\n[adapt,webkit]margin-before = margin-block-start;\n[adapt,webkit]margin-after = margin-block-end;\n[adapt,webkit]margin-start = margin-inline-start;\n[adapt,webkit]margin-end = margin-inline-end;\n[adapt,webkit]padding-before = padding-block-start;\n[adapt,webkit]padding-after = padding-block-end;\n[adapt,webkit]padding-start = padding-inline-start;\n[adapt,webkit]padding-end = padding-inline-end;\n[adapt,webkit]border-before-color = border-block-start-color;\n[adapt,webkit]border-after-color = border-block-end-color;\n[adapt,webkit]border-start-color = border-inline-start-color;\n[adapt,webkit]border-end-color = border-inline-end-color;\n[adapt,webkit]border-before-style = border-block-start-style;\n[adapt,webkit]border-after-style = border-block-end-style;\n[adapt,webkit]border-start-style = border-inline-start-style;\n[adapt,webkit]border-end-style = border-inline-end-style;\n[adapt,webkit]border-before-width = border-block-start-width;\n[adapt,webkit]border-after-width = border-block-end-width;\n[adapt,webkit]border-start-width = border-inline-start-width;\n[adapt,webkit]border-end-width = border-inline-end-width;\n[adapt,webkit]before = block-start;\n[adapt,webkit]after = block-end;\n[adapt,webkit]start = inline-start;\n[adapt,webkit]end = inline-end;\n\n",er='\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">\n<head>\n<style><![CDATA[\n\n.-vivliostyle-footnote-content {\n  float: footnote;\n}\n\n.-vivliostyle-table-cell-container {\n  display: block;\n}\n\n]]></style>\n</head>\n<body>\n\n<s:template id="footnote"><s:content/><s:include class="-vivliostyle-footnote-content"/></s:template>\n\n<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="-vivliostyle-table-cell-container"><s:content/></div></s:template>\n\n</body>\n</html>',tr='\n@namespace "http://www.w3.org/1999/xhtml";\n\n:root {\n  hyphens: -epubx-expr(pref-hyphenate? "auto": "manual");\n}\n:root[data-vivliostyle-epub-spine-properties~="page-spread-left"] {\n  break-before: left;\n}\n:root[data-vivliostyle-epub-spine-properties~="page-spread-right"] {\n  break-before: right;\n}\n\n@-adapt-footnote-area {\n  display: block;\n  margin-block-start: 0.5em;\n  margin-block-end: 0.5em;\n}\n\n@-adapt-footnote-area ::before {\n  display: block;\n  border-block-start-width: 1px;\n  border-block-start-style: solid;\n  border-block-start-color: black;\n  margin-block-end: 0.4em;\n  margin-inline-start: 0;\n  margin-inline-end: 60%;\n}\n\n/* default page master */\n@-epubx-page-master :background-host {\n  @-epubx-partition :layout-host {\n    -epubx-flow-from: body;\n    top: -epubx-expr(header.margin-bottom-edge);\n    bottom: -epubx-expr(page-height - footer.margin-top-edge);\n    left: 0px;\n    right: 0px;\n    column-width: 25em;\n  }\n  @-epubx-partition footer :oeb-page-foot {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-foot;\n    bottom: 0px;\n    left: 0px;\n    right: 0px;\n  }\n  @-epubx-partition header :oeb-page-head {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-head;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n  }\n}\n\n@page {\n  @top-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @top-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @top-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @left-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @left-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @left-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @right-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @right-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @right-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @bottom-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @bottom-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @bottom-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n}\n\n@media print {\n  @page {\n    margin: 10%;\n  }\n}\n',ir='\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace m "http://www.w3.org/1998/Math/MathML";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nhtml,\naddress,\nblockquote,\nbody,\ndd,\ndiv,\ndl,\ndt,\nfieldset,\nform,\nframe,\nframeset,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nnoframes,\nol,\np,\nul,\ncenter,\ndir,\nhr,\nmenu,\npre,\ndetails,\ndialog,\nlegend,\nlisting,\noptgroup,\noption,\nplaintext,\nsearch,\nxmp,\narticle,\nsection,\nnav,\naside,\nhgroup,\nfooter,\nheader,\nfigure,\nfigcaption,\nmain {\n  display: block;\n}\nli {\n  display: list-item;\n}\nhead {\n  display: none !important;\n}\ntable {\n  display: table;\n}\ntr {\n  display: table-row;\n}\nthead {\n  display: table-header-group;\n  break-after: avoid;\n}\ntbody {\n  display: table-row-group;\n}\ntfoot {\n  display: table-footer-group;\n  break-before: avoid;\n}\ncol {\n  display: table-column;\n}\ncolgroup {\n  display: table-column-group;\n}\ntd,\nth {\n  display: table-cell;\n}\ncaption {\n  display: table-caption;\n  text-align: center;\n}\nth {\n  font-weight: bolder;\n  text-align: center;\n}\n*[hidden],\nlink,\nstyle,\nscript {\n  display: none;\n}\nh1 {\n  font-size: 2em;\n  margin-block: 0.67em;\n}\nh2 {\n  font-size: 1.5em;\n  margin-block: 0.83em;\n}\nh3 {\n  font-size: 1.17em;\n  margin-block: 1em;\n}\nh4 {\n  font-size: 1em;\n  margin-block: 1.33em;\n}\nh5 {\n  font-size: 0.83em;\n  margin-block: 1.67em;\n}\nh6 {\n  font-size: 0.67em;\n  margin-block: 2.33em;\n}\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  font-weight: bold;\n  break-after: avoid;\n}\np,\nblockquote,\nfigure,\nul,\nol,\ndl,\ndir,\nmenu {\n  margin-block: 1em;\n}\nb,\nstrong {\n  font-weight: bolder;\n}\nblockquote,\nfigure {\n  margin-inline: 40px;\n}\ni,\ncite,\ndfn,\nem,\nvar,\naddress {\n  font-style: italic;\n}\npre,\ntt,\ncode,\nkbd,\nsamp {\n  font-family: monospace;\n  text-spacing: none;\n  hanging-punctuation: none;\n}\nlisting,\nplaintext,\nxmp,\npre {\n  white-space: pre;\n}\npre[wrap] {\n  white-space: pre-wrap;\n}\nbutton,\ntextarea,\ninput,\nselect {\n  display: inline-block;\n}\nbig {\n  font-size: 1.17em;\n}\nsmall,\nsub,\nsup {\n  font-size: 0.83em;\n}\nsub {\n  vertical-align: sub;\n}\nsup {\n  vertical-align: super;\n}\ntable {\n  box-sizing: border-box;\n  border-spacing: 2px;\n  border-collapse: separate;\n  text-indent: initial;\n}\nthead,\ntbody,\ntfoot,\ntable > tr {\n  vertical-align: middle;\n}\ntr,\ntd,\nth {\n  vertical-align: inherit;\n}\ns,\nstrike,\ndel {\n  text-decoration: line-through;\n}\nhr {\n  border-style: inset;\n  border-width: 1px;\n  margin-block: 0.5em;\n}\nhr[color],\nhr[noshade] {\n  border-style: solid;\n}\nol,\nul,\ndir,\nmenu {\n  padding-inline-start: 40px;\n}\ndd {\n  margin-inline-start: 40px;\n}\nol ul,\nul ol,\nul ul,\nol ol {\n  margin-block: 0;\n}\nu,\nins {\n  text-decoration: underline;\n}\ncenter {\n  text-align: center;\n}\nq::before {\n  content: open-quote;\n}\nq::after {\n  content: close-quote;\n}\n\nruby {\n  display: ruby;\n}\nrp {\n  display: none;\n}\nrbc {\n  display: ruby-base-container;\n}\nrtc {\n  display: ruby-text-container;\n}\nrb {\n  display: ruby-base;\n  white-space: nowrap;\n}\nrt {\n  display: ruby-text;\n}\nrtc,\nrt {\n  text-emphasis: none;\n  white-space: nowrap;\n  line-height: 1;\n}\nrtc,\nrt {\n  font-size: 50%;\n}\nrtc:lang(zh-TW),\nrt:lang(zh-TW) {\n  font-size: 30%;\n}\nrtc > rt,\nrtc > rt:lang(zh-TW) {\n  font-size: 100%;\n}\n\n/* Bidi settings */\nbdo[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: bidi-override;\n}\nbdo[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: bidi-override;\n}\n*[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: isolate;\n}\n*[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: isolate;\n}\n\n/* MathML */\nm|math[display="block"] {\n  display: block;\n  display: block math;\n}\n\n/*------------------ epub-specific ---------------------*/\n\na[epub|type="noteref"],\na[epub\\:type="noteref"] {\n  font-size: 0.75em;\n  vertical-align: super;\n  line-height: 0.01;\n}\n\na[epub|type="noteref"]:href-epub-type(footnote, aside),\na[epub\\:type="noteref"]:href-epub-type(footnote, aside) {\n  -adapt-template: footnote;\n  text-decoration: none;\n}\n\naside[epub|type="footnote"],\naside[epub\\:type="footnote"] {\n  display: none;\n}\n\naside[epub|type="footnote"]:footnote-content,\naside[epub\\:type="footnote"]:footnote-content {\n  display: block;\n  margin: 0.25em;\n  font-size: 1.2em;\n  line-height: 1.2;\n}\n\nepub|trigger {\n  display: none;\n}\n\nepub|switch {\n  display: inline;\n}\n\nepub|default {\n  display: inline;\n}\n\nepub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] {\n  display: inline;\n}\n\nepub|case[required-namespace::supported] ~ epub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] ~ epub|default {\n  display: none;\n}\n',nr='\n@namespace "http://www.w3.org/1999/xhtml";\n\n*:not([data-vivliostyle-role=doc-toc],\n  [data-vivliostyle-role=doc-toc] *,\n  :has([data-vivliostyle-role=doc-toc]),\n  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {\n  display: none;\n}\n\n[hidden] {\n  display: revert;\n}\n\n[data-vivliostyle-role=doc-toc] li a {\n  -adapt-behavior: toc-node-anchor;\n}\n\n[data-vivliostyle-role=doc-toc] li {\n  -adapt-behavior: toc-node;\n}\n\n[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {\n  -adapt-behavior: toc-node-first-child;\n}\n\n[data-vivliostyle-role=doc-toc] :is(ol,ul),\n[data-vivliostyle-role=doc-toc]:is(ol,ul) {\n  -adapt-behavior: toc-container;\n}\n',rr='\n[data-viv-margin-discard~="block-start"] {\n  margin-block-start: 0 !important;\n}\n[data-viv-margin-discard~="block-end"] {\n  margin-block-end: 0 !important;\n}\n[data-viv-margin-discard~="inline-start"] {\n  margin-inline-start: 0 !important;\n}\n[data-viv-margin-discard~="inline-end"] {\n  margin-inline-end: 0 !important;\n}\n\n[data-viv-box-break~="inline-start"]:not([data-viv-box-break~="clone"]) {\n  margin-inline-start: 0 !important;\n  padding-inline-start: 0 !important;\n  border-inline-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-end-start-radius: 0 !important;\n}\n[data-viv-box-break~="inline-end"]:not([data-viv-box-break~="clone"]) {\n  margin-inline-end: 0 !important;\n  padding-inline-end: 0 !important;\n  border-inline-end-width: 0 !important;\n  border-start-end-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-start"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>thead)) {\n  margin-block-start: 0 !important;\n  padding-block-start: 0 !important;\n  border-block-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-start-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-end"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>tfoot)) {\n  margin-block-end: 0 !important;\n  padding-block-end: 0 !important;\n  border-block-end-width: 0 !important;\n  border-end-start-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-start"][data-viv-box-break~="text-start"] {\n  text-indent: 0 !important;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] {\n  text-align-last: justify !important;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] > * {\n  text-align-last: auto;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"]:not([data-viv-box-break~="justify"]) {\n  text-align-last: auto !important;\n}\n\nspan.viv-anonymous-block {\n  display: block;\n}\n\n[data-vivliostyle-page-container] {\n  text-spacing-trim: space-all;\n  text-autospace: no-autospace;\n}\nviv-ts-open.viv-ts-auto > viv-ts-inner,\nviv-ts-open.viv-ts-trim > viv-ts-inner {\n  margin-inline-start: -0.5em;\n}\nviv-ts-close.viv-ts-auto > viv-ts-inner,\nviv-ts-close.viv-ts-trim > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-close.viv-hang-end > viv-ts-inner,\nviv-ts-close.viv-hang-last > viv-ts-inner {\n  letter-spacing: -1em;\n}\nviv-ts-open.viv-ts-auto::before,\nviv-ts-close.viv-ts-auto::after,\nviv-ts-close.viv-hang-end::after {\n  content: " ";\n  font-family: Courier, monospace;\n  word-spacing: normal;\n  letter-spacing: -0.11em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\nviv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {\n  letter-spacing: 0.4em;\n}\nviv-ts-close.viv-hang-hw > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-open.viv-hang-first > viv-ts-inner {\n  display: inline-block;\n  line-height: 1;\n  inline-size: 1em;\n  text-indent: 0;\n  text-align: end;\n  text-align-last: end;\n  margin-inline-start: -1em;\n}\nviv-ts-thin-sp::after {\n  content: " ";\n  font-family: Times, serif;\n  word-spacing: normal;\n  letter-spacing: -0.125em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\n[style*=text-decoration] :is(viv-ts-thin-sp, viv-ts-close.viv-ts-auto)::after {\n  visibility: visible;\n}\n\nspan[data-viv-leader] {\n  text-combine-upright: none;\n  text-orientation: mixed;\n  white-space: pre;\n}\n';function or(e,t,i){let n=Mn("fetchFromURL"),r={method:i||"GET",mode:"cors"},o=n.suspend(),s={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};return fetch(e,r).then((i=>{var n;return s.status=i.status,s.url=i.url,s.statusText=i.statusText,s.contentType=null==(n=i.headers.get("Content-Type"))?void 0:n.replace(/;.*$/,"").toLowerCase(),i.ok?"blob"===t?i.blob():"arraybuffer"===t?i.arrayBuffer():"json"===t?i.json():/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?(s.contentType="text/html",i.arrayBuffer().then((e=>new TextDecoder("Shift_JIS").decode(e)))):(/^data:,(<|%3c)/i.test(e)&&(s.contentType="text/html"),i.text()):i.text()})).then((e=>{"blob"===t&&e instanceof Blob?s.responseBlob=e:"arraybuffer"===t&&e instanceof ArrayBuffer?s.responseBlob=sr([e]):"json"===t?s.responseText=JSON.stringify(e):"string"==typeof e&&(s.responseText=e),o.schedule(s)})).catch((t=>{P.warn(t,`Error fetching ${e}`),o.schedule(s)})),n.result()}function sr(e,t){return new Blob(e,{type:t||"application/octet-stream"})}var ar=class{constructor(e,t){this.parser=e,this.type=t,l(this,"resources",{}),l(this,"fetchers",{})}load(e,t,i){e=G(e);let n=this.resources[e];return void 0!==n?zn(n):this.fetch(e,t,i).get()}fetchInner(e,t,i){let n=Mn("fetch"),r=e.endsWith("?viv-toc-box");r&&(e=e.replace("?viv-toc-box",""));let o=Z("user-agent.xml",Y),s=!r&&e===o;return s&&(e=`data:application/xml,${encodeURIComponent(er)}`),or(e,this.type).then((a=>{if(a.status>=400&&t)throw new Error((i||`Failed to fetch required resource: ${e}`)+` (${a.status}${a.statusText?" "+a.statusText:""})`);r?(e+="?viv-toc-box",a.url+="?viv-toc-box"):s&&(a.url=e=o),this.parser(a,this).then((t=>{delete this.fetchers[e],this.resources[e]=t,n.finish(t)}))})),n.result()}fetch(e,t,i){if(e=G(e),this.resources[e])return null;let n=this.fetchers[e];return n||(n=new Yn((()=>this.fetchInner(e,t,i)),`Fetch ${e}`),this.fetchers[e]=n,n.start()),n}get(e){return this.resources[G(e)]}delete(e){delete this.resources[G(e)]}};function lr(e,t){let i=e.responseText;return zn(i?W(i):null)}function hr(e,t,i){let n=new Yn((()=>{let n=Mn("loadElement"),r=n.suspend(e),o=!1,s=e=>{o||(o=!0,r.schedule(e?e.type:"timeout"))};return e.addEventListener("load",s,!1),e.addEventListener("error",s,!1),e.addEventListener("abort",s,!1),"http://www.w3.org/2000/svg"==e.namespaceURI?(t&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),setTimeout(s,300)):"script"===e.localName?setTimeout(s,3e3):t&&(e.src=t,i&&(e.alt=i)),n.result()}),`loadElement ${t||e.localName}`);return n.start(),n}var ur=33554432,cr=50331648,dr=67108864,pr=class{constructor(e){this.scope=e,l(this,"flavor"),this.flavor="Author"}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,i,n){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,i){}startPartitionRule(e,t,i){}startPartitionGroupRule(e,t,i){}startRuleBody(){}property(e,t,i){}endRule(){}startFuncWithSelector(e){}endFuncWithSelector(){}pushSelectorText(e){}getImportantSpecificity(){switch(this.flavor){case"UA":return 0;case"User":return 100663296;default:return 83886080}}getBaseSpecificity(){switch(this.flavor){case"UA":return 0;case"User":return 16777216;default:return ur}}},fr=class extends pr{constructor(){super(null),l(this,"stack",[]),l(this,"tokenizer",null),l(this,"slave",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){var i;P.warn(e,null!=(i=null==t?void 0:t.toString())?i:"")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,i,n){this.slave.attributeSelector(e,t,i,n)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,i){this.slave.startPageMasterRule(e,t,i)}startPartitionRule(e,t,i){this.slave.startPartitionRule(e,t,i)}startPartitionGroupRule(e,t,i){this.slave.startPartitionGroupRule(e,t,i)}startRuleBody(){this.slave.startRuleBody()}property(e,t,i){this.slave.property(e,t,i)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},gr=class extends pr{constructor(e,t,i){super(e),this.owner=t,this.topLevel=i,l(this,"depth",0),t&&(this.flavor=t.flavor)}getCurrentToken(){var e;return null==(e=this.owner)?void 0:e.getCurrentToken()}error(e,t){var i;null==(i=this.owner)||i.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){0==--this.depth&&!this.topLevel&&this.owner.popHandler()}},mr=class extends gr{constructor(e,t,i){super(e,t,i)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new gr(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,i){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}},br=[],vr=[],wr=[],yr=[],xr=[],Sr=[],Cr=[],kr=[],Er=[],Pr=[],Nr=[],Tr=[],Ir=[],Rr=55,_r=56;br[1]=28,br[36]=29,br[7]=29,br[9]=29,br[14]=29,br[18]=29,br[50]=29,br[20]=30,br[13]=27,br[0]=200,vr[1]=46,vr[0]=200,Sr[1]=2,Sr[36]=4,Sr[7]=6,Sr[9]=8,Sr[14]=10,Sr[18]=14,Sr[50]=42,wr[37]=11,wr[23]=12,wr[35]=56,wr[1]=1,wr[36]=3,wr[7]=5,wr[9]=7,wr[14]=9,wr[12]=13,wr[18]=55,wr[50]=58,wr[16]=41,yr[37]=11,yr[23]=12,yr[35]=56,yr[1]=1,yr[36]=3,yr[7]=5,yr[9]=7,yr[14]=9,yr[18]=55,xr[1]=2,xr[36]=4,xr[7]=6,xr[9]=8,xr[18]=14,xr[50]=42,xr[14]=10,xr[12]=13,Cr[1]=15,Cr[7]=16,Cr[4]=17,Cr[5]=18,Cr[3]=19,Cr[2]=20,Cr[8]=21,Cr[27]=57,Cr[16]=22,Cr[19]=23,Cr[6]=24,Cr[11]=25,Cr[17]=26,Cr[13]=48,Cr[31]=47,Cr[23]=54,Cr[0]=44,kr[1]=31,kr[4]=32,kr[5]=32,kr[3]=33,kr[2]=34,kr[10]=40,kr[6]=38,kr[31]=36,kr[24]=36,kr[32]=35,Er[1]=45,Er[16]=37,Er[37]=37,Er[38]=37,Er[47]=37,Er[48]=37,Er[39]=37,Er[49]=37,Er[41]=37,Er[26]=37,Er[25]=37,Er[23]=37,Er[24]=37,Er[19]=37,Er[21]=37,Er[36]=37,Er[18]=37,Er[22]=37,Er[11]=39,Er[12]=43,Er[17]=49,Pr[0]=200,Pr[12]=50,Pr[13]=51,Pr[14]=50,Pr[15]=51,Pr[10]=50,Pr[11]=51,Pr[17]=53,Nr[0]=200,Nr[12]=50,Nr[13]=52,Nr[14]=50,Nr[15]=51,Nr[10]=50,Nr[11]=51,Nr[17]=53,Tr[0]=200,Tr[12]=50,Tr[13]=51,Tr[14]=50,Tr[15]=51,Tr[10]=50,Tr[11]=51,Ir[11]=0,Ir[16]=0,Ir[22]=1,Ir[18]=1,Ir[26]=2,Ir[25]=2,Ir[38]=3,Ir[37]=3,Ir[48]=3,Ir[47]=3,Ir[39]=3,Ir[49]=3,Ir[41]=3,Ir[23]=4,Ir[24]=4,Ir[36]=5,Ir[19]=5,Ir[21]=5,Ir[0]=6,Ir[Rr]=2,Ir[_r]=2;var Ar=class{constructor(e,t,i,n){this.actions=e,this.tokenizer=t,this.handler=i,this.baseURL=n,l(this,"valStack",[]),l(this,"namespacePrefixToURI",{}),l(this,"defaultNamespaceURI",null),l(this,"propName",null),l(this,"propImportant",!1),l(this,"exprContext"),l(this,"result",null),l(this,"importReady",!1),l(this,"importURL",null),l(this,"importCondition",null),l(this,"errorBrackets",[]),l(this,"ruleStack",[]),l(this,"regionRule",!1),l(this,"pageRule",!1),l(this,"inStyleDeclaration",!1),this.exprContext=2}extractVals(e,t){let i=[],n=this.valStack;for(;t<n.length&&(i.push(n[t++]),t!==n.length);){if(n[t++]!==e)throw new Error("Unexpected state");t===n.length&&i.push(zt)}return i}valStackReduce(e,t){let i,n=this.valStack,r=n.length,o=0;do{if(i=n[--r],")"===e&&i instanceof ii)if(")"===i.text)o++;else if("("===i.text){if(0===o)return null;o--}}while(void 0!==i&&"string"!=typeof i);let s=n.length-(r+1);if(s>1&&n.splice(r+1,s,new Jt(n.slice(r+1,n.length))),","==e)return null;r++;do{i=n[--r]}while(void 0!==i&&("string"!=typeof i||","==i));if(s=n.length-(r+1),"("==i){")"!=e&&0!==t.type&&(this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=Nr);let i=new ei(n[r-1],this.extractVals(",",r+1));if(n.splice(r-1,s+2,i),"var"===i.name){let e=i.values[0]instanceof $t&&i.values[0].name;(!pi(e)||e===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${i.toString()}`,t),this.actions=Nr)}return i}if(";"!=e||r>=0)return this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=Nr,null;if(s>1)return new Qt(this.extractVals(",",r+1));let a=n[0];return a instanceof Bt?a:a?new ii(a.toString()):zt}exprError(e,t){this.actions=this.propName?Nr:Pr,P.warn(e,t.toString())}exprStackReduce(e,t){let i,n=this.valStack,r=this.handler,o=n.pop();for(;;){let s=n.pop();if(11==e){let t=[o];for(;16==s;)t.unshift(n.pop()),s=n.pop();if("string"==typeof s){if("{"==s){for(;t.length>=2;){let e=t.shift(),i=t.shift(),n=new st(r.getScope(),e,i);t.unshift(n)}return n.push(new ti(t[0])),!0}if("("==s){let i=n.pop(),s=n.pop();o=new Ct(r.getScope(),Ve(s,i),t),e=0;continue}}if(10==s){o.isMediaName()&&(o=new Pt(r.getScope(),o,null)),e=0;continue}}else if("string"==typeof s){n.push(s);break}if(s<0)if(-31==s)o=new et(r.getScope(),o);else if(-24==s)o=new it(r.getScope(),o);else{if(-57!=s)return this.exprError("F_UNEXPECTED_STATE",t),!1;o=new tt(r.getScope(),o)}else{if(Ir[e]>Ir[s]){n.push(s);break}switch(i=n.pop(),s){case 26:o=new nt(r.getScope(),i,o);break;case Rr:o=new rt(r.getScope(),i,o);break;case _r:o=new at(r.getScope(),i,o);break;case 25:o=new ot(r.getScope(),i,o);break;case 38:o=new lt(r.getScope(),i,o);break;case 37:o=new ut(r.getScope(),i,o);break;case 48:o=new ht(r.getScope(),i,o);break;case 47:o=new ct(r.getScope(),i,o);break;case 39:case 49:o=new dt(r.getScope(),i,o);break;case 41:o=new pt(r.getScope(),i,o);break;case 23:o=new ft(r.getScope(),i,o);break;case 24:o=new gt(r.getScope(),i,o);break;case 36:o=new mt(r.getScope(),i,o);break;case 19:o=new bt(r.getScope(),i,o);break;case 21:o=new vt(r.getScope(),i,o);break;case 18:if(!(n.length>1))return this.exprError("E_CSS_EXPR_COND",t),!1;switch(n[n.length-1]){case 22:n.pop(),o=new kt(r.getScope(),n.pop(),i,o);break;case 10:if(!i.isMediaName())return this.exprError("E_CSS_MEDIA_TEST",t),!1;o=new Pt(r.getScope(),i,o)}break;case 22:if(18!=e)return this.exprError("E_CSS_EXPR_COND",t),!1;case 10:return n.push(i),n.push(s),n.push(o),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return n.push(o),!1}readSupportsTest(e){let t,i,n=6===e.type,r=this.tokenizer;if(n)i=e.text,t=e.position+i.length+1;else{if(10!==e.type)return null;{let n=r.nthToken(1),o=r.nthToken(2);if(1===n.type&&18===o.type)r.consume(),r.consume(),i=n.text,t=o.position+1;else{if(10===n.type||6===n.type||1===n.type&&"not"===n.text.toLowerCase()&&(10===o.type||6===o.type))return null;t=e.position+1}}}let o,s=0,a=0;for(;s>=0;)switch(r.consume(),o=r.token(),o.type){case 11:s--;break;case 10:case 6:s++;break;case 16:0===s&&a++;break;case 0:return this.exprError("E_CSS_UNEXPECTED_EOF",o),null}r.consume();let l=o.position,h=n&&"selector"===i&&a>0?"":r.input.substring(t,l).trim();return new Nt(this.handler.getScope(),i,h,n)}readPseudoParams(){let e=[];for(;;){let t=this.tokenizer.token();switch(t.type){case 1:e.push(t.text);break;case 23:e.push("+");break;case 4:case 5:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(23===t.type)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(1===t.type&&("even"===t.text||"odd"===t.text))return this.tokenizer.consume(),[2,"odd"===t.text?1:0];switch(t.type){case 3:if(e&&t.num<0)return null;case 1:if(e&&"-"===t.text.charAt(0))return null;if("n"===t.text||"-n"===t.text){if(e&&t.precededBySpace)return null;let i="-n"===t.text?-1:1;3===t.type&&(i=t.num);let n=0;this.tokenizer.consume(),t=this.tokenizer.token();let r=24===t.type,o=23===t.type||r;if(o&&(this.tokenizer.consume(),t=this.tokenizer.token()),5===t.type){if(n=t.num,1/n==-1/0){if(n=0,o)return null}else if(n<0){if(o)return null}else if(n>=0&&!o)return null;this.tokenizer.consume()}else if(o)return null;return[i,r&&n>0?-n:n]}if("n-"===t.text||"-n-"===t.text){if(e&&t.precededBySpace)return null;let i="-n-"===t.text?-1:1;if(3===t.type&&(i=t.num),this.tokenizer.consume(),t=this.tokenizer.token(),5===t.type)return t.num<0||1/t.num==-1/0?null:(this.tokenizer.consume(),[i,t.num])}else{let i=t.text.match(/^n(-[0-9]+)$/);if(i)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[3===t.type?t.num:1,parseInt(i[1],10)]);if(i=t.text.match(/^-n(-[0-9]+)$/),i)return this.tokenizer.consume(),[-1,parseInt(i[1],10)]}return null;case 5:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){let i=this.handler.getScope();if(!i)return null;if(t=t||i._true,e){let n=e.split(/\s+/);for(let e of n)switch(e){case"vertical":t=It(i,t,new et(i,new yt(i,"pref-horizontal")));break;case"horizontal":t=It(i,t,new yt(i,"pref-horizontal"));break;case"day":t=It(i,t,new et(i,new yt(i,"pref-night-mode")));break;case"night":t=It(i,t,new yt(i,"pref-night-mode"));break;default:t=i._false}}return t===i._true?null:new ti(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,i,n,r,o){let s,a,l,h,u,c,d,p=this.handler,f=this.tokenizer,g=this.valStack,m=null;for(i&&(this.inStyleDeclaration=!0),n&&(this.exprContext=2,this.valStack.push("{"));e>0;--e)if(s=f.token(),r&&null===m&&(m=s.position-1,"("===f.input[m]&&m++),this.actions===Cr&&this.errorBrackets.length>0&&(s.type===this.errorBrackets[this.errorBrackets.length-1]||17===s.type||31===s.type)){if(s.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),11===s.type&&this.valStackReduce(")",s))){f.consume();continue}g.push(new ii(s.toString())),f.consume()}else switch(this.actions[s.type]){case 28:if(!this.inStyleDeclaration||18!=f.nthToken(1).type){this.isInsidePropertyOnlyRule()?(p.error("E_CSS_COLON_EXPECTED",f.nthToken(1)),this.actions=Nr):(this.actions=Sr,p.startSelectorRule());continue}this.propName=s.text,this.propImportant=!1,f.consume(),f.consume(),this.actions=Cr,g.splice(0,g.length);continue;case 46:if(18!=f.nthToken(1).type){this.actions=Nr,p.error("E_CSS_COLON_EXPECTED",f.nthToken(1));continue}this.propName=s.text,this.propImportant=!1,f.consume(),f.consume(),this.actions=Cr,g.splice(0,g.length);continue;case 29:this.actions=Sr,p.startSelectorRule();continue;case 1:if(!s.precededBySpace){this.actions=Tr,p.error("E_CSS_SPACE_EXPECTED",s);continue}p.descendantSelector();case 2:if(34==f.nthToken(1).type)if(f.consume(),f.consume(),l=this.namespacePrefixToURI[s.text],null!=l)switch(s=f.token(),s.type){case 1:p.tagSelector(l,s.text),this.actions=r?yr:wr,f.consume();break;case 36:p.tagSelector(l,null),this.actions=r?yr:wr,f.consume();break;default:this.actions=Pr,p.error("E_CSS_NAMESPACE",s)}else this.actions=Pr,p.error("E_CSS_UNDECLARED_PREFIX",s);else p.tagSelector(this.defaultNamespaceURI,s.text),this.actions=r?yr:wr,f.consume();continue;case 3:if(!s.precededBySpace){this.actions=Tr,p.error("E_CSS_SPACE_EXPECTED",s);continue}p.descendantSelector();case 4:if(34==f.nthToken(1).type)switch(f.consume(),f.consume(),s=f.token(),s.type){case 1:p.tagSelector(null,s.text),this.actions=r?yr:wr,f.consume();break;case 36:p.tagSelector(null,null),this.actions=r?yr:wr,f.consume();break;default:this.actions=Pr,p.error("E_CSS_NAMESPACE",s)}else p.tagSelector(this.defaultNamespaceURI,null),this.actions=r?yr:wr,f.consume();continue;case 5:s.precededBySpace&&p.descendantSelector();case 6:if(!s.text){p.error("E_CSS_SYNTAX",s),f.consume();continue}p.idSelector(s.text),this.actions=r?yr:wr,f.consume();continue;case 7:s.precededBySpace&&p.descendantSelector();case 8:p.classSelector(s.text),this.actions=r?yr:wr,f.consume();continue;case 55:s.precededBySpace&&p.descendantSelector();case 14:f.consume(),s=f.token();e:switch(s.type){case 1:p.pseudoclassSelector(s.text,null),f.consume(),this.actions=r?yr:wr;continue;case 6:switch(h=s.text,f.consume(),h){case"is":case"not":case"where":case"has":this.actions=Sr,p.startFuncWithSelector(h),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,"has"===h)?this.actions=wr:this.actions=Tr;continue;case"lang":case"href-epub-type":if(s=f.token(),1===s.type){d=[s.text],f.consume(),"href-epub-type"===h&&16===f.token().type&&(f.consume(),s=f.token(),1===s.type&&(d.push(s.text),f.consume()));break}break e;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":case"nth":if(d=this.readNthPseudoParams(),d)break;break e;default:d=this.readPseudoParams()}if(s=f.token(),11==s.type){p.pseudoclassSelector(h,d),f.consume(),this.actions=r?yr:wr;continue}}p.error("E_CSS_PSEUDOCLASS_SYNTAX",s),this.actions=Pr;continue;case 58:s.precededBySpace&&p.descendantSelector();case 42:switch(f.consume(),s=f.token(),s.type){case 1:p.pseudoelementSelector(s.text,null),this.actions=r?yr:wr,f.consume();continue;case 6:if(h=s.text,f.consume(),"nth-fragment"==h){if(d=this.readNthPseudoParams(),null===d)break}else d=this.readPseudoParams();if(s=f.token(),11==s.type){p.pseudoelementSelector(h,d),this.actions=r?yr:wr,f.consume();continue}}p.error("E_CSS_PSEUDOELEM_SYNTAX",s),this.actions=Pr;continue;case 9:s.precededBySpace&&p.descendantSelector();case 10:if(f.consume(),s=f.token(),1==s.type)h=s.text,f.consume();else if(36==s.type)h=null,f.consume();else{if(34!=s.type){this.actions=Tr,p.error("E_CSS_ATTR",s),f.consume();continue}h=""}if(s=f.token(),34==s.type){if(l=h&&this.namespacePrefixToURI[h],void 0===l){this.actions=Tr,p.error("E_CSS_UNDECLARED_PREFIX",s),f.consume();continue}if(f.consume(),s=f.token(),1!=s.type){this.actions=Tr,p.error("E_CSS_ATTR_NAME_EXPECTED",s);continue}h=s.text,f.consume(),s=f.token()}else l="";switch(s.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:u=s.type,f.consume(),s=f.token();break;case 15:p.attributeSelector(l,h,0,null),this.actions=r?yr:wr,f.consume();continue;default:this.actions=Tr,p.error("E_CSS_ATTR_OP_EXPECTED",s);continue}switch(s.type){case 1:case 2:p.attributeSelector(l,h,u,s.text),f.consume(),s=f.token();break;default:this.actions=Tr,p.error("E_CSS_ATTR_VAL_EXPECTED",s);continue}if(15!=s.type){this.actions=Tr,p.error("E_CSS_ATTR",s);continue}this.actions=r?yr:wr,f.consume();continue;case 11:p.childSelector(),this.actions=xr,f.consume();continue;case 12:p.adjacentSiblingSelector(),this.actions=xr,f.consume();continue;case 56:p.followingSiblingSelector(),this.actions=xr,f.consume();continue;case 13:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push("[selector]"),this.inStyleDeclaration=!0),p.startRuleBody(),this.actions=br,f.consume();continue;case 41:p.nextSelector(),this.actions=Sr,f.consume();continue;case 15:g.push(jt(s.text)),f.consume();continue;case 16:u=parseInt(s.text,16),g.push(new Xt(s.text)),f.consume();continue;case 17:g.push(new Gt(s.num)),f.consume();continue;case 18:g.push(new qt(s.num)),f.consume();continue;case 19:g.push(new Wt(s.num,s.text)),f.consume();continue;case 20:g.push(new Ut(s.text)),f.consume();continue;case 21:g.push(new Yt(Z(s.text,this.baseURL))),f.consume();continue;case 57:g.push(new Kt(s.text)),f.consume();continue;case 22:this.valStackReduce(",",s),g.push(","),f.consume();continue;case 23:g.push(Vt),f.consume();continue;case 24:h=s.text.toLowerCase(),"-epubx-expr"==h||"env"==h?(this.actions=kr,this.exprContext=0,g.push("{")):(g.push(h),g.push("("),this.errorBrackets.length>0&&this.errorBrackets.push(11)),f.consume();continue;case 25:this.valStackReduce(")",s),f.consume();continue;case 47:if(f.consume(),s=f.token(),a=f.nthToken(1),1==s.type&&"important"==s.text.toLowerCase()&&(17==a.type||0==a.type||13==a.type)){f.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",s);continue;case 54:switch(a=f.nthToken(1),a.type){case 4:case 3:case 5:if(!a.precededBySpace){f.consume();continue}}g.push(new ii("+")),f.consume();continue;case 26:f.consume();case 48:c=this.valStackReduce(";",s),c&&this.propName&&p.property(this.propName,c,this.propImportant),this.actions=i?vr:br;continue;case 44:for(f.consume();g.length>0;){let e=g.length;if(c=this.valStackReduce(";",s),!c||g.length===e)break}return t?(this.result=c,!0):(this.propName&&c&&p.property(this.propName,c,this.propImportant),!0);case 31:if(a=f.nthToken(1),9==a.type)10!=f.nthToken(2).type||f.nthToken(2).precededBySpace?(g.push(new yt(p.getScope(),Ve(s.text,a.text))),this.actions=Er):(g.push(s.text,a.text,"("),f.consume()),f.consume();else{if(2==this.exprContext||3==this.exprContext)"not"==s.text.toLowerCase()?(f.consume(),g.push(new xt(p.getScope(),!0,a.text))):("only"==s.text.toLowerCase()&&(f.consume(),s=a),g.push(new xt(p.getScope(),!1,s.text)));else{if(4===this.exprContext&&"not"===s.text.toLowerCase()&&g[g.length-1]!==Rr&&g[g.length-1]!==_r&&(10===a.type||6===a.type)){g.push(-57),f.consume();continue}g.push(new yt(p.getScope(),s.text))}this.actions=Er}f.consume();continue;case 38:if(4===this.exprContext){g.push(this.readSupportsTest(s)),this.actions=Er;continue}g.push(null,s.text,"("),f.consume();continue;case 32:g.push(new Et(p.getScope(),s.num)),f.consume(),this.actions=Er;continue;case 33:h=s.text,"%"==h&&(h=this.propName&&this.propName.match(/height|^(top|bottom)$/)?"vh":"vw"),g.push(new wt(p.getScope(),s.num,h)),f.consume(),this.actions=Er;continue;case 34:g.push(new Et(p.getScope(),s.text)),f.consume(),this.actions=Er;continue;case 35:f.consume(),s=f.token(),5!=s.type||s.precededBySpace?this.exprError("E_CSS_SYNTAX",s):(g.push(new Tt(p.getScope(),s.num)),f.consume(),this.actions=Er);continue;case 36:g.push(-s.type),f.consume();continue;case 37:this.actions=kr,this.exprStackReduce(s.type,s),g.push(s.type),f.consume();continue;case 45:"and"===s.text.toLowerCase()&&g[g.length-2]!==_r&&-57!==g[g.length-2]?(this.actions=kr,this.exprStackReduce(Rr,s),g.push(Rr),f.consume()):"or"===s.text.toLowerCase()&&g[g.length-2]!==Rr&&-57!==g[g.length-2]?(this.actions=kr,this.exprStackReduce(_r,s),g.push(_r),f.consume()):this.exprError("E_CSS_SYNTAX",s);continue;case 39:this.exprStackReduce(s.type,s)&&(this.actions=Cr),f.consume();continue;case 43:this.exprStackReduce(11,s)&&(this.propName||3==this.exprContext?this.exprError("E_CSS_UNEXPECTED_BRC",s):(1==this.exprContext?p.startWhenRule(g.pop()):p.startMediaRule(g.pop()),this.ruleStack.push("media"),p.startRuleBody(),this.actions=br)),f.consume();continue;case 49:if(this.exprStackReduce(11,s))return this.propName||3!=this.exprContext?(this.exprError("E_CSS_UNEXPECTED_SEMICOL",s),this.actions=br,f.consume(),!1):(this.importCondition=g.pop(),this.importReady=!0,this.actions=br,f.consume(),!1);f.consume();continue;case 40:if(4===this.exprContext){let e=this.readSupportsTest(s);if(e){g.push(e),this.actions=Er;continue}}g.push(s.type),f.consume();continue;case 27:if(this.actions=br,f.consume(),p.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case"page":case"-epubx-page-master":case"-epubx-partition-group":this.inStyleDeclaration=!0}continue;case 30:switch(h=s.text.toLowerCase(),h){case"import":if(f.consume(),s=f.token(),2==s.type||8==s.type){if(this.importURL=s.text,f.consume(),s=f.token(),17==s.type||0==s.type)return this.importReady=!0,f.consume(),!1;this.propName=null,this.exprContext=3,this.actions=kr,g.push("{");continue}p.error("E_CSS_IMPORT_SYNTAX",s),this.actions=Pr;continue;case"namespace":switch(f.consume(),s=f.token(),s.type){case 1:if(h=s.text,f.consume(),s=f.token(),(2==s.type||8==s.type)&&17==f.nthToken(1).type){this.namespacePrefixToURI[h]=s.text,f.consume(),f.consume();continue}break;case 2:case 8:if(17==f.nthToken(1).type){this.defaultNamespaceURI=s.text,f.consume(),f.consume();continue}}p.error("E_CSS_NAMESPACE_SYNTAX",s),this.actions=Pr;continue;case"charset":if(f.consume(),s=f.token(),2==s.type&&17==f.nthToken(1).type){h=s.text.toLowerCase(),"utf-8"!=h&&"utf-16"!=h&&p.error(`E_CSS_UNEXPECTED_CHARSET ${h}`,s),f.consume(),f.consume();continue}p.error("E_CSS_CHARSET_SYNTAX",s),this.actions=Pr;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(12==f.nthToken(1).type){switch(f.consume(),f.consume(),h){case"font-face":p.startFontFaceRule(),this.inStyleDeclaration=!0;break;case"-epubx-page-template":p.startPageTemplateRule();break;case"-epubx-define":p.startDefineRule(),this.inStyleDeclaration=!0;break;case"-epubx-viewport":p.startViewportRule(),this.inStyleDeclaration=!0}this.ruleStack.push(h),p.startRuleBody();continue}break;case"-adapt-footnote-area":switch(f.consume(),s=f.token(),s.type){case 12:f.consume(),p.startFootnoteRule(null),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(f.consume(),s=f.token(),1==s.type&&12==f.nthToken(1).type){h=s.text,f.consume(),f.consume(),p.startFootnoteRule(h),this.ruleStack.push("-adapt-footnote-area"),p.startRuleBody(),this.inStyleDeclaration=!0;continue}}break;case"-epubx-region":f.consume(),p.startRegionRule(),this.regionRule=!0,this.actions=Sr;continue;case"page":f.consume(),p.startPageRule(),this.pageRule=!0,this.actions=xr;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(f.consume(),s=f.token(),12==s.type){f.consume(),p.startPageMarginBoxRule(h),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-when":f.consume(),this.propName=null,this.exprContext=1,this.actions=kr,g.push("{");continue;case"media":f.consume(),this.propName=null,this.exprContext=2,this.actions=kr,g.push("{");continue;case"supports":f.consume(),this.propName=null,this.exprContext=4,this.actions=kr,g.push("{");continue;case"-epubx-flow":if(1==f.nthToken(1).type&&12==f.nthToken(2).type){p.startFlowRule(f.nthToken(1).text),f.consume(),f.consume(),f.consume(),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{f.consume(),s=f.token();let e=null,t=null,i=[];for(1==s.type&&(e=s.text,f.consume(),s=f.token()),18==s.type&&1==f.nthToken(1).type&&(t=f.nthToken(1).text,f.consume(),f.consume(),s=f.token());6==s.type&&"class"==s.text.toLowerCase()&&1==f.nthToken(1).type&&11==f.nthToken(2).type;)i.push(f.nthToken(1).text),f.consume(),f.consume(),f.consume(),s=f.token();if(12==s.type){switch(f.consume(),h){case"-epubx-page-master":p.startPageMasterRule(e,t,i);break;case"-epubx-partition":p.startPartitionRule(e,t,i);break;case"-epubx-partition-group":p.startPartitionGroupRule(e,t,i)}this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case"":p.error(`E_CSS_UNEXPECTED_AT${h}`,s),this.actions=Tr;continue;default:p.error(`E_CSS_AT_UNKNOWN ${h}`,s),this.actions=Pr;continue}p.error(`E_CSS_AT_SYNTAX ${h}`,s),this.actions=Pr;continue;case 50:this.errorBrackets.push(s.type+1),f.consume();continue;case 52:if(0==this.errorBrackets.length){this.actions=br;continue}case 51:if(r&&0==this.errorBrackets.length&&11==s.type)return f.consume(),p.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==s.type&&this.errorBrackets.pop(),0==this.errorBrackets.length&&13==s.type&&(this.actions=br),f.consume();continue;case 53:0==this.errorBrackets.length&&(this.actions=br),f.consume();continue;case 200:return!0;default:if(n)return!!this.exprStackReduce(11,s)&&(this.result=g.pop(),!0);if(r){switch(s.type){case 16:case 11:if(this.actions===Sr)p.error("E_CSS_SYNTAX",s);else{let e=f.input.substring(m,s.position);p.pushSelectorText(e),m=s.position+1}if(16===s.type){p.nextSelector(),this.actions=Sr,f.consume();continue}return p.endFuncWithSelector(),f.consume(),!0;case 37:case 23:case 35:if(o){this.actions=wr;continue}break;case 12:case 14:case 10:this.errorBrackets.push(s.type+1)}p.error("E_CSS_SYNTAX",s),f.consume(),this.actions=Tr;continue}if(this.actions!==Pr&&this.actions!==Tr&&this.actions!==Nr){if(54==s.type)p.error("E_CSS_SYNTAX",s);else{if(this.actions===Cr){switch(s.type){case 10:case 12:case 14:this.errorBrackets.push(s.type+1)}g.push(new ii(s.toString())),f.consume();continue}if(12===s.type&&this.actions==kr&&g.length>0){p.startMediaRule(g.pop()),this.ruleStack.push("media"),p.startRuleBody(),this.actions=br,f.consume();continue}if(17===s.type&&this.actions==kr)return this.actions=br,f.consume(),!1;p.error("E_CSS_SYNTAX",s)}this.isInsidePropertyOnlyRule()?this.actions=Nr:this.actions=Tr;continue}f.consume();continue}return!1}},Lr=class extends pr{constructor(e){super(null),this.scope=e}error(e,t){P.warn(e,t.toString())}getScope(){return this.scope}};function Or(e,t,i,n,r){let o=Mn("parseStylesheet"),s=new Ar(br,e,t,i),a=null;return r&&(a=function(e,t,i){let n=new Ar(kr,e,t,i);return n.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),n.result}(new Ln(r,t),t,i)),a=s.makeCondition(n,a&&a.toExpr()),a&&(t.startMediaRule(a),t.startRuleBody()),o.loop((()=>{for(;!s.runParser(100,!1,!1,!1,!1);){if(s.importReady){let e=Z(s.importURL,i);s.importCondition&&(t.startMediaRule(s.importCondition),t.startRuleBody());let n=Mn("parseStylesheet.import");return Br(e,t,null,null).then((()=>{s.importCondition&&t.endRule(),s.importReady=!1,s.importURL=null,s.importCondition=null,n.finish(!0)})),n.result()}let e=o.timeSlice();if(e.isPending)return e}return zn(!1)})).then((()=>{a&&t.endRule(),o.finish(!0)})),o.result()}function Fr(e,t,i,n,r){return Dn("parseStylesheetFromText",(o=>{Or(new Ln(e,t),t,i,n,r).thenFinish(o)}),((t,i)=>{P.warn(i,`Failed to parse stylesheet text: ${e}`),t.finish(!1)}))}function Br(e,t,i,n){return Dn("parseStylesheetFromURL",(r=>{or(e).then((o=>{o.responseText?Fr(o.responseText,t,e,i,n).then((t=>{t||P.warn(`Failed to parse stylesheet from ${e}`),r.finish(!0)})):r.finish(!0)}))}),((t,i)=>{P.warn(i,"Exception while fetching and parsing:",e),t.finish(!0)}))}function Mr(e,t,i){let n=new Ar(Cr,t,new Lr(e),i);return n.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),n.result}var zr={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function Dr(e,t,i){let n=t.evaluate(e);switch(typeof n){case"number":return function(e){return!!zr[e]}(i)?n==Math.round(n)?new qt(n):new Gt(n):new Wt(n,"px");case"string":return n?Mr(t.scope,new Ln(n,null),""):zt;case"boolean":return n?oi._true:oi._false;case"undefined":return zt}throw new Error("E_UNEXPECTED")}function Vr(e,t){let i={};return Object.keys(e).forEach((n=>{let r=i[n]={},o=e[n];Object.keys(o).forEach((e=>{r[e]=o[e].map((e=>{let i=t?e.logical:e.physical,n=t?e.physical:e.logical;return{regexp:new RegExp(`(-?)${i}(-?)`),to:`$1${n}$2`}}))}))})),i}function Ur(e,t,i,n){let r=n[t];if(!r)throw new Error(`unknown writing-mode: ${t}`);let o=r[i||"ltr"];if(!o)throw new Error(`unknown direction: ${i}`);for(let t of o){let i=e.replace(t.regexp,t.to);if(i!==e)return i}return e}var Hr={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},$r=Vr(Hr,!0);function jr(e,t,i){return Ur(e,t,i||null,$r)}var Wr=Vr(Hr,!1);function Gr(e,t,i){return Ur(e,t,i||null,Wr)}var qr={"horizontal-tb":[{logical:"line-left",physical:"left"},{logical:"line-right",physical:"right"},{logical:"over",physical:"top"},{logical:"under",physical:"bottom"}],"vertical-rl":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}],"vertical-lr":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}]};function Xr(e,t,i){let n={display:t.style.display,position:t.style.position,width:t.style.width,maxWidth:t.style.maxWidth,minWidth:t.style.minWidth,height:t.style.height,maxHeight:t.style.maxHeight,minHeight:t.style.minHeight,top:t.style.top,right:t.style.right,bottom:t.style.bottom,left:t.style.left},r=t.ownerDocument,o=t.parentNode,s=r.createElement("div");function a(i){return e.getElementComputedStyle(t).getPropertyValue(i)}oe(s,"position",n.position),o.insertBefore(s,t),s.appendChild(t),oe(t,"width","auto"),oe(t,"max-width","none"),oe(t,"min-width","0"),oe(t,"height","auto"),oe(t,"max-height","none"),oe(t,"min-height","0");let l=re("writing-mode"),h=(l?a(l[0]):null)||a("writing-mode"),u="vertical-rl"===h||"tb-rl"===h||"vertical-lr"===h||"tb-lr"===h,c=u?"height":"width",d=u?"width":"height";function p(){("absolute"===n.position||"fixed"===n.position)&&(oe(s,"width",n.width),oe(s,"height",n.height),oe(s,"top",n.top),oe(s,"right",n.right),oe(s,"bottom",n.bottom),oe(s,"left",n.left)),oe(t,"display","block"),oe(t,"position","static");let e=a(c);return oe(s,"width",""),oe(s,"height",""),oe(s,"top",""),oe(s,"right",""),oe(s,"bottom",""),oe(s,"left",""),e}function f(){oe(t,"display","inline-block"),oe(s,c,"99999999px");let e=a(c);return oe(s,c,""),e}function g(){oe(t,"display","inline-block"),oe(s,c,"0");let e=a(c);return oe(s,c,""),e}function m(){let e=p(),t=g(),i=parseFloat(e);if(i<=parseFloat(t))return t;{let t=f();return i<=parseFloat(t)?e:t}}function b(){return a(d)}function v(){throw new Error("Getting fill-available block size is not implemented")}let w={};return i.forEach((e=>{var i;let r;switch(e){case"fill-available inline size":r=p();break;case"max-content inline size":r=f();break;case"min-content inline size":r=g();break;case"fit-content inline size":r=m();break;case"fill-available block size":r=v();break;case"max-content block size":case"min-content block size":case"fit-content block size":r=b();break;case"fill-available width":r=u?v():p();break;case"fill-available height":r=u?p():v();break;case"max-content width":r=u?b():f();break;case"max-content height":r=u?f():b();break;case"min-content width":r=u?b():g();break;case"min-content height":r=u?g():b();break;case"fit-content width":r=u?b():m();break;case"fit-content height":r=u?m():b()}"0px"===r&&1===t.childNodes.length&&"img"===(null==(i=t.firstElementChild)?void 0:i.localName)&&!t.firstElementChild.complete&&(r="1px"),w[e]=parseFloat(r),oe(t,"position",n.position),oe(t,"display",n.display)})),oe(t,"width",n.width),oe(t,"max-width",n.maxWidth),oe(t,"min-width",n.minWidth),oe(t,"height",n.height),oe(t,"max-height",n.maxHeight),oe(t,"min-height",n.minHeight),o.insertBefore(t,s),o.removeChild(s),w}function Yr(e){var t,i;return"clone"===(null==(t=null==e?void 0:e.style)?void 0:t["box-decoration-break"])||"clone"===(null==(i=null==e?void 0:e.style)?void 0:i["-webkit-box-decoration-break"])}function Kr(e){let t=e.getAttribute("data-viv-box-break");return t?t.split(" "):[]}function Zr(e,t){e.setAttribute("data-viv-box-break",t.join(" "))}function Jr(e,t){let i=Kr(e);i.includes(t)||(i.push(t),Zr(e,i))}function Qr(e,t){let i=function(e){let t=e.getAttribute("data-viv-margin-discard");return t?t.split(" "):[]}(e);i.includes(t)||(i.push(t),function(e,t){e.setAttribute("data-viv-margin-discard",t.join(" "))}(e,i))}var eo={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function to(e){return!!eo[e]}var io={left:!0,right:!0,recto:!0,verso:!0};function no(e){return!!io[e]}var ro={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function oo(e){return!!ro[e]}function so(e,t){if(!e)return t;if(!t)return e;if(no(t))return t;if(no(e))return e;{let i=to(e),n=to(t);if(!i||!n)return n?t:i?e:oo(t)?t:oo(e)?e:t;switch(t){case"column":return e;case"region":return"column"===e?t:e;default:return t}}}function ao(e){return to(e)?e:"auto"}I("SIMPLE_PROPERTY",(function(e){let t=e.name,i=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:i===oi.always?oi.page:i,important:e.important};default:return e}}));var lo,ho,uo,co,po,fo,go=((e,n,r)=>(r=null!=e?t(o(e)):{},a(!n&&e&&e.__esModule?r:i(r,"default",{value:e,enumerable:!0}),e)))(h());function mo(e){return e.reduce(((e,t)=>t[0]===go.default.DELETE?e:e+t[1]),"")}function bo(e,t,i){let n=0,r=0;return e.some((e=>{for(let o=0;o<e[1].length;o++){switch(e[0]*i){case go.default.INSERT:n++;break;case go.default.DELETE:n--,r++;break;case go.default.EQUAL:r++}if(r>t)return!0}return!1})),Math.max(Math.min(t,r-1)+n,0)}(e=>{e.isInstanceOfBlockFormattingContext=function(e){return e&&"Block"===e.formattingContextType}})(lo||(lo={})),(e=>{var t;(t=e.FloatReference||(e.FloatReference={})).INLINE="inline",t.COLUMN="column",t.REGION="region",t.PAGE="page"})(ho||(ho={})),(e=>{e.isInstanceOfAfterIfContinuesLayoutConstraint=function(e){return e&&"AfterIfContinue"==e.flagmentLayoutConstraintType}})(uo||(uo={})),(e=>{e.isInstanceOfRepetitiveElementsOwnerFormattingContext=function(e){return!!e&&("RepetitiveElementsOwner"===e.formattingContextType||po.isInstanceOfTableFormattingContext(e))},e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=function(e){return!!e&&("RepetitiveElementsOwner"===e.flagmentLayoutConstraintType||po.isInstanceOfTableRowLayoutConstraint(e))}})(co||(co={})),(e=>{e.isInstanceOfTableFormattingContext=function(e){return e&&"Table"===e.formattingContextType},e.isInstanceOfTableRowLayoutConstraint=function(e){return e&&"TableRow"===e.flagmentLayoutConstraintType}})(po||(po={})),(e=>{var t,i;(t=e.Whitespace||(e.Whitespace={}))[t.IGNORE=0]="IGNORE",t[t.NEWLINE=1]="NEWLINE",t[t.PRESERVE=2]="PRESERVE",(i=e.ShadowType||(e.ShadowType={}))[i.NONE=0]="NONE",i[i.CONTENT=1]="CONTENT",i[i.ROOTLESS=2]="ROOTLESS",i[i.ROOTED=3]="ROOTED"})(fo||(fo={}));var vo={transform:!0,"transform-origin":!0},wo={top:!0,bottom:!0,left:!0,right:!0},yo=class{constructor(e,t,i){this.target=e,this.name=t,this.value=i}},xo={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function So(e,t){let i=xo[t];return i?()=>{for(let t=0;t<e.length;t++)try{i(e[t])}catch(e){}}:null}var Co=class e extends xe{constructor(e,t){super(),this.container=e,this.bleedBox=t,l(this,"pageAreaElement",null),l(this,"delayedItems",[]),l(this,"hrefHandler"),l(this,"elementsById",{}),l(this,"dimensions",{width:0,height:0}),l(this,"isFirstPage",!1),l(this,"isLastPage",!1),l(this,"isBlankPage",!1),l(this,"isAutoPageWidth",!0),l(this,"isAutoPageHeight",!0),l(this,"spineIndex",0),l(this,"position",null),l(this,"offset",-1),l(this,"side",null),l(this,"fetchers",[]),l(this,"marginBoxes",{top:{},bottom:{},left:{},right:{}}),l(this,"pageType",null),this.hrefHandler=e=>{let t=e.currentTarget,i=t.getAttribute("href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href");if(i){let n={type:"hyperlink",target:null,currentTarget:null,anchorElement:t,href:i,preventDefault(){e.preventDefault()}};this.dispatchEvent(n)}}}setAutoPageWidth(t){this.isAutoPageWidth=t,t?this.container.setAttribute(e.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(e.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(t){this.isAutoPageHeight=t,t?this.container.setAttribute(e.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(e.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(e,t){let i=this.elementsById[t];i?i.push(e):this.elementsById[t]=[e]}finish(e,t){Object.keys(this.elementsById).forEach((e=>{let t=this.elementsById[e];for(let e=0;e<t.length;)this.container.contains(t[e])?e++:t.splice(e,1);0===t.length&&delete this.elementsById[e]}));let i=this.delayedItems;for(let e=0;e<i.length;e++){let t=i[e];t.target===this.container&&"transform"===t.name&&!this.isAutoPageWidth&&!this.isAutoPageHeight||oe(t.target,t.name,t.value.toString())}let n=t.getElementClientRect(this.container);this.dimensions.width=n.width,this.dimensions.height=n.height;for(let t=0;t<e.length;t++){let i=e[t],n=this.elementsById[i.ref],r=this.elementsById[i.observer];if(n&&r){let e=So(n,i.action);if(e)for(let t=0;t<r.length;t++)r[t].addEventListener(i.event,e,!1)}}}};l(Co,"AUTO_PAGE_WIDTH_ATTRIBUTE","data-vivliostyle-auto-page-width"),l(Co,"AUTO_PAGE_HEIGHT_ATTRIBUTE","data-vivliostyle-auto-page-height");var ko=Co,Eo="data-adapt-spec",Po=fo.Whitespace;function No(e){switch(e){case"normal":case"nowrap":return Po.IGNORE;case"pre-line":return Po.NEWLINE;case"pre":case"pre-wrap":case"break-spaces":return Po.PRESERVE;default:return null}}function To(e,t){if(!e)return!0;if(1==e.nodeType)return!1;let i=e.textContent;switch(t){case Po.PRESERVE:return 0==i.length;case Po.NEWLINE:return!!i.match(/^[ \t]*$/);case Po.IGNORE:default:return!!i.match(/^[ \t\r\n\f]*$/)}}var Io=class{constructor(e,t){this.flowName=e,this.parentFlowName=t,l(this,"forcedBreakOffsets",[]),l(this,"formattingContext",null)}},Ro=class{constructor(e,t,i,n,r,o,s,a,h){this.flowName=e,this.element=t,this.startOffset=i,this.priority=n,this.linger=r,this.exclusive=o,this.repeated=s,this.last=a,this.breakBefore=h,l(this,"startPage",-1)}isBetter(e){return!!this.exclusive&&(!e.exclusive||this.priority>e.priority||this.last)}};function _o(e,t){return e.top-t.top}function Ao(e,t){return t.right-e.right}function Lo(e,t){var i,n;return e===t||!(!e||!t)&&((e.node===t.node||!!e.shadowContext&&!!t.shadowContext&&e.shadowType===fo.ShadowType.ROOTLESS&&t.shadowType===fo.ShadowType.ROOTLESS&&(null==(i=e.node)?void 0:i.outerHTML)===(null==(n=t.node)?void 0:n.outerHTML))&&e.shadowType===t.shadowType&&Do(e.shadowContext,t.shadowContext)&&Do(e.nodeShadow,t.nodeShadow)&&Lo(e.shadowSibling,t.shadowSibling))}function Oo(e,t){if(e===t)return!0;if(!e||!t||e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let i=0;i<e.steps.length;i++)if(!Lo(e.steps[i],t.steps[i]))return!1;return!0}function Fo(e,t){return{steps:[{node:e.sourceNode,shadowType:Mo.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:null!=t?t:e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function Bo(e,t){let i=new Uo(e.node,t,0);return i.shadowType=e.shadowType,i.shadowContext=e.shadowContext,i.nodeShadow=e.nodeShadow,i.shadowSibling=e.shadowSibling?Bo(e.shadowSibling,t.copy()):null,i.formattingContext=e.formattingContext,i.fragmentIndex=e.fragmentIndex+1,i}var Mo=fo.ShadowType,zo=class{constructor(e,t,i,n,r,o,s){this.owner=e,this.root=t,this.xmldoc=i,this.parentShadow=n,this.type=o,this.styler=s,l(this,"subShadow",null),r&&(r.subShadow=this)}equals(e){return!!e&&(this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&Do(this.parentShadow,e.parentShadow))}};function Do(e,t){return e===t||!!e&&!!t&&e.equals(t)}var Vo=class{constructor(e,t){this.outer=e,this.count=t}},Uo=class e{constructor(e,t,i){this.sourceNode=e,this.parent=t,this.boxOffset=i,l(this,"offsetInNode",0),l(this,"after",!1),l(this,"shadowType"),l(this,"shadowContext"),l(this,"nodeShadow",null),l(this,"shadowSibling",null),l(this,"shared",!1),l(this,"inline",!0),l(this,"overflow",!1),l(this,"breakPenalty"),l(this,"display",null),l(this,"floatReference"),l(this,"floatSide",null),l(this,"clearSide",null),l(this,"floatMinWrapBlock",null),l(this,"columnSpan",null),l(this,"verticalAlign","baseline"),l(this,"captionSide","top"),l(this,"inlineBorderSpacing",0),l(this,"blockBorderSpacing",0),l(this,"flexContainer",!1),l(this,"whitespace"),l(this,"hyphenateCharacter"),l(this,"breakWord"),l(this,"establishesBFC",!1),l(this,"containingBlockForAbsolute",!1),l(this,"breakBefore",null),l(this,"breakAfter",null),l(this,"viewNode",null),l(this,"clearSpacer",null),l(this,"inheritedProps"),l(this,"vertical"),l(this,"direction"),l(this,"firstPseudo"),l(this,"lang",null),l(this,"preprocessedTextContent",null),l(this,"formattingContext"),l(this,"repeatOnBreak",null),l(this,"pluginProps",{}),l(this,"fragmentIndex",1),l(this,"afterIfContinues",null),l(this,"footnotePolicy",null),l(this,"pageType"),this.shadowType=Mo.NONE,this.shadowContext=t?t.shadowContext:null,this.breakPenalty=t?t.breakPenalty:0,this.floatReference=ho.FloatReference.INLINE,this.whitespace=t?t.whitespace:Po.IGNORE,this.hyphenateCharacter=t?t.hyphenateCharacter:null,this.breakWord=!!t&&t.breakWord,this.inheritedProps=t?t.inheritedProps:{},this.vertical=!!t&&t.vertical,this.direction=t?t.direction:"ltr",this.firstPseudo=t?t.firstPseudo:null,this.formattingContext=t?t.formattingContext:null,this.pageType=t?t.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=ho.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:Po.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=!!this.parent&&this.parent.breakWord,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=!!this.parent&&this.parent.vertical,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new e(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let e=this;do{if(e.shared)break;e.shared=!0,e=e.parent}while(e);return this}clone(){let e,t=this.cloneItem(),i=t;for(;null!=(e=i.parent);)e=e.cloneItem(),i.parent=e,i=e;return t}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){var e,t,i;let n=this,r=[];n.shadowType===fo.ShadowType.ROOTLESS&&(n.floatReference!==ho.FloatReference.INLINE||"footnote"===n.floatSide)&&null!=(i=null==(t=null==(e=n.shadowContext)?void 0:e.styler)?void 0:t.style)&&i._pseudos&&(n=n.parent);do{(!n.firstPseudo||!n.parent||n.parent.firstPseudo===n.firstPseudo)&&r.push(n.toNodePositionStep()),n=n.parent}while(n);let o=this.preprocessedTextContent?function(e,t){return bo(e,t,-1)}(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:r,offsetInNode:o,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let e=this.parent;for(;e;){if(e.establishesBFC)return!0;e=e.parent}return!1}getContainingBlockForAbsolute(){let e=this.parent;for(;e;){if(e.containingBlockForAbsolute)return e;e=e.parent}return null}belongsTo(e){return this.formattingContext===e&&!!this.parent&&this.parent.formattingContext===e}},Ho=class e{constructor(e){this.primary=e,l(this,"floats",null)}clone(){let t=new e(this.primary);if(this.floats){t.floats=[];for(let e=0;e<this.floats.length;++e)t.floats[e]=this.floats[e]}return t}isSamePosition(e){if(!e)return!1;if(this===e)return!0;if(!Oo(this.primary,e.primary))return!1;if(this.floats){if(!e.floats||this.floats.length!==e.floats.length)return!1;for(let t=0;t<this.floats.length;t++)if(!Oo(this.floats[t],e.floats[t]))return!1}else if(e.floats)return!1;return!0}},$o=class e{constructor(e,t){this.chunkPosition=e,this.flowChunk=t}clone(){return new e(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(e){return!!e&&(this===e||this.chunkPosition.isSamePosition(e.chunkPosition))}},jo=class e{constructor(){l(this,"positions",[]),l(this,"startBreakType",null),l(this,"breakAfter",null)}clone(){let t=new e,i=this.positions,n=t.positions;for(let e=0;e<i.length;e++)n[e]=i[e].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(e){if(this===e)return!0;if(!e||this.positions.length!==e.positions.length)return!1;for(let t=0;t<this.positions.length;t++)if(!this.positions[t].isSamePosition(e.positions[t]))return!1;return!0}hasContent(e){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=e}},Wo=class e{constructor(){l(this,"page",0),l(this,"flows",{}),l(this,"flowPositions",{}),l(this,"isBlankPage",!1),l(this,"highestSeenOffset",0),l(this,"highestSeenNode"),l(this,"lookupPositionOffset")}clone(){let t=new e;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let e in this.flowPositions)t.flowPositions[e]=this.flowPositions[e].clone();return t}isSamePosition(e){if(this===e)return!0;if(!e||this.page!==e.page)return!1;let t=Object.keys(this.flowPositions),i=Object.keys(e.flowPositions);if(t.length!==i.length)return!1;for(let i of t)if(!this.flowPositions[i].isSamePosition(e.flowPositions[i]))return!1;return!0}hasContent(e,t){let i=this.flowPositions[e];return!!i&&i.hasContent(t)}startSideOfFlow(e){var t;let i=null==(t=this.flowPositions[e])?void 0:t.startBreakType;return i&&no(i)?i:"any"}firstFlowChunkOfFlow(e){let t=this.flowPositions[e];if(!t)return null;let i=t.positions[0];return i?i.flowChunk:null}},Go=class{constructor(e){this.element=e,l(this,"left",0),l(this,"top",0),l(this,"marginLeft",0),l(this,"marginRight",0),l(this,"marginTop",0),l(this,"marginBottom",0),l(this,"borderLeft",0),l(this,"borderRight",0),l(this,"borderTop",0),l(this,"borderBottom",0),l(this,"paddingLeft",0),l(this,"paddingRight",0),l(this,"paddingTop",0),l(this,"paddingBottom",0),l(this,"width",0),l(this,"height",0),l(this,"originX",0),l(this,"originY",0),l(this,"exclusions",null),l(this,"innerShape",null),l(this,"computedBlockSize",0),l(this,"snapWidth",0),l(this,"snapHeight",0),l(this,"snapOffsetX",0),l(this,"snapOffsetY",0),l(this,"vertical",!1),l(this,"rtl",!1)}getInsetTop(){return this.marginTop+this.borderTop+this.paddingTop}getInsetBottom(){return this.marginBottom+this.borderBottom+this.paddingBottom}getInsetLeft(){return this.marginLeft+this.borderLeft+this.paddingLeft}getInsetRight(){return this.marginRight+this.borderRight+this.paddingRight}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?this.rtl?e.bottom:e.top:this.rtl?e.right:e.left}getEndEdge(e){return this.vertical?this.rtl?e.top:e.bottom:this.rtl?e.left:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical,this.rtl=e.rtl}setVerticalPosition(e,t){this.top=e,this.height=t,oe(this.element,"top",`${e}px`),oe(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,oe(this.element,"left",`${e}px`),oe(this.element,"width",`${t}px`)}setBlockPosition(e,t){if(this.vertical){let i=t+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(e+i*this.getBoxDir(),t)}else this.setVerticalPosition(e,t)}setInlinePosition(e,t){if(this.vertical)if(this.rtl){let i=t+this.marginTop+this.marginBottom+this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom;this.setVerticalPosition(e+i*this.getInlineDir(),t)}else this.setVerticalPosition(e,t);else if(this.rtl){let i=t+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(e+i*this.getInlineDir(),t)}else this.setHorizontalPosition(e,t)}clear(){let e,t=this.element;for(;e=t.lastChild;)t.removeChild(e)}getInnerShape(){let e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):Si(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){let e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new fi(e,t,e+this.width,t+this.height)}getPaddingRect(){let e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,i=this.paddingLeft+this.width+this.paddingRight,n=this.paddingTop+this.height+this.paddingBottom;return new fi(e,t,e+i,t+n)}getOuterShape(e,t){let i=this.getOuterRect();return Vi(e,i.x1,i.y1,i.x2-i.x1,i.y2-i.y1,t)}getOuterRect(){let e=this.originX+this.left,t=this.originY+this.top,i=this.getInsetLeft()+this.width+this.getInsetRight(),n=this.getInsetTop()+this.height+this.getInsetBottom();return new fi(e,t,e+i,t+n)}},qo=class extends Ot{constructor(e,t,i,n){super(),this.elem=e,this.context=t,this.rootContentValue=i,this.exprContentListener=n}visitStrInner(e,t){var i;if(!t){if(3===(null==(i=this.elem.lastChild)?void 0:i.nodeType))return void(this.elem.lastChild.textContent+=e);t=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute("src",e.url);else{let t=this.elem.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let t=e.toExpr(),i=t.evaluate(this.context);if("string"==typeof i){t instanceof yt&&(i=Mr(t.scope,new Ln(i,null),"").stringValue()),this.elem.ownerDocument;let e=this.exprContentListener(t,i,this.elem.ownerDocument);!e&&i&&t instanceof St&&t.str.startsWith("running-element-")&&(i=""),this.visitStrInner(i,e)}return null}};function Xo(e){return null!=e&&e!==zt&&e!==oi.normal&&e!==oi.none&&!ci(e)}var Yo=ho.FloatReference;function Ko(e){switch(e){case Yo.INLINE:return!1;case Yo.COLUMN:case Yo.REGION:case Yo.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}function Zo(e,t,i){let n=t?"vertical-rl":"horizontal-tb";if(("top"===e||"bottom"===e)&&(e=Gr(e,n,i)),"block-start"===e&&(e="inline-start"),"block-end"===e&&(e="inline-end"),"inline-start"===e||"inline-end"===e){let t=function(e,t){let i=qr[t];if(!i)throw new Error(`unknown writing-mode: ${t}`);for(let t=0;t<i.length;t++)if(i[t].physical===e)return i[t].logical;return e}(jr(e,n,i),n);"line-left"===t?e="left":"line-right"===t&&(e="right")}return"left"!==e&&"right"!==e&&(P.warn(`Invalid float value: ${e}. Fallback to left.`),e="left"),e}var Jo=class{constructor(e,t,i,n,r,o){this.nodePosition=e,this.floatReference=t,this.floatSide=i,this.clearSide=n,this.flowName=r,this.floatMinWrapBlock=o,l(this,"order",null),l(this,"id",null)}getOrder(){if(null===this.order)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}},Qo=class{constructor(){l(this,"floats",[]),l(this,"nextPageFloatIndex",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex((t=>Oo(t.nodePosition,e.nodePosition)))>=0)throw new Error("A page float with the same source node is already registered");{let t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){let t=this.floats.findIndex((t=>Oo(t.nodePosition,e)));return t>=0?this.floats[t]:null}findPageFloatById(e){let t=this.floats.findIndex((t=>t.id===e));return t>=0?this.floats[t]:null}},es=class{constructor(e,t,i,n,r){this.floatReference=e,this.floatSide=t,this.continuations=i,this.area=n,this.continues=r}hasFloat(e){return this.continuations.some((t=>t.float===e))}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){let i=this.continuations[t].float;if(!i.isAllowedOnContext(e))return i}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let e=this.continuations.map((e=>e.float));return Math.min.apply(null,e.map((e=>e.getOrder())))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach((e=>{this.continuations.push(e)}))}getFlowName(){let e=this.continuations[0].float.flowName;return this.continuations.every((t=>t.float.flowName===e)),e}},ts=class{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return!!e&&(this===e||this.float===e.float&&Oo(this.nodePosition,e.nodePosition))}},is=class{constructor(e,t,i,n,r,o,s){this.parent=e,this.floatReference=t,this.container=i,this.flowName=n,this.generatingNodePosition=r,l(this,"children",[]),l(this,"writingMode"),l(this,"direction"),l(this,"invalidated",!1),l(this,"floatStore"),l(this,"forbiddenFloats",[]),l(this,"floatFragments",[]),l(this,"stashedFloatFragments",[]),l(this,"floatAnchors",{}),l(this,"floatsDeferredToNext",[]),l(this,"floatsDeferredFromPrevious"),l(this,"layoutConstraints",[]),l(this,"locked",!1),e&&e.children.push(this),this.writingMode=o||e&&e.writingMode||oi.horizontal_tb,this.direction=s||e&&e.direction||oi.ltr,this.floatStore=e?e.floatStore:new Qo;let a=this.getPreviousSibling();this.floatsDeferredFromPrevious=a?[].concat(a.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,i,n){let r=this.children.indexOf(e);r<0&&(r=this.children.length);for(let e=r-1;e>=0;e--){let r=this.children[e];if(r.floatReference===t&&r.flowName===i&&Oo(r.generatingNodePosition,n))return r;if(r=r.getPreviousSiblingOf(null,t,i,n),r)return r}return null}getPreviousSibling(){let e,t=this,i=this.parent;for(;i;){if(e=i.getPreviousSiblingOf(t,this.floatReference,this.flowName,this.generatingNodePosition),e)return e;t=i,i=i.parent}return null}getContainer(e){return e&&e!==this.floatReference?this.getParent(e).getContainer(e):this.container}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){let t=e.getId(),i=e.floatReference;i===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),(new rs).findByFloat(e).forbid(e,this)):this.getParent(i).forbid(e)}isForbidden(e){let t=e.getId(),i=e.floatReference;return i===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(i).isForbidden(e)}addPageFloatFragment(e,t){let i=e.floatReference;i!==this.floatReference?this.getParent(i).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort(((e,t)=>e.getOrder()-t.getOrder()))),t||this.invalidate()}removePageFloatFragment(e,t){let i=e.floatReference;if(i!==this.floatReference)this.getParent(i).removePageFloatFragment(e,t);else{let i=this.floatFragments.indexOf(e);if(i>=0){let e=this.floatFragments.splice(i,1)[0],n=e.area&&e.area.element;n&&n.parentNode&&n.parentNode.removeChild(n),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);let t=this.floatFragments.findIndex((t=>t.hasFloat(e)));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return!(!(this.floatFragments.length>0)||e&&!this.floatFragments.some(e))||!!this.parent&&this.parent.hasFloatFragments(e)}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments((t=>t.continues&&t.getFlowName()===e))}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){let e=Object.assign({},this.floatAnchors);return this.children.reduce(((e,t)=>Object.assign(e,t.collectPageFloatAnchors())),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some((t=>t.float.getId()===e)))return!0;let t=this.collectPageFloatAnchors()[e];return!!(t&&this.container&&this.container.element)&&this.container.element.contains(t)}deferPageFloat(e){let t=e.float;if(t.floatReference===this.floatReference){let i=this.floatsDeferredToNext.findIndex((e=>e.float===t));i>=0?this.floatsDeferredToNext.splice(i,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);let i=e.getOrder();return!!this.floatsDeferredToNext.some((t=>t.float.getOrder()<i&&!e.isAllowedToPrecede(t.float)))||!!this.parent&&this.parent.hasPrecedingFloatsDeferredToNext(e,!0)}getLastFollowingFloatInFragments(e){let t=e.getOrder(),i=null;if(this.floatFragments.forEach((e=>{e.continuations.forEach((e=>{let n=e.float,r=n.getOrder();r>t&&(!i||r>i.getOrder())&&(i=n)}))})),this.parent){let t=this.parent.getLastFollowingFloatInFragments(e);t&&(!i||t.getOrder()>i.getOrder())&&(i=t)}return i}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter((t=>!e||t.float.flowName===e));return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort(((e,t)=>e.float.getOrder()-t.float.getOrder()))}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;let t=this.floatsDeferredToNext.filter((t=>!e||t.float.flowName===e));return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[],t=[];for(let i=this.children.length-1;i>=0;i--){let n=this.children[i];t.includes(n.flowName)||(t.push(n.flowName),e=e.concat(n.floatsDeferredToNext.map((e=>e.float))),e=e.concat(n.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){let t=this.floatFragments[e],i=t.findNotAllowedFloat(this);if(i)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(i),this.removeEndFloatFragments(t.floatSide)),!0}return!(this.floatReference!==Yo.REGION||!this.parent.locked)&&this.parent.checkAndForbidNotAllowedFloat()}checkAndForbidFloatFollowingDeferredFloat(){let e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce(((e,t)=>e.concat(t.continuations.map((e=>e.float)))),[]);t.sort(((e,t)=>t.getOrder()-e.getOrder()));for(let i of t){let t=i.getOrder();if(e.some((e=>!i.isAllowedToPrecede(e)&&t>e.getOrder()))){if(this.locked)this.invalidate();else{this.forbid(i);let e=this.findPageFloatFragment(i);this.removePageFloatFragment(e)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked)return void this.invalidate();this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach((e=>{this.floatsDeferredToNext.findIndex((t=>e.equals(t)))>=0||this.floatFragments.some((t=>t.hasFloat(e.float)))||this.floatsDeferredToNext.push(e)}))}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach((e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach((e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)}))})),this.container.clear()),this.children.forEach((e=>{e.layoutConstraints.splice(0)})),this.children.splice(0),Object.keys(this.floatAnchors).forEach((e=>{delete this.floatAnchors[e]})))}detachChildren(){let e=this.children.splice(0);return e.forEach((e=>{e.floatFragments.forEach((e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)}))})),e}attachChildren(e){e.forEach((e=>{this.children.push(e),e.reattachFloatFragments()}))}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){return Gr(e,this.writingMode.toString(),this.direction.toString())}toPhysical(e){return jr(e,this.writingMode.toString(),this.direction.toString())}toLogicalFloatSides(e){let t=e.split(" "),i=[];for(let e of t){let t=this.toLogical(e);i.includes(t)||i.push(t)}let n=[],r=!1,o=!1;for(let e=0;e<i.length;e++){let t=i[e];t.includes("block")?r||(i.slice(e+1).some((e=>e.includes("block")))?(n.push("snap-block"),r=!0):n.push(t)):t.includes("inline")&&(o||(i.slice(e+1).some((e=>e.includes("inline")))?(n.push("snap-inline"),o=!0):n.push(t)))}return n}removeEndFloatFragments(e){let t=this.toLogicalFloatSides(e)[0];if("block-end"===t||"inline-end"===t){let e=0;for(;e<this.floatFragments.length;){let i=this.floatFragments[e];this.toLogicalFloatSides(i.floatSide)[0]===t?this.removePageFloatFragment(i):e++}}}stashEndFloatFragments(e){let t=e.floatReference;if(t!==this.floatReference)return void this.getParent(t).stashEndFloatFragments(e);let i=this.toLogicalFloatSides(e.floatSide)[0];if("block-end"===i||"snap-block"===i||"inline-end"===i||"snap-inline"===i){let t=0;for(;t<this.floatFragments.length;){let n=this.floatFragments[t],r=this.toLogicalFloatSides(n.floatSide)[0];(r===i||"snap-block"===i&&"block-end"===r||"snap-inline"===i&&"inline-end"===r)&&n.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(n),this.floatFragments.splice(t,1)):t++}}}restoreStashedFragments(e){e===this.floatReference?(this.stashedFloatFragments.forEach((e=>{this.addPageFloatFragment(e,!0)})),this.stashedFloatFragments.splice(0)):this.getParent(e).restoreStashedFragments(e)}discardStashedFragments(e){e===this.floatReference?this.stashedFloatFragments.splice(0):this.getParent(e).discardStashedFragments(e)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort(((e,t)=>t.getOrder()-e.getOrder())):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,i,n){this.container;let r=this.toLogical(e),o=this.toPhysical(e),s=this.getLimitValueInner(r,t,i,n);if(this.parent&&this.parent.container){let e=this.parent.getLimitValue(o,t,i,n);switch(o){case"top":case"left":return Math.max(s,e);case"bottom":case"right":return Math.min(s,e)}}return s}getLimitValueInner(e,t,i,n){this.container;let r=this.getLimitValuesInner(t,i,n);switch(e){case"block-start":return this.container.vertical?r.right:r.top;case"block-end":return this.container.vertical?r.left:r.bottom;case"inline-start":return this.container.vertical?this.container.rtl?r.bottom:r.top:this.container.rtl?r.right:r.left;case"inline-end":return this.container.vertical?this.container.rtl?r.top:r.bottom:this.container.rtl?r.left:r.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,i){this.container;let n=this.container.originX,r=this.container.originY,o=this.container.getPaddingRect(),s={top:o.y1-r,left:o.x1-n,bottom:o.y2-r,right:o.x2-n,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function a(i,n,r){return"%"===i.unit?r*i.num/100:e.convertLengthToPx(i,n,t)}let l=this.floatFragments;return l.length>0&&(s=l.reduce(((e,t)=>{if(i&&!i(t,this))return e;let n=this.toLogicalFloatSides(t.floatSide)[0],r=t.area,s=t.continuations[0].float.floatMinWrapBlock,l=e.top,h=e.left,u=e.bottom,c=e.right,d=e.floatMinWrapBlockStart,p=e.floatMinWrapBlockEnd;switch(n){case"inline-start":r.vertical?l=Math.max(l,r.top+r.height):h=Math.max(h,r.left+r.width);break;case"block-start":r.vertical?(s&&r.left<c&&(d=a(s,r.rootViewNodes[0],o.x2-o.x1)),c=Math.min(c,r.left)):(s&&r.top+r.height>l&&(d=a(s,r.rootViewNodes[0],o.y2-o.y1)),l=Math.max(l,r.top+r.height));break;case"inline-end":r.vertical?u=Math.min(u,r.top):c=Math.min(c,r.left);break;case"block-end":r.vertical?(s&&r.left+r.width>h&&(p=a(s,r.rootViewNodes[0],o.x2-o.x1)),h=Math.max(h,r.left+r.width)):(s&&r.top<u&&(p=a(s,r.rootViewNodes[0],o.y2-o.y1)),u=Math.min(u,r.top));break;default:throw new Error(`Unknown logical float side: ${n}`)}return{top:l,left:h,bottom:u,right:c,floatMinWrapBlockStart:d,floatMinWrapBlockEnd:p}}),s)),s.left+=n,s.right+=n,s.top+=r,s.bottom+=r,s}setFloatAreaDimensions(e,t,i,n,r,o,s){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,i,n,r,o,s);let a=this.toLogicalFloatSides(i);if("snap-block"===a[0]){if(!s["block-start"]&&!s["block-end"])return null}else if("snap-inline"===a[0]){if(!s["inline-start"]&&!s["inline-end"])return null}else if(!s[a[0]])return null;e.clientLayout;let l,h,u,c,d=this.getLimitValue("block-start",e.layoutContext,e.clientLayout),p=this.getLimitValue("block-end",e.layoutContext,e.clientLayout),f=this.getLimitValue("inline-start",e.layoutContext,e.clientLayout),g=this.getLimitValue("inline-end",e.layoutContext,e.clientLayout),m=e.vertical?e.originX:e.originY,b=e.vertical?e.originY:e.originX;function v(t,i){let n=t(e.bands,i);return n?(e.vertical&&(n=Ri(n)),d=e.vertical?Math.min(d,n.x2):Math.max(d,n.y1),p=e.vertical?Math.max(p,n.x1):Math.min(p,n.y2),!0):o}if(d=e.vertical?Math.min(d,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+m):Math.max(d,e.top+m),p=e.vertical?Math.max(p,e.left+m):Math.min(p,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+m),r){let t=e.vertical?Ii(new fi(p,f,d,g)):new fi(f,d,g,p);if(("block-start"===a[0]||"snap-block"===a[0]||"inline-start"===a[0]||"snap-inline"===a[0])&&!v(Oi,t)||("block-end"===a[0]||"snap-block"===a[0]||"inline-end"===a[0]||"snap-inline"===a[0])&&!v(Fi,t)||(u=(p-d)*e.getBoxDir(),l=u-e.getInsetBefore()-e.getInsetAfter(),c=(g-f)*e.getInlineDir(),h=c-e.getInsetStart()-e.getInsetEnd(),!o&&(l<=0||h<=0)))return null}else{l=e.computedBlockSize,u=l+e.getInsetBefore()+e.getInsetAfter();let t=(p-d)*e.getBoxDir();if("snap-block"===a[0]){if(null===n)a[0]="block-start";else{let e=this.container.getPaddingRect(),t=this.container.getBoxDir()*(n-(this.container.vertical?e.x2:e.y1)),i=this.container.getBoxDir()*((this.container.vertical?e.x1:e.y2)-n-u);a[0]=t<=i?"block-start":"block-end"}if(!s[a[0]]){if(!s["block-end"])return null;a[0]="block-end"}}else if("snap-inline"===a[0])if(null===n)a[0]="inline-start";else if(s["inline-start"])a[0]="inline-start";else{if(!s["inline-end"])return null;a[0]="inline-end"}if(!o&&t<u)return null;h="inline-start"===a[0]||"inline-end"===a[0]||a[1]?Xr(e.clientLayout,e.element,["fit-content inline size"])["fit-content inline size"]:e.adjustContentRelativeSize?e.getContentInlineSize():e.vertical?e.height:e.width,c=h+e.getInsetStart()+e.getInsetEnd();let i=(g-f)*e.getInlineDir();if(!o&&i<c)return null}return d-=m,p-=m,f-=b,g-=b,a.some((e=>"inline-start"===e||"snap-inline"===e))||1===a.length&&("block-start"===a[0]||"snap-block"===a[0])?e.setInlinePosition(f,h):(a.some((e=>"inline-end"===e))||1===a.length&&"block-end"===a[0])&&e.setInlinePosition(g-c*e.getInlineDir(),h),a.some((e=>"block-start"===e||"snap-block"===e))||1===a.length&&("inline-start"===a[0]||"snap-inline"===a[0])?e.setBlockPosition(d,l):(a.some((e=>"block-end"===e))||1===a.length&&"inline-end"===a[0])&&e.setBlockPosition(p-u*e.getBoxDir(),l),a.join(" ")}getFloatFragmentExclusions(){let e=this.floatFragments.map((e=>e.getOuterShape()));return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){let e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach((t=>{e.appendChild(t.area.element)}))}getMaxReachedAfterEdge(){let e=this.getContainer().vertical;return this.floatFragments.reduce(((t,i)=>{let n=i.getOuterRect();return e?Math.min(t,n.x1):Math.max(t,n.y2)}),e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let e=this.getContainer().vertical;return this.floatFragments.filter((e=>"block-end"===e.floatSide)).reduce(((t,i)=>{let n=i.getOuterRect();return e?Math.max(t,n.x2):Math.min(t,n.y1)}),e?0:1/0)}getPageFloatClearEdge(e,t){function i(e){return t=>e.isAnchorAlreadyAppeared(t.float.getId())}function n(e,t){return e.continuations.some(i(t))}let r=t.getPaddingRect(),o=t.vertical?r.x1:r.y2,s=this;for(;s;){if(s.floatsDeferredToNext.some(i(s)))return o;s=s.parent}t.clientLayout;let a=this.getLimitValue("block-start",t.layoutContext,t.clientLayout,n);return this.getLimitValue("block-end",t.layoutContext,t.clientLayout,n)*t.getBoxDir()<o*t.getBoxDir()?o:a}getPageFloatPlacementCondition(e,t,i){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,i);let n={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!i)return n;let r,o=this.toLogicalFloatSides(t)[0],s=this.toLogical(i);r="all"===s?["block-start","block-end","inline-start","inline-end"]:"both"===s?["inline-start","inline-end"]:"same"===s?"snap-block"===o?["block-start","block-end"]:[o]:[s];let a=e.getOrder();function l(e){return t=>t.floatSide===e&&t.getOrder()<a}function h(e,t){return e.children.some((e=>e.floatFragments.some(l(t))||h(e,t)))}function u(e,t){let i=e.parent;return!!i&&(i.floatFragments.some(l(t))||u(i,t))}return r.forEach((e=>{switch(e){case"block-start":case"inline-start":n[e]=!h(this,e);break;case"block-end":case"inline-end":n[e]=!u(this,e);break;default:throw new Error(`Unexpected side: ${e}`)}})),n}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){let t=e.layoutContext,i=e.clientLayout,n=this,r=null;for(;n&&n.container;){let o=n.getLimitValuesInner(t,i);r?e.vertical?(o.right<r.right&&(r.right=o.right,r.floatMinWrapBlockStart=o.floatMinWrapBlockStart),o.left>r.left&&(r.left=o.left,r.floatMinWrapBlockEnd=o.floatMinWrapBlockEnd)):(o.top>r.top&&(r.top=o.top,r.floatMinWrapBlockStart=o.floatMinWrapBlockStart),o.bottom<r.bottom&&(r.bottom=o.bottom,r.floatMinWrapBlockEnd=o.floatMinWrapBlockEnd)):r=o,n=n.parent}let o=Math.max(r.floatMinWrapBlockStart,r.floatMinWrapBlockEnd);return(e.vertical?r.right-r.left:r.bottom-r.top)<=o}getMaxBlockSizeOfPageFloats(){let e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map((t=>{let i=t.area;return e?i.width:i.height}))):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},ns=[],rs=class{static register(e){ns.push(e)}findByNodeContext(e){for(let t=ns.length-1;t>=0;t--){let i=ns[t];if(i.appliesToNodeContext(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=ns.length-1;t>=0;t--){let i=ns[t];if(i.appliesToFloat(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}};rs.register(new class{appliesToNodeContext(e){return Ko(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,i){let n=e.floatReference;e.floatSide;let r=e.floatSide,o=e.toNodePosition();return i.resolveFloatReferenceFromColumnSpan(n,e.columnSpan,e).thenAsync((i=>{n=i,t.flowName;let s=new Jo(o,n,r,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(s),zn(s)}))}createPageFloatFragment(e,t,i,n){let r=e[0].float;return new es(r.floatReference,t,e,i,n)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,i){}forbid(e,t){}});var os=es,ss=class e extends Jo{constructor(e,t,i,n,r){super(e,t,"block-end",null,i,r),this.footnotePolicy=n}isAllowedToPrecede(t){return!(t instanceof e)}},as=class extends os{constructor(e,t,i,n){super(e,"block-end",t,i,n)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof ss||this.getOrder()<e.getOrder()}},ls=class{constructor(e){this.footnote=e}allowLayout(e){return!Oo(e.toNodePosition(),this.footnote.nodePosition)}};function hs(e){let t,i=(null==e?void 0:e.toString())||"block";switch(i){case"inline-flex":t="flex";break;case"inline-grid":t="grid";break;case"inline-table":t="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":t="block";break;default:t=i}return jt(t)}function us(e){return e===oi.absolute||e===oi.fixed}function cs(e){return e instanceof ei&&"running"===e.name}function ds(e,t,i,n){return e===oi.none||(us(t)?(i=oi.none,e=hs(e)):(i&&i!==oi.none&&!ci(i)||n)&&(e=hs(e))),{display:e,position:t,float:i}}function ps(e,t,i,n){return ds(e,t,i,n).display===oi.block}function fs(e){switch(e.toString()){case"inline":case"inline-block":case"inline-list-item":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return!1}}function gs(e){switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}function ms(e,t,i,n){let r=e.viewNode;if(!r)return NaN;let o=1===r.nodeType?r:r.parentElement;if(o&&"http://www.w3.org/1999/xhtml"===o.namespaceURI){let e=o.style;if(e&&fs(e.display)&&/^([\d\.]|super|(text-)?top)/.test(e.verticalAlign))return NaN}if(r===o){if(e.after||!e.inline){if(e.after&&!e.inline&&o.querySelector("ruby")){let e=o.parentNode,t=o.nextSibling;e.removeChild(o),e.insertBefore(o,t)}let i=t.getElementClientRect(o);if(0===i.left&&0===i.top&&0===i.right&&0===i.bottom)return NaN;if(i.right>=i.left&&i.bottom>=i.top)return e.after?n?i.left:i.bottom:n?i.right:i.top}return NaN}{let o=NaN,s=r.ownerDocument.createRange(),a=r.textContent.length;if(!a)return NaN;e.after&&(i+=a),i>=a&&(i=a-1),s.setStart(r,i),s.setEnd(r,i+1);let l=t.getRangeClientRects(s);return l=l.filter((e=>e.right>e.left&&e.bottom>e.top)),l.length?(o=n?Math.min.apply(null,l.map((e=>e.left))):Math.max.apply(null,l.map((e=>e.bottom))),o):NaN}}function bs(e,t,i){let n=t.clientLayout.getElementClientRect(e),r=t.getComputedMargin(e);return i?n.width+r.left+r.right:n.height+r.top+r.bottom}function vs(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function ws(e,t){var i;if(e)for(let n=e.lastChild,r=n;n!==t;n=r)r=n.previousSibling,(1!==n.nodeType||!n.hasAttribute("data-vivliostyle-float-box-moved")||"inline"!==(null==(i=t.style)?void 0:i.display))&&e.removeChild(n)}function ys(e){return!!e.getAttribute(Eo)}function xs(e){var t;if(1!==(null==e?void 0:e.nodeType))return!1;let i=e;if(ys(i))return!0;let n=null==(t=i.style)?void 0:t.position;return"absolute"===n||"fixed"===n}function Ss(e){let t=null==e?void 0:e.viewNode;return 1===(null==t?void 0:t.nodeType)&&ys(t)}function Cs(e){return"inline"!==e&&(fs(e)||gs(e))}function ks(e){var t;for(let i=e.parent;i;i=i.parent)if(("inline"!==i.display||i.vertical!==(null==(t=i.parent)?void 0:t.vertical))&&fs(i.display))return i;return null}rs.register(new class{appliesToNodeContext(e){return"footnote"===e.floatSide}appliesToFloat(e){return e instanceof ss}createPageFloat(e,t,i){let n=Yo.REGION,r=t.getPageFloatLayoutContext(n);t.getPageFloatLayoutContext(Yo.PAGE).hasSameContainerAs(r)&&(n=Yo.PAGE);let o=e.toNodePosition();t.flowName;let s=new ss(o,n,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(s),zn(s)}createPageFloatFragment(e,t,i,n){let r=e[0].float;return new as(r.floatReference,e,i,n)}findPageFloatFragment(e,t){let i=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter((e=>e instanceof as));return i.length,i[0]||null}adjustPageFloatArea(e,t,i){e.isFootnote=!0,e.adjustContentRelativeSize=!1;let n=e.element;e.vertical=i.layoutContext.applyFootnoteStyle(t.vertical,i.layoutContext.nodeContext&&"rtl"===i.layoutContext.nodeContext.direction,n),e.convertPercentageSizesToPx(n),i.setComputedInsets(n,e),i.setComputedWidthAndHeight(n,e)}forbid(e,t){let i=e;switch(i.footnotePolicy){case oi.line:{let e=new ls(i);t.addLayoutConstraint(e,i.floatReference);break}}}});var Es=class{calculateOffset(e){return Ps(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}};function Ps(e,t){return{current:t.reduce(((t,i)=>t+i.calculateOffset(e)),0),minimum:t.reduce(((t,i)=>t+i.calculateMinimumOffset(e)),0)}}var Ns=class extends Es{constructor(e,t,i,n){super(),this.position=e,this.breakOnEdge=t,this.overflows=i,this.computedBlockSize=n,l(this,"overflowIfRepetitiveElementsDropped"),l(this,"isEdgeUpdated",!1),l(this,"edge",0),this.overflowIfRepetitiveElementsDropped=i}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(oo(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var t;let i=e.calculateClonedPaddingBorder(this.position);if(this.edge=ms(this.position,e.clientLayout,0,e.vertical)+i,this.position.after||this.position.inline){if(this.position.after&&"table-cell"===(null==(t=this.position.shadowContext)?void 0:t.root.id)){let t=e.element.parentElement,i=null==t?void 0:t.closest("table, [style*='display: table;']");if(i){let n="collapse"===i.style.borderCollapse,r=0,o=0;for(let s=t;s;s=s.parentElement){let a=e.clientLayout.getElementComputedStyle(s);if((s===t||s===i&&!n)&&(r+=e.parseComputedLength(a.paddingBlockEnd)),s===i&&!n&&(r+=e.parseComputedLength(a.borderSpacing.replace(/^\S+ (\S+)$/,"$1"))),n?o=Math.max(o,e.parseComputedLength(a.borderBlockEndWidth)):(s===t||s===i)&&(o+=e.parseComputedLength(a.borderBlockEndWidth)),s===i)break}this.edge+=(e.vertical?-1:1)*(r+o)}}}else{let t=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*t}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let t=this.edge,i=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*i.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*i.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:t}=e.parent;if(!co.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;let i=t.getRepetitiveElements();return!!i&&i.isFirstContentNode(e)}},Ts=class{find(e){let t=_("RESOLVE_LAYOUT_PROCESSOR");for(let i=0;i<t.length;i++){let n=t[i](e);if(n)return n}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}},Is=class{layout(e,t,i){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,i,n){return new Ns(e.copy(),t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,i,n){var r;if(!i.viewNode||!i.viewNode.parentNode||i.shadowType===fo.ShadowType.ROOTLESS&&Ss(i))return;let o=i.viewNode;"viv-ts-inner"===(null==(r=o.parentElement)?void 0:r.localName)&&(o=o.parentElement.parentElement);let s=o.parentNode;ws(s,o),n&&s.removeChild(o)}finishBreak(e,t,i,n){let r=i||null!=t.viewNode&&1==t.viewNode.nodeType&&!t.after;return e.clearOverflownViewNodes(t,r),n&&e.layoutContext.processFragmentedBlockEdge(t),zn(!0)}},Rs=class{constructor(e){this.parent=e,l(this,"formattingContextType","Block")}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}},_s=new Is,As=lo.isInstanceOfBlockFormattingContext;I("RESOLVE_FORMATTING_CONTEXT",((e,t,i,n,r,o)=>{let s=e.parent;return!s&&e.formattingContext||s&&e.formattingContext!==s.formattingContext?null:e.establishesBFC||!e.formattingContext&&ps(i,n,r,o)?new Rs(s?s.formattingContext:null):null})),I("RESOLVE_LAYOUT_PROCESSOR",(e=>e instanceof Rs?_s:null));var Ls=class{constructor(){l(this,"initialBreakPositions",null),l(this,"initialStateOfFormattingContext",null),l(this,"initialPosition"),l(this,"initialFragmentLayoutConstraints")}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){let i=Mn("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);let n=this.resolveLayoutMode(e);return n.doLayout(e,t).then((r=>{let o=n.accept(r,t);o=n.postLayout(r,this.initialPosition,t,o),o?i.finish(r):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(i))})),i.result()}prepareLayout(e,t){}clearNodes(e){let t,i,n=e.viewNode||e.parent.viewNode;for(;t=n.lastChild;)n.removeChild(t);for(;i=n.nextSibling;)i.parentNode.removeChild(i)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}},Os=class{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}},Fs=class{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){let t=this.strategy,i=t.initialState(e),n=Mn("LayoutIterator");return n.loopWithFrame((e=>{let n;for(;i.nodeContext;){n=i.nodeContext.viewNode?1!==i.nodeContext.viewNode.nodeType?To(i.nodeContext.viewNode,i.nodeContext.whitespace)?i.nodeContext.after?t.afterIgnoredTextNode(i):t.startIgnoredTextNode(i):i.nodeContext.after?t.afterNonElementNode(i):t.startNonElementNode(i):i.nodeContext.inline?i.nodeContext.after?t.afterInlineElementNode(i):t.startInlineElementNode(i):i.nodeContext.after?t.afterNonInlineElementNode(i):t.startNonInlineElementNode(i):i.nodeContext.after?t.afterNonDisplayableNode(i):t.startNonDisplayableNode(i);let r=(n&&n.isPending()?n:zn(!0)).thenAsync((()=>i.break?zn(null):this.layoutContext.nextInTree(i.nodeContext,i.atUnforcedBreak)));if(r.isPending())return void r.then((t=>{i.break?e.breakLoop():(i.nodeContext=t,e.continueLoop())}));if(i.break)return void e.breakLoop();i.nodeContext=r.get()}t.finish(i),e.breakLoop()})).then((()=>{n.finish(i.nodeContext)})),n.result()}},Bs=class extends Os{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){let i=!e.leadingEdge&&to(e.breakAtTheEdge);if(i){let i=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;i.viewNode.parentNode.removeChild(i.viewNode),t.pageBreakType=e.breakAtTheEdge}return i}saveEdgeAndProcessOverflow(e,t){let i=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return i&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),i}processLayoutConstraint(e,t,i){let n=e.nodeContext,r=!t.allowLayout(n);return r&&(i.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),n=e.nodeContext=n.modify(),n.overflow=!0),r}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=so(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,i;return e.onStartEdges?(t=this.endEmptyNonInlineBox(e),i=t&&t.isPending()?t:zn(!0),i=i.thenAsync((()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),zn(!0))))):(t=this.endNonInlineBox(e),i=t&&t.isPending()?t:zn(!0)),i.thenAsync((()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=so(e.breakAtTheEdge,e.nodeContext.breakAfter)),zn(!0))))}},Ms=[];function zs(e,t,i){return e-=i,0===t?0===e:e%t==0&&e/t>=0}var Ds=class{constructor(e){this.matchers=e}matches(){return this.matchers.some((e=>e.matches()))}},Vs=class{constructor(e){this.matchers=e}matches(){return this.matchers.every((e=>e.matches()))}},Us=class e{constructor(e,t,i){this.elementOffset=e,this.a=t,this.b=i}static registerFragmentIndex(t,i,n){let r=e.fragmentIndices;(!r[t]||r[t].priority<=n)&&(r[t]={fragmentIndex:i,priority:n})}static clearFragmentIndices(){e.fragmentIndices={}}matches(){let t=e.fragmentIndices[this.elementOffset];return null!=t&&null!=t.fragmentIndex&&zs(t.fragmentIndex,this.a,this.b)}};l(Us,"fragmentIndices",{});var Hs=Us,$s=class{static buildViewConditionMatcher(e,t){let i=t.split("_");return"NFS"==i[0]?new Hs(e,parseInt(i[1],10),parseInt(i[2],10)):null}static buildAllMatcher(e){return new Vs(e)}static buildAnyMatcher(e){return new Ds(e)}},js={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant-ligatures":!0,"font-variant-caps":!0,"font-variant-numeric":!0,"font-variant-east-asian":!0,"font-weight":!0,"glyph-orientation-vertical":!0,"hanging-punctuation":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,quotes:!0,"ruby-align":!0,"ruby-position":!0,"shape-rendering":!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-autospace":!0,"text-decoration-skip":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-fill-color":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-rendering":!0,"text-size-adjust":!0,"text-spacing-trim":!0,"text-stroke-color":!0,"text-stroke-width":!0,"text-transform":!0,"text-underline-position":!0,visibility:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"writing-mode":!0},Ws=["image-resolution","orphans","widows"],Gs={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0,"http://www.w3.org/1998/Math/MathML":!0},qs=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],Xs=["max-%","min-%","%"],Ys=(()=>{let e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let i=0;i<qs.length;i++)for(let n=0;n<e.length;n++){t[qs[i].replace("%",e[n])]=!0}return t})();function Ks(e,t){let i={};for(let t of qs)for(let n in e){let r=t.replace("%",n),o=t.replace("%",e[n]);i[r]=o,i[o]=r}for(let e of Xs)for(let n in t){let r=e.replace("%",n),o=e.replace("%",t[n]);i[r]=o,i[o]=r}return i}var Zs=Ks({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),Js=Ks({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),Qs=Ks({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),ea=Ks({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"}),ta=class e{constructor(e,t){this.value=e,this.priority=t}getBaseValue(){return this}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new e(i,this.priority)}increaseSpecificity(t){return 0==t?this:new e(this.value,this.priority+t)}evaluate(e,t,i,n){return t&&pi(t)?this.value:$l(e,this.value,t,i,n)}isEnabled(e){return!0}},ia=class e extends ta{constructor(e,t,i){super(e,t),this.condition=i}getBaseValue(){return new ta(this.value,this.priority)}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new e(i,this.priority,this.condition)}increaseSpecificity(t){return 0==t?this:new e(this.value,this.priority+t,this.condition)}isEnabled(e){try{return!!this.condition.evaluate(e)}catch(e){P.warn(e)}return!1}};function na(e,t,i){return(!t||i.priority>=t.priority)&&i.isEnabled(e)?i.getBaseValue():t}function ra(e,t,i,n){if(e)if(i){let r=e[t];(!r||i.priority>=r.priority)&&(n?i.isEnabled(n)&&(e[t]=i.getBaseValue()):e[t]=i)}else delete e[t]}var oa={"region-id":!0,"fragment-selector-id":!0};function sa(e){return!!oa[e]}function aa(e){return"_"===e.charAt(0)&&"_viewConditionalStyles"!==e}function la(e){return"_"!==e.charAt(0)&&!oa[e]}function ha(e){return!!js[e]||pi(e)}function ua(e,t){return e[t]}function ca(e,t,i){i?e[t]=i:delete e[t]}function da(e,t){return e[t]}function pa(e,t){let i=e[t];return i||(i={},e[t]=i),i}var fa=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function ga(e,t){return e[t]}function ma(e,t){let i=e[t];return i||(i=[],e[t]=i),i}function ba(e,t,i,n,r,o,s){var a,l;if([{id:r,styleKey:"_pseudos"},{id:o,styleKey:"_regions"}].forEach((e=>{if(e.id){let i=pa(t,e.styleKey);(t=i[e.id])||(t={},i[e.id]=t)}})),s){let e=fa(t);t={},e.push({styles:t,matcher:s})}for(let r in i)if(!aa(r))if(sa(r)){let e=ga(i,r),n=ma(t,r);Array.prototype.push.apply(n,e)}else{let o=ua(i,r);if(!o.isEnabled(e))continue;let s=o.increaseSpecificity(n);ra(t,r,s,e);let h=null==(l=null==(a=e.style)?void 0:a.validatorSet.shorthands[r])?void 0:l.propList;if(h)for(let i of h){let n=new ta(zt,s.priority);ra(t,i,n,e)}}}function va(e,t){if(e.length>0){e.sort(((e,t)=>t.getPriority()-e.getPriority()));let i=null;for(let n=e.length-1;n>=0;n--)i=e[n],i.chained=t,t=i;return i}return t}var wa=class extends Ft{constructor(e,t){super(),this.props=e,this.context=t,l(this,"propName","")}setPropName(e){this.propName=e}getFontSize(){let e=ua(this.props,"font-size");if(!e.value.isNumeric())return je.em;let t=e.value;if(!function(e){switch(null==e?void 0:e.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}(t.unit))throw new Error("Unexpected state");return t.num*je[t.unit]}visitNumeric(e){return this.context,"font-size"===this.propName?xa(e,this.getFontSize(),this.context):"em"===e.unit||"ex"===e.unit||"rem"===e.unit||"lh"===e.unit||"rlh"===e.unit?ya(e,this.getFontSize(),this.context):e}visitExpr(e){return"font-size"==this.propName?$l(this.context,e,this.propName).visit(this):e}};function ya(e,t,i){let n=e.unit,r=e.num;if("em"===n||"ex"===n){return new Wt(r*(je[n]/je.em)*t,"px")}return"rem"===n?new Wt(r*i.fontSize(),"px"):"rlh"===n?new Wt(r*i.rootLineHeight,"px"):e}function xa(e,t,i){let n=(e=ya(e,t,i)).unit,r=e.num;return"px"===n?e:new Wt("%"===n?r/100*t:r*i.queryUnitSize(n,!1),"px")}var Sa=class{apply(e){}mergeWith(e){return new ka([this,e])}clone(){return this}},Ca=class extends Sa{constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},ka=class e extends Sa{constructor(e){super(),this.list=e}apply(e){for(let t=0;t<this.list.length;t++)this.list[t].apply(e)}mergeWith(e){return this.list.push(e),this}clone(){return new e([].concat(this.list))}},Ea=class extends Sa{constructor(e,t,i,n,r){super(),this.style=e,this.specificity=t,this.pseudoelement=i,this.regionId=n,this.viewConditionId=r}apply(e){ba(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},Pa=class extends Sa{constructor(){super(),l(this,"chained",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},Na=class extends Pa{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},Ta=class extends Pa{constructor(e){super(),this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},Ia=class extends Pa{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},Ra=class extends Pa{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);let i=t+this.localName;e.insertInTable(e.nstags,i,this.chained)}return!0}},_a=class extends Pa{constructor(e,t){super(),this.epubTypePatt=e,this.targetLocalName=t}apply(e){let t=e.currentElement;if(t instanceof HTMLAnchorElement&&t.hash&&t.href==t.baseURI+t.hash){let i=t.hash.substring(1),n=t.ownerDocument.getElementById(i);if(n&&(!this.targetLocalName||n.localName==this.targetLocalName)){let t=n.getAttributeNS("http://www.idpf.org/2007/ops","type")||n.getAttribute("epub:type");t&&t.match(this.epubTypePatt)&&this.chained.apply(e)}}}},Aa=class extends Pa{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function La(e,t,i,n){if(!e)return!1;if(null!==t)return n(e,t,i);for(let t of e.getAttributeNames())if((t===i||t.endsWith(`:${i}`))&&n(e,t===i?"":e.lookupNamespaceURI(t.split(":")[0]),i))return!0;return!1}var Oa=class extends Pa{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){La(e.currentElement,this.ns,this.name,((e,t,i)=>e.hasAttributeNS(t,i)))&&this.chained.apply(e)}},Fa=class extends Pa{constructor(e,t,i){super(),this.ns=e,this.name=t,this.value=i}apply(e){La(e.currentElement,this.ns,this.name,((e,t,i)=>e.getAttributeNS(t,i)==this.value))&&this.chained.apply(e)}getPriority(){return"type"==this.name&&"http://www.idpf.org/2007/ops"==this.ns?9:0}makePrimary(e){return"type"==this.name&&"http://www.idpf.org/2007/ops"==this.ns&&(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0)}},Ba=class extends Pa{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){La(e.currentElement,this.ns,this.name,((e,t,i)=>!!Gs[e.getAttributeNS(t,i)]))&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},Ma=class extends Pa{constructor(e,t,i){super(),this.ns=e,this.name=t,this.regexp=i}apply(e){La(e.currentElement,this.ns,this.name,((e,t,i)=>{var n;return!(null==(n=e.getAttributeNS(t,i))||!n.match(this.regexp))}))&&this.chained.apply(e)}},za=class extends Pa{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},Da=class extends Pa{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}},Va=class extends Pa{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}},Ua=class extends Pa{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return zs(e,this.a,this.b)}},Ha=class extends Ua{constructor(e,t){super(e,t)}apply(e){let t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}},$a=class extends Ua{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;null===t&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},ja=class extends Ua{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let i=e.currentElement;do{let e=i.namespaceURI,n=i.localName,r=t[e];r||(r=t[e]={}),r[n]=(r[n]||0)+1}while(i=i.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}},Wa=class extends Pa{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}},Ga=class extends Pa{constructor(){super()}apply(e){!1===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}},qa=class extends Pa{constructor(){super()}apply(e){!0===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}},Xa=class extends Pa{constructor(){super()}apply(e){let t=e.currentElement;(!0===t.selected||!0===t.checked)&&this.chained.apply(e)}getPriority(){return 5}},Ya=class extends Pa{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},Ka=class e extends Sa{constructor(){super(),l(this,"applied",!1)}apply(e){this.applied=!0}clone(){let t=new e;return t.applied=this.applied,t}},Za=class extends Pa{constructor(e){super(),l(this,"checkAppliedAction"),l(this,"firstActions",[]),this.checkAppliedAction=new Ka;for(let t of e)this.firstActions.push(va(t,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map((e=>e instanceof Pa?e.getPriority():0)))}positive(){return!0}relational(){return!1}},Ja=class extends Za{positive(){return!1}},Qa=class extends Za{constructor(e){super([]),this.selectorTexts=e}apply(e){for(let t of this.selectorTexts){let i,n;/^\s*[+~]/.test(t)?(n=e.currentElement.parentNode,i=`:scope > :nth-child(${Array.from(n.children).indexOf(e.currentElement)+1}) ${t}`):(n=e.currentElement,i=`:scope ${t}`);try{if(n.querySelector(i)){this.checkAppliedAction.apply(e);break}}catch(e){}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},el=class{constructor(e,t,i){this.condition=e,this.viewConditionId=t,this.viewCondition=i}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}},tl=class e extends el{constructor(e,t,i){super(e,t,i)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return 0==t&&this.increment(e),!1}pop(e,t){return 0==t&&(this.decrement(e),!0)}},il=class e extends el{constructor(e,t,i){super(e,t,i)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return 0==t?this.increment(e):1==t&&this.decrement(e),!1}pop(e,t){return 0==t?(this.decrement(e),!0):(1==t&&this.increment(e),!1)}},nl=class e extends el{constructor(e,t,i){super(e,t,i),l(this,"fired",!1)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return!!this.fired&&(this.decrement(e),!0)}pop(e,t){return this.fired?(this.decrement(e),!0):(0==t&&(this.fired=!0,this.increment(e)),!1)}},rl=class e extends el{constructor(e,t,i){super(e,t,i),l(this,"fired",!1)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return this.fired&&(-1==t?this.increment(e):0==t&&this.decrement(e)),!1}pop(e,t){if(this.fired){if(-1==t)return this.decrement(e),!0;0==t&&this.increment(e)}else 0==t&&(this.fired=!0,this.increment(e));return!1}},ol=class{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.processPseudoelementProps(this.afterprop,this.element),!0)}},sl=class{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.lang=this.lang,!0)}},al=class{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.quotes=this.oldQuotes,!0)}},ll=class extends Ft{constructor(e){super(),this.element=e}createValueFromString(e,t){return"url"===t?new Yt(e||"about:invalid"):new Ut(e||"")}visitFunc(e){if("attr"!==e.name)return super.visitFunc(e);let t="string",i=null,n=null;if(e.values[0]instanceof Jt){let n=e.values[0].values;n.length>=2&&(t=n[1].stringValue()),i=n[0].stringValue()}else i=e.values[0].stringValue();return n=e.values.length>1?this.createValueFromString(e.values[1].stringValue(),t):this.createValueFromString(null,t),this.element&&this.element.hasAttribute(i)?this.createValueFromString(this.element.getAttribute(i),t):n}};function hl(e){if(Xo(e)){if(e instanceof Ut)return e.stringValue();if(e instanceof Jt)return e.values.map((e=>hl(e))).join("")}return""}var ul=class extends Ft{constructor(e,t,i){super(),this.cascade=e,this.element=t,this.counterResolver=i}visitIdent(e){let t=this.cascade,i=t.quotes,n=Math.floor(i.length/2)-1;switch(e.name){case"open-quote":{let e=i[2*Math.min(n,t.quoteDepth)];return t.quoteDepth++,e}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,i[2*Math.min(n,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new Ut("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new Ut("")}return e}format(e,t){let i,n=!1,r=!1;null!=(i=t.match(/^upper-(.*)/))?(n=!0,t=i[1]):null!=(i=t.match(/^lower-(.*)/))&&(r=!0,t=i[1]);let o="";return cl[t]?o=function(e,t){let i=e[0];if(t>i||t<=0||t!=Math.round(t))return"";let n="";for(let i=1;i<e.length;i+=2){let r=e[i],o=Math.floor(t/r);if(o>20)return"";for(t-=o*r;o>0;)n+=e[i+1],o--}return n}(cl[t],e):dl[t]?o=function(e,t){if(t<=0||t!=Math.round(t))return"";let i=function(e){let t=[],i=0;for(;i<e.length;)if("-"==e.substr(i+1,1)){let n=e.charCodeAt(i),r=e.charCodeAt(i+2);i+=3;for(let e=n;e<=r;e++)t.push(String.fromCharCode(e))}else t.push(e.substr(i++,1));return t}(e),n="";do{let e=--t%i.length;n=i[e]+n,t=(t-e)/i.length}while(t>0);return n}(dl[t],e):null!=pl[t]?o=pl[t]:"decimal-leading-zero"==t?(o=`${e}`,1==o.length&&(o=`0${o}`)):o="cjk-ideographic"==t||"trad-chinese-informal"==t?function(e,t){if(e>9999||e<-9999)return`${e}`;if(0==e)return t.digits.charAt(0);let i=new le;if(e<0&&(i.append(t.negative),e=-e),e<10)i.append(t.digits.charAt(e));else if(!t.formal&&e<=19)i.append(t.markers.charAt(0)),0!=e&&i.append(t.digits.charAt(e-10));else{let n=Math.floor(e/1e3);n&&(i.append(t.digits.charAt(n)),i.append(t.markers.charAt(2)));let r=Math.floor(e/100)%10;r&&(i.append(t.digits.charAt(r)),i.append(t.markers.charAt(1)));let o=Math.floor(e/10)%10;o&&(i.append(t.digits.charAt(o)),i.append(t.markers.charAt(0)));let s=e%10;s&&i.append(t.digits.charAt(s))}return i.toString()}(e,fl):`${e}`,n?o.toUpperCase():r?o.toLowerCase():o}visitFuncCounter(e){let t=e[0].toString(),i=e.length>1?e[1].stringValue():"decimal",n=this.cascade.counters[t];if(n&&n.length){let e=n&&n.length&&n[n.length-1]||0;return new Ut(this.format(e,i))}{let e=new ti(this.counterResolver.getPageCounterVal(t,(e=>this.format(e||0,i))));return new Jt([e])}}visitFuncCounters(e){let t=e[0].toString(),i=e[1].stringValue(),n=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],o=new le;if(r&&r.length)for(let e=0;e<r.length;e++)e>0&&o.append(i),o.append(this.format(r[e],n));let s=new ti(this.counterResolver.getPageCountersVal(t,(e=>{let t=[];if(e.length)for(let i=0;i<e.length;i++)t.push(this.format(e[i],n));let r=o.toString();return r.length&&t.push(r),t.length?t.join(i):this.format(0,n)})));return new Jt([s])}visitFuncTargetCounter(e){let t,i=e[0];t=i instanceof Yt?i.url:i.stringValue();let n=e[1].toString(),r=e.length>2?e[2].stringValue():"decimal",o=new ti(this.counterResolver.getTargetCounterVal(t,n,(e=>this.format(e||0,r))));return new Jt([o])}visitFuncTargetCounters(e){let t,i=e[0];t=i instanceof Yt?i.url:i.stringValue();let n=e[1].toString(),r=e[2].stringValue(),o=e.length>3?e[3].stringValue():"decimal",s=new ti(this.counterResolver.getTargetCountersVal(t,n,(e=>{let t=e.map((e=>this.format(e,o)));return t.length?t.join(r):this.format(0,o)})));return new Jt([s])}visitFuncString(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new ti(this.counterResolver.getNamedStringVal(t,i))}visitFuncElement(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new ti(this.counterResolver.getRunningElementVal(t,i))}visitFuncContent(e){var t,i,n,r,o,s;let a=e.length>0?e[0].stringValue():"text",l="";switch(a){case"text":l=this.element.textContent;break;case"before":case"after":{let e=da(this.cascade.currentStyle,"_pseudos");l=hl(null==(i=null==(t=null==e?void 0:e[a])?void 0:t.content)?void 0:i.value)}break;case"first-letter":{let e=da(this.cascade.currentStyle,"_pseudos"),t=(hl(null==(r=null==(n=null==e?void 0:e.before)?void 0:n.content)?void 0:r.value)||this.element.textContent||hl(null==(s=null==(o=null==e?void 0:e.after)?void 0:o.content)?void 0:s.value)).match(H);l=t?t[0]:""}}return new Ut(l)}visitFuncLeader(e){let t="";if(e[0]instanceof $t)switch(e[0].stringValue()){case"dotted":t=".";break;case"solid":t="_";break;case"space":t=" "}else e[0]instanceof Ut&&(t=e[0].stringValue());return 0==t.length?new Ut(""):new ti(new St(null,(()=>t),"viv-leader"))}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case"string":if(e.values.length<=2)return this.visitFuncString(e.values);break;case"element":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case"content":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case"leader":if(e.values.length<=1)return this.visitFuncLeader(e.values)}return e}};I("POST_LAYOUT_BLOCK",((e,t,i)=>{let n=t.filter((e=>e.after&&1===e.viewNode.nodeType&&e.viewNode.getAttribute("data-viv-leader")));for(let e of n){let t=function(e){if("rtl"===d){let t="";a.textContent=(e.startsWith(t)?"":t)+e+(e.endsWith(t)?"":t)}else a.textContent=e},n=function(){let e=i.clientLayout.getElementClientRect(l);return f.left>e.left||f.right<e.right||f.top>e.top||f.bottom<e.bottom},r=function(){let e,i;if(t(u),n())e=1,i=u.length/h.length;else{e=u.length/h.length,i=e;for(let e=0;e<16;e++){let r=u;for(let t=0;t<1<<e;t++)r+=h;if(t(r),n()){i+=1<<e;break}}}for(let r=0;r<16;r++){let r="",o=Math.floor((e+i)/2);for(let e=0;e<o;e++)r+=h;if(t(r),n())i=o;else{if(e==o)return;e=o}}t(h)},o=function(e){let t=0,n=l.parentElement;for(;n&&n!==s.viewNode;)t+=i.getComputedInsets(n)[e],n=n.parentElement;return t},s=e.parent;for(;s&&s.inline;)s=s.parent;let a=e.viewNode,l=a.parentElement,h=a.getAttribute("data-viv-leader-value"),u=a.textContent||h,{writingMode:c,direction:d,marginInlineEnd:p}=i.clientLayout.getElementComputedStyle(l);a.style.marginInlineStart="1px",t(h),l.style.display="inline-block",l.style.textIndent="0";let f=i.clientLayout.getElementClientRect(s.viewNode),g=i.clientLayout.getElementClientRect(l),m=i.parseComputedLength(p);"vertical-rl"===c||"vertical-lr"===c?("rtl"===d?f.top+=m:f.bottom-=m,f.left=g.left,f.right=g.right,f.top=Math.min(g.top,f.top),f.bottom=Math.max(g.bottom,f.bottom)):("rtl"===d?f.left+=m:f.right-=m,f.top=g.top,f.bottom=g.bottom,f.left=Math.min(g.left,f.left),f.right=Math.max(g.right,f.right)),r();let b=i.clientLayout.getElementClientRect(l);l.style.float="rtl"==d?"left":"right";let v=i.clientLayout.getElementClientRect(l),w=0;w="rtl"==d?"vertical-rl"==c||"vertical-lr"==c?b.top-v.top-o("top"):b.left-v.left-o("left"):"vertical-rl"==c||"vertical-lr"==c?v.bottom-b.bottom-o("bottom"):v.right-b.right-o("right"),w=Math.max(0,w-.1),l.style.float="",a.style.marginInlineStart=`${w}px`}}));var cl={roman:[4999,1e3,"M",900,"CM",500,"D",400,"CD",100,"C",90,"XC",50,"L",40,"XL",10,"X",9,"IX",5,"V",4,"IV",1,"I"],armenian:[9999,9e3,"",8e3,"",7e3,"",6e3,"",5e3,"",4e3,"",3e3,"",2e3,"",1e3,"",900,"",800,"",700,"",600,"",500,"",400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""],georgian:[19999,1e4,"",9e3,"",8e3,"",7e3,"",6e3,"",5e3,"",4e3,"",3e3,"",2e3,"",1e3,"",900,"",800,"",700,"",600,"",500,"",400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""],hebrew:[999,400,"",300,"",200,"",100,"",90,"",80,"",70,"",60,"",50,"",40,"",30,"",20,"",19,"",18,"",17,"",16,"",15,"",10,"",9,"",8,"",7,"",6,"",5,"",4,"",3,"",2,"",1,""]},dl={latin:"a-z",alpha:"a-z",greek:"--",russian:"---"},pl={square:"",disc:"",circle:"",none:""},fl={formal:!1,digits:"",markers:"",negative:""},gl=1/1048576;function ml(e,t){for(let i in e)t[i]=e[i].clone()}var bl=class e{constructor(){l(this,"nsCount",0),l(this,"nsPrefix",{}),l(this,"tags",{}),l(this,"nstags",{}),l(this,"epubtypes",{}),l(this,"classes",{}),l(this,"ids",{}),l(this,"pagetypes",{}),l(this,"order",0)}clone(){let t=new e;t.nsCount=this.nsCount;for(let e in this.nsPrefix)t.nsPrefix[e]=this.nsPrefix[e];return ml(this.tags,t.tags),ml(this.nstags,t.nstags),ml(this.epubtypes,t.epubtypes),ml(this.classes,t.classes),ml(this.ids,t.ids),ml(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(e,t,i){let n=e[t];n&&(i=n.mergeWith(i)),e[t]=i}createInstance(e,t,i,n){return new vl(this,e,t,i,n)}nextOrder(){return this.order+=gl}},vl=class{constructor(e,t,i,n,r){this.context=t,this.counterListener=i,this.counterResolver=n,l(this,"code"),l(this,"stack",[[],[]]),l(this,"conditions",{}),l(this,"currentElement",null),l(this,"currentElementOffset",null),l(this,"currentStyle",null),l(this,"currentClassNames",null),l(this,"currentLocalName",""),l(this,"currentNamespace",""),l(this,"currentId",""),l(this,"currentXmlId",""),l(this,"currentNSTag",""),l(this,"currentEpubTypes",null),l(this,"currentPageType",null),l(this,"previousPageType",null),l(this,"firstPageType",null),l(this,"isFirst",!0),l(this,"isRoot",!0),l(this,"counters",{}),l(this,"counterScoping",[{}]),l(this,"quotes"),l(this,"quoteDepth",0),l(this,"lang",""),l(this,"siblingOrderStack",[0]),l(this,"currentSiblingOrder",0),l(this,"siblingTypeCountsStack",[{}]),l(this,"currentSiblingTypeCounts"),l(this,"currentFollowingSiblingOrder",null),l(this,"followingSiblingOrderStack"),l(this,"followingSiblingTypeCountsStack",[{}]),l(this,"currentFollowingSiblingTypeCounts"),l(this,"viewConditions",{}),l(this,"dependentConditions",[]),l(this,"elementStack"),this.code=e,this.quotes=[new Ut(""),new Ut(""),new Ut(""),new Ut("")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter((e=>e!==t)),0===this.viewConditions[e].length&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(this.currentElementOffset,t=$s.buildViewConditionMatcher(this.currentElementOffset,e));let i=this.dependentConditions.map((e=>{let t=this.viewConditions[e];return t&&t.length>0?1===t.length?t[0]:$s.buildAnyMatcher([].concat(t)):null})).filter((e=>e));return i.length<=0?t:null===t?1===i.length?i[0]:$s.buildAllMatcher(i):$s.buildAllMatcher([t].concat(i))}applyAction(e,t){let i=e[t];i&&i.apply(this)}pushRule(e,t,i){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=i,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=wl,this.currentPageType=t,this.applyActions()}defineCounter(e,t){let i=this.counterScoping[this.counterScoping.length-1];i||(i={},this.counterScoping[this.counterScoping.length-1]=i),this.counters[e]?(i[e]&&this.counters[e].pop(),this.counters[e].push(t)):this.counters[e]=[t],i[e]=!0}pushCounters(e){var t,i,n,r,o,s,a;let l=oi.inline,h=e.display;if(h&&(l=h.evaluate(this.context)),l===oi.none)return this.currentElement.setAttribute("data-viv-display-none","true"),void this.counterScoping.push(null);if(this.currentElement.closest("[data-viv-display-none]"))return void this.counterScoping.push(null);let u=oi.inline,c=e.float;c&&(u=c.evaluate(this.context));let d=null,p=null,f=null,g=e["counter-reset"];if(g){let e=g.evaluate(this.context);e&&(d=Hi(e,!0))}let m=e["counter-set"];if(m){let e=m.evaluate(this.context);e&&(f=Hi(e,!1))}let b=e["counter-increment"];if(b){let e=b.evaluate(this.context);e&&(p=Hi(e,!1))}if(("ol"==this.currentLocalName||"ul"==this.currentLocalName)&&"http://www.w3.org/1999/xhtml"==this.currentNamespace&&(d||(d={}),d["list-item"]=(null!=(i=null==(t=this.currentElement)?void 0:t.start)?i:1)-1),l===oi.list_item&&(p||(p={}),p["list-item"]=null!=(n=p["list-item"])?n:1,/^\s*[-+]?\d/.test(null!=(o=null==(r=this.currentElement)?void 0:r.getAttribute("value"))?o:"")&&(f||(f={}),f["list-item"]=this.currentElement.value)),(null==(s=this.currentElement)?void 0:s.parentNode.nodeType)===Node.DOCUMENT_NODE&&(d||(d={}),void 0===d.footnote&&(d.footnote=0)),u===oi.footnote&&(p||(p={}),void 0===p.footnote)){let e=null==(a=this.currentStyle["counter-increment"])?void 0:a.value;(!e||!(e===oi.footnote||e instanceof Jt&&e.values.includes(oi.footnote)))&&(p.footnote=1)}if(d)for(let e in d)this.defineCounter(e,d[e]);if(p)for(let e in p){this.counters[e]||this.defineCounter(e,0);let t=this.counters[e];t[t.length-1]+=p[e]}if(f)for(let e in f)if(this.counters[e]){let t=this.counters[e];t[t.length-1]=f[e]}else this.defineCounter(e,f[e]);if(l===oi.list_item){let t=this.counters["list-item"],i=t[t.length-1];e["ua-list-item-count"]=new ta(new Gt(i),0)}this.counterScoping.push(null)}popCounters(){let e=this.counterScoping.pop();if(e)for(let t in e){let e=this.counters[t];e&&(1==e.length?delete this.counters[t]:e.pop())}}setNamedStrings(e){let t=e["string-set"];if(!t)return;t=t.filterValue(new ul(this,this.currentElement,this.counterResolver));let i=t.value instanceof Qt?t.value.values:[t.value];for(let e of i)if(e instanceof Jt){let t=e.values[0].stringValue(),i=e.values.slice(1).map((e=>hl(e))).join("");this.counterResolver.setNamedString(t,i,this.currentElementOffset)}delete e["string-set"]}setRunningElement(e){let t=e.position;if((null==t?void 0:t.value)instanceof ei&&"running"===t.value.name){let e=t.value.values[0].stringValue();this.counterResolver.setRunningElement(e,this.currentElementOffset)}}processPseudoelementProps(e,t){this.pushCounters(e);let i=e.content;i&&(e.content=i.filterValue(new ul(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,i,n){var r,o;this.currentPageType=null,this.currentElement=t,this.currentElementOffset=n,this.currentStyle=i,this.currentNamespace=t.namespaceURI,this.currentLocalName=t.localName;let s=this.code.nsPrefix[this.currentNamespace];this.currentNSTag=s?s+this.currentLocalName:"",this.currentId=t.getAttribute("id"),this.currentXmlId=t.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");let a=t.getAttribute("class");this.currentClassNames=a?a.split(/\s+/):wl;let l=t.getAttributeNS("http://www.idpf.org/2007/ops","type");this.currentEpubTypes=l?l.split(/\s+/):wl;let h=ae(t);h&&(this.stack[this.stack.length-1].push(new sl(this.lang)),this.lang=h.toLowerCase());let u=this.isRoot,c=this.siblingOrderStack;this.currentSiblingOrder=++c[c.length-1],c.push(0);let d=this.siblingTypeCountsStack,p=this.currentSiblingTypeCounts=d[d.length-1],f=p[this.currentNamespace];f||(f=p[this.currentNamespace]={}),f[this.currentLocalName]=(f[this.currentLocalName]||0)+1,d.push({});let g=this.followingSiblingOrderStack;null!==g[g.length-1]?this.currentFollowingSiblingOrder=--g[g.length-1]:this.currentFollowingSiblingOrder=null,g.push(null);let m=this.followingSiblingTypeCountsStack,b=this.currentFollowingSiblingTypeCounts=m[m.length-1];b&&b[this.currentNamespace]&&b[this.currentNamespace][this.currentLocalName]--,m.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],e,t),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(t);let v=i.quotes,w=null;if(v){let e=v.evaluate(this.context);e&&(w=new al(this.quotes),e===oi.none?this.quotes=[new Ut(""),new Ut("")]:e===oi.auto||e===oi.initial?this.quotes=[new Ut(""),new Ut(""),new Ut(""),new Ut("")]:e instanceof Jt&&(this.quotes=e.values))}this.pushCounters(this.currentStyle);let y=this.currentId||this.currentXmlId||t.getAttribute("name")||"";if(u||y){let e={};Object.keys(this.counters).forEach((t=>{e[t]=Array.from(this.counters[t])})),this.counterListener.countersOfId(y,e)}let x=da(this.currentStyle,"_pseudos");if(x){let e=!0;for(let i of yl){i||(e=!1);let n=x[i];n&&(("before"!==i&&"after"!==i||Xo(null==(r=n.content)?void 0:r.value))&&("footnote-call"!==i&&"footnote-marker"!==i||(null==(o=ua(this.currentStyle,"float"))?void 0:o.value)===oi.footnote)?e?this.processPseudoelementProps(n,t):this.stack[this.stack.length-2].push(new ol(n,t)):delete x[i])}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),w&&this.stack[this.stack.length-2].push(w)}applyAttrFilterInner(e,t){for(let i in t)la(i)&&!pi(i)&&(t[i]=t[i].filterValue(e))}applyAttrFilter(e){let t=new ll(e),i=this.currentStyle,n=da(i,"_pseudos");for(let e in n)this.applyAttrFilterInner(t,n[e]);this.applyAttrFilterInner(t,i)}applyVarFilter(e,t,i){var n,r,o;let s=e[0],a=new Ul(e,t,i),l={};for(let h in s)if(aa(h)){let n=da(s,h);for(let r in n)this.applyVarFilter([n[r],...e],t,i)}else if(la(h)){let e=ua(s,h),i=e.value;for(let e=0;;e++){if(e>=32){i=zt;break}let t=i.visit(a);if(a.error){i=zt,a.error=!1;break}if(t===i)break;i=t}if(i!==e.value){let a=t.validatorSet,u=null==(n=null==a?void 0:a.shorthands[h])?void 0:n.clone();if(u)if(ci(i)){for(let t of u.propList){let n=new ta(i,e.priority),r=ua(s,t);ca(l,t,na(this.context,r,n))}delete s[h]}else{let n=Mr(t.scope,new Ln(i.toString(),null),"");if(n&&(n.visit(u),!u.error)){for(let t of u.propList){let i=new ta(null!=(o=null!=(r=u.values[t])?r:a.defaultValues[t])?o:oi.initial,e.priority),n=ua(s,t);ca(l,t,na(this.context,n,i))}delete s[h]}}else s[h]=new ta(i,e.priority)}if(l[h]){let e=ua(s,h);e&&e.value!==zt&&ra(l,h,e,this.context)}}for(let e in l)s[e]=l[e]}applyCalcFilter(e,t){let i=new Hl(t);for(let n in e)if(aa(n)){let i=da(e,n);for(let e in i)this.applyCalcFilter(i[e],t)}else if(la(n)&&!pi(n)){let t=ua(e,n),r=t.value.visit(i);r!==t.value&&(e[n]=new ta(r,t.priority))}}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),""!=this.currentLocalName&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),null!==this.currentPageType&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.stack.push([]);for(let t=1;t>=-1;--t){let i=this.stack[this.stack.length-t-2];for(e=0;e<i.length;)i[e].push(this,t)?i.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){let t=this.stack[this.stack.length-e-2],i=0;for(;i<t.length;)t[i].pop(this,e)?t.splice(i,1):i++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},wl=[],yl=["before","transclusion-before","footnote-call","footnote-marker","inner","first-letter","first-line","","transclusion-after","after"],xl=null,Sl=class extends mr{constructor(e,t,i,n,r,o,s){super(e,t,s),this.condition=i,this.regionId=r,this.validatorSet=o,l(this,"chain",null),l(this,"specificity",0),l(this,"elementStyle",null),l(this,"conditionCount",0),l(this,"pseudoelement",null),l(this,"footnoteContent",!1),l(this,"cascade"),l(this,"state"),l(this,"viewConditionId",null),l(this,"insideSelectorRule"),l(this,"invalid",!1),this.cascade=n?n.cascade:xl?xl.clone():new bl,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){let t=va(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return 0!=this.state&&(this.reportAndSkip(e),!0)}tagSelector(e,t){!t&&!e||(t&&(this.specificity+=1),t&&e?this.chain.push(new Ra(e,t.toLowerCase())):t?this.chain.push(new Ia(t.toLowerCase())):this.chain.push(new Aa(e)))}invalidSelector(e){P.warn(e),this.chain.push(new Ya("")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof El;e=e.parent)e.parent.invalid=!0}classSelector(e){this.pseudoelement?this.invalidSelector(`::${this.pseudoelement} followed by .${e}`):(this.specificity+=256,this.chain.push(new Na(e)))}pseudoclassSelector(e,t){if(this.pseudoelement)this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);else{switch(e.toLowerCase()){case"enabled":this.chain.push(new Ga);break;case"disabled":this.chain.push(new qa);break;case"checked":this.chain.push(new Xa);break;case"root":case"scope":this.chain.push(new Va);break;case"link":this.chain.push(new Ia("a")),this.chain.push(new Oa("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&t.length>=1&&"string"==typeof t[0]){let e=t[0],i=new RegExp(`(^|\\s)${ge(e)}($|\\s)`),n=t[1];this.chain.push(new _a(i,n))}else this.chain.push(new Ya(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new Ya(""));break;case"lang":if(t&&1==t.length&&"string"==typeof t[0]){let e=t[0];this.chain.push(new za(new RegExp(`^${ge(e.toLowerCase())}($|-)`)))}else this.chain.push(new Ya(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{let i=Cl[e.toLowerCase()];t&&2==t.length?this.chain.push(new i(t[0],t[1])):this.chain.push(new Ya(""));break}case"first-child":this.chain.push(new Da);break;case"last-child":this.chain.push(new $a(0,1));break;case"first-of-type":this.chain.push(new Ha(0,1));break;case"last-of-type":this.chain.push(new ja(0,1));break;case"only-child":this.chain.push(new Da),this.chain.push(new $a(0,1));break;case"only-of-type":this.chain.push(new Ha(0,1)),this.chain.push(new ja(0,1));break;case"empty":this.chain.push(new Wa);break;case"before":case"after":case"first-line":case"first-letter":return void this.pseudoelementSelector(e,t);default:return void this.invalidSelector(`Unknown pseudo-class :${e}`)}this.specificity+=256}}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"inner":case"after-if-continues":if(this.pseudoelement)return void this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);this.pseudoelement=e;break;case"first-n-lines":if(t&&1==t.length&&"number"==typeof t[0]){let i=Math.round(t[0]);if(i>0&&i==t[0]){if(this.pseudoelement)return void this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);this.pseudoelement=`first-${i}-lines`;break}}this.chain.push(new Ya(""));break;case"nth-fragment":t&&2==t.length?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new Ya(""));break;default:return void this.invalidSelector(`Unknown pseudo-element ::${e}`)}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new Ta(e))}attributeSelector(e,t,i,n){let r;switch(this.specificity+=256,t=t.toLowerCase(),n=n||"",i){case 0:r=new Oa(e,t);break;case 39:r=new Fa(e,t,n);break;case 45:r=!n||n.match(/\s/)?new Ya(""):new Ma(e,t,new RegExp(`(^|\\s)${ge(n)}($|\\s)`));break;case 44:r=new Ma(e,t,new RegExp(`^${ge(n)}($|-)`));break;case 43:r=n?new Ma(e,t,new RegExp(`^${ge(n)}`)):new Ya("");break;case 42:r=n?new Ma(e,t,new RegExp(`${ge(n)}$`)):new Ya("");break;case 46:r=n?new Ma(e,t,new RegExp(ge(n))):new Ya("");break;case 50:if("supported"!=n)return void this.invalidSelector(`Unsupported :: attr selector op: ${n}`);r=new Ba(e,t);break;default:return void this.invalidSelector(`Unsupported attr selector: ${i}`)}this.chain.push(r)}descendantSelector(){let e="d"+kl++;this.processChain(new Ca(new tl(e,this.viewConditionId,null))),this.chain=[new Ya(e)],this.viewConditionId=null}childSelector(){let e="c"+kl++;this.processChain(new Ca(new il(e,this.viewConditionId,null))),this.chain=[new Ya(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e="a"+kl++;this.processChain(new Ca(new nl(e,this.viewConditionId,null))),this.chain=[new Ya(e)],this.viewConditionId=null}followingSiblingSelector(){let e="f"+kl++;this.processChain(new Ca(new rl(e,this.viewConditionId,null))),this.chain=[new Ya(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,t){super.error(e,t),1==this.state&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),1==this.state&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t=t?"xxx-bogus-xxx":"footnote"),new Ea(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let i;i=this.condition?new ia(t,0,this.condition):new ta(t,0),ma(this.elementStyle,e).push(i)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){"display"==e&&(t===oi.oeb_page_head||t===oi.oeb_page_foot)&&(this.simpleProperty("flow-options",new Jt([oi.exclusive,oi._static]),i),this.simpleProperty("flow-into",t,i),t=oi.block),_("SIMPLE_PROPERTY").forEach((n=>{let r=n({name:e,value:t,important:i});e=r.name,t=r.value,i=r.important}));let n=(i?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),r=this.condition?new ia(t,n,this.condition):new ta(t,n);ra(this.elementStyle,e,r)}finish(){return this.cascade}startFuncWithSelector(e){let t;switch(e){case"is":t=new El(this);break;case"not":t=new Pl(this);break;case"where":t=new Nl(this);break;case"has":t=new Tl(this)}t&&(t.startSelectorRule(),this.owner.pushHandler(t))}},Cl={"nth-child":class extends Ua{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},"nth-of-type":Ha,"nth-last-child":$a,"nth-last-of-type":ja},kl=0,El=class e extends Sl{constructor(e){super(e.scope,e.owner,e.condition,e,e.regionId,e.validatorSet,!1),this.parent=e,l(this,"parentChain"),l(this,"chains",[]),l(this,"maxSpecificity",0),l(this,"selectorTexts",[]),this.parentChain=e.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new Qa(this.selectorTexts):this.positive()?new Za(this.chains):new Ja(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new Ya("")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}error(t,i){super.error(t,i),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let n=!1;for(let t=this;t instanceof e;t=t.parent)if(t.forgiving()){n=!0;break}n||this.owner.popHandler()}pushSelectorText(e){this.chain&&this.relational()&&this.selectorTexts.push(e)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},Pl=class extends El{positive(){return!1}forgiving(){return!1}},Nl=class extends El{increasingSpecificity(){return!1}},Tl=class extends El{relational(){return!0}},Il=class extends mr{constructor(e,t){super(e,t,!1)}property(e,t,i){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{let i=e.match(/height|^(top|bottom)$/)?"vh":"vw",n=new wt(this.scope,100,i);this.scope.defineName(e,t.toExpr(this.scope,n))}}},Rl=class extends mr{constructor(e,t,i,n,r,o){super(e,t,!1),this.condition=i,this.elementStyle=n,this.validatorSet=r,this.ruleType=o,l(this,"order"),this.order=0}property(e,t,i){i?P.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){P.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){P.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity();n+=this.order,this.order+=gl;let r=this.condition?new ia(t,n,this.condition):new ta(t,n);ra(this.elementStyle,e,r)}},_l=class extends Lr{constructor(e,t){super(e),this.validatorSet=t,l(this,"elementStyle",{}),l(this,"order",0)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){P.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){P.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?dr:cr;n+=this.order,this.order+=gl;let r=new ta(t,n);ra(this.elementStyle,e,r)}};function Al(e,t){let i=fa(e);i&&i.forEach((e=>{e.matcher.matches()&&t(e.styles)}))}function Ll(e,t,i){Al(i,(i=>{Dl(e,i,t)}))}function Ol(e,t,i,n){let r=new _l(e,t),o=new Ln(n,r);try{!function(e,t,i){new Ar(vr,e,t,i).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}(o,r,i)}catch(e){P.warn(e,"Style attribute parse error:")}return r.elementStyle}function Fl(e,t,i){let n=e["writing-mode"];if(n){let e=n.evaluate(t,"writing-mode");if(e&&e!==oi.inherit&&e!==oi.revert&&e!==oi.unset)return e===oi.vertical_rl}return i}function Bl(e,t,i){let n=e.direction;if(n){let e=n.evaluate(t,"direction");if(e&&e!==oi.inherit&&e!==oi.revert&&e!==oi.unset)return e===oi.rtl}return i}function Ml(e,t,i,n,r){let o={};for(let t in e)la(t)&&(o[t]=ua(e,t));return Ll(o,t,e),zl(e,i,n,((e,i)=>{Dl(o,i,t),Ll(o,t,i)})),o}function zl(e,t,i,n){let r=da(e,"_regions");if((t||i)&&r){if(i){let e=["footnote"];t=t?t.concat(e):e}for(let e of t){let t=r[e];t&&n(e,t)}}}function Dl(e,t,i){for(let n in t)if(la(n)){let r=ua(t,n),o=e[n];e[n]=na(i,o,r)}}var Vl=(e,t,i,n,r)=>{let o=i?n?Qs:Zs:n?ea:Js;for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];if(!n)continue;let s,a=o[i];if(a){let t=e[a];if(t&&t.priority>n.priority)continue;s=Ys[a]?a:i}else s=i;t[s]=r(i,n)}},Ul=class extends Ft{constructor(e,t,i){super(),this.elementStyles=e,this.styler=t,this.element=i}getVarValue(e){var t,i,n,r,o;let s=null!=(t=this.element)?t:this.styler.root;if(null!=(i=this.elementStyles)&&i.length){for(let t of this.elementStyles){let i=null==(n=t[e])?void 0:n.value;if(i)return i}this.element&&(s=this.element.parentElement)}for(;s;s=s.parentElement){let t=null==(o=null==(r=this.styler.getStyle(s,!1))?void 0:r[e])?void 0:o.value;if(t)return t}return null}visitFunc(e){if("var"!==e.name)return super.visitFunc(e);let t=e.values[0]instanceof $t&&e.values[0].name;return t&&pi(t)?this.getVarValue(t)||(e.values.length<2?(this.error=!0,zt):2===e.values.length?e.values[1]:new Qt(e.values.slice(1))):(this.error=!0,zt)}},Hl=class extends Ft{constructor(e,t,i,n){super(),this.context=e,this.resolveViewportUnit=t,this.percentRef=i,this.vertical=n}visitFunc(e){let t=super.visitFunc(e);if("calc"!==e.name)return t;let i=t.toString().replace(/^calc\b/,"-epubx-expr");if(/\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\W|\Wvar\(\s*--/i.test(i))return t;let n=Mr(this.context.rootScope,new Ln(i,null),"");if(n instanceof ti)try{let e=n.expr.evaluate(this.context);"number"==typeof e&&!isNaN(e)&&(/\d(px|in|pt|pc|cm|mm|q|rem|rlh)\W/i.test(i)?t=new Wt(e,"px"):/\d[a-z]/i.test(i)||(t=new Gt(e)))}catch(e){P.warn(e)}return t}visitNumeric(e){return this.resolveViewportUnit&&($e(e.unit)||function(e){switch(null==e?void 0:e.toLowerCase()){case"rem":case"rlh":return!0;default:return!1}}(e.unit))?new Wt(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),"px"):"number"==typeof this.percentRef&&"%"===e.unit?new Wt(e.num*this.percentRef/100,"px"):e}};function $l(e,t,i,n,r){try{if(t instanceof ti)return t.expr instanceof St&&(t.expr.str.startsWith("named-string-")||t.expr.str.startsWith("running-element-"))?t:Dr(e,t.expr,i);if(t instanceof Wt||t instanceof ei||t instanceof Jt||t instanceof Qt)return t.visit(new Hl(e,!0,n,r))}catch(e){return P.warn(e),zt}return t}var jl={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function Wl(e){let t=e instanceof Bt?e:"string"==typeof e?jt(e):oi.none;if(t===oi.none)return jl;let i=t instanceof Jt?t.values:[t],n=Object.create(jl);for(let e of i)if(e instanceof $t)switch(e.name){case"first":n.first=!0;break;case"force-end":n.forceEnd=!0,n.allowEnd=!1;break;case"allow-end":n.forceEnd=!1,n.allowEnd=!0;break;case"last":n.last=!0}return n}function Gl(e){return!(e.first||e.last||e.forceEnd||e.allowEnd)}var ql={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},Xl={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},Yl={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function Kl(e){let t=e instanceof Bt?e:"string"==typeof e?jt(e):oi.normal;if(t===oi.normal)return Xl;if(t===oi.auto)return Yl;let i=t instanceof Jt?t.values:[t],n=Object.create(Xl);for(let e of i)if(e instanceof $t)switch(e.name){case"trim-both":case"trim-auto":return Yl;case"space-all":return ql;case"trim-start":n.trimStart=!0,n.spaceFirst=!1;break;case"space-start":n.trimStart=!1,n.spaceFirst=!1;break;case"space-first":n.trimStart=!1,n.spaceFirst=!0;break;case"trim-end":n.trimEnd=!0,n.allowEnd=!1;break;case"space-end":n.trimEnd=!1,n.allowEnd=!1;break;case"allow-end":n.trimEnd=!1,n.allowEnd=!0;break;case"trim-adjacent":n.trimAdjacent=!0;break;case"space-adjacent":n.trimAdjacent=!1}return n}var Zl={ideographAlpha:!1,ideographNumeric:!1},Jl={ideographAlpha:!0,ideographNumeric:!0};function Ql(e){let t=e instanceof Bt?e:"string"==typeof e?jt(e):oi.normal;if(t===oi.normal||t===oi.auto)return Jl;if(t===oi.none)return Zl;let i=t instanceof Jt?t.values:[t],n=Object.create(Zl);for(let e of i)if(e instanceof $t)switch(e.name){case"no-autospace":return Zl;case"ideograph-alpha":n.ideographAlpha=!0;break;case"ideograph-numeric":n.ideographNumeric=!0}return n}function eh(e,t){return!(e.ideographAlpha||e.ideographNumeric||t.trimStart||t.spaceFirst||t.trimEnd||t.allowEnd||t.trimAdjacent)}function th(e){return e?(e=e.toLowerCase(),/^zh\b.*-(hant|tw|hk)\b/.test(e)?"zh-hant":/^zh\b/.test(e)?"zh-hans":/^ja\b/.test(e)?"ja":/^ko\b/.test(e)?"ko":e):null}var ih=new class{getPolyfilledInheritedProps(){return["hanging-punctuation","text-autospace","text-spacing-trim"]}preprocessSingleDocument(e){e.body&&this.preprocessForTextSpacing(e.body)}preprocessForTextSpacing(e){var t;let i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);for(let e=i.nextNode();e;e=i.nextNode()){if("http://www.w3.org/1999/xhtml"!==e.parentElement.namespaceURI||"true"===(null==(t=e.parentElement.dataset)?void 0:t.mathTypeset))continue;let i=e.textContent.replace(/(?![()\[\]{}])[\p{Ps}\p{Pe}\p{Pf}\p{Pi}\u3000]\p{M}*(?=\P{M})|.(?=(?![()\[\]{}])[\p{Ps}\p{Pe}\p{Pf}\p{Pi}\u3000])|(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]\p{M}*(?=(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])[\p{L}\p{Nd}])|(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])[\p{L}\p{Nd}]\p{M}*(?=(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF])/gsu,"$&\0").split("\0");if(i.length>1){let t=i.length-1;for(let n=0;n<t;n++)e.parentNode.insertBefore(document.createTextNode(i[n]),e);e.textContent=i[t]}}}processGeneratedContent(e,t,i,n,r,o){r=th(r);let s=Ql(t),a=Kl(i),l=Wl(n);if(Gl(l)&&eh(s,a))return;this.preprocessForTextSpacing(e);let h=e.style.whiteSpace;0===(o?e.offsetHeight:e.offsetWidth)&&(e.style.whiteSpace="pre");let u=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),c=null,d=null;for(let e=u.nextNode();e;e=d){d=u.nextNode();let t=!c,i=!c||/\n$/.test(c.textContent),n=!d||/^\n/.test(d.textContent),h=!d;this.processTextSpacing(e,t||i,t,i,n,h,c,d,s,a,l,r,o),c=e}e.style.whiteSpace=h}postLayoutBlock(e,t){var i,n,r,o,s,a,l;let h=!e||1===e.fragmentIndex&&function(){let e=t[0];for(let t=e;;t=t.parent)if(!t||!t.inline){if(1!==(null==t?void 0:t.fragmentIndex))return!1;break}if(!e.inline)return!0;for(let t=e.viewNode.previousSibling;t;t=t.previousSibling)if(!To(t,e.whitespace)&&!c(t))return!1;return!0}(),u=h||function(){var e,i;let n,r=t[0];for(;r&&r.inline&&(n=null==(e=r.viewNode)?void 0:e.previousSibling,!n||(3===n.nodeType&&/^[ \t\r\n\f]*$/.test(n.textContent)&&r.whitespace!==Po.PRESERVE&&(n=n.previousSibling),!n));)r=r.parent;for(;n;){if(1===n.nodeType){if("br"===n.localName)return!0;let e=null==(i=n.style)?void 0:i.display;if(e&&"inline"!==e)return!/^(inline|ruby)\b/.test(e)}else if(3===n.nodeType)if(r.whitespace===Po.PRESERVE){if(/\n$/.test(n.textContent))return!0}else if(r.whitespace===Po.NEWLINE&&/\n[ \t\r\n\f]*$/.test(n.textContent))return!0;n=n.lastChild}return!1}();function c(e){var t;if(1!==(null==e?void 0:e.nodeType))return!1;let i=e;if(i.hasAttribute(Eo))return!0;let{position:n,float:r}=null!=(t=i.style)?t:{};return"absolute"===n||"fixed"===n||r&&"none"!==r}let d=-1;for(let p=0;p<t.length;p++){let f=t[p];if(!f.after&&f.inline&&!f.display&&f.parent&&f.viewNode.parentNode&&f.viewNode.nodeType===Node.TEXT_NODE&&!To(f.viewNode,f.whitespace)){let g=function(e){var t,i,n;if(1===(null==(t=e.viewNode)?void 0:t.nodeType))return"br"===e.viewNode.localName;if(3===(null==(i=e.viewNode)?void 0:i.nodeType)){if(e.whitespace===Po.PRESERVE){if(/\n$/.test(e.viewNode.textContent))return!0}else if(e.whitespace===Po.NEWLINE&&/\n[ \t\r\n\f]*$/.test(e.viewNode.textContent))return!0;if("br"===(null==(n=e.viewNode.previousElementSibling)?void 0:n.localName))return To(e.viewNode,e.whitespace)}return!1},m=function(e){var t,i,n;if(1===(null==(t=e.viewNode)?void 0:t.nodeType))return"br"===e.viewNode.localName;if(3===(null==(i=e.viewNode)?void 0:i.nodeType)){if(e.whitespace===Po.PRESERVE){if(/^\n/.test(e.viewNode.textContent))return!0}else if(e.whitespace===Po.NEWLINE&&/^[ \t\r\n\f]*\n/.test(e.viewNode.textContent))return!0;if("br"===(null==(n=e.viewNode.nextElementSibling)?void 0:n.localName))return To(e.viewNode,e.whitespace)}return!1},b=th(null!=(o=null!=(n=null!=(i=f.lang)?i:f.parent.lang)?n:null==e?void 0:e.lang)?o:null==(r=null==e?void 0:e.parent)?void 0:r.lang),v=Ql(f.inheritedProps["text-autospace"]),w=Kl(f.inheritedProps["text-spacing-trim"]),y=Wl(f.inheritedProps["hanging-punctuation"]);if(Gl(y)&&eh(v,w)||/\b(flex|grid)\b/.test(f.parent.display))continue;d<0&&(d=p);let x=null,S=null,C=p===d,k=p===d&&h,E=p===d&&u,P=!1,N=!1;for(let e=p-1;e>=0;e--){let i=t[e];if(g(i)){E=!0;break}if(!i.display&&i.viewNode.nodeType===Node.TEXT_NODE&&i.viewNode.textContent.length>0){x=i.viewNode;break}if(i.display&&!/^(inline|ruby)\b/.test(i.display)||1===(null==(s=i.viewNode)?void 0:s.nodeType)&&("br"===i.viewNode.localName||Se[i.viewNode.localName]))break;0===e&&(C=!0,h&&(k=!0,E=!0))}for(let e=p+1;e<t.length;e++){let i=t[e];if(m(i)){P=!0;break}if(i.viewNode!==f.viewNode&&!i.display&&i.viewNode.nodeType===Node.TEXT_NODE&&i.viewNode.textContent.length>0){S=i.viewNode;break}if(i.display&&!/^(inline|ruby)\b/.test(i.display)||1===(null==(a=i.viewNode)?void 0:a.nodeType)&&("br"===i.viewNode.localName||Se[i.viewNode.localName])){e===t.length-1&&c(i.viewNode)&&(N=!0);break}if(e===t.length-1){P=!0,N=!0;for(let e=i.viewNode.nextSibling;e;e=e.nextSibling)if(!c(e)){N=!1;break}}}if("inline-block"===(null==(l=f.parent)?void 0:l.display)){if(!k){let e=f.parent.viewNode.firstChild;for(;To(e,f.whitespace);)e=e.nextSibling;f.viewNode===e&&(k=!0)}if(!N){let e=f.parent.viewNode.lastChild;for(;To(e,f.whitespace);)e=e.previousSibling;f.viewNode===e&&(N=!0)}}this.processTextSpacing(f.viewNode,C,k,E,P,N,x,S,v,w,y,b,f.vertical)}}}processTextSpacing(e,t,i,n,r,o,s,a,l,h,u,c,d){let p,f,g,m=e.textContent,b=e.ownerDocument;function v(){if(t)return!0;if(!s)return!1;p||(p=b.createRange(),p.selectNode(e));let i=p.getClientRects()[0];f||(f=b.createRange(),f.selectNode(s));let n=f.getClientRects(),r=n[n.length-1];return!(!i||!r)&&(d?i.top<r.top+r.height-i.width||i.left+i.width<r.left+i.width/10||i.left>r.left+r.width-i.width/10:i.left<r.left+r.width-i.height||i.top>r.top+r.height-i.height/10||i.top+i.height<r.top+i.height/10)}function w(){if(!a)return!1;p||(p=b.createRange(),p.selectNode(e));let t=p.getClientRects()[0];g||(g=b.createRange(),g.selectNode(a));let i=g.getClientRects()[0];return!(!t||!i)&&(d?t.top+t.height>i.top+t.width||t.left>i.left+i.width-t.width/10||t.left+t.width<i.left+t.width/10:t.left+t.width>i.left+t.height||t.top+t.height<i.top+t.height/10||t.top>i.top+i.height-t.height/10)}let y,x=!1,S=!1,C=!1,k=!1;if(i&&u.first&&/^[\p{Ps}\p{Pf}\p{Pi}'"\u3000]\p{M}*$/u.test(m)?(y="viv-ts-open",x=!0,S=!0):o&&u.last&&/^[\p{Pe}\p{Pf}\p{Pi}'"]\p{M}*$/u.test(m)?(y="viv-ts-close",x=!0,C=!0):(u.forceEnd||u.allowEnd)&&/^[]\p{M}*$/u.test(m)?(y="viv-ts-close",x=!0,k=!0):(h.trimStart||h.spaceFirst||h.trimAdjacent)&&/^[]\p{M}*$/u.test(m)?(y="viv-ts-open",x=!0):(h.trimEnd||h.allowEnd||h.trimAdjacent)&&(/^[]\p{M}*$/u.test(m)||"zh-hans"===c&&/^[]\p{M}*$/u.test(m)||"zh-hant"!==c&&/^[]\p{M}*$/u.test(m))&&(y="viv-ts-close",x=!0),x){let t=function(e){let t=.7*parseFloat(b.defaultView.getComputedStyle(e).fontSize);return(d?e.offsetHeight:e.offsetWidth)>t},l=function(){return d?c.offsetLeft:c.offsetTop};if("viv-ts-inner"===e.parentElement.localName)return;let c=b.createElement(y),p=b.createElement("viv-ts-inner");c.appendChild(p),e.parentNode.insertBefore(c,e),p.appendChild(e);let f=t(p);if(f||S||C||k)if("viv-ts-open"===y)if(S)c.className="viv-hang-first";else if(i||n)h.trimStart?c.className="viv-ts-trim":c.className="viv-ts-space";else if(h.trimStart||h.spaceFirst||!v()){if(h.trimAdjacent&&s&&/[\p{Ps}\p{Pi}\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]\p{M}*$/u.test(s.textContent)&&(!/[\p{Pe}\p{Pf}]\p{M}*$/u.test(s.textContent)||"viv-ts-inner"===s.parentElement.localName&&t(s.parentElement)))c.className="viv-ts-trim";else if((h.trimStart||h.spaceFirst)&&v()){let e=l();c.className="viv-ts-auto",e===l()&&!v()&&(c.className="viv-ts-trim")}}else c.className="viv-ts-space";else if("viv-ts-close"===y)if(C)c.className=f?"viv-hang-last":"viv-hang-last viv-hang-hw";else if(o||r){let e=l();k?(c.className=f?u.allowEnd&&h.allowEnd?"viv-ts-auto":"viv-hang-end":"viv-hang-end viv-hang-hw",u.allowEnd&&e===l()&&(h.trimEnd?c.className="viv-ts-trim":h.allowEnd?(c.className="viv-hang-end",e===l()&&(c.className="")):c.className="viv-ts-space")):h.trimEnd?c.className="viv-ts-trim":h.allowEnd?(c.className="viv-ts-auto",e===l()&&(c.className="")):c.className="viv-ts-space"}else if(a&&/^[\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]/u.test(a.textContent))f&&h.trimAdjacent&&(c.className="viv-ts-trim");else if(k){let e=w(),t=e&&u.allowEnd;t||(c.className=f?"viv-hang-end":"viv-hang-end viv-hang-hw"),f?t&&h.trimEnd?c.className="viv-ts-auto":t||w()?!e&&u.allowEnd&&(h.trimEnd?(c.className="viv-ts-auto",w()||(c.className="viv-hang-end")):(c.className="viv-ts-space",w()||(h.allowEnd?(c.className="viv-ts-auto",w()||(c.className="viv-hang-end")):c.className="viv-hang-end"))):c.className="":!e&&!w()&&(c.className="")}else if(h.trimEnd||h.allowEnd)if(w())h.allowEnd?c.className="viv-ts-space":c.className="viv-ts-auto";else{let e=l();c.className="viv-ts-auto",e===l()&&(c.className="")}}function E(e){var t;let i=null==(t=null==e?void 0:e.ownerDocument.defaultView)?void 0:t.getComputedStyle(e);return!!i&&("upright"===i.textOrientation||"all"===i.textCombineUpright||"horizontal"===i["-webkit-text-combine"])}function P(e,t){if(1===e.nodeType){let t=b.defaultView.getComputedStyle(e);if(parseFloat(t.marginInlineEnd)||parseFloat(t.borderInlineEndWidth)||parseFloat(t.paddingInlineEnd))return!0}let i=e.parentElement;if(i&&!i.contains(t))return P(i,t);if(1===t.nodeType){let e=b.defaultView.getComputedStyle(t);if(parseFloat(e.marginInlineStart)||parseFloat(e.borderInlineStartWidth)||parseFloat(e.paddingInlineStart))return!0}let n=t.parentElement;return!(!n||n.contains(e))&&P(e,n)}(l.ideographAlpha||l.ideographNumeric)&&(s&&/^(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]/u.test(m)&&(l.ideographAlpha&&/(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])\p{L}\p{M}*$/u.test(s.textContent)||l.ideographNumeric&&/(?![\uFF01-\uFF60])\p{Nd}\p{M}*$/u.test(s.textContent))&&!(d&&E(s.parentElement))&&!P(s,e)&&e.parentNode.insertBefore(b.createElement("viv-ts-thin-sp"),e),a&&/(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]\p{M}*$/u.test(m)&&(l.ideographAlpha&&/^(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])\p{L}/u.test(a.textContent)||l.ideographNumeric&&/^(?![\uFF01-\uFF60])\p{Nd}/u.test(a.textContent))&&(!d||!E(a.parentElement))&&!P(e,a)&&e.parentNode.insertBefore(b.createElement("viv-ts-thin-sp"),e.nextSibling))}registerHooks(){I("POLYFILLED_INHERITED_PROPS",this.getPolyfilledInheritedProps.bind(this)),I("PREPROCESS_SINGLE_DOCUMENT",this.preprocessSingleDocument.bind(this)),I("POST_LAYOUT_BLOCK",this.postLayoutBlock.bind(this),!0)}};ih.registerHooks();var nh=(new DOMParser).parseFromString('<root xmlns="http://www.pyroxy.com/ns/shadow"/>',"text/xml"),rh=["footnote-marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],oh="data-adapt-pseudo";function sh(e){return e.getAttribute(oh)||""}function ah(e,t){e.setAttribute(oh,t)}var lh=class{constructor(e,t,i,n,r){this.element=e,this.style=t,this.styler=i,this.context=n,this.exprContentListener=r,l(this,"contentProcessed",{})}getStyle(e,t){let i=sh(e);this.styler&&i&&i.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let n=da(this.style,"_pseudos")[i]||{};if(i.match(/^first-/)&&!n["x-first-pseudo"]){let e,t=1;"first-letter"==i?t=0:null!=(e=i.match(/^first-([0-9]+)-lines$/))&&(t=e[1]-0),n["x-first-pseudo"]=new ta(new qt(t),0)}return n}processContent(e,t,i){let n=sh(e);if(!this.contentProcessed[n]){this.contentProcessed[n]=!0;let i=t.content;i&&Xo(i)&&(i.visit(new qo(e,this.context,i,this.exprContentListener)),function(e){ih.preprocessForTextSpacing(e)}(e))}}};uo.isInstanceOfAfterIfContinuesLayoutConstraint;var hh=Hs.registerFragmentIndex;Hs.clearFragmentIndices;var uh=class{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){let i=t.viewNode.ownerDocument.createElement("div"),n=new vh(e,i,t),r=n.getColumn().pageBreakType;return n.getColumn().pageBreakType=null,n.layout(this.createNodePositionForPseudoElement(),!0).thenAsync((()=>{this.styler.contentProcessed["after-if-continues"]=!1,n.getColumn().pageBreakType=r;let e=i.firstChild;return oe(e,"display","block"),zn(e)}))}createNodePositionForPseudoElement(){let e=nh.createElementNS("http://www.w3.org/1999/xhtml","div");ah(e,"after-if-continues");let t=this.createShadowContext(e),i={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new Ho(i)}createShadowContext(e){return new zo(this.sourceNode,e,null,null,null,fo.ShadowType.ROOTED,this.styler)}},ch=class e{constructor(e,t,i){this.nodeContext=e,this.afterIfContinues=t,this.pseudoElementHeight=i,l(this,"flagmentLayoutConstraintType","AfterIfContinue")}allowLayout(e,t,i){return!(t&&!e||e&&e.overflow)}nextCandidate(e){return!1}postLayout(e,t,i,n){}finishBreak(e,t){return this.getRepetitiveElements().affectTo(e)?this.afterIfContinues.createElement(t,this.nodeContext).thenAsync((e=>(this.nodeContext.viewNode.appendChild(e),zn(!0)))):zn(!0)}getRepetitiveElements(){return new dh(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof e&&this.afterIfContinues==t.afterIfContinues}getPriorityOfFinishBreak(){return 9}},dh=class{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;let t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let e=t.parentNode;e;e=e.parentNode)if(e===this.nodeContext.sourceNode)return!0;return!1}};function ph(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return zn(e);let i=e.afterIfContinues;return i.createElement(t,e).thenAsync((n=>{let r=function(e,t,i){let n=e.viewNode;n.appendChild(i);let r=bs(i,t,e.vertical);return n.removeChild(i),r}(e,t,n);return t.fragmentLayoutConstraints.push(new ch(e,i,r)),zn(e)}))}function fh(e,t){return e.thenAsync((e=>ph(e,t)))}var gh=class{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every((t=>t.allowLayout(e)))}},mh=class extends Es{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,l(this,"alreadyEvaluated",!1),l(this,"breakNodeContext",null)}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!!this.breakNodeContext||t>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}},bh=class extends Go{constructor(e,t,i,n,r){super(e),this.layoutContext=t,this.clientLayout=i,this.layoutConstraint=n,this.pageFloatLayoutContext=r,l(this,"last"),l(this,"viewDocument"),l(this,"flowRootFormattingContext",null),l(this,"isFloat",!1),l(this,"isFootnote",!1),l(this,"startEdge",0),l(this,"endEdge",0),l(this,"beforeEdge",0),l(this,"afterEdge",0),l(this,"footnoteEdge",0),l(this,"box",null),l(this,"chunkPositions",null),l(this,"bands",null),l(this,"overflown",!1),l(this,"breakPositions",null),l(this,"pageBreakType",null),l(this,"forceNonfitting",!0),l(this,"leftFloatEdge",0),l(this,"rightFloatEdge",0),l(this,"bottommostFloatTop",0),l(this,"stopAtOverflow",!0),l(this,"lastAfterPosition",null),l(this,"fragmentLayoutConstraints",[]),l(this,"pseudoParent",null),l(this,"nodeContextOverflowingDueToRepetitiveElements",null),l(this,"blockDistanceToBlockEndFloats",NaN),l(this,"breakAtTheEdgeBeforeFloat",null),this.last=e.lastChild,this.viewDocument=e.ownerDocument,r.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!(!e.floatSide||this.isFloat&&!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let t=Mn("openAllViews"),i=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let n=i.length-1,r=null;return t.loop((()=>{for(;n>=0;){let t=r,o=i[n];if(r=Bo(o,t),n===i.length-1&&!r.formattingContext&&(r.formattingContext=this.flowRootFormattingContext),0==n&&(r.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;let s=this.layoutContext.setCurrent(r,0==n&&0==r.offsetInNode);if(n--,s.isPending())return s}return zn(!1)})).then((()=>{t.finish(r)})),t.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?function(e,t){return bo(e,t,1)}(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){var i,n;if(e.firstPseudo&&e.inline&&!e.after&&0==e.firstPseudo.count&&1!=e.viewNode.nodeType){let t=e.viewNode.textContent,r=t.match(H),o=r?r[0].length:0;if(!r&&3===(null==(i=e.sourceNode)?void 0:i.nodeType)&&3===(null==(n=e.sourceNode.nextSibling)?void 0:n.nodeType)&&t===e.sourceNode.textContent){let i=t+e.sourceNode.nextSibling.textContent,n=i.match(H);if(n){let t=n[0];o=t.length,e.sourceNode.textContent=t,e.viewNode.textContent=t,e.sourceNode.nextSibling.textContent=i.substr(o)}}return this.layoutContext.peelOff(e,o)}return zn(e)}buildViewToNextBlockEdge(e,t){let i=!1,n=Mn("buildViewToNextBlockEdge");return n.loopWithFrame((n=>{var r;e.viewNode&&!Ss(e)&&"http://www.w3.org/1999/xhtml"===(null==(r=e.viewNode.parentElement)?void 0:r.namespaceURI)&&t.push(e.copy()),this.maybePeelOff(e,0).then((r=>{r!==e&&(Ss(e=r)||t.push(e.copy())),this.nextInTree(e).then((t=>{(e=t)?((i||!this.layoutConstraint.allowLayout(e))&&(i=!0,(e=e.modify()).overflow=!0),this.isFloatNodeContext(e)&&(Ko(e.floatReference)||"footnote"===e.floatSide)?this.layoutFloatOrFootnote(e).then((t=>{e=t,this.pageFloatLayoutContext.isInvalidated()&&(e=null),e?n.continueLoop():n.breakLoop()})):e.inline?n.continueLoop():n.breakLoop()):n.breakLoop()}))}))})).then((()=>{n.finish(e)})),n.result()}nextInTree(e,t){return fh(this.layoutContext.nextInTree(e,t),this)}buildDeepElementView(e){if(!e.viewNode)return zn(e);let t=[],i=e.sourceNode,n=Mn("buildDeepElementView");return n.loopWithFrame((n=>{e.viewNode&&e.inline&&!Ss(e)?t.push(e.copy()):(t.length>0&&this.postLayoutBlock(e,t),t=[]),this.maybePeelOff(e,0).then((r=>{let o=r;if(o!==e){let r=o;for(;r&&r.sourceNode!=i;)r=r.parent;if(null==r)return e=o,void n.breakLoop();Ss(o)||t.push(o.copy())}this.nextInTree(o).then((t=>{(e=t)&&e.sourceNode!=i?this.layoutConstraint.allowLayout(e)?n.continueLoop():((e=e.modify()).overflow=!0,this.stopAtOverflow?n.breakLoop():n.continueLoop()):n.breakLoop()}))}))})).then((()=>{t.length>0&&this.postLayoutBlock(e,t),n.finish(e)})),n.result()}createFloat(e,t,i,n){let r=this.viewDocument.createElement("div");return this.vertical?(n>=this.height&&(n-=.1),n<1&&(n=0),oe(r,"height",`${i}px`),oe(r,"width",`${n}px`)):(i>=this.width&&(i-=.1),i<1&&(i=0),oe(r,"width",`${i}px`),oe(r,"height",`${n}px`)),oe(r,"float",t),oe(r,"clear",t),this.element.insertBefore(r,e),r}killFloats(){let e=this.element.firstChild;for(;e;){let t=e.nextSibling;if(1==e.nodeType){let t=e,i=t.style.cssFloat;if("left"!=i&&"right"!=i&&"none"!==i)break;this.element.removeChild(t)}e=t}}createFloats(){let e=this.element.firstChild,t=this.bands,i=this.vertical?this.getTopEdge():this.getLeftEdge(),n=this.vertical?this.getBottomEdge():this.getRightEdge(),r=null;for(let o of t){let t=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-i,t),o.right=this.createFloat(e,"right",n-o.x2,t),o.x1<n&&o.x2>i?r=o:r||oe(o.right,"float","none")}if(r){let e=t[t.length-1],i=this.vertical?-this.getLeftEdge():this.getBottomEdge();r!==e&&e.y2>=i&&(this.footnoteEdge=this.vertical?-r.y2:r.y2)}}calculateEdge(e,t,i,n){let r;if(e&&vs(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(r=ms(e,this.clientLayout,0,this.vertical),!isNaN(r)))return r;let o=n-(e=t[i]).boxOffset;for(;;){if(r=ms(e,this.clientLayout,o,this.vertical),!isNaN(r))return r;if(o>0)o--;else{if(--i<0)return this.beforeEdge;1!=(e=t[i]).viewNode.nodeType&&(o=e.viewNode.textContent.length)}}}parseComputedLength(e){let t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?this.clientLayout.adjustLengthValue(parseFloat(t[0])):0}getComputedMargin(e){let t=this.clientLayout.getElementComputedStyle(e),i=new mi(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.marginLeft),i.top=this.parseComputedLength(t.marginTop),i.right=this.parseComputedLength(t.marginRight),i.bottom=this.parseComputedLength(t.marginBottom)),i}getComputedPaddingBorder(e){let t=this.clientLayout.getElementComputedStyle(e),i=new mi(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),i}getComputedInsets(e){let t=this.clientLayout.getElementComputedStyle(e),i=new mi(0,0,0,0);if(t){if("border-box"==t.boxSizing)return this.getComputedMargin(e);i.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return i}setComputedInsets(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.marginLeft=this.parseComputedLength(i.marginLeft),t.borderLeft=this.parseComputedLength(i.borderLeftWidth),t.paddingLeft=this.parseComputedLength(i.paddingLeft),t.marginTop=this.parseComputedLength(i.marginTop),t.borderTop=this.parseComputedLength(i.borderTopWidth),t.paddingTop=this.parseComputedLength(i.paddingTop),t.marginRight=this.parseComputedLength(i.marginRight),t.borderRight=this.parseComputedLength(i.borderRightWidth),t.paddingRight=this.parseComputedLength(i.paddingRight),t.marginBottom=this.parseComputedLength(i.marginBottom),t.borderBottom=this.parseComputedLength(i.borderBottomWidth),t.paddingBottom=this.parseComputedLength(i.paddingBottom))}setComputedWidthAndHeight(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.width=this.parseComputedLength(i.width),t.height=this.parseComputedLength(i.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let t=Mn("layoutFloat"),i=e.viewNode,n=Zo(e.floatSide,e.vertical,e.direction);return oe(i,"float","none"),oe(i,"display","inline-block"),oe(i,"vertical-align","top"),this.buildDeepElementView(e).then((r=>{let o=this.clientLayout.getElementClientRect(i),s=this.getComputedMargin(i),a=new fi(o.left-s.left,o.top-s.top,o.right+s.right,o.bottom+s.bottom),l=this.rtl?this.endEdge:this.startEdge,h=this.rtl?this.startEdge:this.endEdge,u=e.parent;for(;u&&u.inline;)u=u.parent;if(u){let t=u.viewNode.ownerDocument.createElement("div");t.style.left="0px",t.style.top="0px",this.vertical?(t.style.bottom="0px",t.style.width="1px"):(t.style.right="0px",t.style.height="1px"),u.viewNode.appendChild(t);let r=this.clientLayout.getElementClientRect(t);l=Math.max(this.rtl?this.getEndEdge(r):this.getStartEdge(r),l),h=Math.min(this.rtl?this.getStartEdge(r):this.getEndEdge(r),h),u.viewNode.removeChild(t);let o=this.vertical?a.y2-a.y1:a.x2-a.x1;"left"==n?h=Math.max(h,l+o):l=Math.min(l,h-o),u!==e.parent&&!e.firstPseudo&&(u.viewNode.appendChild(i),i.setAttribute("data-vivliostyle-float-box-moved","true"))}let c=new fi(l,this.getBoxDir()*this.beforeEdge,h,this.getBoxDir()*this.afterEdge),d=a;this.vertical&&(d=Ii(a));let p=this.getBoxDir();if(d.y1<this.bottommostFloatTop*p){let e=d.y2-d.y1;d.y1=this.bottommostFloatTop*p,d.y2=d.y1+e}(function(e,t,i,n){let r=i.y1,o=i.x2-i.x1,s=i.y2-i.y1,a=Li(t,r);for(;;){let l=r+s;if(l>e.y2)return!1;let h=e.x1,u=e.x2;for(let e=a;e<t.length&&t[e].y1<l;e++){let i=t[e];i.x1>h&&(h=i.x1),i.x2<u&&(u=i.x2)}if(h+o<=u||a>=t.length)return"left"==n?(i.x1=h,i.x2=h+o):(i.x1=u-o,i.x2=u),i.y2+=r-i.y1,i.y1=r,!0;r=t[a].y2,a++}})(c,this.bands,d,n),this.vertical&&(a=Ri(d));let f=this.getComputedInsets(i);oe(i,"width",a.x2-a.x1-f.left-f.right+"px"),oe(i,"height",a.y2-a.y1-f.top-f.bottom+"px"),oe(i,"position","absolute"),e.display,oe(i,"display",e.display);let g,m=null;if(u&&(m=u.containingBlockForAbsolute?u:u.getContainingBlockForAbsolute()),m){let e=m.viewNode.ownerDocument.createElement("div");e.style.position="absolute",m.vertical?e.style.right="0":e.style.left="0",e.style.top="0",m.viewNode.appendChild(e),g=this.clientLayout.getElementClientRect(e),m.viewNode.removeChild(e)}else g={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(m?m.vertical:this.vertical)?oe(i,"right",g.right-a.x2+"px"):oe(i,"left",a.x1-g.left+"px"),oe(i,"top",a.y1-g.top+"px"),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let b=this.vertical?a.x1:a.y2,v=this.vertical?a.x2:a.y1;this.isOverflown(b)&&0!=this.breakPositions.length?((e=e.modify()).overflow=!0,t.finish(e)):(this.killFloats(),c=new fi(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(c=Ii(c)),function(e,t,i,n,r){for(n||(n=[new vi(i.y1,i.y2,i.x1,i.x2)]);n.length>0&&n[0].y2<=e.y1;)n.shift();if(0==n.length)return;n[0].y1<e.y1&&(n[0].y1=e.y1);let o,s=0==t.length?e.y1:t[t.length-1].y2;s<e.y2&&t.push(new vi(s,e.y2,e.x1,e.x2));let a=Li(t,n[0].y1);for(let i of n){if(a==t.length)break;for(t[a].y1<i.y1&&(o=t[a],a++,t.splice(a,0,new vi(i.y1,o.y2,o.x1,o.x2)),o.y2=i.y1);a<t.length&&(o=t[a++],o.y2>i.y2&&(t.splice(a,0,new vi(i.y2,o.y2,o.x1,o.x2)),o.y2=i.y2),i.x1!=i.x2&&("left"==r?o.x1=Math.min(i.x2,e.x2):o.x2=Math.max(i.x1,e.x1)),o.y2!=i.y2););}Ai(e,t)}(c,this.bands,d,null,n),this.createFloats(),"left"==n?this.leftFloatEdge=b:this.rightFloatEdge=b,this.bottommostFloatTop=v,this.updateMaxReachedAfterEdge(b),t.finish(r))})),t.result()}setupFloatArea(e,t,i,n,r,o){let s=this.pageFloatLayoutContext,a=s.getContainer(t),l=e.element;a.element.parentNode.appendChild(l),e.isFloat=!0,e.originX=a.originX,e.originY=a.originY,e.vertical=a.vertical,e.rtl=a.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(a.exclusions||[]).concat(),e.forceNonfitting=!s.hasFloatFragments(),e.innerShape=null;let h=a.getPaddingRect();e.setHorizontalPosition(h.x1-a.originX,h.x2-h.x1),e.setVerticalPosition(h.y1-a.originY,h.y2-h.y1),r.adjustPageFloatArea(e,a,this),e.init();let u=!!s.setFloatAreaDimensions(e,t,i,n,!0,!s.hasFloatFragments(),o);return u?(e.killFloats(),e.init()):a.element.parentNode.removeChild(l),u}createPageFloatArea(e,t,i,n,r){let o=this.element.ownerDocument.createElement("div");oe(o,"position","absolute");let s=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),a=new is(null,Yo.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),l=s.getContainer(),h=new Ch(t,o,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,a,l);return a.setContainer(h),this.setupFloatArea(h,e.floatReference,t,i,n,r)?h:null}layoutSinglePageFloatFragment(e,t,i,n,r,o,s){let a=this.pageFloatLayoutContext,l=(e=(s?s.continuations:[]).concat(e))[0].float,h=a.getPageFloatPlacementCondition(l,t,i),u=this.createPageFloatArea(l,t,o,r,h),c={floatArea:u,pageFloatFragment:null,newPosition:null};if(!u)return zn(c);let d=Mn("layoutSinglePageFloatFragment"),p=!1,f=0;return d.loopWithFrame((t=>{if(f>=e.length)return void t.breakLoop();let i=e[f],r=new Ho(i.nodePosition);u.layout(r,!0).then((e=>{c.newPosition=e,!e||n?(f++,t.continueLoop()):(p=!0,t.breakLoop())}))})).then((()=>{if(!p){let i=a.setFloatAreaDimensions(u,l.floatReference,t,o,!1,n,h);if(i){let t=r.createPageFloatFragment(e,i,u,!!c.newPosition);a.addPageFloatFragment(t,!0),c.pageFloatFragment=t}else p=!0}d.finish(c)})),d.result()}layoutPageFloatInner(e,t,i,n){let r=this.pageFloatLayoutContext,o=e.float;function s(t,i){i?r.removePageFloatFragment(i,!0):t&&t.element.parentNode.removeChild(t.element),r.restoreStashedFragments(o.floatReference),r.deferPageFloat(e)}r.stashEndFloatFragments(o);let a=Mn("layoutPageFloatInner");return this.layoutSinglePageFloatFragment([e],o.floatSide,o.clearSide,!r.hasFloatFragments(),t,i,n).then((e=>{let t=e.floatArea,i=e.pageFloatFragment,l=e.newPosition;i?this.layoutStashedPageFloats(o.floatReference,[n]).then((e=>{if(e){if(r.addPageFloatFragment(i),r.discardStashedFragments(o.floatReference),l){let e=new ts(o,l.primary);r.deferPageFloat(e)}a.finish(!0)}else s(t,i),a.finish(!1)})):(s(t,i),a.finish(!1))})),a.result()}layoutStashedPageFloats(e,t){let i=this.pageFloatLayoutContext,n=i.getStashedFloatFragments(e),r=[],o=[],s=!1,a=Mn("layoutStashedPageFloats"),l=0;return a.loopWithFrame((e=>{if(l>=n.length)return void e.breakLoop();let i=n[l];if(t.includes(i))return l++,void e.continueLoop();let a=(new rs).findByFloat(i.continuations[0].float);this.layoutSinglePageFloatFragment(i.continuations,i.floatSide,null,!1,a,null).then((t=>{let i=t.floatArea;i&&r.push(i);let n=t.pageFloatFragment;n?(o.push(n),l++,e.continueLoop()):(s=!0,e.breakLoop())}))})).then((()=>{s?(o.forEach((e=>{i.removePageFloatFragment(e,!0)})),r.forEach((e=>{let t=e.element;t&&t.parentNode&&t.parentNode.removeChild(t)}))):n.forEach((e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)})),a.finish(!s)})),a.result()}setFloatAnchorViewNode(e){let t=e.viewNode.parentNode,i=t.ownerDocument.createElement("span");i.setAttribute(Eo,"1"),"footnote"===e.floatSide&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",i),t.appendChild(i),t.removeChild(e.viewNode);let n=e.modify();return n.after=!0,n.viewNode=i,n}resolveFloatReferenceFromColumnSpan(e,t,i){let n=Mn("resolveFloatReferenceFromColumnSpan"),r=this.pageFloatLayoutContext,o=r.getPageFloatLayoutContext(Yo.REGION);return r.getContainer().width<o.getContainer().width&&e===Yo.COLUMN?t===oi.auto?this.buildDeepElementView(i.copy()).then((t=>{let i=t.viewNode,r=Xr(this.clientLayout,i,["min-content inline size"])["min-content inline size"],o=this.getComputedMargin(i);this.vertical?r+=o.top+o.bottom:r+=o.left+o.right,r>this.width?n.finish(Yo.REGION):n.finish(e)})):t===oi.all?n.finish(Yo.REGION):n.finish(e):n.finish(e),n.result()}layoutPageFloat(e){let t,i=this.pageFloatLayoutContext,n=(new rs).findByNodeContext(e),r=i.findPageFloatByNodePosition(e.toNodePosition());return t=r?zn(r):n.createPageFloat(e,i,this),t.thenAsync((t=>{let r=Fo(e,0),o=this.setFloatAnchorViewNode(e),s=n.findPageFloatFragment(t,i),a=new ts(t,r);if(s&&s.hasFloat(t))return i.registerPageFloatAnchor(t,o.viewNode),zn(o);if(i.isForbidden(t)||i.hasPrecedingFloatsDeferredToNext(t))return i.deferPageFloat(a),i.registerPageFloatAnchor(t,o.viewNode),zn(o);if(this.nodeContextOverflowingDueToRepetitiveElements)return zn(null);{let e=ms(o,this.clientLayout,0,this.vertical);return this.isOverflown(e)?zn(o):this.layoutPageFloatInner(a,n,e,s).thenAsync((e=>e?zn(null):(i.registerPageFloatAnchor(t,o.viewNode),zn(o))))}}))}processLineStyling(e,t,i){let n=Mn("processLineStyling"),r=i.concat([]);i.splice(0,i.length);let o=0,s=e.firstPseudo;return 0==s.count&&(s=s.outer),n.loopWithFrame((i=>{if(!s)return void i.breakLoop();let n=this.findLinePositions(r),a=s.count-o;if(n.length<=a)return void i.breakLoop();let l=this.findAcceptableBreakInside(r,n[a-1],!0);null!=l?this.finishBreak(l,!1,!1).then((()=>{o+=a,this.layoutContext.peelOff(l,0).then((n=>{s=(e=n).firstPseudo,r=[],this.buildViewToNextBlockEdge(e,r).then((e=>{t=e,i.continueLoop()}))}))})):i.breakLoop()})).then((()=>{Array.prototype.push.apply(i,r),n.finish(t)})),n.result()}isLoneImage(e){return!(2!=e.length&&this.breakPositions.length>0)&&(e[0].sourceNode==e[1].sourceNode&&Se[e[0].sourceNode.localName])}getTrailingMarginEdgeAdjustment(e){let t=0,i=0;for(let n=e.length-1;n>=0;n--){let r=e[n];if(!r.after||!r.viewNode||1!=r.viewNode.nodeType)break;let o=this.getComputedMargin(r.viewNode),s=this.vertical?-o.left:o.bottom;s>0?t=Math.max(t,s):i=Math.min(i,s)}return t+i}layoutBreakableBlock(e){let t=Mn("layoutBreakableBlock"),i=[];return this.buildViewToNextBlockEdge(e,i).then((n=>{let r=i.length-1;if(r<0)return void t.finish(n);this.postLayoutBlock(n,i);let o,s=this.calculateEdge(n,i,r,i[r].boxOffset),a=!1;if(!n||!vs(n.viewNode)){let e=Ps(n,this.collectElementsOffset());a=this.isOverflown(s+(this.vertical?-1:1)*e.minimum),this.isOverflown(s+(this.vertical?-1:1)*e.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=n)}null==n&&(s+=this.getTrailingMarginEdgeAdjustment(i)),this.updateMaxReachedAfterEdge(s),o=e.firstPseudo?this.processLineStyling(e,n,i):zn(n),o.then((e=>{i.length>0&&(this.saveBoxBreakPosition(i),a&&!this.isLoneImage(i)&&e&&((e=e.modify()).overflow=!0)),t.finish(e)}))})),t.result()}postLayoutBlock(e,t){_("POST_LAYOUT_BLOCK").forEach((i=>{i(e,t,this)}))}findEndOfLine(e,t,i){let n,r=this.vertical?e-1:e+1,o=0,s=t[0].boxOffset,a=o,l=t.length-1,h=t[l].boxOffset;for(;s<h;){n=s+Math.ceil((h-s)/2),a=o;let e=l;for(;a<e;){let i=a+Math.ceil((e-a)/2);t[i].boxOffset>n?e=i-1:a=i}let u=this.calculateEdge(null,t,a,n);if(this.vertical?u<=r:u>=r){for(h=n-1;t[a].boxOffset==n;)a--;l=a}else i&&this.updateMaxReachedAfterEdge(u),s=n,o=a}return{nodeContext:t[a],index:s,checkPointIndex:a}}findAcceptableBreakInside(e,t,i){var n,r,o;let s=this.findEndOfLine(t,e,!0),a=s.nodeContext;if(0===s.checkPointIndex&&s.index===a.boxOffset)return null;let l=a.viewNode;if(1!=l.nodeType&&"viv-ts-inner"!==(null==(n=l.parentElement)?void 0:n.localName)){let t=l;a=this.resolveTextNodeBreaker(a).breakTextNode(t,a,s.index,e,s.checkPointIndex,i)}else{let e=ks(a);if(e){if((null==(r=this.breakPositions)?void 0:r[0])instanceof mh&&null!=e&&e.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode))return null;for(a=e;!a.after&&a.inline&&a.parent;){let e=null==(o=a.viewNode)?void 0:o.previousSibling;for(;e&&(To(e,a.parent.whitespace)||xs(e));)e=e.previousSibling;if(e)break;a=a.parent}}}return this.clearOverflownViewNodes(a,!1),a}resolveTextNodeBreaker(e){return _("RESOLVE_TEXT_NODE_BREAKER").reduce(((t,i)=>i(e)||t),wh.instance)}getRangeBoxes(e,t){let i=[],n=e.ownerDocument.createRange(),r=!1,o=e,s=null,a=!1,l=!0;for(;l;){let e=!0;do{let i=null;o==t&&(l=1===t.nodeType&&!(!t.firstChild||r));let h=1===o.nodeType?o:null;h?r?r=!1:ys(h)?e=!a:!h.firstChild||Se[h.localName]||/^r(uby|[bt]c?)$/.test(h.localName)||Cs(this.clientLayout.getElementComputedStyle(h).display)?(e=!a,e?("ruby"===h.localName&&o.firstChild&&(o=o.firstChild),n.setStartBefore(o),a=!0,s=o):/^r(uby|tc?)$/.test(h.localName)||(s=o),o.contains(t)&&(l=!1)):i=o.firstChild:(a||(null==o.parentNode?l=!1:(n.setStartBefore(o),a=!0)),s=o),i||(i=o.nextSibling,i||(r=!0,i=o.parentNode)),o=i}while(e&&l);if(a){n.setEndAfter(s);let e=this.clientLayout.getRangeClientRects(n);for(let t=0;t<e.length;t++)i.push(e[t]);a=!1}}return i}findLinePositions(e){let t=[],i=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);i.sort(this.vertical?Ao:_o);let n=0,r=0,o=0,s=0,a=0,l=this.getBoxDir();for(;;){if(a<i.length){let e=i[a],t=1;if(s>0){let i=Math.max(this.getBoxSize(e),1);t=l*this.getBeforeEdge(e)<l*n?l*(this.getAfterEdge(e)-n)/i:l*this.getAfterEdge(e)>l*r?l*(r-this.getBeforeEdge(e))/i:1}if(0==s||t>=.6||t>=.2&&this.getStartEdge(e)>=o-1){o=this.getEndEdge(e),this.vertical?(n=0==s?e.right:Math.max(n,e.right),r=0==s?e.left:Math.min(r,e.left)):(n=0==s?e.top:Math.min(n,e.top),r=0==s?e.bottom:Math.max(r,e.bottom)),s++,a++;continue}}if(s>0&&(t.push(r),s=0),a>=i.length)break}return t.sort(ve),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;for(let i=e;i;i=i.parent)if(!i.inline&&Yr(i.viewNode)){let e=this.getComputedPaddingBorder(i.viewNode);t+=i.vertical?-e.left:e.bottom,"table"===i.display&&(t+=(i.vertical?-1:1)*i.blockBorderSpacing)}return t}getOffsetByRepetitiveElements(e){let t;return t=e?e.calculateOffset(this):Ps(null,this.collectElementsOffset()),t.current}findBoxBreakPosition(e,t){let i=this.element.parentNode,n=this.element.nextSibling;i.removeChild(this.element),i.insertBefore(this.element,n);let r,o,s=e.checkPoints,a=s[0];for(;a.parent&&a.inline;)a=a.parent;t?(r=1,o=1):(r=Math.max((a.inheritedProps.widows||2)-0,1),o=Math.max((a.inheritedProps.orphans||2)-0,1));let l=this.calculateClonedPaddingBorder(a),h=this.findLinePositions(s),u=this.footnoteEdge-l,c=this.getBoxDir(),d=this.getOffsetByRepetitiveElements(e);u-=c*d;let p=this.findFirstOverflowingEdgeAndCheckPoint(s);isNaN(p.edge)&&(p.edge=c*(1/0));let f=be(h.length,(e=>{let t=h[e];return this.vertical?t<u||t<=p.edge:t>u||t>=p.edge})),g=f<=0;g&&(f=be(h.length,(e=>this.vertical?h[e]<u:h[e]>u)));let m,b=s[s.length-1].viewNode;if("viv-ts-inner"===(null==b?void 0:b.parentElement.localName)&&(b=b.parentElement.parentElement),(f===h.length&&b.nextSibling||f>=h.length-1&&b.parentElement.querySelector(".MJXc-display"))&&(r=0),f=Math.min(h.length-r,f),f<o)return null;if(u=h[f-1],m=g?p.checkPoint:this.findAcceptableBreakInside(e.checkPoints,u,t),m){let e=this.getAfterEdgeOfBlockContainer(m);!isNaN(e)&&c*(u-e)>0&&(u=e),this.computedBlockSize=c*(u-this.beforeEdge)+d}return m}getAfterEdgeOfBlockContainer(e){let t=e;do{t=t.parent}while(t&&t.inline);return t?(t=t.copy().modify(),t.after=!0,ms(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let t=e.findIndex((e=>e.overflow));if(t<0)return{edge:NaN,checkPoint:null};let i=e[t];return{edge:this.calculateEdge(null,e,t,i.boxOffset),checkPoint:i}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,i){e.formattingContext;let n=(new Ts).find(e.formattingContext).finishBreak(this,e,t,i);return n||(n=_s.finishBreak(this,e,t,i)),n}findAcceptableBreakPosition(){let e=null,t=null,i=0,n=0;do{i=n,n=Number.MAX_VALUE;for(let r=this.breakPositions.length-1;r>=0&&!t;--r){e=this.breakPositions[r],t=e.findAcceptableBreak(this,i);let o=e.getMinBreakPenalty();o>i&&(n=Math.min(n,o))}}while(n>i&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,i,n){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return zn(e);let r=Mn("doFinishBreak"),o=!1;if(!e){if(this.forceNonfitting)return P.warn("Could not find any page breaks?!!"),this.skipTailEdges(t).then((e=>{e?((e=e.modify()).overflow=!1,this.finishBreak(e,o,!0).then((()=>{r.finish(e)}))):r.finish(e)})),r.result();e=i,o=!0,this.computedBlockSize=n}return this.finishBreak(e,o,!0).then((()=>{r.finish(e)})),r.result()}isBreakable(e){for(let t=e;t;t=t.parent)if(xs(t.viewNode))return!1;return!!e.after||"http://www.w3.org/2000/svg"!==e.sourceNode.namespaceURI&&!e.flexContainer}zeroIndent(e){let t=e.toString();return""==t||"auto"==t||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e)return!1;for(let t=e;t;t=t.parent)if(xs(t.viewNode))return!1;if(vs(e.viewNode))return!1;let i=ms(e,this.clientLayout,0,this.vertical),n=Ps(e,this.collectElementsOffset()),r=this.isOverflown(i+(this.vertical?-1:1)*n.minimum);if(this.isOverflown(i+(this.vertical?-1:1)*n.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){let e=i+this.getTrailingMarginEdgeAdjustment(t),r=this.footnoteEdge-this.getBoxDir()*n.current;i=this.vertical?Math.min(i,Math.max(e,r)):Math.max(i,Math.min(e,r))}return this.updateMaxReachedAfterEdge(i),r}checkOverflowAndSaveEdgeAndBreakPosition(e,t,i,n){if(!e||vs(e.viewNode))return!1;let r=this.checkOverflowAndSaveEdge(e,t);return(i||!r)&&this.saveEdgeBreakPosition(e,n,r),r}applyClearance(e){if(!e.viewNode.parentNode)return!1;let t=this.getComputedMargin(e.viewNode),i=e.viewNode.ownerDocument.createElement("div");this.vertical?(i.style.bottom="0px",i.style.width="1px",i.style.marginRight=`${t.right}px`):(i.style.right="0px",i.style.height="1px",i.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(i,e.viewNode);let n=this.clientLayout.getElementClientRect(i),r=this.getBeforeEdge(n),o=this.getBoxDir(),s=e.clearSide,a=-this.getBoxDir()*(1/0);switch("all"===s&&(a=this.pageFloatLayoutContext.getPageFloatClearEdge(s,this)),/^(top|bottom|(block|inline)-(start|end))$/.test(s)?Zo(s,e.vertical,e.direction):s){case"left":a=o*Math.max(a*o,this.leftFloatEdge*o);break;case"right":a=o*Math.max(a*o,this.rightFloatEdge*o);break;default:a=o*Math.max(a*o,Math.max(this.rightFloatEdge*o,this.leftFloatEdge*o))}if(r*o>=a*o)return e.viewNode.parentNode.removeChild(i),!1;{let s=Math.max(1,(a-r)*o);this.vertical?i.style.width=`${s}px`:i.style.height=`${s}px`,n=this.clientLayout.getElementClientRect(i);let l=this.getAfterEdge(n);if(!e.floatSide)if(this.vertical){let e=l+t.right-a;e>0==t.right>=0&&(e+=t.right),i.style.marginLeft=`${e}px`}else{let e=a-(l+t.top);e>0==t.top>=0&&(e+=t.top),i.style.marginBottom=`${e}px`}return e.clearSpacer=i,!0}}isBFC(e){return!(!As(e)&&!co.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,t,i){var n;let r=e.after?null==(n=e.parent)?void 0:n.formattingContext:e.formattingContext;if(r&&!this.isBFC(r))return zn(e);let o=Mn("skipEdges"),s=!i&&t&&e&&e.after,a=i,l=null,h=[],u=[],c=!1;function d(){return!!i||!t&&to(a)&&!function(){var t;if(!l||e.floatSide)return!1;for(let e=l;null!=e&&e.parent;e=e.parent){let i=e.after?e.viewNode:null==(t=e.viewNode)?void 0:t.previousSibling;for(;i&&(To(i,e.parent.whitespace)||xs(i));)i=i.previousSibling;if(i)return!1}return!0}()}let p=()=>{(e=h[0]||e).viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=a};return o.loopWithFrame((i=>{for(var n;e;){e.formattingContext;let r=(new Ts).find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(To(e.viewNode,e.whitespace))break;if(!e.after)return d()?p():this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)?(e=(this.stopAtOverflow&&l||e).modify()).overflow=!0:(e=e.modify()).breakBefore=a,void i.breakLoop()}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=oo(a)?a:null),r&&r.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&t&&0===this.breakPositions.length&&this.saveEdgeBreakPosition(e.copy(),a,!1),!e.inline&&!e.repeatOnBreak&&(l?ks(l):this.breakPositions[this.breakPositions.length-1]instanceof mh)&&this.saveEdgeBreakPosition(e.copy(),a,!1),!this.isBFC(e.formattingContext)||co.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&To(e.sourceNode.firstChild,e.whitespace))return h.push(e.copy()),a=so(a,e.breakBefore),d()?p():(this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)||!this.layoutConstraint.allowLayout(e))&&((e=(this.stopAtOverflow&&l||e).modify()).overflow=!0),void i.breakLoop()}if(1!=e.viewNode.nodeType)break;let o=e.viewNode.style;if(e.after){e.floatSide&&(a=null!=a?a:this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let n=e.sourceNode;if("svg"===n.localName||"math"===n.localName||"true"===n.getAttribute("data-math-typeset")){c=!1,l=e.copy(),u.push(l),a=so(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!this.stopAtOverflow,a);break}if(e.inline||r&&r.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(c){if(d())return p(),void i.breakLoop();h=[],t=!1,s=!1,a=null}c=!1,l=e.copy(),u.push(l),a=so(a,e.breakAfter),o&&(!this.zeroIndent(o.paddingBottom)||!this.zeroIndent(o.borderBottomWidth))&&(u=[l])}else{if(h.push(e.copy()),a=so(a,e.breakBefore),(e.pageType!=(null==(n=e.parent)?void 0:n.pageType)||!to(a))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!this.stopAtOverflow,a),(e=e.modify()).overflow=!0,this.stopAtOverflow))return void i.breakLoop();let t=e.viewNode.localName;if(Se[t])return d()?p():this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)&&((e=(this.stopAtOverflow&&l||e).modify()).overflow=!0),void i.breakLoop();o&&!(this.zeroIndent(o.paddingTop)&&this.zeroIndent(o.borderTopWidth))&&(s=!1,u=[]),c=!0}}while(0);let o=this.nextInTree(e,s);if(o.isPending())return void o.then((t=>{e=t,i.continueLoop()}));e=o.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(l,u,!this.stopAtOverflow,a)?l&&this.stopAtOverflow&&((e=l.modify()).overflow=!0):to(a)&&(this.pageBreakType=a),i.breakLoop()})).then((()=>{l&&(this.lastAfterPosition=l.toNodePosition()),o.finish(e)})),o.result()}skipTailEdges(e){let t=e.copy(),i=Mn("skipEdges"),n=null,r=!1;return i.loopWithFrame((i=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(To(e.viewNode,e.whitespace))break;if(!e.after)return to(n)&&(this.pageBreakType=n),void i.breakLoop()}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer))return n=so(n,e.breakBefore),to(n)&&(this.pageBreakType=n),void i.breakLoop();if(1!=e.viewNode.nodeType)break;let t=e.viewNode.style;if(e.after){if(r){if(to(n))return this.pageBreakType=n,void i.breakLoop();n=null}r=!1,n=so(n,e.breakAfter)}else{n=so(n,e.breakBefore);let r=e.viewNode.localName;if(Se[r])return to(n)&&(this.pageBreakType=n),void i.breakLoop();if(t&&(!this.zeroIndent(t.paddingTop)||!this.zeroIndent(t.borderTopWidth)))return void i.breakLoop()}r=!0}while(0);let t=this.layoutContext.nextInTree(e);if(t.isPending())return void t.then((t=>{e=t,i.continueLoop()}));e=t.get()}t=null,i.breakLoop()})).then((()=>{i.finish(t)})),i.result()}layoutFloatOrFootnote(e){return Ko(e.floatReference)||"footnote"===e.floatSide?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,i){let n=Mn("layoutNext");return this.skipEdges(e,t,i||null).then((i=>{if(!(e=i)||this.pageBreakType||this.stopByOverflow(e))n.finish(e);else{let i=e.formattingContext;(new Ts).find(i).layout(e,this,t).thenFinish(n)}})),n.result()}clearOverflownViewNodes(e,t){if(e)for(let i=e.parent;e;e=i,i=i?i.parent:null){let n=(i||e).formattingContext;(new Ts).find(n).clearOverflownViewNodes(this,i,e,t),t=!1}}initGeom(){let e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let i=this.originX+this.left+this.getInsetLeft(),n=this.originY+this.top+this.getInsetTop();this.box=new fi(i,n,i+this.width,n+this.height),this.startEdge=t?this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left:0,this.endEdge=t?this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=function(e,t,i,n,r,o){o&&(e=Ii(e),t=t.map((e=>_i(e))),i=i.map((e=>_i(e))));let s,a,l,h=t.length,u=i?i.length:0,c=[],d=[];for(s=0;s<h;s++)t[s].addSegments(d,s);for(s=0;s<u;s++)i[s].addSegments(d,s+h);let p=d.length;d.sort(wi);let f=0;for(;d[f].shapeId>=h;)f++;let g=d[f].low.y;g>e.y1&&c.push(new vi(e.y1,g,e.x2,e.x2));let m=0,b=[];for(;m<p&&(l=d[m]).low.y<g;)l.high.y>g&&b.push(l),m++;for(;m<p||b.length>0;){let t=e.y2,i=Math.min(Ni(Math.ceil(g+n),r),e.y2);for(a=0;a<b.length&&t>i;a++)l=b[a],l.low.x==l.high.x?l.high.y<t&&(t=Math.max(Ti(l.high.y,r),i)):l.low.x!=l.high.x&&(t=i);for(t>e.y2&&(t=e.y2);m<p&&(l=d[m]).low.y<t;)if(l.high.y<g)m++;else{if(!(l.low.y<i)){let e=Ti(l.low.y,r);e<t&&(t=e);break}l.low.y==l.high.y&&l.low.y==g||(b.push(l),t=i),m++}let o=[];for(a=0;a<b.length;a++)Ei(o,b[a],g,t);o.sort(((e,t)=>e.x-t.x||e.lowOrHigh-t.lowOrHigh));let s=Pi(o,h,u);if(0==s.length)c.push(new vi(g,t,e.x2,e.x2));else{let i=0,n=e.x1;for(a=0;a<s.length;a+=2){let t=Math.max(e.x1,s[a]),r=Math.min(e.x2,s[a+1])-t;r>i&&(i=r,n=t)}0==i?c.push(new vi(g,t,e.x2,e.x2)):c.push(new vi(g,t,Math.max(n,e.x1),Math.min(n+i,e.x2)))}if(t==e.y2)break;for(g=t,a=b.length-1;a>=0;a--)b[a].high.y<=t&&b.splice(a,1)}return Ai(e,c),c}(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],oe(this.element,"width",`${this.width}px`),oe(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,i){e.formattingContext;let n=e.copy(),r=(new Ts).find(e.formattingContext),o=this.calculateClonedPaddingBorder(n),s=r.createEdgeBreakPosition(n,t,i,this.computedBlockSize+o);this.breakPositions.push(s)}saveBoxBreakPosition(e){let t=e[0].breakPenalty;if(t){let i=e[0];for(;i.parent&&i.inline;)i=i.parent;t=i.breakPenalty}let i=new mh(e,t);this.breakPositions.push(i)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,i){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return zn(e);if(this.isFullWithPageFloats())return e.primary.after&&1===e.primary.steps.length?zn(null):zn(e);let n=Mn("layout");return this.openAllViews(e.primary).then((e=>{let r=null;if(e.viewNode)r=e.copy();else{let e=t=>{t.nodeContext.viewNode&&(r=t.nodeContext,this.layoutContext.removeEventListener("nextInTree",e))};this.layoutContext.addEventListener("nextInTree",e)}let o=new xh(t,i);o.layout(e,this).then((e=>{this.doFinishBreak(e,o.context.overflownNodeContext,r,o.initialComputedBlockSize).then((e=>{let t=null;t=this.pseudoParent?zn(null):this.doFinishBreakOfFragmentLayoutConstraints(e),t.then((()=>{if(this.pageFloatLayoutContext.isInvalidated())n.finish(null);else if(e){this.overflown=!0;let t=new Ho(e.toNodePosition());n.finish(t)}else n.finish(null)}))}))}))})),n.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let t=Mn("doFinishBreakOfFragmentLayoutConstraints"),i=[].concat(this.fragmentLayoutConstraints);i.sort(((e,t)=>e.getPriorityOfFinishBreak()-t.getPriorityOfFinishBreak()));let n=0;return t.loop((()=>n<i.length?i[n++].finishBreak(e,this).thenReturn(!0):zn(!1))).then((()=>{t.finish(!0)})),t.result()}doLayout(e,t,i){let n=Mn("doLayout"),r=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,n.loopWithFrame((n=>{for(;e;){let o=!0;if(this.layoutNext(e,t,i||null).then((s=>{if(t=!1,i=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,(e=this.nodeContextOverflowingDueToRepetitiveElements).overflow=!0):e=s,this.pageFloatLayoutContext.isInvalidated())n.breakLoop();else if(this.pageBreakType)n.breakLoop();else if(e&&this.stopByOverflow(e)){r=e;let t=this.findAcceptableBreakPosition();e=t.nodeContext,t.breakPosition&&t.breakPosition.breakPositionChosen(this),n.breakLoop()}else o?o=!1:n.continueLoop()})),o)return void(o=!1)}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),n.breakLoop()})).then((()=>{n.finish({nodeContext:e,overflownNodeContext:r})})),n.result()}redoLayout(){let e=this.chunkPositions,t=this.element.lastChild;for(;t!=this.last;){let e=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=e}this.killFloats(),this.init();let i=Mn("redoLayout"),n=0,r=null,o=!0;return i.loopWithFrame((t=>{if(n<e.length){let i=e[n++];this.layout(i,o).then((e=>{o=!1,e?(r=e,t.breakLoop()):t.continueLoop()}))}else t.breakLoop()})).then((()=>{i.finish(r)})),i.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach((t=>{if(co.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(t)){let i=t.getRepetitiveElements();e.push(i)}if(uo.isInstanceOfAfterIfContinuesLayoutConstraint(t)){let i=t.getRepetitiveElements();e.push(i)}po.isInstanceOfTableRowLayoutConstraint(t)&&t.getElementsOffsetsForTableCell(this).forEach((t=>{e.push(t)}))}));return e}},vh=class{constructor(e,t,i){l(this,"startNodeContexts",[]),l(this,"column"),this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=i.formattingContext,this.column.pseudoParent=e;let n=this.column.calculateClonedPaddingBorder(i);this.column.footnoteEdge=this.column.footnoteEdge-n;let r=this;this.column.openAllViews=function(e){return bh.prototype.openAllViews.call(this,e).thenAsync((e=>(r.startNodeContexts.push(e.copy()),zn(e))))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){let t=this.column.findAcceptableBreakPosition();if(e){let e=this.startNodeContexts[0].copy(),i=new Ns(e,null,e.overflow,0);if(i.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:i,nodeContext:e}}return t}finishBreak(e,t,i){return this.column.finishBreak(e,t,i)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){let t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return Oo(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},wh=class{breakTextNode(e,t,i,n,r,o){if(t.after)t.offsetInNode=e.length;else{let n=i-t.boxOffset,r=e.data;n=173==r.charCodeAt(n)?this.breakAfterSoftHyphen(e,r,n,t):this.breakAfterOtherCharacter(e,r,n,t),n>0&&(t=this.updateNodeContext(t,n,e))}return t}breakAfterSoftHyphen(e,t,i,n){let r=/[\u0620\u0626\u0628\u062A-\u062E\u0633-\u0647\u0649\u064A\u066E\u066F\u0678-\u0687\u069A-\u06BF\u06C1\u06C2\u06CC\u06CE\u06D0\u06D1\u06FA-\u06FC\u06FF\u0712-\u0714\u071A-\u071D\u071F-\u0727\u0729\u072B\u072D\u072E\u074E-\u0758\u075C-\u076A\u076D-\u0770\u0772\u0775-\u0777\u077A-\u077F\u07CA-\u07EA\u07FA\u0841-\u0845\u0848\u084A-\u0853\u0855\u0860\u0862-\u0865\u0868\u0883-\u0886\u0889-\u088D\u08A0-\u08A9\u08AF\u08B0\u08B3-\u08B8\u08BA-\u08C8\u1807\u180A\u1820-\u1878\u1887-\u18A8\u18AA\u200D\uA840-\uA871\u{10AC0}-\u{10AC4}\u{10AD3}-\u{10AD6}\u{10AD8}-\u{10ADC}\u{10ADE}-\u{10AE0}\u{10AEB}-\u{10AEE}\u{10B80}\u{10B82}\u{10B86}-\u{10B88}\u{10B8A}\u{10B8B}\u{10B8D}\u{10B90}\u{10BAD}\u{10BAE}\u{10D01}-\u{10D21}\u{10D23}\u{10EC3}\u{10EC4}\u{10F30}-\u{10F32}\u{10F34}-\u{10F44}\u{10F51}-\u{10F53}\u{10F70}-\u{10F73}\u{10F76}-\u{10F81}\u{10FB0}\u{10FB2}\u{10FB3}\u{10FB8}\u{10FBB}\u{10FBC}\u{10FBE}\u{10FBF}\u{10FC1}\u{10FC4}\u{10FCA}\u{1E900}-\u{1E943}]\p{Mn}*$/u.test(t.slice(0,i))?"":"";if(e.replaceData(i,t.length-i,n.breakWord?"":r+yh(n)),r){let e=n.preprocessedTextContent[0][1];n.preprocessedTextContent[0][1]=e.slice(0,i+1)+r+e.slice(i+1)}return i+1}breakAfterOtherCharacter(e,t,i,n){let r=t.charAt(i);i++;let o=t.charAt(i);return e.replaceData(i,t.length-i,!n.breakWord&&pe(r)&&pe(o)?yh(n):""),i}updateNodeContext(e,t,i){return(e=e.modify()).offsetInNode+=t,e.breakBefore=null,e}};function yh(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}l(wh,"instance"),wh.instance=new wh;var xh=class extends Ls{constructor(e,t){super(),this.leadingEdge=e,l(this,"breakAfter"),l(this,"initialPageBreakType",null),l(this,"initialComputedBlockSize",0),l(this,"initialOverflown",!1),l(this,"context",{overflownNodeContext:null}),this.breakAfter=t||null}resolveLayoutMode(e){return new Sh(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||(Ms=[])}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){let e=t.viewNode;e&&ws(e.parentNode,e),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}},Sh=class{constructor(e,t,i){this.leadingEdge=e,this.breakAfter=t,this.context=i}doLayout(e,t){let i=Mn("DefaultLayoutMode.doLayout");return function(e,t){let i=Mn("processAfterIfContinuesOfAncestors"),n=e;return i.loop((()=>{if(null!==n){let e=ph(n,t);return n=n.parent,e.thenReturn(!0)}return zn(!1)})).then((()=>{i.finish(!0)})),i.result()}(e,t).then((()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then((e=>{this.context.overflownNodeContext=e.overflownNodeContext,i.finish(e.nodeContext)}))})),i.result()}accept(e,t){return!!(t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||t.fragmentLayoutConstraints.length<=0)||t.fragmentLayoutConstraints.every((i=>i.allowLayout(e,this.context.overflownNodeContext,t)))}postLayout(e,t,i,n){return n||(n=!i.fragmentLayoutConstraints.some((t=>t.nextCandidate(e)))),i.fragmentLayoutConstraints.forEach((r=>{r.postLayout(n,e,t,i)})),n}},Ch=class extends bh{constructor(e,t,i,n,r,o,s){super(t,i,n,r,o),this.floatSide=e,this.parentContainer=s,l(this,"rootViewNodes",[]),l(this,"floatMargins",[]),l(this,"adjustContentRelativeSize",!0)}openAllViews(e){return super.openAllViews(e).thenAsync((e=>(e&&this.fixFloatSizeAndPosition(e),zn(e))))}convertPercentageSizesToPx(e){let t=this.parentContainer.getPaddingRect(),i=t.x2-t.x1,n=t.y2-t.y1;function r(t,i){t.forEach((t=>{let n=se(e,t);if(n&&"%"===n.charAt(n.length-1)){let r=parseFloat(n);oe(e,t,`${i*r/100}px`)}}))}r(["width","max-width","min-width"],i),r(["height","max-height","min-height"],n),r(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?n:i),["margin-top","margin-right","margin-bottom","margin-left"].forEach((t=>{"auto"===se(e,t)&&oe(e,t,"0")}))}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){let e=this.floatSide;if(this.parentContainer.vertical){if("block-end"===e||"left"===e){let e=se(t,"height");""!==e&&"auto"!==e&&oe(t,"margin-top","auto")}}else if("block-end"===e||"bottom"===e){let e=se(t,"width");""!==e&&"auto"!==e&&oe(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map(((e,t)=>{let i=this.clientLayout.getElementClientRect(e),n=this.floatMargins[t];return this.vertical?n.top+i.height+n.bottom:n.left+i.width+n.right})))}},kh=class{constructor(e,t){this.parent=e,this.rootSourceNode=t,l(this,"formattingContextType","RepetitiveElementsOwner"),l(this,"isRoot",!1),l(this,"repetitiveElements",null)}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){let t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do{if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e}while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||Ms.some((e=>e.root===this.rootSourceNode&&(this.repetitiveElements=e.elements,!0)))||(this.repetitiveElements=new Eh(e,this.rootSourceNode),Ms.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}},Eh=class{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,l(this,"headerSourceNode",null),l(this,"footerSourceNode",null),l(this,"headerViewNode",null),l(this,"footerViewNode",null),l(this,"headerNodePosition",null),l(this,"footerNodePosition",null),l(this,"headerHeight",0),l(this,"footerHeight",0),l(this,"isSkipHeader",!1),l(this,"isSkipFooter",!1),l(this,"enableSkippingFooter",!0),l(this,"enableSkippingHeader",!0),l(this,"doneInitialLayout",!1),l(this,"firstContentSourceNode",null),l(this,"lastContentSourceNode",null),l(this,"affectedNodeCache",[]),l(this,"afterLastContentNodeCache",[]),l(this,"allowInsert",!1),l(this,"allowInsertRepeatitiveElements")}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=Fo(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=Fo(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=bs(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=bs(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,i){return!this.headerNodePosition||this.isSkipHeader?zn(!0):this.appendElementToFragment(this.headerNodePosition,e,t,i)}appendFooterToFragment(e,t,i){return!this.footerNodePosition||this.isSkipFooter?zn(!0):this.appendElementToFragment(this.footerNodePosition,e,t,i)}appendElementToFragment(e,t,i,n){let r=t.viewNode.ownerDocument,o=t.viewNode,s=r.createElement("div");o.appendChild(s);let a=new vh(n,s,t),l=a.getColumn().pageBreakType;return a.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,a.layout(new Ho(e),!0).thenAsync((()=>(this.allowInsertRepeatitiveElements=!1,o.removeChild(s),this.moveChildren(s,o,i),a.getColumn().pageBreakType=l,zn(!0))))}moveChildren(e,t,i){if(t)for(;e.firstChild;){let n=e.firstChild;e.removeChild(n),n.setAttribute(Eo,"1"),i?t.insertBefore(n,i):t.appendChild(n)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)||((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight)),t}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)||(!this.enableSkippingFooter&&e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight)),t}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,(t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1)))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,(t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0)))}findResultFromCache(e,t,i){let n=t.filter((t=>t.nodeContext.sourceNode===e.sourceNode&&t.nodeContext.after===e.after));if(n.length>0)return n[0].result;{let n=i(e);return t.push({nodeContext:e,result:n}),n}}isAfterNodeContextOf(e,t,i){let n=[];for(let i=e;i;i=i.parentNode){if(t.sourceNode===i)return t.after;n.push(i)}for(let e=t.sourceNode;e;e=e.parentNode){let t=n.indexOf(e);if(t>=0)return!!i&&0===t;for(let t=e;t;t=t.previousElementSibling)if(n.includes(t))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}},Ph=class{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,i,n){let r=this.formattingContext.getRepetitiveElements();return r&&(i.clientLayout,r.doneInitialLayout||(r.updateHeight(i),r.doneInitialLayout=!0)),n}},Nh=class{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,i,n){return n}},Th=class extends Ph{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}},Ih=class extends Nh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return!e.belongsTo(this.formattingContext)&&!e.after&&t.fragmentLayoutConstraints.unshift(new Rh(e)),this.processor.doLayout(e,t)}},Rh=class e{constructor(e){l(this,"flagmentLayoutConstraintType","RepetitiveElementsOwner"),l(this,"nodeContext");let t=e.formattingContext;this.nodeContext=t.getRootNodeContext(e)}allowLayout(e,t,i){let n=this.getRepetitiveElements();return!(n&&!vs(this.nodeContext.viewNode)&&n.isEnableToUpdateState())||!(t&&!e||e&&e.overflow)}nextCandidate(e){let t=this.getRepetitiveElements();return!(!t||!t.isEnableToUpdateState())&&(t.updateState(),!0)}postLayout(e,t,i,n){let r=this.getRepetitiveElements();r&&e&&n.stopAtOverflow&&(null==t||r.isAfterLastContent(t))&&r.preventSkippingFooter()}finishBreak(e,t){let i=this.nodeContext.formattingContext,n=this.getRepetitiveElements();if(!n)return zn(!0);let r=this.nodeContext;return function(e,t,i){let n=e.getRepetitiveElements();if(n){let r=e.getRootNodeContext(t);if(r.viewNode){let e=r.viewNode.firstChild;return n.appendHeaderToFragment(r,e,i)}}return zn(!0)}(i,r,t).thenAsync((()=>function(e,t,i){let n=e.getRepetitiveElements();if(n&&!n.isSkipFooter){let r=e.getRootNodeContext(t);if(r.viewNode)return n.appendFooterToFragment(r,null,i)}return zn(!0)}(i,r,t).thenAsync((()=>(n.prepareLayoutFragment(),zn(!0))))))}getRepetitiveElements(){return this.nodeContext.formattingContext.getRepetitiveElements()}equalsTo(t){return t instanceof e&&this.nodeContext.formattingContext===t.nodeContext.formattingContext}getPriorityOfFinishBreak(){return 10}},_h=class extends Ls{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.formattingContext.getRepetitiveElements();return e.belongsTo(this.formattingContext)||t.doneInitialLayout?(!e.belongsTo(this.formattingContext)&&!e.after&&t&&t.preventSkippingHeader(),new Ih(this.formattingContext,this.processor)):new Th(this.formattingContext,this.processor)}},Ah=class extends Bs{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=t.getRepetitiveElements();if(i.parent&&t.rootSourceNode===i.parent.sourceNode){switch(i.repeatOnBreak){case"header":if(!n.isHeaderRegistered())return n.setHeaderNodeContext(i),zn(!0);i.repeatOnBreak="none";break;case"footer":if(!n.isFooterRegistered())return n.setFooterNodeContext(i),zn(!0);i.repeatOnBreak="none"}n.firstContentSourceNode||(n.firstContentSourceNode=i.sourceNode)}return Bs.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext;return i.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),"header"===i.repeatOnBreak||"footer"===i.repeatOnBreak?zn(!0):Bs.prototype.afterNonInlineElementNode.call(this,e)}};function Lh(e,t){e&&function(e,t){for(let i=e;i;i=i.parent){let e=i.formattingContext;e&&e instanceof kh&&!i.belongsTo(e)&&t(e,i)}}(e.after?e.parent:e,((e,i)=>{po.isInstanceOfTableFormattingContext(e)||t.fragmentLayoutConstraints.push(new Rh(i))}))}var Oh=new class extends Is{layout(e,t,i){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);let n=e.formattingContext;return n.getRootViewNode(e)?(i&&Lh(e.parent,t),e.belongsTo(n)?Is.prototype.layout.call(this,e,t,i):new _h(n,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){let t=function(e){let t=e.formattingContext;return t&&t instanceof kh?t:null}(e).getRepetitiveElements();return t&&!t.allowInsertRepeatitiveElements&&(t.isHeaderSourceNode(e.sourceNode)||t.isFooterSourceNode(e.sourceNode))&&e.viewNode.parentNode.removeChild(e.viewNode),!1}doInitialLayout(e,t){e.formattingContext;let i=Mn("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(i),i.result()}layoutEntireBlock(e,t){let i=e.formattingContext,n=new Ah(i,t);return new Fs(n,t.layoutContext).iterate(e)}doLayout(e,t){let i=e.formattingContext,n=Mn("doLayout");return fh(t.layoutContext.nextInTree(e,!1),t).then((e=>{let r=e;n.loopWithFrame((e=>{for(;r;){let n=!0;if(t.layoutNext(r,!1).then((o=>{r=o,t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||r&&t.stopByOverflow(r)||r&&r.after&&r.sourceNode==i.rootSourceNode?e.breakLoop():n?n=!1:e.continueLoop()})),n)return void(n=!1)}e.breakLoop()})).then((()=>{n.finish(r)}))})),n.result()}finishBreak(e,t,i,n){return Is.prototype.finishBreak.call(this,e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Is.prototype.clearOverflownViewNodes(e,t,i,n)}};I("RESOLVE_LAYOUT_PROCESSOR",(e=>e instanceof kh&&!po.isInstanceOfTableFormattingContext(e)?Oh:null));var Fh=class{constructor(e,t){this.rowIndex=e,this.sourceNode=t,l(this,"cells",[])}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map((e=>e.height)))}},Bh=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,l(this,"viewElement"),l(this,"colSpan"),l(this,"rowSpan"),l(this,"height",0),l(this,"anchorSlot",null),this.viewElement=i,this.colSpan=i.colSpan||1,this.rowSpan=i.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}},Mh=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,this.cell=i}},zh=class{constructor(e,t,i){this.column=e,this.cellNodeContext=i,l(this,"pseudoColumn"),l(this,"empty",!1),this.pseudoColumn=new vh(e,t,i)}findAcceptableBreakPosition(){let e=this.cellNodeContext.viewNode,{verticalAlign:t,alignContent:i}=e.style;"top"!==t&&"baseline"!==t&&oe(e,"vertical-align","top"),i&&"normal"!==i&&oe(e,"align-content","normal");let n=this.pseudoColumn.findAcceptableBreakPosition(!0);return oe(e,"vertical-align",t),i&&"normal"!==i&&oe(e,"align-content",i),n}},Dh=class{constructor(e,t){this.viewNode=e,this.side=t}},Vh=class extends Ns{constructor(e,t,i,n){super(e,t,i,n),l(this,"formattingContext"),l(this,"acceptableCellBreakPositions",null),l(this,"rowIndex",null),this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){let i=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every((e=>!!e.nodeContext))?i:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();this.getAcceptableCellBreakPositions().forEach((t=>{e+=t.breakPosition.getMinBreakPenalty()}));let t=this.getCellFragments();return e+=Math.max(0,...t.map((e=>e.cellNodeContext.breakPenalty))),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){this.formattingContext;let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map((e=>e.findAcceptableBreakPosition()))}return this.acceptableCellBreakPositions}getRowIndex(){return null!=this.rowIndex?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},Uh=class extends Es{constructor(e,t,i){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=i,l(this,"acceptableCellBreakPositions",null)}findAcceptableBreak(e,t){if(this!==e.breakPositions[0]&&t<this.getMinBreakPenalty())return null;let i=this.getCellFragments(),n=this.getAcceptableCellBreakPositions(),r=n.every((e=>!!e.nodeContext))&&n.some(((e,t)=>{let n=i[t].pseudoColumn,r=e.nodeContext;return!n.isStartNodeContext(r)&&!n.isLastAfterNodeContext(r)}));return this.beforeNodeContext.overflow=n.some((e=>e.nodeContext&&e.nodeContext.overflow)),r?this.beforeNodeContext:null}getMinBreakPenalty(){this.formattingContext.getRowByIndex(this.rowIndex);let e=this.beforeNodeContext.breakPenalty,t=this.getAcceptableCellBreakPositions(),i=this.getCellFragments();e+=Math.max(0,...i.map((e=>e.cellNodeContext.breakPenalty)));let n=t.some(((e,t)=>e.breakPosition instanceof mh&&i[t].cellNodeContext.sourceNode.rowSpan>1));return t.forEach(((t,r)=>{let o=t.breakPosition.getMinBreakPenalty();n&&t.breakPosition instanceof Ns&&t.breakPosition.overflows&&o>=3&&(i[r].column.checkOverflowAndSaveEdge(t.nodeContext,null)||(o-=3)),e+=o})),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map((e=>e.findAcceptableBreakPosition()))}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},Hh=class extends kh{constructor(e,t){super(e,t),this.tableSourceNode=t,l(this,"formattingContextType","Table"),l(this,"vertical",!1),l(this,"columnCount",-1),l(this,"tableWidth",0),l(this,"captions",[]),l(this,"colGroups",null),l(this,"colWidths",null),l(this,"inlineBorderSpacing",0),l(this,"rows",[]),l(this,"slots",[]),l(this,"cellFragments",[]),l(this,"lastRowViewNode",null),l(this,"cellBreakPositions",[]),l(this,"repetitiveElements",null)}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return 0===this.cellBreakPositions.length;case"table-cell":return!this.cellBreakPositions.some((t=>t.cellNodePosition.steps[0].node===e.sourceNode));default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let i=this.rows[e];i||(this.addRow(e,new Fh(e,null)),i=this.rows[e]),i.addCell(t);let n=e+t.rowSpan,r=this.getRowSlots(e),o=0;for(;r[o];)o++;for(;e<n;e++){r=this.getRowSlots(e);for(let i=o;i<o+t.colSpan;i++){let n=r[i]=new Mh(e,i,t);t.anchorSlot||t.setAnchorSlot(n)}}}getRowByIndex(e){return this.rows[e]}findRowIndexBySourceNode(e){return this.rows.findIndex((t=>e===t.sourceNode))}addCellFragment(e,t,i){let n=this.cellFragments[e];n||(n=this.cellFragments[e]=[]),n[t]=i}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce(((e,t)=>t.cell!==e[e.length-1]?e.concat(t.cell):e),[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter((t=>t.rowIndex+t.rowSpan-1>e))}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map((e=>e.cells.reduce(((e,t)=>e+t.colSpan),0))))),this.columnCount}updateCellSizes(e){this.rows.forEach((t=>{t.cells.forEach((t=>{let i=e.getElementClientRect(t.viewElement);t.viewElement=null,t.setHeight(this.vertical?i.width:i.height)}))}))}findCellFromColumn(e){if(!e)return null;let t=null,i=0,n=0;e:for(i=0;i<this.cellFragments.length;i++)if(this.cellFragments[i])for(n=0;n<this.cellFragments[i].length;n++)if(this.cellFragments[i][n]&&e===this.cellFragments[i][n].pseudoColumn.getColumn()){t=this.rows[i].cells[n];break e}if(!t)return null;for(;i<this.slots.length;i++)for(;n<this.slots[i].length;n++){let e=this.slots[i][n];if(e.cell===t)return{rowIndex:e.rowIndex,columnIndex:e.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let t=[];return this.slots.reduce(((i,n,r)=>{if(r>=e.rowIndex)return i;let o=n[e.columnIndex]&&this.getCellFragmentOfCell(n[e.columnIndex].cell);return!o||t.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),i),t.push(o)),i}),[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach((t=>{t.cells.forEach(((t,i)=>{e[i]||(e[i]={collected:[],elements:[]});let n=e[i],r=this.getCellFragmentOfCell(t);!r||n.collected.includes(r)||(this.collectElementsOffsetFromColumn(r.pseudoColumn.getColumn(),n.elements),n.collected.push(r))}))})),[new $h(e.map((e=>e.elements)))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach((e=>{if(co.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(e)){let i=e.getRepetitiveElements();t.push(i)}po.isInstanceOfTableRowLayoutConstraint(e)&&e.getElementsOffsetsForTableCell(null).forEach((e=>{t.push(e)}))}))}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},$h=class{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,(e=>e.current))}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,(e=>e.minimum))}calculateMaxOffsetOfColumn(e,t){let i=0;return this.repeatitiveElementsInColumns.forEach((n=>{let r=Ps(e,n);i=Math.max(i,t(r))})),i}};function jh(e){return function(e){return"table-row-group"===e||"table-header-group"===e||"table-footer-group"===e}(e)||function(e){return"table"===e||"inline-table"===e}(e)}function Wh(e,t,i){let n=e.nodeContext,r=n.display,o=n.parent?n.parent.display:null,s=!1;if("inline-table"===o&&!(n.formattingContext instanceof Hh))for(let e=n.parent;e;e=e.parent)if(e.formattingContext instanceof Hh){s=e.formattingContext===t;break}return s||"table-row"===r&&!jh(o)||"table-cell"===r&&"table-row"!==o&&!jh(o)||n.formattingContext instanceof Hh&&n.formattingContext!==t?i.buildDeepElementView(n).thenAsync((t=>(e.nodeContext=t,zn(!0)))):null}var Gh=class extends Bs{constructor(e,t){super(),this.formattingContext=e,this.column=t,l(this,"rowIndex",-1),l(this,"columnIndex",0),l(this,"inRow",!1),l(this,"checkPoints",[]),l(this,"inHeaderOrFooter",!1)}startNonInlineElementNode(e){let t=this.formattingContext,i=Wh(e,t,this.column);if(i)return i;this.postLayoutBlockContents(e);let n=e.nodeContext,r=n.display,o=t.getRepetitiveElements();switch(r){case"table":t.inlineBorderSpacing=n.inlineBorderSpacing;break;case"table-caption":{let e=new Dh(n.viewNode,n.captionSide);t.captions.push(e);break}case"table-header-group":return o.isHeaderRegistered()||(this.inHeaderOrFooter=!0,o.setHeaderNodeContext(n)),zn(!0);case"table-footer-group":return o.isFooterRegistered()||(this.inHeaderOrFooter=!0,o.setFooterNodeContext(n)),zn(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,n.sourceNode,this.columnIndex=0,t.addRow(this.rowIndex,new Fh(this.rowIndex,n.sourceNode)),o.firstContentSourceNode||(o.firstContentSourceNode=n.sourceNode))}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=i.display,r=this.column.clientLayout;if(this.postLayoutBlockContents(e),i.sourceNode===t.tableSourceNode){let n=r.getElementComputedStyle(t.getRootViewNode(i));t.tableWidth=parseFloat(n[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(n){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,zn(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=i.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let e=i.viewNode;t.addCell(this.rowIndex,new Bh(this.rowIndex,this.columnIndex,e)),this.columnIndex++}}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let t=e.nodeContext;t&&t.viewNode&&!Ss(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},qh=class e extends Bs{constructor(e,t){super(!0),this.formattingContext=e,this.column=t,l(this,"inRow",!1),l(this,"currentRowIndex",-1),l(this,"currentColumnIndex",0),l(this,"originalStopAtOverflow"),l(this,"inHeader"),l(this,"inFooter"),this.originalStopAtOverflow=t.stopAtOverflow,t.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(e){let t=this.formattingContext.colWidths,i=0;for(let n=0;n<e.colSpan;n++)i+=t[e.anchorSlot.columnIndex+n];return i+=this.formattingContext.inlineBorderSpacing*(e.colSpan-1),i}layoutCell(e,t,i){let n=e.rowIndex,r=e.columnIndex,o=e.colSpan,s=t.viewNode;t.verticalAlign,o>1&&(oe(s,"box-sizing","border-box"),oe(s,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(e)}px`));let a=s.ownerDocument.createElement("div");s.appendChild(a);let l=new zh(this.column,a,t);return this.formattingContext.addCellFragment(n,r,l),1===i.primary.steps.length&&i.primary.after&&(l.empty=!0),l.pseudoColumn.layout(i,!0).thenReturn(!0)}hasBrokenCellAtSlot(e){let t=this.formattingContext.cellBreakPositions[0];return!!t&&t.cell.anchorSlot.columnIndex===e}extractRowSpanningCellBreakPositions(){let e=this.formattingContext.cellBreakPositions;if(0===e.length)return[];let t=[],i=0;do{let n=e[i],r=n.cell.rowIndex;if(r<this.currentRowIndex){let o=t[r];o||(o=t[r]=[]),o.push(n),e.splice(i,1)}else i++}while(i<e.length);return t}layoutRowSpanningCellsFromPreviousFragment(e){let t=this.formattingContext,i=this.extractRowSpanningCellBreakPositions(),n=i.reduce((e=>e+1),0);if(0===n)return zn(!0);let r=this.column.layoutContext,o=e.nodeContext;o.viewNode.parentNode.removeChild(o.viewNode);let s=Mn("layoutRowSpanningCellsFromPreviousFragment"),a=zn(!0),l=0,h=[];return i.forEach((e=>{a=a.thenAsync((()=>{let i=Bo(e[0].cellNodePosition.steps[1],o.parent);return r.setCurrent(i,!1).thenAsync((()=>{let o=zn(!0),s=0;function a(e){for(;s<e;){if(!h.includes(s)){let e=i.viewNode.ownerDocument.createElement("td");oe(e,"padding","0"),i.viewNode.appendChild(e)}s++}}return e.forEach((e=>{o=o.thenAsync((()=>{let t=e.cell;a(t.anchorSlot.columnIndex);let o=e.cellNodePosition,u=Bo(o.steps[0],i);return u.offsetInNode=o.offsetInNode,u.after=o.after,u.fragmentIndex=o.steps[0].fragmentIndex+1,r.setCurrent(u,!1).thenAsync((()=>{let i=e.breakChunkPosition;for(let e=0;e<t.colSpan;e++)h.push(s+e);return s+=t.colSpan,this.layoutCell(t,u,i).thenAsync((()=>(u.viewNode.rowSpan=t.rowIndex+t.rowSpan-this.currentRowIndex+n-l,zn(!0))))}))}))})),o.thenAsync((()=>(a(t.getColumnCount()),l++,zn(!0))))}))}))})),a.then((()=>{r.setCurrent(o,!0,e.atUnforcedBreak).then((()=>{s.finish(!0)}))})),s.result()}startTableRow(e){if(this.inHeader||this.inFooter)return zn(!0);let t=e.nodeContext,i=this.formattingContext;return this.currentRowIndex<0?(t.sourceNode,this.currentRowIndex=i.findRowIndexBySourceNode(t.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(e).thenAsync((()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge)&&0===i.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length&&(this.resetColumn(),t.overflow=!0,e.break=!0),zn(!0))))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach((e=>{let t=this.formattingContext.cellBreakPositions[e.columnIndex];if(t&&t.cell.anchorSlot.columnIndex==e.anchorSlot.columnIndex){let e=t.cellNodePosition.steps[0],i=this.column.layoutContext.xmldoc.getElementOffset(e.node);hh(i,e.fragmentIndex+1,1)}}))}startTableCell(e){if(this.inHeader||this.inFooter)return zn(!0);let t=e.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let i=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!i)return e.break=!0,zn(!0);let n=t.copy().modify();n.after=!0,e.nodeContext=n;let r,o=Mn("startTableCell");if(this.hasBrokenCellAtSlot(i.anchorSlot.columnIndex)){let e=this.formattingContext.cellBreakPositions.shift();t.fragmentIndex=e.cellNodePosition.steps[0].fragmentIndex+1,r=zn(e.breakChunkPosition)}else r=this.column.nextInTree(t,e.atUnforcedBreak).thenAsync((e=>{e.viewNode&&t.viewNode.removeChild(e.viewNode);let i=Fo(e,0);return zn(new Ho(i))}));return r.then((n=>{this.layoutCell(i,t,n).then((()=>{this.afterNonInlineElementNode(e),this.currentColumnIndex++,o.finish(!0)}))})),o.result()}startNonInlineBox(e){let t=Wh(e,this.formattingContext,this.column);if(t)return t;let i=e.nodeContext,n=this.formattingContext.getRepetitiveElements(),r=i.display;return"table-header-group"===r&&n&&n.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!0,zn(!0)):"table-footer-group"===r&&n&&n.isFooterSourceNode(i.sourceNode)?(this.inFooter=!0,zn(!0)):"table-row"===r?this.startTableRow(e):"table-cell"===r?this.startTableCell(e):zn(!0)}endNonInlineBox(e){let t=e.nodeContext;if("table-row"===t.display&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let e=t.copy().modify();e.after=!1;let i=new Uh(this.currentRowIndex,e,this.formattingContext);this.column.breakPositions.push(i)}return zn(!0)}afterNonInlineElementNode(t){let i=t.nodeContext,n=this.formattingContext.getRepetitiveElements(),r=i.display;if("table-header-group"===r?n&&!n.allowInsertRepeatitiveElements&&n.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!1,i.viewNode.parentNode.removeChild(i.viewNode)):oe(i.viewNode,"display","table-row-group"):"table-footer-group"===r&&(n&&!n.allowInsertRepeatitiveElements&&n.isFooterSourceNode(i.sourceNode)?(this.inFooter=!1,i.viewNode.parentNode.removeChild(i.viewNode)):oe(i.viewNode,"display","table-row-group")),r&&e.ignoreList[r])i.viewNode.parentNode.removeChild(i.viewNode);else{if(i.sourceNode!==this.formattingContext.tableSourceNode)return super.afterNonInlineElementNode(t);i.overflow=this.column.checkOverflowAndSaveEdge(i,null),this.resetColumn(),t.break=!0}return zn(!0)}};l(qh,"ignoreList",{"table-caption":!0,"table-column-group":!0,"table-column":!0});var Xh=qh,Yh=[],Kh=class{layoutEntireTable(e,t){let i=e.formattingContext,n=new Gh(i,t);return new Fs(n,t.layoutContext).iterate(e)}getColumnWidths(e,t,i,n){let r=e.ownerDocument,o=r.createElement("tr"),s=[];for(let e=0;e<t;e++){let e=r.createElement("td");o.appendChild(e),s.push(e)}e.parentNode.insertBefore(o,e.nextSibling);let a=s.map((e=>{let t=n.getElementClientRect(e),r=i?t.height:t.width;return Math.ceil(r)}));return e.parentNode.removeChild(o),a}getColGroupElements(e){let t=[],i=e.firstElementChild;for(;i;)"colgroup"===i.localName&&t.push(i),i=i.nextElementSibling;return t}normalizeAndGetColElements(e){let t=[];return e.forEach((e=>{let i=e.span;e.removeAttribute("span");let n=e.firstElementChild;for(;n;){if("col"===n.localName){let r=n.span;for(n.removeAttribute("span"),i-=r;r-- >1;){let i=n.cloneNode(!0);e.insertBefore(i,n),t.push(i)}t.push(n)}n=n.nextElementSibling}for(;i-- >0;)n=e.ownerDocument.createElement("col"),e.appendChild(n),t.push(n)})),t}addMissingColElements(e,t,i,n){if(e.length<i){let r=n.ownerDocument.createElement("colgroup");t.push(r);for(let t=e.length;t<i;t++){let t=n.ownerDocument.createElement("col");r.appendChild(t),e.push(t)}}}normalizeColGroups(e,t,i){let n=e.vertical,r=e.lastRowViewNode;if(!r)return;e.lastRowViewNode=null;let o=r.ownerDocument.createDocumentFragment(),s=e.getColumnCount();if(!(s>0))return void(e.colGroups=o);let a=e.colWidths=this.getColumnWidths(r,s,n,i.clientLayout),l=this.getColGroupElements(t),h=this.normalizeAndGetColElements(l);this.addMissingColElements(h,l,s,t),h.forEach(((e,t)=>{oe(e,n?"height":"width",`${a[t]}px`)})),l.forEach((e=>{o.appendChild(e.cloneNode(!0))})),e.colGroups=o}doInitialLayout(e,t){let i=e.formattingContext;i.vertical=e.vertical,i.initializeRepetitiveElements(e.vertical),e.sourceNode;let n=function(e){let t=Yh.findIndex((t=>t.root===e)),i=Yh[t];return i?i.tableLayoutOption:null}(e.sourceNode);!function(e){let t=Yh.findIndex((t=>t.root===e));t>=0&&Yh.splice(t,1)}(e.sourceNode);let r=Mn("TableLayoutProcessor.doInitialLayout"),o=e.copy();return this.layoutEntireTable(e,t).then((s=>{let a=s.viewNode,l=t.clientLayout.getElementClientRect(a),h=t.vertical?l.left:l.bottom;if(h+=(t.vertical?-1:1)*Ps(e,t.collectElementsOffset()).current,!(t.isOverflown(h)||n&&n.calculateBreakPositionsInside))return t.breakPositions.push(new eu(o)),void r.finish(s);this.normalizeColGroups(i,a,t),i.updateCellSizes(t.clientLayout),r.finish(null)})),r.result()}addCaptions(e,t,i){let n=e.captions;n.forEach(((e,r)=>{e&&(t.insertBefore(e.viewNode,i),"top"===e.side&&(n[r]=null))}))}addColGroups(e,t,i){e.colGroups&&0===this.getColGroupElements(t).length&&(t.insertBefore(e.colGroups.cloneNode(!0),i),oe(t,"table-layout","fixed"),oe(t,e.vertical?"height":"width",`${e.tableWidth}px`))}removeColGroups(e,t){if(e.colGroups&&t){let e=this.getColGroupElements(t);e&&e.forEach((e=>{t.removeChild(e)}))}}doLayout(e,t){let i=e.formattingContext,n=i.getRootViewNode(e),r=n.firstChild;this.addCaptions(i,n,r),this.addColGroups(i,n,r);let o=new Xh(i,t),s=new Fs(o,t.layoutContext),a=Mn("TableFormattingContext.doLayout");return s.iterate(e).thenFinish(a),a.result()}layout(e,t,i){let n=e.formattingContext;return n.getRootViewNode(e)?(i&&Lh(e.parent,t),new Jh(n,this).layout(e,t)):t.buildDeepElementView(e)}createEdgeBreakPosition(e,t,i,n){return new Vh(e,t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return Zh(e),!1}finishBreak(e,t,i,n){let r=t.formattingContext;if("table-row"===t.display){t.sourceNode;let i,n=r.findRowIndexBySourceNode(t.sourceNode);if(r.cellBreakPositions=[],i=t.after?r.getRowSpanningCellsOverflowingTheRow(n):r.getCellsFallingOnRow(n),i.length){let o=Mn("TableLayoutProcessor.finishBreak"),s=0;return o.loopWithFrame((e=>{if(s===i.length)return void e.breakLoop();let t=i[s++],o=r.getCellFragmentOfCell(t),a=o.findAcceptableBreakPosition().nodeContext,l=o.cellNodeContext,h=l.toNodePosition(),u=new Ho(a.toNodePosition());r.cellBreakPositions.push({cellNodePosition:h,breakChunkPosition:u,cell:t});let c=l.viewNode;o.column.layoutContext.processFragmentedBlockEdge(o.cellNodeContext),n<t.rowIndex+t.rowSpan-1&&(c.rowSpan=n-t.rowIndex+1),o.empty?e.continueLoop():o.pseudoColumn.finishBreak(a,!1,!0).then((()=>{(function(e,t,i){let n=t.getRepetitiveElements();if(!n||!n.isHeaderRegistered()&&!n.isFooterRegistered())return;let r=t.vertical,o=e.column,s=e.pseudoColumn.getColumnElement(),a=e.cellNodeContext.viewNode,l=o.clientLayout.getElementClientRect(a),h=o.getComputedPaddingBorder(a);if(r){oe(s,"max-width",`${l.right-o.footnoteEdge-n.calculateOffset(i)-h.right}px`)}else{oe(s,"max-height",`${o.footnoteEdge-n.calculateOffset(i)-l.top-h.top}px`)}})(o,r,a),e.continueLoop()}))})).then((()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),Zh(t),r.finishFragment(),o.finish(!0)})),o.result()}}return Zh(t),r.finishFragment(),_s.finishBreak(e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Is.prototype.clearOverflownViewNodes(e,t,i,n)}};function Zh(e){let t="table-row"===e.display?e.viewNode.parentElement:"table"===e.display?e.viewNode.querySelector("tbody"):null;if(!t)return;let i=t.querySelectorAll(":scope>tr:has(>:empty):not(:has(>:not([rowspan]:not([rowspan='1']),:empty)))");if(0===i.length)return;let n=Array.from(i).reduce(((t,i)=>{let n=i.getBoundingClientRect();return t+(e.vertical?n.width:n.height)}),0),r=i[i.length-1],o=Array.from(t.children).indexOf(r),s=Array.from(r.children).reduce(((e,i)=>{let n=i.rowSpan;return n>1&&o+n<t.childElementCount?Math.max(e,n):e}),0),a=s?t.children[o+s-1]:t.lastElementChild;if(a!=t.lastElementChild&&a.querySelector(":scope>*>div>div"))for(let e=a;e&&e!==t.lastElementChild;e=e.nextElementSibling)if(e.querySelector(":scope>[rowspan]:not([rowspan='1'])")){a=e;break}let l=a.getBoundingClientRect(),h=n+(e.vertical?l.width:l.height);oe(a,e.vertical?"width":"height",`${h}px`)}var Jh=class extends Ls{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.tableFormattingContext.getRepetitiveElements();return t&&t.doneInitialLayout?(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&t&&t.preventSkippingHeader(),new iu(this.tableFormattingContext,this.processor)):new Qh(this.tableFormattingContext,this.processor)}clearNodes(e){super.clearNodes(e);let t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}},Qh=class extends Ph{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}},eu=class extends Ns{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new tu(this.position.sourceNode))}},tu=class e{constructor(e){this.tableRootNode=e,l(this,"flagmentLayoutConstraintType","EntireTable")}allowLayout(e,t,i){return e.overflow,!1}nextCandidate(e){return!0}postLayout(e,t,i,n){t.sourceNode,Yh.push({root:t.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(e,t){return zn(!0)}equalsTo(t){return t instanceof e&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},iu=class extends Nh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){let i=this.formattingContext.getRepetitiveElements();if(i&&!i.isAfterLastContent(e)){let i=new nu(e);t.fragmentLayoutConstraints.some((e=>i.equalsTo(e)))||t.fragmentLayoutConstraints.unshift(i)}return this.processor.doLayout(e,t)}},nu=class e extends Rh{constructor(e){super(e),l(this,"flagmentLayoutConstraintType","TableRow"),l(this,"cellFragmentLayoutConstraints",[])}allowLayout(e,t,i){let n=this.getRepetitiveElements();return!(n&&!i.pseudoParent&&!vs(this.nodeContext.viewNode)&&n.isEnableToUpdateState())||!(t&&!e||e&&e.overflow)}nextCandidate(e){let t=this.nodeContext.formattingContext;return!!this.collectCellFragmentLayoutConstraints(e,t).some((t=>t.constraints.some((t=>t.nextCandidate(e)))))||super.nextCandidate(e)}postLayout(e,t,i,n){let r=this.nodeContext.formattingContext;if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(t,r),this.cellFragmentLayoutConstraints.forEach((t=>{t.constraints.forEach((r=>{r.postLayout(e,t.breakPosition,i,n)}))})),!e){let e=r.getRootViewNode(this.nodeContext);(new Kh).removeColGroups(r,e),this.removeDummyRowNodes(i)}super.postLayout(e,t,i,n)}finishBreak(e,t){this.nodeContext.formattingContext;let i=Mn("finishBreak"),n=this.cellFragmentLayoutConstraints.reduce(((e,t)=>e.concat(t.constraints.map((e=>({constraint:e,breakPosition:t.breakPosition}))))),[]),r=0;return i.loop((()=>{if(r<n.length){let e=n[r++];return e.constraint.finishBreak(e.breakPosition,t).thenReturn(!0)}return zn(!1)})).then((()=>{i.finish(!0)})),i.result().thenAsync((()=>super.finishBreak(e,t)))}removeDummyRowNodes(e){if(e&&"table-row"===e.display&&e.viewNode)for(;e.viewNode.previousElementSibling;){let t=e.viewNode.previousElementSibling;t.parentNode&&t.parentNode.removeChild(t)}}collectCellFragmentLayoutConstraints(e,t){return this.getCellFragemnts(e,t).map((e=>({constraints:e.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:e.breakPosition})))}getCellFragemnts(e,t){let i=Number.MAX_VALUE;e&&"table-row"===e.display&&(e.sourceNode,i=t.findRowIndexBySourceNode(e.sourceNode)+1),i=Math.min(t.cellFragments.length,i);let n=[];for(let e=0;e<i;e++)t.cellFragments[e]&&t.cellFragments[e].forEach((e=>{e&&n.push({fragment:e,breakPosition:e.findAcceptableBreakPosition().nodeContext})}));return n}getElementsOffsetsForTableCell(e){let t=this.nodeContext.formattingContext,i=t.findCellFromColumn(e);return i?t.collectElementsOffsetOfUpperCells(i):t.collectElementsOffsetOfHighestColumn()}equalsTo(t){return t instanceof e&&this.nodeContext.formattingContext===t.nodeContext.formattingContext}},ru=new Kh;function ou(e){return e.reduce(((e,t)=>e+t),0)/e.length}I("RESOLVE_FORMATTING_CONTEXT",(function(e,t,i,n,r,o){if(!t)return null;if(i===oi.table){let t=e.parent;return new Hh(t?t.formattingContext:null,e.sourceNode)}return null})),I("RESOLVE_LAYOUT_PROCESSOR",(function(e){return e instanceof Hh?ru:null}));var su=class{constructor(e,t){this.layoutResult=e,this.penalty=t}};function au(e){return e.vertical?e.width:e.height}function lu(e,t){e.vertical?e.width=t:e.height=t}var hu=class{constructor(e,t,i){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=i,l(this,"originalContainerBlockSize"),this.originalContainerBlockSize=au(e)}balanceColumns(e){let t=Mn("ColumnBalancer#balanceColumns");this.preBalance(e),this.savePageFloatLayoutContexts(e),this.layoutContainer.clear();let i=[this.createTrialResult(e)];return t.loopWithFrame((e=>{this.hasNextCandidate(i)?(this.updateCondition(i),this.columnGenerator().then((t=>{this.savePageFloatLayoutContexts(t),this.layoutContainer.clear(),t?(i.push(this.createTrialResult(t)),e.continueLoop()):e.breakLoop()}))):e.breakLoop()})).then((()=>{let e=i.reduce(((e,t)=>t.penalty<e.penalty?t:e),i[0]);this.restoreContents(e.layoutResult),this.postBalance(),t.finish(e.layoutResult)})),t.result()}createTrialResult(e){let t=this.calculatePenalty(e);return new su(e,t)}preBalance(e){}postBalance(){lu(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){let t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){let t=this.layoutContainer.element;e.columns.forEach((e=>{t.appendChild(e.element)})),e.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}};function uu(e){let t=e[e.length-1];if(0===t.penalty)return!1;let i=e[e.length-2];if(i&&t.penalty>=i.penalty)return!1;let n=t.layoutResult.columns;return Math.max.apply(null,n.map((e=>e.computedBlockSize)))>Math.max.apply(null,n.map((e=>e.getMaxBlockSizeOfPageFloats())))+1}function cu(e,t){var i;let n=e[e.length-1].layoutResult.columns,r=Math.max.apply(null,n.map((e=>isNaN(e.blockDistanceToBlockEndFloats)?e.computedBlockSize:e.computedBlockSize-e.blockDistanceToBlockEndFloats+1)))-1;if(r<au(t)?lu(t,r):lu(t,au(t)-1),t.vertical){let e=parseFloat(null==(i=t.element.style)?void 0:i.width);t.originX=e-t.width}}var du=class extends hu{constructor(e,t,i,n){super(i,e,t),this.columnCount=n,l(this,"originalPosition",null),l(this,"foundUpperBound",!1)}preBalance(e){let t=e.columns.reduce(((e,t)=>e+t.computedBlockSize),0);lu(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):null===e}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let t=e.columns;return pu(t)?1/0:Math.max.apply(null,t.map((e=>e.computedBlockSize)))}hasNextCandidate(e){if(1===e.length)return!0;if(this.foundUpperBound)return uu(e);{let t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!pu(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):au(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)cu(e,this.layoutContainer);else{let e=Math.min(this.originalContainerBlockSize,au(this.layoutContainer)+.1*this.originalContainerBlockSize);lu(this.layoutContainer,e)}}};function pu(e){if(e.length<=1)return!1;let t=e[e.length-1].computedBlockSize,i=e.slice(0,e.length-1);return i.every((e=>t>e.computedBlockSize+6))}var fu=class extends hu{constructor(e,t,i){super(i,e,t)}calculatePenalty(e){if(e.columns.every((e=>0===e.computedBlockSize)))return 1/0;let t=e.columns.filter((e=>!e.pageBreakType)).map((e=>e.computedBlockSize));return function(e){let t=ou(e);return ou(e.map((e=>{let i=e-t;return i*i})))}(t)}hasNextCandidate(e){return uu(e)}updateCondition(e){cu(e,this.layoutContainer)}},gu=class{constructor(e,t,i){l(this,"endStuckFixed"),l(this,"endFixed"),l(this,"endSlipped"),this.endStuckFixed=e,this.endFixed=t,this.endSlipped=i}},mu=class{constructor(){l(this,"map",[])}getMaxFixed(){return 0==this.map.length?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return 0==this.map.length?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(0==this.map.length)this.map.push(new gu(e,e,e));else{let t=this.map[this.map.length-1],i=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=i):this.map.push(new gu(e,e,i))}}addSlippedRange(e){0==this.map.length?this.map.push(new gu(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){let t=be(this.map.length,(t=>e<=this.map[t].endFixed)),i=this.map[t];return i.endSlipped-Math.max(0,i.endStuckFixed-e)}fixedBySlipped(e){let t=be(this.map.length,(t=>e<=this.map[t].endSlipped)),i=this.map[t];return i.endStuckFixed-(i.endSlipped-e)}},bu=class e{constructor(t,i,n,r,o,s,a,h){if(this.context=t,this.style=i,this.offset=n,this.isRoot=r,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=a,this.isParentBoxDisplayed=h,l(this,"flowName"),l(this,"isBlockValue",null),l(this,"hasBoxValue",null),l(this,"styleValues",{}),l(this,"beforeBox",null),l(this,"afterBox",null),l(this,"breakBefore",null),this.flowName=o.flowName,this.hasBox()){let r=i._pseudos;if(r&&r.before){let i=new e(t,r.before,n,!1,o,this.isBlock(),a,!0);Xo(i.styleValue("content"))&&(this.beforeBox=i,this.breakBefore=i.breakBefore)}}this.breakBefore=so(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&to(this.breakBefore)&&(o.breakBefore=so(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,i,n){if(this.hasBox()){let r=this.style._pseudos;if(r&&r.after){let o=new e(this.context,r.after,t,!1,this.flowChunk,i,n,!0);Xo(o.styleValue("content"))&&(this.afterBox=o)}}}styleValue(e,t){if(!(e in this.styleValues)){let i=this.style[e];this.styleValues[e]=i?i.evaluate(this.context,e):t||null}return this.styleValues[e]}displayValue(){return this.styleValue("display",oi.inline)}isBlock(){if(null===this.isBlockValue){let e=this.displayValue(),t=this.styleValue("position"),i=this.styleValue("float");this.isBlockValue=ps(e,t,i,this.isRoot)}return this.isBlockValue}hasBox(){return null===this.hasBoxValue&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==oi.none&&!cs(this.styleValue("position"))),this.hasBoxValue}getBreakValue(e){let t=null;if(this.isBlock()){let i=this.styleValue(`break-${e}`);i&&(t=i.toString())}return t}},vu=class{constructor(e){this.context=e,l(this,"stack",[]),l(this,"atBlockStart",!0),l(this,"atFlowStart",!0),l(this,"atStartStack",[])}empty(){return 0===this.stack.length}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every((e=>e.displayValue()!==oi.none))}push(e,t,i,n){let r=this.lastBox();n&&r&&n.flowName!==r.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let o=n||r.flowChunk,s=this.atFlowStart||!!n,a=this.isCurrentBoxDisplayed(),l=new bu(this.context,e,t,i,o,s||this.atBlockStart,s,a);return this.stack.push(l),this.atBlockStart=l.hasBox()?!l.beforeBox&&l.isBlock():this.atBlockStart,this.atFlowStart=l.hasBox()?!l.beforeBox&&s:this.atFlowStart,l}encounteredTextNode(e){let t=this.lastBox();if((e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&t.hasBox()){let i=No(t.styleValue("white-space",oi.normal).toString());i&&!To(e,i)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){let t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){let e=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=so(t.flowChunk.breakBefore,e)}let i=this.lastBox();if(i)if(i.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let e=this.atStartStack.pop();this.atBlockStart=e.atBlockStart,this.atFlowStart=e.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,i=this.stack[t];for(i===e&&(t--,i=this.stack[t]);t>=0;){if(i.flowName!==e.flowName)return e.offset;if(!i.atBlockStart||i.isRoot)return i.offset;e=i,i=this.stack[--t]}throw new Error("No block start offset found!")}},wu=class{constructor(e,t,i,n,r,o,s,a){this.xmldoc=e,this.scope=i,this.context=n,this.primaryFlows=r,this.validatorSet=o,this.counterListener=s,l(this,"root"),l(this,"cascadeHolder"),l(this,"last"),l(this,"rootStyle",{}),l(this,"styleMap",{}),l(this,"flows",{}),l(this,"flowChunks",[]),l(this,"flowListener",null),l(this,"flowToReach",null),l(this,"idToReach",null),l(this,"cascade"),l(this,"offsetMap"),l(this,"primary",!0),l(this,"primaryStack",[]),l(this,"rootBackgroundAssigned",!1),l(this,"rootLayoutAssigned",!1),l(this,"lastOffset"),l(this,"breakBeforeValues",{}),l(this,"boxStack"),l(this,"bodyReached",!0),this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(n,s,a,e.lang),this.offsetMap=new mu;let h=e.getElementOffset(this.root);this.lastOffset=h,this.boxStack=new vu(n),this.offsetMap.addStuckRange(h);let u=this.getAttrStyle(this.root);if("http://www.w3.org/1999/xhtml"===(this.cascade.pushElement(this,this.root,u,h),this.postprocessTopStyle(u,!1),this.root.namespaceURI))this.bodyReached=!1;this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${h}`]=u,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,i){let n=e[i];return n&&n.evaluate(this.context)!==t[i]}transferPropsToRoot(e,t){for(let i in t){let n=e[i];if(n)this.rootStyle[i]=n,delete e[i];else{let e=t[i];e&&(this.rootStyle[i]=new ta(e,ur))}}}postprocessTopStyle(e,t){var i;if(t)for(let i of["writing-mode","direction"])e[i]&&(!t||!this.rootStyle[i])&&(this.rootStyle[i]=e[i]);else for(let t in e)ha(t)&&(this.rootStyle[t]=e[t]);if(!this.rootBackgroundAssigned){let t=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,i=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(t&&!ci(t)||i&&!ci(i))&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned)for(let t=0;t<yu.length;t++)if(this.hasProp(e,this.validatorSet.layoutProps,yu[t])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}if(!t){let t=e["font-size"],n=!0;if(t&&!ci(t.value)){let e=t.evaluate(this.context);if(e instanceof Wt){let t=e.num;switch(e.unit){case"em":case"rem":t*=this.context.initialFontSize;break;case"ex":t*=this.context.initialFontSize*je.ex/je.em;break;case"%":t*=this.context.initialFontSize/100;break;case"lh":case"rlh":t*=this.context.initialFontSize*je.lh/je.em;break;default:{let i=je[e.unit];i&&(t*=i),n=!1}}this.context.rootFontSize=t,this.context.isRelativeRootFontSize=n}}let r=null!=(i=this.context.rootFontSize)?i:this.context.initialFontSize,o=e["line-height"];if(o&&!ci(o.value)){let e=o.evaluate(this.context);if(e instanceof Gt)this.context.rootLineHeight=e.num*r;else if(e instanceof Wt){let t=e.num;switch(e.unit){case"em":case"rem":t*=r;break;case"ex":t*=r*je.ex/je.em;break;case"%":t*=r/100;break;case"lh":case"rlh":t*=this.context.initialFontSize*je.lh/je.em;break;default:{let i=je[e.unit];i&&(t*=i)}}this.context.rootLineHeight=t}}else this.context.rootLineHeight=this.context.fontSize()*je.lh/je.em}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){let t=e.getAttribute("style");if(t)return Ol(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;let t=this.context,i=this.xmldoc.getElementOffset(this.root);if(e<i){let e=this.getStyle(this.root,!1),n=ua(e,"flow-into"),r=n?n.evaluate(t,"flow-into").toString():"body",o=this.encounteredFlowElement(r,e,this.root,i);this.boxStack.empty()&&this.boxStack.push(e,i,!0,o)}let n=this.xmldoc.getNodeByOffset(e),r=this.xmldoc.getNodeOffset(n,0,!1);if(!(r>=this.lastOffset))for(;;){if(1!=n.nodeType)r+=n.textContent.length;else{let e=n,i=this.getStyle(e,!1),o=i["flow-into"];if(o){let n=o.evaluate(t,"flow-into").toString();this.encounteredFlowElement(n,i,e,r)}r++}if(r>=this.lastOffset)break;let e=n.firstChild;if(null==e)for(;e=n.nextSibling,!e;)if(n=n.parentNode,n===this.root)return;n=e}}resetFlowChunkStream(e){this.flowListener=e;for(let e=0;e<this.flowChunks.length;e++)this.flowListener.encounteredFlowChunk(this.flowChunks[e],this.flows[this.flowChunks[e].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;null!=this.flowToReach&&(t+=5e3,this.styleUntil(t,0)!=Number.POSITIVE_INFINITY););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;this.idToReach&&(t+=5e3,this.styleUntil(t,0)!==Number.POSITIVE_INFINITY););this.idToReach=null}encounteredFlowElement(e,t,i,n){let r=0,o=Number.POSITIVE_INFINITY,s=!1,a=!1,l=!1,h=t["flow-options"];if(h){let e=function(e){if(e){let t=new Bi;try{return e.visit(t),t.propSet}catch(e){P.warn(e,"toSet:")}}return{}}(h.evaluate(this.context,"flow-options"));s=!!e.exclusive,a=!!e.static,l=!!e.last}let u=t["flow-linger"];u&&(o=zi(u.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));let c=t["flow-priority"];c&&(r=zi(c.evaluate(this.context,"flow-priority"),0));let d=this.breakBeforeValues[n]||null,p=this.flows[e];if(!p){let t=this.boxStack.lastFlowName();p=this.flows[e]=new Io(e,t)}let f=new Ro(e,i,n,r,o,s,a,l,d);return this.flowChunks.push(f),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(f,p),f}registerForcedBreakOffset(e,t,i){if(to(e)){let e=this.flows[i].forcedBreakOffsets;(0===e.length||e[e.length-1]<t)&&e.push(t)}let n=this.breakBeforeValues[t];this.breakBeforeValues[t]=so(n,e)}styleUntil(e,t){let i,n=-1;if(e<=this.lastOffset&&(i=this.offsetMap.slippedByFixed(e),n=i+t,n<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n);if(null==this.last)return Number.POSITIVE_INFINITY;let r=this.context;for(;;){let o=this.last.firstChild;if(null==o)for(;;){if(1==this.last.nodeType){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let e=this.boxStack.pop(this.lastOffset),t=null;if(e.afterBox){let i=e.afterBox.getBreakValue("before");this.registerForcedBreakOffset(i,e.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(e):e.afterBox.offset,e.flowName),t=e.afterBox.getBreakValue("after")}t=so(t,e.getBreakValue("after")),this.registerForcedBreakOffset(t,this.lastOffset,e.flowName)}if(o=this.last.nextSibling,o)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(n):Number.POSITIVE_INFINITY}if(this.last=o,1!=this.last.nodeType)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let o=this.last,s=this.getAttrStyle(o);this.primaryStack.push(this.primary),this.cascade.pushElement(this,o,s,this.lastOffset);let a=o.getAttribute("id")||o.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");a&&a===this.idToReach&&(this.idToReach=null),!this.bodyReached&&"body"==o.localName&&o.parentNode==this.root&&(this.postprocessTopStyle(s,!0),this.bodyReached=!0);let l,h=s["flow-into"];if(h){let e=h.evaluate(r,"flow-into").toString(),t=this.encounteredFlowElement(e,s,o,this.lastOffset);this.primary=!!this.primaryFlows[e],l=this.boxStack.push(s,this.lastOffset,o===this.root,t)}else l=this.boxStack.push(s,this.lastOffset,o===this.root),o===this.xmldoc.body&&(l.breakBefore=so(l.flowChunk.breakBefore,l.breakBefore));let u=this.boxStack.nearestBlockStartOffset(l);if(0===u){let e=s.page,t=e&&!ci(e.value)&&e.value.toString();t&&"auto"!==t.toLowerCase()&&(this.cascade.firstPageType=t)}if(this.registerForcedBreakOffset(l.breakBefore,u,l.flowName),l.beforeBox){let e=l.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(e,l.beforeBox.atBlockStart?u:l.offset,l.flowName)}if(this.primary&&l.displayValue()===oi.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=s,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&0===u)continue;if(e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n)}}}getStyle(e,t){let i=this.xmldoc.getElementOffset(e),n=`e${i}`;return t&&(i=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=i&&this.styleUntil(i,0),this.styleMap[n]}processContent(e,t,i){}},yu=["column-count","column-width","column-fill"],xu=class{constructor(e){this.validator=e,l(this,"success",null),l(this,"failure",null),l(this,"code",0)}isSpecial(){return 0!=this.code}markAsStartGroup(){this.code=-1}isStartGroup(){return-1==this.code}markAsEndGroup(){this.code=-2}isEndGroup(){return-2==this.code}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},Su=class{constructor(e,t){this.where=e,this.success=t,l(this,"what",-1)}},Cu=class e{constructor(){l(this,"nodes",[]),l(this,"connections",[]),l(this,"match",[]),l(this,"nomatch",[]),l(this,"error",[]),l(this,"emptyHead",!0)}connect(e,t){for(let i=0;i<e.length;i++)this.connections[e[i]].what=t;e.splice(0,e.length)}clone(){let t=new e;for(let e=0;e<this.nodes.length;e++){let i=this.nodes[e],n=new xu(i.validator);n.code=i.code,t.nodes.push(n)}for(let e=0;e<this.connections.length;e++){let i=this.connections[e],n=new Su(i.where,i.success);n.what=i.what,t.connections.push(n)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(e,t,i){let n=this.nodes.length,r=new xu(Ru);i>=0?t?r.markAsStartAlternate(i):r.markAsEndAlternate(i):t?r.markAsStartGroup():r.markAsEndGroup(),this.nodes.push(r),this.connect(e,n);let o=new Su(n,!0),s=new Su(n,!1);e.push(this.connections.length),this.connections.push(s),e.push(this.connections.length),this.connections.push(o)}endSpecialGroup(){let e=[this.match,this.nomatch,this.error];for(let t=0;t<e.length;t++)this.addSpecialToArr(e[t],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(e){this.addSpecialToArr(this.match,!1,e)}startClause(e){if(this.nodes.length)throw new Error("invalid call");let t=new xu(Ru);t.markAsStartAlternate(e),this.nodes.push(t);let i=new Su(0,!0),n=new Su(0,!1);this.nomatch.push(this.connections.length),this.connections.push(n),this.match.push(this.connections.length),this.connections.push(i)}addPrimitive(e){let t=this.nodes.length;this.nodes.push(new xu(e));let i=new Su(t,!0),n=new Su(t,!1);this.connect(this.match,t),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(n),this.match.push(this.connections.length),this.connections.push(i)}isSimple(){return 1==this.nodes.length&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof Tu}addGroup(e,t){if(0==e.nodes.length)return;let i=this.nodes.length;if(4==t&&1==i&&e.isPrimitive()&&this.isPrimitive())return void(this.nodes[0].validator=this.nodes[0].validator.combine(e.nodes[0].validator));for(let t=0;t<e.nodes.length;t++)this.nodes.push(e.nodes[t]);4==t?(this.emptyHead=!0,this.connect(this.nomatch,i)):this.connect(this.match,i);let n=this.connections.length;for(let t=0;t<e.connections.length;t++){let n=e.connections[t];n.where+=i,n.what>=0&&(n.what+=i),this.connections.push(n)}for(let t=0;t<e.match.length;t++)this.match.push(e.match[t]+n);if(3==t&&this.connect(this.match,i),2==t||3==t)for(let t=0;t<e.nomatch.length;t++)this.match.push(e.nomatch[t]+n);else if(this.emptyHead){for(let t=0;t<e.nomatch.length;t++)this.nomatch.push(e.nomatch[t]+n);this.emptyHead=e.emptyHead}else for(let t=0;t<e.nomatch.length;t++)this.error.push(e.nomatch[t]+n);for(let t=0;t<e.error.length;t++)this.error.push(e.error[t]+n);e.nodes=null,e.connections=null}finish(e,t){let i=this.nodes.length;this.nodes.push(e),this.nodes.push(t),this.connect(this.match,i),this.connect(this.nomatch,i+1),this.connect(this.error,i+1);for(let e of this.connections)e.success?this.nodes[e.where].success=this.nodes[e.what]:this.nodes[e.where].failure=this.nodes[e.what];for(let e=0;e<i;e++)if(null==this.nodes[e].failure||null==this.nodes[e].success)throw new Error("Invalid validator state");return this.nodes[0]}},ku=256,Eu=512,Pu=1024,Nu=class extends Ot{constructor(){super()}validateForShorthand(e,t){let i=e[t].visit(this);return i?[i]:null}},Tu=class e extends Nu{constructor(e,t,i){super(),this.allowed=e,this.idents=t,this.units=i}visitEmpty(e){return 1&this.allowed?e:null}visitSlash(e){return 2048&this.allowed?e:null}visitStr(e){return 2&this.allowed?e:null}visitIdent(e){return this.idents[e.name.toLowerCase()]||(4&this.allowed||64&this.allowed&&CSS.supports("color",e.name)?e:null)}visitNumeric(e){return 0!=e.num||this.allowed&Eu?e.num<0&&!(this.allowed&ku)?null:this.units[e.unit]?e:null:"%"==e.unit&&this.allowed&Pu?e:null}visitNum(e){return 0==e.num?this.allowed&Eu?e:null:e.num<=0&&!(this.allowed&ku)?null:16&this.allowed?e:null}visitInt(e){if(0==e.num)return this.allowed&Eu?e:null;if(e.num<=0&&!(this.allowed&ku))return null;if(48&this.allowed)return e;return this.idents[`${e.num}`]||null}visitHexColor(e){return 64&this.allowed&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(e.hex)?e:null}visitURL(e){return 128&this.allowed?e:null}visitURange(e){return 4096&this.allowed?e:null}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return 64&this.allowed&&CSS.supports("color",e.toString())||8192&this.allowed&&CSS.supports("background-image",e.toString())||"calc"===e.name&&1848&this.allowed?e:null}visitExpr(e){return 2046&this.allowed?e:null}combine(t){let i={},n={};for(let e in this.idents)i[e]=this.idents[e];for(let e in t.idents)i[e]=t.idents[e];for(let e in this.units)n[e]=this.units[e];for(let e in t.units)n[e]=t.units[e];return new e(this.allowed|t.allowed,i,n)}},Iu={},Ru=new Tu(0,Iu,Iu),_u=class extends Nu{constructor(e){super(),l(this,"successTerminal"),l(this,"failureTerminal"),l(this,"first"),this.successTerminal=new xu(null),this.failureTerminal=new xu(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,i){let n=t?[]:e,r=this.first,o=i,s=null,a=null;for(;r!==this.successTerminal&&r!==this.failureTerminal;){if(o>=e.length){r=r.failure;continue}let l=e[o],h=l;if(r.isSpecial()){let e=!0;r.isStartGroup()?(s?s.push(a):s=[a],a=[]):r.isEndGroup()?a=s.length>0?s.pop():null:r.isEndAlternate()?a[r.getAlternate()]="taken":e=null==a[r.getAlternate()],r=e?r.success:r.failure}else{if(0==o&&!t&&r.validator instanceof Au&&this instanceof Au){if(h=new Jt(e).visit(r.validator),h){o=e.length,r=r.success;continue}}else if(0==o&&!t&&r.validator instanceof Lu&&this instanceof Au){if(h=new Qt(e).visit(r.validator),h){o=e.length,r=r.success;continue}}else h=l.visit(r.validator);if(!h){r=r.failure;continue}if(h!==l&&e===n){n=[];for(let t=0;t<o;t++)n[t]=e[t]}e!==n&&(n[o-i]=h),o++,r=r.success}}return r===this.successTerminal&&(t?n.length>0:o==e.length)?n:null}validateSingle(e){let t=null,i=this.first;for(;i!==this.successTerminal&&i!==this.failureTerminal;)e?i.isSpecial()?i=i.success:(t=e.visit(i.validator),t?(e=null,i=i.success):i=i.failure):i=i.failure;return i===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},Au=class extends _u{constructor(e){super(e)}visitSpaceList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Jt(t):null}visitCommaList(e){let t=this.first,i=!1;for(;t;){if(t.validator instanceof Lu){i=!0;break}t=t.failure}if(i){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Qt(t):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}},Lu=class extends _u{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Qt(t):null}validateForShorthand(e,t){let i,n=this.first;for(;n!==this.failureTerminal;){if(i=n.validator.validateForShorthand(e,t),i)return i;n=n.failure}return null}},Ou=class extends _u{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new ei(e.name,t):null}},Fu=class{tryParse(e,t,i){return t}success(e,t){}},Bu=class extends Fu{constructor(e,t){super(),this.name=t,l(this,"validator"),this.validator=e.validators[this.name]}tryParse(e,t,i){if(i.values[this.name])return t;let n=this.validator.validateForShorthand(e,t);if(n){let e=n.length,r=e>1?new Jt(n):n[0];return this.success(r,i),t+e}return t}success(e,t){t.values[this.name]=e}},Mu=class extends Bu{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let i=0;i<this.names.length;i++)t.values[this.names[i]]=e}},zu=class extends Fu{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,i){let n=t;if(this.slash){if(e[t]!=Vt)return n;if(++t==e.length)return n}let r=this.nodes[0].tryParse(e,t,i);if(r==t)return n;t=r;for(let n=1;n<this.nodes.length&&t<e.length&&(r=this.nodes[n].tryParse(e,t,i),r!=t);n++)t=r;return t}},Du=class extends Ot{constructor(){super(...arguments),l(this,"syntax",null),l(this,"propList",null),l(this,"error",!1),l(this,"values",{}),l(this,"validatorSet",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new Bu(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){var i,n;if(!this.error){for(let r of this.propList)t.simpleProperty(r,null!=(n=null!=(i=this.values[r])?i:this.validatorSet.defaultValues[r])?n:oi.initial,e);return!0}return!1}propagateDefaultingValue(e,t,i){for(let n of this.propList)i.simpleProperty(n,e,t)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},Vu=class extends Du{constructor(){super()}validateList(e){let t=0,i=0;for(;t<e.length;){let n=this.syntax[i].tryParse(e,t,this);if(n>t)t=n,i=0;else if(++i==this.syntax.length){this.error=!0;break}}return t}},Uu=class extends Du{constructor(){super()}validateList(e){if(e.length>this.syntax.length||0==e.length)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let i=t;for(;i>=e.length;)i=1==i?0:i-2;if(this.syntax[t].tryParse(e,i,this)!=i+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new Mu(this.validatorSet,this.propList)}},Hu=["unicode-bidi","direction","margin-block-start","margin-block-end","margin-inline-start","margin-inline-end","padding-block-start","padding-block-end","padding-inline-start","padding-inline-end","border-block-start-color","border-block-end-color","border-inline-start-color","border-inline-end-color","border-block-start-style","border-block-end-style","border-inline-start-style","border-inline-end-style","border-block-start-width","border-block-end-width","border-inline-start-width","border-inline-end-width","block-start","block-end","inline-start","inline-end","block-size","inline-size","max-block-size","max-inline-size","min-block-size","min-inline-size","behavior","bleed","conflicting-partitions","crop-offset","crop-marks-line-color","enabled","flow-consume","flow-from","flow-into","flow-linger","flow-options","flow-priority","font-display","font-size-adjust","font-stretch_css3","font-variant_css2","glyph-orientation-vertical","marks","min-page-height","min-page-width","repeat-on-break","required","required-partitions","ruby-align","shape-inside","snap-height","snap-width","template","text-decoration-skip","text-justify","text-zoom","unicode-range","utilization","wrap-flow"],$u={SIMPLE:Vu,INSETS:Uu,INSETS_SLASH:class extends Du{constructor(){super()}validateList(e){let t=e.length;for(let i=0;i<e.length;i++)if(e[i]===Vt){t=i;break}if(t>this.syntax.length||0==e.length)return this.error=!0,0;for(let i=0;i<this.syntax.length;i++){let n,r=i;for(;r>=t;)r=1==r?0:r-2;if(t+1<e.length)for(n=t+i+1;n>=e.length;)n-=n==t+2?1:2;else n=r;let o=[e[r],e[n]];if(2!=this.syntax[i].tryParse(o,0,this))return this.error=!0,0}return e.length}},COMMA:class extends Vu{constructor(){super()}mergeIn(e,t){var i,n;for(let r of this.propList){let o=null!=(n=null!=(i=t[r])?i:this.validatorSet.defaultValues[r])?n:oi.initial,s=e[r];s||(s=[],e[r]=s),s.push(o)}}visitCommaList(e){let t={};for(let i=0;i<e.values.length;i++)if(this.values={},e.values[i]instanceof Qt?this.error=!0:(e.values[i].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&i!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let e in t)this.values[e]="background-color"==e?t[e].pop():new Qt(t[e]);return null}},FONT:class extends Vu{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size","font-stretch","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian")}validateList(e){let t=super.validateList(e),i=this.values["font-variant_css2"];i&&(delete this.values["font-variant_css2"],this.values["font-variant-caps"]=i);let n=this.values["font-stretch_css3"];if(n&&(delete this.values["font-stretch_css3"],this.values["font-stretch"]=n),t+2>e.length)return this.error=!0,t;this.error=!1;let r=this.validatorSet.validators;if(!e[t].visit(r["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===Vt){if(t++,t+2>e.length)return this.error=!0,t;if(!e[t].visit(r["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}let o=t==e.length-1?e[t]:new Jt(e.slice(t,e.length));return o.visit(r["font-family"])?(this.values["font-family"]=o,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;let t=[this.values["font-family"]];for(let i=1;i<e.values.length;i++)t.push(e.values[i]);let i=new Qt(t);return i.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=i:this.error=!0,null}visitIdent(e){let t=this.validatorSet.systemFonts[e.name];if(t)for(let e in t)this.values[e]=t[e];else this.error=!0;return null}},TEXT_SPACING:class extends Vu{validateList(e){if(1===e.length&&e[0]instanceof $t)switch(e[0].name.toLowerCase()){case"normal":e=[this.validatorSet.defaultValues["text-autospace"],this.validatorSet.defaultValues["text-spacing-trim"]];break;case"auto":e=[oi.auto,oi.auto];break;case"none":e=[jt("no-autospace"),jt("space-all")]}return super.validateList(e)}},ALL:class extends Vu{constructor(){super()}init(e,t){super.init(e,t);for(let e in this.validatorSet.validators)Hu.includes(e)||this.propList.push(e)}validateList(e){return this.error=!0,0}}},ju=class{constructor(){l(this,"validators",{}),l(this,"prefixes",{}),l(this,"defaultValues",{}),l(this,"namedValidators",{}),l(this,"systemFonts",{}),l(this,"shorthands",{}),l(this,"layoutProps",{}),l(this,"backgroundProps",{})}addReplacement(e,t){let i;if(3==t.type)i=new Wt(t.num,t.text);else if(7==t.type)i=new Xt(t.text);else{if(1!=t.type)throw new Error("unexpected replacement");i=jt(t.text)}if(e.isPrimitive()){let t=e.nodes[0].validator.idents;for(let e in t)t[e]=i;return e}throw new Error("unexpected replacement")}newGroup(e,t){let i=new Cu;if("||"==e){for(let e=0;e<t.length;e++){let n=new Cu;n.startClause(e),n.addGroup(t[e],1),n.endClause(e),i.addGroup(n,0==e?1:4)}let e=new Cu;return e.startSpecialGroup(),e.addGroup(i,3),e.endSpecialGroup(),e}{let n;switch(e){case" ":n=1;break;case"|":case"||":n=4;break;default:throw new Error("unexpected op")}for(let e=0;e<t.length;e++)i.addGroup(t[e],0==e?1:n);return i}}addCounts(e,t,i){let n=new Cu;for(let i=0;i<t;i++)n.addGroup(e.clone(),1);if(i==Number.POSITIVE_INFINITY)n.addGroup(e,3);else for(let r=t;r<i;r++)n.addGroup(e.clone(),2);return n}primitive(e){let t=new Cu;return t.addPrimitive(e),t}newFunc(e,t){let i;switch(e){case"COMMA":i=new Lu(t);break;case"SPACE":i=new Au(t);break;default:i=new Ou(e.toLowerCase(),t)}return this.primitive(i)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new Tu(64,Iu,Iu)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new Tu(8192,Iu,Iu)),this.namedValidators.POS_INT=this.primitive(new Tu(32,Iu,Iu)),this.namedValidators.POS_NUM=this.primitive(new Tu(16,Iu,Iu)),this.namedValidators.POS_PERCENTAGE=this.primitive(new Tu(8,Iu,{"%":zt})),this.namedValidators.NEGATIVE=this.primitive(new Tu(ku,Iu,Iu)),this.namedValidators.ZERO=this.primitive(new Tu(Eu,Iu,Iu)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new Tu(Pu,Iu,Iu)),this.namedValidators.POS_LENGTH=this.primitive(new Tu(8,Iu,{em:zt,ex:zt,ch:zt,rem:zt,lh:zt,rlh:zt,vw:zt,vh:zt,vi:zt,vb:zt,vmin:zt,vmax:zt,pvw:zt,pvh:zt,pvi:zt,pvb:zt,pvmin:zt,pvmax:zt,cm:zt,mm:zt,in:zt,px:zt,pt:zt,pc:zt,q:zt})),this.namedValidators.POS_ANGLE=this.primitive(new Tu(8,Iu,{deg:zt,grad:zt,rad:zt,turn:zt})),this.namedValidators.POS_TIME=this.primitive(new Tu(8,Iu,{s:zt,ms:zt})),this.namedValidators.FREQUENCY=this.primitive(new Tu(8,Iu,{Hz:zt,kHz:zt})),this.namedValidators.RESOLUTION=this.primitive(new Tu(8,Iu,{dpi:zt,dpcm:zt,dppx:zt})),this.namedValidators.URI=this.primitive(new Tu(128,Iu,Iu)),this.namedValidators.URANGE=this.primitive(new Tu(4096,Iu,Iu)),this.namedValidators.IDENT=this.primitive(new Tu(4,Iu,Iu)),this.namedValidators.STRING=this.primitive(new Tu(2,Iu,Iu)),this.namedValidators.SLASH=this.primitive(new Tu(2048,Iu,Iu));let e={"font-family":jt("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let i=e.token();if(0==i.type)return null;let n={"":!0};if(14==i.type){do{if(e.consume(),i=e.token(),1!=i.type)throw new Error("Prefix name expected");n[i.text]=!0,e.consume(),i=e.token()}while(16==i.type);if(15!=i.type)throw new Error("']' expected");e.consume(),i=e.token()}if(1!=i.type)throw new Error("Property name expected");if(2==t?"SHORTHANDS"==i.text:"DEFAULTS"==i.text)return e.consume(),null;let r=i.text;if(e.consume(),2!=t){if(39!=e.token().type)throw new Error("'=' expected");this.isBuiltIn(r)||(this.prefixes[r]=n)}else if(18!=e.token().type)throw new Error("':' expected");return r}parseValidators(e){for(;;){let t=this.readNameAndPrefixes(e,1);if(!t)return;let i,n=[],r=[],o="",s=!0,a=()=>{if(0==n.length)throw new Error("No values");return 1==n.length?n[0]:this.newGroup(o,n)},l=e=>{if(s)throw new Error(`'${e}': unexpected`);if(o&&o!=e)throw new Error(`mixed operators: '${e}' and '${o}'`);o=e,s=!0},h=null;for(;!h;){e.consume();let t=e.token();switch(t.type){case 1:if(s||l(" "),this.isBuiltIn(t.text)){let e=this.namedValidators[t.text];if(!e)throw new Error(`'${t.text}' unexpected`);n.push(e.clone())}else{let e={};e[t.text.toLowerCase()]=jt(t.text),n.push(this.primitive(new Tu(0,e,Iu)))}s=!1;break;case 5:{let e={};e[`${t.num}`]=new qt(t.num),n.push(this.primitive(new Tu(0,e,Iu))),s=!1;break}case 34:l("|");break;case 25:l("||");break;case 14:s||l(" "),r.push({vals:n,op:o,b:"["}),o="",n=[],s=!0;break;case 6:s||l(" "),r.push({vals:n,op:o,b:"(",fn:t.text}),o="",n=[],s=!0;break;case 15:{i=a();let e=r.pop();if("["!=e.b)throw new Error("']' unexpected");n=e.vals,n.push(i),o=e.op,s=!1;break}case 11:{i=a();let e=r.pop();if("("!=e.b)throw new Error("')' unexpected");n=e.vals,n.push(this.newFunc(e.fn,i)),o=e.op,s=!1;break}case 18:if(s)throw new Error("':' unexpected");e.consume(),n.push(this.addReplacement(n.pop(),e.token()));break;case 22:if(s)throw new Error("'?' unexpected");n.push(this.addCounts(n.pop(),0,1));break;case 36:if(s)throw new Error("'*' unexpected");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(s)throw new Error("'+' unexpected");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(e.consume(),t=e.token(),5!=t.type)throw new Error("<int> expected");let i=t.num,r=i;if(e.consume(),t=e.token(),16==t.type){if(e.consume(),t=e.token(),5!=t.type)throw new Error("<int> expected");r=t.num,e.consume(),t=e.token()}if(13!=t.type)throw new Error("'}' expected");n.push(this.addCounts(n.pop(),i,r));break}case 17:if(h=a(),r.length>0)throw new Error(`unclosed '${r.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=h:h.isSimple()?this.validators[t]=h.nodes[0].validator:this.validators[t]=new Au(h)}}parseDefaults(e){for(;;){let t=this.readNameAndPrefixes(e,2);if(!t)return;let i=[];for(;;){e.consume();let t=e.token();if(17==t.type){e.consume();break}switch(t.type){case 1:i.push(jt(t.text));break;case 4:i.push(new Gt(t.num));break;case 5:i.push(new qt(t.num));break;case 3:i.push(new Wt(t.num,t.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=i.length>1?new Jt(i):i[0]}}parseShorthands(e){for(;;){let t=this.readNameAndPrefixes(e,3);if(!t)return;let i,n=e.nthToken(1);1==n.type&&$u[n.text]?(i=new $u[n.text],e.consume()):i=new Vu,i.setOwner(this);let r=!1,o=[],s=!1,a=[],l=[];for(;!r;)switch(e.consume(),n=e.token(),n.type){case 1:if(this.validators[n.text])o.push(i.syntaxNodeForProperty(n.text)),n.text.includes("_")||l.push(n.text);else{if(!(this.shorthands[n.text]instanceof Uu))throw new Error(`'${n.text}' is neither a simple property nor an inset shorthand`);{let e=this.shorthands[n.text];o.push(e.createSyntaxNode()),l.push(...e.propList)}}break;case 19:if(o.length>0||s)throw new Error("unexpected slash");s=!0;break;case 14:a.push({slash:s,syntax:o}),o=[],s=!1;break;case 15:{let e=new zu(o,s),t=a.pop();o=t.syntax,s=t.slash,o.push(e);break}case 17:r=!0,e.consume();break;default:throw new Error("unexpected token")}i.init(o,l),this.shorthands[t]=i}}parse(e){let t=new Ln(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){var t;let i={};for(let n of e){let e=this.shorthands[n],r=e?e.propList:[n];for(let e of r)i[e]=null!=(t=this.defaultValues[e])?t:oi.initial}return i}validatePropertyAndHandleShorthand(e,t,i,n){if(pi(e)||"font-face"===n.ruleType||function(e){let t=new Gu;return e.visit(t),t.varFound}(t))return void n.simpleProperty(e,t,i);let r="",o=e,s=(e=e.toLowerCase()).match(/^-([a-z]+)-([-a-z0-9]+)$/);s&&(r=s[1],e=s[2]);let a=this.prefixes[e];if(!a||!a[r])return void(CSS.supports(o,t.toString())?n.simpleProperty(o,t,i):r&&!te.includes(`-${r}-`)||n.unknownProperty(o,t));let l=this.validators[e];if(l){let s=ci(t)||t.isExpr()?t:t.visit(l);s?n.simpleProperty(e,s,i):!r&&CSS.supports(e,t.toString())?n.simpleProperty(e,t,i):n.invalidPropertyValue(o,t)}else{let r=this.shorthands[e].clone();ci(t)?r.propagateDefaultingValue(t,i,n):(t.visit(r),r.finish(i,n)||n.invalidPropertyValue(o,t))}}};function Wu(){let e=new ju;return e.initBuiltInValidators(),e.parse(Qn),e}var Gu=class extends Ot{constructor(){super(...arguments),l(this,"varFound",!1)}visitFunc(e){return"var"===e.name?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function qu(e){return Object.keys(e).filter((e=>!["src","font-family","font-display"].includes(e))).sort()}function Xu(e,t){let i={};for(let n in e)i[n]=ua(e,n).evaluate(t,n);return i}(new Date).valueOf();var Yu=class{constructor(e){this.properties=e,l(this,"fontTraitKey"),l(this,"src"),l(this,"blobURLs",[]),l(this,"blobs",[]),l(this,"family"),this.fontTraitKey=function(e){let t=new le;for(let i of qu(e))t.append(`${i}:${e[i].toString()};`);return t.toString()}(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){let i=new le;i.append("@font-face {\n  font-family: "),i.append(this.family),i.append(";\n  ");for(let e of qu(this.properties))i.append(e),i.append(": "),this.properties[e].appendTo(i,!0),i.append(";\n  ");if(t){i.append('src: url("');let e=function(e){return URL.createObjectURL(e)}(t);i.append(e),this.blobURLs.push(e),this.blobs.push(t),i.append('")')}else i.append("src: "),i.append(e);return i.append(";\n}\n"),i.toString()}},Ku=class{constructor(e){this.deobfuscator=e,l(this,"familyMap",{})}registerFamily(e,t){let i=e.family,n=this.familyMap[i],r=t.family;if(n){if(n!=r)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[i]=r}filterFontFamily(e){if(e instanceof Qt){let t=e.values,i=[];for(let e of t){let t=this.familyMap[e.stringValue()];t&&i.push(jt(t)),i.push(e)}return new Qt(i)}{let t=this.familyMap[e.stringValue()];return t?new Qt([jt(t),e]):e}}},Zu=class{constructor(e,t,i){this.head=e,this.body=t,l(this,"srcURLMap",{}),l(this,"familyPrefix"),l(this,"familyCounter",0),this.familyPrefix=i||"Fnt_"}getViewFontFamily(e,t){let i=e.family,n=t.familyMap[i];return n||(n=this.familyPrefix+ ++this.familyCounter,t.familyMap[i]=n,n)}initFont(e,t,i){let n=Mn("initFont"),r=e.src,o={};for(let t of qu(e.properties))o[t]=e.properties[t];let s=this.getViewFontFamily(e,i);o["font-family"]=jt(s);let a=new Yu(o),l=this.head.ownerDocument.createElement("style");return l.textContent=a.makeAtRule(r,t),this.head.appendChild(l),P.debug("Load font:",r),n.finish(a),n.result()}loadFont(e,t){let i=e.src,n=e.family+";"+i,r=this.srcURLMap[n];return r?r.piggyback((n=>{let r=n;r.traitsEqual(e)?(t.registerFamily(e,r),P.debug("Found already-loaded font:",i)):P.warn("E_FONT_FACE_INCOMPATIBLE",e.src)})):(r=new Yn((()=>{let n=Mn("loadFont"),r=i.replace(/^url\("([^"]+)"\).*$/,"$1"),o=t.deobfuscator?t.deobfuscator(r):null;return o?or(r,"blob").then((i=>{i.responseBlob?o(i.responseBlob).then((i=>{this.initFont(e,i,t).thenFinish(n)})):n.finish(null)})):this.initFont(e,null,t).thenFinish(n),n.result()}),`loadFont ${i}`),this.srcURLMap[n]=r,r.start()),r}findOrLoadFonts(e,t){let i=[];for(let n of e)n.src&&n.family?i.push(this.loadFont(n,t)):P.warn("E_FONT_FACE_INVALID");return Kn(i).thenAsync((()=>this.waitFontLoading()))}waitFontLoading(){let e=this.head.ownerDocument.fonts,t=0;if(e.forEach((e=>{"unloaded"===e.status&&(t++,e.load().catch((e=>{})))})),0===t)return zn(!0);let i=Mn("waitFontLoading");return i.loop((()=>i.sleep(20).thenAsync((()=>"loading"===e.status?zn(!0):zn(!1))))).thenFinish(i),i.result()}},Ju=1,Qu=class{constructor(e,t,i,n,r){this.name=t,this.pseudoName=i,this.classes=n,this.parent=r,l(this,"specified",{}),l(this,"children",[]),l(this,"pageMaster",null),l(this,"index",0),l(this,"key"),l(this,"_scope"),this._scope=e,this.key="p"+Ju++,r&&(this.index=r.children.length,r.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){let t=this.specified,i=e.specified;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}},ec=class extends Qu{constructor(e){super(e,null,null,[],null),this.specified.width=new ta(ai,0),this.specified.height=new ta(li,0)}},tc=class extends He{constructor(e,t){super(e,(function(e,t){let n=e.match(/^([^.]+)\.([^.]+)$/);if(n){let e=i.pageMaster.keyMap[n[1]];if(e){let i=this.lookupInstance(e);if(i)return t?i.resolveFunc(n[2]):i.resolveName(n[2])}}return null})),this.pageMaster=t;let i=this}},ic=class e extends Qu{constructor(e,t,i,n,r,o,s){super(e,t,i,n,r),this.condition=o,this.specificity=s,l(this,"keyMap",{}),e instanceof tc||(this._scope=new tc(e,this)),this.pageMaster=this,this.specified.width=new ta(ai,0),this.specified.height=new ta(li,0),this.specified["wrap-flow"]=new ta(oi.auto,0),this.specified.position=new ta(oi.relative,0),this.specified.overflow=new ta(oi.visible,0)}createInstance(e){return new vc(e,this)}clone(t){let i=new e(this.scope,this.name,t.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(i),this.cloneChildren(i),i}resetScope(){this.scope.pageMaster=this}},nc=class e extends Qu{constructor(e,t,i,n,r){super(e,t,i,n,r),this.pageMaster=r.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key),this.specified["wrap-flow"]=new ta(oi.auto,0)}createInstance(e){return new wc(e,this)}clone(t){let i=new e(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}},rc=class e extends Qu{constructor(e,t,i,n,r){super(e,t,i,n,r),this.pageMaster=r.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key)}createInstance(e){return new yc(e,this)}clone(t){let i=new e(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}};function oc(e,t,i){return!t||t===oi.auto||ci(t)?null:t.toExpr(e,i)}function sc(e,t,i){return!t||t===oi.auto||ci(t)?e.zero:t.toExpr(e,i)}function ac(e,t,i){return!t||ci(t)?e.zero:t===oi.auto?null:t.toExpr(e,i)}function lc(e,t,i,n){return!t||i===oi.none||ci(t)?e.zero:t.toExpr(e,n)}function hc(e,t,i){return!t||ci(t)?i:t===oi._true?e._true:t===oi._false?e._false:t.toExpr(e,e.zero)}var uc=class{constructor(e,t){this.parentInstance=e,this.pageBox=t,l(this,"cascaded",{}),l(this,"style",{}),l(this,"autoWidth",null),l(this,"autoHeight",null),l(this,"children",[]),l(this,"isAutoWidth",!1),l(this,"isAutoHeight",!1),l(this,"isTopDependentOnAutoHeight",!1),l(this,"isRightDependentOnAutoWidth",!1),l(this,"calculatedWidth",0),l(this,"calculatedHeight",0),l(this,"pageMasterInstance",null),l(this,"namedValues",{}),l(this,"namedFuncs",{}),l(this,"vertical",!1),l(this,"rtl",!1),l(this,"suppressEmptyBoxGeneration",!1),e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){let i=this.resolveName(e),n=this.resolveName(t);if(!i||!n)throw new Error("E_INTERNAL");return Rt(this.pageBox.scope,i,n)}resolveName(e){let t=this.namedValues[e];if(t)return t;let i=this.style[e];switch(i&&(t=i.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height")}if(!t){let i;if("extent"==e)i=this.vertical?"width":"height";else if("measure"==e)i=this.vertical?"height":"width";else{let t=this.vertical?Zs:Js;i=e;for(let e in t)i=i.replace(e,t[e])}i!=e&&(t=this.resolveName(i))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{let e=this.pageBox.scope,i=new Tt(e,0),n=this.resolveName("column-count"),r=this.resolveName("column-width"),o=this.resolveName("column-gap");t=_t(e,At(e,new Ct(e,"min",[i,n]),Rt(e,r,o)),o);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){let e=this.pageBox.scope,t=this.style,i=hc(e,t.enabled,e._true),n=oc(e,t.page,e.zero);if(n){let t=new yt(e,"page-number");i=It(e,i,new dt(e,n,t))}let r=oc(e,t["min-page-width"],e.zero);r&&(i=It(e,i,new ct(e,new yt(e,"page-width"),r)));let o=oc(e,t["min-page-height"],e.zero);o&&(i=It(e,i,new ct(e,new yt(e,"page-height"),o))),i=this.boxSpecificEnabled(i),t.enabled=new ti(i)}boxSpecificEnabled(e){return e}initHorizontal(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=oc(e,t.left,i),r=oc(e,t["margin-left"],i),o=lc(e,t["border-left-width"],t["border-left-style"],i),s=sc(e,t["padding-left"],i),a=oc(e,t.width,i),l=oc(e,t["max-width"],i),h=sc(e,t["padding-right"],i),u=lc(e,t["border-right-width"],t["border-right-style"],i),c=oc(e,t["margin-right"],i),d=oc(e,t.right,i),p=Rt(e,o,s),f=Rt(e,o,h);if(n&&d&&a){let t=_t(e,i,Rt(e,a,Rt(e,Rt(e,n,p),f)));r?c?d=_t(e,t,c):c=_t(e,t,Rt(e,d,r)):(t=_t(e,t,d),c?r=_t(e,t,c):(r=At(e,t,new Et(e,.5)),c=r))}else{r||(r=e.zero),c||(c=e.zero),!n&&!d&&!a&&(n=e.zero),n||a?n||d?!a&&!d&&(a=this.autoWidth,this.isAutoWidth=!0):n=e.zero:(a=this.autoWidth,this.isAutoWidth=!0);let o=_t(e,i,Rt(e,Rt(e,r,p),Rt(e,c,f)));this.isAutoWidth&&(l||(l=_t(e,o,n||d)),!this.vertical&&(oc(e,t["column-width"],null)||oc(e,t["column-count"],null))&&(a=l,this.isAutoWidth=!1)),n?a?d||(d=_t(e,o,Rt(e,n,a))):a=_t(e,o,Rt(e,n,d)):n=_t(e,o,Rt(e,d,a))}let g=sc(e,t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),i);t.left=new ti(n),t["margin-left"]=new ti(r),t["border-left-width"]=new ti(o),t["padding-left"]=new ti(s),t.width=new ti(a),t["max-width"]=new ti(l||a),t["padding-right"]=new ti(h),t["border-right-width"]=new ti(u),t["margin-right"]=new ti(c),t.right=new ti(d),t["snap-width"]=new ti(g)}initVertical(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null,r=oc(e,t.top,n),o=oc(e,t["margin-top"],i),s=lc(e,t["border-top-width"],t["border-top-style"],i),a=sc(e,t["padding-top"],i),l=oc(e,t.height,n),h=oc(e,t["max-height"],n),u=sc(e,t["padding-bottom"],i),c=lc(e,t["border-bottom-width"],t["border-bottom-style"],i),d=oc(e,t["margin-bottom"],i),p=oc(e,t.bottom,n),f=Rt(e,s,a),g=Rt(e,c,u);if(r&&p&&l){let t=_t(e,n,Rt(e,l,Rt(e,Rt(e,r,f),g)));o?d?p=_t(e,t,o):d=_t(e,t,Rt(e,p,o)):(t=_t(e,t,p),d?o=_t(e,t,d):(o=At(e,t,new Et(e,.5)),d=o))}else{o||(o=e.zero),d||(d=e.zero),!r&&!p&&!l&&(r=e.zero),r||l?r||p?!l&&!p&&(l=this.autoHeight,this.isAutoHeight=!0):r=e.zero:(l=this.autoHeight,this.isAutoHeight=!0);let i=_t(e,n,Rt(e,Rt(e,o,f),Rt(e,d,g)));this.isAutoHeight&&(h||(h=_t(e,i,r||p)),this.vertical&&(oc(e,t["column-width"],null)||oc(e,t["column-count"],null))&&(l=h,this.isAutoHeight=!1)),r?l?p||(p=_t(e,i,Rt(e,r,l))):l=_t(e,i,Rt(e,p,r)):r=_t(e,i,Rt(e,p,l))}let m=sc(e,t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),i);t.top=new ti(r),t["margin-top"]=new ti(o),t["border-top-width"]=new ti(s),t["padding-top"]=new ti(a),t.height=new ti(l),t["max-height"]=new ti(h||l),t["padding-bottom"]=new ti(u),t["border-bottom-width"]=new ti(c),t["margin-bottom"]=new ti(d),t.bottom=new ti(p),t["snap-height"]=new ti(m)}initColumns(){let e=this.pageBox.scope,t=this.style,i=oc(e,t[this.vertical?"height":"width"],null),n=oc(e,t["column-width"],i),r=oc(e,t["column-count"],null),o=function(e,t,i){return!t||t===oi.normal||ci(t)?null:t.toExpr(e,i)}(e,t["column-gap"],null);o||(o=new wt(e,1,"em")),n&&!r&&(r=new Ct(e,"floor",[Lt(e,Rt(e,i,o),Rt(e,n,o))]),r=new Ct(e,"max",[e.one,r])),r||(r=e.one),n=_t(e,Lt(e,Rt(e,i,o),r),o),t["column-width"]=new ti(n),t["column-count"]=new ti(r),t["column-gap"]=new ti(o)}depends(e,t,i){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,i)}init(e){e.registerInstance(this.pageBox.key,this);let t=this.pageBox.scope,i=this.style,n=this.parentInstance?this.parentInstance.getActiveRegions(e):null,r=Ml(this.cascaded,e,n,!1);this.vertical=Fl(r,e,!!this.parentInstance&&this.parentInstance.vertical),this.rtl=Bl(r,e,!!this.parentInstance&&this.parentInstance.rtl),Vl(r,i,this.vertical,this.rtl,((e,t)=>t.value)),this.autoWidth=new St(t,(()=>this.calculatedWidth),"autoWidth"),this.autoHeight=new St(t,(()=>this.calculatedHeight),"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){var i,n;let r=this.style[t];return!r&&ha(t)&&(r="font-size"===t&&e.isRelativeRootFontSize&&e.rootFontSize?new Wt(e.rootFontSize,"px"):null==(n=(null==(i=e.styler)?void 0:i.rootStyle)[t])?void 0:n.value),r&&(r=$l(e,r,t)),r}getPropAsNumber(e,t){var i,n;let r=this.style[t];if(r){let o=/\b(height|top|bottom)\b/.test(t)?null!=(i=e.pageAreaHeight)?i:e.pageHeight():null!=(n=e.pageAreaWidth)?n:e.pageWidth();r=$l(e,r,t,o)}return ni(r,e)}getSpecial(e,t){let i=ga(this.cascaded,t);if(i){let t=[];for(let n=0;n<i.length;n++){let r=i[n].evaluate(e,"");r&&r!==zt&&t.push(r)}if(t.length)return t}return null}getActiveRegions(e){let t=this.getSpecial(e,"region-id");if(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i].toString();return e}return null}propagateProperty(e,t,i,n){this.propagatePropertyToElement(e,t.element,i,n)}propagatePropertyToElement(e,t,i,n){let r=this.getProp(e,i);r&&(r.isNumeric()&&We(r.unit)&&(r=ri(r,e)),"font-family"===i&&(r=n.filterFontFamily(r)),(i.startsWith("background")||"z-index"===i)&&t.parentElement.hasAttribute("data-vivliostyle-bleed-box")&&(t=t.parentElement),oe(t,i,r.toString()))}propagateDelayedProperty(e,t,i,n){let r=this.getProp(e,i);r&&n.push(new yo(t.element,i,r))}assignLeftPosition(e,t){let i=this.getPropAsNumber(e,"left"),n=this.getPropAsNumber(e,"margin-left"),r=this.getPropAsNumber(e,"padding-left"),o=this.getPropAsNumber(e,"border-left-width"),s=this.getPropAsNumber(e,"width");t.setHorizontalPosition(i,s),oe(t.element,"margin-left",`${n}px`),oe(t.element,"padding-left",`${r}px`),oe(t.element,"border-left-width",`${o}px`),t.marginLeft=n,t.borderLeft=o,t.paddingLeft=r}assignRightPosition(e,t){let i=this.getPropAsNumber(e,"right"),n=this.getPropAsNumber(e,"snap-height"),r=this.getPropAsNumber(e,"margin-right"),o=this.getPropAsNumber(e,"padding-right"),s=this.getPropAsNumber(e,"border-right-width");if(oe(t.element,"margin-right",`${r}px`),oe(t.element,"padding-right",`${o}px`),oe(t.element,"border-right-width",`${s}px`),t.marginRight=r,t.borderRight=s,this.vertical&&n>0){let e=i+t.getInsetRight(),r=e-Math.floor(e/n)*n;r>0&&(t.snapOffsetX=n-r,o+=t.snapOffsetX)}t.paddingRight=o,t.snapWidth=n}assignTopPosition(e,t){let i=this.getPropAsNumber(e,"snap-height"),n=this.getPropAsNumber(e,"top"),r=this.getPropAsNumber(e,"margin-top"),o=this.getPropAsNumber(e,"padding-top"),s=this.getPropAsNumber(e,"border-top-width");if(t.top=n,t.marginTop=r,t.borderTop=s,t.snapHeight=i,!this.vertical&&i>0){let e=n+t.getInsetTop(),r=e-Math.floor(e/i)*i;r>0&&(t.snapOffsetY=i-r,o+=t.snapOffsetY)}t.paddingTop=o,oe(t.element,"top",`${n}px`),oe(t.element,"margin-top",`${r}px`),oe(t.element,"padding-top",`${o}px`),oe(t.element,"border-top-width",`${s}px`)}assignBottomPosition(e,t){let i=this.getPropAsNumber(e,"margin-bottom"),n=this.getPropAsNumber(e,"padding-bottom"),r=this.getPropAsNumber(e,"border-bottom-width"),o=this.getPropAsNumber(e,"height")-t.snapOffsetY;oe(t.element,"height",`${o}px`),oe(t.element,"margin-bottom",`${i}px`),oe(t.element,"padding-bottom",`${n}px`),oe(t.element,"border-bottom-width",`${r}px`),t.height=o-t.snapOffsetY,t.marginBottom=i,t.borderBottom=r,t.paddingBottom=n}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){oe(t.element,"border-top-width","0px");let i=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,i):(this.assignTopPosition(e,t),i-=t.snapOffsetY,t.height=i,oe(t.element,"height",`${i}px`))}sizeWithMaxWidth(e,t){oe(t.element,"border-left-width","0px");let i=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,i);else{this.assignRightPosition(e,t),i-=t.snapOffsetX,t.width=i;let n=this.getPropAsNumber(e,"right");oe(t.element,"right",`${n}px`),oe(t.element,"width",`${i}px`)}}prepareContainer(e,t,i,n,r){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&oe(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&oe(t.element,"direction",this.rtl?"rtl":"ltr"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let i=0;i<cc.length;i++)this.propagateProperty(e,t,cc[i],n)}transferContentProps(e,t,i,n){for(let i=0;i<pc.length;i++)this.propagateProperty(e,t,pc[i],n)}transferSingleUriContentProps(e,t,i){let n=()=>{var e,t;let i=null==(t=null!=(e=this.cascaded.width)?e:this.cascaded[this.vertical?"block-size":"inline-size"])?void 0:t.value;return!!i&&i!==oi.auto&&!ci(i)},r=()=>{var e,t;let i=null==(t=null!=(e=this.cascaded.height)?e:this.cascaded[this.vertical?"inline-size":"block-size"])?void 0:t.value;return!!i&&i!==oi.auto&&!ci(i)};for(let o=0;o<fc.length;o++){let s=fc[o];"width"===s&&!n()||"height"===s&&!r()||this.propagatePropertyToElement(e,t,s,i)}}finishContainer(e,t,i,n,r,o,s){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;let a=(this.vertical||!n)&&this.isAutoHeight,l=(!this.vertical||!n)&&this.isAutoWidth,h=null;if((l||a)&&(l&&oe(t.element,"width","auto"),a&&oe(t.element,"height","auto"),h=o.getElementClientRect(n?n.element:t.element),l&&(this.calculatedWidth=Math.ceil(h.right-h.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),a&&(this.calculatedHeight=h.bottom-h.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),r>1){let i=this.getPropAsNumber(e,"column-rule-width"),n=this.getProp(e,"column-rule-style"),o=this.getProp(e,"column-rule-color");if(i>0&&n&&n!=oi.none&&o!=oi.transparent){let s=this.getPropAsNumber(e,"column-gap"),a=this.vertical?t.height:t.width,l=this.vertical?"border-top":"border-left";for(let e=1;e<r;e++){let h=this.vertical?(a+s)*e/r-s/2+t.paddingTop-i/2:(a+s)*e/r-s/2+t.paddingLeft-i/2,u=this.vertical?t.width+t.paddingLeft+t.paddingRight:t.height+t.paddingTop+t.paddingBottom,c=t.element.ownerDocument.createElement("div");oe(c,"position","absolute"),oe(c,this.vertical?"left":"top","0px"),oe(c,this.vertical?"top":"left",`${h}px`),oe(c,this.vertical?"height":"width","0px"),oe(c,this.vertical?"width":"height",`${u}px`),oe(c,l,`${i}px ${n.toString()}${o?` ${o.toString()}`:""}`),t.element.insertBefore(c,t.element.firstChild)}}}for(let i=0;i<dc.length;i++)this.propagateProperty(e,t,dc[i],s);for(let n=0;n<gc.length;n++)this.propagateDelayedProperty(e,t,gc[n],i.delayedItems)}applyCascadeAndInit(e,t){let i=this.cascaded,n=this.pageBox.specified;for(let e in n)this instanceof Wc&&"vivliostyle-page-rule-master"==this.pageBox.pseudoName&&("writing-mode"===e||"direction"===e)||la(e)&&ca(i,e,ua(n,e));if(this.pageBox.pseudoName==mc)for(let e in t)(e.match(/^background-/)||"writing-mode"==e)&&(i[e]=t[e]);if("layout-host"==this.pageBox.pseudoName)for(let e in t)!e.match(/^background-/)&&"writing-mode"!=e&&(i[e]=t[e]);e.pushRule(this.pageBox.classes,null,i);let r=i.content;r&&(i.content=r.filterValue(new ul(e,null,e.counterResolver))),this.init(e.context);for(let i of this.pageBox.children)i.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(let t of this.children)t.resolveAutoSizing(e)}},cc=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","outline-style","outline-color","outline-width","overflow","visibility"],dc=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],pc=["color","font-family","font-size","font-style","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-transform","white-space","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-stretch","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-fill-color","text-orientation","text-shadow","text-stroke-color","text-stroke-width","text-underline-position"],fc=["width","height","image-resolution","object-fit","object-position"],gc=["transform","transform-origin"],mc="background-host",bc=class extends uc{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort(((e,t)=>t.pageBox.specificity-e.pageBox.specificity||e.pageBox.index-t.pageBox.index))}},vc=class extends uc{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){let t=this.pageBox.pageMaster;return t.condition&&(e=It(t.scope,e,t.condition)),e}adjustPageLayout(e,t,i){}},wc=class extends uc{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}},yc=class extends uc{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,i){let n=null;if(t instanceof $t&&(n=[t]),t instanceof Qt&&(n=t.values),n){let t=this.pageBox.scope;for(let r=0;r<n.length;r++)if(n[r]instanceof $t){let o=Ve(n[r].name,"enabled"),s=new yt(t,o);i&&(s=new et(t,s)),e=It(t,e,s)}}return e}boxSpecificEnabled(e){let t=this.pageBox.scope,i=this.style,n=hc(t,i.required,t._false)!==t._false;if(n||this.isAutoHeight){let n=function(e,t,i){return!t||ci(t)?new Et(e,i):t.toExpr(e,e.zero)}(t,i["flow-from"],"body");e=It(t,e,new Ct(t,"has-content",[n]))}if(e=this.processPartitionList(e,i["required-partitions"],!1),e=this.processPartitionList(e,i["conflicting-partitions"],!0),n){let i=this.pageMasterInstance.style.enabled,n=i?i.toExpr(t,null):t._true;n=It(t,n,e),this.pageMasterInstance.style.enabled=new ti(n)}return e}prepareContainer(e,t,i,n,r){i.pageAreaElement||oe(t.element,"overflow","hidden"),super.prepareContainer(e,t,i,n,r)}},xc=class extends mr{constructor(e,t,i,n){super(e,t,!1),this.target=i,this.validatorSet=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,i){this.target.specified[e]=new ta(t,i?cr:dr)}},Sc=class extends xc{constructor(e,t,i,n){super(e,t,i,n)}},Cc=class e extends xc{constructor(e,t,i,n){super(e,t,i,n),i.specified.width=new ta(si,0),i.specified.height=new ta(si,0)}startPartitionRule(e,t,i){let n=new rc(this.scope,e,t,i,this.target),r=new Sc(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(t,i,n){let r=new nc(this.scope,t,i,n,this.target),o=new e(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}},kc=class extends xc{constructor(e,t,i,n){super(e,t,i,n)}startPartitionRule(e,t,i){let n=new rc(this.scope,e,t,i,this.target),r=new Sc(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(e,t,i){let n=new nc(this.scope,e,t,i,this.target),r=new Cc(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}};function Ec(e){var t,i;let n=null==(t=e["writing-mode"])?void 0:t.value,r=null==(i=e.direction)?void 0:i.value;return n===oi.vertical_lr||n!==oi.vertical_rl&&r!==oi.rtl?"ltr":"rtl"}var Pc={a10:{width:new Wt(26,"mm"),height:new Wt(37,"mm")},a9:{width:new Wt(37,"mm"),height:new Wt(52,"mm")},a8:{width:new Wt(52,"mm"),height:new Wt(74,"mm")},a7:{width:new Wt(74,"mm"),height:new Wt(105,"mm")},a6:{width:new Wt(105,"mm"),height:new Wt(148,"mm")},a5:{width:new Wt(148,"mm"),height:new Wt(210,"mm")},a4:{width:new Wt(210,"mm"),height:new Wt(297,"mm")},a3:{width:new Wt(297,"mm"),height:new Wt(420,"mm")},a2:{width:new Wt(420,"mm"),height:new Wt(594,"mm")},a1:{width:new Wt(594,"mm"),height:new Wt(841,"mm")},a0:{width:new Wt(841,"mm"),height:new Wt(1189,"mm")},b10:{width:new Wt(31,"mm"),height:new Wt(44,"mm")},b9:{width:new Wt(44,"mm"),height:new Wt(62,"mm")},b8:{width:new Wt(62,"mm"),height:new Wt(88,"mm")},b7:{width:new Wt(88,"mm"),height:new Wt(125,"mm")},b6:{width:new Wt(125,"mm"),height:new Wt(176,"mm")},b5:{width:new Wt(176,"mm"),height:new Wt(250,"mm")},b4:{width:new Wt(250,"mm"),height:new Wt(353,"mm")},b3:{width:new Wt(353,"mm"),height:new Wt(500,"mm")},b2:{width:new Wt(500,"mm"),height:new Wt(707,"mm")},b1:{width:new Wt(707,"mm"),height:new Wt(1e3,"mm")},b0:{width:new Wt(1e3,"mm"),height:new Wt(1414,"mm")},c10:{width:new Wt(28,"mm"),height:new Wt(40,"mm")},c9:{width:new Wt(40,"mm"),height:new Wt(57,"mm")},c8:{width:new Wt(57,"mm"),height:new Wt(81,"mm")},c7:{width:new Wt(81,"mm"),height:new Wt(114,"mm")},c6:{width:new Wt(114,"mm"),height:new Wt(162,"mm")},c5:{width:new Wt(162,"mm"),height:new Wt(229,"mm")},c4:{width:new Wt(229,"mm"),height:new Wt(324,"mm")},c3:{width:new Wt(324,"mm"),height:new Wt(458,"mm")},c2:{width:new Wt(458,"mm"),height:new Wt(648,"mm")},c1:{width:new Wt(648,"mm"),height:new Wt(917,"mm")},c0:{width:new Wt(917,"mm"),height:new Wt(1297,"mm")},"jis-b10":{width:new Wt(32,"mm"),height:new Wt(45,"mm")},"jis-b9":{width:new Wt(45,"mm"),height:new Wt(64,"mm")},"jis-b8":{width:new Wt(64,"mm"),height:new Wt(91,"mm")},"jis-b7":{width:new Wt(91,"mm"),height:new Wt(128,"mm")},"jis-b6":{width:new Wt(128,"mm"),height:new Wt(182,"mm")},"jis-b5":{width:new Wt(182,"mm"),height:new Wt(257,"mm")},"jis-b4":{width:new Wt(257,"mm"),height:new Wt(364,"mm")},"jis-b3":{width:new Wt(364,"mm"),height:new Wt(515,"mm")},"jis-b2":{width:new Wt(515,"mm"),height:new Wt(728,"mm")},"jis-b1":{width:new Wt(728,"mm"),height:new Wt(1030,"mm")},"jis-b0":{width:new Wt(1030,"mm"),height:new Wt(1456,"mm")},letter:{width:new Wt(8.5,"in"),height:new Wt(11,"in")},legal:{width:new Wt(8.5,"in"),height:new Wt(14,"in")},ledger:{width:new Wt(11,"in"),height:new Wt(17,"in")}},Nc=new Wt(.24,"pt");new Wt(3,"mm");var Tc=new Wt(10,"mm"),Ic=new Wt(13,"mm");function Rc(e){let t={width:ai,height:li,bleed:hi,bleedOffset:hi,cropOffset:hi},i=e.size;if(i&&i.value!==oi.auto){let e,n,r=i.value;if(r.isSpaceList()?(e=r.values[0],n=r.values[1]):(e=r,n=null),e.isNumeric())t.width=e,t.height=n||e;else{let i=e.name&&Pc[e.name.toLowerCase()];i&&(n&&n===oi.landscape?(t.width=i.height,t.height=i.width):(t.width=i.width,t.height=i.height))}}let n=e.marks,r=e.bleed,o=n&&!ci(n.value)?n.value:oi.none,s=r&&!ci(r.value)?r.value:oi.auto;if(s===oi.auto){if(o!==oi.none){let e=!1;e=o.isSpaceList()?o.values.some((e=>e===oi.crop)):o===oi.crop,e&&(t.bleed=new Wt(6,"pt"))}}else s.isNumeric()&&(t.bleed=s);let a=e["crop-offset"],l=a&&!ci(a.value)?a.value:oi.auto;return l===oi.auto?o!==oi.none&&(t.bleedOffset=Ic):l.isNumeric()&&(t.cropOffset=l),t}function _c(e,t){let i={},n=Math.max(0,e.bleed.num)*t.queryUnitSize(e.bleed.unit,!1),r=!e.cropOffset.num&&e.bleedOffset.num?e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1):Math.max(0,e.cropOffset.num*t.queryUnitSize(e.cropOffset.unit,!1)-n),o=n+r,s=e.width;s===ai?t.pref.defaultPaperSize?i.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):i.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-2*o:i.pageWidth=s.num*t.queryUnitSize(s.unit,!1);let a=e.height;return a===li?t.pref.defaultPaperSize?i.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):i.pageHeight=t.viewportHeight-2*o:i.pageHeight=a.num*t.queryUnitSize(a.unit,!1),i.bleed=n,i.bleedOffset=r,i.cropOffset=o,i}function Ac(e,t,i){let n=e.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("width",t),n.setAttribute("height",i),n.style.position="absolute",n}function Lc(e,t,i,n){n=n||"polyline";let r=e.createElementNS("http://www.w3.org/2000/svg",n);return r.setAttribute("stroke",i===oi.auto?"#010101":i.toString()),r.setAttribute("stroke-width",t),r.setAttribute("fill","none"),r}var Oc=(e=>(e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right",e))(Oc||{}),Fc=(e=>(e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e))(Fc||{});function Bc(e,t,i,n){let r=!1,o=!1,s=e.marks;if(s){let e=s.value;e instanceof Jt?e.values.forEach((e=>{e===oi.crop?r=!0:e===oi.cross&&(o=!0)})):e===oi.crop?r=!0:e===oi.cross&&(o=!0)}let a=t.bleed;if(!r&&!o)return;let l=i.container,h=l.ownerDocument,u=ni(Nc,n),c=Math.max(0,t.bleedOffset-ni(Tc,n)),d=t.bleedOffset-c,p=e["crop-marks-line-color"],f=p&&!ci(p.value)?p.value:oi.auto;r&&Object.keys(Oc).forEach((e=>{let t=Oc[e],i=function(e,t,i,n,r,o,s){let a=r;a<=o+2*je.mm&&(a=o+r/2);let l=Math.max(r,a),h=o+l+i/2,u=Ac(e,h,h),c=[[0,o+r],[r,o+r],[r,o+r-a]],d=c.map((e=>[e[1],e[0]]));("top right"===t||"bottom right"===t)&&(c=c.map((e=>[o+l-e[0],e[1]])),d=d.map((e=>[o+l-e[0],e[1]]))),("bottom left"===t||"bottom right"===t)&&(c=c.map((e=>[e[0],o+l-e[1]])),d=d.map((e=>[e[0],o+l-e[1]])));let p=Lc(e,i,n);p.setAttribute("points",c.map((e=>e.join(","))).join(" ")),u.appendChild(p);let f=Lc(e,i,n);return f.setAttribute("points",d.map((e=>e.join(","))).join(" ")),u.appendChild(f),t.split(" ").forEach((e=>{u.style[e]=`${s}px`})),u}(h,t,u,f,d,a,c);l.appendChild(i)})),o&&Object.keys(Fc).forEach((e=>{let t=Fc[e],i=function(e,t,i,n,r,o){let s,a,l=2*r;"top"===t||"bottom"===t?(s=l,a=r):(s=r,a=l);let h=Ac(e,s,a),u=Lc(e,i,n);u.setAttribute("points",`0,${a/2} ${s},${a/2}`),h.appendChild(u);let c=Lc(e,i,n);c.setAttribute("points",`${s/2},0 ${s/2},${a}`),h.appendChild(c);let d,p=Lc(e,i,n,"circle");switch(p.setAttribute("cx",s/2),p.setAttribute("cy",a/2),p.setAttribute("r",r/4),h.appendChild(p),t){case"top":d="bottom";break;case"bottom":d="top";break;case"left":d="right";break;case"right":d="left"}return Object.keys(Fc).forEach((e=>{let i=Fc[e];i===t?h.style[i]=`${o}px`:i!==d&&(h.style[i]="0",h.style[`margin-${i}`]="auto")})),h}(h,t,u,f,d,c);l.appendChild(i)}))}var Mc=(()=>{let e={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0};return["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end"].forEach((t=>{e[`margin-${t}`]=!0,e[`padding-${t}`]=!0,e[`border-${t}-width`]=!0,e[`border-${t}-style`]=!0,e[`border-${t}-color`]=!0})),e})(),zc={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"start"},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"center"},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"end"},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"end"},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"center"},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"start"}},Dc=(()=>{let e=zc;return Object.keys(e).sort(((t,i)=>e[t].order-e[i].order))})(),Vc="vivliostyle-page-rule-master",Uc="_marginBoxes",Hc=class extends ic{constructor(e,t,i){super(e,null,Vc,[],t,null,0),l(this,"bodyPartitionKey"),l(this,"pageMarginBoxes",{});let n=Rc(i),r=new $c(this.scope,this,i,n);this.bodyPartitionKey=r.key,this.createPageMarginBoxes(i),this.applySpecified(i,n)}createPageMarginBoxes(e){let t=e[Uc];t&&Dc.forEach((i=>{t[i]&&(this.pageMarginBoxes[i]=new jc(this.scope,this,i,e))}))}applySpecified(e,t){this.specified.position=new ta(oi.relative,0),this.specified.width=new ta(t.width,0),this.specified.height=new ta(t.height,0);for(let t in e)!Mc[t]&&"background-clip"!==t&&(this.specified[t]=e[t])}createInstance(e){return new Wc(e,this)}},$c=class extends rc{constructor(e,t,i,n){super(e,null,null,[],t),this.pageSize=n,this.specified["z-index"]=new ta(new qt(0),0),this.applySpecified(i)}applySpecified(e){this.specified["flow-from"]=new ta(jt("body"),0),this.specified.position=new ta(oi.absolute,0),this.specified.overflow=new ta(oi.visible,0);for(let t in Mc)Mc.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new Yc(e,this)}},jc=class extends rc{constructor(e,t,i,n){super(e,null,null,[],t),this.marginBoxName=i,this.applySpecified(n)}applySpecified(e){let t=e[Uc][this.marginBoxName];for(let i in e){let n=e[i],r=t[i];(js[i]||r&&r.value===oi.inherit)&&(this.specified[i]=n)}for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e)){let i=t[e];i&&i.value!==zt&&i.value!==oi.inherit&&i.value!==oi.unset&&i.value!==oi.revert&&(this.specified[e]=i)}}createInstance(e){return new Kc(e,this)}},Wc=class extends vc{constructor(e,t){super(e,t),l(this,"pageAreaDimension",null),l(this,"pageMarginBoxInstances",{})}applyCascadeAndInit(e,t){let i=this.cascaded;for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"writing-mode":case"direction":i[e]=t[e]}super.applyCascadeAndInit(e,t)}initHorizontal(){let e=this.style;e.left=hi,e["margin-left"]=hi,e["border-left-width"]=hi,e["padding-left"]=hi,e["padding-right"]=hi,e["border-right-width"]=hi,e["margin-right"]=hi,e.right=hi}initVertical(){let e=this.style;e.top=hi,e["margin-top"]=hi,e["border-top-width"]=hi,e["padding-top"]=hi,e["padding-bottom"]=hi,e["border-bottom-width"]=hi,e["margin-bottom"]=hi,e.bottom=hi}setPageAreaDimension(e){this.pageAreaDimension=e;let t=this.style;t.width=new ti(e.borderBoxWidth),t.height=new ti(e.borderBoxHeight),t["padding-left"]=new ti(e.marginLeft),t["padding-right"]=new ti(e.marginRight),t["padding-top"]=new ti(e.marginTop),t["padding-bottom"]=new ti(e.marginBottom)}adjustPageLayout(e,t,i){let n=t.marginBoxes,r={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},o={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(n.top,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.bottom,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.left,!1,o,e,i),this.sizeMarginBoxesAlongVariableDimension(n.right,!1,o,e,i)}sizeMarginBoxesAlongVariableDimension(e,t,i,n,r){let o="start",s="center",a="end",l=this.pageBox.scope,h={},u={},c={};for(let i in e){let n=zc[i];if(n){let o=e[i],s=this.pageMarginBoxInstances[i],a=new Gc(o,s.style,t,l,r);h[n.positionAlongVariableDimension]=o,u[n.positionAlongVariableDimension]=s,c[n.positionAlongVariableDimension]=a}}let d={start:i.start.evaluate(n),end:i.end.evaluate(n),extent:i.extent.evaluate(n)},p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),f=!1,g={};Object.keys(h).forEach((e=>{let o=e,s=oc(l,u[o].style[t?"max-width":"max-height"],i.extent);if(s){let e=s.evaluate(n);if(p[o]>e){let i=c[o]=new Xc(h[o],u[o].style,t,l,r,e);g[o]=i.getOuterSize(),f=!0}}})),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),f=!1,[o,s,a].forEach((e=>{p[e]=g[e]||p[e]})));let m={};Object.keys(h).forEach((e=>{let o=e,s=oc(l,u[o].style[t?"min-width":"min-height"],i.extent);if(s){let e=s.evaluate(n);if(p[o]<e){let i=c[o]=new Xc(h[o],u[o].style,t,l,r,e);m[o]=i.getOuterSize(),f=!0}}})),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),[o,s,a].forEach((e=>{p[e]=m[e]||p[e]})));let b=d.start+d.extent,v=d.start+(d.start+d.extent);[o,s,a].forEach((e=>{let i=p[e];if(i){let n=h[e],r=0;switch(e){case o:r=t?n.left:n.top;break;case s:r=(v-i)/2;break;case a:r=b-i}t?n.setHorizontalPosition(r,i-n.getInsetLeft()-n.getInsetRight()):n.setVerticalPosition(r,i-n.getInsetTop()-n.getInsetBottom())}}))}getSizesOfMarginBoxesAlongVariableDimension(e,t){let i=e.start,n=e.center,r=e.end,o={};if(n){let e=[i,r].filter((e=>e)),s=e.length?new qc(e):null,a=this.distributeAutoMarginBoxSizes(n,s,t);a.xSize&&(o.center=a.xSize);let l=(t-(a.xSize||n.getOuterSize()))/2;i&&i.hasAutoSize()&&(o.start=l),r&&r.hasAutoSize()&&(o.end=l)}else{let e=this.distributeAutoMarginBoxSizes(i,r,t);e.xSize&&(o.start=e.xSize),e.ySize&&(o.end=e.ySize)}return o}distributeAutoMarginBoxSizes(e,t,i){let n={xSize:null,ySize:null};if(e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){let r=e.getOuterMaxContentSize(),o=t.getOuterMaxContentSize();if(r>0&&o>0){let s=r+o;if(s<i)n.xSize=i*r/s;else{let o=e.getOuterMinContentSize(),a=o+t.getOuterMinContentSize();a<i?n.xSize=o+(i-a)*(r-o)/(s-a):a>0&&(n.xSize=i*o/a)}n.xSize>0&&(n.ySize=i-n.xSize)}else r>0?n.xSize=i:o>0&&(n.ySize=i)}else e.hasAutoSize()?n.xSize=Math.max(i-t.getOuterSize(),0):t.hasAutoSize()&&(n.ySize=Math.max(i-e.getOuterSize(),0));else e?e.hasAutoSize()&&(n.xSize=i):t&&t.hasAutoSize()&&(n.ySize=i);return n}prepareContainer(e,t,i,n,r){super.prepareContainer(e,t,i,n,r),t.element.setAttribute("data-vivliostyle-page-box",!0)}},Gc=class{constructor(e,t,i,n,r){this.container=e,this.isHorizontal=i,this.clientLayout=r,l(this,"hasAutoSize_"),l(this,"size",null);let o=t[i?"width":"height"];this.hasAutoSize_=!o||o===oi.auto||ci(o)}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let e=this.isHorizontal?["max-content width","min-content width"]:["max-content height","min-content height"];this.size=Xr(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["max-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["max-content height"]+this.container.getInsetBottom()}getOuterMinContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["min-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["min-content height"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},qc=class{constructor(e){this.params=e}hasAutoSize(){return this.params.some((e=>e.hasAutoSize()))}getOuterMaxContentSize(){let e=this.params.map((e=>e.getOuterMaxContentSize()));return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){let e=this.params.map((e=>e.getOuterMinContentSize()));return Math.max.apply(null,e)*e.length}getOuterSize(){let e=this.params.map((e=>e.getOuterSize()));return Math.max.apply(null,e)*e.length}},Xc=class extends Gc{constructor(e,t,i,n,r,o){super(e,t,i,n,r),l(this,"fixedSize"),this.fixedSize=o}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},Yc=class extends yc{constructor(e,t){super(e,t),l(this,"borderBoxWidth",null),l(this,"borderBoxHeight",null),l(this,"marginTop",null),l(this,"marginRight",null),l(this,"marginBottom",null),l(this,"marginLeft",null)}applyCascadeAndInit(e,t){let i=this.cascaded;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(e.match(/^column.*$/)||e.match(/^background-/))&&(i[e]=t[e]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let t=this.style,i=this.pageBox.pageSize,n=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,a=i[s].toExpr(n,null),l=oc(n,t[s],a),h=oc(n,t[`margin-${r}`],a),u=oc(n,t[`margin-${o}`],a),c=sc(n,t[`padding-${r}`],a),d=sc(n,t[`padding-${o}`],a),p=lc(n,t[`border-${r}-width`],t[`border-${r}-style`],a),f=lc(n,t[`border-${o}-width`],t[`border-${o}-style`],a),g=_t(n,a,Rt(n,Rt(n,p,c),Rt(n,f,d)));return l?(g=_t(n,g,l),h||u?h?u=_t(n,g,h):h=_t(n,g,u):(h=At(n,g,new Et(n,.5)),u=h)):(h||(h=n.zero),u||(u=n.zero),l=_t(n,g,Rt(n,h,u))),i.width!==ai||i.height!==li||this.hasBorderOrOutline()||h instanceof wt&&h.num<0||u instanceof wt&&u.num<0?(t[r]=new ti(h),t[o]=new ti(u),t[`margin-${r}`]=hi,t[`margin-${o}`]=hi,t[`border-${r}-width`]=new ti(p),t[`border-${o}-width`]=new ti(f)):(t[r]=hi,t[o]=hi,t[`margin-${r}`]=hi,t[`margin-${o}`]=hi,t[`border-${r}-width`]=new ti(h),t[`border-${o}-width`]=new ti(u),t[`border-${r}-style`]=oi.solid,t[`border-${o}-style`]=oi.solid,t[`border-${r}-color`]=oi.transparent,t[`border-${o}-color`]=oi.transparent,t["background-clip"]=oi.padding_box),t[`padding-${r}`]=new ti(c),t[`padding-${o}`]=new ti(d),t[s]=new ti(l),t[`max-${s}`]=new ti(l),{borderBoxExtent:_t(n,a,Rt(n,h,u)),marginStart:h,marginEnd:u}}hasBorderOrOutline(){let e=e=>{var t;let i=null==(t=ua(this.cascaded,e))?void 0:t.value;return!!i&&i!==oi.none};return e("border-top-style")||e("border-bottom-style")||e("border-left-style")||e("border-right-style")||e("border-block-start-style")||e("border-block-end-style")||e("border-inline-start-style")||e("border-inline-end-style")||e("outline-style")}prepareContainer(e,t,i,n,r){i.pageAreaElement=t.element,super.prepareContainer(e,t,i,n,r),e.pageAreaWidth=parseFloat(i.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(i.pageAreaElement.style.height)}},Kc=class extends yc{constructor(e,t){super(e,t),l(this,"boxInfo"),l(this,"suppressEmptyBoxGeneration",!0);let i=t.marginBoxName;this.boxInfo=zc[i],e.pageMarginBoxInstances[i]=this}prepareContainer(e,t,i,n,r){this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,i,n,r)}applyVerticalAlign(e,t){oe(t,"display","flex"),oe(t,"flex-flow",this.vertical?this.rtl?"row-reverse":"row":"column");let i=this.getProp(e,"vertical-align"),n=null;i===jt("middle")?n="center":i===jt("top")?n="flex-start":i===jt("bottom")&&(n="flex-end"),n&&oe(t,"justify-content",n);let r=this.getProp(e,"content");if(this.vertical||r instanceof Yt||r instanceof ti&&r.expr instanceof St&&r.expr.str.startsWith("running-element-")){let e="center";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||"end"===this.boxInfo.positionAlongVariableDimension?e=this.vertical||this.rtl?"start":"end":(this.boxInfo.isInRightColumn||"start"===this.boxInfo.positionAlongVariableDimension)&&(e=this.vertical||this.rtl?"end":"start")),oe(t,"align-items",e)}}positionAlongVariableDimension(e,t){let i=this.style,n=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,a="left"===r,l=a?t.borderBoxWidth:t.borderBoxHeight,h=oc(n,i[s],l),u=a?t.marginLeft:t.marginTop;if("start"===this.boxInfo.positionAlongVariableDimension)i[r]=new ti(u);else if(h){let e=sc(n,i[`margin-${r}`],l),t=sc(n,i[`margin-${o}`],l),s=sc(n,i[`padding-${r}`],l),a=sc(n,i[`padding-${o}`],l),c=lc(n,i[`border-${r}-width`],i[`border-${r}-style`],l),d=lc(n,i[`border-${o}-width`],i[`border-${o}-style`],l),p=Rt(n,h,Rt(n,Rt(n,s,a),Rt(n,Rt(n,c,d),Rt(n,e,t))));switch(this.boxInfo.positionAlongVariableDimension){case"center":i[r]=new ti(Rt(n,u,Lt(n,_t(n,l,p),new Et(n,2))));break;case"end":i[r]=new ti(_t(n,Rt(n,u,l),p))}}}positionAndSizeAlongFixedDimension(e,t){let i=this.style,n=this.pageBox.scope,r=e.inside,o=e.outside,s=e.extent,a=t[`margin${o.charAt(0).toUpperCase()}${o.substring(1)}`],l=ac(n,i[`margin-${r}`],a),h=ac(n,i[`margin-${o}`],a),u=sc(n,i[`padding-${r}`],a),c=sc(n,i[`padding-${o}`],a),d=lc(n,i[`border-${r}-width`],i[`border-${r}-style`],a),p=lc(n,i[`border-${o}-width`],i[`border-${o}-style`],a),f=oc(n,i[s],a),g=null;function m(e){if(g)return g;g={extent:f?f.evaluate(e):null,marginInside:l?l.evaluate(e):null,marginOutside:h?h.evaluate(e):null};let t=a.evaluate(e),i=0;return[d,u,c,p].forEach((t=>{t&&(i+=t.evaluate(e))})),(null===g.marginInside||null===g.marginOutside)&&i+g.extent+g.marginInside+g.marginOutside>t&&(null===g.marginInside&&(g.marginInside=0),null===g.marginOutside&&(g.marginOutside=0)),null!==g.extent&&null!==g.marginInside&&null!==g.marginOutside&&(g.marginOutside=null),null===g.extent&&null!==g.marginInside&&null!==g.marginOutside?g.extent=t-i-g.marginInside-g.marginOutside:null!==g.extent&&null===g.marginInside&&null!==g.marginOutside?g.marginInside=t-i-g.extent-g.marginOutside:null!==g.extent&&null!==g.marginInside&&null===g.marginOutside?g.marginOutside=t-i-g.extent-g.marginInside:null===g.extent?(g.marginInside=g.marginOutside=0,g.extent=t-i):g.marginInside=g.marginOutside=(t-i-g.extent)/2,g}i[s]=new ti(new St(n,(function(){let e=m(this).extent;return null===e?0:e}),s)),i[`margin-${r}`]=new ti(new St(n,(function(){let e=m(this).marginInside;return null===e?0:e}),`margin-${r}`)),i[`margin-${o}`]=new ti(new St(n,(function(){let e=m(this).marginOutside;return null===e?0:e}),`margin-${o}`)),"left"===r?i.left=new ti(Rt(n,t.marginLeft,t.borderBoxWidth)):"top"===r&&(i.top=new ti(Rt(n,t.marginTop,t.borderBoxHeight)))}initHorizontal(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,i,n,r,o,s){super.finishContainer(e,t,i,n,r,o,s);let a=i.marginBoxes,l=this.pageBox.marginBoxName,h=this.boxInfo;h.isInLeftColumn||h.isInRightColumn?!h.isInTopRow&&!h.isInBottomRow&&(h.isInLeftColumn?a.left[l]=t:h.isInRightColumn&&(a.right[l]=t)):h.isInTopRow?a.top[l]=t:h.isInBottomRow&&(a.bottom[l]=t)}},Zc=class{constructor(e,t,i,n,r){this.cascadeInstance=e,this.pageScope=t,this.rootPageBoxInstance=i,this.context=n,this.docElementStyle=r,l(this,"pageMasterCache",{}),this.definePageProgression()}definePageProgression(){let e=this.pageScope,t=this.context,i=t.isVersoFirstPage,n=new yt(e,"page-number"),r=new dt(e,new vt(e,n,new Et(e,2)),i?e.one:e.zero);e.defineName("recto-page",new et(e,r)),e.defineName("verso-page",r),"ltr"===(t.pageProgression||Ec(this.docElementStyle))?(e.defineName("left-page",r),e.defineName("right-page",new et(e,r))):(e.defineName("left-page",new et(e,r)),e.defineName("right-page",r))}getCascadedPageStyle(e){let t={};return this.cascadeInstance.pushRule([],e,t),this.cascadeInstance.popRule(),t}getPageRulePageMaster(e,t){let i=e.pageBox;if(0===Object.keys(t).length)return i.resetScope(),e;let n=this.makeCacheKey(t,i),r=this.pageMasterCache[n];return r||(r=i.pseudoName===mc?this.generatePageRuleMaster(t):this.generateCascadedPageMaster(t,i),this.pageMasterCache[n]=r),r.pageBox.resetScope(),r}makeCacheKey(e,t){let i=this.makeCascadeValueObjectKey(e);return`${t.key}^${i}`}makeCascadeValueObjectKey(e){let t=[];for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let n,r=e[i];n=r instanceof ta?`${r.value}`:this.makeCascadeValueObjectKey(r),t.push(i+n+(r.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){let t=new Hc(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){let i=t.clone({pseudoName:Vc}),n=i.specified,r=e.size;if(r&&!ci(r.value)){let t=Rc(e),i=r.priority;ra(n,"width",new ta(t.width,i),this.context),ra(n,"height",new ta(t.height,i),this.context)}["counter-reset","counter-increment"].forEach((t=>{n[t]&&(e[t]=n[t])}));let o=i.createInstance(this.rootPageBoxInstance);return o.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),o.resolveAutoSizing(this.context),o}},Jc=class extends Pa{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},Qc=class extends Pa{constructor(e){super(),this.scope=e}apply(e){1===new yt(this.scope,"page-number").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},ed=class extends Pa{constructor(e){super(),this.scope=e}apply(e){new yt(this.scope,"blank-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},td=class extends Pa{constructor(e){super(),this.scope=e}apply(e){new yt(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},id=class extends Pa{constructor(e){super(),this.scope=e}apply(e){new yt(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},nd=class extends Pa{constructor(e){super(),this.scope=e}apply(e){new yt(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},rd=class extends Pa{constructor(e){super(),this.scope=e}apply(e){new yt(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},od=class extends Ua{constructor(e,t,i){super(t,i),this.scope=e,this.a=t,this.b=i}apply(e){let t=e.context,i=t.layoutPositionAtPageStart.page;t.blankPageAtStart&&i--,i&&this.matchANPlusB(i)&&this.chained.apply(e)}getPriority(){return 2}},sd=class extends Ea{constructor(e,t){super(e,t,null,null,null)}apply(e){!function(e,t,i,n){ba(e,t,i,n,null,null,null);let r=i[Uc];if(r){let i=pa(t,Uc);for(let t in r)if(r.hasOwnProperty(t)){let o=i[t];o||(o={},i[t]=o),ba(e,o,r[t],n,null,null,null)}}}(e.context,e.currentStyle,this.style,this.specificity)}},ad=class extends Sl{constructor(e,t,i,n,r){super(e,t,null==i?void 0:i.condition,i,null,n,!1),this.pageProps=r,l(this,"currentPageSelectors",[]),l(this,"currentNamedPageSelector",""),l(this,"currentPseudoPageClassSelectors",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,t){this.currentNamedPageSelector=t,t&&(this.chain.push(new Jc(t)),this.specificity+=65536)}pseudoclassSelector(e,t){if(e=e.toLowerCase(),t)if("nth"===e){let[i,n]=t;this.currentPseudoPageClassSelectors.push(`:${e}(${i}n${n<0?n:"+"+n})`),this.chain.push(new od(this.scope,i,n)),this.specificity+=256}else this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`);else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case"first":this.chain.push(new Qc(this.scope)),this.specificity+=256;break;case"blank":this.chain.push(new ed(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new td(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new id(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new nd(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new rd(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`)}}finishSelector(){let e;e=this.currentNamedPageSelector||this.currentPseudoPageClassSelectors.length?[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()):null,this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,i){if(("bleed"===e||"marks"===e)&&!this.currentPageSelectors.some((e=>null===e.selectors)))return;super.simpleProperty(e,t,i);let n=ua(this.elementStyle,e),r=this.pageProps;if("bleed"===e||"marks"===e)r[""]||(r[""]={}),Object.keys(r).forEach((t=>{ca(r[t],e,n)}));else if("size"===e){let t=r[""];this.currentPageSelectors.forEach((i=>{let o=new ta(n.value,n.priority+i.specificity),s=i.selectors?i.selectors.join(""):"",a=r[s];a?ra(a,e,o):(a=r[s]={},ca(a,e,o),t&&["bleed","marks"].forEach((e=>{t[e]&&ca(a,e,t[e])})))}))}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new sd(this.elementStyle,e)}startPageMarginBoxRule(e){let t=pa(this.elementStyle,Uc),i=t[e];i||(i={},t[e]=i);let n=new ld(this.scope,this.owner,this.validatorSet,i);this.owner.pushHandler(n)}},ld=class extends mr{constructor(e,t,i,n){super(e,t,!1),this.validatorSet=i,this.boxStyle=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity(),r=new ta(t,n);ca(this.boxStyle,e,r)}},hd=!0,ud=[];function cd(e,t){return e===t||(e.src||t.src?e.src===t.src:e.textContent===t.textContent)}function dd(e){let t=Array.from(e.querySelectorAll("body > :not(script):not(link):not(style) ~ script"));return Array.from(e.querySelectorAll("head > script, body > script")).filter((e=>!t.includes(e)))}function pd(e,t,i){var n,r;if(!hd)return zn(!1);if((null==i||!i.inHead)&&(null==i||!i.atEnd)&&dd(e.ownerDocument).includes(e))return zn(!1);let o=e.textContent,s=e.src,a="module"===e.type,l=(a||s)&&e.async,h=a&&!l||s&&e.defer,u=!(null!=i&&i.atEnd)&&((null==i?void 0:i.forceDefer)||h||l);if(gd(t)||(t.onload=null),u)return ud.some((t=>cd(t,e)))||ud.push(e),zn(!0);if(s.includes("/mathjax")){let e=t.document.head.querySelector("script[src*='MathJax.js']:not([data-vivliostyle-scripting])");if(e)if(s.includes("/mathjax@3"))t.document.head.removeChild(e),null!=(r=null==(n=t.MathJax)?void 0:n.version)&&r.startsWith("2.")&&delete t.MathJax;else if(s.includes("/MathJax.js"))return zn(!0)}for(let i of t.document.head.getElementsByTagName("script"))i.hasAttribute("data-vivliostyle-scripting")&&cd(i,e)&&t.document.head.removeChild(i);let c=t.document.createElement("script");c.textContent=o,s&&(c.src=s),c.async=l,c.defer=h,c.setAttribute("data-vivliostyle-scripting","true");for(let t of e.attributes)["src","async","defer"].includes(t.name)||c.setAttribute(t.name,t.value);if(P.debug("script:",s),s){let e=hr(c);return t.document.head.appendChild(c),Kn([e])}return t.document.head.appendChild(c),zn(!0)}function fd(e,t,i){var n;let r=null!=(n=t.document.querySelector("[data-vivliostyle-textcontent]"))?n:t.document.createElement("div");return r.style.position="fixed",r.style.fontSize="0",r.setAttribute("data-vivliostyle-textcontent","true"),r.setAttribute("aria-hidden","true"),r.style.fontFamily=function(e,t){var i;let n={},r=e=>{var t;let i=null==(t=e["font-family"])?void 0:t.value;if(i)if(i.values)for(let e of i.values)n[e.stringValue()]=!0;else n[i.stringValue()]=!0;let o=e._marginBoxes;if(o)for(let e of Object.values(o))r(e)},o=e=>{if(e instanceof Ea)r(e.style);else if(e instanceof Sa||Array.isArray(e))for(let t of Object.values(e))o(t)};for(let e of Object.values(t.cascade.code))for(let t of Object.values(null!=e?e:{}))o(t);for(let t of e.querySelectorAll("[style]"))null!=(i=t.style)&&i.fontFamily&&(n[t.style.fontFamily]=!0);return Object.keys(n).join(",")}(e,i),r.textContent=e.documentElement.textContent,t.document.body.appendChild(r),r}function gd(e){return!!hd&&(ud.length>0||!!e.document.head.querySelector("script[data-vivliostyle-scripting]"))}var md=(e,t,i)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,((e,n)=>`url("${i.transformURL(n,t)}"`)).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,((e,n)=>`url('${i.transformURL(n,t)}'`)).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,((e,n)=>`url(${i.transformURL(n,t)}`)),bd={},vd=class e extends xe{constructor(e,t,i,n,r,o,s,a,h,u,c,d,p){super(),this.flowName=e,this.context=t,this.viewport=i,this.styler=n,this.regionIds=r,this.xmldoc=o,this.docFaces=s,this.footnoteStyle=a,this.stylerProducer=h,this.page=u,this.customRenderer=c,this.fallbackMap=d,this.documentURLTransformer=p,l(this,"document"),l(this,"exprContentListener"),l(this,"nodeContext",null),l(this,"viewRoot",null),l(this,"isFootnote",!1),l(this,"sourceNode",null),l(this,"offsetInNode",0),l(this,"viewNode",null),this.document=i.document,this.exprContentListener=n.counterListener.getExprContentListener()}clone(){return new e(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(e,t,i,n,r,o,s,a){let l=this.getPseudoMap(i,this.regionIds,this.isFootnote,this.nodeContext,o);if(!l)return a;let h=[],u=nh.createElementNS("http://www.pyroxy.com/ns/shadow","root"),c=u;for(let i of rh){let o;if(i){if(!l[i]||"footnote-marker"==i&&(!t||!this.isFootnote))continue;if(i.match(/^first-/)){let t=n.display;if(!t||t===oi.inline)continue;let i=e.firstElementChild;if(i&&To(i.previousSibling)){let e=r.getStyle(i,!1);if(e){let t=ua(e,"display");if(null!=t&&t.value&&t.value!==oi.inline)continue}}}if("before"===i||"after"===i){let e=l[i].content;if(!e||!Xo(e.value))continue}h.push(i),o=nh.createElementNS("http://www.w3.org/1999/xhtml","span"),ah(o,i)}else o=nh.createElementNS("http://www.pyroxy.com/ns/shadow","content");c.appendChild(o),i.match(/^first-/)&&(c=o)}if(!h.length)return a;let d=new lh(e,i,r,o,this.exprContentListener);return new zo(e,u,null,s,a,Mo.ROOTLESS,d)}getPseudoMap(e,t,i,n,r){let o=da(e,"_pseudos");if(!o)return null;let s={};for(let e in o){let n=s[e]={};Dl(n,o[e],r),Ll(n,r,o[e]),zl(o[e],t,i,((e,t)=>{Dl(n,t,r),Al(t,(e=>{Dl(n,e,r)}))}))}return s}createRefShadow(e,t,i,n,r){let o=Mn("createRefShadow");return this.xmldoc.store.load(e).then((s=>{let a=s;if(a){let o=a.getElement(e);if(o){let e=this.stylerProducer.getStylerForDoc(a);r=new zo(i,o,a,n,r,t,e)}}o.finish(r)})),o.result()}createShadows(e,t,i,n,r,o,s){let a,l=Mn("createShadows"),h=n.template;if(h instanceof Yt||h===oi.footnote){let t=h instanceof Yt?h.url:Z("user-agent.xml#footnote",Y);a=this.createRefShadow(t,Mo.ROOTLESS,e,s,null)}else a=zn(null);return a.then((a=>{let h=null;if("http://www.pyroxy.com/ns/shadow"==e.namespaceURI&&"include"==e.localName){let t=e.getAttribute("href"),i=null;t?i=s?s.xmldoc:this.xmldoc:s&&(t="http://www.w3.org/1999/xhtml"==s.owner.namespaceURI?s.owner.getAttribute("href"):s.owner.getAttributeNS("http://www.w3.org/1999/xlink","href"),i=s.parentShadow?s.parentShadow.xmldoc:this.xmldoc),t&&(t=Z(t,i.url),h=this.createRefShadow(t,Mo.ROOTED,e,s,a))}null==h&&(h=zn(a));let u=null;h.then((a=>{if(n.display===oi.table_cell){let t=Z("user-agent.xml#table-cell",Y);u=this.createRefShadow(t,Mo.ROOTLESS,e,s,a)}else u=zn(a);u.then((a=>{a=this.createPseudoelementShadow(e,t,i,n,r,o,s,a),l.finish(a)}))}))})),l.result()}setViewRoot(e,t){this.viewRoot=e,this.isFootnote=t}computeStyle(e,t,i,n){var r;let o=this.context,s=Ml(i,o,this.regionIds,this.isFootnote,this.nodeContext),a=!(null!=(r=this.nodeContext)&&r.parent);a&&(!s["writing-mode"]&&this.styler.rootStyle["writing-mode"]&&(s["writing-mode"]=this.styler.rootStyle["writing-mode"]),!s.direction&&this.styler.rootStyle.direction&&(s.direction=this.styler.rootStyle.direction));let l=e;e=Fl(s,o,e);let h=!a&&e!==l;if(t=Bl(s,o,t),Vl(s,n,e,t,((t,i)=>{let n;h&&(e?/^(min-|max-)?(height|inline-size)$/.test(t)&&(n=o.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(t)&&(n=o.pageAreaWidth));let r=i.evaluate(o,t,n,e);return"font-family"==t&&(r=this.docFaces.filterFontFamily(r)),r})),h){let t=n[e?"height":"width"];(!t||t===oi.auto)&&(n[e?"height":"width"]=oi.max_content)}if(cs(n.position))return n.position=oi.fixed,n.visibility=oi.hidden,e;let u=n.position,c=n.float,d=ds(n.display||("http://www.w3.org/1999/xhtml"===this.sourceNode.namespaceURI?oi.inline:void 0),u,c,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach((e=>{d[e]&&(n[e]=d[e])})),e}inheritFromSourceParent(e){let t=this.nodeContext.sourceNode,i=[],n=null,r=this.nodeContext.shadowContext,o=-1;for(;t&&1==t.nodeType;){let e=r&&r.root==t;if(!e||r.type==Mo.ROOTLESS){let e=(r?r.styler:this.styler).getStyle(t,!1);i.push(e),n=n||ae(t)}e?(t=r.owner,r=r.parentShadow):(t=t.parentNode,o++)}let s=0===o,a=this.context.queryUnitSize("em",s),l={"font-size":new ta(new Wt(a,"px"),0)},h=new wa(l,this.context);for(let e=i.length-1;e>=0;--e){let t,n,r=i[e],o=[];for(let e in r)ha(e)&&o.push(e);o.sort(di);for(let s of o){h.setPropName(s);let o=ua(r,s),a=o;ci(o.value)||("font-size"===s&&e===i.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize?a=new ta(new Wt(this.context.rootFontSize,"px"),o.priority):"line-height"===s&&e===i.length-1&&this.context.rootLineHeight&&o.value instanceof Wt&&("lh"===o.value.unit||"rlh"===o.value.unit)?a=new ta(new Wt(this.context.rootLineHeight,"px"),o.priority):0===e&&o.value instanceof Wt&&"lh"===o.value.unit?a=new ta(new Wt(o.value.num*this.getLineHeightUnitSize(s,t,n),"px"),o.priority):pi(s)||(a=o.filterValue(h)),"font-size"===s?t=a.value:"line-height"===s&&(n=a.value),l[s]=a)}}for(let t in e)ha(t)||(l[t]=e[t]);return{lang:n,elementStyle:l}}resolveURL(e){return e=Z(e,this.xmldoc.url),this.fallbackMap[e]||e}inheritLangAttribute(){this.nodeContext.lang=ae(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(e){let t=_("POLYFILLED_INHERITED_PROPS").reduce(((e,t)=>e.concat(t())),[].concat(Ws)).filter((t=>e[t]));if(t.length){let i=this.nodeContext.inheritedProps;if(this.nodeContext.parent){i=this.nodeContext.inheritedProps={};for(let e in this.nodeContext.parent.inheritedProps)i[e]=this.nodeContext.parent.inheritedProps[e]}t.forEach((t=>{let n=e[t];if(n){if(ci(n))n===oi.initial&&(i[t]=void 0);else if(n instanceof qt)i[t]=n.num;else if(n instanceof $t)i[t]=n.name;else if(n instanceof Wt){let e=n;switch(e.unit){case"dpi":case"dpcm":case"dppx":i[t]=e.num*je[e.unit];break;default:i[t]=n}}else i[t]=n;["widows","orphans"].includes(t)||delete e[t]}}))}}resolveFormattingContext(e,t,i,n,r,o){let s=_("RESOLVE_FORMATTING_CONTEXT");for(let a=0;a<s.length;a++){let l=s[a](e,t,i,n,r,o);if(l)return void(e.formattingContext=l)}}createElementView(e,t){var i,n,r,o;let s=!0,a=Mn("createElementView"),l=this.sourceNode,h=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,u=h.getStyle(l,!1);if(!this.nodeContext.shadowContext){let e=this.xmldoc.getElementOffset(l);Hs.registerFragmentIndex(e,this.nodeContext.fragmentIndex,0)}let c={};if(!this.nodeContext.parent){let e=this.inheritFromSourceParent(u);u=e.elementStyle,this.nodeContext.lang=e.lang}let d=u.position,p=u.float,f=u["float-reference"],g=p&&!ci(p.value)&&p.value!==oi.none&&f&&!ci(f.value)?function(e){switch(e){case"inline":return Yo.INLINE;case"column":return Yo.COLUMN;case"region":return Yo.REGION;case"page":return Yo.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}(f.value.toString()):null;if(this.nodeContext.parent&&(cs(null==d?void 0:d.value)||g&&Ko(g))){let e=this.inheritFromSourceParent(u);u=e.elementStyle,this.nodeContext.lang=e.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,"rtl"===this.nodeContext.direction,u,c),g&&Ko(g)&&c.display===oi.block&&(c.display=oi.flow_root),h.processContent(l,c,null!=(n=this.nodeContext.viewNode)?n:null==(i=this.nodeContext.parent)?void 0:i.viewNode),this.transferPolyfilledInheritedProps(c),this.inheritLangAttribute(),c.direction&&(this.nodeContext.direction=c.direction.toString());let m=c["flow-into"];if(m&&m.toString()!=this.flowName)return a.finish(!1),a.result();if(hd&&"script"===l.localName&&"http://www.w3.org/1999/xhtml"===l.namespaceURI)return pd(l,this.viewport.window).thenFinish(a),a.result();let b=c.display;if(ci(b)&&(b=b===oi.initial||b===oi.unset?oi.inline:b===oi.inherit?(null==(r=this.nodeContext.parent)?void 0:r.display)&&jt(null==(o=this.nodeContext.parent)?void 0:o.display):null),b===oi.none)return a.finish(!1),a.result();let v=null==this.nodeContext.parent;return this.nodeContext.flexContainer=b===oi.flex,this.createShadows(l,v,u,c,h,this.context,this.nodeContext.shadowContext).then((t=>{var i,n;this.nodeContext.nodeShadow=t;let r=c.position,o=c.float,d=c.clear,p=this.nodeContext.vertical?oi.vertical_rl:oi.horizontal_tb,f=this.nodeContext.parent?this.nodeContext.parent.vertical?oi.vertical_rl:oi.horizontal_tb:p,m=function(e){return"true"===e.getAttribute("data-vivliostyle-flow-root")}(l);this.nodeContext.establishesBFC=function(e,t,i,n,r,o,s){return r=r||o||oi.horizontal_tb,!!s||!!i&&i!==oi.none&&!ci(i)||us(t)||e===oi.inline_block||e===oi.table_cell||e===oi.table_caption||e==oi.flex||e==oi.grid||e==oi.flow_root||(e===oi.block||e===oi.list_item)&&!!n&&n!==oi.visible&&n!==oi.clip&&!ci(n)||!!o&&r!==o}(b,r,o,c.overflow,p,f,m),this.nodeContext.containingBlockForAbsolute=function(e){return e===oi.relative||e===oi.absolute||e===oi.fixed}(r),this.nodeContext.isInsideBFC()&&o!==oi.footnote&&(!g||!Ko(g))&&(o=null,d=null);let w=o instanceof Jt||o===oi.left||o===oi.right||o===oi.top||o===oi.bottom||o===oi.inline_start||o===oi.inline_end||o===oi.block_start||o===oi.block_end||o===oi.snap_block||o===oi.snap_inline||o===oi.footnote;o&&(delete c.float,o===oi.footnote&&(this.isFootnote?(w=!1,c.display=oi.block):c.display=oi.inline)),d&&(d===oi.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(d=jt(this.nodeContext.parent.clearSide)),(d===oi.left||d===oi.right||d===oi.top||d===oi.bottom||d===oi.inline_start||d===oi.inline_end||d===oi.block_start||d===oi.block_end||d===oi.both||d===oi.all||d===oi.same)&&(delete c.clear,c.display&&c.display!=oi.inline&&(this.nodeContext.clearSide=d.toString())));let y=b===oi.list_item&&c["ua-list-item-count"],x=c["break-inside"];(w||x&&!ci(x)&&x!==oi.auto)&&this.nodeContext.breakPenalty++,b&&b!==oi.inline&&fs(b)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!w&&!b||fs(b)||gs(b),this.nodeContext.display=b?b.toString():"inline",this.nodeContext.floatSide=w?o.toString():null,this.nodeContext.floatReference=g||Yo.INLINE;let S=c["float-min-wrap-block"];this.nodeContext.floatMinWrapBlock=S&&!ci(S)?S:null;let C=this.isInsideNonRootMultiColumn(),k=c["column-span"];if(this.nodeContext.columnSpan=C||!k||ci(k)?null:k,!this.nodeContext.inline){let e=c["break-after"];e&&!ci(e)&&(!C||e!==oi.column)&&(this.nodeContext.breakAfter=e.toString(),eo[this.nodeContext.breakAfter]&&delete c["break-after"]);let t=c["break-before"];t&&!ci(t)&&(!C||t!==oi.column)&&(1===this.nodeContext.fragmentIndex&&(this.nodeContext.breakBefore=t.toString()),eo[this.nodeContext.breakBefore]&&delete c["break-before"]);let i=c.page,n=i&&!ci(i)&&i.toString();!n&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||b===oi.table_header_group||b===oi.table_footer_group)&&(n=this.styler.cascade.currentPageType),n&&"auto"!==n.toLowerCase()?this.nodeContext.pageType=n:n=this.nodeContext.pageType,this.styler.cascade.currentPageType!==n&&(n||c.position!==oi.fixed)&&(1===this.nodeContext.fragmentIndex&&!no(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore="page"),n!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=n)}this.nodeContext.verticalAlign=c["vertical-align"]&&c["vertical-align"].toString()||"baseline",this.nodeContext.captionSide=c["caption-side"]&&c["caption-side"].toString()||"top";let E=c["border-collapse"];if(!E||E===jt("separate")){let e,t,i=c["border-spacing"];i&&(i instanceof Jt?(e=i.values[0],t=i.values[1]):e=t=i,e.isNumeric()&&(this.nodeContext.inlineBorderSpacing=ni(e,this.context)),t.isNumeric()&&(this.nodeContext.blockBorderSpacing=ni(t,this.context)))}let N=c["footnote-policy"];this.nodeContext.footnotePolicy=N&&!ci(N)?N:null;let T=c["x-first-pseudo"];if(T){let e=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new Vo(e,T.num)}this.nodeContext.inline||this.processAfterIfcontinues(l,u,h,this.context);let I=c["white-space"];if(I){let e=No(I.toString());null!==e&&(this.nodeContext.whitespace=e)}let R=c["hyphenate-character"];R&&R instanceof Ut&&(this.nodeContext.hyphenateCharacter=R.str);let _=c["word-break"],A=c["line-break"],L=c["overflow-wrap"];(_===oi.break_all||A===oi.anywhere||L===oi.break_word||L===oi.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,e,b,r,o,v),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(e=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,e)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(c),this.findAndProcessRepeatingElements(l,h));let O,F=!1,B=[],M=l.namespaceURI,z=l.localName;if("http://www.w3.org/1999/xhtml"==M?("html"==z||"body"==z||"script"==z||"link"==z||"meta"==z?z="div":"vide_"==z?z="video":"audi_"==z?z="audio":"object"==z&&(F=!!this.customRenderer),l.getAttribute(oh)&&null!=(n=null==(i=u.content)?void 0:i.value)&&n.url&&(z="img")):"http://www.idpf.org/2007/ops"==M?(z="span",M="http://www.w3.org/1999/xhtml"):"http://www.pyroxy.com/ns/shadow"==M?(M="http://www.w3.org/1999/xhtml",z=this.nodeContext.inline?"span":"div"):F=!!this.customRenderer,y)e?z="li":(z="div",b=oi.block,c.display=b);else if("body"==z||"li"==z)z="div";else if("q"==z)z="span";else if("a"==z){let e=c["hyperlink-processing"];e&&"normal"!=e.toString()&&(z="span")}if(c.behavior&&"none"!=c.behavior.toString()&&this.customRenderer&&(F=!0),l.dataset&&"true"===l.getAttribute("data-math-typeset")&&(F=!0),F){let e=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;O=this.customRenderer(l,e,c)}else O=zn(null);O.then((t=>{if(t)F&&(s="true"==t.getAttribute("data-adapt-process-children"));else{if(c.display===oi.none)return void a.finish(!1);t=this.createElement(M,z)}"a"==z&&t.addEventListener("click",this.page.hrefHandler,!1),"iframe"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI&&function(e){e.addEventListener("load",(()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(e,t){return"mouse-events"===e}}}),!1)}(t);let i=this.nodeContext.inheritedProps["image-resolution"],n=[],r=c.width,o=c.height,h=l.getAttribute("width"),u=l.getAttribute("height"),d=r===oi.auto||!r&&!h,p=o===oi.auto||!o&&!u,f=l.attributes,g=f.length,m=null,b=null;for(let i=0;i<g;i++){let r=f[i],o=r.namespaceURI,s=r.localName,a=r.nodeValue;if(o){if("http://www.w3.org/2000/xmlns/"==o)continue;"http://www.w3.org/1999/xlink"==o&&"href"==s&&(a=this.documentURLTransformer.transformURL(this.resolveURL(a),this.xmldoc.url))}else{if(!hd&&s.match(/^on/)||"style"==s)continue;if(("id"==s||"name"==s)&&e){let e=this.documentURLTransformer.transformFragment(a,this.xmldoc.url);if(!hd||"tr"===t.localName||"http://www.w3.org/2000/svg"===t.namespaceURI&&"svg"!==t.localName||t.ownerDocument.getElementById(a))t.setAttribute(s,e);else{t.setAttribute(s,a),t.setAttribute("data-vivliostyle-id",e);let i=t.ownerDocument.createElement("a");i.setAttribute(s,e),i.setAttribute(Eo,"1"),i.style.position="absolute",t.appendChild(i)}this.page.registerElementWithId(t,e);continue}if("src"==s||"href"==s||"poster"==s)a=this.resolveURL(a),"href"===s&&(a=this.documentURLTransformer.transformURL(a,this.xmldoc.url));else if("srcset"==s)a=a.split(",").map((e=>this.resolveURL(e.trim()))).join(",");else if("data"===s&&F&&"object"===z&&t.hasAttribute("data"))continue;if("poster"===s&&"video"===z&&"http://www.w3.org/1999/xhtml"===M&&d&&p){let e=new Image,i=hr(e,a);B.push(i),n.push({image:e,element:t,fetcher:i})}}if("http://www.w3.org/2000/svg"==M&&/^[A-Z\-]+$/.test(s)&&(s=s.toLowerCase()),this.isSVGUrlAttribute(s)&&(a=md(a,this.xmldoc.url,this.documentURLTransformer)),o){let e=bd[o];e&&(s=`${e}:${s}`)}if("src"!=s||o||"img"!=z&&"input"!=z||"http://www.w3.org/1999/xhtml"!=M)if("alt"!=s||o||"img"!=z||"http://www.w3.org/1999/xhtml"!=M)if("href"==s&&"image"==z&&"http://www.w3.org/2000/svg"==M&&"http://www.w3.org/1999/xlink"==o)this.page.fetchers.push(hr(t,a));else if(o)t.setAttributeNS(o,s,a);else try{t.setAttribute(s,a)}catch(e){P.warn(e)}else b=a;else m=a}if(m){let e="input"===z?new Image:t,s=hr(e,m,b);e!==t&&(t.src=m);let a=()=>{var e,t;if(c.position===oi.fixed)return!0;for(let i=null==(e=this.nodeContext.parent)?void 0:e.viewNode;i&&i!==this.viewRoot;i=i.parentElement)if("fixed"===(null==(t=i.style)?void 0:t.position))return!0;return!1};d||p||(()=>{let e=this.nodeContext.vertical?r:o;return e instanceof Wt&&"%"===e.unit})()||a()?(d&&p&&i&&1!==i&&n.push({image:e,element:t,fetcher:s}),B.push(s)):this.page.fetchers.push(s)}delete c.content;let v=c["list-style-image"];if(v&&v instanceof Yt){let e=v.url;B.push(hr(new Image,e))}if(this.preprocessElementStyle(c),this.applyComputedStyles(t,c),this.nodeContext.inline)e||(Jr(t,"inline-start"),Yr(t)&&Jr(t,"clone"));else if(e){if(!us(c.position)){let e=c["margin-break"],i=this.getBreakTypeAt(this.nodeContext);(e===oi.discard&&null!==i||e!==oi.keep&&"auto"===i&&!this.nodeContext.floatSide)&&Qr(t,"block-start")}}else{let e=this.nodeContext.vertical?"width":"height";se(t,e)&&oe(t,e,"table-row"===this.nodeContext.display?"0.01px":""),Jr(t,"block-start"),Yr(t)&&Jr(t,"clone"),Qr(t,"block-start")}y&&t.setAttribute("value",c["ua-list-item-count"].stringValue()),this.viewNode=t,B.length?Kn(B).then((()=>{i>0&&this.modifyElemDimensionWithImageResolution(n,i,c,this.nodeContext.vertical),a.finish(s)})):a.timeSlice().then((()=>{a.finish(s)}))}))})),a.result()}isInsideNonRootMultiColumn(){var e;for(let t=null==(e=this.nodeContext.parent)?void 0:e.viewNode;t;t=t.parentNode){let e=1===t.nodeType?t.style:null;if(!e)break;if(!isNaN(parseFloat(e.columnCount))||!isNaN(parseFloat(e.columnWidth)))return!0;if("absolute"===e.position)break}return!1}getBreakTypeAt(e){var t,i,n,r,o;for(let n=e;n&&!n.after;n=n.parent){if(to(n.breakBefore))return n.breakBefore;if(1===n.fragmentIndex&&!n.parent)return n.sourceNode===n.sourceNode.ownerDocument.documentElement?"page":null;if(null!=(t=n.parent)&&t.floatSide)return null;let e=null==(i=n.parent)?void 0:i.viewNode;if(e){let t=this.viewport.window.getComputedStyle(e),i=parseFloat(t.paddingBlockStart),r=parseFloat(t.borderBlockStartWidth);if(i||r)return null;let o=null==e?void 0:e.firstChild;for(;o&&(To(o,n.parent.whitespace)||!n.floatSide&&xs(o));)o=o.nextSibling;if(o&&o!==n.viewNode)return null}}let s=null==(o=null==(r=null==(n=this.context)?void 0:n.currentLayoutPosition)?void 0:r.flowPositions[this.flowName])?void 0:o.startBreakType;return to(s)?s:"auto"}processAfterIfcontinues(e,t,i,n){let r=this.getPseudoMap(t,this.regionIds,this.isFootnote,this.nodeContext,n);if(r&&r["after-if-continues"]&&r["after-if-continues"].content){let r=new lh(e,t,i,n,this.exprContentListener);this.nodeContext.afterIfContinues=new uh(e,r)}}isSVGUrlAttribute(t){return e.SVG_URL_ATTRIBUTES.includes(t.toLowerCase())}modifyElemDimensionWithImageResolution(e,t,i,n){e.forEach((e=>{if("load"===e.fetcher.get().get()){let r=e.image,o=r.width/t,s=r.height/t,a=e.element;if(o>0&&s>0)if(i["box-sizing"]===oi.border_box&&(i["border-left-style"]!==oi.none&&(o+=ni(i["border-left-width"],this.context)),i["border-right-style"]!==oi.none&&(o+=ni(i["border-right-width"],this.context)),i["border-top-style"]!==oi.none&&(s+=ni(i["border-top-width"],this.context)),i["border-bottom-style"]!==oi.none&&(s+=ni(i["border-bottom-width"],this.context))),t>1){let e=i["max-width"]||oi.none,t=i["max-height"]||oi.none;if(e===oi.none&&t===oi.none)oe(a,"max-width",`${o}px`);else if(e!==oi.none&&t===oi.none)oe(a,"width",`${o}px`);else if(e===oi.none&&t!==oi.none)oe(a,"height",`${s}px`);else{e.isNumeric(),t.isNumeric();let i=e,r=t;"%"!==i.unit?oe(a,"max-width",`${Math.min(o,ni(i,this.context))}px`):"%"!==r.unit?oe(a,"max-height",`${Math.min(s,ni(r,this.context))}px`):n?oe(a,"height",`${s}px`):oe(a,"width",`${o}px`)}}else if(t<1){let e=i["min-width"]||hi,t=i["min-height"]||hi;e.isNumeric(),e.isNumeric();let r=e,l=t;0===r.num&&0===l.num?oe(a,"min-width",`${o}px`):0!==r.num&&0===l.num?oe(a,"width",`${o}px`):0===r.num&&0!==l.num?oe(a,"height",`${s}px`):"%"!==r.unit?oe(a,"min-width",`${Math.max(o,ni(r,this.context))}px`):"%"!==l.unit?oe(a,"min-height",`${Math.max(s,ni(l,this.context))}px`):n?oe(a,"height",`${s}px`):oe(a,"width",`${o}px`)}}}))}preprocessElementStyle(e){_("PREPROCESS_ELEMENT_STYLE").forEach((t=>{t(this.nodeContext,e)}))}findAndProcessRepeatingElements(e,t){for(let i=e.firstChild;i;i=i.nextSibling){if(1!==i.nodeType)continue;let e={},n=t.getStyle(i,!1);if(this.computeStyle(this.nodeContext.vertical,"rtl"===this.nodeContext.direction,n,e),!this.processRepeatOnBreak(e))continue;if(this.nodeContext.formattingContext instanceof kh&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let r=this.nodeContext.parent,o=r&&r.formattingContext;return this.nodeContext.formattingContext=new kh(o,this.nodeContext.sourceNode),void this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical)}}processRepeatOnBreak(e){let t=e["repeat-on-break"];return t!==oi.none&&((t===oi.auto||ci(t))&&(t=e.display===oi.table_header_group?oi.header:e.display===oi.table_footer_group?oi.footer:oi.none),t&&t!==oi.none)?t.toString():null}createTextNodeView(){let e=Mn("createTextNodeView");return this.preprocessTextContent().then((()=>{let t=this.offsetInNode||0,i=mo(this.nodeContext.preprocessedTextContent).substr(t);this.viewNode=document.createTextNode(i),e.finish(!0)})),e.result()}preprocessTextContent(){if(null!=this.nodeContext.preprocessedTextContent)return zn(!0);let e,t=e=this.sourceNode.textContent,i=Mn("preprocessTextContent"),n=_("PREPROCESS_TEXT_CONTENT"),r=0;return i.loop((()=>r>=n.length?zn(!1):n[r++](this.nodeContext,t).thenAsync((e=>(t=e,zn(!0)))))).then((()=>{this.nodeContext.preprocessedTextContent=function(e,t){return(0,go.default)(e,t,0)}(e,t),i.finish(!0)})),i.result()}createNodeView(e,t){let i,n=Mn("createNodeView"),r=!0;return 1==this.sourceNode.nodeType?i=this.createElementView(e,t):8==this.sourceNode.nodeType?(this.viewNode=null,i=zn(!0)):i=this.createTextNodeView(),i.then((e=>{var t;if(r=e,this.nodeContext.viewNode=this.viewNode,this.viewNode){let e=(e,t)=>1===(null==e?void 0:e.nodeType)&&sh(e)===t,i=this.nodeContext.parent,n=i?e(this.viewNode,"after")&&e(i.viewNode,"first-letter")&&null!=(t=i.viewNode)&&t.hasChildNodes()?i.parent.viewNode:i.viewNode:this.viewRoot;n&&(this.nodeContext.inline&&!(3===this.viewNode.nodeType&&To(this.viewNode))&&!n.hasChildNodes()&&Kr(n).includes("block-start")&&Jr(n,"text-start"),n.appendChild(this.viewNode))}n.finish(r)})),n.result()}setCurrent(e,t,i){return this.nodeContext=e,e?(this.sourceNode=e.sourceNode,this.offsetInNode=e.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(t,!!i):zn(!0)}processShadowContent(e){if(null==e.shadowContext||"content"!=e.sourceNode.localName||"http://www.pyroxy.com/ns/shadow"!=e.sourceNode.namespaceURI)return e;let t,i,n=e.boxOffset,r=e.shadowContext,o=e.parent,s=r.subShadow||r.parentShadow;r.subShadow?(t=r.root,i=r.type,i==Mo.ROOTLESS&&(t=t.firstChild)):(t=r.owner.firstChild,i=Mo.ROOTLESS);let a=e.sourceNode.nextSibling;if(a?(e.sourceNode=a,e.resetView()):e.shadowSibling?e=e.shadowSibling:t?e=null:(e=e.parent.modify()).after=!0,t){let r=new Uo(t,o,n);return r.shadowContext=s,r.shadowType=i,r.shadowSibling=e,r}return e.boxOffset=n,e}nextPositionInTree(e){let t=e.boxOffset+1;if(e.after){if(!e.parent)return null;if(e.shadowType!=Mo.ROOTED){let i=e.sourceNode.nextSibling;if(i)return(e=e.modify()).boxOffset=t,e.sourceNode=i,e.resetView(),this.processShadowContent(e)}return e.shadowSibling?((e=e.shadowSibling.modify()).boxOffset=t,e):((e=e.parent.modify()).boxOffset=t,e.after=!0,e)}{if(e.nodeShadow){let i=e.nodeShadow.root;if(e.nodeShadow.type==Mo.ROOTLESS&&(i=i.firstChild),i){let n=new Uo(i,e,t);return n.shadowContext=e.nodeShadow,n.shadowType=e.nodeShadow.type,this.processShadowContent(n)}}let i=e.sourceNode.firstChild;if(i)return this.processShadowContent(new Uo(i,e,t));if(1!=e.sourceNode.nodeType){t+=mo(e.preprocessedTextContent).length-1-e.offsetInNode}return(e=e.modify()).boxOffset=t,e.after=!0,e}}isTransclusion(e,t,i){let n=ua(t,"hyperlink-processing");if(!n)return!1;let r=n.evaluate(this.context,"hyperlink-processing");return!!r&&r.toString()==i}nextInTree(e,t){let i=this.nextPositionInTree(e);if(!i||i.after)return zn(i);let n=Mn("nextInTree");return this.setCurrent(i,!0,t).then((e=>{(!i.viewNode||!e)&&(i=i.modify(),i.after=!0,i.viewNode||(i.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:i}),n.finish(i)})),n.result()}addImageFetchers(e){if(e instanceof Qt){let t=e.values;for(let e=0;e<t.length;e++)this.addImageFetchers(t[e])}else if(e instanceof Yt){let t=e.url;this.page.fetchers.push(hr(new Image,t))}}applyComputedStyles(e,t){var i,n,r;let o=t["background-image"];o&&this.addImageFetchers(o);let s,a,l=t.position===oi.relative,h=null===(null==(i=this.nodeContext)?void 0:i.parent)&&null===(null==(n=this.sourceNode)?void 0:n.parentElement)&&!(null==(r=this.viewRoot)||!r.parentElement),u=Object.keys(t);u.sort(di);for(let i of u){if(xd[i])continue;let n=t[i];if(n&&(n!==zt||pi(i))){if(n=n.visit(new $i(this.xmldoc.url,this.documentURLTransformer)),n instanceof Wt&&We(n.unit)&&(n="lh"===n.unit?new Wt(n.num*this.getLineHeightUnitSize(i,s,a),"px"):ri(n,this.context)),"font-size"===i?s=n:"line-height"===i&&(a=n),vo[i]||l&&wo[i]){this.page.delayedItems.push(new yo(e,i,n));continue}h&&this.page.pageAreaElement&&ha(i)?oe(this.page.pageAreaElement.parentElement,i,n.toString()):oe(e,i,n.toString())}}}getLineHeightUnitSize(e,t,i){var n,r,o,s;let a=je.lh/je.em,l=1===(null==(r=null==(n=this.nodeContext.parent)?void 0:n.viewNode)?void 0:r.nodeType)?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,h=l?parseFloat(l.fontSize):this.context.fontSize(),u=l?"normal"===l.lineHeight?h*a:parseFloat(l.lineHeight):this.context.rootLineHeight;if("line-height"===e||"font-size"===e)return u;let c=null;if(i){if(i instanceof Gt||i instanceof Wt&&("em"===i.unit||"%"===i.unit))c=i instanceof Wt&&"%"===i.unit?i.num/100:i.num;else if(i instanceof Wt)return i.num*this.context.queryUnitSize(i.unit,!1)}else for(let e=null==(o=this.nodeContext.parent)?void 0:o.viewNode;;e=e.parentNode){if(!e||1!==e.nodeType){c=a;break}let t=null==(s=null==e?void 0:e.style)?void 0:s.lineHeight;if(t){/^[0-9.]+$/.test(t)&&(c=parseFloat(t)),"normal"===t&&(c=a);break}}return null!==c?t instanceof Wt?c*xa(t,h,this.context).num:c*h:u}applyPseudoelementStyle(e,t,i){if(e.after)return;let n=this.sourceNode,r=(e.shadowContext?e.shadowContext.styler:this.styler).getStyle(n,!1),o=da(r,"_pseudos");if(!o||(r=o[t],!r))return;let s={};e.vertical=this.computeStyle(e.vertical,"rtl"===e.direction,r,s);let a=s.content;Xo(a)&&(a.visit(new qo(i,this.context,a,this.exprContentListener)),delete s.content),this.applyComputedStyles(i,s)}peelOff(e,t){let i=Mn("peelOff"),n=e.firstPseudo,r=e.offsetInNode,o=e.after;if(t>0){let i=e.viewNode.textContent;e.viewNode.textContent=i.substr(0,t),r+=t}else if(!o&&e.viewNode&&0==r){let t=e.viewNode.parentNode;t&&t.removeChild(e.viewNode)}let s=e.boxOffset+t,a=[];for(;e.firstPseudo===n;)a.push(e),e=e.parent;let l=a.pop(),h=l.shadowSibling;return i.loop((()=>{for(;a.length>0;){l=a.pop(),e=new Uo(l.sourceNode,e,s),0==a.length&&(e.offsetInNode=r,e.after=o),e.shadowType=l.shadowType,e.shadowContext=l.shadowContext,e.nodeShadow=l.nodeShadow,e.shadowSibling=l.shadowSibling?l.shadowSibling:h,h=null;let t=this.setCurrent(e,!1);if(t.isPending())return t}return zn(!1)})).then((()=>{i.finish(e)})),i.result()}createElement(e,t){return"http://www.w3.org/1999/xhtml"==e?this.document.createElement(t):this.document.createElementNS(e,t)}applyFootnoteStyle(e,t,i){let n={},r=da(this.footnoteStyle,"_pseudos");if(e=this.computeStyle(e,t,this.footnoteStyle,n),r&&r.before){let n={},o=this.createElement("http://www.w3.org/1999/xhtml","span");ah(o,"before"),i.appendChild(o),this.computeStyle(e,t,r.before,n),delete n.content,this.applyComputedStyles(o,n)}return delete n.content,this.applyComputedStyles(i,n),e}processFragmentedBlockEdge(e){var t,i,n;let r=!e.inline&&e.after?e.parent:e,o=!1;if(e.inline&&e.after&&!e.shadowContext&&1===(null==(t=e.sourceNode.nextSibling)?void 0:t.nodeType)){let t=e.sourceNode.nextSibling,n=null==(i=ua(this.styler.getStyle(t,!1),"display"))?void 0:i.value.toString();o=n&&!fs(n)||"true"===t.getAttribute("data-math-typeset")&&/^\s*(\$\$|\\\[)/.test(t.textContent)}let s=0;for(let e=r;e;e=e.parent){if(1!==(null==(n=e.viewNode)?void 0:n.nodeType))continue;let t=e.viewNode;if(t.style)if(e.inline){if(Jr(t,"inline-end"),Yr(t)){let i=e.vertical?t.offsetWidth:t.offsetHeight;Jr(t,"clone"),(e.vertical?t.offsetWidth:t.offsetHeight)>i&&this.fixClonedBoxDecorationOverflow(t)}}else{let i=this.nodeContext.vertical?"width":"height";if(se(t,i)&&oe(t,i,""),Jr(t,"block-end"),!s++&&e!==r){let{textAlign:e}=this.viewport.window.getComputedStyle(t);if("justify"!==e||o)Jr(t,"text-end");else{let e=this.createChildAnonymousBlockIfNeeded(t);e?e!==t?Zr(e,["block-start","text-start","block-end","text-end","justify"]):(Jr(t,"text-end"),Jr(t,"justify")):Jr(t,"text-end")}}Yr(t)&&Jr(t,"clone"),Qr(t,"block-end")}}}fixClonedBoxDecorationOverflow(e){let t=this.viewport.window.getComputedStyle(e),i=-(parseFloat(t.paddingInlineEnd)+parseFloat(t.borderInlineEndWidth));isNaN(i)||(e.style.marginInlineEnd=`${i}px`)}createChildAnonymousBlockIfNeeded(e){let t=e=>{let{display:i,position:n,float:r}=this.viewport.window.getComputedStyle(e);if("ruby"===e.localName||Se[e.localName])return!1;if("br"===e.localName)return!0;if(("inline"===i||"contents"===i)&&e.hasChildNodes()){let i=e.lastElementChild;if(i&&(!i.nextSibling||i.nextSibling===e.lastChild&&To(i.nextSibling))){let e=t(i);if(e||null===e)return e}for(let e=null==i?void 0:i.previousElementSibling;e;e=e.previousElementSibling){let i=t(e);if(i||null===i)return null}return!1}if("none"===i||"absolute"===n||"fixed"===n||r&&"none"!==r||e.hasAttribute(Eo)){let i=e.previousElementSibling;return!(!i||!(i.nextSibling===e||i.nextSibling===e.previousSibling&&To(i.nextSibling)))&&t(i)}return!(!i||fs(i))},i=null;for(let n=e.lastElementChild;n;n=n.previousElementSibling){let e=t(n);if(e){i=n;break}if(null===e)return null}if(!i)return e;if(i===e.lastElementChild&&(!i.nextSibling||i.nextSibling===e.lastChild&&To(i.nextSibling)))return null;let n=e.ownerDocument.createElement("span");n.className="viv-anonymous-block";for(let e=i.nextSibling,t=null;e;e=t)t=e.nextSibling,n.appendChild(e);return e.appendChild(n),n}convertLengthToPx(e,t,i){let n=e.num,r=e.unit;if(function(e){switch(null==e?void 0:e.toLowerCase()){case"em":case"ex":case"rem":case"lh":case"rlh":return!0;default:return!1}}(r)){let n=t;for(;n&&1!==n.nodeType;)n=n.parentNode;let r=parseFloat(i.getElementComputedStyle(n)["font-size"]);return this.context,ya(e,r,this.context).num}{let t=this.context.queryUnitSize(r,!1);return t?n*t:e}}isSameNodePositionStep(e,t){if(e.shadowContext){if(!t.shadowContext)return!1;let i=1===e.node.nodeType?e.node:e.node.parentElement,n=1===t.node.nodeType?t.node:t.node.parentElement;return e.shadowContext.owner===t.shadowContext.owner&&sh(i)===sh(n)}return e.node===t.node}isSameNodePosition(e,t){return e.offsetInNode===t.offsetInNode&&e.after==t.after&&e.steps.length===t.steps.length&&e.steps.every(((e,i)=>{let n=t.steps[i];return this.isSameNodePositionStep(e,n)}))}isPseudoelement(e){return!!sh(e)}};l(vd,"SVG_URL_ATTRIBUTES",["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"]);var wd,yd=vd,xd={"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,"margin-break":!0,page:!0},Sd=null,Cd=class{constructor(e){l(this,"layoutBox"),l(this,"window"),l(this,"scaleRatio"),this.layoutBox=e.layoutBox,this.window=e.window,this.scaleRatio=e.scaleRatio}scaleRect(e){return Sd?{left:e.left*this.scaleRatio,top:e.top*this.scaleRatio,right:e.right*this.scaleRatio,bottom:e.bottom*this.scaleRatio,width:e.width*this.scaleRatio,height:e.height*this.scaleRatio}:e}subtractOffsets(e,t){let i=t.left,n=t.top;return{left:e.left-i,top:e.top-n,right:e.right-i,bottom:e.bottom-n,width:e.width,height:e.height}}getRangeClientRects(e){let t=e.getClientRects(),i=this.layoutBox.getBoundingClientRect();return Array.from(t).map((e=>this.scaleRect(this.subtractOffsets(e,i))))}getElementClientRect(e){let t=e.getBoundingClientRect();if(0===t.left&&0===t.top&&0===t.right&&0===t.bottom)return t;let i=this.layoutBox.getBoundingClientRect();return this.scaleRect(this.subtractOffsets(t,i))}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}adjustLengthValue(e){let t=64*(this.scaleRatio||1);return Math.floor(e*t)/t}},kd=class{constructor(e,t,i,n,r,o){this.window=e,this.fontSize=t,this.pixelRatio=i,l(this,"document"),l(this,"root"),l(this,"outerZoomBox"),l(this,"contentContainer"),l(this,"layoutBox"),l(this,"width"),l(this,"height"),l(this,"scaleRatio",1),this.document=e.document,this.root=n||this.document.body;let s=this.root.firstElementChild;s||(s=this.document.createElement("div"),s.setAttribute("data-vivliostyle-outer-zoom-box","true"),this.root.appendChild(s));let a=s.firstElementChild;a||(a=this.document.createElement("div"),a.setAttribute("data-vivliostyle-spread-container","true"),s.appendChild(a)),i>0&&CSS.supports("zoom","8")&&(oe(this.root,"--viv-outputPixelRatio",`${i}`),oe(this.root,"--viv-devicePixelRatio",`${e.devicePixelRatio}`),this.scaleRatio=i/e.devicePixelRatio,null===Sd&&(Sd=!("currentCSSZoom"in a)),Sd&&oe(this.root,"--viv-scaleRectRatio",`${this.scaleRatio}`));let h=s.nextElementSibling;h||(h=this.document.createElement("div"),h.setAttribute("data-vivliostyle-layout-box","true"),this.root.appendChild(h)),this.outerZoomBox=s,this.contentContainer=a,this.layoutBox=h,this.width=r||parseFloat(e.getComputedStyle(this.root).width)||this.root.offsetWidth||e.innerWidth,this.height=o||parseFloat(e.getComputedStyle(this.root).height)||this.root.offsetHeight||e.innerHeight;let u=794,c=1056,d=!e.outerWidth&&!e.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&800===e.innerWidth&&600===e.innerHeight;(!this.width||!r&&d)&&(this.width=u),(!this.height||!o&&d)&&(this.height=c)}resetZoom(){oe(this.outerZoomBox,"width",""),oe(this.outerZoomBox,"height",""),oe(this.contentContainer,"width",""),oe(this.contentContainer,"height",""),oe(this.contentContainer,"transform","")}zoom(e,t,i){oe(this.root,"--viv-outputScale",`${i}`),oe(this.outerZoomBox,"width",e*i+"px"),oe(this.outerZoomBox,"height",t*i+"px"),oe(this.contentContainer,"width",`${e}px`),oe(this.contentContainer,"height",`${t}px`)}clear(){let e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}},Ed=class{constructor(e,t,i){this.store=e,this.url=t,this.document=i,l(this,"lang",null),l(this,"totalOffset",-1),l(this,"root"),l(this,"body"),l(this,"head"),l(this,"last"),l(this,"lastOffset",1),l(this,"idMap"),this.root=i.documentElement;let n=null,r=null;if("http://www.w3.org/1999/xhtml"==this.root.namespaceURI){for(let e=this.root.firstChild;e;e=e.nextSibling){if(1!=e.nodeType)continue;let t=e;if("http://www.w3.org/1999/xhtml"==t.namespaceURI)switch(t.localName){case"head":r=t;break;case"body":n=t}}this.lang=this.root.getAttribute("lang")}this.body=n,this.head=r,this.last=this.root,this.last.setAttribute($,"0")}doc(){return new Rd([this.document])}getElementOffset(e){let t=e.getAttribute($);if(t)return parseInt(t,10);let i=this.lastOffset,n=this.last;for(;n!=e;){let e=n.firstChild;if(!e)for(;e=n.nextSibling,!e;)if(n=n.parentNode,null==n)throw new Error("Internal error");n=e,1==e.nodeType?(e.setAttribute($,i.toString()),++i):i+=e.textContent.length}return this.lastOffset=i,this.last=e,i-1}getNodeOffset(e,t,i){let n=0,r=e,o=null;if(1==r.nodeType){if(!i)return this.getElementOffset(r)}else{if(n=t,o=r.previousSibling,!o)return r=r.parentNode,n+=1,this.getElementOffset(r)+n;r=o}for(;;){for(;r.lastChild;)r=r.lastChild;if(1==r.nodeType)break;if(n+=r.textContent.length,o=r.previousSibling,!o){r=r.parentNode;break}r=o}return n+=1,this.getElementOffset(r)+n}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t,i=this.root;for(;;){if(t=this.getElementOffset(i),t>=e)return i;let n=i.children;if(!n)break;let r=be(n.length,(t=>{let i=n[t];return this.getElementOffset(i)>e}));if(0==r)break;i=n[r-1]}let n=t+1,r=i,o=r.firstChild||r.nextSibling,s=null;for(;;){if(o){if(1==o.nodeType||(r=o,s=r,n+=o.textContent.length,n>e&&!/^\s*$/.test(o.textContent)))break}else if(r=r.parentNode,!r)break;o=r.nextSibling}return o&&s&&/^\s*$/.test(s.textContent)&&(s=o),s||i}buildIdMap(e){let t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);let i=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");i&&!this.idMap[i]&&(this.idMap[i]=e);for(let t=e.firstElementChild;t;t=t.nextElementSibling)this.buildIdMap(t)}getElement(e){let t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;let i=t[2],n=this.document.getElementById(i);return!n&&this.document.getElementsByName&&(n=this.document.getElementsByName(i)[0]),n||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),n=this.idMap[i]),n}},Pd=((wd=Pd||{}).TEXT_HTML="text/html",wd.TEXT_XML="text/xml",wd.APPLICATION_XML="application/xml",wd.APPLICATION_XHTML_XML="application/xhtml+xml",wd.IMAGE_SVG_XML="image/svg+xml",wd);function Nd(e,t,i){let n,r=i||new DOMParser;try{n=r.parseFromString(e,t)}catch(e){}if(!n)return null;{let e=n.documentElement,t="parsererror";if(e.localName===t)return null;for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(i.localName===t)return null}return n}function Td(e,t){let i=e.responseXML;if(!i){let t=new DOMParser,n=e.responseText;if(n){let r=function(e){let t=e.contentType;if(t){let e=Object.keys(Pd);for(let i=0;i<e.length;i++)if(Pd[e[i]]===t)return t;if(t.match(/\+xml$/))return"application/xml"}let i=e.url.match(/\.([^./]+)$/);if(i)switch(i[1]){case"html":case"htm":return"text/html";case"xhtml":case"xht":return"application/xhtml+xml";case"svg":case"svgz":return"image/svg+xml";case"opf":case"xml":return"application/xml"}return null}(e);if(i=Nd(n,r||"application/xml",t),i&&!r){let e=i.documentElement;"html"!==e.localName.toLowerCase()||e.namespaceURI?"svg"===e.localName.toLowerCase()&&"image/svg+xml"!==i.contentType&&(i=Nd(n,"image/svg+xml",t)):i=Nd(n,"text/html",t)}i||(i=Nd(n,"text/html",t))}}return zn(i?new Ed(t,e.url,i):null)}var Id=new class e{constructor(e){this.fn=e}check(e){return this.fn(e)}withAttribute(t,i){return new e((e=>this.check(e)&&1==e.nodeType&&e.getAttribute(t)==i))}withChild(t,i){return new e((e=>{if(!this.check(e))return!1;let n=new Rd([e]);return n=n.child(t),i&&(n=n.predicate(i)),n.size()>0}))}}((e=>!0)),Rd=class e{constructor(e){this.nodes=e}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let i=[];for(let e of this.nodes)t.check(e)&&i.push(e);return new e(i)}forEachNode(t){let i=[],n=e=>{i.push(e)};for(let e=0;e<this.nodes.length;e++)t(this.nodes[e],n);return new e(i)}forEach(e){let t=[];for(let i=0;i<this.nodes.length;i++)t.push(e(this.nodes[i]));return t}forEachNonNull(e){let t=[];for(let i=0;i<this.nodes.length;i++){let n=e(this.nodes[i]);null!=n&&t.push(n)}return t}child(e){return this.forEachNode(((t,i)=>{for(let n=t.firstChild;n;n=n.nextSibling)1==n.nodeType&&n.localName==e&&i(n)}))}childElements(){return this.forEachNode(((e,t)=>{for(let i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&t(i)}))}attribute(e){return this.forEachNonNull((t=>1==t.nodeType?t.getAttribute(e):null))}textContent(){return this.forEach((e=>e.textContent))}},_d=new Yn((()=>{let e=Mn("uaStylesheetBase"),t=Wu(),i=Z("user-agent-base.css",Y),n=new Sl(null,null,null,null,null,t,!0);return n.startStylesheet("UA"),function(e){xl=e}(n.cascade),Fr(ir,n,i,null,null).thenFinish(e),e.result()}),"uaStylesheetBaseFetcher"),Ad=class{constructor(e,t,i,n,r,o,s,a,h,u){this.store=e,this.rootScope=t,this.pageScope=i,this.cascade=n,this.rootBox=r,this.fontFaces=o,this.footnoteProps=s,this.flowProps=a,this.viewportProps=h,this.pageProps=u,l(this,"fontDeobfuscator"),l(this,"validatorSet"),this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",(function(e){let t=this,i=t.currentLayoutPosition,n=i.firstFlowChunkOfFlow(e);return t.matchPageSide(i.startSideOfFlow(e))&&i.hasContent(e,t.lookupOffset)&&!!n&&!t.flowChunkIsAfterParentFlowForcedBreak(n)})),this.pageScope.defineName("page-number",new St(this.pageScope,(function(){return this.pageNumberOffset+this.currentLayoutPosition.page}),"page-number")),this.pageScope.defineName("blank-page",new St(this.pageScope,(function(){let e=this.currentLayoutPosition;return null==e?void 0:e.isBlankPage}),"blank-page"))}sizeViewport(e,t,i,n){if(this.viewportProps.length){let r=new Ge(this.rootScope,e,t,i),o=function(e,t){let i={};for(let n=0;n<t.length;n++)ba(e,i,t[n],0,null,null,null);return i}(r,this.viewportProps),s=o.width,a=o.height,l=o["text-zoom"],h=1;if(s&&a||l){let o=je.em;if((l?l.evaluate(r,"text-zoom"):null)===oi.scale&&(h=o/i,i=o,e*=h,t*=h),s&&a){let e=ni(s.evaluate(r,"width"),r),t=ni(a.evaluate(r,"height"),r);if(e>0&&t>0)return{width:n&&n.spreadView?2*(e+n.pageBorder):e,height:t,fontSize:i}}}}return{width:e,height:t,fontSize:i}}},Ld=class extends Ge{constructor(e,t,i,n,r,o,s,a,h,u,c,d,p){super(e.rootScope,n.width,n.height,n.fontSize),this.style=e,this.xmldoc=t,this.viewport=n,this.clientLayout=r,this.fontMapper=o,this.customRenderer=s,this.fallbackMap=a,this.pageNumberOffset=h,this.documentURLTransformer=u,this.counterStore=c,l(this,"lang"),l(this,"primaryFlows",{body:!0}),l(this,"rootPageBoxInstance",null),l(this,"styler",null),l(this,"stylerMap",null),l(this,"currentLayoutPosition",null),l(this,"layoutPositionAtPageStart",null),l(this,"lookupOffset",0),l(this,"faces"),l(this,"pageBoxInstances",{}),l(this,"pageManager",null),l(this,"rootPageFloatLayoutContext"),l(this,"pageBreaks",{}),l(this,"pageProgression",null),l(this,"isVersoFirstPage",!1),l(this,"blankPageAtStart",!1),l(this,"pageSheetSize",{}),l(this,"pageSheetHeight",0),l(this,"pageSheetWidth",0),this.lang=t.lang||i,this.faces=new Ku(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new is(null,null,null,null,null,null,null),this.pageProgression=d||null,this.isVersoFirstPage=!!p;for(let t in e.flowProps){let i=ua(e.flowProps[t],"flow-consume");i&&(i.evaluate(this,"flow-consume")==oi.all?this.primaryFlows[t]=!0:delete this.primaryFlows[t])}}init(){let e=Mn("StyleInstance.init"),t=this.counterStore.createCounterListener(this.xmldoc.url),i=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new wu(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,t,i),i.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let n=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=Ec(n)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(0===this.pageNumberOffset?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let r=this.style.rootBox;this.rootPageBoxInstance=new bc(r);let o=this.style.cascade.createInstance(this,t,i,this.lang);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(o,n),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new Zc(o,this.style.pageScope,this.rootPageBoxInstance,this,n);let s=[];for(let e of this.style.fontFaces){if(e.condition&&!e.condition.evaluate(this))continue;let t=Xu(e.properties,this),i=new Yu(t);s.push(i)}this.fontMapper.findOrLoadFonts(s,this.faces).then((()=>{(function(e,t,i){if(!hd)return zn(!1);let n=dd(e);if(0===n.length)return zn(!1);let r=n.some((e=>!(e.async||e.defer||"module"===e.type))),o=r?fd(e,t,i):null,s=t.document.fonts,a=t.$,l=!1,h=Mn("loadScripts");return h.loop((()=>{if(0===n.length)return r?h.sleep(20).thenAsync((()=>{var e,i;return"loading"===s.status||t.document.documentElement.classList.contains("wf-loading")||null!=(e=t.FontJSON)&&e.Font&&null!=(i=t.ret)&&i.readyState&&t.ret.readyState<4?zn(!0):zn(!1)})):zn(!1);let e=n.shift();return pd(e,t,{inHead:!0,forceDefer:l}).thenAsync((()=>(!l&&t.$!==a&&(ud.push(e),l=!0),0===n.length&&r&&(P.debug("dispatchEvent: DOMContentLoaded (document)"),t.document.dispatchEvent(new Event("DOMContentLoaded"))),zn(!0))))})).then((()=>{o&&o.remove(),h.finish(!0)})),h.result()})(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)}));let a=this.style.pageProps;return a[""]||(a[""]={}),Object.keys(a).forEach((e=>{let t=a[e];this.styler.cascade.applyVarFilter([t],this.styler,null),this.styler.cascade.applyCalcFilter(t,this.styler.context);let i=_c(Rc(t),this);this.pageSheetSize[e]={width:i.pageWidth+2*i.cropOffset,height:i.pageHeight+2*i.cropOffset}})),e.result()}matchStartPageSide(e){let t=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),i="ltr"==this.pageProgression;switch(e){case"left":return t!==i;case"right":return t===i;case"recto":return t;case"verso":return!t;default:return!0}}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){let i=this.style.store.getStyleForDoc(e),n=new Ge(i.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),r=this.counterStore.createCounterListener(e.url),o=this.counterStore.createCounterResolver(e.url,i.rootScope,i.pageScope);t=new wu(e,i.cascade,i.rootScope,n,this.primaryFlows,i.validatorSet,r,o),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){let i=this.currentLayoutPosition;if(i){i.flows[e.flowName]?t=i.flows[e.flowName]:i.flows[e.flowName]=t;let n=i.flowPositions[e.flowName];n||(n=new jo,i.flowPositions[e.flowName]=n);let r=function(e){return{steps:[{node:e,shadowType:Mo.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}(e.element),o=new Ho(r),s=new $o(o,e);n.positions.push(s)}}evalSupportsTest(e,t,i){if(i)return"selector"===e&&this.evalSupportsSelector(t);if(!e)return!1;let n=!0;let r=new class{unknownProperty(e,t){n=!1}invalidPropertyValue(e,t){n=!1}simpleProperty(e,t,i){}},o=Mr(this.style.rootScope,new Ln(t,null),"");return!!o&&(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,o,!1,r),n)}evalSupportsSelector(e){let t=new Fd(null),i=new Ln(e+"{}",t);return!!new Ar(br,i,t,"").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)&&!t.cascadeParserHandler.invalid}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let i=0;i<e.positions.length;i++){let n=e.positions[i].chunkPosition.primary,r=n.steps[0].node,o=n.offsetInNode,s=n.after,a=0;for(;r.ownerDocument!=this.xmldoc.document;)a++,r=n.steps[a].node,s=!1,o=0;let l=this.xmldoc.getNodeOffset(r,o,s);l<t&&(t=l)}return t}getPosition(e,t){if(!e)return 0;let i=Number.POSITIVE_INFINITY;for(let n in this.primaryFlows){let r=e.flowPositions[n];if(!t&&(!r||0==r.positions.length)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(n),r=this.currentLayoutPosition.flowPositions[n],e!=this.currentLayoutPosition&&r&&(r=r.clone(),e.flowPositions[n]=r)),r){let e=this.getConsumedOffset(r);e<i&&(i=e)}}return i}dumpLocation(e){P.debug("Location - page",this.currentLayoutPosition.page),P.debug("  current:",e),P.debug("  lookup:",this.lookupOffset);for(let e in this.currentLayoutPosition.flowPositions){let t=this.currentLayoutPosition.flowPositions[e];for(let i of t.positions)P.debug("  Chunk",`${e}:`,i.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new yt(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let t in e.flowPositions){let i=e.flowPositions[t];if(i&&i.positions.length>0){let e=i.positions[0].flowChunk;if(this.getConsumedOffset(i)===e.startOffset){let e=i.positions[0].flowChunk.breakBefore,t=i.startBreakType;i.startBreakType=ao(so(t,e))}}}}selectPageMaster(e){let t=this.currentLayoutPosition,i=this.getPosition(t);if(i==Number.POSITIVE_INFINITY)return null;let n,r=this.rootPageBoxInstance.children;for(let o=0;o<r.length;o++){if(n=r[o],n.pageBox.pseudoName===Vc)continue;let s=1;n.pageBox.pseudoName===mc&&(!this.actualPageWidth||!this.actualPageHeight)&&(s=1/0);let a=n.getProp(this,"utilization");a&&a.isNum()&&(s=a.num);let l=this.queryUnitSize("em",!1),h=this.pageWidth()*this.pageHeight(),u=Math.ceil(s*h/(l*l)),c=this.styler.cascade.currentPageType;this.lookupOffset=this.styler.styleUntil(i,u),this.styler.cascade.currentPageType=c,this.updateStartSide(t),this.layoutPositionAtPageStart=t.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let d=n.getProp(this,"enabled");if(!d||d===oi._true){if(1===t.page&&this.blankPageAtStart){n.style={};let t=e.size;e={},t&&(e.size=t)}return this.pageManager.getPageRulePageMaster(n,e)}}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){let t=this.layoutPositionAtPageStart.flows,i=t[e.flowName].parentFlowName;if(i){let n=e.startOffset,r=t[i].forcedBreakOffsets;if(!r.length||n<r[0])return!1;let o=be(r.length,(e=>r[e]>n))-1,s=r[o],a=this.layoutPositionAtPageStart.flowPositions[i],l=this.getConsumedOffset(a);return!(s<l)&&(l<s||!this.matchPageSide(a.startBreakType))}return!1}setFormattingContextToColumn(e,t){let i=this.currentLayoutPosition.flows[t];i.formattingContext||(i.formattingContext=new Rs(null)),e.flowRootFormattingContext=i.formattingContext}layoutDeferredPageFloats(e){let t=e.pageFloatLayoutContext,i=t.getDeferredPageFloatContinuations(),n=e=>{if(e.floatReference!==Yo.PAGE)return!1;let t=this.layoutPositionAtPageStart.flowPositions.body,i=t&&this.getConsumedOffset(t),n=this.xmldoc.getNodeOffset(e.nodePosition.steps[0].node,0,!1);return null!=n&&null!=i&&n>i},r=Mn("layoutDeferredPageFloats"),o=!1,s=0;return r.loopWithFrame((r=>{if(s===i.length)return void r.breakLoop();let a=i[s++],l=a.float;if(n(l))return void r.breakLoop();let h=(new rs).findByFloat(l),u=h.findPageFloatFragment(l,t);if(!u||!u.hasFloat(l))return t.isForbidden(l)||t.hasPrecedingFloatsDeferredToNext(l)?(t.deferPageFloat(a),void r.breakLoop()):void e.layoutPageFloatInner(a,h,null,u).then((e=>{if(!e)return void r.breakLoop();let i=t.parent.isInvalidated();i?r.breakLoop():(t.isInvalidated()&&!i&&(o=!0,t.validate()),r.continueLoop())}));r.continueLoop()})).then((()=>{o&&t.invalidate(),r.finish(!0)})),r.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0){if(e.lastAfterPosition){let i;return t?(i=t.clone(),i.primary=e.lastAfterPosition):i=new Ho(e.lastAfterPosition),i}return null}return null}layoutColumn(e,t){let i=this.currentLayoutPosition.flowPositions[t];if(!i||!this.matchPageSide(i.startBreakType))return zn(!0);this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);let n=Mn("layoutColumn");return this.layoutDeferredPageFloats(e).then((()=>{if(e.pageFloatLayoutContext.isInvalidated())return void n.finish(!0);let r=[],o=[],s=!0;n.loopWithFrame((n=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t))n.breakLoop();else{for(;i.positions.length-o.length>0;){let t=0;for(;o.includes(t);)t++;let a=i.positions[t];if(a.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(a.flowChunk))break;for(let e=t+1;e<i.positions.length;e++){if(o.includes(e))continue;let n=i.positions[e];if(n.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(n.flowChunk))break;n.flowChunk.isBetter(a.flowChunk)&&(a=n,t=e)}let l=a.flowChunk,h=!0;if(e.layout(a.chunkPosition,s,i.breakAfter).then((u=>{if(e.pageFloatLayoutContext.isInvalidated())n.breakLoop();else{if(s=!1,a.flowChunk.repeated&&(null===u||l.exclusive)&&r.push(t),l.exclusive)return o.push(t),void n.breakLoop();{let s=!!u||!!e.pageBreakType,l=this.getLastAfterPositionIfDeferredFloatsExists(e,u);if(e.pageBreakType&&l?(a.chunkPosition=l,i.breakAfter=e.pageBreakType,e.pageBreakType=null):(o.push(t),(u||l)&&(a.chunkPosition=u||l,r.push(t)),i.startBreakType=ao(e.pageBreakType)),s)return void n.breakLoop()}e.forceNonfitting=!1,h?h=!1:n.continueLoop()}})),h)return void(h=!1)}n.breakLoop()}})).then((()=>{if(!e.pageFloatLayoutContext.isInvalidated()){i.positions=i.positions.filter(((e,t)=>r.includes(t)||!o.includes(t))),"column"===i.breakAfter&&(i.breakAfter=null),e.saveDistanceToBlockEndFloats();let t=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(t)}n.finish(!0)}))})),n.result()}createLayoutConstraint(e){let t=this.currentLayoutPosition.page-1,i=this.counterStore.createLayoutConstraint(t);return new gh([i].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,i,n,r,o,s,a,l,h,u,c,d,p){let f,g=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,m=r.element,b=new is(a,Yo.COLUMN,null,s,null,null,null),v=this.currentLayoutPosition.clone(),w=Mn("createAndLayoutColumn");return w.loopWithFrame((e=>{let w=this.createLayoutConstraint(b);if(l>1){let e=this.viewport.document.createElement("div");if(oe(e,"position","absolute"),m.appendChild(e),f=new bh(e,d,this.clientLayout,w,b),f.forceNonfitting=p,f.vertical=r.vertical,f.rtl=r.rtl,f.snapHeight=r.snapHeight,f.snapWidth=r.snapWidth,r.vertical){let e=(r.rtl?l-o-1:o)*(u+h)+r.paddingTop,t=parseFloat(m.style.width);f.setHorizontalPosition(r.paddingLeft+t-r.width,r.width),f.setVerticalPosition(e,u)}else{let e=(r.rtl?l-o-1:o)*(u+h)+r.paddingLeft;f.setVerticalPosition(r.paddingTop,r.height),f.setHorizontalPosition(e,u)}f.originX=t,f.originY=i}else f=new bh(m,d,this.clientLayout,w,b),f.copyFrom(r);f.exclusions=g?[]:n.concat(),f.innerShape=c,b.setContainer(f),(f.vertical?f.height:f.width)>=0?this.layoutColumn(f,s).then((()=>{b.isInvalidated()||b.finish(),f.pageFloatLayoutContext.isInvalidated()&&!a.isInvalidated()?(f.pageFloatLayoutContext.validate(),this.currentLayoutPosition=v.clone(),f.element!==m&&m.removeChild(f.element),e.continueLoop()):e.breakLoop()})):(b.finish(),e.breakLoop())})).then((()=>{w.finish(f)})),w.result()}setPagePageFloatLayoutContextContainer(e,t,i){(t instanceof Yc||t instanceof vc&&!(t instanceof Wc))&&e.setContainer(i)}getRegionPageFloatLayoutContext(e,t,i,n){let r=t.getProp(this,"writing-mode")||null,o=t.getProp(this,"direction")||null;return new is(e,Yo.REGION,i,n,null,r,o)}layoutFlowColumnsWithBalancing(e,t,i,n,r,o,s,a,l){let h=this.currentLayoutPosition.clone(),u=this.getRegionPageFloatLayoutContext(o,t,s,a),c=!0,d=()=>(this.currentLayoutPosition=h.clone(),this.layoutFlowColumns(e,t,i,n,r,o,u,s,a,l,c).thenAsync((e=>zn(e?{columns:e,position:this.currentLayoutPosition}:null))));return d().thenAsync((e=>{if(!e)return zn(null);if(l<=1)return zn(e.columns);let i=t.getProp(this,"column-fill")||oi.balance,n=this.currentLayoutPosition.flowPositions[a],r=function(e,t,i,n,r,o,s){if(t===oi.auto)return null;{let a=0===s.positions.length,l=o[o.length-1],h=!(!l||!l.pageBreakType);return a||h?new du(i,n,r,e):t===oi.balance_all?new fu(i,n,r):null}}(l,i,d,u,s,e.columns,n);return r?(c=!1,o.lock(),u.lock(),r.balanceColumns(e).thenAsync((e=>(o.unlock(),o.validate(),u.unlock(),this.currentLayoutPosition=e.position,zn(e.columns))))):zn(e.columns)}))}layoutFlowColumns(e,t,i,n,r,o,s,a,l,h,u){let c=Mn("layoutFlowColumns"),d=this.currentLayoutPosition.clone(),p=t.getPropAsNumber(this,"column-gap"),f=h>1?t.getPropAsNumber(this,"column-width"):a.vertical?a.height:a.width,g=t.getActiveRegions(this),m=Vi(t.getProp(this,"shape-inside"),0,0,a.width,a.height,this),b=new yd(l,this,this.viewport,this.styler,g,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),v=0,w=null,y=[];return c.loopWithFrame((e=>{this.createAndLayoutColumn(t,i,n,r,a,v++,l,s,h,p,f,m,b,u).then((t=>o.isInvalidated()?(y=null,void e.breakLoop()):((!!t.pageBreakType&&"column"!==t.pageBreakType||v===h)&&!s.isInvalidated()&&s.finish(),s.isInvalidated()?(v=0,this.currentLayoutPosition=d.clone(),s.validate(),void(s.isLocked()?(y=null,e.breakLoop()):e.continueLoop())):(w=t,y[v-1]=w,w.pageBreakType&&"column"!=w.pageBreakType&&(v=h,"region"!=w.pageBreakType&&(this.pageBreaks[l]=!0)),void(v<h?e.continueLoop():e.breakLoop())))))})).then((()=>{c.finish(y)})),c.result()}layoutContainer(e,t,i,n,r,o,s){t.reset();let a=t.getProp(this,"enabled");if(a&&a!==oi._true)return zn(!0);let l=Mn("layoutContainer"),h=t.getProp(this,"wrap-flow")===oi.auto,u=t.getProp(this,"flow-from"),c=this.viewport.document.createElement("div"),d=t.getProp(this,"position");oe(c,"position",d?d.name:"absolute");let p=t instanceof Wc;t instanceof yc?i.appendChild(c):i.insertBefore(c,i.firstChild);let f=new Go(c);f.vertical=t.vertical,f.rtl=t.rtl,f.exclusions=o,t.prepareContainer(this,f,e,this.faces,this.clientLayout),t instanceof Wc&&(f.width<=0||f.height<=0)&&P.warn("Negative or zero page area size"),f.originX=n,f.originY=r,n+=f.left+f.marginLeft+f.borderLeft,r+=f.top+f.marginTop+f.borderTop,this.setPagePageFloatLayoutContextContainer(s,t,f);let g,m=!1;if(u&&u.isIdent())if(this.pageBreaks[u.toString()])s.isInvalidated()||t.finishContainer(this,f,e,null,1,this.clientLayout,this.faces),g=zn(!0);else{let i=Mn("layoutContainer.inner"),a=u.toString(),l=t.getPropAsNumber(this,"column-count");this.layoutFlowColumnsWithBalancing(e,t,n,r,o,s,f,a,l).then((n=>{if(!s.isInvalidated()){let i=n[0];i.element===c&&(f=i),f.computedBlockSize=Math.max.apply(null,n.map((e=>e.computedBlockSize))),t.finishContainer(this,f,e,i,l,this.clientLayout,this.faces);let r=this.currentLayoutPosition.flowPositions[a];r&&"region"===r.breakAfter&&(r.breakAfter=null)}i.finish(!0)})),g=i.result()}else{let n=t.getProp(this,"content");if(n instanceof ti&&n.expr instanceof St&&n.expr.str.startsWith("running-element-"))n.visit(new qo(c,this,n,this.counterStore.getExprContentListener()));else if(n&&Xo(n)){let i="span";n.url&&(i="img");let r=this.viewport.document.createElement(i);n.visit(new qo(r,this,n,this.counterStore.getExprContentListener())),c.appendChild(r),"img"==i&&t.transferSingleUriContentProps(this,r,this.faces),t.transferContentProps(this,f,e,this.faces),"span"==i&&function(e,t,i,n,r,o){ih.processGeneratedContent(e,t,i,n,r,o)}(r,t.getProp(this,"text-autospace"),t.getProp(this,"text-spacing-trim"),t.getProp(this,"hanging-punctuation"),this.lang,t.vertical)}else t.suppressEmptyBoxGeneration&&(i.removeChild(c),m=!0);m||t.finishContainer(this,f,e,null,1,this.clientLayout,this.faces),g=zn(!0)}return g.then((()=>{if(s.isInvalidated())return void l.finish(!0);if(!t.isAutoHeight||Math.floor(f.computedBlockSize)>0){if(!m&&!h){let e=t.getProp(this,"shape-outside"),i=f.getOuterShape(e,this);o.push(i)}}else if(0==t.children.length)return i.removeChild(c),void l.finish(!0);let a=p?0:t.children.length-1;l.loop((()=>{for(;a>=0&&a<t.children.length;){let i=t.children[p?a++:a--],l=this.layoutContainer(e,i,c,n,r,o,s);if(l.isPending())return l.thenAsync((()=>zn(!s.isInvalidated())));if(s.isInvalidated())break}return zn(!1)})).then((()=>{l.finish(!0)}))})),l.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let t=i.positions.length-1;t>=0;t--){let n=i.positions[t];n.flowChunk.startPage>=0&&n.flowChunk.startPage+n.flowChunk.linger-1<=e&&i.positions.splice(t,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let t=i.positions.length-1;t>=0;t--){let n=i.positions[t];n.flowChunk.startPage<0&&n.flowChunk.startOffset<this.lookupOffset&&(n.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let t in this.primaryFlows){let i=e.flowPositions[t];if(i&&i.positions.length>0)return!1}return!0}layoutNextPage(e,t){var i;let n=e.container===e.bleedBox;this.pageBreaks={},t?(this.currentLayoutPosition=t.clone(),this.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(this.currentLayoutPosition=new Wo,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang);if((t=this.currentLayoutPosition).page>1e4)throw new Error("Too many pages generated (over 10000 pages)");t.page++;let r=t.startSideOfFlow("body");t.isBlankPage=no(r)&&this.matchPageSide(r),e.isBlankPage=t.isBlankPage,null==e.pageType&&(e.pageType=null!=(i=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)?i:"",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=t.clone();let o=n?{}:this.pageManager.getCascadedPageStyle(e.pageType);this.styler.cascade.applyVarFilter([o],this.styler,null),this.styler.cascade.applyCalcFilter(o,this.styler.context);let s=this.selectPageMaster(o);if(!s)return zn(null);let a=0;if(!n){e.setAutoPageWidth(s.pageBox.specified.width.value===ai),e.setAutoPageHeight(s.pageBox.specified.height.value===li),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(o,this);let t=_c(Rc(o),this);this.setPageSizeAndBleed(t,e),Bc(o,t,e,this),a=t.bleedOffset+t.bleed}let l=!n&&s.getProp(this,"writing-mode")||oi.horizontal_tb;this.pageVertical=l!=oi.horizontal_tb;let h=s.getProp(this,"direction")||oi.ltr,u=new is(this.rootPageFloatLayoutContext,Yo.PAGE,null,null,null,l,h),c=Mn("layoutNextPage");return c.loopWithFrame((t=>{this.layoutContainer(e,s,e.bleedBox,a,a,[],u).then((()=>{u.isInvalidated()||u.finish(),u.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),u.validate(),t.continueLoop()):t.breakLoop()}))})).then((()=>{if(s.adjustPageLayout(this,e,this.clientLayout),!n){let i=new yt(s.pageBox.scope,"left-page");e.side=i.evaluate(this)?"left":"right",this.processLinger(),t=this.currentLayoutPosition,Object.keys(t.flowPositions).forEach((e=>{let i=t.flowPositions[e],n=i.breakAfter;n&&("page"===n||!this.matchPageSide(n))&&(i.breakAfter=null)}))}this.currentLayoutPosition=this.layoutPositionAtPageStart=null,t.highestSeenOffset=this.styler.getReachedOffset();let i=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(i,this.clientLayout),this.noMorePrimaryFlows(t)&&(t=null),c.finish(t)})),c.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+2*e.cropOffset,this.pageSheetHeight=e.pageHeight+2*e.cropOffset,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.right=`${e.bleedOffset}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.bottom=`${e.bleedOffset}px`,t.bleedBox.style.padding=`${e.bleed}px`}},Od=class e extends Sl{constructor(e,t,i,n){super(e.rootScope,e,t,i,n,e.validatorSet,!i),this.masterHandler=e,l(this,"insideRegion",!1)}startPageTemplateRule(){}startPageMasterRule(e,t,i){let n=new ic(this.masterHandler.pageScope,e,t,i,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new kc(n.scope,this.masterHandler,n,this.validatorSet))}startWhenRule(t){let i=t.expr;null!=this.condition&&(i=It(this.scope,this.condition,i)),this.masterHandler.pushHandler(new e(this.masterHandler,i,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new Il(this.scope,this.owner))}startFontFaceRule(){let e={};this.masterHandler.fontFaces.push({properties:e,condition:this.condition}),this.masterHandler.pushHandler(new Rl(this.scope,this.owner,null,e,this.masterHandler.validatorSet,"font-face"))}startFlowRule(e){let t=this.masterHandler.flowProps[e];t||(t={},this.masterHandler.flowProps[e]=t),this.masterHandler.pushHandler(new Rl(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startViewportRule(){let e={};this.masterHandler.viewportProps.push(e),this.masterHandler.pushHandler(new Rl(this.scope,this.owner,this.condition,e,this.masterHandler.validatorSet))}startFootnoteRule(e){let t=this.masterHandler.footnoteProps;if(e){let i=pa(t,"_pseudos");t=i[e],t||(t={},i[e]=t)}this.masterHandler.pushHandler(new Rl(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let e=new ad(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(e),e.startPageRule()}startRuleBody(){if(Sl.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let t="R"+this.masterHandler.regionCount++;this.special("region-id",jt(t)),this.endRule();let i=new e(this.masterHandler,this.condition,this,t);this.masterHandler.pushHandler(i),i.startRuleBody()}}},Fd=class extends fr{constructor(e){super(),this.validatorSet=e,l(this,"rootScope"),l(this,"pageScope"),l(this,"rootBox"),l(this,"cascadeParserHandler"),l(this,"regionCount",0),l(this,"fontFaces",[]),l(this,"footnoteProps",{}),l(this,"flowProps",{}),l(this,"viewportProps",[]),l(this,"pageProps",{}),this.rootScope=new He(null),this.pageScope=new He(this.rootScope),this.rootBox=new ec(this.rootScope),this.cascadeParserHandler=new Od(this,null,null,null),this.slave=this.cascadeParserHandler}};function Bd(e,t){return t.parseOPSResource(e)}var Md=class extends ar{constructor(e){super(Bd,"document"),this.fontDeobfuscator=e,l(this,"styleByKey",{}),l(this,"styleFetcherByKey",{}),l(this,"styleByDocURL",{}),l(this,"triggersByDocURL",{}),l(this,"validatorSet",null),l(this,"styleSheets",[]),l(this,"triggerSingleDocumentPreprocessing",!1)}init(e,t){this.setStyleSheets(e,t);let i=Mn("OPSDocStore.init");return this.validatorSet=Wu(),_d.get().then((()=>{this.triggerSingleDocumentPreprocessing=!0,i.finish(!0)})),i.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=Z(J(t),q)),this.styleSheets.push({url:t,text:e.text,flavor:"Author",classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=Z(J(t),q)),this.styleSheets.push({url:t,text:e.text,flavor:"User",classes:null,media:null})}parseOPSResource(e){let t=Mn("OPSDocStore.load"),i=e.url,n=i.endsWith("?viv-toc-box");return Td(e,this).then((e=>{var r;if(!e)return void t.finish(null);if(this.triggerSingleDocumentPreprocessing){let t=_("PREPROCESS_SINGLE_DOCUMENT");for(let i=0;i<t.length;i++)try{t[i](e.document)}catch(e){P.warn("Error during single document preprocessing:",e)}}let o=[],s=e.document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","trigger");for(let e=0;e<s.length;e++){let t=s[e],i=t.getAttributeNS("http://www.w3.org/2001/xml-events","observer"),n=t.getAttributeNS("http://www.w3.org/2001/xml-events","event"),r=t.getAttribute("action"),a=t.getAttribute("ref");i&&n&&r&&a&&o.push({observer:i,event:n,action:r,ref:a})}this.triggersByDocURL[i]=o;let a=[];if(a.push({url:Z("user-agent-page.css",Y),text:tr,flavor:"UA",classes:null,media:null}),n)a.push({url:Z("user-agent-toc.css",Y),text:nr,flavor:"UA",classes:null,media:null});else{let t=e.document.querySelectorAll("style, link, meta");for(let e of t){let t=e.namespaceURI,n=e.localName;if("http://www.w3.org/1999/xhtml"==t)if("style"==n){let t=e.getAttribute("class"),n=e.getAttribute("media"),r=e.getAttribute("title");a.push({url:i,text:e.textContent,flavor:"Author",classes:r?t:null,media:n})}else if("link"==n){let t=e.getAttribute("href"),n=null==(r=e.getAttribute("rel"))?void 0:r.split(/\s+/),o=e.getAttribute("class"),s=e.getAttribute("media");if(t&&null!=n&&n.includes("stylesheet")&&(!n.includes("alternate")||o)){let n=Z(t,i),r=e.getAttribute("title");a.push({url:n,text:null,classes:r?o:null,media:s,flavor:"Author"})}}else"meta"==n&&"viewport"==e.getAttribute("name")&&a.push({url:i,text:this.processViewportMeta(e),flavor:"Author",classes:null,media:null})}for(let e=0;e<this.styleSheets.length;e++)a.push(this.styleSheets[e])}let l="";for(let e=0;e<a.length;e++)l+=a[e].url,l+="^",a[e].text&&(l+=a[e].text),l+="^";let h=this.styleByKey[l];if(h)return this.styleByDocURL[i]=h,void t.finish(e);let u=this.styleFetcherByKey[l];u||(u=new Yn((()=>{let e=Mn("fetchStylesheet"),t=0,i=new Fd(this.validatorSet);return e.loop((()=>{if(t<a.length){let e=a[t++];return i.startStylesheet(e.flavor),null!==e.text?Fr(e.text,i,e.url,e.classes,e.media).thenReturn(!0):Br(e.url,i,e.classes,e.media)}return zn(!1)})).then((()=>{let t=i.cascadeParserHandler.finish();h=new Ad(this,i.rootScope,i.pageScope,t,i.rootBox,i.fontFaces,i.footnoteProps,i.flowProps,i.viewportProps,i.pageProps),this.styleByKey[l]=h,delete this.styleFetcherByKey[l],e.finish(h)})),e.result()}),`FetchStylesheet ${i}`),this.styleFetcherByKey[l]=u,u.start()),u.get().then((n=>{this.styleByDocURL[i]=n,t.finish(e)}))})),t.result()}processViewportMeta(e){return""}},zd="";function Dd(e){let t=Array.from(e.querySelectorAll("nav[*|type],nav[epub\\:type]"));if(t.length>0||(t=Array.from(e.querySelectorAll("[role=doc-toc]")),t.length>0))return t;for(let i of e.querySelectorAll("nav,.toc,#toc,#table-of-contents,#contents,[role=directory]")){if(t.find((e=>e.contains(i))))continue;let e=i;/^h[1-6]$/.test(e.localName)&&(e=e.previousElementSibling?e.nextElementSibling:e.parentElement),e&&e.querySelector("li a[href]")&&t.push(e)}return t}var Vd=class{constructor(e,t,i,n,r,o,s,a,h,u){this.store=e,this.url=t,this.lang=i,this.clientLayout=n,this.fontMapper=r,this.rendererFactory=s,this.fallbackMap=a,this.documentURLTransformer=h,this.counterStore=u,l(this,"pref"),l(this,"page",null),l(this,"instance",null),this.pref=Oe(o),this.pref.spreadView=!1}setAutoHeight(e,t){if(0!=t--)for(let i=e.firstChild;i;i=i.nextSibling)if(1==i.nodeType){let e=i;"auto"!=se(e,"height","auto")&&(oe(e,"height","auto"),this.setAutoHeight(e,t)),"absolute"==se(e,"position","static")&&(oe(e,"position","relative"),this.setAutoHeight(e,t))}}makeCustomRenderer(e){let t=this.rendererFactory.makeCustomRenderer(e);return(e,i,n)=>{let r=n.behavior;if(r)switch(r.toString()){case"toc-node-anchor":n.color=oi.inherit,n["text-decoration"]=oi.none;break;case"toc-node":n.display=oi.block,n.margin=hi,n.padding=hi,n["padding-inline-start"]=new Wt(1.25,"em");break;case"toc-node-first-child":n.display=oi.inline_block,n.margin=new Wt(.2,"em"),n["vertical-align"]=oi.top,n.color=oi.inherit,n["text-decoration"]=oi.none;break;case"toc-container":n.padding=hi}if(!r||"toc-node"!=r.toString()&&"toc-container"!=r.toString())return t(e,i,n);let o=e.firstChild;o&&1!==o.nodeType&&To(o)&&e.replaceChild(e.ownerDocument.createComment(o.textContent),o);let s=i.getAttribute("data-adapt-class");if("toc-node"==s){let e=i.firstChild;e.textContent!=zd&&(e.textContent=zd,oe(e,"cursor","pointer"),e.addEventListener("click",Ud,!1),e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),i.setAttribute("aria-expanded","false"),"0px"!==i.style.height&&(e.tabIndex=0))}let a=i.ownerDocument.createElement("div");if(a.setAttribute("data-adapt-process-children","true"),"toc-node"==r.toString()){let t=i.ownerDocument.createElement("div");if(t.textContent="",oe(t,"margin","0.2em 0 0 -1em"),oe(t,"margin-inline-start","-1em"),oe(t,"margin-inline-end","0"),oe(t,"display","inline-block"),oe(t,"width","1em"),oe(t,"text-align","center"),oe(t,"vertical-align","top"),oe(t,"cursor","default"),oe(t,"font-family","Menlo,sans-serif"),a.appendChild(t),oe(a,"overflow","hidden"),a.setAttribute("data-adapt-class","toc-node"),a.setAttribute("role","treeitem"),"toc-node"==s||"toc-container"==s){oe(a,"height","0px");let t=e.firstElementChild;t&&"a"===t.localName&&(t.tabIndex=-1)}else i.setAttribute("role","tree")}else"toc-node"==s&&(a.setAttribute("data-adapt-class","toc-container"),a.setAttribute("role","group"),a.setAttribute("aria-hidden","true"));return zn(a)}}showTOC(e,t,i,n,r){if(this.page)return zn(this.page);let o=Mn("showTOC"),s=new ko(e,e);this.page=s;let a=G(this.url)+"?viv-toc-box";return this.store.load(a).then((n=>{for(let e of Dd(n.document))e.setAttribute("data-vivliostyle-role","doc-toc");let a=this.store.getStyleForDoc(n),l=a.sizeViewport(i,1e5,r);t=new kd(t.window,l.fontSize,0,t.root,l.width,l.height);let h=this.makeCustomRenderer(n),u=new Ld(a,n,this.lang,t,this.clientLayout,this.fontMapper,h,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=u,u.pref=this.pref,u.init().then((()=>{u.layoutNextPage(s,null).then((()=>{this.setAutoHeight(e,2),o.finish(s)}))}))})),o.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&"visible"===this.page.container.style.visibility}getTOC(){if(!this.page)return[];function e(e){if(!e)return[];let i=e.querySelectorAll(":scope > [role=treeitem] > a[href]");return Array.from(i).map(t)}function t(t){let i=new URL(t.href),[,n]=i.hash.match(/^#?(.*)$/);return{id:n,title:t.innerText,children:e(t.parentElement.querySelector("[role=group]"))}}return e(this.page.container.querySelector("[role=tree]"))}};function Ud(e){let t=e.target,i=t.textContent==zd;t.textContent=i?"":zd;let n=t.parentNode;t.setAttribute("aria-expanded",i?"true":"false"),n.setAttribute("aria-expanded",i?"true":"false");let r=n.firstChild;for(;r;){if(1===r.nodeType){let e=r,t=e.getAttribute("data-adapt-class");if("toc-container"===t){if(e.setAttribute("aria-hidden",i?"false":"true"),e.firstChild){r=e.firstChild;continue}}else if("toc-node"===t&&(e.style.height=i?"auto":"0px",e.children.length>=2&&(e.children[1].tabIndex=i?0:-1),e.children.length>=3&&(e.children[0].tabIndex=i?0:-1,!i))){let t=e.children[0];if(""==t.textContent){t.textContent=zd,t.setAttribute("aria-expanded","false"),e.setAttribute("aria-expanded","false"),r=e.children[2];continue}}}for(;!r.nextSibling&&r.parentNode!==n;)r=r.parentNode;r=r.nextSibling}e.stopPropagation()}var Hd=class extends Md{constructor(){super(null),l(this,"plainXMLStore"),l(this,"jsonStore"),l(this,"opfByURL",{}),l(this,"primaryOPFByEPubURL",{}),l(this,"deobfuscators",{}),l(this,"documents",{}),this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=new ar(Td,"document"),this.jsonStore=new ar(lr,"text")}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,t,i){return this.plainXMLStore.load(e,t,i)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,i){return this.jsonStore.load(e,t,i)}loadPubDoc(e){let t=Mn("loadPubDoc");return or(e,null,"HEAD").then((i=>{if(i.status>=400)this.loadEPUBDoc(e).then((n=>{n?t.finish(n):(P.error(`Failed to fetch a source document from ${e} (${i.status}${i.statusText?" "+i.statusText:""})`),t.finish(null))}));else if(!i.status&&!i.responseXML&&!i.responseText&&!i.responseBlob&&!i.contentType&&/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),"application/oebps-package+xml"==i.contentType||/\.opf(?:[#?]|$)/.test(e)){let[,i,n]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(i,n).thenFinish(t)}else"application/ld+json"==i.contentType||"application/webpub+json"==i.contentType||"application/audiobook+json"==i.contentType||"application/json"==i.contentType||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then((i=>{if(!i)return this.reportLoadError(e),void t.finish(null);let n=new Jd(this,e);n.initWithWebPubManifest(i,void 0,e).then((()=>{t.finish(n)}))})):this.loadWebPub(e).then((i=>{i?t.finish(i):this.loadEPUBDoc(e).then((i=>{i?t.finish(i):(P.error(`Failed to load ${e}.`),t.finish(null))}))}))})),t.result()}loadEPUBDoc(e){let t=Mn("loadEPUBDoc");e.endsWith("/")||(e+="/"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");let i=e+"META-INF/container.xml";return this.loadAsPlainXML(i).then((i=>{if(i){let n=i.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(let i of n)if(i)return void this.loadOPF(e,i).thenFinish(t)}t.finish(null)})),t.result()}loadOPF(e,t){let i=e+t,n=this.opfByURL[i];if(n)return zn(n);let r=Mn("loadOPF");return this.loadAsPlainXML(i,!0,`Failed to fetch EPUB OPF ${i}`).then((t=>{t?this.loadAsPlainXML(`${e}META-INF/encryption.xml`).then((o=>{n=new Jd(this,e),n.initWithXMLDoc(t,o).then((()=>{this.opfByURL[i]=n,this.primaryOPFByEPubURL[e]=n,r.finish(n)}))})):this.reportLoadError(i)})),r.result()}loadWebPub(e){let t=Mn("loadWebPub");return this.load(e).then((i=>{if(i)if(i.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{let n=i.document,r=new Jd(this,e),o=n.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(o){let i=o.getAttribute("href");if(/^#/.test(i)){let e=W(n.getElementById(i.substr(1)).textContent);r.initWithWebPubManifest(e,n).then((()=>{t.finish(r)}))}else{let i=Z(o.getAttribute("href"),e);this.loadAsJSON(i,!0,`Failed to fetch Publication Manifest ${i}`).then((e=>{r.initWithWebPubManifest(e,n,i).then((()=>{t.finish(r)}))}))}}else r.initWithWebPubManifest({},n).then((()=>{r.toc&&r.toc.src===i.url&&0===Dd(n).length&&(r.toc=null),t.finish(r)}))}else this.reportLoadError(e)})),t.result()}addDocument(e,t){let i=Mn("EPUBDocStore.load"),n=G(e);return(this.documents[n]=this.parseOPSResource({status:200,statusText:"",url:n,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(i),i.result()}reportLoadError(e){let t=e=>e.replace(/([^:/?#]|^)[/?#].*/,"$1");e.startsWith("data:")?P.error(`Failed to load ${e}. Invalid data.`):e.startsWith("http:")&&q.startsWith("https:")?P.error(`Failed to load ${e}. Mixed Content ("http:" content on "https:" context) is not allowed.`):(()=>{let i=t(e);return!(i===t(q)||Object.keys(this.resources).find((e=>this.resources[e]&&t(e)===i))||!/^https?:?\/\/[^/]/.test(e)||/\.(xhtml|xht|xml|opf)$/i.test(e))})()?P.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):P.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let t=G(e),i=this.documents[t];if(i)return i.isPending()?i:zn(i.get());{let e=Mn("EPUBDocStore.load");return i=super.load(t,!0,`Failed to fetch a source document from ${t}`),i.then((i=>{i?e.finish(i):this.reportLoadError(t)})),e.result()}}processViewportMeta(e){let t=e.getAttribute("content");if(!t)return"";let i,n={};for(;null!=(i=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/));)t=t.substr(i[0].length),n[i[1]]=i[2];let r=n.width-0,o=n.height-0;if(r&&o){return`@-epubx-viewport{width:${r}px;height:${o}px;}`+(!!Object.values(this.primaryOPFByEPubURL).find((e=>e.prePaginated))?`@page{size:${r}px ${o}px;margin:0;}`:"@page{margin:0;}")}return""}},$d=class{constructor(){l(this,"id",null),l(this,"src",""),l(this,"mediaType",null),l(this,"title",null),l(this,"itemRefElement",null),l(this,"spineIndex",-1),l(this,"compressedSize",0),l(this,"compressed",null),l(this,"epage",0),l(this,"epageCount",0),l(this,"startPage",null),l(this,"skipPagesBefore",null),l(this,"itemProperties"),this.itemProperties=j}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=Z(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");let i=e.getAttribute("properties");i&&(this.itemProperties=function(e){let t={};for(let i=0;i<e.length;i++)t[e[i]]=!0;return t}(i.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}};function jd(e){return e.id}function Wd(e){return t=>{let i=Mn("deobfuscator");return function(e,t){let i=Mn("makeDigest"),n=i.suspend();return window.crypto.subtle.digest(e,(new TextEncoder).encode(t)).then((e=>{n.schedule(new Uint8Array(e))})),i.result()}("SHA-1",e).then((e=>{let n=t.slice(0,1040),r=t.slice(1040,t.size);(function(e){let t=Mn("readBlob"),i=new FileReader,n=t.suspend(i);return i.addEventListener("load",(()=>{n.schedule(i.result)}),!1),i.readAsArrayBuffer(e),t.result()})(n).then((t=>{let n=new DataView(t);for(let t=0;t<n.byteLength;t++){let i=n.getUint8(t);i^=e[t%20],n.setUint8(t,i)}i.finish(sr([n,r]))}))})),i.result()}}var Gd={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#",opf:"http://www.idpf.org/2007/opf"},qd="http://idpf.org/epub/vocab/package/meta/#",Xd={language:`${Gd.dcterms}language`,title:`${Gd.dcterms}title`,creator:`${Gd.dcterms}creator`,layout:`${Gd.rendition}layout`,titleType:`${qd}title-type`,displaySeq:`${qd}display-seq`,alternateScript:`${qd}alternate-script`,role:`${qd}role`};function Yd(e,t){let i={};return(n,r)=>{var o,s,a,l,h,u;let c,d,p=n.r||i,f=r.r||i;if(e==Xd.title&&(c="main"==(null==(o=p[Xd.titleType])?void 0:o[0].v),d="main"==(null==(s=f[Xd.titleType])?void 0:s[0].v),c!=d))return c?-1:1;let g=parseInt(null==(a=p[Xd.displaySeq])?void 0:a[0].v,10);isNaN(g)&&(g=Number.MAX_VALUE);let m=parseInt(null==(l=f[Xd.displaySeq])?void 0:l[0].v,10);return isNaN(m)&&(m=Number.MAX_VALUE),g!=m?g-m:e!=Xd.language&&t&&(c=(null==(h=p[Xd.language]||p[Xd.alternateScript])?void 0:h[0].v)==t,d=(null==(u=f[Xd.language]||f[Xd.alternateScript])?void 0:u[0].v)==t,c!=d)?c?-1:1:n.o-r.o}}var Kd={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},Zd="viv-id-",Jd=class{constructor(e,t){this.store=e,this.pubURL=t,l(this,"opfXML",null),l(this,"encXML",null),l(this,"items",null),l(this,"spine",null),l(this,"itemMap",null),l(this,"itemMapByPath",null),l(this,"uid",null),l(this,"bindings",{}),l(this,"lang",null),l(this,"epageCount",0),l(this,"prePaginated",!1),l(this,"epageIsRenderedPage",!0),l(this,"epageCountCallback",null),l(this,"metadata",{}),l(this,"toc",null),l(this,"cover",null),l(this,"fallbackMap",{}),l(this,"pageProgression",null),l(this,"documentURLTransformer"),this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let e=this;return new class{transformFragment(e,t){return Zd+fe(t+(e?`#${e}`:""),":")}transformURL(t,i){let n=t.match(/^([^#]*)#?(.*)$/);if(n){let t=n[1]||i,r=decodeURIComponent(n[2]);if(t&&e.spine.some((e=>e.src===t)))return`#${this.transformFragment(r,t)}`}return t}restoreURL(e){"#"===e.charAt(0)&&(e=e.substring(1)),0===e.indexOf(Zd)&&(e=e.substring(7));let t=me(e,":").match(/^([^#]*)#?(.*)$/);return t?[t[1],t[2]]:[]}}}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=Z("",this.pubURL);return e===t||e+"/"===t?"":("/"!=t.charAt(t.length-1)&&(t+="/"),e.substr(0,t.length)==t?decodeURIComponent(e.substr(t.length)):null)}return e}initWithXMLDoc(e,t){this.opfXML=e,this.encXML=t;let i=e.doc().child("package"),n=i.attribute("unique-identifier")[0];if(n){let t=e.getElement(`${e.url}#${n}`);t&&(this.uid=t.textContent.replace(/[ \n\r\t]/g,""))}let r={};this.items=i.child("manifest").child("item").asArray().map((t=>{let i=new $d,n=t;i.initWithElement(n,e.url);let o=n.getAttribute("fallback");return o&&!Kd[i.mediaType]&&(r[i.src]=o),!this.toc&&i.itemProperties.nav&&(this.toc=i),!this.cover&&i.itemProperties["cover-image"]&&(this.cover=i),i})),this.itemMap=we(this.items,jd),this.itemMapByPath=we(this.items,(e=>this.getPathFromURL(e.src)));for(let e in r){let t=e;for(;;){let i=this.itemMap[r[t]];if(!i)break;if(Kd[i.mediaType]){this.fallbackMap[e]=i.src;break}t=i.src}}this.spine=i.child("spine").child("itemref").asArray().map(((e,t)=>{let i=e,n=i.getAttribute("idref"),r=this.itemMap[n];return r&&(r.itemRefElement=i,r.spineIndex=t),r}));let o=i.child("spine").attribute("page-progression-direction")[0];o&&(this.pageProgression=b(o));let s=t?t.doc().child("encryption").child("EncryptedData").predicate(Id.withChild("EncryptionMethod",Id.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],a=i.child("bindings").child("mediaType").asArray();for(let e=0;e<a.length;e++){let t=a[e].getAttribute("handler"),i=a[e].getAttribute("media-type");i&&t&&this.itemMap[t]&&(this.bindings[i]=this.itemMap[t].src)}if(this.metadata=function(e,t){let i;if(t){i={};for(let e in Gd)i[e]=Gd[e];let e;for(;null!=(e=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/));)t=t.substr(e[0].length),i[e[1]]=e[2]}else i=Gd;let n=e=>{if(e){let t=e.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(t){let e=t[2]?i[t[2]]:qd;if(e)return e+t[3]}}return null},r=1,o=e.childElements().forEachNonNull((e=>{if("meta"==e.localName){let t=n(e.getAttribute("property"));if(t)return{name:t,value:e.textContent,id:e.getAttribute("id"),order:r++,refines:e.getAttribute("refines"),lang:null,scheme:n(e.getAttribute("scheme")),role:null}}else if("http://purl.org/dc/elements/1.1/"==e.namespaceURI)return{name:Gd.dcterms+e.localName,order:r++,lang:e.getAttribute("xml:lang"),value:e.textContent,id:e.getAttribute("id"),refines:null,scheme:null,role:e.getAttribute("role")||e.getAttribute("opf:role")};return null})),s=ye(o,(e=>e.refines)),a=e=>function(e,t){let i={};for(let n in e)i[n]=t(e[n],n);return i}(e,((e,t)=>e.map((e=>{let t={v:e.value,o:e.order};e.scheme&&(t.s=e.scheme);let i=s[`#${e.id}`]||[];if(i.length||e.lang||e.role){e.lang&&i.push({name:Xd.language,value:e.lang,lang:null,id:null,refines:e.id,scheme:null,order:e.order,role:null}),e.role&&i.push({name:Xd.role,value:e.role,lang:null,id:null,refines:e.id,scheme:null,order:e.order,role:null});let n=ye(i,(e=>e.name));t.r=a(n)}return t})))),l=a(ye(o,(e=>e.refines?null:e.name))),h=null;l[Xd.language]&&(h=l[Xd.language][0].v);let u=e=>{for(let t in e){let i=e[t];i.sort(Yd(t,h));for(let e=0;e<i.length;e++){let t=i[e].r;t&&u(t)}}};return u(l),l}(i.child("metadata"),i.attribute("prefix")[0]),this.metadata[Xd.language]&&(this.lang=this.metadata[Xd.language][0].v),this.metadata[Xd.layout]&&(this.prePaginated="pre-paginated"===this.metadata[Xd.layout][0].v),s.length>0&&this.uid){let e=Wd(this.uid);for(let t=0;t<s.length;t++)this.store.deobfuscators[this.pubURL+s[t]]=e}return this.prePaginated&&this.assignAutoPages(),zn(!0)}assignAutoPages(){let e=0;for(let t of this.spine){let i=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=i,e+=i}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&0==this.epageCount&&this.assignAutoPages(),zn(!0);let t=0,i=0,n=Mn("countEPages");return n.loopWithFrame((e=>{if(i===this.spine.length)return void e.breakLoop();let n=this.spine[i++];n.epage=t,this.store.load(n.src).then((i=>{let r=1800,o=i.lang||this.lang;o&&o.match(/^(ja|ko|zh)/)&&(r/=3),n.epageCount=Math.ceil(i.getTotalOffset()/r),t+=n.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),e.continueLoop()}))})).thenFinish(n),n.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let i=this.opfXML=new Ed(null,"",(new DOMParser).parseFromString("<spine></spine>","text/xml"));return e.forEach((e=>{let t=new $d;t.initWithParam(e),t.id;let n=i.document.createElement("itemref");n.setAttribute("idref",t.id),i.root.appendChild(n),t.itemRefElement=n,this.itemMap[t.id]=t;let r=this.getPathFromURL(e.url);null==r&&(r=e.url),this.itemMapByPath[r]=t,this.items.push(t)})),t?this.store.addDocument(e[0].url,t):zn(null)}initWithWebPubManifest(e,t,i){var n,r,o,s;e.readingProgression&&(this.pageProgression=e.readingProgression),void 0===this.metadata&&(this.metadata={});let a=e.name||(null==(n=e.metadata)?void 0:n.title)||(null==t?void 0:t.title);a&&(this.metadata[Xd.title]=(Array.isArray(a)?a:[a]).map((e=>{var t;return{v:null!=(t=e.value)?t:e}})));let l=e.author||e.creator||(null==(r=e.metadata)?void 0:r.author)||Array.from(null!=(o=null==t?void 0:t.querySelectorAll("meta[name='author'], meta[name='DC.Creator']"))?o:[]).map((e=>e.content));l&&0!==l.length&&(this.metadata[Xd.creator]=(Array.isArray(l)?l:[l]).map((e=>{var t;return{v:null!=(t=e.name)?t:e}})));let h=e.inLanguage||(null==(s=e.metadata)?void 0:s.language)||(null==t?void 0:t.documentElement.lang)||(null==t?void 0:t.documentElement.getAttribute("xml:lang"));h&&(this.metadata[Xd.language]=(Array.isArray(h)?h:[h]).map((e=>({v:e}))));let u=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&null!==u){e.readingOrder=[encodeURI(u)];for(let i of function(e){let t=Dd(e),i=[];for(let e of t)for(let t of e.querySelectorAll("li a[href]"))i.push(t);return i}(t)){let t=i.getAttribute("href");if(/^(https?:)?\/\//.test(t)||/\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(t))continue;let n=G(Z(t,this.pubURL)),r=this.getPathFromURL(n),o=null!==r?encodeURI(r):n;-1==e.readingOrder.indexOf(o)&&e.readingOrder.push(o)}}let c=[],d=0,p=-1;[e.readingOrder,e.resources].forEach((t=>{t instanceof Array&&t.forEach((n=>{let r=t===e.readingOrder,o="string"==typeof n?n:n.url||n.href,s="string"==typeof n?"":n.encodingFormat||n.href&&n.type||"";if(r||"text/html"===s||"application/xhtml+xml"===s||!s&&"stylesheet"!==n.rel&&/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(o)){let e=i?i.replace(/\/[^/]+$/,"/"):this.pubURL,t={url:Z(J(o),e),index:d++,startPage:null,skipPagesBefore:null};"contents"===n.rel&&-1===p&&(p=t.index),c.push(t)}}))}));let f=Mn("initWithWebPubManifest");return this.initWithChapters(c).then((()=>{var t,n;-1!==p&&(this.toc=this.items[p]),this.toc||(this.toc=i?null==(t=this.items)?void 0:t[0]:this.itemMapByPath[u]);let r=null==(n=e.readingOrder)?void 0:n.length;r&&r<this.items.length&&this.items.splice(r),f.finish(!0)})),f.result()}getCFI(e,t){let i=this.spine[e],n=Mn("getCFI");return this.store.load(i.src).then((e=>{let r=e.getNodeByOffset(t),o=null;if(r){let n=e.getNodeOffset(r,0,!1),s=t-n,a=new Le;a.prependPathFromNode(r,s,!1,null),i.itemRefElement&&a.prependPathFromNode(i.itemRefElement,0,!1,null),o=a.toString()}n.finish(o)})),n.result()}resolveFragment(e){return Dn("resolveFragment",(t=>{if(!e)return void t.finish(null);let i,n=new Le;if(n.fromString(e),this.opfXML){let e=n.navigate(this.opfXML.document);if(1!=e.node.nodeType||e.after||!e.ref)return void t.finish(null);let r=e.node,o=r.getAttribute("idref");if("itemref"!=r.localName||!o||!this.itemMap[o])return void t.finish(null);i=this.itemMap[o],n=e.ref}else i=this.spine[0];this.store.load(i.src).then((e=>{let r=n.navigate(e.document),o=e.getNodeOffset(r.node,r.offset,r.after);t.finish({spineIndex:i.spineIndex,offsetInItem:o,pageIndex:-1})}))}),((t,i)=>{P.warn(i,"Cannot resolve fragment:",e),t.finish(null)}))}resolveEPage(e){return Dn("resolveEPage",(t=>{if(e<=0)return void t.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});if(this.epageIsRenderedPage){let i=this.spine.findIndex((t=>0==t.epage&&0==t.epageCount||t.epage<=e&&t.epage+t.epageCount>e));-1==i&&(i=this.spine.length-1);let n=this.spine[i];(!n||0==n.epageCount)&&(n=this.spine[--i]);let r=Math.floor(e-n.epage);return void t.finish({spineIndex:i,offsetInItem:-1,pageIndex:r})}let i=be(this.spine.length,(t=>{let i=this.spine[t];return i.epage+i.epageCount>e}));i==this.spine.length&&i--;let n=this.spine[i];this.store.load(n.src).then((r=>{(e-=n.epage)>n.epageCount&&(e=n.epageCount);let o=0;if(e>0){let t=r.getTotalOffset();o=Math.round(t*e/n.epageCount),o==t&&o--}t.finish({spineIndex:i,offsetInItem:o,pageIndex:-1})}))}),((t,i)=>{P.warn(i,"Cannot resolve epage:",e),t.finish(null)}))}getEPageFromPosition(e){let t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){return zn(t.epage+e.pageIndex)}if(e.offsetInItem<=0)return zn(t.epage);let i=Mn("getEPage");return this.store.load(t.src).then((n=>{let r=n.getTotalOffset(),o=Math.min(r,e.offsetInItem);i.finish(t.epage+o*t.epageCount/r)})),i.result()}},Qd=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}}),ep=class{constructor(e,t,i,n,r){this.opf=e,this.viewport=t,this.fontMapper=i,this.pageSheetSizeReporter=r,l(this,"spineItems",[]),l(this,"spineItemLoadingContinuations",[]),l(this,"pref"),l(this,"clientLayout"),l(this,"counterStore"),l(this,"tocAutohide",!1),l(this,"tocVisible",!1),l(this,"tocView"),this.pref=Oe(n),this.clientLayout=new Cd(t),this.counterStore=new Xi(e.documentURLTransformer)}getPage(e){let t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{let t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,i){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);let n=e.pages[i];if(t.isFirstPage=0==e.item.spineIndex&&0==i,e.pages[i]=t,this.opf.epageIsRenderedPage){if(0==i&&e.item.spineIndex>0){let t=this.opf.spine[e.item.spineIndex-1];e.item.epage=t.epage+t.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce(((e,t)=>e+t.epageCount),0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(n)e.instance.viewport.contentContainer.replaceChild(t.container,n.container),n.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let n=null;if(i>0)n=e.pages[i-1].container.nextElementSibling;else for(let t=e.item.spineIndex+1;t<this.spineItems.length;t++){let e=this.spineItems[t];if(e&&e.pages[0]){n=e.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,n)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+i)}renderSinglePage(e,t){let i=Mn("renderSinglePage"),n=e.pages[t?t.page:0],r=this.makePage(e,t);return n&&(r.pageType=n.pageType),e.instance.layoutNextPage(r,t).then((n=>{let o=(t=n)?t.page-1:e.layoutPositions.length-1;this.finishPageContainer(e,r,o),this.counterStore.finishPage(r.spineIndex,o);let s=null;if(t){let i=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,i&&e.pages[t.page]&&(t.isSamePosition(i)||(s=this.renderSinglePage(e,t)))}s||(s=zn(!0)),s.then((()=>{let n=this.counterStore.getUnresolvedRefsToPage(r),s=0;i.loopWithFrame((e=>{if(s++,s>n.length)return void e.breakLoop();let t=n[s-1];t.refs=t.refs.filter((e=>!e.isResolved())),0!==t.refs.length?this.getPageViewItem(t.spineIndex).then((i=>{if(!i)return void e.continueLoop();let{currentPageType:n,previousPageType:s}=i.instance.styler.cascade,a=Object.entries(i.instance.scopes);this.counterStore.pushPageCounters(t.pageCounters),this.counterStore.pushReferencesToSolve(t.refs);let l=i.layoutPositions[t.pageIndex];this.renderSinglePage(i,l).then((t=>{i.instance.styler.cascade.currentPageType=n,i.instance.styler.cascade.previousPageType=s,i.instance.scopes=Object.fromEntries(a),this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let l=t.pageAndPosition.position;l.spineIndex===r.spineIndex&&l.pageIndex===o&&(r=t.pageAndPosition.page),e.continueLoop()}))})):e.continueLoop()})).then((()=>{r.container.parentElement||(r=e.pages[o]),r.isLastPage=!t&&e.item.spineIndex===this.opf.spine.length-1,r.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),r.container.setAttribute("data-vivliostyle-page-index",o),r.container.setAttribute("data-vivliostyle-spine-index",r.spineIndex),i.finish({pageAndPosition:Qd(r,o),nextLayoutPosition:t})}))}))})),i.result()}normalizeSeekPosition(e,t){let i=e.pageIndex,n=-1;if(i<0){n=e.offsetInItem;let r=be(t.layoutPositions.length,(e=>t.instance.getPosition(t.layoutPositions[e],!0)>n));i=r===t.layoutPositions.length?t.complete?t.layoutPositions.length-1:Number.POSITIVE_INFINITY:r-1}else i===Number.POSITIVE_INFINITY&&-1!==e.offsetInItem&&(n=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:i,offsetInItem:n}}findPage(e,t){let i=Mn("findPage");return this.getPageViewItem(e.spineIndex).then((n=>{if(!n)return void i.finish(null);let r,o=null;i.loopWithFrame((s=>{let a=this.normalizeSeekPosition(e,n);r=a.pageIndex,o=n.pages[r],o?s.breakLoop():n.complete?(r=n.layoutPositions.length-1,o=n.pages[r],s.breakLoop()):t?this.renderPage(a).then((e=>{e&&(o=e.page,r=e.position.pageIndex),s.breakLoop()})):i.sleep(100).then((()=>{s.continueLoop()}))})).then((()=>{i.finish(Qd(o,r))}))})),i.result()}renderPage(e){let t=Mn("renderPage");return this.getPageViewItem(e.spineIndex).then((i=>{if(!i)return void t.finish(null);let n=this.normalizeSeekPosition(e,i),r=n.pageIndex,o=n.offsetInItem,s=i.pages[r];s?t.finish(Qd(s,r)):t.loopWithFrame((e=>{if(r<i.layoutPositions.length)return void e.breakLoop();if(i.complete)return r=i.layoutPositions.length-1,void e.breakLoop();let t=i.layoutPositions[i.layoutPositions.length-1];this.renderSinglePage(i,t).then((n=>{let a=n.pageAndPosition.page;if(t=n.nextLayoutPosition,t){if(o>=0&&i.instance.getPosition(t)>o)return s=a,r=i.layoutPositions.length-2,void e.breakLoop();e.continueLoop()}else s=a,r=n.pageAndPosition.position.pageIndex,i.complete=!0,e.breakLoop()}))})).then((()=>{s=s||i.pages[r];let e=i.layoutPositions[r];s?t.finish(Qd(s,r)):this.renderSinglePage(i,e).then((e=>{e.nextLayoutPosition||(i.complete=!0),t.finish(e.pageAndPosition)}))}))})),t.result()}renderAllPages(){let e=Mn("renderAllPages");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then((t=>{e.loopWithFrame((t=>{this.spineItems.some((e=>null==e?void 0:e.pages.some((e=>null==e?void 0:e.fetchers.some((e=>!e.arrived))))))?e.sleep(100).then((()=>{t.continueLoop()})):t.breakLoop()})).then((()=>{e.finish(t)}))})),e.result()}renderPagesUpto(e,t){let i=Mn("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});let n,r=e.spineIndex,o=e.pageIndex,s=0;return t&&(s=r),i.loopWithFrame((t=>{let i={spineIndex:s,pageIndex:s===r?o:Number.POSITIVE_INFINITY,offsetInItem:s===r?e.offsetInItem:-1};this.renderPage(i).then((e=>{n=e,++s>r?t.breakLoop():t.continueLoop()}))})).then((()=>{i.finish(n)})),i.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){let i=e.spineIndex,n=e.pageIndex,r=Mn("nextPage");return this.getPageViewItem(i).then((e=>{if(e){if(e.complete&&n==e.layoutPositions.length-1){if(i>=this.opf.spine.length-1)return void r.finish(null);i++,n=0;let t=this.spineItems[i],o=t&&t.pages[0],s=e.pages[e.pages.length-1];o&&s&&o.side==s.side&&(t.pages.forEach((e=>{e.container&&e.container.remove()})),this.spineItems[i]=null,this.spineItemLoadingContinuations[i]=null)}else n++;this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t).thenFinish(r)}else r.finish(null)})),r.result()}previousPage(e,t){let i=e.spineIndex,n=e.pageIndex;if(0==n){if(0==i)return zn(null);i--,n=Number.POSITIVE_INFINITY}else n--;return this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t)}isRectoPage(e,t){let i="left"===e.side,n="ltr"===this.getCurrentPageProgression(t);return!i&&n||i&&!n}getSpread(e,t){let i=this.getPage(e);if(!i)return zn({left:null,right:null});let n,r=Mn("getSpread"),o="left"===i.side;return n=this.isRectoPage(i,e)?this.previousPage(e,t):this.nextPage(e,t),n.then((t=>{let i=this.getPage(e),n=t&&t.page;n&&n.side===i.side&&(n=null),o?r.finish({left:i,right:n}):r.finish({left:n,right:i})})),r.result()}nextSpread(e,t){let i=this.getPage(e);if(!i)return zn(null);let n=this.isRectoPage(i,e),r=this.nextPage(e,t);return n?r:r.thenAsync((e=>{if(e){if(e.page.side===i.side)return r;let n=this.nextPage(e.position,t);return n.thenAsync((e=>e?n:r))}return zn(null)}))}previousSpread(e,t){let i=this.getPage(e);if(!i)return zn(null);let n=this.isRectoPage(i,e),r=this.previousPage(e,t),o=i.container.previousElementSibling;return n?r.thenAsync((e=>e?e.page.side===i.side||e.page.container!==o?r:this.previousPage(e.position,t):zn(null))):r}navigateToEPage(e,t,i){let n=Mn("navigateToEPage");return this.opf.resolveEPage(e).then((e=>{e?this.findPage(e,i).thenFinish(n):n.finish(null)})),n.result()}navigateToFragment(e,t,i){let n=Mn("navigateToCFI");return this.opf.resolveFragment(e).then((e=>{e?this.findPage(e,i).thenFinish(n):n.finish(null)})),n.result()}navigateTo(e,t,i){P.debug("Navigate to",e);let n=this.opf.getPathFromURL(G(e));if(!n){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))n=this.opf.getPathFromURL(this.opf.opfXML.url);else if("#"===e.charAt(0)){let t=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?(n=this.opf.getPathFromURL(t[0]),null==n&&(n=t[0])):n=t[0],e=t[0]+(t[1]?`#${t[1]}`:"")}if(null==n)return zn(null)}let r=this.opf.itemMapByPath[n];if(!r){if(this.opf.opfXML&&n==this.opf.getPathFromURL(this.opf.opfXML.url)){let n=e.indexOf("#");if(n>=0)return this.navigateToFragment(e.substr(n+1),t,i)}return zn(null)}let o=Mn("navigateTo");return this.getPageViewItem(r.spineIndex).then((t=>{if(!t)return void o.finish(null);let n=t.xmldoc.getElement(e);this.findPage({spineIndex:r.spineIndex,pageIndex:-1,offsetInItem:n?t.xmldoc.getElementOffset(n):0},i).thenFinish(o)})),o.result()}makePage(e,t){let i=e.instance.viewport,n=i.document.createElement("div");n.setAttribute("data-vivliostyle-page-container","true"),n.setAttribute("role","region"),n.style.position="absolute",n.style.top="0",n.style.left="0",p||(n.style.visibility="hidden"),i.layoutBox.appendChild(n);let r=i.document.createElement("div");r.setAttribute("data-vivliostyle-bleed-box","true"),n.appendChild(r);let o=new ko(n,r);if(o.spineIndex=e.item.spineIndex,o.position=t,o.offset=e.instance.getPosition(t),0===o.offset&&(!e.instance.blankPageAtStart||0!==e.pages.length)){let t=this.opf.documentURLTransformer.transformFragment("",e.item.src);r.setAttribute("id",t),o.registerElementWithId(r,t)}if(i!==this.viewport){let e=Me(this.viewport.width,this.viewport.height,i.width,i.height),t=Mr(null,new Ln(e,null),"");o.delayedItems.push(new yo(n,"transform",t))}return o}makeObjectView(e,t,i,n){let r=t.getAttribute("data"),o=null;if(r){r=Z(r,e.url);let i=t.getAttribute("media-type");if(!i){let e=this.opf.getPathFromURL(r);if(e){let t=this.opf.itemMapByPath[e];t&&(i=t.mediaType)}}if(i){let e=this.opf.bindings[i];if(e){o=this.viewport.document.createElement("iframe"),o.style.border="none";let n=de(r),s=de(i),a=new le;a.append(e),a.append("?src="),a.append(n),a.append("&type="),a.append(s);for(let e=t.firstChild;e;e=e.nextSibling)if(1==e.nodeType){let t=e;if("param"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI){let e=t.getAttribute("name"),i=t.getAttribute("value");e&&i&&(a.append("&"),a.append(encodeURIComponent(e)),a.append("="),a.append(encodeURIComponent(i)))}}o.setAttribute("src",a.toString());let l=t.getAttribute("width");l&&o.setAttribute("width",l);let h=t.getAttribute("height");h&&o.setAttribute("height",h)}}}return o||(o=this.viewport.document.createElement("object"),r&&o.setAttribute("data",r),o.setAttribute("data-adapt-process-children","true")),zn(o)}makeMathJaxView(e,t,i,n){let r=function(){let e=window.MathJax;return e?e.Hub:null}();if(r){let n=i.ownerDocument,o=n.createElement("span");i.appendChild(o);let s=n.importNode(t,!0);this.resolveURLsInMathML(s,e),o.appendChild(s);let a=r.queue;a.Push(["Typeset",r,o]);let l=Mn("makeMathJaxView"),h=l.suspend();return a.Push((()=>{h.schedule(o)})),l.result()}return zn(null)}resolveURLsInMathML(e,t){if(null!=e){if(1===e.nodeType&&"mglyph"===e.tagName){let i=Array.from(e.attributes);for(let n of i){if("src"!==n.name)continue;let i=Z(n.nodeValue,t.url);n.namespaceURI?e.setAttributeNS(n.namespaceURI,n.name,i):e.setAttribute(n.name,i)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeCustomRenderer(e){return(t,i,n)=>"object"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI?this.makeObjectView(e,t,i,n):"http://www.w3.org/1998/Math/MathML"==t.namespaceURI||t.dataset&&"true"==t.dataset.mathTypeset?this.makeMathJaxView(e,t,i,n):zn(null)}getPageViewItem(e){if(-1===e||e>=this.opf.spine.length)return zn(null);let t=this.spineItems[e];if(t)return zn(t);let i=Mn("getPageViewItem"),n=this.spineItemLoadingContinuations[e];if(n){let e=i.suspend();return n.push(e),i.result()}n=this.spineItemLoadingContinuations[e]=[];let r=this.opf.spine[e],o=this.opf.store;return o.load(r.src).then((s=>{var a;let l=r.itemRefElement.getAttribute("properties");l&&s.root.setAttribute("data-vivliostyle-epub-spine-properties",l),r.title=s.document.title;let h=o.getStyleForDoc(s),u=this.makeCustomRenderer(s),c=this.viewport,d=h.sizeViewport(c.width,c.height,c.fontSize,this.pref);(d.width!=c.width||d.height!=c.height||d.fontSize!=c.fontSize)&&(c=new kd(c.window,d.fontSize,c.pixelRatio,c.root,d.width,d.height));let p,f,g=null==(a=this.spineItems[0])?void 0:a.instance.isVersoFirstPage,m=this.spineItems[e-1];if(null!==r.startPage)p=r.startPage-1,f=p;else{if(!(e>0)||m&&m.complete){p=m?m.instance.pageNumberOffset+m.pages.length:0;let e=this.counterStore.currentPageCounters.page;f=e&&e.length?e[e.length-1]:p}else p=r.epage||e,!this.opf.prePaginated&&p%2==(g?1:0)&&p++,f=p;null!==r.skipPagesBefore&&(p+=r.skipPagesBefore,f+=r.skipPagesBefore)}this.counterStore.forceSetPageCounter(f);let b=new Ld(h,s,this.opf.lang,c,this.clientLayout,this.fontMapper,u,this.opf.fallbackMap,p,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,g);b.pref=this.pref;let v=this.opf.metadata&&this.opf.metadata[Xd.title];b.pubTitle=v&&v[0]&&v[0].v||"",b.docTitle=r.title||"",b.init().then((()=>{!this.opf.pageProgression&&b.pageProgression&&(this.opf.pageProgression=b.pageProgression),t={item:r,xmldoc:s,instance:b,layoutPositions:[null],pages:[],complete:!1},this.spineItems[e]=t,i.finish(t),n.forEach((e=>{e.schedule(t)}))}))})),i.result()}removeRenderedPages(){let e=this.spineItems;for(let t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let e=this.spineItems;for(let t of e)if(t){let e=t.pages;for(let t of e)if(t.isAutoPageWidth&&t.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some((e=>e&&e.pages.length>0))}showTOC(e){let t=this.opf,i=t.toc;if(this.tocAutohide=e,!i)return zn(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),zn(this.tocView.page);let n=Mn("showTOC");this.tocView||(this.tocView=new Vd(t.store,i.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));let r=this.viewport,o=Math.min(344,Math.round(.67*r.width)-16),s=r.height-6,a=r.document.createElement("div");return r.root.appendChild(a),p||(a.style.visibility="hidden"),a.style.width=`${o+16}px`,a.style.maxHeight=`${s}px`,a.setAttribute("data-vivliostyle-toc-box","true"),a.setAttribute("role","navigation"),this.tocView.showTOC(a,r,o,s,this.viewport.fontSize).then((e=>{a.style.visibility="visible",a.setAttribute("aria-hidden","false"),n.finish(e)})),n.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}},tp="data-vivliostyle-viewer-status",ip=(e=>(e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread",e))(ip||{}),np=class{constructor(e,t,i,n){this.window=e,this.viewportElement=t,this.instanceId=i,this.callbackFn=n,l(this,"fontMapper"),l(this,"kick"),l(this,"sendCommand"),l(this,"resizeListener"),l(this,"hyperlinkListener"),l(this,"pageRuleStyleElement"),l(this,"pageSheetSizeAlreadySet",!1),l(this,"renderTask",null),l(this,"actions"),l(this,"readyState"),l(this,"packageURL"),l(this,"opf"),l(this,"touchActive"),l(this,"touchX"),l(this,"touchY"),l(this,"needResize"),l(this,"resized"),l(this,"needRefresh"),l(this,"viewportSize"),l(this,"currentPage"),l(this,"currentSpread"),l(this,"pagePosition"),l(this,"fontSize"),l(this,"zoom"),l(this,"fitToScreen"),l(this,"pageViewMode"),l(this,"waitForLoading"),l(this,"renderAllPages"),l(this,"pref"),l(this,"pageSizes"),l(this,"pixelRatio"),l(this,"pixelRatioLimit"),l(this,"viewport"),l(this,"opfView");let r=t.ownerDocument,o=(e,t)=>{let i=r.getElementById(e);return i||(i=r.createElement("style"),i.id=e,t&&(i.textContent=t),r.head.appendChild(i)),i};o("vivliostyle-viewport-screen-css",Zn),o("vivliostyle-viewport-css",Jn),o("vivliostyle-polyfill-css",rr),t.setAttribute("data-vivliostyle-viewer-viewport",!0),p&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(tp,"loading"),this.fontMapper=new Zu(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=e=>{},this.pageRuleStyleElement=o("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState="loading",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode="singlePage",this.waitForLoading=!1,this.renderAllPages=!0,this.pref={fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0},this.pageSizes=[],this.pixelRatioLimit=/Chrome/.test(navigator.userAgent)?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let e=S;P.addListener(e.DEBUG,(e=>{this.callback({t:"debug",content:e})})),P.addListener(e.INFO,(e=>{this.callback({t:"info",content:e})})),P.addListener(e.WARN,(e=>{this.callback({t:"warn",content:e})})),P.addListener(e.ERROR,(e=>{this.callback({t:"error",content:e})}))}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(tp,e),this.callback({t:"readystatechange"}))}loadPublication(e){V.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.fragment,n=e.authorStyleSheet,r=e.userStyleSheet;this.viewport=null;let o=Mn("loadPublication");return this.configure(e).then((()=>{let e=new Hd;e.init(n,r).then((()=>{let n=Z(J(t),this.window.location.href);this.packageURL=[n],e.loadPubDoc(n).then((e=>{e?(this.opf=e,this.render(i).then((()=>{o.finish(!0)}))):o.finish(!1)}))}))})),o.result()}loadXML(e){V.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.document,n=e.fragment,r=e.authorStyleSheet,o=e.userStyleSheet;this.viewport=null;let s=Mn("loadXML");return this.configure(e).then((()=>{let e=new Hd;e.init(r,o).then((()=>{let r=t.map(((e,t)=>({url:Z(J(e.url),this.window.location.href),index:t,startPage:e.startPage,skipPagesBefore:e.skipPagesBefore})));this.packageURL=r.map((e=>e.url)),this.opf=new Jd(e,""),this.opf.initWithChapters(r,i).then((()=>{this.render(n).then((()=>{s.finish(!0)}))}))}))})),s.result()}render(e){let t;return this.cancelRenderingTask(),t=e?this.opf.resolveFragment(e).thenAsync((e=>(this.pagePosition=e,zn(!0)))):zn(!0),t.thenAsync((()=>(V.registerEndTiming("beforeRender"),this.resize())))}resolveLength(e){let t,i=parseFloat(e);if("string"==typeof e&&(t=e.match(/[a-z]+$/))){let e=t[0];if("em"===e||"rem"===e)return i*this.fontSize;if("ex"===e)return i*je.ex*this.fontSize/je.em;let n=je[e];if(n)return i*n}return i}configure(e){if("boolean"==typeof e.autoresize&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),"number"==typeof e.fontSize){let t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if("object"==typeof e.viewport&&e.viewport){let t=e.viewport,i={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(i.width>=200||i.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=i,this.needResize=!0)}if("boolean"==typeof e.hyphenate&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),"boolean"==typeof e.horizontal&&(this.pref.horizontal=e.horizontal,this.needResize=!0),"boolean"==typeof e.nightMode&&(this.pref.nightMode=e.nightMode,this.needResize=!0),"number"==typeof e.lineHeight&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),"number"==typeof e.columnWidth&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),"string"==typeof e.fontFamily&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),"boolean"==typeof e.load&&(this.waitForLoading=e.load),"boolean"==typeof e.renderAllPages&&(this.renderAllPages=e.renderAllPages),"string"==typeof e.userAgentRootURL&&(X(e.userAgentRootURL.replace(/resources\/?$/,"")),K(e.userAgentRootURL)),"string"==typeof e.rootURL&&(X(e.rootURL),K(`${q}resources/`)),"string"==typeof e.pageViewMode&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),"number"==typeof e.pageBorder&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),"number"==typeof e.zoom&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),"boolean"==typeof e.fitToScreen&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),"object"==typeof e.defaultPaperSize&&"number"==typeof e.defaultPaperSize.width&&"number"==typeof e.defaultPaperSize.height&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),"boolean"==typeof e.allowScripts&&e.allowScripts!==hd&&(function(e){hd=e}(e.allowScripts),this.needResize=!0),"number"==typeof e.pixelRatio){let t=Math.min(e.pixelRatio,this.pixelRatioLimit);t!==this.pixelRatio&&(this.pixelRatio=t,this.needResize=!0)}return this.configurePlugins(e),zn(!0)}configurePlugins(e){_("CONFIGURATION").forEach((t=>{let i=t(e);this.needResize=i.needResize||this.needResize,this.needRefresh=i.needRefresh||this.needRefresh}))}pageReplacedListener(e){let t=this.currentPage,i=this.currentSpread,n=e.target;i?(i.left===n||i.right===n)&&this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){let t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach((t=>{t&&e(t)}))}removePageListeners(){this.forCurrentPages((e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)}))}hidePages(){this.removePageListeners(),this.forCurrentPages((e=>{oe(e.container,"display","none")})),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),oe(e.container,"visibility","visible"),oe(e.container,"display","block")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),i=parseFloat(e.right.container.style.width);t&&i&&t!==i&&(t<i?e.left.container.style.marginLeft=i-t+"px":e.right.container.style.marginRight=t-i+"px")}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){let e=Mn("reportPosition");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then((t=>{let i=this.currentPage;(this.waitForLoading&&i.fetchers.length>0?Kn(i.fetchers):zn(!0)).then((()=>{this.sendLocationNotification(i,t).thenFinish(e)}))})),e.result()}createViewport(){let e=this.viewportElement;if(this.viewportSize){let t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new kd(this.window,this.fontSize,this.pixelRatio,e,t.width,t.height)}return new kd(this.window,this.fontSize,this.pixelRatio,e)}resolveSpreadView(e,t){switch(this.pageViewMode){case"singlePage":return!1;case"spread":return!0;default:return(e.width-this.pref.pageBorder)/e.height>=(t?2*t.width/t.height:1.45)&&(!!t||e.width>800)}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute("data-vivliostyle-spread-view",e.toString())}sizeIsGood(){var e;let t=this.createViewport(),i=(null==(e=this.opfView)?void 0:e.hasPages())&&!this.opfView.hasAutoSizedPages(),n=this.resolveSpreadView(t,this.resized&&i?this.pageSizes[0]:null);this.resized=!1;let r=this.pref.spreadView!==n;return this.updateSpreadView(n),!(this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize)&&(!!(!r&&t.width==this.viewport.width&&t.height==this.viewport.height||!r&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent))||!!i&&(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0))}setPageSize(e,t,i,n){this.pageSizes[n]=e,this.setPageSizePageRules(t,i,n),0===n&&"autoSpread"===this.pageViewMode&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,e))}setPageSizePageRules(e,t,i){var n,r;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[i].width!==(null==(n=this.pageSizes[i-1])?void 0:n.width)||this.pageSizes[i].height!==(null==(r=this.pageSizes[i-1])?void 0:r.height))){let e=function(e){let t=.75*e;return Math.ceil(t)},t=Math.max(...this.pageSizes.map((e=>e.width))),i=Math.max(...this.pageSizes.map((e=>e.height))),n=e(t),r=e(i),o=`@page {size: ${n}pt ${r}pt; margin: 0 ${-(n*((this.pixelRatio||1)-1)+2)}pt ${-(r*((this.pixelRatio||1)-1)+2)}pt 0;}`;this.pageRuleStyleElement.textContent=o,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.tocVisible,t=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new ep(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){this.needRefresh=!1,this.removePageListeners();let i=this.resolveSpreadView(this.viewport,e.dimensions);return i!==this.pref.spreadView&&this.updateSpreadView(i),i?this.opfView.getSpread(this.pagePosition,t).thenAsync((t=>t.left||t.right?!t.left||!t.right||this.resolveSpreadView(this.viewport,t.left.dimensions)&&this.resolveSpreadView(this.viewport,t.right.dimensions)?(this.showSpread(t),this.setSpreadZoom(t),this.currentPage="left"===e.side?t.left:t.right,zn(null)):(this.updateSpreadView(!1),this.showPage(e),this.setPageZoom(e),this.currentPage=e,zn(null)):zn(null))):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,zn(null))}setPageZoom(e){let t=this.getAdjustedZoomFactor(e.dimensions);this.viewport.zoom(e.dimensions.width,e.dimensions.height,t)}setSpreadZoom(e){let t=this.getSpreadDimensions(e);this.viewport.zoom(t.width,t.height,this.getAdjustedZoomFactor(t))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,i=0;return e.left&&(t+=e.left.dimensions.width,i=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,i=Math.max(i,e.right.dimensions.height)),e.left&&e.right&&(t+=2*this.pref.pageBorder,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:i}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");if("fit inside viewport"===e){let e;return this.pref.spreadView?(this.currentSpread,e=this.getSpreadDimensions(this.currentSpread)):e=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(e)}throw new Error(`unknown zoom type: ${e}`)}calculateZoomFactorToFitInsideViewPort(e){if(!this.viewport)return this.zoom;let t=this.viewport.width/e.width,i=this.viewport.height/e.height;return Math.min(t,i)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new op),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return zn(!0);this.setReadyState("loading"),this.cancelRenderingTask();let e=Bn().getScheduler().run((()=>Dn("resize",(t=>{this.opf?(this.renderTask=e,V.registerStartTiming("render (resize)"),this.reset(),this.pagePosition&&(0==this.pagePosition.pageIndex&&0==this.pagePosition.offsetInItem||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then((i=>{i?(this.pagePosition=i.position,this.showCurrent(i.page,!0).then((()=>{this.setReadyState("interactive"),this.opf.countEPages((e=>{let t={t:"nav",epageCount:e,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||0==this.pagePosition.pageIndex&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(t.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(t)})).then((()=>{this.reportPosition().then((i=>{(this.renderAllPages?this.opfView.renderAllPages():zn(null)).then((()=>{this.renderTask===e&&(this.renderTask=null),V.registerEndTiming("render (resize)"),hd&&gd(this.window)?function(e){if(!hd)return zn(!1);let t=Mn("loadScripts");return t.loop((()=>0===ud.length?zn(!1):pd(ud.shift(),e,{atEnd:!0}).thenReturn(ud.length>0))).then((()=>{P.debug("dispatchEvent: DOMContentLoaded (window)"),e.dispatchEvent(new Event("DOMContentLoaded")),P.debug("dispatchEvent: load (window)"),e.dispatchEvent(new Event("load")),t.finish(!0)})),t.result()}(this.window).then((()=>{this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i)})):(this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i))}))}))}))}))):t.finish(!1)}))):t.finish(!1)}),((e,t)=>{if(!(t instanceof op))throw t;V.registerEndTiming("render (resize)"),P.debug(t.message)}))));return zn(!0)}sendLocationNotification(e,t){let i=Mn("sendLocationNotification"),n={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then((e=>{n.epage=e,n.epageCount=this.opf.epageCount,t&&(n.cfi=t),this.callback(n),i.finish(!0)})),i.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){var t;let i;if("complete"!==this.readyState&&"next"!==e.where&&this.setReadyState("loading"),"string"==typeof e.where){let t;switch(e.where){case"next":t=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":t=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":t=this.opfView.lastPage;break;case"first":t=this.opfView.firstPage;break;default:return zn(!0)}t&&(i=()=>t.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if("number"==typeof e.epage){let t=e.epage;i=()=>this.opfView.navigateToEPage(t,this.pagePosition,!this.renderAllPages)}else if("string"==typeof e.url){let t=e.url;i=()=>this.opfView.navigateTo(t,this.pagePosition,!this.renderAllPages)}else{if("number"!=typeof(null==(t=e.position)?void 0:t.spineIndex))return zn(!0);{let t=e.position;i=()=>this.opfView.findPage(t,!this.renderAllPages)}}if(!this.opfView)return zn(!0);let n=Mn("moveTo");return i.call(this.opfView).then((e=>{let t;if(e){this.pagePosition=e.position;let i=Mn("moveTo.showCurrent");t=i.result(),this.showCurrent(e.page,!this.renderAllPages).then((()=>{this.reportPosition().thenFinish(i)}))}else t=zn(!0);t.then((e=>{"loading"===this.readyState&&this.setReadyState("interactive"),n.finish(e)}))})),n.result()}showTOC(e){let t=!!e.autohide,i=e.v,n=this.opfView.isTOCVisible(),r=t!=this.opfView.tocAutohide&&"hide"!=i;if(n){if("show"==i&&!r)return zn(!0)}else if("hide"==i)return zn(!0);if(n&&"show"!=i)return this.opfView.hideTOC(),zn(!0);{let e=Mn("showTOC");return this.opfView.showTOC(t).then((i=>{if(i){if(r&&(i.listeners={}),t){let e=()=>{this.opfView.hideTOC()};i.addEventListener("hyperlink",e,!1)}i.addEventListener("hyperlink",this.hyperlinkListener,!1)}e.finish(!0)})),e.result()}}runCommand(e){let t=e.a||"";return Dn("runCommand",(i=>{let n=this.actions[t];n?n.call(this,e).then((()=>{this.callback({t:"done",a:t}),i.finish(!0)})):(P.error("No such action:",t),i.finish(!0))}),((e,i)=>{P.error(i,"Error during action:",t),e.finish(!0)}))}initEmbed(e){let t=sp(e),i=null,n=this;Vn((()=>{let e=Mn("commandLoop"),r=Bn().getScheduler();return n.hyperlinkListener=e=>{let t=e,i="#"===t.href.charAt(0)||n.packageURL.some((e=>t.href.substr(0,e.length)==e));if(i){e.preventDefault();let o={t:"hyperlink",href:t.href,internal:i};r.run((()=>(n.callback(o),zn(!0))))}},e.loopWithFrame((e=>{if(n.needResize)n.resize().then((()=>{e.continueLoop()}));else if(n.needRefresh)n.currentPage&&n.showCurrent(n.currentPage,!this.renderAllPages).then((()=>{e.continueLoop()}));else if(t){let i=t;t=null,n.runCommand(i).then((()=>{e.continueLoop()}))}else{let t=Mn("waitForCommand");i=t.suspend(this),t.result().then((()=>{e.continueLoop()}))}})).thenFinish(e),e.result()})),n.kick=()=>{let e=i;e&&(i=null,e.schedule(!0))},n.sendCommand=e=>!t&&(t=sp(e),n.kick(),!0),this.window.adapt_command=n.sendCommand}},rp=(e=>(e.FIT_INSIDE_VIEWPORT="fit inside viewport",e))(rp||{}),op=class e extends Error{constructor(){super(),l(this,"name","RenderingCanceledError"),l(this,"message","Page rendering has been canceled"),l(this,"stack"),Object.setPrototypeOf(this,e.prototype),this.stack=(new Error).stack}};function sp(e){return"string"==typeof e?W(e):e}var ap=m;function lp(e){let t={};return Object.keys(e).forEach((i=>{let n=e[i];switch(i){case"autoResize":t.autoresize=n;break;case"pageBorderWidth":t.pageBorder=n;break;default:t[i]=n}})),t}var hp=class{constructor(e,t){this.settings=e,l(this,"initialized",!1),l(this,"adaptViewer_"),l(this,"options"),l(this,"eventTarget"),l(this,"readyState"),f(e.debug),this.adaptViewer_=new np(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options={autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:"autoSpread",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8},t&&this.setOptions(t),this.eventTarget=new xe,Object.defineProperty(this,"readyState",{get(){return this.adaptViewer_.readyState}})}setOptions(e){let t=Object.assign({a:"configure"},lp(e));this.adaptViewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){let t={type:e.t},i=e;Object.keys(i).forEach((e=>{"t"!==e&&(t[e]=i[e])})),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,i){e&&(Array.isArray(e)?e[0]&&("string"==typeof e[0]||e[0].url):"string"==typeof e||e.url)?this.loadDocumentOrPublication(e,null,t,i):this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}})}loadPublication(e,t,i){e?this.loadDocumentOrPublication(null,e,t,i):this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}})}loadDocumentOrPublication(e,t,i,n){let r=i||{};function o(e){if(e)return e.map((e=>({url:e.url||null,text:e.text||null})))}let s=o(r.authorStyleSheet),a=o(r.userStyleSheet);n&&Object.assign(this.options,n);let l=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:up(e)||t,document:r.documentObject,fragment:r.fragment,authorStyleSheet:s,userStyleSheet:a},lp(this.options));this.initialized?this.adaptViewer_.sendCommand(l):(this.initialized=!0,this.adaptViewer_.initEmbed(l))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case"left":return this.getCurrentPageProgression()===ap.LTR?"previous":"next";case"right":return this.getCurrentPageProgression()===ap.LTR?"next":"previous";default:return e}}navigateToPage(e,t){"epage"===e?this.adaptViewer_.sendCommand({a:"moveTo",epage:t}):this.adaptViewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.adaptViewer_.sendCommand({a:"moveTo",url:e})}navigateToPosition(e){var t,i;this.adaptViewer_.sendCommand({a:"moveTo",position:{spineIndex:e.spineIndex,pageIndex:null!=(t=e.pageIndex)?t:-1,offsetInItem:null!=(i=e.offsetInItem)?i:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(e,t){let i=null==e?"toggle":e?"show":"hide";this.adaptViewer_.sendCommand({a:"toc",v:i,autohide:t})}queryZoomFactor(e){return this.adaptViewer_.queryZoomFactor(e)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var e,t;return null==(t=null==(e=this.adaptViewer_.opfView)?void 0:e.tocView)?void 0:t.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function up(e){function t(e){return"number"==typeof e?e:null}function i(e){return"string"==typeof e?{url:e,startPage:null,skipPagesBefore:null}:{url:e.url,startPage:t(e.startPage),skipPagesBefore:t(e.skipPagesBefore)}}return Array.isArray(e)?e.map(i):e?[i(e)]:null}var cp,dp=((cp=dp||{}).PREVIOUS="previous",cp.NEXT="next",cp.LEFT="left",cp.RIGHT="right",cp.FIRST="first",cp.LAST="last",cp.EPAGE="epage",cp),pp=rp,fp=ip;V.forceRegisterEndTiming("load_vivliostyle");var gp=class{constructor(e,{title:t="",printCallback:i=e=>e.print(),errorCallback:n=null,hideIframe:r=!0,removeIframe:o=!0}){l(this,"htmlDoc"),l(this,"title"),l(this,"printCallback"),l(this,"errorCallback"),l(this,"hideIframe"),l(this,"removeIframe"),l(this,"iframe"),l(this,"iframeWin"),l(this,"window"),this.htmlDoc=e,this.title=t,this.printCallback=i,this.errorCallback=n,this.hideIframe=r,this.removeIframe=o}init(){this.iframe=document.createElement("iframe"),this.hideIframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.borderWidth="0"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`\n      <!DOCTYPE html>\n      <html data-vivliostyle-paginated="true">\n        <head>\n          <meta charset='utf-8'/>\n          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>\n          <title>${this.title}</title>\n          <style>\n            html[data-vivliostyle-paginated] {\n              width: 100%;\n              height: 100%;\n            }\n            html[data-vivliostyle-paginated] body,\n            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {\n              width: 100% !important;\n              height: 100% !important;\n            }\n            html[data-vivliostyle-paginated],\n            html[data-vivliostyle-paginated] body {\n              margin: 0;\n              padding: 0;\n            }\n          </style>\n          <style id='vivliostyle-page-rules'></style>\n        </head>\n        <body onload='parent.printInstance.runInIframe(window)'>\n          <div id="vivliostyle-viewer-viewport"></div>\n        </body>\n      </html>`,document.body.appendChild(this.iframe)}runInIframe(e){return this.iframeWin=e,this.preparePrint().then((()=>this.browserPrint())).then((()=>this.cleanUp()))}preparePrint(){this.iframeWin.document.title=this.title;let e=new Blob([this.htmlDoc],{type:"text/html"}),t=URL.createObjectURL(e),i=new hp({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise((e=>{i.addListener("readystatechange",(()=>{"complete"===i.readyState&&e()})),this.errorCallback&&i.addListener("error",(e=>{var t,i;let n=null!=(i=null==(t=e.content.error)?void 0:t.toString())?i:e.content.messages.join("\n");this.errorCallback(n)})),i.loadDocument({url:t})}))}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function mp(e,t){new gp(e,t).init()}return c}(),b=e({__proto__:null,default:t(m)},[m]);!function(e){e.Default="",e.Auto="auto",e.Preset="preset",e.Custom="custom",e.Zero="0"}(g||(g={}));const v=[{name:"letter",description:"Letter"},{name:"legal",description:"Legal"},{name:"ledger",description:"Ledger"},{name:"a10",description:"A10"},{name:"a9",description:"A9"},{name:"a8",description:"A8"},{name:"a7",description:"A7"},{name:"a6",description:"A6"},{name:"a5",description:"A5"},{name:"a4",description:"A4"},{name:"a3",description:"A3"},{name:"a2",description:"A2"},{name:"a1",description:"A1"},{name:"a0",description:"A0"},{name:"b10",description:"B10 (ISO)"},{name:"b9",description:"B9 (ISO)"},{name:"b8",description:"B8 (ISO)"},{name:"b7",description:"B7 (ISO)"},{name:"b6",description:"B6 (ISO)"},{name:"b5",description:"B5 (ISO)"},{name:"b4",description:"B4 (ISO)"},{name:"b3",description:"B3 (ISO)"},{name:"b2",description:"B2 (ISO)"},{name:"b1",description:"B1 (ISO)"},{name:"b0",description:"B0 (ISO)"},{name:"jis-b10",description:"JIS-B10"},{name:"jis-b9",description:"JIS-B9"},{name:"jis-b8",description:"JIS-B8"},{name:"jis-b7",description:"JIS-B7"},{name:"jis-b6",description:"JIS-B6"},{name:"jis-b5",description:"JIS-B5"},{name:"jis-b4",description:"JIS-B4"},{name:"jis-b3",description:"JIS-B3"},{name:"jis-b2",description:"JIS-B2"},{name:"jis-b1",description:"JIS-B1"},{name:"jis-b0",description:"JIS-B0"},{name:"c10",description:"C10"},{name:"c9",description:"C9"},{name:"c8",description:"C8"},{name:"c7",description:"C7"},{name:"c6",description:"C6"},{name:"c5",description:"C5"},{name:"c4",description:"C4"},{name:"c3",description:"C3"},{name:"c2",description:"C2"},{name:"c1",description:"C1"},{name:"c0",description:"C0"}],w={customWidth:"210mm",customHeight:"297mm",customMargin:"10%",baseFontSize:"12pt",baseLineHeight:"1.2",baseFontFamily:"serif",viewerFontSize:16,cropMarks:"crop cross",bleed:"3mm",cropOffset:"9mm"};class y{constructor(e){this.PresetSize=y.PresetSize,this.pageSizeMode=a.observable(g.Default),this.presetSize=a.observable(v[9]),this.isLandscape=a.observable(!1),this.customWidth=a.observable(w.customWidth),this.customHeight=a.observable(w.customHeight),this.pageSizeImportant=a.observable(!1),this.pageMarginMode=a.observable(g.Default),this.customMargin=a.observable(w.customMargin),this.pageMarginImportant=a.observable(!1),this.firstPageMarginZero=a.observable(!1),this.firstPageMarginZeroImportant=a.observable(!1),this.forceHtmlBodyMarginZero=a.observable(!1),this.widowsOrphans=a.observable(""),this.widowsOrphansImportant=a.observable(!1),this.imageMaxSizeToFitPage=a.observable(!1),this.imageMaxSizeToFitPageImportant=a.observable(!1),this.imageKeepAspectRatio=a.observable(!1),this.imageKeepAspectRatioImportant=a.observable(!1),this.baseFontSize=a.observable(w.baseFontSize),this.baseFontSizeSpecified=a.observable(!1),this.baseFontSizeImportant=a.observable(!1),this.baseLineHeight=a.observable(w.baseLineHeight),this.baseLineHeightSpecified=a.observable(!1),this.baseLineHeightImportant=a.observable(!1),this.baseFontFamily=a.observable(w.baseFontFamily),this.baseFontFamilySpecified=a.observable(!1),this.baseFontFamilyImportant=a.observable(!1),this.cropMarks=a.observable(w.cropMarks),this.cropMarksSpecified=a.observable(!1),this.cropMarksImportant=a.observable(!1),this.bleed=a.observable(w.bleed),this.bleedSpecified=a.observable(!1),this.bleedImportant=a.observable(!1),this.cropOffset=a.observable(w.cropOffset),this.cropOffsetSpecified=a.observable(!1),this.cropOffsetImportant=a.observable(!1),this.customStyleAsUserStyle=a.observable(!1),this.allImportant=a.observable(!1),this.pageOtherStyle=a.observable(""),this.firstPageOtherStyle=a.observable(""),this.rootOtherStyle=a.observable(""),this.beforeOtherStyle=a.observable(""),this.afterOtherStyle=a.observable(""),this.viewerFontSize=null,this.setViewerFontSizeObservable=e=>{this.viewerFontSize=e;const t=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];t&&(t.value=this.fontSizePxToPercent(Number(e()),100,5).toString())},this.viewerFontSizePercent=a.pureComputed({read(){if(!this.viewerFontSize)return 100;return this.fontSizePxToPercent(Number(this.viewerFontSize()),100,5)},write(e){if(!this.viewerFontSize)return;const t=parseFloat(String(e));let i=t&&this.fontSizePercentToPx(t);if(!i||Number(i)<5||Number(i)>72){const e=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];e&&(e.value="100"),i=w.viewerFontSize}this.viewerFontSize(Number(i))},owner:this}),this.cssText=a.pureComputed({read:this.toCSSText,write:this.fromCSSText,owner:this}),this.allImportant.subscribe((e=>{this.pageSizeImportant(e),this.pageMarginImportant(e),this.firstPageMarginZeroImportant(e),this.widowsOrphansImportant(e),this.imageMaxSizeToFitPageImportant(e),this.imageKeepAspectRatioImportant(e),this.baseFontSizeImportant(e),this.baseLineHeightImportant(e),this.baseFontFamilyImportant(e),this.cropMarksImportant(e),this.bleedImportant(e),this.cropOffsetImportant(e)})),this.cropMarksSpecified.subscribe((e=>{e?this.bleedSpecified(!0):(this.bleedSpecified(!1),this.cropOffsetSpecified(!1))})),this.pageStyleRegExp=new RegExp("^((?:\\n|.)*?)\\/\\*<viewer>\\*\\/\\s*(?:@page\\s*\\{\\s*(?:size:\\s*([^\\s!;{}]+)(?:\\s+([^\\s!;{}]+))?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:margin:\\s*([^\\s!;{}]+(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:marks:\\s*([^\\s!;{}]+(?:\\s+[^\\s!;{}]+)?)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:bleed:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:crop-offset:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?(?:@page\\s*:first\\s*\\{\\s*(margin:\\s*0(?:\\w+|%)?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?((?:html|:root),\\s*body\\s*\\{\\s*margin:\\s*0(?:\\w+|%)?\\s*!important(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:(?:html|:root)\\s*\\{\\s*(?:font-size:\\s*(calc\\([^()]+\\)|[^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:line-height:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:font-family:\\s*([^!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?([^{}]*)\\}\\s*)?(?:body\\s*\\{\\s*(?:[-\\w]+:\\s*inherit\\s*!important(?:;|(?=[\\s{}]))\\s*)+\\}\\s*)?(?:\\*\\s*\\{\\s*widows:\\s*(1|999)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*orphans:\\s*\\25\\s*\\26(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:img,\\s*svg\\s*\\{\\s*(max-inline-size:\\s*100%\\s*(!important)?(?:;|(?=[\\s{}]))\\s*max-block-size:\\s*100vb\\s*\\28(?:;|(?=[\\s{}]))\\s*)?(object-fit:\\s*contain\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?\\}\\s*)?((?:\\n|.)*)$"),e&&this.copyFrom(e)}fontSizePxToPercent(e,t,i){let n=e/w.viewerFontSize*(t||100);return i&&(n=n.toPrecision(i).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),n}fontSizePercentToPx(e,t,i){let n=e/(t||100)*w.viewerFontSize;return i&&(n=n.toPrecision(i).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),n}fromCSSText(e){const t=this.pageStyleRegExp.exec(e);if(t){const[,e,i,n,r,o,s,a,l,h,u,c,d,p,f,m,b,w,y,x,S,C,k,E,P,N,T,I,R,_,A,L]=t;let O=L,F=k,B=y,M=b,z=p,D=P,V=i,U=n,H=0,$=0;if(this.beforeOtherStyle(e),"landscape"==V||"portrait"==V?(this.isLandscape("landscape"==V),V=U,U=null):"landscape"!=U&&"portrait"!=U||(this.isLandscape("landscape"==U),U=null),null!=V){if(null==U)if("auto"==V)this.pageSizeMode(g.Auto);else{const e=v.find((e=>e.name.toLowerCase()==V.toLowerCase()));e?(this.pageSizeMode(g.Preset),this.presetSize(e)):(this.pageSizeMode(g.Custom),this.customWidth(V),this.customHeight(V))}else this.pageSizeMode(g.Custom),this.customWidth(V),this.customHeight(U);this.pageSizeImportant(!!r),r?H++:$++}else this.pageSizeMode(g.Default);null!=o?(this.pageMarginMode("0"==o?g.Zero:g.Custom),"0"==o?this.pageMarginMode(g.Zero):(this.pageMarginMode(g.Custom),this.customMargin(o)),this.pageMarginImportant(!!s),s?H++:$++):this.pageMarginMode(g.Default),null!=a?(this.cropMarksSpecified(!0),this.cropMarks(a),this.cropMarksImportant(!!l),l?H++:$++):this.cropMarksSpecified(!1),null!=h?(this.bleedSpecified(!0),this.bleed(h),this.bleedImportant(!!u),u?H++:$++):this.bleedSpecified(!1),null!=c?(this.cropOffsetSpecified(!0),this.cropOffset(c),this.cropOffsetImportant(!!d),d?H++:$++):this.cropOffsetSpecified(!1),z=z||"",this.pageOtherStyle(z),f?(this.firstPageMarginZero(!0),this.firstPageMarginZeroImportant(!!m),m?H++:$++):this.firstPageMarginZero(!1),M=M||"",this.firstPageOtherStyle(M),w?this.forceHtmlBodyMarginZero(!0):this.forceHtmlBodyMarginZero(!1),null!=B?(B=B.replace(/^\s*calc\([.\d]+\s*\*\s*([.\d]+\w+)\)\s*$/,"$1"),this.baseFontSizeSpecified(!0),this.baseFontSize(B),this.baseFontSizeImportant(!!x),x?H++:$++):this.baseFontSizeSpecified(!1),null!=S?(this.baseLineHeightSpecified(!0),this.baseLineHeight(S),this.baseLineHeightImportant(!!C),C?H++:$++):this.baseLineHeightSpecified(!1),null!=F?(F=F.trim(),this.baseFontFamilySpecified(!0),this.baseFontFamily(F),this.baseFontFamilyImportant(!!E),E?H++:$++):this.baseFontFamilySpecified(!1),D=D||"",this.rootOtherStyle(D),null!=N?(this.widowsOrphans(N),this.widowsOrphansImportant(!!T),T?H++:$++):this.widowsOrphans(g.Default),I?(this.imageMaxSizeToFitPage(!0),this.imageMaxSizeToFitPageImportant(!!R),R?H++:$++):this.imageMaxSizeToFitPage(!1),_?(this.imageKeepAspectRatio(!0),this.imageKeepAspectRatioImportant(!!A),A?H++:$++):this.imageKeepAspectRatio(!1),O=O.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"",this.afterOtherStyle(O),this.allImportant(H>0&&0==$)}else{const t=e.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"";this.afterOtherStyle(t)}}toCSSText(){function e(e){return e?" !important":""}let t=this.beforeOtherStyle();if(t+="/*<viewer>*/\n",this.pageSizeMode()!=g.Default||this.pageMarginMode()!=g.Default||this.cropMarksSpecified()||this.bleedSpecified()||this.cropOffsetSpecified()||this.pageOtherStyle()){if(t+="@page { ",this.pageSizeMode()!=g.Default){switch(t+="size: ",this.pageSizeMode()){case g.Auto:t+="auto";break;case g.Preset:t+=this.presetSize().name,this.isLandscape()&&(t+=" landscape");break;case g.Custom:t+=`${this.customWidth()} ${this.customHeight()}`;break;default:throw new Error(`Unknown pageSizeMode ${this.pageSizeMode()}`)}t+=`${e(this.pageSizeImportant())}; `}if(this.pageMarginMode()!=g.Default){switch(t+="margin: ",this.pageMarginMode()){case g.Auto:t+="auto";break;case g.Zero:t+="0";break;case g.Custom:t+=`${this.customMargin()}`;break;default:throw new Error(`Unknown pageMarginMode ${this.pageMarginMode()}`)}t+=`${e(this.pageMarginImportant())}; `}this.cropMarksSpecified()&&(t+=`marks: ${this.cropMarks()}${e(this.cropMarksImportant())}; `),this.bleedSpecified()&&(t+=`bleed: ${this.bleed()}${e(this.bleedImportant())}; `),this.cropOffsetSpecified()&&(t+=`crop-offset: ${this.cropOffset()}${e(this.cropOffsetImportant())}; `),t+=this.pageOtherStyle(),t+="}\n"}if((this.firstPageMarginZero()||this.firstPageOtherStyle())&&(t+="@page :first { ",this.firstPageMarginZero()&&(t+=`margin: 0${e(this.firstPageMarginZeroImportant())}; `),t+=this.firstPageOtherStyle(),t+="}\n"),this.forceHtmlBodyMarginZero()&&(t+=":root, body { margin: 0 !important; }\n"),this.baseFontSizeSpecified()||this.baseLineHeightSpecified()||this.baseFontFamilySpecified()||this.rootOtherStyle()){t+=":root { ";const i=this.baseFontSize();if(this.baseFontSizeSpecified())if(this.viewerFontSize&&this.viewerFontSize()!=w.viewerFontSize&&!i.endsWith("%")){t+=`font-size: calc(${this.fontSizePxToPercent(Number(this.viewerFontSize()),1,5)} * ${i})${e(this.baseFontSizeImportant())}; `}else t+=`font-size: ${this.baseFontSize()}${e(this.baseFontSizeImportant())}; `;this.baseLineHeightSpecified()&&(t+=`line-height: ${this.baseLineHeight()}${e(this.baseLineHeightImportant())}; `),this.baseFontFamilySpecified()&&(t+=`font-family: ${this.baseFontFamily()}${e(this.baseFontFamilyImportant())}; `),t+=this.rootOtherStyle(),t+="}\n"}return(this.baseFontSizeSpecified()&&this.baseFontSizeImportant()||this.baseLineHeightSpecified()&&this.baseLineHeightImportant()||this.baseFontFamilySpecified()&&this.baseFontFamilyImportant())&&(t+="body { ",this.baseFontSizeSpecified()&&this.baseFontSizeImportant()&&(t+="font-size: inherit !important; "),this.baseLineHeightSpecified()&&this.baseLineHeightImportant()&&(t+="line-height: inherit !important; "),this.baseFontFamilySpecified()&&this.baseFontFamilyImportant()&&(t+="font-family: inherit !important; "),t+="}\n"),this.widowsOrphans()&&(t+="* { ",t+=`widows: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+=`orphans: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+="}\n"),(this.imageMaxSizeToFitPage()||this.imageKeepAspectRatio())&&(t+="img, svg { ",this.imageMaxSizeToFitPage()&&(t+=`max-inline-size: 100%${e(this.imageMaxSizeToFitPageImportant())}; `,t+=`max-block-size: 100vb${e(this.imageMaxSizeToFitPageImportant())}; `),this.imageKeepAspectRatio()&&(t+=`object-fit: contain${e(this.imageKeepAspectRatioImportant())}; `),t+="}\n"),t+="/*</viewer>*/\n",t+=this.afterOtherStyle(),t}copyFrom(e){this.pageSizeMode(e.pageSizeMode()),this.presetSize(e.presetSize()),this.isLandscape(e.isLandscape()),this.customWidth(e.customWidth()),this.customHeight(e.customHeight()),this.pageSizeImportant(e.pageSizeImportant()),this.pageMarginMode(e.pageMarginMode()),this.customMargin(e.customMargin()),this.pageMarginImportant(e.pageMarginImportant()),this.firstPageMarginZero(e.firstPageMarginZero()),this.firstPageMarginZeroImportant(e.firstPageMarginZeroImportant()),this.forceHtmlBodyMarginZero(e.forceHtmlBodyMarginZero()),this.widowsOrphans(e.widowsOrphans()),this.widowsOrphansImportant(e.widowsOrphansImportant()),this.imageMaxSizeToFitPage(e.imageMaxSizeToFitPage()),this.imageMaxSizeToFitPageImportant(e.imageMaxSizeToFitPageImportant()),this.imageKeepAspectRatio(e.imageKeepAspectRatio()),this.imageKeepAspectRatioImportant(e.imageKeepAspectRatioImportant()),this.baseFontSize(e.baseFontSize()),this.baseFontSizeSpecified(e.baseFontSizeSpecified()),this.baseFontSizeImportant(e.baseFontSizeImportant()),this.baseLineHeight(e.baseLineHeight()),this.baseLineHeightSpecified(e.baseLineHeightSpecified()),this.baseLineHeightImportant(e.baseLineHeightImportant()),this.baseFontFamily(e.baseFontFamily()),this.baseFontFamilySpecified(e.baseFontFamilySpecified()),this.baseFontFamilyImportant(e.baseFontFamilyImportant()),this.cropMarks(e.cropMarks()),this.cropMarksSpecified(e.cropMarksSpecified()),this.cropMarksImportant(e.cropMarksImportant()),this.bleed(e.bleed()),this.bleedSpecified(e.bleedSpecified()),this.bleedImportant(e.bleedImportant()),this.cropOffset(e.cropOffset()),this.cropOffsetSpecified(e.cropOffsetSpecified()),this.cropOffsetImportant(e.cropOffsetImportant()),this.allImportant(e.allImportant()),this.pageOtherStyle(e.pageOtherStyle()),this.firstPageOtherStyle(e.firstPageOtherStyle()),this.rootOtherStyle(e.rootOtherStyle()),this.beforeOtherStyle(e.beforeOtherStyle()),this.afterOtherStyle(e.afterOtherStyle()),this.viewerFontSize&&e.viewerFontSize&&this.viewerFontSize(e.viewerFontSize()),this.customStyleAsUserStyle(e.customStyleAsUserStyle())}equivalentTo(e){return this.pageSizeMode()===e.pageSizeMode()&&((this.pageSizeMode()!==g.Preset||this.presetSize()===e.presetSize())&&((this.pageSizeMode()!==g.Preset||this.isLandscape()===e.isLandscape())&&((this.pageSizeMode()!==g.Custom||this.customWidth()===e.customWidth())&&((this.pageSizeMode()!==g.Custom||this.customHeight()===e.customHeight())&&(this.pageSizeImportant()===e.pageSizeImportant()&&(this.pageMarginMode()===e.pageMarginMode()&&((this.pageMarginMode()!==g.Custom||this.customMargin()===e.customMargin())&&(this.pageMarginImportant()===e.pageMarginImportant()&&(this.firstPageMarginZero()===e.firstPageMarginZero()&&(this.firstPageMarginZeroImportant()===e.firstPageMarginZeroImportant()&&(this.forceHtmlBodyMarginZero()===e.forceHtmlBodyMarginZero()&&(this.widowsOrphans()===e.widowsOrphans()&&(this.widowsOrphansImportant()===e.widowsOrphansImportant()&&(this.imageMaxSizeToFitPage()===e.imageMaxSizeToFitPage()&&(this.imageMaxSizeToFitPageImportant()===e.imageMaxSizeToFitPageImportant()&&(this.imageKeepAspectRatio()===e.imageKeepAspectRatio()&&(this.imageKeepAspectRatioImportant()===e.imageKeepAspectRatioImportant()&&(this.baseFontSizeSpecified()===e.baseFontSizeSpecified()&&((!this.baseFontSizeSpecified()||this.baseFontSize()===e.baseFontSize())&&(this.baseFontSizeImportant()===e.baseFontSizeImportant()&&(this.baseLineHeightSpecified()===e.baseLineHeightSpecified()&&((!this.baseLineHeightSpecified()||this.baseLineHeight()===e.baseLineHeight())&&(this.baseLineHeightImportant()===e.baseLineHeightImportant()&&(this.baseFontFamilySpecified()===e.baseFontFamilySpecified()&&((!this.baseFontFamilySpecified()||this.baseFontFamily()===e.baseFontFamily())&&(this.baseFontFamilyImportant()===e.baseFontFamilyImportant()&&(this.cropMarksSpecified()===e.cropMarksSpecified()&&((!this.cropMarksSpecified()||this.cropMarks()===e.cropMarks())&&(this.cropMarksImportant()===e.cropMarksImportant()&&(this.bleedSpecified()===e.bleedSpecified()&&((!this.bleedSpecified()||this.bleed()===e.bleed())&&(this.bleedImportant()===e.bleedImportant()&&(this.cropOffsetSpecified()===e.cropOffsetSpecified()&&((!this.cropOffsetSpecified()||this.cropOffset()===e.cropOffset())&&(this.cropOffsetImportant()===e.cropOffsetImportant()&&(this.customStyleAsUserStyle()===e.customStyleAsUserStyle()&&(this.allImportant()===e.allImportant()&&(this.pageOtherStyle()===e.pageOtherStyle()&&(this.firstPageOtherStyle()===e.firstPageOtherStyle()&&(this.rootOtherStyle()===e.rootOtherStyle()&&(this.beforeOtherStyle()===e.beforeOtherStyle()&&(this.afterOtherStyle()===e.afterOtherStyle()&&!(!this.viewerFontSize!=!e.viewerFontSize||this.viewerFontSize&&this.viewerFontSize()!==e.viewerFontSize())))))))))))))))))))))))))))))))))))))))))))}}y.Mode=g,y.Constants=w,y.PresetSize=v;var x={escapeUnicodeChar:e=>`\\u${(65536|e.charCodeAt(0)).toString(16).substring(1)}`,escapeUnicodeString(e){return e.replace(/[^-a-zA-Z0-9_]/g,this.escapeUnicodeChar)},percentEncodeAmpersandAndUnencodedPercent:e=>e.replace(/%(?![0-9A-Fa-f]{2})/g,"%25").replace(/&/g,"%26"),percentEncodeAmpersandAndPercent:e=>e.replace(/%/g,"%25").replace(/&/g,"%26"),percentDecodeAmpersandAndPercent:e=>e.replace(/%26/g,"&").replace(/%25/g,"%"),percentEncodeForDataURI:e=>encodeURI(e).replace(/#/g,"%23").replace(/&/g,"%26")};function S(e){return new RegExp(`[#&]${x.escapeUnicodeString(e)}=([^&]*)`,"g")}const C=new class{constructor(){this.localStorageKey=null,this.history=window.history,this.location=window.location,this.storedUrl=this.location.href}getBaseURL(){let e=this.location.href;return e=e.replace(/#.*$/,""),e.replace(/\/[^/]*$/,"/")}hasParameter(e){const t=this.location.href;return S(e).test(t)}getParameter(e){const t=this.location.href,i=S(e),n=[];let r;for(;r=i.exec(t);)n.push(r[1]);return n}setParameter(e,t,i){var n;const r=this.location.href;let o=r;const s=S(e);let a=s.exec(r);if(a&&i)for(;i-- >=1;)a=s.exec(r);if(a){const e=a[1].length,i=a.index+a[0].length-e;o=r.substring(0,i)+t+r.substring(i+e)}else o=`${r+(r.match(/[#&]$/)?"":r.match(/#/)?"&":"#")+e}=${t}`,"src"===e&&(o=o.replace(/#(?!src)(.*?)&(src=[^&]*)/,"#$2&$1"));o!==r&&((null===(n=this.history)||void 0===n?void 0:n.replaceState)?this.history.replaceState(null,"",o):this.location.href=o,this.storedUrl=o,this.saveViewSettings())}removeParameter(e,t){var i;const n=this.location.href;let r=n;const o=S(e);let s=o.exec(n);if(s&&t&&(s=o.exec(n)),s){for(;s;s=o.exec(r)){const e=s.index+s[0].length;r="#"==s[0].charAt(0)?r.substring(0,s.index+1)+r.substring(e+1):r.substring(0,s.index)+r.substring(e),o.lastIndex-=s[0].length}r=r.replace(/^(.*?)[#&]$/,"$1")}r!==n&&((null===(i=this.history)||void 0===i?void 0:i.replaceState)?this.history.replaceState(null,"",r):this.location.href=r,this.storedUrl=r,this.saveViewSettings())}enableRestoreView(e){const t=this.generateLocalStorageKey();if(e)this.localStorageKey=t;else{this.localStorageKey=null;try{window.localStorage.removeItem(t)}catch(e){}}}isEnabledRestoreView(){return!!this.localStorageKey}saveViewSettings(){if(this.localStorageKey){this.hasParameter("f")||this.setParameter("f","epubcfi()");try{window.localStorage.setItem(this.localStorageKey,this.location.hash)}catch(e){}}}generateLocalStorageKey(){const e=this.getParameter("src").join();return e?"view@"+e:null}restoreViewSettings(){const e=this.generateLocalStorageKey();if(e)try{const t=window.localStorage.getItem(e);if(t)return this.location.hash=t,!0}catch(e){}return!1}};class k{constructor(e){var t;const i=function(){const e=C.getParameter("src"),t=C.getParameter("b"),i=C.getParameter("x"),n=C.getParameter("bookMode")[0],r=C.getParameter("f")[0],o=C.getParameter("style"),s=C.getParameter("userStyle");return{srcUrls:e.length?e:t.length?t:i.length?i:null,bookMode:"true"===n||"false"!==n&&(!!t.length||!i.length&&!(e.length>1)&&null),fragment:r||null,authorStyleSheet:o.length?o:[],userStyleSheet:s.length?s:[]}}();this.srcUrls=a.observable(i.srcUrls||null),this.bookMode=a.observable(null!==(t=i.bookMode)&&void 0!==t?t:e),this.fragment=a.observable(i.fragment||""),this.authorStyleSheet=a.observable(i.authorStyleSheet),this.userStyleSheet=a.observable(i.userStyleSheet),this.pageStyle=new y,this.dataCustomStyleIndex=-1,this.bookMode.subscribe((t=>{t===e?C.removeParameter("bookMode"):C.setParameter("bookMode",t.toString())})),this.fragment.subscribe((e=>{if(/^epubcfi\(\/([246]\/)?2!\)/.test(e)&&!C.isEnabledRestoreView())C.removeParameter("f");else{const t=e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent);C.setParameter("f",t)}}));const n=(e,t)=>{if(/^data:,.*?\/\*(?:<|%3C)viewer(?:>|%3E)\*\//.test(e)){this.dataCustomStyleIndex=t;const i=e.replace(/^data:,/,"").replace(/%(?![0-9A-Fa-f]{2})/g,"%25"),n=decodeURIComponent(i);return this.pageStyle.cssText(n),!0}return!1};i.authorStyleSheet.find(n)||i.userStyleSheet.find(n)&&this.pageStyle.customStyleAsUserStyle(!0),this.pageStyle.cssText.subscribe((e=>{this.updateCustomStyleSheetFromCSSText(e)}))}toObject(){function e(e){return e.map((e=>({url:e})))}return{fragment:this.fragment(),authorStyleSheet:e(this.authorStyleSheet()),userStyleSheet:e(this.userStyleSheet())}}updateCustomStyleSheetFromCSSText(e){null==e&&(e=this.pageStyle.toCSSText());const t=this.pageStyle.customStyleAsUserStyle(),i=t?"userStyle":"style",n=t?this.userStyleSheet:this.authorStyleSheet,r=n();if((!e||/^\s*(\/\*([^*]|\*(?!\/))*\*\/\s*)*$/.test(e))&&r.length<=(-1==this.dataCustomStyleIndex?0:1))return r.pop(),this.dataCustomStyleIndex=-1,n(r),void C.removeParameter(i);const o="data:,"+x.percentEncodeForDataURI(e.trim());-1==this.dataCustomStyleIndex?(r.push(o),this.dataCustomStyleIndex=r.length-1):r[this.dataCustomStyleIndex]=o,n(r),C.setParameter(i,o,this.dataCustomStyleIndex)}switchCustomStyleUserOrAuthorStyleSheets(){const e=this.pageStyle.customStyleAsUserStyle();if(-1!==this.dataCustomStyleIndex){const[t,i]=e?["style","userStyle"]:["userStyle","style"],[n,r]=e?[this.authorStyleSheet,this.userStyleSheet]:[this.userStyleSheet,this.authorStyleSheet],o=n(),s=r(),a=o[this.dataCustomStyleIndex];a&&(o.splice(this.dataCustomStyleIndex,1),s.push(a),this.dataCustomStyleIndex=s.length-1,n(o),r(s),C.removeParameter(t),C.removeParameter(i),o.forEach(((e,i)=>{C.setParameter(t,e,i)})),s.forEach(((e,t)=>{C.setParameter(i,e,t)})))}}}class E{toSpreadViewString(){switch(this){case P.SPREAD:return"true";case P.SINGLE_PAGE:return"false";case P.AUTO_SPREAD:return"auto";default:throw new Error("Invalid PageViewMode")}}toString(){switch(this){case P.SPREAD:return"spread";case P.SINGLE_PAGE:return"singlePage";case P.AUTO_SPREAD:return"autoSpread";default:throw new Error("Invalid PageViewMode")}}}const P={AUTO_SPREAD:new E,SINGLE_PAGE:new E,SPREAD:new E,defaultMode(){return this.AUTO_SPREAD},fromSpreadViewString(e){switch(e){case"true":return this.SPREAD;case"false":return this.SINGLE_PAGE;default:return this.AUTO_SPREAD}},of(e){switch(e){case m.PageViewMode.SPREAD:return this.SPREAD;case m.PageViewMode.SINGLE_PAGE:return this.SINGLE_PAGE;case m.PageViewMode.AUTO_SPREAD:return this.AUTO_SPREAD;default:throw new Error(`Invalid PageViewMode name: ${e}`)}}};class N{constructor(e){this.zoom=e}get fitToScreen(){return null}getCurrentZoomFactor(e){return 1}toggleFitToScreen(){return new N(1)}zoomIn(e){return new I(1.25*this.getCurrentZoomFactor(e))}zoomOut(e){return new I(.8*this.getCurrentZoomFactor(e))}zoomToActualSize(){return new I(1)}static createDefaultOptions(){return new T}static createFromZoomFactor(e){return new I(e)}}class T extends N{constructor(){super(1)}get fitToScreen(){return!0}toggleFitToScreen(){return new I(1)}getCurrentZoomFactor(e){return e.queryZoomFactor(m.ZoomType.FIT_INSIDE_VIEWPORT)}}class I extends N{get fitToScreen(){return!1}toggleFitToScreen(){return new T}getCurrentZoomFactor(){return this.zoom}}function R(){return{allowScripts:!0,renderAllPages:!0,fontSize:16,profile:!1,pageViewMode:P.defaultMode(),zoom:N.createDefaultOptions(),pixelRatio:8,enableMarker:!1}}function _(e){return e.toPrecision(10).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")}class A{constructor(e){var t,i,n;const r="boolean"==typeof e?e:void 0,o="object"==typeof e?e:void 0;if(this.allowScripts=a.observable(),this.renderAllPages=a.observable(),this.fontSize=a.observable(),this.profile=a.observable(),this.pageViewMode=a.observable(),this.zoom=a.observable(),this.pixelRatio=a.observable(),this.enableMarker=a.observable(),o)this.copyFrom(o);else{const e=R(),o=function(){const e=C.getParameter("allowScripts")[0],t=C.getParameter("renderAllPages")[0],i=C.getParameter("fontSize")[0],n=C.getParameter("enableMarker")[0],r=/^([\d.]+)(?:(%25|%)|\/([\d.]+))?$/.exec(i);let o=null;if(r){const[,e,t,i]=r;o=parseFloat(e),(t||i)&&(o=16*o/(t?100:parseFloat(i))),o<5&&(o=5),o>72&&(o=72)}const s=C.getParameter("zoom")[0],a=parseFloat(s),l=C.getParameter("pixelRatio")[0],h=l&&parseFloat(l);return{allowScripts:"true"===e||"false"!==e&&null,renderAllPages:"true"===t||"false"!==t&&!C.hasParameter("b")&&null,fontSize:o,profile:"true"===C.getParameter("profile")[0],pageViewMode:P.fromSpreadViewString(C.getParameter("spread")[0]),zoom:a>0?N.createFromZoomFactor(a):N.createDefaultOptions(),pixelRatio:h,enableMarker:"true"===n||"false"!==n&&null}}();this.allowScripts(null!==(t=o.allowScripts)&&void 0!==t?t:e.allowScripts),this.renderAllPages(null!==(i=o.renderAllPages)&&void 0!==i?i:r),this.fontSize(o.fontSize||e.fontSize),this.profile(o.profile||e.profile),this.pageViewMode(o.pageViewMode||e.pageViewMode),this.zoom(o.zoom||e.zoom),this.pixelRatio(null!==(n=o.pixelRatio)&&void 0!==n?n:e.pixelRatio),this.enableMarker(o.enableMarker||e.enableMarker),this.pageViewMode.subscribe((t=>{t===e.pageViewMode?C.removeParameter("spread"):C.setParameter("spread",t.toSpreadViewString())})),this.renderAllPages.subscribe((e=>{e===r?C.removeParameter("renderAllPages"):C.setParameter("renderAllPages",e.toString())})),this.fontSize.subscribe((t=>{"number"==typeof t&&(t=_(t)),Number(t)==e.fontSize?C.removeParameter("fontSize"):C.setParameter("fontSize",`${t}/${e.fontSize}`)})),this.zoom.subscribe((e=>{e.fitToScreen?C.removeParameter("zoom"):C.setParameter("zoom",_(e.getCurrentZoomFactor()))})),this.enableMarker.subscribe((e=>{e?C.setParameter("enableMarker","true"):C.removeParameter("enableMarker")}))}}copyFrom(e){this.allowScripts(e.allowScripts()),this.renderAllPages(e.renderAllPages()),this.fontSize(e.fontSize()),this.profile(e.profile()),this.pageViewMode(e.pageViewMode()),this.zoom(e.zoom()),this.pixelRatio(e.pixelRatio()),this.enableMarker(e.enableMarker())}toObject(){return{allowScripts:this.allowScripts(),renderAllPages:this.renderAllPages(),fontSize:Number(this.fontSize()),pageViewMode:this.pageViewMode().toString(),fitToScreen:this.zoom().fitToScreen,zoom:this.zoom().zoom,pixelRatio:this.pixelRatio()}}}A.getDefaultValues=R;var L,O=a.observableArray();!function(e){e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(L||(L={}));class F{static getLogger(){return new F}constructor(){this.logLevel=L.Error}setLogLevel(e){this.logLevel=e}debug(e){this.logLevel===L.Debug&&O.push({type:"debug",content:e})}info(e){this.logLevel!==L.Debug&&this.logLevel!==L.Info||O.push({type:"info",content:e})}warn(e){this.logLevel!==L.Debug&&this.logLevel!==L.Info&&this.logLevel!==L.Warn||O.push({type:"warn",content:e})}error(e){var t;if(this.logLevel===L.Debug||this.logLevel===L.Info||this.logLevel===L.Warn||this.logLevel===L.Error){if(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.toString().includes("history.replaceState()"))return;O.push({type:"error",content:e})}}}const B={readonlyObservable(e){const t=a.observable(e);return{getter:a.pureComputed((()=>t())),value:t}}};class M{constructor(e,t){this.viewerOptions=t,this.documentOptions=null,this.coreViewer=new m.CoreViewer(e,t.toObject());const i=this.privState={status:B.readonlyObservable(m.ReadyState.LOADING),pageProgression:B.readonlyObservable(m.PageProgression.LTR)};this.state={status:i.status.getter.extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"},notify:"always"}),navigatable:a.pureComputed((()=>i.status.value()&&i.status.value()!==m.ReadyState.LOADING)),fixedLayout:a.observable(),pageProgression:i.pageProgression.getter},this.epage=a.observable(),this.epageCount=a.observable(),this.firstPage=a.observable(),this.lastPage=a.observable(),this.tocVisible=a.observable(),this.tocPinned=a.observable(),this.inputUrl=a.observable(""),this.rerenderTrigger=a.observable(!1),this.setupViewerEventHandler(),this.setupViewerOptionSubscriptions(),window.coreViewer=this.coreViewer}setupViewerEventHandler(){const e=F.getLogger();this.coreViewer.addListener("debug",(t=>{e.debug(t.content)})),this.coreViewer.addListener("info",(t=>{e.info(t.content)})),this.coreViewer.addListener("warn",(t=>{e.warn(t.content)})),this.coreViewer.addListener("error",(t=>{e.error(t.content)})),this.coreViewer.addListener("readystatechange",(()=>{const e=this.coreViewer.readyState;e!==m.ReadyState.INTERACTIVE&&e!==m.ReadyState.COMPLETE||this.privState.pageProgression.value(this.coreViewer.getCurrentPageProgression()),this.privState.status.value(e)})),this.coreViewer.addListener("loaded",(()=>{this.viewerOptions.profile()&&m.profiler.printTimings(),this.rerenderTrigger(!this.rerenderTrigger())}));let t=0;this.coreViewer.addListener("nav",(e=>{var i,n,r,o;const{cfi:s,first:a,last:l,epage:h,epageCount:u,metadata:c,docTitle:d}=e;if(this.rerenderTrigger(!this.rerenderTrigger()),s&&(t&&window.clearTimeout(t),t=window.setTimeout((()=>{this.documentOptions.fragment(s),t=0}),300)),void 0!==h&&this.epage(h),void 0!==u&&this.epageCount(u),void 0!==a&&this.firstPage(a),void 0!==l&&this.lastPage(l),c||d){let e=document.title;const t=null===(n=null===(i=null==c?void 0:c["http://purl.org/dc/terms/title"])||void 0===i?void 0:i[0])||void 0===n?void 0:n.v;e=t?!d||d===t||this.firstPage()||/\.xhtml$/.test(d)?t:`${d} | ${t}`:d||"Vivliostyle Viewer",e!==document.title&&(document.title=e);const s=null===(o=null===(r=null==c?void 0:c["http://www.idpf.org/vocab/rendition/#layout"])||void 0===r?void 0:r[0])||void 0===o?void 0:o.v;s&&this.state.fixedLayout("pre-paginated"===s)}const p=this.tocVisible(),f=this.coreViewer.isTOCVisible();p&&!f||this.tocVisible(f)})),this.coreViewer.addListener("hyperlink",(e=>{e.internal?(window.history.pushState(null,null),this.navigateToInternalUrl(e.href),this.tocVisible()&&this.tocVisible(!1),document.getElementById("vivliostyle-viewer-viewport").focus()):window.location.href=e.href}))}setupViewerOptionSubscriptions(){a.computed((()=>{const e=this.viewerOptions.toObject();this.coreViewer.setOptions(e)})).extend({rateLimit:0})}loadDocument(e,t){this.privState.status.value(m.ReadyState.LOADING),t&&this.viewerOptions.copyFrom(t),this.documentOptions=e,e.srcUrls()?e.bookMode()?this.coreViewer.loadPublication(e.srcUrls()[0],e.toObject(),this.viewerOptions.toObject()):this.coreViewer.loadDocument(e.srcUrls(),e.toObject(),this.viewerOptions.toObject()):this.privState.status.value(void 0)}navigateToPrevious(){this.coreViewer.navigateToPage(m.Navigation.PREVIOUS)}navigateToNext(){this.coreViewer.navigateToPage(m.Navigation.NEXT)}navigateToLeft(){this.coreViewer.navigateToPage(m.Navigation.LEFT)}navigateToRight(){this.coreViewer.navigateToPage(m.Navigation.RIGHT)}navigateToFirst(){this.coreViewer.navigateToPage(m.Navigation.FIRST)}navigateToLast(){this.coreViewer.navigateToPage(m.Navigation.LAST)}navigateToEPage(e){this.coreViewer.navigateToPage(m.Navigation.EPAGE,e)}navigateToInternalUrl(e){this.coreViewer.navigateToInternalUrl(e)}navigateToPosition(e){this.coreViewer.navigateToPosition(e)}queryZoomFactor(e){return this.coreViewer.queryZoomFactor(e)}epageToPageNumber(e){if(!e&&0!=e)return;return Math.round(e+1)}epageFromPageNumber(e){if(!e&&0!=e)return;return e-1}showTOC(e,t){if(null==this.coreViewer.isTOCVisible())return;const i=null==e?!this.tocVisible():e;this.tocVisible(i),this.tocPinned(!!i&&!t),this.coreViewer.showTOC(i,t)}}const z={Unidentified:"Unidentified",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",Home:"Home",End:"End",PageDown:"PageDown",PageUp:"PageUp",Escape:"Escape",Enter:"Enter",Space:" "};var D={Keys:z,identifyKeyFromEvent:function(e){const t=e.key,i=e.keyIdentifier,n=e.location;return t===z.ArrowDown||"Down"===t||"Down"===i?e.metaKey?z.End:z.ArrowDown:t===z.ArrowLeft||"Left"===t||"Left"===i?z.ArrowLeft:t===z.ArrowRight||"Right"===t||"Right"===i?z.ArrowRight:t===z.ArrowUp||"Up"===t||"Up"===i?e.metaKey?z.Home:z.ArrowUp:t===z.Escape||"Esc"===t||"U+001B"===i?z.Escape:t===z.Enter||"Enter"===i?z.Enter:t===z.Space||"U+0020"===i?z.Space:"0"===t||"U+0030"===i?"0":"+"===t||"Add"===t||"U+002B"===i||"U+00BB"===i||"U+004B"===i&&n===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"+":"-"===t||"Subtract"===t||"U+002D"===i||"U+00BD"===i||"U+004D"===i&&n===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"-":t||i||z.Unidentified}};const V=e=>{const t=document.getElementById("vivliostyle-viewer-viewport").style,i=parseFloat(t.getPropertyValue("--viv-scaleRectRatio")||"1");return new DOMRect(e.x*i,e.y*i,e.width*i,e.height*i)},U=(e,t)=>{let i=e.x-t.x,n=e.y-t.y,r=e.width,o=e.height;const s=document.getElementById("vivliostyle-viewer-viewport").style,a=parseFloat(s.getPropertyValue("--viv-outputScale")||"1");return a&&!isNaN(a)&&(i/=a,n/=a,r/=a,o/=a),new DOMRect(i,n,r,o)},H=p.i18n.t.bind(p.i18n),$=e=>{switch(e){case"red":return"rgba(255,0, 0,0.2)";case"green":return"rgba(0,255,0,0.2)";case"yellow":return"rgba(255,217,0,0.3)";default:return""}},j=e=>{if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},W=e=>{let t;return t=1==e.nodeType?e:e.parentElement,!!t.closest("[data-adapt-eloff]")},G=(e,t)=>{const i=[];for(let n=e.node;n;n=j(n)){if(3==n.nodeType&&!n.parentElement.closest("rt,[data-adapt-spec]")&&W(n)){const r=n;if(r.data.trim().length>0){const o=n==e.node?e.offset:0,s=n==t.node?t.offset:r.data.length;s>o&&i.push({t:r,startOffset:o,endOffset:s})}}if(n==t.node)break}return i},q=e=>{const t=document.createRange();return t.setStart(e.t,e.startOffset),t.setEnd(e.t,e.endOffset),[...t.getClientRects()].map((e=>V(e)))},X=(e,t)=>!!t.querySelector(`[${ne.idAttr}="${e}"]`),Y=(e,t)=>{t.background&&(e.style.background=t.background)},K=(e,t,i,n)=>{const r=e.node.parentElement.closest("[data-vivliostyle-page-container='true']"),o=t.node.parentElement.closest("[data-vivliostyle-page-container='true']");if(n&&X(n.uniqueIdentifier,r)&&X(n.uniqueIdentifier,o))return"";const s=G(e,t),a=(null==n?void 0:n.uniqueIdentifier)||ne.notCreatedId,l=e=>{const t=e.clientX,i=e.clientY;pe.openEditMenu(t,i,a)};let h=0;const u=[];return s.forEach((e=>{u.push(e.t.data.slice(e.startOffset,e.endOffset));const t=e.t.parentElement.closest("[data-vivliostyle-page-container='true']"),n=V(t.getBoundingClientRect()),r=Z(t),o=J(t);for(const s of q(e)){const e=U(s,n),u=`${o}-${r}-${h++}`;if(document.querySelector(`[${ne.idAttr}='${a}'][data-mn='${u}']`))return;const c=document.createElement("div");c.style.position="absolute",c.style.margin="0",c.style.padding="0",c.style.top=`${e.top}px`,c.style.left=`${e.left}px`,c.style.width=`${e.width}px`,c.style.height=`${e.height}px`,Y(c,i),c.setAttribute(ne.idAttr,a),c.setAttribute("data-mn",`${u}`),c.addEventListener("click",l),t.appendChild(c)}})),u.join("")},Z=e=>{const t=parseInt(e.getAttribute("data-vivliostyle-page-index"));return isNaN(t)?-1:t},J=e=>{const t=parseInt(e.getAttribute("data-vivliostyle-spine-index"));return isNaN(t)?-1:t},Q=(e,t)=>{const i=e.parentElement.closest("[data-vivliostyle-page-container]"),n=J(i),r=e.parentElement.closest("[data-adapt-eloff]"),o=[];let s=e;for(;s&&s!==r;)o.unshift(s),s=s.parentElement;const a=parseInt(r.getAttribute("data-adapt-eloff"));let l=a+t;const h=te(n,a);let u=0,c=-1,d=0;for(const e of h.values()){if(e==r)break;const t=[...e.childNodes].filter((e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec"))));let i=t.length;if(i>0){l+=t.map((e=>e.textContent.length)).reduce(((e,t)=>e+t)),3==t[0].nodeType&&3==c&&(i-=1);const e=t[t.length-1];c=e.nodeType,3==c?d+=e.data.length:d=0}u+=i}const p=[...r.childNodes].filter((e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec")))),f=p.indexOf(o[0]);f>0&&(l+=p.map(((e,t)=>t<f?e.textContent.length:0)).reduce(((e,t)=>e+t)));const g=[];if(0==f&&3==o[0].nodeType&&3==c)t+=d,o.length>1&&console.warn("should not reach here; nodePath[0] is text and nodePath is deeper"),g.push(u-1);else{u+=f+1,3==c&&3==p[0].nodeType&&u--,g.push(u-1);let e=0;for(;e<o.length-1;){const t=[...o[e].childNodes].indexOf(o[e+1]);g.push(t),e++}}return new ie(n,a,g,t,l)},ee=e=>{const t=te(e.spineIndex,e.eloff);let i,n=0,r=-1,o=0;for(const s of t.values()){const t=[...s.childNodes].filter((e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec")))),a=t.length;if(a>0){3==t[0].nodeType&&3==r&&n--;const s=n+a;if(s>e.nodePath[0])if(n==e.nodePath[0]&&3==t[0].nodeType){const n=t[0];if(o<=e.offset&&e.offset<=o+n.data.length){i=n;break}}else{if(s!=e.nodePath[0]+1||3!=t[t.length-1].nodeType){let r=t[e.nodePath[0]-n];for(let t=1;t<e.nodePath.length;t++)r.childNodes&&r.childNodes.length>e.nodePath[t]&&(r=r.childNodes[e.nodePath[t]]);i=r,o=0;break}{const n=t[t.length-1];if(e.offset<=n.data.length){i=n,o=0;break}}}const l=t[t.length-1];r=l.nodeType,3==r?o+=l.data.length:o=0}n+=a}return i?{node:i,offset:e.offset-o}:null},te=(e,t)=>{const i=`[data-vivliostyle-spine-index='${e}'] [data-adapt-eloff='${t}']`;return Array.from(document.querySelectorAll(i)).filter((e=>!e.querySelector(i)))};class ie{constructor(e,t,i,n,r){this.spineIndex=e,this.eloff=t,this.nodePath=i,this.offset=n,this.offsetInItem=r}toString(){return`${this.spineIndex}-${this.eloff}-${this.nodePath.join("/")}-${this.offset}-${this.offsetInItem}`}static fromString(e){const[t,i,n,r,o]=e.split("-").map((e=>e.trim())),s=n.split("/").map((e=>parseInt(e)));return new ie(parseInt(t),parseInt(i),s,parseInt(r),parseInt(o))}}class ne{constructor(e,t,i,n,r){this.start=e,this.end=t,this.color=i,this.memo=n,this.markedText=r,this.uniqueIdentifier=ne.notCreatedId}markInfoString(){return`${this.start},${this.end},${this.color}`}toMarkJson(){return{mark:this.markInfoString(),id:this.uniqueIdentifier,memo:this.memo,markedText:this.markedText}}isPersisted(){return this.uniqueIdentifier&&this.uniqueIdentifier!=ne.notCreatedId}static fromMarkInfoString(e){const[t,i,n]=e.split(","),r=ie.fromString(t),o=ie.fromString(i);return new ne(r,o,n,"","")}static fromMarkJson(e){const t=ne.fromMarkInfoString(e.mark);return t.uniqueIdentifier=e.id,t.memo=e.memo,t.markedText=e.markedText,t}}ne.idAttr="data-viv-marker-id",ne.notCreatedId="not-created";const re=e=>{pe.openStartButton(e)};class oe{currentId(){return""}deletable(){return!1}cancellable(){return!1}applyEditing(){}colorChanged(){}deleteCurrentEditing(){}close(){}}class se{constructor(){this.start=(e,t)=>{this.currentStart=e,this.currentEnd=t;const i=ee(this.currentStart),n=ee(this.currentEnd);if(i&&n){const e=$(pe.currentEditingColor());return this.currentText=K(i,n,{background:e}),!0}return!1},this.deletable=()=>!1,this.cancellable=()=>!0,this.deleteCurrentEditing=async()=>{},this.currentId=()=>ne.notCreatedId,this.applyEditing=async()=>{if(this.currentStart&&this.currentEnd){const e=new ne(this.currentStart,this.currentEnd,pe.currentEditingColor(),pe.currentEditingMemo(),this.currentText);await de.persistMark(e)}pe.closeMenu()},this.colorChanged=async()=>{0==this.cancellable()&&this.applyEditing()},this.close=async()=>{document.querySelectorAll(`[${ne.idAttr}="${ne.notCreatedId}"]`).forEach((e=>{e.remove()}))}}}class ae{constructor(){this.deletable=()=>!0,this.cancellable=()=>!0,this.deleteCurrentEditing=async()=>{this.currentEditing&&await de.removeMark(this.currentEditing)},this.currentId=()=>{var e;return null===(e=this.currentEditing)||void 0===e?void 0:e.uniqueIdentifier},this.applyEditing=async()=>{this.currentEditing&&(pe.currentEditingColor()==this.currentEditing.color&&pe.currentEditingMemo()==this.currentEditing.memo||(this.currentEditing.color=pe.currentEditingColor(),this.currentEditing.memo=pe.currentEditingMemo(),de.updateMark(this.currentEditing))),pe.closeMenu()},this.colorChanged=async()=>{},this.close=async()=>{if(this.currentEditing){const e=$(this.currentEditing.color);e.length>0&&document.querySelectorAll(`[${ne.idAttr}="${this.currentEditing.uniqueIdentifier}"]`).forEach((t=>{t.style.background=e})),this.currentEditing=void 0}}}}class le{constructor(e){this.parent=e,this.editingColorChanged=async e=>{if(!de.enabled())return;const t=this.markAction().currentId(),i=$(e);i.length>0&&document.querySelectorAll(`[${ne.idAttr}="${t}"]`).forEach((e=>{e.style.background=i})),await this.markAction().colorChanged()},this.openMenu=(e,t)=>{if(this.menuOpened())return;const i=document.getElementById("vivliostyle-text-selection-edit-menu");i&&(i.style.top=`${t}px`,i.style.left=`${e}px`);const n=this.menuOpened.subscribe((t=>{if(t){const t=document.getElementById("vivliostyle-text-selection-edit-menu"),i=document.querySelector("[data-vivliostyle-outer-zoom-box]");if(t&&i){const n=t.getBoundingClientRect(),r=i.getBoundingClientRect();let o=e-n.width;o+n.width>r.right&&(o=r.right-n.width-10),o<r.left&&(o=r.left),t.style.left=`${o}px`,n.bottom>r.bottom&&(t.style.top=r.bottom-n.height-10+"px")}}n.dispose()}));this.startButtonOpened(!1),this.menuOpened(!0)},this.closeStartButton=()=>{de.enabled()&&this.startButtonOpened(!1)},this.openEditMenu=async(e,t,i)=>{if(!de.enabled())return;const n=await this.parent.getMark(i);this.currentEditingColor(n.color),this.currentEditingMemo(n.memo),this.editAction.currentEditing=n,this.markAction(this.editAction),this.openMenu(e,t)},this.closeMenu=async()=>{de.enabled()&&(await this.markAction().close(),this.markAction(this.emptyAction),this.menuOpened(!1))},this.applyEditing=async()=>{de.enabled()&&await this.markAction().applyEditing()},this.deleteCurrentEditing=async()=>{de.enabled()&&(confirm(H("CONFIRM_DELETE"))&&await this.markAction().deleteCurrentEditing(),await this.closeMenu())},this.openSelectionMenu=(e,t,i,n,r)=>{de.enabled()&&(this.currentEditingColor("yellow"),this.currentEditingMemo(""),this.newMarkAction.start(i,n)&&(r.empty(),this.markAction(this.newMarkAction),this.openMenu(e,t)))},this.openStartButton=async e=>{if(de.enabled()&&"Range"==e.type){const t=e.getRangeAt(0);if(!t.commonAncestorContainer.parentElement.closest("[data-vivliostyle-outer-zoom-box]"))return;const i=document.getElementById("vivliostyle-text-selection-start-button"),n={node:t.startContainer,offset:t.startOffset},r={node:t.endContainer,offset:t.endOffset},o=G(n,r);if(0==o.length)return;const s=o.reduce(((e,t)=>e.concat(q(t))),[]);if(0==s.length)return;const a=Q(o[0].t,o[0].startOffset),l=Q(o[o.length-1].t,o[o.length-1].endOffset),h=s[s.length-1].left,u=s[s.length-1].bottom,c=t=>{t.stopPropagation(),i&&i.removeEventListener("click",c),this.openSelectionMenu(h,u,a,l,e)};i&&(i.style.top=`${u}px`,i.style.left=`${h}px`,i.addEventListener("click",c));const d=this.startButtonOpened.subscribe((e=>{if(e){const e=document.querySelector("[data-vivliostyle-outer-zoom-box]");if(i&&e){const t=i.getBoundingClientRect(),n=e.getBoundingClientRect();let r=h-t.width;r+t.width>n.right&&(r=n.right-t.width-10),r<n.left&&(r=n.left),i.style.left=`${r}px`,t.bottom>n.bottom&&(i.style.top=n.bottom-t.height-10+"px")}}else i.removeEventListener("click",c),d.dispose()}));this.startButtonOpened(!0)}},this.menuOpened=a.observable(!1),this.startButtonOpened=a.observable(!1),this.currentEditingColor=a.observable(""),this.currentEditingMemo=a.observable(""),this.currentEditingColor.subscribe(this.editingColorChanged),this.editAction=new ae,this.newMarkAction=new se,this.emptyAction=new oe,this.markAction=a.observable(this.emptyAction),this.deletable=a.pureComputed((()=>this.markAction().deletable())).extend({notify:"always"}),this.cancellable=a.pureComputed((()=>this.markAction().cancellable())).extend({notify:"always"})}init(){const e=document.getElementById("vivliostyle-text-selection-edit-menu");let t=0,i=0;const n=n=>{const r=n.clientX-t,o=n.clientY-i;t=n.clientX,i=n.clientY,e.style.top=`${e.offsetTop+o}px`,e.style.left=`${e.offsetLeft+r}px`};e.addEventListener("mousedown",(e=>{"vivliostyle-memo-edit-area"!==e.target.id&&(t=e.clientX,i=e.clientY,document.addEventListener("mousemove",n),document.addEventListener("mouseup",(()=>{document.removeEventListener("mousemove",n)})))}))}}let he=0;class ue{constructor(){this.markArray=[],this.documentId="",this.markKeyToArrayIndex=new Map}async init(e){C.getParameter("mark").forEach((e=>{const t=this.urlStringToMark(e);this.pushMarkInternal(t,"doNotAddToUrl","persist")})),this.documentId=e}async persistMark(e){return this.pushMarkInternal(e,"addToUrl","persist")}async updateMark(e){await this.removeMark(e),this.pushMarkInternal(e,"addToUrl","doNotPersist")}async getMark(e){const t=this.markKeyToArrayIndex.get(e);return this.markArray[t]}async removeMark(e){const t=this.markKeyToArrayIndex.get(e.id);this.markArray.splice(t,1),this.markRemoved()}async allMarks(){return this.markArray}async allMarksIterator(){const e=this.markArray;return async function*(){let t=0;for(;t<e.length;){const i=e[t++];yield i}}()}markToURLString(e){const t=e.memo?encodeURIComponent(e.memo):"",i=e.markedText?encodeURIComponent(e.markedText):"";return`${e.mark}%1F${t}%1F${i}`}urlStringToMark(e){const[t,i,n]=e.split("%1F",3);return{mark:t,id:"",memo:i?decodeURIComponent(i):"",markedText:n?decodeURIComponent(n):""}}pushMarkInternal(e,t,i){if("persist"==i&&(e.id=""+he++),this.markArray.push(e),this.markKeyToArrayIndex.set(e.id,this.markArray.length-1),"addToUrl"==t){const t=C.getParameter("mark").length;C.setParameter("mark",this.markToURLString(e),t)}return e.id}async markRemoved(){this.markKeyToArrayIndex.clear(),C.removeParameter("mark"),this.markArray.forEach(((e,t)=>{C.setParameter("mark",this.markToURLString(e),t),this.markKeyToArrayIndex.set(e.id,t)}))}}class ce{constructor(e){this.parent=e,this.removeAllMarks=async()=>{if(confirm(H("CONFIRM_REMOVE_ALL"))){const e=this.list.removeAll();for(const t of e)await this.parent.removeMark(t)}},this.removeOneMark=async e=>{confirm(H("CONFIRM_REMOVE"))&&await this.parent.removeMark(e)},this.updateActualMark=async e=>{this.parent.actualStore.updateMark(e.toMarkJson())},this.navigateToMark=e=>{const{spineIndex:t,offsetInItem:i}=e.start;window.history.pushState(null,null),this.parent.viewer.navigateToPosition({spineIndex:t,offsetInItem:i}),this.pinned()||(this.detailsElement.open=!1)},this.hasMarks=()=>this.list().length>0&&this.parent.enabled(),this.pinned=a.observable(!1),this.list=a.observableArray()}init(){this.detailsElement=document.getElementById("vivliostyle-marks-box")}addMarkToList(e){let t=-1;const i=this.list();for(let n=0;n<i.length;n++){const r=i[n];if(r.uniqueIdentifier===e.uniqueIdentifier)return void this.list.replace(r,e);if(r.start.spineIndex===e.start.spineIndex){if(r.start.offsetInItem>e.start.offsetInItem){t=n;break}}else if(r.start.spineIndex>e.start.spineIndex){t=n;break}}-1===t&&(t=i.length),this.list.splice(t,0,e)}removeMarkFromList(e){this.list.remove((t=>t.uniqueIdentifier===e.uniqueIdentifier))}}const de=new class{constructor(){this.menuStatus=new le(this),this.marksBox=new ce(this),this.initialized=!1,this.justClicked=!1}enabled(){return this.initialized&&this.viewerOptions.enableMarker()}async init(e,t){if(e&&(this.viewerOptions=e),t&&(this.viewer=t),!this.viewerOptions||!this.viewerOptions.enableMarker())return;this.menuStatus.init(),this.marksBox.init(),window.marksStorePlugin?this.actualStore=window.marksStorePlugin:this.actualStore=new ue;const i=C.getParameter("src").join();await this.actualStore.init(i),this.initialized=!0}async toggleEnableMarker(){this.enabled()?this.justClicked?(this.justClicked=!1,this.marksBox.pinned(!0),this.marksBox.detailsElement.open=!0):(document.querySelectorAll(`[${ne.idAttr}]`).forEach((e=>{e.remove()})),this.menuStatus.startButtonOpened()&&this.menuStatus.closeStartButton(),this.menuStatus.menuOpened()&&this.menuStatus.closeMenu(),this.viewerOptions.enableMarker(!1),this.justClicked=!0,window.setTimeout((()=>{this.justClicked=!1}),300)):(this.viewerOptions.enableMarker(!0),this.justClicked?(this.justClicked=!1,this.marksBox.pinned(!0),this.marksBox.detailsElement.open=!0):(this.marksBox.pinned(!1),this.justClicked=!0,window.setTimeout((()=>{this.marksBox.detailsElement.firstElementChild.focus(),this.justClicked=!1}),300)),this.initialized||await this.init(),await this.retryHighlightMarks())}async persistMark(e){if(!this.initialized)return;const t=await this.actualStore.persistMark(e.toMarkJson());e.uniqueIdentifier=t,this.highlightMark(e)}async updateMark(e){this.initialized&&(this.unhighlightMark(e),this.highlightMark(e),this.actualStore.updateMark(e.toMarkJson()))}async getMark(e){if(this.initialized)return ne.fromMarkJson(await this.actualStore.getMark(e))}async removeMark(e){this.initialized&&(this.unhighlightMark(e),await this.actualStore.removeMark(e.toMarkJson()))}async retryHighlightMarks(){if(this.enabled())if(this.actualStore.allMarksIterator){const e=await this.actualStore.allMarksIterator();for await(const t of e)t&&this.highlightMark(ne.fromMarkJson(t))}else for await(const e of await this.actualStore.allMarks())e&&this.highlightMark(ne.fromMarkJson(e))}unhighlightMark(e){document.querySelectorAll(`[${ne.idAttr}="${e.uniqueIdentifier}"]`).forEach((e=>{e.remove()})),this.marksBox.removeMarkFromList(e)}highlightMark(e,t=!1){if(!e.isPersisted&&!t)throw"mark is not persisted.";const i=ee(e.start);let n=ee(e.end);if(!i||n||this.viewerOptions.renderAllPages()||(console.log(),n=((e,t)=>{let i=e.node;for(let n=e.node;n;n=j(n)){if(1==n.nodeType){const e=n;if(e.hasAttribute("data-vivliostyle-outer-zoom-box"))break;if(e.hasAttribute("data-vivliostyle-page-container")&&J(e)>t.spineIndex)break}3==n.nodeType&&W(n)&&(i=n)}return{node:i,offset:i.data.length}})(i,e.end)),i&&n){const t=$(e.color);K(i,n,{background:t},e)}this.marksBox.addMarkToList(e)}},pe=de.menuStatus,{Keys:fe}=D;class ge{constructor(e,t,i,n){this.viewerOptions=e,this.viewer=t,this.settingsPanel=i,this.navigateToPrevious=()=>!this.isNavigateToPreviousDisabled()&&(this.viewer.navigateToPrevious(),!0),this.navigateToNext=()=>!this.isNavigateToNextDisabled()&&(this.viewer.navigateToNext(),!0),this.navigateToLeft=()=>!this.isNavigateToLeftDisabled()&&(this.viewer.navigateToLeft(),!0),this.navigateToRight=()=>!this.isNavigateToRightDisabled()&&(this.viewer.navigateToRight(),!0),this.navigateToFirst=()=>!this.isNavigateToFirstDisabled()&&(window.history.pushState(null,null),this.viewer.navigateToFirst(),!0),this.navigateToLast=()=>!this.isNavigateToLastDisabled()&&(window.history.pushState(null,null),this.viewer.navigateToLast(),!0),this.zoomIn=()=>{if(this.isZoomInDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomIn(this.viewer)),!0}},this.zoomOut=()=>{if(this.isZoomOutDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomOut(this.viewer)),!0}},this.zoomToActualSize=()=>{if(this.isZoomToActualSizeDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomToActualSize()),!0}},this.toggleFitToScreen=()=>{if(this.isToggleFitToScreenDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.toggleFitToScreen()),!0}},this.increaseFontSize=()=>{if(this.isIncreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions.fontSize());return e=e<10?Math.floor(e)+1:e<20?2*(Math.floor(e/2)+1):e<40?4*(Math.floor(e/4)+1):e<72?8*(Math.floor(e/8)+1):72,this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.decreaseFontSize=()=>{if(this.isDecreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions.fontSize());return e=e>40?8*(Math.ceil(e/8)-1):e>20?4*(Math.ceil(e/4)-1):e>10?2*(Math.ceil(e/2)-1):e>5?Math.ceil(e)-1:5,this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.defaultFontSize=()=>{if(this.isDefaultFontSizeDisabled())return!1;{const e=A.getDefaultValues().fontSize;return this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.onfocusPageNumber=(e,t)=>{const i=t.currentTarget;return window.setTimeout((()=>{i.setSelectionRange(0,i.value.length)}),0),!0},this.onmouseupPageSlider=(e,t)=>{if(this.viewerOptions.renderAllPages())return!0;const i=document.getElementById("vivliostyle-page-number"),n=Number(i.value),r=this.viewer.epageFromPageNumber(n);return this.viewer.navigateToEPage(r),!0},this.onwheelPageSlider=(e,t)=>(t.preventDefault(),this.justPageMovedByWheel||0===t.deltaMode&&Math.abs(t.deltaX)<4&&Math.abs(t.deltaY)<4||(Math.abs(t.deltaX)>=Math.abs(t.deltaY)?t.deltaX<0?this.navigateToLeft():this.navigateToRight():t.deltaY<0?this.navigateToPrevious():this.navigateToNext(),"vivliostyle-page-slider"!==t.currentTarget.id&&(this.justPageMovedByWheel=!0,window.setTimeout((()=>{this.justPageMovedByWheel=!1}),166))),!0),this.onwheelViewport=(e,t)=>{const i=document.getElementById("vivliostyle-viewer-viewport");return!!(this.viewer.tocVisible()&&i!=document.activeElement||i.scrollWidth>i.clientWidth||i.scrollHeight>i.clientHeight)||this.onwheelPageSlider(e,t)},this.onclickViewport=(e,t)=>{if(this.pageNumber(),this.settingsPanel.justClicked)return!0;if(this.viewer.tocVisible()&&!this.viewer.tocPinned()){const e=document.querySelector("[data-vivliostyle-toc-box]");e&&!e.contains(document.activeElement)&&this.toggleTOC()}return this.settingsPanel.opened()&&!this.settingsPanel.pinned()&&this.settingsPanel.close(),de.enabled()&&de.marksBox.detailsElement.open&&!de.marksBox.pinned()&&(de.marksBox.detailsElement.open=!1),!0},this.toggleTOC=()=>{if(this.isTOCToggleDisabled())return!1;{let e=0;return this.viewer.tocVisible()?this.justClicked?(this.viewer.showTOC(!0,!1),this.justClicked=!1):(e&&(window.clearInterval(e),e=0),this.viewer.showTOC(!1),this.justClicked=!0,window.setTimeout((()=>{this.justClicked&&(document.getElementById("vivliostyle-viewer-viewport").focus(),this.justClicked=!1)}),300)):(this.justClicked?(this.viewer.showTOC(!0,!1),this.justClicked=!1):(this.viewer.showTOC(!0,!0),this.justClicked=!0),e=window.setInterval((()=>{const t=document.querySelector("[data-vivliostyle-toc-box]");t&&"visible"===t.style.visibility&&(t.tabIndex=0,t.focus(),window.clearInterval(e),e=0),this.justClicked=!1}),300)),!0}},this.navigateTOC=e=>{const t=Array.from(document.querySelectorAll("[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) [tabindex='0'],[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) a[href]:not([tabindex='-1'])"));let i=t.indexOf(document.activeElement);const n=e=>t[e]&&"button"===t[e].getAttribute("role"),r=e=>t[e]&&"true"===t[e].getAttribute("aria-expanded");switch(e){case fe.ArrowLeft:if(-1==i){i=t.length-1;break}if(!n(i)&&n(i-1)&&i--,n(i)&&r(i))t[i].click();else for(let e=i-1;e>=0;e--)if(n(e)&&t[e].parentElement.contains(t[i])){i=e;break}break;case fe.ArrowRight:if(-1==i){i=0;break}!n(i)&&n(i-1)&&i--,n(i)&&(r(i)?i+=2:t[i].click());break;case fe.ArrowDown:i++;break;case fe.ArrowUp:if(-1==i){i=t.length-1;break}i>0&&n(--i)&&i--;break;case fe.Home:i=0;break;case fe.End:i=t.length-1;break;case fe.Space:!n(i)&&n(i-1)&&i--,n(i)&&t[i].click()}return n(i)&&i++,t[i]&&t[i].focus(),!0},this.toggleMarker=()=>!this.isMarkerToggleDisabled()&&(de.toggleEnableMarker(),!0),this.handleKey=e=>{if(this.settingsPanel.opened()&&this.settingsPanel.settingsToggle.contains(document.activeElement))return!0;const t=document.getElementById("vivliostyle-page-number"),i=document.getElementById("vivliostyle-viewer-viewport"),n=i.scrollWidth>i.clientWidth,r=i.scrollHeight>i.clientHeight,o=t===document.activeElement,s=this.viewer.tocVisible()&&!o&&i!=document.activeElement;if(!s&&i!=document.activeElement&&i.contains(document.activeElement))return!0;switch(e){case"+":return o||!this.increaseFontSize();case"-":return o||!this.decreaseFontSize();case"0":return o||!this.defaultFontSize();case"1":return o||!this.zoomToActualSize();case fe.ArrowLeft:return s?!this.navigateTOC(e):o||n||!this.navigateToLeft();case fe.ArrowRight:return s?!this.navigateTOC(e):o||n||!this.navigateToRight();case fe.ArrowDown:return s?!this.navigateTOC(e):(i.focus(),r||!this.navigateToNext());case fe.ArrowUp:return s?!this.navigateTOC(e):(i.focus(),r||!this.navigateToPrevious());case fe.PageDown:return!!s||(i.focus(),!this.navigateToNext());case fe.PageUp:return!!s||(i.focus(),!this.navigateToPrevious());case fe.Home:return s?!this.navigateTOC(e):(i.focus(),!this.navigateToFirst());case fe.End:return s?!this.navigateTOC(e):(i.focus(),!this.navigateToLast());case"o":case"O":return i.focus(),!this.zoomOut();case"i":case"I":return i.focus(),!this.zoomIn();case"p":case"P":return i.focus(),!this.print();case"f":case"F":return i.focus(),!this.toggleFitToScreen();case"g":case"G":return t.focus(),!1;case"t":case"T":return i.focus(),!this.toggleTOC();case"m":case"M":return i.focus(),!this.toggleMarker();case fe.Escape:if(de.enabled()){if(de.menuStatus.startButtonOpened())return de.menuStatus.closeStartButton(),!1;if(de.menuStatus.menuOpened())return"vivliostyle-memo-edit-area"===document.activeElement.id||(de.menuStatus.closeMenu(),!1);if(de.marksBox.detailsElement.open)return de.marksBox.detailsElement.open=!1,!1}return this.viewer.tocVisible()?!this.toggleTOC():(i.focus(),!0);case fe.Space:return s?!this.navigateTOC(e):"button"!==document.activeElement.getAttribute("role")||(document.activeElement.click(),!1);default:return!0}},this.print=()=>!this.isPrintDisabled()&&(window.print(),!0),this.justClicked=!1,this.justPageMovedByWheel=!1,this.isDisabled=a.pureComputed((()=>this.settingsPanel.opened()&&!this.settingsPanel.pinned()||!this.viewer.state.navigatable()));const r=a.pureComputed((()=>n.disablePageNavigation||this.isDisabled()));r.subscribe((e=>{const t=document.getElementById("vivliostyle-page-number");t&&(t.disabled=e)})),this.isPageNumberDisabled=a.pureComputed((()=>r())),this.isPageSliderDisabled=a.pureComputed((()=>!(!n.disablePageSlider&&!r())||Number(this.totalPages())<=1)),this.isNavigateToPreviousDisabled=a.pureComputed((()=>!!r()||void 0!==this.viewer.state.status&&this.viewer.firstPage())),this.isNavigateToNextDisabled=a.pureComputed((()=>!!r()||void 0!==this.viewer.state.status&&((!this.viewerOptions.renderAllPages()||this.viewer.state.status()==m.ReadyState.COMPLETE)&&this.viewer.lastPage()))),this.isNavigateToLeftDisabled=a.pureComputed((()=>!!r()||void 0!==this.viewer.state.pageProgression&&(this.viewer.state.pageProgression()===m.PageProgression.LTR?this.isNavigateToPreviousDisabled():this.isNavigateToNextDisabled()))),this.isNavigateToRightDisabled=a.pureComputed((()=>!!r()||void 0!==this.viewer.state.pageProgression&&(this.viewer.state.pageProgression()===m.PageProgression.LTR?this.isNavigateToNextDisabled():this.isNavigateToPreviousDisabled()))),this.isNavigateToFirstDisabled=this.isNavigateToPreviousDisabled,this.isNavigateToLastDisabled=a.pureComputed((()=>!!r()||void 0!==this.viewer.state.status&&(!(!this.viewerOptions.renderAllPages()||this.viewer.state.status()==m.ReadyState.COMPLETE)||this.viewer.lastPage()))),this.hidePageNavigation=!!n.disablePageNavigation;const o=a.pureComputed((()=>n.disableZoom||this.isDisabled()));this.isZoomOutDisabled=o,this.isZoomInDisabled=o,this.isZoomToActualSizeDisabled=o,this.isToggleFitToScreenDisabled=o,this.hideZoom=!!n.disableZoom,this.fitToScreen=a.pureComputed((()=>e.zoom().fitToScreen));const s=a.pureComputed((()=>n.disableFontSizeChange||this.isDisabled()||this.viewer.state.fixedLayout()));if(this.isIncreaseFontSizeDisabled=a.pureComputed((()=>!!s()||Number(this.viewerOptions.fontSize())>=72)),this.isDecreaseFontSizeDisabled=a.pureComputed((()=>!!s()||Number(this.viewerOptions.fontSize())<=5)),this.isDefaultFontSizeDisabled=s,this.hideFontSizeChange=!!n.disableFontSizeChange,this.isTOCToggleDisabled=a.pureComputed((()=>n.disableTOCNavigation||this.isDisabled()||null==this.viewer.tocVisible())),this.hideTOCNavigation=!!n.disableTOCNavigation,this.hidePageSlider=!!n.disablePageSlider,this.isFindBoxDisabled=a.pureComputed((()=>n.disableFind||this.isDisabled()||this.viewer.state.fixedLayout())),this.hideFind=!!n.disableFind,this.isMarkerToggleDisabled=a.pureComputed((()=>n.disableMarker||this.isDisabled())),this.hideMarker=!!n.disableMarker,this.isPrintDisabled=a.pureComputed((()=>!(!n.disablePrint&&!this.isDisabled()&&this.viewer.state.status()==m.ReadyState.COMPLETE))),this.hidePrint=!!n.disablePrint,n.disablePrint){const e=document.createElement("style");e.setAttribute("media","print"),e.textContent="*{display:none}",document.head.appendChild(e)}this.pageNumber=a.pureComputed({read(){return this.viewer.epageToPageNumber(this.viewer.epage())},write(e){const t=this.viewer.epage(),i=this.viewer.epageToPageNumber(t);let n=parseFloat(e.toString().replace(/[-]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))))||0;if(/^[-+]/.test(e.toString())&&(n=i+n),n<1)n=1;else{const e=this.viewer.epageCount();this.viewerOptions.renderAllPages()?n>e&&(n=e):n>e+1&&(n=e+1)}const r=this.viewer.epageFromPageNumber(n),o=document.getElementById("vivliostyle-page-number");o.value=n.toString(),window.history.pushState(null,null),this.viewer.navigateToEPage(r),window.setTimeout((()=>{this.viewer.state.status()!=m.ReadyState.LOADING&&this.viewer.epage()===t&&(o.value=i.toString()),document.getElementById("vivliostyle-viewer-viewport").focus()}),10)},owner:this}),this.totalPages=a.pureComputed((()=>{let e=this.viewer.epageCount();if(!e)return e;const t=Number(this.pageNumber());return this.viewer.lastPage()||t>e?e=t:t==e&&e++,e})),this.pageSlider=a.pureComputed({read(){const e=Number(this.pageNumber()),t=document.getElementById("vivliostyle-page-slider");return Number(t.max)<e&&(t.max=String(e)),e},write(e){if(this.viewerOptions.renderAllPages()){const t=Number(e),i=this.viewer.epageFromPageNumber(t);this.viewer.navigateToEPage(i)}else{document.getElementById("vivliostyle-page-number").value=String(e)}},owner:this}),this.pageSliderMax=this.totalPages}updateFontSizeSettings(){this.settingsPanel.state.viewerOptions.fontSize(this.viewerOptions.fontSize()),this.viewer.documentOptions.pageStyle.baseFontSizeSpecified()&&(this.viewer.documentOptions.updateCustomStyleSheetFromCSSText(),this.viewer.loadDocument(this.viewer.documentOptions,this.viewerOptions))}}const{Keys:me}=D;class be{constructor(e,t,i,n,r){this.viewerOptions=e,this.documentOptions=t,this.viewer=i,this.close=()=>{this.opened(!1),this.pinned(!1);const e=document.getElementById("vivliostyle-viewer-viewport");e&&e.focus()},this.toggle=()=>{this.opened()?this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.close(),this.justClicked=!0,window.setTimeout((()=>{this.justClicked=!1}),300)):(this.viewer.tocPinned()||this.viewer.showTOC(!1),this.opened(!0),this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.pinned(!1),this.justClicked=!0,this.focusToFirstItem(),window.setTimeout((()=>{this.justClicked=!1}),300)))},this.apply=()=>{const e=this.documentOptions.pageStyle.customStyleAsUserStyle()!==this.state.pageStyle.customStyleAsUserStyle();this.documentOptions.pageStyle.copyFrom(this.state.pageStyle),e&&this.documentOptions.switchCustomStyleUserOrAuthorStyleSheets(),this.documentOptions.pageStyle.baseFontSizeSpecified()&&this.documentOptions.updateCustomStyleSheetFromCSSText(),this.viewer.loadDocument(this.documentOptions,this.state.viewerOptions),this.pinned()?this.focusToFirstItem():this.close()},this.cancel=()=>{this.state.viewerOptions.copyFrom(this.viewerOptions),this.state.pageStyle.copyFrom(this.documentOptions.pageStyle),this.close()},this.uiLanguage=a.pureComputed({read:()=>f.i18n.language,write:e=>{f.setLanguage(e),C.hasParameter("lng")&&C.setParameter("lng",e);try{window.localStorage.setItem("i18nextLng",e)}catch(e){}}}),this.isPageStyleChangeDisabled=!!r.disablePageStyleChange,this.isPageViewModeChangeDisabled=!!r.disablePageViewModeChange,this.isBookModeChangeDisabled=!!r.disableBookModeChange,this.isRenderAllPagesChangeDisabled=!!r.disableRenderAllPagesChange,this.isRestoreViewChangeDisabled=!!r.disableRestoreViewChange,this.isUILanguageChangeDisabled=!!r.disableUILanguageChange,this.justClicked=!1,this.settingsToggle=document.getElementById("vivliostyle-menu-item_settings-toggle"),this.opened=a.observable(!1),this.pinned=a.observable(!1),this.state={viewerOptions:new A(e),pageStyle:new y(t.pageStyle),pageViewMode:a.pureComputed({read:()=>this.state.viewerOptions.pageViewMode().toString(),write:e=>{this.state.viewerOptions.pageViewMode(P.of(e))}}),bookMode:a.observable(t.bookMode()),renderAllPages:a.pureComputed({read:()=>this.state.viewerOptions.renderAllPages(),write:e=>{this.state.viewerOptions.renderAllPages(e)}}),restoreView:a.observable(C.isEnabledRestoreView())},this.state.pageStyle.setViewerFontSizeObservable(this.state.viewerOptions.fontSize),this.defaultPageStyle=new y,this.defaultPageStyle.setViewerFontSizeObservable(a.observable(16)),n.visible.subscribe((e=>{e&&this.close()})),this.state.bookMode.subscribe((e=>{t.bookMode(e)})),this.state.renderAllPages.subscribe((t=>{e.renderAllPages(t)})),this.state.restoreView.subscribe((e=>{C.enableRestoreView(e),e?C.setParameter("restoreView","true"):C.removeParameter("restoreView")})),this.resetCustomStyle=a.pureComputed({read(){if(!this.state.pageStyle.equivalentTo(this.defaultPageStyle))return!1;return document.getElementsByName("vivliostyle-settings_reset-custom-style")[0].checked},write(e){e&&(this.state.pageStyle.copyFrom(this.defaultPageStyle),this.state.viewerOptions.fontSize(A.getDefaultValues().fontSize))},owner:this})}focusToFirstItem(e){const t=e||this.settingsToggle,i=["input","textarea","summary","select"].includes(t.localName)?t:Array.from(t.getElementsByTagName("input")).find((e=>!e.disabled&&("radio"!=e.type||e.checked)));if(i){for(let e=i.parentElement;e&&e!=this.settingsToggle;e=e.parentElement)"details"==e.localName&&(e.open=!0);i.focus()}}handleKey(e){const t=this.opened()&&this.settingsToggle.contains(document.activeElement),i=t&&("text"==document.activeElement.type||"select"==document.activeElement.localName),n=t&&"textarea"==document.activeElement.localName,r=t&&!i&&!n;switch(e){case me.Escape:return this.opened()&&(this.cancel(),this.close()),!0;case"s":case"S":return!(!this.opened()||r||!t)||(this.toggle(),!1);case"l":case"L":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_ui-language")[0]),!1);case"p":case"P":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-and-rendering").firstElementChild),!1);case"v":case"V":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-mode")),!1);case"b":case"B":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_book-mode")[0]),!1);case"a":case"A":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_render-all-pages")[0]),!1);case"c":case"C":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_custom-style").firstElementChild),!1);case"m":case"M":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_custom-style_more").firstElementChild),!1);case"z":case"Z":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-size")),!1);case"o":case"O":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_crop-marks")),!1);case"g":case"G":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-margin")),!1);case"k":case"K":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-breaks")),!1);case"i":case"I":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_images")),!1);case"t":case"T":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_text")),!1);case"y":case"Y":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_priority")),!1);case"e":case"E":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_edit-css")[0]),!1);case"r":case"R":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_reset-custom-style")[0]),!1);case me.Enter:return!(i||r&&"vivliostyle-menu-button_apply"!==document.activeElement.id&&"vivliostyle-menu-button_cancel"!==document.activeElement.id)||(document.getElementById("vivliostyle-menu-button_apply").focus(),!1);default:return!0}}}const{Keys:ve}=D;var we;!function(e){e.Default="",e.Searching="Searching",e.Found="Found",e.NotFound="Not Found"}(we||(we={}));class ye{constructor(e,t){this.viewer=e,this.navigation=t,this.cancel=!1,this.intervalID=0,this.foundRange=null,this.toggle=()=>this.opened()?this.close():this.open(),this.open=()=>!this.navigation.isFindBoxDisabled()&&(this.opened(!0),window.setTimeout((()=>{document.getElementById("vivliostyle-find-box").focus()}),0),!0),this.close=()=>!this.navigation.isFindBoxDisabled()&&(this.opened(!1),this.status()===we.Searching&&(this.cancel=!0),this.status(we.Default),this.foundRange=null,this.fixHighlight(),!0),this.findPrevious=()=>this.findSub(!0),this.findNext=()=>this.findSub(!1),this.opened=a.observable(),this.text=a.observable(""),this.status=a.observable(we.Default),this.text.subscribe((e=>{""!=e?C.setParameter("find",x.percentEncodeAmpersandAndUnencodedPercent(e)):C.removeParameter("find")}))}findSub(e){if(this.navigation.isFindBoxDisabled()||this.status()===we.Searching)return!1;if(this.intervalID)return window.clearInterval(this.intervalID),this.intervalID=0,!0;const t=this.text();if(!t)return!1;const i=this.viewer.epage();let n=-1,r=!1;return this.status(we.Searching),this.intervalID=window.setInterval((()=>{if(this.cancel)return this.cancel=!1,this.status(we.Default),window.clearInterval(this.intervalID),void(this.intervalID=0);if(n===this.viewer.epage())return;n=this.viewer.epage(),(r||n!==i)&&window.getSelection().empty();if(this.findText(t,e))return this.status(we.Found),window.clearInterval(this.intervalID),void(this.intervalID=0);!r&&(e?this.viewer.firstPage():this.viewer.lastPage())?(r=!0,this.viewer.firstPage()&&this.viewer.lastPage()?n=-1:e?this.viewer.navigateToLast():this.viewer.navigateToFirst()):!r||(e?n>i:n<i)?e?this.viewer.navigateToPrevious():this.viewer.navigateToNext():(this.status(we.NotFound),window.clearInterval(this.intervalID),this.intervalID=0,n!==i&&this.viewer.navigateToEPage(i))}),4),!0}findText(e,t){var i,n;const r=window.getSelection();"Range"!==r.type&&r.empty();const o=window,s=document.getElementById("vivliostyle-menu-find-box");s.style.visibility="hidden",this.foundRange&&0===r.rangeCount&&(r.addRange(this.foundRange),this.foundRange=null,this.fixHighlight());const a=o.find(e,!1,t);return s.style.visibility="",!!a&&((null===(n=null===(i=r.anchorNode)||void 0===i?void 0:i.parentElement)||void 0===n?void 0:n.closest("[data-adapt-eloff]"))?(this.foundRange=r.getRangeAt(0),this.fixHighlight(),!0):this.findText(e,t))}fixHighlight(){if(!/iPad|iPhone|iPod/.test(navigator.userAgent))return;const e=document.querySelectorAll("[data-viv-found-highlight='true']");for(const t of e)t.remove();if(!this.foundRange)return;const t=this.foundRange.startContainer.parentElement.closest("[data-vivliostyle-page-container='true']"),i=V(t.getBoundingClientRect());for(const e of this.foundRange.getClientRects()){const n=U(V(e),i),r=document.createElement("div");r.setAttribute("data-viv-found-highlight","true"),r.style.position="absolute",r.style.left=`${n.left}px`,r.style.top=`${n.top}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,r.style.backgroundColor="#0080ff33",t.appendChild(r)}}handleKey(e,t,i){const n=t.ctrlKey||t.metaKey;switch(e){case ve.Escape:if(n||!this.opened())return!0;if(this.status()===we.Searching)return this.cancel=!0,!1;if(i&&""!==this.text())return this.text(""),this.status(we.Default),!1;if(this.close())return!1;break;case"Enter":if(n||!this.opened())return!0;if(i&&document.getElementById("vivliostyle-find-box").blur(),t.shiftKey?this.findPrevious():this.findNext())return!1;break;case"f":case"F":if(!n)return!0;if(this.open())return!1;break;default:this.status(we.Default)}return!0}}class xe{constructor(e){this.list=e,this.visible=a.pureComputed((()=>e().length>0))}getDisplayMessage(e){var t,i;return null!==(i=null===(t=e.error)||void 0===t?void 0:t.toString())&&void 0!==i?i:e.messages.join("\n")}}const{Keys:Se}=D;class Ce{constructor(){var e,t;this.t=f.t,this.i18n=f.i18n;const i=[].concat(null!==(e=document.documentElement.getAttribute("data-vivliostyle-viewer-flags"))&&void 0!==e?e:[],C.getParameter("flags")).join(),n=i.includes("S"),r={disablePageStyleChange:n||i.includes("P"),disablePageViewModeChange:n||i.includes("V"),disableBookModeChange:n||i.includes("B"),disableRenderAllPagesChange:n||i.includes("A"),disableRestoreViewChange:n||i.includes("R"),disableUILanguageChange:n||i.includes("L")},o={disableTOCNavigation:i.includes("T"),disableFind:i.includes("f"),disableMarker:i.includes("m"),disablePageNavigation:i.includes("N"),disableZoom:i.includes("Z"),disableFontSizeChange:i.includes("F"),disablePageSlider:i.includes("s"),disablePrint:i.includes("p")},s=i.includes("c"),a=!i.includes("k"),l=!i.includes("a"),h=i.includes("d");if(n){const e=document.getElementById("vivliostyle-welcome");e&&e.remove();const t=document.querySelector(".vivliostyle-menu-detail"),i=document.querySelector(".vivliostyle-menu-detail-main");t&&i&&(i.style.visibility="hidden",t.style.height="auto")}s&&(document.oncontextmenu=()=>!1),this.documentOptions=new k(a),this.viewerOptions=new A(l),h&&this.viewerOptions.allowScripts(!1),this.documentOptions.pageStyle.setViewerFontSizeObservable(this.viewerOptions.fontSize),this.viewerOptions.profile()&&b.profiler.enable(),this.isDebug="true"===C.getParameter("debug")[0],this.viewerSettings={userAgentRootURL:`${C.getBaseURL()}resources/`,viewportElement:document.getElementById("vivliostyle-viewer-viewport"),debug:this.isDebug};const u=C.getParameter("src"),c=C.getParameter("b"),d=C.getParameter("x");u.length||(c.length?(C.setParameter("src",c[0]),C.hasParameter("bookMode")||C.setParameter("bookMode","true"),C.hasParameter("renderAllPages")||C.setParameter("renderAllPages","false")):d.length&&(d.forEach(((e,t)=>{C.setParameter("src",e,t)})),C.hasParameter("bookMode")||C.setParameter("bookMode","false")));let p=C.getParameter("restoreView")[0];"false"!==p&&(C.hasParameter("f")||C.restoreViewSettings()&&(p=C.getParameter("restoreView")[0]),"true"===p&&C.enableRestoreView(!0)),C.removeParameter("b"),C.removeParameter("x"),C.removeParameter("f",!0),C.removeParameter("spread",!0),C.removeParameter("bookMode",!0),C.removeParameter("allowScripts",!0),C.removeParameter("renderAllPages",!0),C.removeParameter("fontSize",!0),C.removeParameter("zoom",!0),C.removeParameter("find",!0),C.removeParameter("profile",!0),C.removeParameter("debug",!0),C.removeParameter("pixelRatio",!0),C.removeParameter("restoreView",!0),C.removeParameter("lng",!0),this.viewer=new M(this.viewerSettings,this.viewerOptions),this.viewer.inputUrl.subscribe((e=>{""!=e?(C.hasParameter("src")||C.history.pushState&&C.history.pushState(null,""),e=e.startsWith("<")?"data:,"+x.percentEncodeForDataURI(e):x.percentEncodeAmpersandAndUnencodedPercent(e),C.setParameter("src",e),this.documentOptions.srcUrls(C.getParameter("src"))):C.removeParameter("src")})),this.messageDialog=new xe(O),this.settingsPanel=new be(this.viewerOptions,this.documentOptions,this.viewer,this.messageDialog,r),this.navigation=new ge(this.viewerOptions,this.viewer,this.settingsPanel,o),this.findBox=new ye(this.viewer,this.navigation);const g=decodeURIComponent(null!==(t=C.getParameter("find")[0])&&void 0!==t?t:"");g&&this.findBox.text(g),this.marksStore=de,this.marksStore.init(this.viewerOptions,this.viewer),this.marksMenuStatus=de.menuStatus,this.marksBox=de.marksBox,this.viewer.rerenderTrigger.subscribe((()=>{this.marksStore.retryHighlightMarks()})),this.viewer.loadDocument(this.documentOptions),window.onhashchange=()=>{window.location.href!=C.storedUrl&&window.location.reload()}}handleKey(e,t){if(t.isComposing||t.keyCode&&("Enter"===t.key&&13!==t.keyCode&&16!==t.keyCode||"Escape"===t.key&&27!==t.keyCode))return!0;const i=D.identifyKeyFromEvent(t);if("vivliostyle-input-url"===document.activeElement.id)return"Enter"!==i||(this.viewer.loadDocument(this.documentOptions),!1);if("vivliostyle-find-box"===document.activeElement.id)return this.findBox.handleKey(i,t,!0);let n=this.findBox.handleKey(i,t,!1);return!!n&&(!(i===Se.Escape||!document.activeElement.closest("#vivliostyle-marks-box, #vivliostyle-text-selection-start-button, #vivliostyle-text-selection-edit-menu, [data-vivliostyle-page-container]"))||(!!("Home"!==i&&"End"!==i&&"p"!==i&&"P"!==i&&(t.ctrlKey||t.metaKey)||t.altKey||t.shiftKey)||(n=this.settingsPanel.handleKey(i),n&&(n=this.navigation.handleKey(i)),n)))}}const ke="ontouchstart"in window;a.bindingHandlers.menuButton={init(e,t){a.unwrap(t())&&(ke?(e.addEventListener("touchstart",(()=>{a.utils.toggleDomNodeCssClass(e,"hover active",!0)})),e.addEventListener("touchend",(()=>{a.utils.toggleDomNodeCssClass(e,"hover active",!1)}))):(e.addEventListener("mouseover",(()=>{a.utils.toggleDomNodeCssClass(e,"hover",!0)})),e.addEventListener("mousedown",(()=>{a.utils.toggleDomNodeCssClass(e,"active",!0)})),e.addEventListener("mouseup",(()=>{a.utils.toggleDomNodeCssClass(e,"active",!1)})),e.addEventListener("mouseout",(()=>{a.utils.toggleDomNodeCssClass(e,"hover",!1),a.utils.toggleDomNodeCssClass(e,"active",!1)}))))}};const Ee="ontouchstart"in window;let Pe=null,Ne=null,Te=null;a.bindingHandlers.swipePages={init(e,t){Ee&&a.unwrap(t())&&(e.addEventListener("touchstart",(e=>{if(e.touches.length>1)return;if(window.visualViewport&&window.visualViewport.scale>1)return;const t=document.getElementById("vivliostyle-viewer-viewport");t&&t.scrollWidth>t.clientWidth||"Range"!==document.getSelection().type&&(Pe=e.touches[0].clientX,Ne=e.touches[0].clientY)})),e.addEventListener("touchmove",(e=>{if(!(e.touches.length>1)&&"Range"!==document.getSelection().type&&null!==Pe&&null!==Ne){const t=e.touches[0].clientX-Pe,i=e.touches[0].clientY-Ne;Math.abs(t)>Math.abs(i)&&(Te=t<0?document.getElementById("vivliostyle-page-navigation-right"):document.getElementById("vivliostyle-page-navigation-left")),Math.abs(t)+Math.abs(i)>=16&&(Te&&(Te.click(),a.utils.toggleDomNodeCssClass(Te,"active",!0)),Pe=null,Ne=null)}})),e.addEventListener("touchend",(()=>{Te&&a.utils.toggleDomNodeCssClass(Te,"active",!1),Te=null,Pe=null,Ne=null})))}},a.bindingHandlers.textSelection={init(e,t){const i=/iPad|iPhone|iPod/.test(navigator.userAgent);let n=!1;if(a.unwrap(t())){e.addEventListener("mousedown",(()=>{n||"Range"===document.getSelection().type||(n=!0)})),document.addEventListener("mouseup",(()=>{n&&(de.enabled()&&re(document.getSelection()),n=!1)}));const t=document.getElementById("vivliostyle-page-navigation-left"),r=document.getElementById("vivliostyle-page-navigation-right");t&&r&&(t.onpointermove=r.onpointermove=()=>!1,t.ontouchmove=r.ontouchmove=()=>!1);let o=0;document.addEventListener("selectionchange",(()=>{const e=document.getSelection();if("Range"!==e.type)return;const s=e.getRangeAt(0);if(!s.commonAncestorContainer.parentElement.closest("[data-vivliostyle-spread-container]"))return;const a=s.commonAncestorContainer.parentElement.closest("[data-vivliostyle-page-box] > div"),l=null==a?void 0:a.style.zIndex;o||(t&&r&&(i?(t.style.display="none",r.style.display="none"):(t.style.height="min-content",r.style.height="min-content")),a&&"0"===l&&(a.style.zIndex="1"),o=window.setTimeout((()=>{t&&r&&(t.style.display="",r.style.display="",t.style.height="",r.style.height=""),a&&(a.style.zIndex=l),o=0}),1e3)),!n&&de.enabled()&&(pe.menuOpened()&&pe.applyEditing(),pe.startButtonOpened()&&pe.startButtonOpened(!1),re(e))}))}}},a.bindingHandlers.clickOutside={init(e,t){const i=a.utils.unwrapObservable(t());document.addEventListener("mousedown",(t=>{"none"!=window.getComputedStyle(e).display&&(e.contains(t.target)||e===t.target||i())}))}};const Ie={en:{translation:{UI_LNG:"en",TIP_UI_Language:"Language of UI",CONFIRM_DELETE:"Do you really want to delete it?",CONFIRM_REMOVE:"Do you really want to remove it?",CONFIRM_REMOVE_ALL:"Do you really want to remove all?",Input_:"Input a document URL or HTML code",Book_Mode:"Book Mode",Render_All_Pages:"Render All Pages",Apply:"Apply",Supported_document_types_:"Supported document types:",HTML_documents_:"HTML documents, with CSS for paged media",Book_like_publications_:"Book-like publications, with Table of Contents",Web_publications_:"Web publications (a collection of HTML documents): specify URL of the first HTML or the manifest file.",Unzipped_EPUB_:"Unzipped EPUB: specify URL of OPF file or top directory of the unzipped EPUB files.",Notes_:"Notes:",GitHub_:"GitHub and Gist URLs can be directly specified. Vivliostyle loads raw github/gist content when such URL is specified.",WARN_Mixed_Content_:"Mixed Content (http: URL is specified to https: Vivliostyle Viewer) is usually blocked by browser.",WARN_Cross_Origin_:"Cross-Origin (request to different domain) is usually blocked by browser unless the server is configured to allow Cross-Origin Resource Sharing (CORS).",URL_parameter_options_:"URL parameter options:",document_URL:"document URL",default_:"(default)",for_Book_like_:"for Book-like publications",DESC_Book_Mode_:"When an HTML document URL is specified, a series of HTML documents linked from the publication manifest or Table of Contents (e.g., marked up with '<nav role=\"doc-toc\">') are automatically loaded.",for_single_HTML_:"for single HTML documents",for_Print_:"for Print (all pages printable, page count works as expected)",for_Read_:"for Read (quick loading with rough page count)",Page_Spread_View:"Page Spread View",Spread_view:"Spread view",Single_page_view:"Single page view",Auto_spread_view:"Auto spread view",additional_stylesheet_URL:"additional (custom) stylesheet URL",user_stylesheet_URL:"user stylesheet URL",Settings:"Settings",DESC_Options_also_1:"Options can also be set in the ",DESC_Options_also_2:" panel.",See_documentation_:"For more details, see documentation:",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle User Guide",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"navigate to left",navigate_to_right:"navigate to right",Highlight_:"Highlight",Marker_Yellow:"Marker: Yellow",Marker_Red:"Marker: Red",Marker_Green:"Marker: Green",OK:"OK",Cancel:"Cancel",Delete:"Delete",TIP_Settings:"Settings (S), Double click/type to pin",Page_View_Mode:"Page View Mode",Auto:"Auto",Single_page:"Single page",Spread:"Spread",TIP_Book_Mode:"On: for Book-like publications, with Table of Contents\nOff: for single HTML documents",TIP_Render_All_Pages:"On: for Print (all pages printable, page count works)\nOff: for Read (quick loading with rough page count)",Restore_View:"Restore View",TIP_Restore_View:"Restore view settings when reopening documents",Custom_Style_Settings:"Custom Style Settings",Page_Size:"Page Size",Default:"Default",DESC_page_size_default:"(=Auto unless specified elsewhere)",DESC_page_size_auto:"(use entire window area)",Preset:"Preset",Landscape:"Landscape",Custom_size:"Custom size",Width:"Width",Height:"Height",More_:"More",Crop_Marks:"Crop Marks",Crop_marks:"Crop marks",Bleed:"Bleed",Crop_offset:"Crop offset",Page_Margins:"Page Margins",DESC_page_margin_default:"(=10% unless specified elsewhere)",Set_page_margin_to_0:"Set page margin to 0",Custom_margin:"Custom margin",Top_Right_Bottom_Left:"Top/Right/Bottom/Left",Set_first_page_margin_to_0:"Set first page margin to 0",Force_html_body_margin_to_0:"Force html/body margin to 0",Page_Breaks:"Page Breaks",Default_widows_orphans_control:"Default widows/orphans control",Allow_widows_and_orphans:"Allow widows and orphans",Avoid_page_break_inside_paragraph:"Avoid page break inside paragraph",Images:"Images",Set_image_max_size_to_fit_page:"Set image max-size to fit page",Keep_aspect_ratio:"Keep aspect ratio",Text:"Text",Font_size:"Font size",Base_font_size:"Base font-size",Base_line_height:"Base line-height",Base_font_family:"Base font-family",Custom_Style_Priority:"Custom Style Priority",Set_as_user_stylesheet:"Set as user stylesheet",DESC_user_stylesheet:"(lower priority unless !important)",Force_override_document_style:"Force override document style",important_:"(!important)",Edit_CSS:"Edit CSS",Dont_edit_:"Don't edit between /*<viewer>*/ and /*</viewer>*/.",Reset_Custom_Style:"Reset Custom Style",Reset_all_to_default:"Reset all to default",TIP_ToC:"Table of Contents (T), Double click/type to pin",TIP_Marker:"Marker (M), Double click/type to pin",Marks_and_Memos:"Marks and Memos",Remove_All:"Remove All",Remove:"Remove",Memo:"Memo",TIP_Find:"Find (Ctrl/Cmd+F)",TIP_Find_Previous:"Find Previous (Shift+Enter)",TIP_Find_Next:"Find Next (Enter)",Find:"Find",TIP_First_Page:"First Page (Home)",TIP_Previous_Page:"Previous Page ()",TIP_Next_Page:"Next Page ()",TIP_Last_Page:"Last Page (End)",TIP_Go_to_Page:"Go to Page (G)",Total_pages:"Total pages",TIP_Text_Smaller:"Text: Smaller (-)",TIP_Text_Larger:"Text: Larger (+)",TIP_Text_Default_Size:"Text: Default Size (0)",TIP_Zoom_Out:"Zoom: Out (O)",TIP_Zoom_In:"Zoom: In (I)",TIP_Zoom_Actual_Size:"Zoom: Actual Size (1)",TIP_Zoom_Fit_to_Screen:"Zoom: Fit to Screen (F)",TIP_Print:"Print (P)"}},ja:{translation:{UI_LNG:"ja",TIP_UI_Language:"UI (L)",CONFIRM_DELETE:"",CONFIRM_REMOVE:"",CONFIRM_REMOVE_ALL:"",Input_:"URLHTML",Book_Mode:"Book",Render_All_Pages:"",Apply:"",Supported_document_types_:"",HTML_documents_:"HTMLCSS",Book_like_publications_:"",Web_publications_:"WebHTML: HTMLURL",Unzipped_EPUB_:"ZIPEPUB: OPFURLEPUB",Notes_:"",GitHub_:"GitHubGistURLURLVivliostyle  github/gist  raw ",WARN_Mixed_Content_:"Mixedhttp: URL https:  Vivliostyle Viewer ",WARN_Cross_Origin_:"Cross-Origin Cross-Origin Resource Sharing (CORS) ",URL_parameter_options_:"URL",document_URL:"URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL'<nav role=\"doc-toc\">' HTML",for_single_HTML_:"HTML",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:"URL",user_stylesheet_URL:"URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:"Vivliostyle",HREF_User_Guide:"../docs/#/ja/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/ja/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"OK",Cancel:"",Delete:"",TIP_Settings:" (S), ",Page_View_Mode:" (P)",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"ON: \nOFF: HTML",TIP_Render_All_Pages:"ON: \nOFF: ",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:" (C)",Page_Size:"",Default:"",DESC_page_size_default:"(=)",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:" (M)",Crop_Marks:"",Crop_marks:"Crop marks",Bleed:"Bleed",Crop_offset:"Crop offset",Page_Margins:"",DESC_page_margin_default:"(=10%)",Set_page_margin_to_0:"0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:"0",Force_html_body_margin_to_0:"html/body0",Page_Breaks:"",Default_widows_orphans_control:"widows/orphans",Allow_widows_and_orphans:"widow/orphan",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" font-size",Base_line_height:" line-height",Base_font_family:" font-family",Custom_Style_Priority:"",Set_as_user_stylesheet:"",DESC_user_stylesheet:"(!important )",Force_override_document_style:"",important_:"(!important)",Edit_CSS:"CSS (E)",Dont_edit_:"/*<viewer>*/  /*</viewer>*/ ",Reset_Custom_Style:" (R)",Reset_all_to_default:"",TIP_ToC:" (T), ",TIP_Marker:" (M), ",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:" (End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:" (-)",TIP_Text_Larger:" (+)",TIP_Text_Default_Size:" (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:" (1)",TIP_Zoom_Fit_to_Screen:" (F)",TIP_Print:" (P)"}},"zh-Hans":{translation:{UI_LNG:"zh-Hans",TIP_UI_Language:"",CONFIRM_DELETE:"?",CONFIRM_REMOVE:"?",CONFIRM_REMOVE_ALL:"?",Input_:"URLHTML",Book_Mode:"",Render_All_Pages:"",Apply:"",Supported_document_types_:":",HTML_documents_:"css HTML ",Book_like_publications_:",",Web_publications_:"Web(HTML): HTMLURL",Unzipped_EPUB_:"EPUB:OPFURLEPUB",Notes_:":",GitHub_:"GitHubGist,VivliostyleGitHub/Gist",WARN_Mixed_Content_:"(http:URLhttps:Vivliostyle Viewer)",WARN_Cross_Origin_:"(CORS)",URL_parameter_options_:"URL :",document_URL:" URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL, (,  '<nav role=\"doc-toc\">')html",for_single_HTML_:" HTML ",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:" ()  URL",user_stylesheet_URL:" URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:":",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"",Cancel:"",Delete:"",TIP_Settings:" (S),/",Page_View_Mode:"",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"On: \nOff:  HTML ",TIP_Render_All_Pages:"On: (, )\nOff:  ()",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:"",Page_Size:"",Default:"",DESC_page_size_default:"(= )",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:"...",Crop_Marks:"",Crop_marks:"",Bleed:"",Crop_offset:"",Page_Margins:"",DESC_page_margin_default:"(=10% )",Set_page_margin_to_0:" 0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:" 0",Force_html_body_margin_to_0:" html/body  0",Page_Breaks:"",Default_widows_orphans_control:" widows/orphans ",Allow_widows_and_orphans:"widows  orphans",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" ",Base_line_height:" ",Base_font_family:" ",Custom_Style_Priority:" Style ",Set_as_user_stylesheet:"",DESC_user_stylesheet:"( !important)",Force_override_document_style:"document",important_:"(!important)",Edit_CSS:" CSS",Dont_edit_:" /*<viewer>*/  /*</viewer>*/",Reset_Custom_Style:"",Reset_all_to_default:"",TIP_ToC:" (T), /",TIP_Marker:" (M), /",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:"(End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:":  (-)",TIP_Text_Larger:":  (+)",TIP_Text_Default_Size:":  (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:":  (1)",TIP_Zoom_Fit_to_Screen:":  (F)",TIP_Print:" (P)"}},"zh-Hant":{translation:{UI_LNG:"zh-Hant",TIP_UI_Language:"",CONFIRM_DELETE:"?",CONFIRM_REMOVE:"?",CONFIRM_REMOVE_ALL:"?",Input_:"URLHTML",Book_Mode:"",Render_All_Pages:"",Apply:"",Supported_document_types_:":",HTML_documents_:"css HTML ",Book_like_publications_:",",Web_publications_:"Web(HTML): HTMLURL",Unzipped_EPUB_:"EPUB:OPFURLEPUB",Notes_:":",GitHub_:"GitHubGist,VivliostyleGitHub/Gist",WARN_Mixed_Content_:"(http:URLhttps:Vivliostyle Viewer)",WARN_Cross_Origin_:"(CORS)",URL_parameter_options_:"URL :",document_URL:" URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL, (,  '<nav role=\"doc-toc\">')html",for_single_HTML_:" HTML ",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:" ()  URL",user_stylesheet_URL:" URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:":",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"",Cancel:"",Delete:"",TIP_Settings:" (S),/",Page_View_Mode:"",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"On: \nOff:  HTML ",TIP_Render_All_Pages:"On: (, )\nOff:  ()",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:"",Page_Size:"",Default:"",DESC_page_size_default:"(= )",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:"...",Crop_Marks:"",Crop_marks:"",Bleed:"",Crop_offset:"",Page_Margins:"",DESC_page_margin_default:"(=10% )",Set_page_margin_to_0:" 0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:" 0",Force_html_body_margin_to_0:" html/body  0",Page_Breaks:"",Default_widows_orphans_control:" widows/orphans ",Allow_widows_and_orphans:"widows  orphans",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" ",Base_line_height:" ",Base_font_family:" ",Custom_Style_Priority:" Style ",Set_as_user_stylesheet:"",DESC_user_stylesheet:"( !important)",Force_override_document_style:"document",important_:"(!important)",Edit_CSS:" CSS",Dont_edit_:" /*<viewer>*/  /*</viewer>*/",Reset_Custom_Style:"",Reset_all_to_default:"",TIP_ToC:" (T), /",TIP_Marker:" (M), /",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:"(End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:":  (-)",TIP_Text_Larger:":  (+)",TIP_Text_Default_Size:":  (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:":  (1)",TIP_Zoom_Fit_to_Screen:":  (F)",TIP_Print:" (P)"}}};f.init(Ie,function(){var e;try{let t=null===(e=/[?&#]lng=([^?&#]+)/.exec(window.location.href))||void 0===e?void 0:e[1];if(t||(t=window.localStorage.getItem("i18nextLng"),t||(t=navigator.language)),t&&(t=/^(zh(-cmn)?|cmn)-(TW|HK|Hant)\b/i.test(t)?"zh-Hant":/^(zh|cmn)\b/i.test(t)?"zh-Hans":t.toLowerCase().replace(/-.*/,""),t in Ie))return t}catch(e){}return"en"}(),a),{start(){function e(){a.applyBindings(new Ce)}window.__loaded?e():window.onload=e}}.start()}));
//# sourceMappingURL=vivliostyle-viewer.js.map
