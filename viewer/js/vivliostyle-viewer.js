/**
 * @vivliostyle/viewer v2.39.1
 * Vivliostyle Viewer - HTML+CSS typesetting and rich paged viewing with EPUB/Web publications support
 *
 * @author Vivliostyle Foundation
 * @license AGPL-3.0
 * @preserve
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(i){if("default"!==i&&!(i in e)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}})}),Object.freeze(e)}function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i,n={exports:{}};
/*!
	 * Knockout JavaScript library v3.5.1
	 * (c) The Knockout.js team - http://knockoutjs.com/
	 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
	 */var r,o,s=(i||(i=1,r=n,o=n.exports,function(e){var t=this||(0,eval)("this"),i=t.document,n=t.navigator,s=t.jQuery,a=t.JSON;s||"undefined"==typeof jQuery||(s=jQuery),function(e){e(r.exports||o)}(function(r,o){function l(e,t){return(null===e||typeof e in x)&&e===t}function h(t,i){var n;return function(){n||(n=w.a.setTimeout(function(){n=e,t()},i))}}function u(e,t){var i;return function(){clearTimeout(i),i=w.a.setTimeout(e,t)}}function c(e,t){t&&"change"!==t?"beforeChange"===t?this.pc(e):this.gb(e,t):this.qc(e)}function d(e,t){null!==t&&t.s&&t.s()}function p(e,t){var i=this.qd,n=i[P];n.ra||(this.Qb&&this.mb[t]?(i.uc(t,e,this.mb[t]),this.mb[t]=null,--this.Qb):n.I[t]||i.uc(t,e,n.J?{da:e}:i.$c(e)),e.Ja&&e.gd())}var f,g,m,b,v,y,w=void 0!==r?r:{};w.b=function(e,t){for(var i=e.split("."),n=w,r=0;r<i.length-1;r++)n=n[i[r]];n[i[i.length-1]]=t},w.L=function(e,t,i){e[t]=i},w.version="3.5.1",w.b("version",w.version),w.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1},w.a=function(){function r(e,t){for(var i in e)u.call(e,i)&&t(i,e[i])}function o(e,t){if(t)for(var i in t)u.call(t,i)&&(e[i]=t[i]);return e}function l(e,t){return e.__proto__=t,e}function h(e,t,i,n){var r=e[t].match(v)||[];w.a.D(i.match(v),function(e){w.a.Na(r,e,n)}),e[t]=r.join(" ")}var u=Object.prototype.hasOwnProperty,c={__proto__:[]}instanceof Array,d="function"==typeof Symbol,p={},f={};p[n&&/Firefox\/2/i.test(n.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],p.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),r(p,function(e,t){if(t.length)for(var i=0,n=t.length;i<n;i++)f[t[i]]=e});var g,m={propertychange:!0},b=i&&function(){for(var t=3,n=i.createElement("div"),r=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e",r[0];);return 4<t?t:e}(),v=/\S+/g;return{Jc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],D:function(e,t,i){for(var n=0,r=e.length;n<r;n++)t.call(i,e[n],n,e)},A:"function"==typeof Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t)}:function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},Lb:function(t,i,n){for(var r=0,o=t.length;r<o;r++)if(i.call(n,t[r],r,t))return t[r];return e},Pa:function(e,t){var i=w.a.A(e,t);0<i?e.splice(i,1):0===i&&e.shift()},wc:function(e){var t=[];return e&&w.a.D(e,function(e){0>w.a.A(t,e)&&t.push(e)}),t},Mb:function(e,t,i){var n=[];if(e)for(var r=0,o=e.length;r<o;r++)n.push(t.call(i,e[r],r));return n},jb:function(e,t,i){var n=[];if(e)for(var r=0,o=e.length;r<o;r++)t.call(i,e[r],r)&&n.push(e[r]);return n},Nb:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var i=0,n=t.length;i<n;i++)e.push(t[i]);return e},Na:function(e,t,i){var n=w.a.A(w.a.bc(e),t);0>n?i&&e.push(t):i||e.splice(n,1)},Ba:c,extend:o,setPrototypeOf:l,Ab:c?l:o,P:r,Ga:function(e,t,i){if(!e)return e;var n,r={};for(n in e)u.call(e,n)&&(r[n]=t.call(i,e[n],n,e));return r},Tb:function(e){for(;e.firstChild;)w.removeNode(e.firstChild)},Yb:function(e){for(var t=((e=w.a.la(e))[0]&&e[0].ownerDocument||i).createElement("div"),n=0,r=e.length;n<r;n++)t.appendChild(w.oa(e[n]));return t},Ca:function(e,t){for(var i=0,n=e.length,r=[];i<n;i++){var o=e[i].cloneNode(!0);r.push(t?w.oa(o):o)}return r},va:function(e,t){if(w.a.Tb(e),t)for(var i=0,n=t.length;i<n;i++)e.appendChild(t[i])},Xc:function(e,t){var i=e.nodeType?[e]:e;if(0<i.length){for(var n=i[0],r=n.parentNode,o=0,s=t.length;o<s;o++)r.insertBefore(t[o],n);for(o=0,s=i.length;o<s;o++)w.removeNode(i[o])}},Ua:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var i=e[0],n=e[e.length-1];for(e.length=0;i!==n;)e.push(i),i=i.nextSibling;e.push(n)}}return e},Zc:function(e,t){7>b?e.setAttribute("selected",t):e.selected=t},Db:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Ud:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},vd:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(1!==e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return!(16&~t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},Sb:function(e){return w.a.vd(e,e.ownerDocument.documentElement)},kd:function(e){return!!w.a.Lb(e,w.a.Sb)},R:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Ac:function(e){return w.onError?function(){try{return e.apply(this,arguments)}catch(e){throw w.onError&&w.onError(e),e}}:e},setTimeout:function(e,t){return setTimeout(w.a.Ac(e),t)},Gc:function(e){setTimeout(function(){throw w.onError&&w.onError(e),e},0)},B:function(e,t,i){var n=w.a.Ac(i);if(i=m[t],w.options.useOnlyNativeEvents||i||!s)if(i||"function"!=typeof e.addEventListener){if(void 0===e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var r=function(t){n.call(e,t)},o="on"+t;e.attachEvent(o,r),w.a.K.za(e,function(){e.detachEvent(o,r)})}else e.addEventListener(t,n,!1);else g||(g="function"==typeof s(e).on?"on":"bind"),s(e)[g](t,n)},Fb:function(e,n){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var r;if(r=!("input"!==w.a.R(e)||!e.type||"click"!=n.toLowerCase()||"checkbox"!=(r=e.type)&&"radio"!=r),w.options.useOnlyNativeEvents||!s||r)if("function"==typeof i.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");(r=i.createEvent(f[n]||"HTMLEvents")).initEvent(n,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(r)}else if(r&&e.click)e.click();else{if(void 0===e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+n)}else s(e).trigger(n)},f:function(e){return w.O(e)?e():e},bc:function(e){return w.O(e)?e.v():e},Eb:function(e,t,i){var n;t&&("object"==typeof e.classList?(n=e.classList[i?"add":"remove"],w.a.D(t.match(v),function(t){n.call(e.classList,t)})):"string"==typeof e.className.baseVal?h(e.className,"baseVal",t,i):h(e,"className",t,i))},Bb:function(t,i){var n=w.a.f(i);null!==n&&n!==e||(n="");var r=w.h.firstChild(t);!r||3!=r.nodeType||w.h.nextSibling(r)?w.h.va(t,[t.ownerDocument.createTextNode(n)]):r.data=n,w.a.Ad(t)},Yc:function(e,t){if(e.name=t,7>=b)try{var n=e.name.replace(/[&<>'"]/g,function(e){return"&#"+e.charCodeAt(0)+";"});e.mergeAttributes(i.createElement("<input name='"+n+"'/>"),!1)}catch(e){}},Ad:function(e){9<=b&&(e=1==e.nodeType?e:e.parentNode).style&&(e.style.zoom=e.style.zoom)},wd:function(e){if(b){var t=e.style.width;e.style.width=0,e.style.width=t}},Pd:function(e,t){e=w.a.f(e),t=w.a.f(t);for(var i=[],n=e;n<=t;n++)i.push(n);return i},la:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t.push(e[i]);return t},Da:function(e){return d?Symbol(e):e},Zd:6===b,$d:7===b,W:b,Lc:function(e,t){for(var i=w.a.la(e.getElementsByTagName("input")).concat(w.a.la(e.getElementsByTagName("textarea"))),n="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},r=[],o=i.length-1;0<=o;o--)n(i[o])&&r.push(i[o]);return r},Nd:function(e){return"string"==typeof e&&(e=w.a.Db(e))?a&&a.parse?a.parse(e):new Function("return "+e)():null},hc:function(e,t,i){if(!a||!a.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return a.stringify(w.a.f(e),t,i)},Od:function(e,t,n){var o=(n=n||{}).params||{},s=n.includeFields||this.Jc,a=e;if("object"==typeof e&&"form"===w.a.R(e)){a=e.action;for(var l=s.length-1;0<=l;l--)for(var h=w.a.Lc(e,s[l]),u=h.length-1;0<=u;u--)o[h[u].name]=h[u].value}t=w.a.f(t);var c=i.createElement("form");for(var d in c.style.display="none",c.action=a,c.method="post",t)(e=i.createElement("input")).type="hidden",e.name=d,e.value=w.a.hc(w.a.f(t[d])),c.appendChild(e);r(o,function(e,t){var n=i.createElement("input");n.type="hidden",n.name=e,n.value=t,c.appendChild(n)}),i.body.appendChild(c),n.submitter?n.submitter(c):c.submit(),setTimeout(function(){c.parentNode.removeChild(c)},0)}}}(),w.b("utils",w.a),w.b("utils.arrayForEach",w.a.D),w.b("utils.arrayFirst",w.a.Lb),w.b("utils.arrayFilter",w.a.jb),w.b("utils.arrayGetDistinctValues",w.a.wc),w.b("utils.arrayIndexOf",w.a.A),w.b("utils.arrayMap",w.a.Mb),w.b("utils.arrayPushAll",w.a.Nb),w.b("utils.arrayRemoveItem",w.a.Pa),w.b("utils.cloneNodes",w.a.Ca),w.b("utils.createSymbolOrString",w.a.Da),w.b("utils.extend",w.a.extend),w.b("utils.fieldsIncludedWithJsonPost",w.a.Jc),w.b("utils.getFormFields",w.a.Lc),w.b("utils.objectMap",w.a.Ga),w.b("utils.peekObservable",w.a.bc),w.b("utils.postJson",w.a.Od),w.b("utils.parseJson",w.a.Nd),w.b("utils.registerEventHandler",w.a.B),w.b("utils.stringifyJson",w.a.hc),w.b("utils.range",w.a.Pd),w.b("utils.toggleDomNodeCssClass",w.a.Eb),w.b("utils.triggerEvent",w.a.Fb),w.b("utils.unwrapObservable",w.a.f),w.b("utils.objectForEach",w.a.P),w.b("utils.addOrRemoveItem",w.a.Na),w.b("utils.setTextContent",w.a.Bb),w.b("unwrap",w.a.f),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var i=Array.prototype.slice.call(arguments,1);return function(){var n=i.slice(0);return n.push.apply(n,arguments),t.apply(e,n)}}),w.a.g=new function(){var t,i,n=0,r="__ko__"+(new Date).getTime(),o={};return w.a.W?(t=function(t,i){var s=t[r];if(!s||"null"===s||!o[s]){if(!i)return e;s=t[r]="ko"+n++,o[s]={}}return o[s]},i=function(e){var t=e[r];return!!t&&(delete o[t],e[r]=null,!0)}):(t=function(e,t){var i=e[r];return!i&&t&&(i=e[r]={}),i},i=function(e){return!!e[r]&&(delete e[r],!0)}),{get:function(e,i){var n=t(e,!1);return n&&n[i]},set:function(i,n,r){(i=t(i,r!==e))&&(i[n]=r)},Ub:function(e,i,n){return(e=t(e,!0))[i]||(e[i]=n)},clear:i,Z:function(){return n+++r}}},w.b("utils.domData",w.a.g),w.b("utils.domData.clear",w.a.g.clear),w.a.K=new function(){function t(t,i){var n=w.a.g.get(t,r);return n===e&&i&&(n=[],w.a.g.set(t,r,n)),n}function i(e){if(i=t(e,!1))for(var i=i.slice(0),r=0;r<i.length;r++)i[r](e);w.a.g.clear(e),w.a.K.cleanExternalData(e),a[e.nodeType]&&n(e.childNodes,!0)}function n(e,t){for(var n,r=[],o=0;o<e.length;o++)if((!t||8===e[o].nodeType)&&(i(r[r.length]=n=e[o]),e[o]!==n))for(;o--&&-1==w.a.A(r,e[o]););}var r=w.a.g.Z(),o={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{za:function(e,i){if("function"!=typeof i)throw Error("Callback must be a function");t(e,!0).push(i)},yb:function(i,n){var o=t(i,!1);o&&(w.a.Pa(o,n),0==o.length&&w.a.g.set(i,r,e))},oa:function(e){return w.u.G(function(){o[e.nodeType]&&(i(e),a[e.nodeType]&&n(e.getElementsByTagName("*")))}),e},removeNode:function(e){w.oa(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){s&&"function"==typeof s.cleanData&&s.cleanData([e])}}},w.oa=w.a.K.oa,w.removeNode=w.a.K.removeNode,w.b("cleanNode",w.oa),w.b("removeNode",w.removeNode),w.b("utils.domNodeDisposal",w.a.K),w.b("utils.domNodeDisposal.addDisposeCallback",w.a.K.za),w.b("utils.domNodeDisposal.removeDisposeCallback",w.a.K.yb),f=[0,"",""],v={thead:g=[1,"<table>","</table>"],tbody:g,tfoot:g,tr:[2,"<table><tbody>","</tbody></table>"],td:m=[3,"<table><tbody><tr>","</tr></tbody></table>"],th:m,option:b=[1,"<select multiple='multiple'>","</select>"],optgroup:b},y=8>=w.a.W,w.a.ua=function(e,n){var r;if(s){if(s.parseHTML)r=s.parseHTML(e,n)||[];else if((r=s.clean([e],n))&&r[0]){for(var o=r[0];o.parentNode&&11!==o.parentNode.nodeType;)o=o.parentNode;o.parentNode&&o.parentNode.removeChild(o)}}else{(r=n)||(r=i),o=r.parentWindow||r.defaultView||t;var a,l=w.a.Db(e).toLowerCase(),h=r.createElement("div");for(a=(l=l.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&v[l[1]]||f,l=a[0],a="ignored<div>"+a[1]+e+a[2]+"</div>","function"==typeof o.innerShiv?h.appendChild(o.innerShiv(a)):(y&&r.body.appendChild(h),h.innerHTML=a,y&&h.parentNode.removeChild(h));l--;)h=h.lastChild;r=w.a.la(h.lastChild.childNodes)}return r},w.a.Md=function(e,t){var i=w.a.ua(e,t);return i.length&&i[0].parentElement||w.a.Yb(i)},w.a.fc=function(t,i){if(w.a.Tb(t),null!==(i=w.a.f(i))&&i!==e)if("string"!=typeof i&&(i=i.toString()),s)s(t).html(i);else for(var n=w.a.ua(i,t.ownerDocument),r=0;r<n.length;r++)t.appendChild(n[r])},w.b("utils.parseHtmlFragment",w.a.ua),w.b("utils.setHtml",w.a.fc),w.aa=function(){function t(e,i){if(e)if(8==e.nodeType)null!=(n=w.aa.Uc(e.nodeValue))&&i.push({ud:e,Kd:n});else if(1==e.nodeType)for(var n=0,r=e.childNodes,o=r.length;n<o;n++)t(r[n],i)}var i={};return{Xb:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return i[t]=e,"\x3c!--[ko_memo:"+t+"]--\x3e"},bd:function(t,n){var r=i[t];if(r===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete i[t]}},cd:function(e,i){var n=[];t(e,n);for(var r=0,o=n.length;r<o;r++){var s=n[r].ud,a=[s];i&&w.a.Nb(a,i),w.aa.bd(n[r].Kd,a),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Uc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),w.b("memoization",w.aa),w.b("memoization.memoize",w.aa.Xb),w.b("memoization.unmemoize",w.aa.bd),w.b("memoization.parseMemoText",w.aa.Uc),w.b("memoization.unmemoizeDomNodeAndDescendants",w.aa.cd),w.na=function(){function e(){if(s)for(var e,t=s,i=0;l<s;)if(e=o[l++]){if(l>t){if(5e3<=++i){l=s,w.a.Gc(Error("'Too much recursion' after processing "+i+" task groups."));break}t=s}try{e()}catch(e){w.a.Gc(e)}}}function n(){e(),l=s=o.length=0}var r,o=[],s=0,a=1,l=0;return r=t.MutationObserver?function(e){var t=i.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(n):i&&"onreadystatechange"in i.createElement("script")?function(e){var t=i.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,i.documentElement.removeChild(t),t=null,e()},i.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},{scheduler:r,zb:function(e){return s||w.na.scheduler(n),o[s++]=e,a++},cancel:function(e){(e-=a-s)>=l&&e<s&&(o[e]=null)},resetForTesting:function(){var e=s-l;return l=s=o.length=0,e},Sd:e}}(),w.b("tasks",w.na),w.b("tasks.schedule",w.na.zb),w.b("tasks.runEarly",w.na.Sd),w.Ta={throttle:function(e,t){e.throttleEvaluation=t;var i=null;return w.$({read:e,write:function(n){clearTimeout(i),i=w.a.setTimeout(function(){e(n)},t)}})},rateLimit:function(e,t){var i,n,r;"number"==typeof t?i=t:(i=t.timeout,n=t.method),e.Hb=!1,r="function"==typeof n?n:"notifyWhenChangesStop"==n?u:h,e.ub(function(e){return r(e,i,t)})},deferred:function(t,i){if(!0!==i)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");t.Hb||(t.Hb=!0,t.ub(function(i){var n,r=!1;return function(){if(!r){w.na.cancel(n),n=w.na.zb(i);try{r=!0,t.notifySubscribers(e,"dirty")}finally{r=!1}}}}))},notify:function(e,t){e.equalityComparer="always"==t?null:l}};var x={undefined:1,boolean:1,number:1,string:1};w.b("extenders",w.Ta),w.ic=function(e,t,i){this.da=e,this.lc=t,this.mc=i,this.Ib=!1,this.fb=this.Jb=null,w.L(this,"dispose",this.s),w.L(this,"disposeWhenNodeIsRemoved",this.l)},w.ic.prototype.s=function(){this.Ib||(this.fb&&w.a.K.yb(this.Jb,this.fb),this.Ib=!0,this.mc(),this.da=this.lc=this.mc=this.Jb=this.fb=null)},w.ic.prototype.l=function(e){this.Jb=e,w.a.K.za(e,this.fb=this.s.bind(this))},w.T=function(){w.a.Ab(this,S),S.qb(this)};var S={qb:function(e){e.U={change:[]},e.sc=1},subscribe:function(e,t,i){var n=this;i=i||"change";var r=new w.ic(n,t?e.bind(t):e,function(){w.a.Pa(n.U[i],r),n.hb&&n.hb(i)});return n.Qa&&n.Qa(i),n.U[i]||(n.U[i]=[]),n.U[i].push(r),r},notifySubscribers:function(e,t){if("change"===(t=t||"change")&&this.Gb(),this.Wa(t)){var i="change"===t&&this.ed||this.U[t].slice(0);try{w.u.xc();for(var n,r=0;n=i[r];++r)n.Ib||n.lc(e)}finally{w.u.end()}}},ob:function(){return this.sc},Dd:function(e){return this.ob()!==e},Gb:function(){++this.sc},ub:function(e){var t,i,n,r,o,s=this,a=w.O(s);s.gb||(s.gb=s.notifySubscribers,s.notifySubscribers=c);var l=e(function(){s.Ja=!1,a&&r===s&&(r=s.nc?s.nc():s());var e=i||o&&s.sb(n,r);o=i=t=!1,e&&s.gb(n=r)});s.qc=function(e,i){i&&s.Ja||(o=!i),s.ed=s.U.change.slice(0),s.Ja=t=!0,r=e,l()},s.pc=function(e){t||(n=e,s.gb(e,"beforeChange"))},s.rc=function(){o=!0},s.gd=function(){s.sb(n,s.v(!0))&&(i=!0)}},Wa:function(e){return this.U[e]&&this.U[e].length},Bd:function(e){if(e)return this.U[e]&&this.U[e].length||0;var t=0;return w.a.P(this.U,function(e,i){"dirty"!==e&&(t+=i.length)}),t},sb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},toString:function(){return"[object Object]"},extend:function(e){var t=this;return e&&w.a.P(e,function(e,i){var n=w.Ta[e];"function"==typeof n&&(t=n(t,i)||t)}),t}};w.L(S,"init",S.qb),w.L(S,"subscribe",S.subscribe),w.L(S,"extend",S.extend),w.L(S,"getSubscriptionsCount",S.Bd),w.a.Ba&&w.a.setPrototypeOf(S,Function.prototype),w.T.fn=S,w.Qc=function(e){return null!=e&&"function"==typeof e.subscribe&&"function"==typeof e.notifySubscribers},w.b("subscribable",w.T),w.b("isSubscribable",w.Qc),w.S=w.u=function(){function e(e){n.push(i),i=e}function t(){i=n.pop()}var i,n=[],r=0;return{xc:e,end:t,cc:function(e){if(i){if(!w.Qc(e))throw Error("Only subscribable things can act as dependencies");i.od.call(i.pd,e,e.fd||(e.fd=++r))}},G:function(i,n,r){try{return e(),i.apply(n,r||[])}finally{t()}},qa:function(){if(i)return i.o.qa()},Va:function(){if(i)return i.o.Va()},Ya:function(){if(i)return i.Ya},o:function(){if(i)return i.o}}}(),w.b("computedContext",w.S),w.b("computedContext.getDependenciesCount",w.S.qa),w.b("computedContext.getDependencies",w.S.Va),w.b("computedContext.isInitial",w.S.Ya),w.b("computedContext.registerDependency",w.S.cc),w.b("ignoreDependencies",w.Yd=w.u.G);var C=w.a.Da("_latestValue");w.ta=function(e){function t(){return 0<arguments.length?(t.sb(t[C],arguments[0])&&(t.ya(),t[C]=arguments[0],t.xa()),this):(w.u.cc(t),t[C])}return t[C]=e,w.a.Ba||w.a.extend(t,w.T.fn),w.T.fn.qb(t),w.a.Ab(t,k),w.options.deferUpdates&&w.Ta.deferred(t,!0),t};var k={equalityComparer:l,v:function(){return this[C]},xa:function(){this.notifySubscribers(this[C],"spectate"),this.notifySubscribers(this[C])},ya:function(){this.notifySubscribers(this[C],"beforeChange")}};w.a.Ba&&w.a.setPrototypeOf(k,w.T.fn);var E=w.ta.Ma="__ko_proto__";k[E]=w.ta,w.O=function(e){if((e="function"==typeof e&&e[E])&&e!==k[E]&&e!==w.o.fn[E])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},w.Za=function(e){return"function"==typeof e&&(e[E]===k[E]||e[E]===w.o.fn[E]&&e.Nc)},w.b("observable",w.ta),w.b("isObservable",w.O),w.b("isWriteableObservable",w.Za),w.b("isWritableObservable",w.Za),w.b("observable.fn",k),w.L(k,"peek",k.v),w.L(k,"valueHasMutated",k.xa),w.L(k,"valueWillMutate",k.ya),w.Ha=function(e){if("object"!=typeof(e=e||[])||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=w.ta(e),w.a.Ab(e,w.Ha.fn),e.extend({trackArrayChanges:!0})},w.Ha.fn={remove:function(e){for(var t=this.v(),i=[],n="function"!=typeof e||w.O(e)?function(t){return t===e}:e,r=0;r<t.length;r++){var o=t[r];if(n(o)){if(0===i.length&&this.ya(),t[r]!==o)throw Error("Array modified during remove; cannot remove item");i.push(o),t.splice(r,1),r--}}return i.length&&this.xa(),i},removeAll:function(t){if(t===e){var i=this.v(),n=i.slice(0);return this.ya(),i.splice(0,i.length),this.xa(),n}return t?this.remove(function(e){return 0<=w.a.A(t,e)}):[]},destroy:function(e){var t=this.v(),i="function"!=typeof e||w.O(e)?function(t){return t===e}:e;this.ya();for(var n=t.length-1;0<=n;n--){var r=t[n];i(r)&&(r._destroy=!0)}this.xa()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=w.a.A(t,e)}):[]},indexOf:function(e){var t=this();return w.a.A(t,e)},replace:function(e,t){var i=this.indexOf(e);0<=i&&(this.ya(),this.v()[i]=t,this.xa())},sorted:function(e){var t=this().slice(0);return e?t.sort(e):t.sort()},reversed:function(){return this().slice(0).reverse()}},w.a.Ba&&w.a.setPrototypeOf(w.Ha.fn,w.ta.fn),w.a.D("pop push reverse shift sort splice unshift".split(" "),function(e){w.Ha.fn[e]=function(){var t=this.v();this.ya(),this.zc(t,e,arguments);var i=t[e].apply(t,arguments);return this.xa(),i===t?this:i}}),w.a.D(["slice"],function(e){w.Ha.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),w.Pc=function(e){return w.O(e)&&"function"==typeof e.remove&&"function"==typeof e.push},w.b("observableArray",w.Ha),w.b("isObservableArray",w.Pc),w.Ta.trackArrayChanges=function(t,i){function n(){function e(){if(h){var e,i=[].concat(t.v()||[]);t.Wa("arrayChange")&&((!l||1<h)&&(l=w.a.Pb(s,i,t.Ob)),e=l),s=i,l=null,h=0,e&&e.length&&t.notifySubscribers(e,"arrayChange")}}a?e():(a=!0,o=t.subscribe(function(){++h},null,"spectate"),s=[].concat(t.v()||[]),l=null,r=t.subscribe(e))}if(t.Ob={},i&&"object"==typeof i&&w.a.extend(t.Ob,i),t.Ob.sparse=!0,!t.zc){var r,o,s,a=!1,l=null,h=0,u=t.Qa,c=t.hb;t.Qa=function(e){u&&u.call(t,e),"arrayChange"===e&&n()},t.hb=function(i){c&&c.call(t,i),"arrayChange"!==i||t.Wa("arrayChange")||(r&&r.s(),o&&o.s(),o=r=null,a=!1,s=e)},t.zc=function(e,t,i){function n(e,t,i){return r[r.length]={status:e,value:t,index:i}}if(a&&!h){var r=[],o=e.length,s=i.length,u=0;switch(t){case"push":u=o;case"unshift":for(t=0;t<s;t++)n("added",i[t],u+t);break;case"pop":u=o-1;case"shift":o&&n("deleted",e[u],u);break;case"splice":t=Math.min(Math.max(0,0>i[0]?o+i[0]:i[0]),o),o=1===s?o:Math.min(t+(i[1]||0),o),s=t+s-2,u=Math.max(o,s);for(var c=[],d=[],p=2;t<u;++t,++p)t<o&&d.push(n("deleted",e[t],t)),t<s&&c.push(n("added",i[p],t));w.a.Kc(d,c);break;default:return}l=r}}}};var P=w.a.Da("_state");w.o=w.$=function(t,i,n){function r(){if(0<arguments.length){if("function"!=typeof o)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return o.apply(s.nb,arguments),this}return s.ra||w.u.cc(r),(s.ka||s.J&&r.Xa())&&r.ha(),s.X}if("object"==typeof t?n=t:(n=n||{},t&&(n.read=t)),"function"!=typeof n.read)throw Error("Pass a function that returns the value of the ko.computed");var o=n.write,s={X:e,sa:!0,ka:!0,rb:!1,jc:!1,ra:!1,wb:!1,J:!1,Wc:n.read,nb:i||n.owner,l:n.disposeWhenNodeIsRemoved||n.l||null,Sa:n.disposeWhen||n.Sa,Rb:null,I:{},V:0,Ic:null};return r[P]=s,r.Nc="function"==typeof o,w.a.Ba||w.a.extend(r,w.T.fn),w.T.fn.qb(r),w.a.Ab(r,N),n.pure?(s.wb=!0,s.J=!0,w.a.extend(r,T)):n.deferEvaluation&&w.a.extend(r,I),w.options.deferUpdates&&w.Ta.deferred(r,!0),s.l&&(s.jc=!0,s.l.nodeType||(s.l=null)),s.J||n.deferEvaluation||r.ha(),s.l&&r.ja()&&w.a.K.za(s.l,s.Rb=function(){r.s()}),r};var N={equalityComparer:l,qa:function(){return this[P].V},Va:function(){var e=[];return w.a.P(this[P].I,function(t,i){e[i.Ka]=i.da}),e},Vb:function(e){if(!this[P].V)return!1;var t=this.Va();return-1!==w.a.A(t,e)||!!w.a.Lb(t,function(t){return t.Vb&&t.Vb(e)})},uc:function(e,t,i){if(this[P].wb&&t===this)throw Error("A 'pure' computed must not be called recursively");this[P].I[e]=i,i.Ka=this[P].V++,i.La=t.ob()},Xa:function(){var e,t,i=this[P].I;for(e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&(t=i[e],this.Ia&&t.da.Ja||t.da.Dd(t.La)))return!0},Jd:function(){this.Ia&&!this[P].rb&&this.Ia(!1)},ja:function(){var e=this[P];return e.ka||0<e.V},Rd:function(){this.Ja?this[P].ka&&(this[P].sa=!0):this.Hc()},$c:function(e){if(e.Hb){var t=e.subscribe(this.Jd,this,"dirty"),i=e.subscribe(this.Rd,this);return{da:e,s:function(){t.s(),i.s()}}}return e.subscribe(this.Hc,this)},Hc:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[P].Ic),this[P].Ic=w.a.setTimeout(function(){e.ha(!0)},t)):e.Ia?e.Ia(!0):e.ha(!0)},ha:function(e){var t=this[P],i=t.Sa,n=!1;if(!t.rb&&!t.ra){if(t.l&&!w.a.Sb(t.l)||i&&i()){if(!t.jc)return void this.s()}else t.jc=!1;t.rb=!0;try{n=this.zd(e)}finally{t.rb=!1}return n}},zd:function(t){var i=this[P],n=!1,r=i.wb?e:!i.V;n={qd:this,mb:i.I,Qb:i.V},w.u.xc({pd:n,od:p,o:this,Ya:r}),i.I={},i.V=0;var o=this.yd(i,n);return i.V?n=this.sb(i.X,o):(this.s(),n=!0),n&&(i.J?this.Gb():this.notifySubscribers(i.X,"beforeChange"),i.X=o,this.notifySubscribers(i.X,"spectate"),!i.J&&t&&this.notifySubscribers(i.X),this.rc&&this.rc()),r&&this.notifySubscribers(i.X,"awake"),n},yd:function(e,t){try{var i=e.Wc;return e.nb?i.call(e.nb):i()}finally{w.u.end(),t.Qb&&!e.J&&w.a.P(t.mb,d),e.sa=e.ka=!1}},v:function(e){var t=this[P];return(t.ka&&(e||!t.V)||t.J&&this.Xa())&&this.ha(),t.X},ub:function(e){w.T.fn.ub.call(this,e),this.nc=function(){return this[P].J||(this[P].sa?this.ha():this[P].ka=!1),this[P].X},this.Ia=function(e){this.pc(this[P].X),this[P].ka=!0,e&&(this[P].sa=!0),this.qc(this,!e)}},s:function(){var t=this[P];!t.J&&t.I&&w.a.P(t.I,function(e,t){t.s&&t.s()}),t.l&&t.Rb&&w.a.K.yb(t.l,t.Rb),t.I=e,t.V=0,t.ra=!0,t.sa=!1,t.ka=!1,t.J=!1,t.l=e,t.Sa=e,t.Wc=e,this.Nc||(t.nb=e)}},T={Qa:function(e){var t=this,i=t[P];if(!i.ra&&i.J&&"change"==e){if(i.J=!1,i.sa||t.Xa())i.I=null,i.V=0,t.ha()&&t.Gb();else{var n=[];w.a.P(i.I,function(e,t){n[t.Ka]=e}),w.a.D(n,function(e,n){var r=i.I[e],o=t.$c(r.da);o.Ka=n,o.La=r.La,i.I[e]=o}),t.Xa()&&t.ha()&&t.Gb()}i.ra||t.notifySubscribers(i.X,"awake")}},hb:function(t){var i=this[P];i.ra||"change"!=t||this.Wa("change")||(w.a.P(i.I,function(e,t){t.s&&(i.I[e]={da:t.da,Ka:t.Ka,La:t.La},t.s())}),i.J=!0,this.notifySubscribers(e,"asleep"))},ob:function(){var e=this[P];return e.J&&(e.sa||this.Xa())&&this.ha(),w.T.fn.ob.call(this)}},I={Qa:function(e){"change"!=e&&"beforeChange"!=e||this.v()}};w.a.Ba&&w.a.setPrototypeOf(N,w.T.fn);var A=w.ta.Ma;N[A]=w.o,w.Oc=function(e){return"function"==typeof e&&e[A]===N[A]},w.Fd=function(e){return w.Oc(e)&&e[P]&&e[P].wb},w.b("computed",w.o),w.b("dependentObservable",w.o),w.b("isComputed",w.Oc),w.b("isPureComputed",w.Fd),w.b("computed.fn",N),w.L(N,"peek",N.v),w.L(N,"dispose",N.s),w.L(N,"isActive",N.ja),w.L(N,"getDependenciesCount",N.qa),w.L(N,"getDependencies",N.Va),w.xb=function(e,t){return"function"==typeof e?w.o(e,t,{pure:!0}):((e=w.a.extend({},e)).pure=!0,w.o(e,t))},w.b("pureComputed",w.xb),function(){function t(n,r,o){if(o=o||new i,"object"!=typeof(n=r(n))||null===n||n===e||n instanceof RegExp||n instanceof Date||n instanceof String||n instanceof Number||n instanceof Boolean)return n;var s=n instanceof Array?[]:{};return o.save(n,s),function(e,t){if(e instanceof Array){for(var i=0;i<e.length;i++)t(i);"function"==typeof e.toJSON&&t("toJSON")}else for(i in e)t(i)}(n,function(i){var a=r(n[i]);switch(typeof a){case"boolean":case"number":case"string":case"function":s[i]=a;break;case"object":case"undefined":var l=o.get(a);s[i]=l!==e?l:t(a,r,o)}}),s}function i(){this.keys=[],this.values=[]}w.ad=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;w.O(e)&&10>t;t++)e=e();return e})},w.toJSON=function(e,t,i){return e=w.ad(e),w.a.hc(e,t,i)},i.prototype={constructor:i,save:function(e,t){var i=w.a.A(this.keys,e);0<=i?this.values[i]=t:(this.keys.push(e),this.values.push(t))},get:function(t){return 0<=(t=w.a.A(this.keys,t))?this.values[t]:e}}}(),w.b("toJS",w.ad),w.b("toJSON",w.toJSON),w.Wd=function(e,t,i){function n(t){var n=w.xb(e,i).extend({ma:"always"}),r=n.subscribe(function(e){e&&(r.s(),t(e))});return n.notifySubscribers(n.v()),r}return"function"!=typeof Promise||t?n(t.bind(i)):new Promise(n)},w.b("when",w.Wd),w.w={M:function(t){switch(w.a.R(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?w.a.g.get(t,w.c.options.$b):7>=w.a.W?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?w.w.M(t.options[t.selectedIndex]):e;default:return t.value}},cb:function(t,i,n){switch(w.a.R(t)){case"option":"string"==typeof i?(w.a.g.set(t,w.c.options.$b,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=i):(w.a.g.set(t,w.c.options.$b,i),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof i?i:"");break;case"select":""!==i&&null!==i||(i=e);for(var r,o=-1,s=0,a=t.options.length;s<a;++s)if((r=w.w.M(t.options[s]))==i||""===r&&i===e){o=s;break}(n||0<=o||i===e&&1<t.size)&&(t.selectedIndex=o,6===w.a.W&&w.a.setTimeout(function(){t.selectedIndex=o},0));break;default:null!==i&&i!==e||(i=""),t.value=i}}},w.b("selectExtensions",w.w),w.b("selectExtensions.readValue",w.w.M),w.b("selectExtensions.writeValue",w.w.cb),w.m=function(){function e(e){123===(e=w.a.Db(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t,i=[],s=(e+="\n,").match(n),a=[],l=0;if(1<s.length){for(var h,u=0;h=s[u];++u){var c=h.charCodeAt(0);if(44===c){if(0>=l){i.push(t&&a.length?{key:t,value:a.join("")}:{unknown:t||a.join("")}),t=l=0,a=[];continue}}else if(58===c){if(!l&&!t&&1===a.length){t=a.pop();continue}}else{if(47===c&&1<h.length&&(47===h.charCodeAt(1)||42===h.charCodeAt(1)))continue;47===c&&u&&1<h.length?(c=s[u-1].match(r))&&!o[c[0]]&&(s=(e=e.substr(e.indexOf(h)+1)).match(n),u=-1,h="/"):40===c||123===c||91===c?++l:41===c||125===c||93===c?--l:t||a.length||34!==c&&39!==c||(h=h.slice(1,-1))}a.push(h)}if(0<l)throw Error("Unbalanced parentheses, braces, or brackets")}return i}var t=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,n=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),r=/[\])"'A-Za-z0-9_$]+$/,o={in:1,return:1,typeof:1},s={};return{Ra:[],wa:s,ac:e,vb:function(n,r){function o(e,n){var r;if(!u){var c=w.getBindingHandler(e);if(c&&c.preprocess&&!(n=c.preprocess(n,e,o)))return;(c=s[e])&&(r=n,0<=w.a.A(t,r)?r=!1:(c=r.match(i),r=null!==c&&(c[1]?"Object("+c[1]+")"+c[2]:r)),c=r),c&&l.push("'"+("string"==typeof s[e]?s[e]:e)+"':function(_z){"+r+"=_z}")}h&&(n="function(){return "+n+" }"),a.push("'"+e+"':"+n)}var a=[],l=[],h=(r=r||{}).valueAccessors,u=r.bindingParams,c="string"==typeof n?e(n):n;return w.a.D(c,function(e){o(e.key||e.unknown,e.value)}),l.length&&o("_ko_property_writers","{"+l.join(",")+" }"),a.join(",")},Id:function(e,t){for(var i=0;i<e.length;i++)if(e[i].key==t)return!0;return!1},eb:function(e,t,i,n,r){e&&w.O(e)?!w.Za(e)||r&&e.v()===n||e(n):(e=t.get("_ko_property_writers"))&&e[i]&&e[i](n)}}}(),w.b("expressionRewriting",w.m),w.b("expressionRewriting.bindingRewriteValidators",w.m.Ra),w.b("expressionRewriting.parseObjectLiteral",w.m.ac),w.b("expressionRewriting.preProcessBindings",w.m.vb),w.b("expressionRewriting._twoWayBindings",w.m.wa),w.b("jsonExpressionRewriting",w.m),w.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",w.m.vb),function(){function e(e){return 8==e.nodeType&&s.test(o?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&a.test(o?e.text:e.nodeValue)}function n(i,n){for(var r=i,o=1,s=[];r=r.nextSibling;){if(t(r)&&(w.a.g.set(r,h,!0),0===--o))return s;s.push(r),e(r)&&o++}if(!n)throw Error("Cannot find closing comment tag to match: "+i.nodeValue);return null}function r(e,t){var i=n(e,t);return i?0<i.length?i[i.length-1].nextSibling:e.nextSibling:null}var o=i&&"\x3c!--test--\x3e"===i.createComment("test").text,s=o?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,a=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0},h="__ko_matchedEndComment__";w.h={ea:{},childNodes:function(t){return e(t)?n(t):t.childNodes},Ea:function(t){if(e(t))for(var i=0,n=(t=w.h.childNodes(t)).length;i<n;i++)w.removeNode(t[i]);else w.a.Tb(t)},va:function(t,i){if(e(t)){w.h.Ea(t);for(var n=t.nextSibling,r=0,o=i.length;r<o;r++)n.parentNode.insertBefore(i[r],n)}else w.a.va(t,i)},Vc:function(t,i){var n;e(t)?(n=t.nextSibling,t=t.parentNode):n=t.firstChild,n?i!==n&&t.insertBefore(i,n):t.appendChild(i)},Wb:function(t,i,n){n?(n=n.nextSibling,e(t)&&(t=t.parentNode),n?i!==n&&t.insertBefore(i,n):t.appendChild(i)):w.h.Vc(t,i)},firstChild:function(i){if(e(i))return!i.nextSibling||t(i.nextSibling)?null:i.nextSibling;if(i.firstChild&&t(i.firstChild))throw Error("Found invalid end comment, as the first child of "+i);return i.firstChild},nextSibling:function(i){if(e(i)&&(i=r(i)),i.nextSibling&&t(i.nextSibling)){var n=i.nextSibling;if(t(n)&&!w.a.g.get(n,h))throw Error("Found end comment without a matching opening comment, as child of "+i);return null}return i.nextSibling},Cd:e,Vd:function(e){return(e=(o?e.text:e.nodeValue).match(s))?e[1]:null},Sc:function(i){if(l[w.a.R(i)]){var n=i.firstChild;if(n)do{if(1===n.nodeType){var o,s=null;if(o=n.firstChild)do{if(s)s.push(o);else if(e(o)){var a=r(o,!0);a?o=a:s=[o]}else t(o)&&(s=[o])}while(o=o.nextSibling);if(o=s)for(s=n.nextSibling,a=0;a<o.length;a++)s?i.insertBefore(o[a],s):i.appendChild(o[a])}}while(n=n.nextSibling)}}}}(),w.b("virtualElements",w.h),w.b("virtualElements.allowedBindings",w.h.ea),w.b("virtualElements.emptyNode",w.h.Ea),w.b("virtualElements.insertAfter",w.h.Wb),w.b("virtualElements.prepend",w.h.Vc),w.b("virtualElements.setDomNodeChildren",w.h.va),w.ga=function(){this.nd={}},w.a.extend(w.ga.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||w.j.getComponentNameForNode(e);case 8:return w.h.Cd(e);default:return!1}},getBindings:function(e,t){var i=(i=this.getBindingsString(e,t))?this.parseBindingsString(i,t,e):null;return w.j.tc(i,e,t,!1)},getBindingAccessors:function(e,t){var i=(i=this.getBindingsString(e,t))?this.parseBindingsString(i,t,e,{valueAccessors:!0}):null;return w.j.tc(i,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return w.h.Vd(e);default:return null}},parseBindingsString:function(e,t,i,n){try{var r,o=this.nd,s=e+(n&&n.valueAccessors||"");if(!(r=o[s])){var a,l="with($context){with($data||{}){return{"+w.m.vb(e,n)+"}}}";a=new Function("$context","$element",l),r=o[s]=a}return r(t,i)}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}}}),w.ga.instance=new w.ga,w.b("bindingProvider",w.ga),function(){function n(e){var t=(e=w.a.g.get(e,x))&&e.N;t&&(e.N=null,t.Tc())}function r(e,t,i){this.node=e,this.yc=t,this.kb=[],this.H=!1,t.N||w.a.K.za(e,n),i&&i.N&&(i.N.kb.push(e),this.Kb=i)}function o(e){return function(){return e}}function a(e){return e()}function l(e){return w.a.Ga(w.u.G(e),function(t,i){return function(){return e()[i]}})}function h(e,t,i){return"function"==typeof e?l(e.bind(null,t,i)):w.a.Ga(e,o)}function u(e,t){return l(this.getBindings.bind(this,e,t))}function c(e,t){var i=w.h.firstChild(t);if(i){var n,r=w.ga.instance,o=r.preprocessNode;if(o){for(;n=i;)i=w.h.nextSibling(n),o.call(r,n);i=w.h.firstChild(t)}for(;n=i;)i=w.h.nextSibling(n),d(e,n)}w.i.ma(t,w.i.H)}function d(e,t){var i=e,n=1===t.nodeType;n&&w.h.Sc(t),(n||w.ga.instance.nodeHasBindings(t))&&(i=p(t,null,e).bindingContextForDescendants),i&&!v[w.a.R(t)]&&c(i,t)}function p(t,i,n){var r,o=w.a.g.Ub(t,x,{}),s=o.hd;if(!i){if(s)throw Error("You cannot apply bindings multiple times to the same element.");o.hd=!0}if(s||(o.context=n),o.Zb||(o.Zb={}),i&&"function"!=typeof i)r=i;else{var l=w.ga.instance,h=l.getBindingAccessors||u,c=w.$(function(){return(r=i?i(n,t):h.call(l,t,n))&&(n[g]&&n[g](),n[b]&&n[b]()),r},null,{l:t});r&&c.ja()||(c=null)}var d,p=n;if(r){var f=function(){return w.a.Ga(c?c():r,a)},m=c?function(e){return function(){return a(c()[e])}}:function(e){return r[e]};f.get=function(e){return r[e]&&a(m(e))},f.has=function(e){return e in r},w.i.H in r&&w.i.subscribe(t,w.i.H,function(){var e=(0,r[w.i.H])();if(e){var i=w.h.childNodes(t);i.length&&e(i,w.Ec(i[0]))}}),w.i.pa in r&&(p=w.i.Cb(t,n),w.i.subscribe(t,w.i.pa,function(){var e=(0,r[w.i.pa])();e&&w.h.firstChild(t)&&e(t)})),o=function(e){var t=[],i={},n=[];return w.a.P(e,function r(o){if(!i[o]){var s=w.getBindingHandler(o);s&&(s.after&&(n.push(o),w.a.D(s.after,function(t){if(e[t]){if(-1!==w.a.A(n,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+n.join(", "));r(t)}}),n.length--),t.push({key:o,Mc:s})),i[o]=!0}}),t}(r),w.a.D(o,function(i){var n=i.Mc.init,o=i.Mc.update,s=i.key;if(8===t.nodeType&&!w.h.ea[s])throw Error("The binding '"+s+"' cannot be used with virtual elements");try{"function"==typeof n&&w.u.G(function(){var i=n(t,m(s),f,p.$data,p);if(i&&i.controlsDescendantBindings){if(d!==e)throw Error("Multiple bindings ("+d+" and "+s+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");d=s}}),"function"==typeof o&&w.$(function(){o(t,m(s),f,p.$data,p)},null,{l:t})}catch(e){throw e.message='Unable to process binding "'+s+": "+r[s]+'"\nMessage: '+e.message,e}})}return{shouldBindDescendants:o=d===e,bindingContextForDescendants:o&&p}}function f(t,i){return t&&t instanceof w.fa?t:new w.fa(t,e,e,i)}var g=w.a.Da("_subscribable"),m=w.a.Da("_ancestorBindingInfo"),b=w.a.Da("_dataDependency");w.c={};var v={script:!0,textarea:!0,template:!0};w.getBindingHandler=function(e){return w.c[e]};var y={};w.fa=function(t,i,n,r,o){function s(){var e=c?u():u,t=w.a.f(e);return i?(w.a.extend(l,i),m in i&&(l[m]=i[m])):(l.$parents=[],l.$root=t,l.ko=w),l[g]=a,h?t=l.$data:(l.$rawData=e,l.$data=t),n&&(l[n]=t),r&&r(l,i,t),i&&i[g]&&!w.S.o().Vb(i[g])&&i[g](),d&&(l[b]=d),l.$data}var a,l=this,h=t===y,u=h?e:t,c="function"==typeof u&&!w.O(u),d=o&&o.dataDependency;o&&o.exportDependencies?s():((a=w.xb(s)).v(),a.ja()?a.equalityComparer=null:l[g]=e)},w.fa.prototype.createChildContext=function(e,t,i,n){if(!n&&t&&"object"==typeof t&&(t=(n=t).as,i=n.extend),t&&n&&n.noChildContext){var r="function"==typeof e&&!w.O(e);return new w.fa(y,this,null,function(n){i&&i(n),n[t]=r?e():e},n)}return new w.fa(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),i&&i(e)},n)},w.fa.prototype.extend=function(e,t){return new w.fa(y,this,null,function(t){w.a.extend(t,"function"==typeof e?e(t):e)},t)};var x=w.a.g.Z();r.prototype.Tc=function(){this.Kb&&this.Kb.N&&this.Kb.N.sd(this.node)},r.prototype.sd=function(e){w.a.Pa(this.kb,e),!this.kb.length&&this.H&&this.Cc()},r.prototype.Cc=function(){this.H=!0,this.yc.N&&!this.kb.length&&(this.yc.N=null,w.a.K.yb(this.node,n),w.i.ma(this.node,w.i.pa),this.Tc())},w.i={H:"childrenComplete",pa:"descendantsComplete",subscribe:function(e,t,i,n,r){var o=w.a.g.Ub(e,x,{});return o.Fa||(o.Fa=new w.T),r&&r.notifyImmediately&&o.Zb[t]&&w.u.G(i,n,[e]),o.Fa.subscribe(i,n,t)},ma:function(t,i){var n=w.a.g.get(t,x);if(n&&(n.Zb[i]=!0,n.Fa&&n.Fa.notifySubscribers(t,i),i==w.i.H))if(n.N)n.N.Cc();else if(n.N===e&&n.Fa&&n.Fa.Wa(w.i.pa))throw Error("descendantsComplete event not supported for bindings on this node")},Cb:function(e,t){var i=w.a.g.Ub(e,x,{});return i.N||(i.N=new r(e,i,t[m])),t[m]==i?t:t.extend(function(e){e[m]=i})}},w.Td=function(e){return(e=w.a.g.get(e,x))&&e.context},w.ib=function(e,t,i){return 1===e.nodeType&&w.h.Sc(e),p(e,t,f(i))},w.ld=function(e,t,i){return i=f(i),w.ib(e,h(t,i,e),i)},w.Oa=function(e,t){1!==t.nodeType&&8!==t.nodeType||c(f(e),t)},w.vc=function(e,n,r){if(!s&&t.jQuery&&(s=t.jQuery),2>arguments.length){if(!(n=i.body))throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!n||1!==n.nodeType&&8!==n.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");d(f(e,r),n)},w.Dc=function(t){return!t||1!==t.nodeType&&8!==t.nodeType?e:w.Td(t)},w.Ec=function(t){return(t=w.Dc(t))?t.$data:e},w.b("bindingHandlers",w.c),w.b("bindingEvent",w.i),w.b("bindingEvent.subscribe",w.i.subscribe),w.b("bindingEvent.startPossiblyAsyncContentBinding",w.i.Cb),w.b("applyBindings",w.vc),w.b("applyBindingsToDescendants",w.Oa),w.b("applyBindingAccessorsToNode",w.ib),w.b("applyBindingsToNode",w.ld),w.b("contextFor",w.Dc),w.b("dataFor",w.Ec)}(),function(e){function t(t,n){var s,a=Object.prototype.hasOwnProperty.call(r,t)?r[t]:e;a?a.subscribe(n):((a=r[t]=new w.T).subscribe(n),i(t,function(e,i){var n=!(!i||!i.synchronous);o[t]={definition:e,Gd:n},delete r[t],s||n?a.notifySubscribers(e):w.na.zb(function(){a.notifySubscribers(e)})}),s=!0)}function i(e,t){n("getConfig",[e],function(i){i?n("loadComponent",[e,i],function(e){t(e,i)}):t(null,null)})}function n(t,i,r,o){o||(o=w.j.loaders.slice(0));var s=o.shift();if(s){var a=s[t];if(a){var l=!1;if(a.apply(s,i.concat(function(e){l?r(null):null!==e?r(e):n(t,i,r,o)}))!==e&&(l=!0,!s.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else n(t,i,r,o)}else r(null)}var r={},o={};w.j={get:function(i,n){var r=Object.prototype.hasOwnProperty.call(o,i)?o[i]:e;r?r.Gd?w.u.G(function(){n(r.definition)}):w.na.zb(function(){n(r.definition)}):t(i,n)},Bc:function(e){delete o[e]},oc:n},w.j.loaders=[],w.b("components",w.j),w.b("components.get",w.j.get),w.b("components.clearCachedDefinition",w.j.Bc)}(),function(){function e(e,t,i,n){function r(){0===--s&&n(o)}var o={},s=2,l=i.template;i=i.viewModel,l?a(t,l,function(t){w.j.oc("loadTemplate",[e,t],function(e){o.template=e,r()})}):r(),i?a(t,i,function(t){w.j.oc("loadViewModel",[e,t],function(e){o[u]=e,r()})}):r()}function n(e,t,i){if("function"==typeof t)i(function(e){return new t(e)});else if("function"==typeof t[u])i(t[u]);else if("instance"in t){var r=t.instance;i(function(){return r})}else"viewModel"in t?n(e,t.viewModel,i):e("Unknown viewModel value: "+t)}function r(e){switch(w.a.R(e)){case"script":return w.a.ua(e.text);case"textarea":return w.a.ua(e.value);case"template":if(s(e.content))return w.a.Ca(e.content.childNodes)}return w.a.Ca(e.childNodes)}function s(e){return t.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function a(e,i,n){"string"==typeof i.require?o||t.require?(o||t.require)([i.require],function(e){e&&"object"==typeof e&&e.Xd&&e.default&&(e=e.default),n(e)}):e("Uses require, but no AMD loader is present"):n(i)}function l(e){return function(t){throw Error("Component '"+e+"': "+t)}}var h={};w.j.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(w.j.tb(e))throw Error("Component "+e+" is already registered");h[e]=t},w.j.tb=function(e){return Object.prototype.hasOwnProperty.call(h,e)},w.j.unregister=function(e){delete h[e],w.j.Bc(e)},w.j.Fc={getConfig:function(e,t){t(w.j.tb(e)?h[e]:null)},loadComponent:function(t,i,n){var r=l(t);a(r,i,function(i){e(t,r,i,n)})},loadTemplate:function(e,n,o){if(e=l(e),"string"==typeof n)o(w.a.ua(n));else if(n instanceof Array)o(n);else if(s(n))o(w.a.la(n.childNodes));else if(n.element)if(n=n.element,t.HTMLElement?n instanceof HTMLElement:n&&n.tagName&&1===n.nodeType)o(r(n));else if("string"==typeof n){var a=i.getElementById(n);a?o(r(a)):e("Cannot find element with ID "+n)}else e("Unknown element type: "+n);else e("Unknown template value: "+n)},loadViewModel:function(e,t,i){n(l(e),t,i)}};var u="createViewModel";w.b("components.register",w.j.register),w.b("components.isRegistered",w.j.tb),w.b("components.unregister",w.j.unregister),w.b("components.defaultLoader",w.j.Fc),w.j.loaders.push(w.j.Fc),w.j.dd=h}(),function(){function e(e,i){if(n=e.getAttribute("params")){var n=t.parseBindingsString(n,i,e,{valueAccessors:!0,bindingParams:!0}),r=(n=w.a.Ga(n,function(t){return w.o(t,null,{l:e})}),w.a.Ga(n,function(t){var i=t.v();return t.ja()?w.o({read:function(){return w.a.f(t())},write:w.Za(i)&&function(e){t()(e)},l:e}):i}));return Object.prototype.hasOwnProperty.call(r,"$raw")||(r.$raw=n),r}return{$raw:{}}}w.j.getComponentNameForNode=function(e){var t=w.a.R(e);if(w.j.tb(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=w.a.W&&e.tagName===t))return t},w.j.tc=function(t,i,n,r){if(1===i.nodeType){var o=w.j.getComponentNameForNode(i);if(o){if((t=t||{}).component)throw Error('Cannot use the "component" binding on a custom element matching a component');var s={name:o,params:e(i,n)};t.component=r?function(){return s}:s}}return t};var t=new w.ga;9>w.a.W&&(w.j.register=function(e){return function(t){return e.apply(this,arguments)}}(w.j.register),i.createDocumentFragment=function(e){return function(){var t=e();return w.j.dd,t}}(i.createDocumentFragment))}(),function(){var e=0;w.c.component={init:function(t,i,n,r,o){function s(){var e=a&&a.dispose;"function"==typeof e&&e.call(a),h&&h.s(),l=a=h=null}var a,l,h,u=w.a.la(w.h.childNodes(t));return w.h.Ea(t),w.a.K.za(t,s),w.o(function(){var n,r,c=w.a.f(i());if("string"==typeof c?n=c:(n=w.a.f(c.name),r=w.a.f(c.params)),!n)throw Error("No component name specified");var d=w.i.Cb(t,o),p=l=++e;w.j.get(n,function(e){if(l===p){if(s(),!e)throw Error("Unknown component '"+n+"'");!function(e,t,i){if(!(t=t.template))throw Error("Component '"+e+"' has no template");e=w.a.Ca(t),w.h.va(i,e)}(n,e,t);var i=function(e,t,i){var n=e.createViewModel;return n?n.call(e,t,i):t}(e,r,{element:t,templateNodes:u});e=d.createChildContext(i,{extend:function(e){e.$component=i,e.$componentTemplateNodes=u}}),i&&i.koDescendantsComplete&&(h=w.i.subscribe(t,w.i.pa,i.koDescendantsComplete,i)),a=i,w.Oa(e,t)}})},null,{l:t}),{controlsDescendantBindings:!0}}},w.h.ea.component=!0}();var _={class:"className",for:"htmlFor"};w.c.attr={update:function(t,i){var n=w.a.f(i())||{};w.a.P(n,function(i,n){n=w.a.f(n);var r=i.indexOf(":"),o=(r="lookupNamespaceURI"in t&&0<r&&t.lookupNamespaceURI(i.substr(0,r)),!1===n||null===n||n===e);o?r?t.removeAttributeNS(r,i):t.removeAttribute(i):n=n.toString(),8>=w.a.W&&i in _?(i=_[i],o?t.removeAttribute(i):t[i]=n):o||(r?t.setAttributeNS(r,i,n):t.setAttribute(i,n)),"name"===i&&w.a.Yc(t,o?"":n)})}},w.c.checked={after:["value","attr"],init:function(t,i,n){function r(){var r=t.checked,l=o();if(!w.S.Ya()&&(r||!a&&!w.S.qa())){var c=w.u.G(i);if(h){var p=u?c.v():c,f=d;d=l,f!==l?r&&(w.a.Na(p,l,!0),w.a.Na(p,f,!1)):w.a.Na(p,l,r),u&&w.Za(c)&&c(p)}else s&&(l===e?l=r:r||(l=e)),w.m.eb(c,n,"checked",l,!0)}}var o=w.xb(function(){return n.has("checkedValue")?w.a.f(n.get("checkedValue")):c?n.has("value")?w.a.f(n.get("value")):t.value:void 0}),s="checkbox"==t.type,a="radio"==t.type;if(s||a){var l=i(),h=s&&w.a.f(l)instanceof Array,u=!(h&&l.push&&l.splice),c=a||h,d=h?o():e;a&&!t.name&&w.c.uniqueName.init(t,function(){return!0}),w.o(r,null,{l:t}),w.a.B(t,"click",r),w.o(function(){var n=w.a.f(i()),r=o();h?(t.checked=0<=w.a.A(n,r),d=r):t.checked=s&&r===e?!!n:o()===n},null,{l:t}),l=e}}},w.m.wa.checked=!0,w.c.checkedValue={update:function(e,t){e.value=w.a.f(t())}},w.c.class={update:function(e,t){var i=w.a.Db(w.a.f(t()));w.a.Eb(e,e.__ko__cssValue,!1),e.__ko__cssValue=i,w.a.Eb(e,i,!0)}},w.c.css={update:function(e,t){var i=w.a.f(t());null!==i&&"object"==typeof i?w.a.P(i,function(t,i){i=w.a.f(i),w.a.Eb(e,t,i)}):w.c.class.update(e,t)}},w.c.enable={update:function(e,t){var i=w.a.f(t());i&&e.disabled?e.removeAttribute("disabled"):i||e.disabled||(e.disabled=!0)}},w.c.disable={update:function(e,t){w.c.enable.update(e,function(){return!w.a.f(t())})}},w.c.event={init:function(e,t,i,n,r){var o=t()||{};w.a.P(o,function(o){"string"==typeof o&&w.a.B(e,o,function(e){var s,a=t()[o];if(a){try{var l=w.a.la(arguments);n=r.$data,l.unshift(n),s=a.apply(n,l)}finally{!0!==s&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===i.get(o+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},w.c.foreach={Rc:function(e){return function(){var t=e(),i=w.a.bc(t);return i&&"number"!=typeof i.length?(w.a.f(t),{foreach:i.data,as:i.as,noChildContext:i.noChildContext,includeDestroyed:i.includeDestroyed,afterAdd:i.afterAdd,beforeRemove:i.beforeRemove,afterRender:i.afterRender,beforeMove:i.beforeMove,afterMove:i.afterMove,templateEngine:w.ba.Ma}):{foreach:t,templateEngine:w.ba.Ma}}},init:function(e,t){return w.c.template.init(e,w.c.foreach.Rc(t))},update:function(e,t,i,n,r){return w.c.template.update(e,w.c.foreach.Rc(t),i,n,r)}},w.m.Ra.foreach=!1,w.h.ea.foreach=!0,w.c.hasfocus={init:function(e,t,i){function n(n){e.__ko_hasfocusUpdating=!0;var r=e.ownerDocument;if("activeElement"in r){var o;try{o=r.activeElement}catch(e){o=r.body}n=o===e}r=t(),w.m.eb(r,i,"hasfocus",n,!0),e.__ko_hasfocusLastValue=n,e.__ko_hasfocusUpdating=!1}var r=n.bind(null,!0),o=n.bind(null,!1);w.a.B(e,"focus",r),w.a.B(e,"focusin",r),w.a.B(e,"blur",o),w.a.B(e,"focusout",o),e.__ko_hasfocusLastValue=!1},update:function(e,t){var i=!!w.a.f(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===i||(i?e.focus():e.blur(),!i&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),w.u.G(w.a.Fb,null,[e,i?"focusin":"focusout"]))}},w.m.wa.hasfocus=!0,w.c.hasFocus=w.c.hasfocus,w.m.wa.hasFocus="hasfocus",w.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){w.a.fc(e,t())}},function(){function e(e,t,i){w.c[e]={init:function(e,n,r,o,s){var a,l,h,u,c,d={};if(t){o=r.get("as");var p=r.get("noChildContext");d={as:o,noChildContext:p,exportDependencies:c=!(o&&p)}}return u=(h="render"==r.get("completeOn"))||r.has(w.i.pa),w.o(function(){var r,o=w.a.f(n()),p=!i!=!o,f=!l;(c||p!==a)&&(u&&(s=w.i.Cb(e,s)),p&&(t&&!c||(d.dataDependency=w.S.o()),r=t?s.createChildContext("function"==typeof o?o:n,d):w.S.qa()?s.extend(null,d):s),f&&w.S.qa()&&(l=w.a.Ca(w.h.childNodes(e),!0)),p?(f||w.h.va(e,w.a.Ca(l)),w.Oa(r,e)):(w.h.Ea(e),h||w.i.ma(e,w.i.H)),a=p)},null,{l:e}),{controlsDescendantBindings:!0}}},w.m.Ra[e]=!1,w.h.ea[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)}(),w.c.let={init:function(e,t,i,n,r){return t=r.extend(t),w.Oa(t,e),{controlsDescendantBindings:!0}}},w.h.ea.let=!0;var R={};w.c.options={init:function(e){if("select"!==w.a.R(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,n){function r(){return w.a.jb(t.options,function(e){return e.selected})}function o(e,t,i){var n=typeof t;return"function"==n?t(e):"string"==n?e[t]:i}function s(e,i){if(f&&u)w.i.ma(t,w.i.H);else if(p.length){var n=0<=w.a.A(p,w.w.M(i[0]));w.a.Zc(i[0],n),f&&!n&&w.u.G(w.a.Fb,null,[t,"change"])}}var a=t.multiple,l=0!=t.length&&a?t.scrollTop:null,h=w.a.f(i()),u=n.get("valueAllowUnset")&&n.has("value"),c=n.get("optionsIncludeDestroyed");i={};var d,p=[];u||(a?p=w.a.Mb(r(),w.w.M):0<=t.selectedIndex&&p.push(w.w.M(t.options[t.selectedIndex]))),h&&(void 0===h.length&&(h=[h]),d=w.a.jb(h,function(t){return c||t===e||null===t||!w.a.f(t._destroy)}),n.has("optionsCaption")&&null!==(h=w.a.f(n.get("optionsCaption")))&&h!==e&&d.unshift(R));var f=!1;i.beforeRemove=function(e){t.removeChild(e)},h=s,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(h=function(t,i){s(0,i),w.u.G(n.get("optionsAfterRender"),null,[i[0],t!==R?t:e])}),w.a.ec(t,d,function(i,r,s){return s.length&&(p=!u&&s[0].selected?[w.w.M(s[0])]:[],f=!0),r=t.ownerDocument.createElement("option"),i===R?(w.a.Bb(r,n.get("optionsCaption")),w.w.cb(r,e)):(s=o(i,n.get("optionsValue"),i),w.w.cb(r,w.a.f(s)),i=o(i,n.get("optionsText"),s),w.a.Bb(r,i)),[r]},i,h),u||(a?p.length&&r().length<p.length:p.length&&0<=t.selectedIndex?w.w.M(t.options[t.selectedIndex])!==p[0]:p.length||0<=t.selectedIndex)&&w.u.G(w.a.Fb,null,[t,"change"]),(u||w.S.Ya())&&w.i.ma(t,w.i.H),w.a.wd(t),l&&20<Math.abs(l-t.scrollTop)&&(t.scrollTop=l)}},w.c.options.$b=w.a.g.Z(),w.c.selectedOptions={init:function(e,t,i){function n(){var n=t(),r=[];w.a.D(e.getElementsByTagName("option"),function(e){e.selected&&r.push(w.w.M(e))}),w.m.eb(n,i,"selectedOptions",r)}function r(){var i=w.a.f(t()),n=e.scrollTop;i&&"number"==typeof i.length&&w.a.D(e.getElementsByTagName("option"),function(e){var t=0<=w.a.A(i,w.w.M(e));e.selected!=t&&w.a.Zc(e,t)}),e.scrollTop=n}if("select"!=w.a.R(e))throw Error("selectedOptions binding applies only to SELECT elements");var o;w.i.subscribe(e,w.i.H,function(){o?n():(w.a.B(e,"change",n),o=w.o(r,null,{l:e}))},null,{notifyImmediately:!0})},update:function(){}},w.m.wa.selectedOptions=!0,w.c.style={update:function(t,i){var n=w.a.f(i()||{});w.a.P(n,function(i,n){if(null!==(n=w.a.f(n))&&n!==e&&!1!==n||(n=""),s)s(t).css(i,n);else if(/^--/.test(i))t.style.setProperty(i,n);else{i=i.replace(/-(\w)/g,function(e,t){return t.toUpperCase()});var r=t.style[i];t.style[i]=n,n===r||t.style[i]!=r||isNaN(n)||(t.style[i]=n+"px")}})}},w.c.submit={init:function(e,t,i,n,r){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");w.a.B(e,"submit",function(i){var n,o=t();try{n=o.call(r.$data,e)}finally{!0!==n&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}})}},w.c.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){w.a.Bb(e,t())}},w.h.ea.text=!0,function(){if(t&&t.navigator){var i,n,r,o,s,a=function(e){if(e)return parseFloat(e[1])},l=t.navigator.userAgent;(i=t.opera&&t.opera.version&&parseInt(t.opera.version()))||(s=a(l.match(/Edge\/([^ ]+)$/)))||a(l.match(/Chrome\/([^ ]+)/))||(n=a(l.match(/Version\/([^ ]+) Safari/)))||(r=a(l.match(/Firefox\/([^ ]+)/)))||(o=w.a.W||a(l.match(/MSIE ([^ ]+)/)))||(o=a(l.match(/rv:([^ )]+)/)))}if(8<=o&&10>o)var h=w.a.g.Z(),u=w.a.g.Z(),c=function(e){var t=this.activeElement;(t=t&&w.a.g.get(t,u))&&t(e)},d=function(e,t){var i=e.ownerDocument;w.a.g.get(i,h)||(w.a.g.set(i,h,!0),w.a.B(i,"selectionchange",c)),w.a.g.set(e,u,t)};w.c.textInput={init:function(t,a,l){function h(e,i){w.a.B(t,e,i)}function u(){p||(f=t.value,p=w.a.setTimeout(c,4))}function c(){clearTimeout(p),f=p=e;var i=t.value;g!==i&&(g=i,w.m.eb(a(),l,"textInput",i))}var p,f,g=t.value,m=9==w.a.W?u:c,b=!1;o&&h("keypress",c),11>o&&h("propertychange",function(e){b||"value"!==e.propertyName||m()}),8==o&&(h("keyup",c),h("keydown",c)),d&&(d(t,m),h("dragend",u)),(!o||9<=o)&&h("input",m),5>n&&"textarea"===w.a.R(t)?(h("keydown",u),h("paste",u),h("cut",u)):11>i?h("keydown",u):4>r?(h("DOMAutoComplete",c),h("dragdrop",c),h("drop",c)):s&&"number"===t.type&&h("keydown",u),h("change",c),h("blur",c),w.o(function i(){var n=w.a.f(a());null!==n&&n!==e||(n=""),f!==e&&n===f?w.a.setTimeout(i,4):t.value!==n&&(b=!0,t.value=n,b=!1,g=t.value)},null,{l:t})}},w.m.wa.textInput=!0,w.c.textinput={preprocess:function(e,t,i){i("textInput",e)}}}(),w.c.uniqueName={init:function(e,t){if(t()){var i="ko_unique_"+ ++w.c.uniqueName.rd;w.a.Yc(e,i)}}},w.c.uniqueName.rd=0,w.c.using={init:function(e,t,i,n,r){var o;return i.has("as")&&(o={as:i.get("as"),noChildContext:i.get("noChildContext")}),t=r.createChildContext(t,o),w.Oa(t,e),{controlsDescendantBindings:!0}}},w.h.ea.using=!0,w.c.value={init:function(t,i,n){var r=w.a.R(t),o="input"==r;if(!o||"checkbox"!=t.type&&"radio"!=t.type){var s=[],a=n.get("valueUpdate"),l=!1,h=null;a&&(s="string"==typeof a?[a]:w.a.wc(a),w.a.Pa(s,"change"));var u,c,d=function(){h=null,l=!1;var e=i(),r=w.w.M(t);w.m.eb(e,n,"value",r)};!w.a.W||!o||"text"!=t.type||"off"==t.autocomplete||t.form&&"off"==t.form.autocomplete||-1!=w.a.A(s,"propertychange")||(w.a.B(t,"propertychange",function(){l=!0}),w.a.B(t,"focus",function(){l=!1}),w.a.B(t,"blur",function(){l&&d()})),w.a.D(s,function(e){var i=d;w.a.Ud(e,"after")&&(i=function(){h=w.w.M(t),w.a.setTimeout(d,0)},e=e.substring(5)),w.a.B(t,e,i)}),u=o&&"file"==t.type?function(){var n=w.a.f(i());null===n||n===e||""===n?t.value="":w.u.G(d)}:function(){var o=w.a.f(i()),s=w.w.M(t);null!==h&&o===h?w.a.setTimeout(u,0):o===s&&s!==e||("select"===r?(s=n.get("valueAllowUnset"),w.w.cb(t,o,s),s||o===w.w.M(t)||w.u.G(d)):w.w.cb(t,o))},"select"===r?w.i.subscribe(t,w.i.H,function(){c?n.get("valueAllowUnset")?u():d():(w.a.B(t,"change",d),c=w.o(u,null,{l:t}))},null,{notifyImmediately:!0}):(w.a.B(t,"change",d),w.o(u,null,{l:t}))}else w.ib(t,{checkedValue:i})},update:function(){}},w.m.wa.value=!0,w.c.visible={update:function(e,t){var i=w.a.f(t()),n="none"!=e.style.display;i&&!n?e.style.display="":!i&&n&&(e.style.display="none")}},w.c.hidden={update:function(e,t){w.c.visible.update(e,function(){return!w.a.f(t())})}},function(e){w.c[e]={init:function(t,i,n,r,o){return w.c.event.init.call(this,t,function(){var t={};return t[e]=i(),t},n,r,o)}}}("click"),w.ca=function(){},w.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},w.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},w.ca.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){var n=(t=t||i).getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new w.C.F(n)}if(1==e.nodeType||8==e.nodeType)return new w.C.ia(e);throw Error("Unknown template type: "+e)},w.ca.prototype.renderTemplate=function(e,t,i,n){return e=this.makeTemplateSource(e,n),this.renderTemplateSource(e,t,i,n)},w.ca.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},w.ca.prototype.rewriteTemplate=function(e,t,i){t=t((e=this.makeTemplateSource(e,i)).text()),e.text(t),e.data("isRewritten",!0)},w.b("templateEngine",w.ca),w.kc=function(){function e(e,t,i,n){e=w.m.ac(e);for(var r=w.m.Ra,o=0;o<e.length;o++){var s=e[o].key;if(Object.prototype.hasOwnProperty.call(r,s)){var a=r[s];if("function"==typeof a){if(s=a(e[o].value))throw Error(s)}else if(!a)throw Error("This template engine does not support the '"+s+"' binding within its templates")}}return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+w.m.vb(e,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",n.createJavaScriptEvaluatorBlock(i)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{xd:function(e,t,i){t.isTemplateRewritten(e,i)||t.rewriteTemplate(e,function(e){return w.kc.Ld(e,t)},i)},Ld:function(n,r){return n.replace(t,function(t,i,n,o,s){return e(s,i,n,r)}).replace(i,function(t,i){return e(i,"\x3c!-- ko --\x3e","#comment",r)})},md:function(e,t){return w.aa.Xb(function(i,n){var r=i.nextSibling;r&&r.nodeName.toLowerCase()===t&&w.ib(r,e,n)})}}}(),w.b("__tr_ambtns",w.kc.md),function(){w.C={},w.C.F=function(e){if(this.F=e){var t=w.a.R(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},w.C.F.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.F[e];var t=arguments[0];"innerHTML"===e?w.a.fc(this.F,t):this.F[e]=t};var t=w.a.g.Z()+"_";w.C.F.prototype.data=function(e){if(1===arguments.length)return w.a.g.get(this.F,t+e);w.a.g.set(this.F,t+e,arguments[1])};var i=w.a.g.Z();w.C.F.prototype.nodes=function(){var t=this.F;if(0==arguments.length){var n=w.a.g.get(t,i)||{},r=n.lb||(3===this.ab?t.content:4===this.ab?t:e);if(!r||n.jd){var o=this.text();o&&o!==n.bb&&(r=w.a.Md(o,t.ownerDocument),w.a.g.set(t,i,{lb:r,bb:o,jd:!0}))}return r}n=arguments[0],this.ab!==e&&this.text(""),w.a.g.set(t,i,{lb:n})},w.C.ia=function(e){this.F=e},w.C.ia.prototype=new w.C.F,w.C.ia.prototype.constructor=w.C.ia,w.C.ia.prototype.text=function(){if(0==arguments.length){var t=w.a.g.get(this.F,i)||{};return t.bb===e&&t.lb&&(t.bb=t.lb.innerHTML),t.bb}w.a.g.set(this.F,i,{bb:arguments[0]})},w.b("templateSources",w.C),w.b("templateSources.domElement",w.C.F),w.b("templateSources.anonymousTemplate",w.C.ia)}(),function(){function t(e,t,i){var n;for(t=w.h.nextSibling(t);e&&(n=e)!==t;)i(n,e=w.h.nextSibling(n))}function i(e,i){if(e.length){var n=e[0],r=e[e.length-1],o=n.parentNode,s=w.ga.instance,a=s.preprocessNode;if(a){if(t(n,r,function(e,t){var i=e.previousSibling,o=a.call(s,e);o&&(e===n&&(n=o[0]||t),e===r&&(r=o[o.length-1]||i))}),e.length=0,!n)return;n===r?e.push(n):(e.push(n,r),w.a.Ua(e,o))}t(n,r,function(e){1!==e.nodeType&&8!==e.nodeType||w.vc(i,e)}),t(n,r,function(e){1!==e.nodeType&&8!==e.nodeType||w.aa.cd(e,[i])}),w.a.Ua(e,o)}}function n(e){return e.nodeType?e:0<e.length?e[0]:null}function r(e,t,r,o,a){a=a||{};var l=(e&&n(e)||r||{}).ownerDocument,h=a.templateEngine||s;if(w.kc.xd(r,h,l),"number"!=typeof(r=h.renderTemplate(r,o,a,l)).length||0<r.length&&"number"!=typeof r[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(l=!1,t){case"replaceChildren":w.h.va(e,r),l=!0;break;case"replaceNode":w.a.Xc(e,r),l=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return l&&(i(r,o),a.afterRender&&w.u.G(a.afterRender,null,[r,o[a.as||"$data"]]),"replaceChildren"==t&&w.i.ma(e,w.i.H)),r}function o(e,t,i){return w.O(e)?e():"function"==typeof e?e(t,i):e}var s;w.gc=function(t){if(t!=e&&!(t instanceof w.ca))throw Error("templateEngine must inherit from ko.templateEngine");s=t},w.dc=function(t,i,a,l,h){if(((a=a||{}).templateEngine||s)==e)throw Error("Set a template engine before calling renderTemplate");if(h=h||"replaceChildren",l){var u=n(l);return w.$(function(){var e=i&&i instanceof w.fa?i:new w.fa(i,null,null,null,{exportDependencies:!0}),s=o(t,e.$data,e);e=r(l,h,s,e,a),"replaceNode"==h&&(u=n(l=e))},null,{Sa:function(){return!u||!w.a.Sb(u)},l:u&&"replaceNode"==h?u.parentNode:u})}return w.aa.Xb(function(e){w.dc(t,i,a,e,"replaceNode")})},w.Qd=function(t,n,s,a,l){function h(e,t){w.u.G(w.a.ec,null,[a,e,c,s,u,t]),w.i.ma(a,w.i.H)}function u(e,t){i(t,d),s.afterRender&&s.afterRender(t,e),d=null}function c(e,i){d=l.createChildContext(e,{as:p,noChildContext:s.noChildContext,extend:function(e){e.$index=i,p&&(e[p+"Index"]=i)}});var n=o(t,e,d);return r(a,"ignoreTargetNode",n,d,s)}var d,p=s.as,f=!1===s.includeDestroyed||w.options.foreachHidesDestroyed&&!s.includeDestroyed;if(f||s.beforeRemove||!w.Pc(n))return w.$(function(){var t=w.a.f(n)||[];void 0===t.length&&(t=[t]),f&&(t=w.a.jb(t,function(t){return t===e||null===t||!w.a.f(t._destroy)})),h(t)},null,{l:a});h(n.v());var g=n.subscribe(function(e){h(n(),e)},null,"arrayChange");return g.l(a),g};var a=w.a.g.Z(),l=w.a.g.Z();w.c.template={init:function(e,t){var i=w.a.f(t());if("string"==typeof i||"name"in i)w.h.Ea(e);else if("nodes"in i){if(i=i.nodes||[],w.O(i))throw Error('The "nodes" option must be a plain, non-observable array.');var n=i[0]&&i[0].parentNode;n&&w.a.g.get(n,l)||(n=w.a.Yb(i),w.a.g.set(n,l,!0)),new w.C.ia(e).nodes(n)}else{if(!(0<(i=w.h.childNodes(e)).length))throw Error("Anonymous template defined, but no template content was provided");n=w.a.Yb(i),new w.C.ia(e).nodes(n)}return{controlsDescendantBindings:!0}},update:function(t,i,n,r,o){var s=i();n=!0,r=null,"string"==typeof(i=w.a.f(s))?i={}:(s="name"in i?i.name:t,"if"in i&&(n=w.a.f(i.if)),n&&"ifnot"in i&&(n=!w.a.f(i.ifnot)),n&&!s&&(n=!1)),"foreach"in i?r=w.Qd(s,n&&i.foreach||[],i,t,o):n?(n=o,"data"in i&&(n=o.createChildContext(i.data,{as:i.as,noChildContext:i.noChildContext,exportDependencies:!0})),r=w.dc(s,n,i,t)):w.h.Ea(t),o=r,(i=w.a.g.get(t,a))&&"function"==typeof i.s&&i.s(),w.a.g.set(t,a,!o||o.ja&&!o.ja()?e:o)}},w.m.Ra.template=function(e){return 1==(e=w.m.ac(e)).length&&e[0].unknown||w.m.Id(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},w.h.ea.template=!0}(),w.b("setTemplateEngine",w.gc),w.b("renderTemplate",w.dc),w.a.Kc=function(e,t,i){var n,r,o,s,a;if(e.length&&t.length)for(n=r=0;(!i||n<i)&&(s=e[r]);++r){for(o=0;a=t[o];++o)if(s.value===a.value){s.moved=a.index,a.moved=s.index,t.splice(o,1),n=o=0;break}n+=o}},w.a.Pb=function(){function e(e,t,i,n,r){var o,s,a,l,h,u=Math.min,c=Math.max,d=[],p=e.length,f=t.length,g=f-p||1,m=p+f+1;for(o=0;o<=p;o++)for(l=a,d.push(a=[]),h=u(f,o+g),s=c(0,o-1);s<=h;s++)a[s]=s?o?e[o-1]===t[s-1]?l[s-1]:u(l[s]||m,a[s-1]||m)+1:s+1:o+1;for(u=[],c=[],g=[],o=p,s=f;o||s;)f=d[o][s]-1,s&&f===d[o][s-1]?c.push(u[u.length]={status:i,value:t[--s],index:s}):o&&f===d[o-1][s]?g.push(u[u.length]={status:n,value:e[--o],index:o}):(--s,--o,r.sparse||u.push({status:"retained",value:t[s]}));return w.a.Kc(g,c,!r.dontLimitMoves&&10*p),u.reverse()}return function(t,i,n){return n="boolean"==typeof n?{dontLimitMoves:n}:n||{},i=i||[],(t=t||[]).length<i.length?e(t,i,"added","deleted",n):e(i,t,"deleted","added",n)}}(),w.b("utils.compareArrays",w.a.Pb),function(){function t(t,i,n,r,o){var s=[],a=w.$(function(){var e=i(n,o,w.a.Ua(s,t))||[];0<s.length&&(w.a.Xc(s,e),r&&w.u.G(r,null,[n,e,o])),s.length=0,w.a.Nb(s,e)},null,{l:t,Sa:function(){return!w.a.kd(s)}});return{Y:s,$:a.ja()?a:e}}var i=w.a.g.Z(),n=w.a.g.Z();w.a.ec=function(r,o,s,a,l,h){function u(e){p={Aa:e,pb:w.ta(S++)},y.push(p),v||N.push(p)}function c(e){p=b[e],S!==p.pb.v()&&P.push(p),p.pb(S++),w.a.Ua(p.Y,r),y.push(p)}function d(e,t){if(e)for(var i=0,n=t.length;i<n;i++)w.a.D(t[i].Y,function(n){e(n,i,t[i].Aa)})}void 0===(o=o||[]).length&&(o=[o]),a=a||{};var p,f,g,m,b=w.a.g.get(r,i),v=!b,y=[],x=0,S=0,C=[],k=[],E=[],P=[],N=[],T=0;if(v)w.a.D(o,u);else{if(!h||b&&b._countWaitingForRemove){var I=w.a.Mb(b,function(e){return e.Aa});h=w.a.Pb(I,o,{dontLimitMoves:a.dontLimitMoves,sparse:!0})}var A,_,R;for(I=0;A=h[I];I++)switch(_=A.moved,R=A.index,A.status){case"deleted":for(;x<R;)c(x++);_===e&&((p=b[x]).$&&(p.$.s(),p.$=e),w.a.Ua(p.Y,r).length&&(a.beforeRemove&&(y.push(p),T++,p.Aa===n?p=null:E.push(p)),p&&C.push.apply(C,p.Y))),x++;break;case"added":for(;S<R;)c(x++);_!==e?(k.push(y.length),c(_)):u(A.value)}for(;S<o.length;)c(x++);y._countWaitingForRemove=T}w.a.g.set(r,i,y),d(a.beforeMove,P),w.a.D(C,a.beforeRemove?w.oa:w.removeNode);try{m=r.ownerDocument.activeElement}catch(e){}if(k.length)for(;(I=k.shift())!=e;){for(p=y[I],f=e;I;)if((g=y[--I].Y)&&g.length){f=g[g.length-1];break}for(o=0;x=p.Y[o];f=x,o++)w.h.Wb(r,x,f)}for(I=0;p=y[I];I++){for(p.Y||w.a.extend(p,t(r,s,p.Aa,l,p.pb)),o=0;x=p.Y[o];f=x,o++)w.h.Wb(r,x,f);!p.Ed&&l&&(l(p.Aa,p.Y,p.pb),p.Ed=!0,f=p.Y[p.Y.length-1])}for(m&&r.ownerDocument.activeElement!=m&&m.focus(),d(a.beforeRemove,E),I=0;I<E.length;++I)E[I].Aa=n;d(a.afterMove,P),d(a.afterAdd,N)}}(),w.b("utils.setDomNodeChildrenFromArrayMapping",w.a.ec),w.ba=function(){this.allowTemplateRewriting=!1},w.ba.prototype=new w.ca,w.ba.prototype.constructor=w.ba,w.ba.prototype.renderTemplateSource=function(e,t,i,n){return(t=9>w.a.W||!e.nodes?null:e.nodes())?w.a.la(t.cloneNode(!0).childNodes):(e=e.text(),w.a.ua(e,n))},w.ba.Ma=new w.ba,w.gc(w.ba.Ma),w.b("nativeTemplateEngine",w.ba),function(){w.$a=function(){var e=this.Hd=function(){if(!s||!s.tmpl)return 0;try{if(0<=s.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,r,o){if(o=o||i,r=r||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=s.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[n.$data],n=s.extend({koBindingContext:n},r.templateOptions),(n=s.tmpl(a,t,n)).appendTo(o.createElement("div")),s.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){i.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<e&&(s.tmpl.tag.ko_code={open:"__.push($1 || '');"},s.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},w.$a.prototype=new w.ca,w.$a.prototype.constructor=w.$a;var e=new w.$a;0<e.Hd&&w.gc(e),w.b("jqueryTmplTemplateEngine",w.$a)}()})}()),n.exports),a=t(s);function l(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var h,u={exports:{}};var c,d,p=(h||(h=1,function(e){e.exports=function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){if(!a&&l)return l(s);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i||e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o=l,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){!function(){var i,n,r;i=void 0!==e?e("i18next"):window.i18n;var o={init:function(e,t,i,r,a){n.utils.domNodeDisposal.addDisposeCallback(e,function(){var t=s._koElements.indexOf(e);t>=0&&(s._koElements.splice(t,1),s._koCallbacks.splice(t,1))}),s._koElements.push(e),s._koCallbacks.push(n.bindingHandlers.i18n.update.bind(void 0,e,t,i,r,a)),o.update(e,t,i,r,a)},update:function(e,t,r,o,s){var a=n.toJS(t());if("string"==typeof a)e.innerHTML=i.t(a);else if(a.key)e.innerHTML=i.t(a.key,a.options);else for(var l in a){var h,u=a[l];if(h="string"==typeof u?i.t(u):i.t(u.key,n.toJS(u.options)),"html"==l)e.innerHTML=h;else{var c=document.createElement("div");c.innerHTML=h,e.setAttribute(l,c.innerText)}}}},s={_koElements:[],_koCallbacks:[],setLanguage:function(e){i.setLng(e),s._language(e),s._koCallbacks.forEach(function(e){return e.call(void 0)}),void 0!==r&&void 0!==r.fn.i18n&&r("html").i18n()},init:function(e,t,a,l){n=a||window.ko,r=l||window.$,i.init({compatibilityAPI:"v1",lng:t||"en",resStore:e}),n.bindingHandlers.i18n=o,s._language=n.observable(t),s.setLanguage(t)},t:function(){var e=arguments;return n.computed(function(){return s._language(),i.t.apply(i,e)})},i18n:i};void 0!==t?t.exports=s:window.i18nextko=s}()},{i18next:17}],2:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=function(){function e(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=l(e("./utils")),s=a(e("./logger"));function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function h(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):h(e,t))}function p(e,t){for(var i=e.indexOf(t);-1!==i;)e.splice(i,1),i=e.indexOf(t)}var f=function(e){function t(i,n,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];u(this,t);var a=c(this,e.call(this));return a.backend=i,a.store=n,a.services=r,a.options=o,a.logger=s.default.create("backendConnector"),a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(r,o.backend,o),a}return d(t,e),t.prototype.queueLoad=function(e,t,i){var n=this,r=[],o=[],s=[],a=[];return e.forEach(function(e){var i=!0;t.forEach(function(t){var s=e+"|"+t;n.store.hasResourceBundle(e,t)?n.state[s]=2:n.state[s]<0||(1===n.state[s]?o.indexOf(s)<0&&o.push(s):(n.state[s]=1,i=!1,o.indexOf(s)<0&&o.push(s),r.indexOf(s)<0&&r.push(s),a.indexOf(t)<0&&a.push(t)))}),i||s.push(e)}),(r.length||o.length)&&this.queue.push({pending:o,loaded:{},errors:[],callback:i}),{toLoad:r,pending:o,toLoadLanguages:s,toLoadNamespaces:a}},t.prototype.loaded=function(e,t,i){var n=this,s=e.split("|"),a=r(s,2),l=a[0],h=a[1];t&&this.emit("failedLoading",l,h,t),i&&this.store.addResourceBundle(l,h,i),this.state[e]=t?-1:2,this.queue.forEach(function(i){o.pushPath(i.loaded,[l],h),p(i.pending,e),t&&i.errors.push(t),0!==i.pending.length||i.done||(i.errors.length?i.callback(i.errors):i.callback(),n.emit("loaded",i.loaded),i.done=!0)}),this.queue=this.queue.filter(function(e){return!e.done})},t.prototype.read=function(e,t,i,n,r,o){var s=this;if(n||(n=0),r||(r=250),!e.length)return o(null,{});this.backend[i](e,t,function(a,l){a&&l&&n<5?setTimeout(function(){s.read.call(s,e,t,i,++n,2*r,o)},r):o(a,l)})},t.prototype.load=function(e,t,i){var s=this;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();var a=n({},this.backend.options,this.options.backend);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var l,h=this.queueLoad(e,t,i);h.toLoad.length?a.allowMultiLoading&&this.backend.readMulti?this.read(h.toLoadLanguages,h.toLoadNamespaces,"readMulti",null,null,function(e,t){e&&s.logger.warn("loading namespaces "+h.toLoadNamespaces.join(", ")+" for languages "+h.toLoadLanguages.join(", ")+" via multiloading failed",e),!e&&t&&s.logger.log("loaded namespaces "+h.toLoadNamespaces.join(", ")+" for languages "+h.toLoadLanguages.join(", ")+" via multiloading",t),h.toLoad.forEach(function(i){var n=i.split("|"),a=r(n,2),l=a[0],h=a[1],u=o.getPath(t,[l,h]);if(u)s.loaded(i,e,u);else{var c="loading namespace "+h+" for language "+l+" via multiloading failed";s.loaded(i,c),s.logger.error(c)}})}):(l=function(e){var t=this,i=e.split("|"),n=r(i,2),o=n[0],s=n[1];this.read(o,s,"read",null,null,function(i,n){i&&t.logger.warn("loading namespace "+s+" for language "+o+" failed",i),!i&&n&&t.logger.log("loaded namespace "+s+" for language "+o,n),t.loaded(e,i,n)})},h.toLoad.forEach(function(e){l.call(s,e)})):h.pending.length||i()},t.prototype.reload=function(e,t){var i=this;this.backend||this.logger.warn("No backend was added via i18next.use. Will not load resources.");var s,a=n({},this.backend.options,this.options.backend);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]),a.allowMultiLoading&&this.backend.readMulti?this.read(e,t,"readMulti",null,null,function(n,r){n&&i.logger.warn("reloading namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading failed",n),!n&&r&&i.logger.log("reloaded namespaces "+t.join(", ")+" for languages "+e.join(", ")+" via multiloading",r),e.forEach(function(e){t.forEach(function(t){var s=o.getPath(r,[e,t]);if(s)i.loaded(e+"|"+t,n,s);else{var a="reloading namespace "+t+" for language "+e+" via multiloading failed";i.loaded(e+"|"+t,a),i.logger.error(a)}})})}):(s=function(e){var t=this,i=e.split("|"),n=r(i,2),o=n[0],s=n[1];this.read(o,s,"read",null,null,function(i,n){i&&t.logger.warn("reloading namespace "+s+" for language "+o+" failed",i),!i&&n&&t.logger.log("reloaded namespace "+s+" for language "+o,n),t.loaded(e,i,n)})},e.forEach(function(e){t.forEach(function(t){s.call(i,e+"|"+t)})}))},t.prototype.saveMissing=function(e,t,i,n){this.backend&&this.backend.create&&this.backend.create(e,t,i,n),e&&e[0]&&this.store.addResource(e[0],t,i,n)},t}(a(e("./EventEmitter")).default);i.default=f},{"./EventEmitter":4,"./logger":14,"./utils":16}],3:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};s(e("./utils"));var r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):a(e,t))}var c=function(e){function t(i,n,o){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];l(this,t);var a=h(this,e.call(this));return a.cache=i,a.store=n,a.services=o,a.options=s,a.logger=r.default.create("cacheConnector"),a.cache&&a.cache.init&&a.cache.init(o,s.cache,s),a}return u(t,e),t.prototype.load=function(e,t,i){var r=this;if(!this.cache)return i&&i();var o=n({},this.cache.options,this.options.cache);"string"==typeof e&&(e=this.services.languageUtils.toResolveHierarchy(e)),o.enabled?this.cache.load(e,function(t,n){if(t&&r.logger.error("loading languages "+e.join(", ")+" from cache failed",t),n)for(var o in n)for(var s in n[o])if("i18nStamp"!==s){var a=n[o][s];a&&r.store.addResourceBundle(o,s,a)}i&&i()}):i&&i()},t.prototype.save=function(){this.cache&&this.options.cache&&this.options.cache.enabled&&this.cache.save(this.store.data)},t}(o(e("./EventEmitter")).default);i.default=c},{"./EventEmitter":4,"./logger":14,"./utils":16}],4:[function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(){n(this,e),this.observers={}}return e.prototype.on=function(e,t){var i=this;e.split(" ").forEach(function(e){i.observers[e]=i.observers[e]||[],i.observers[e].push(t)})},e.prototype.off=function(e,t){var i=this;this.observers[e]&&this.observers[e].forEach(function(){if(t){var n=i.observers[e].indexOf(t);n>-1&&i.observers[e].splice(n,1)}else delete i.observers[e]})},e.prototype.emit=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this.observers[e]&&this.observers[e].forEach(function(e){e.apply(void 0,i)}),this.observers["*"]&&this.observers["*"].forEach(function(t){var n;t.apply(t,(n=[e]).concat.apply(n,i))})},e}();i.default=r},{}],5:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=s(e("./utils")),r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,e),this.logger=r.default.create("interpolator"),this.init(t,!0)}return e.prototype.init=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];arguments[1]&&(this.options=e,this.format=e.interpolation&&e.interpolation.format||function(e){return e}),e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escapeValue=t.escapeValue,this.prefix=t.prefix?n.regexEscape(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?n.regexEscape(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?n.regexEscape(t.formatSeparator):t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?n.regexEscape(t.nestingPrefix):t.nestingPrefixEscaped||n.regexEscape("$t("),this.nestingSuffix=t.nestingSuffix?n.regexEscape(t.nestingSuffix):t.nestingSuffixEscaped||n.regexEscape(")"),this.resetRegExp()},e.prototype.reset=function(){this.options&&this.init(this.options)},e.prototype.resetRegExp=function(){var e=this.prefix+"(.+?)"+this.suffix;this.regexp=new RegExp(e,"g");var t=this.prefix+this.unescapePrefix+"(.+?)"+this.unescapeSuffix+this.suffix;this.regexpUnescape=new RegExp(t,"g");var i=this.nestingPrefix+"(.+?)"+this.nestingSuffix;this.nestingRegexp=new RegExp(i,"g")},e.prototype.interpolate=function(e,t,i){var r=this,o=void 0,s=void 0;function a(e){return e.replace(/\$/g,"$$$$")}var l=function(e){if(e.indexOf(r.formatSeparator)<0)return n.getPath(t,e);var o=e.split(r.formatSeparator),s=o.shift().trim(),a=o.join(r.formatSeparator).trim();return r.format(n.getPath(t,s),a,i)};for(this.resetRegExp();o=this.regexpUnescape.exec(e);){var h=l(o[1].trim());e=e.replace(o[0],h),this.regexpUnescape.lastIndex=0}for(;o=this.regexp.exec(e);)"string"!=typeof(s=l(o[1].trim()))&&(s=n.makeString(s)),s||(this.logger.warn("missed to pass in variable "+o[1]+" for interpolating "+e),s=""),s=this.escapeValue?a(n.escape(s)):a(s),e=e.replace(o[0],s),this.regexp.lastIndex=0;return e},e.prototype.nest=function(e,t){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=void 0,o=void 0,s=JSON.parse(JSON.stringify(i));function a(e){return e.replace(/\$/g,"$$$$")}function l(e){if(e.indexOf(",")<0)return e;var t=e.split(",");e=t.shift();var i=t.join(",");i=this.interpolate(i,s);try{s=JSON.parse(i)}catch(t){this.logger.error("failed parsing options string in nesting for key "+e,t)}return e}for(s.applyPostProcessor=!1;r=this.nestingRegexp.exec(e);)"string"!=typeof(o=t(l.call(this,r[1].trim()),s))&&(o=n.makeString(o)),o||(this.logger.warn("missed to pass in variable "+r[1]+" for interpolating "+e),o=""),o=this.escapeValue?a(n.escape(o)):a(o),e=e.replace(r[0],o),this.regexp.lastIndex=0;return e},e}();i.default=l},{"./logger":14,"./utils":16}],6:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=r(e("./logger"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}var a=function(){function e(t){o(this,e),this.options=t,this.whitelist=this.options.whitelist||!1,this.logger=n.default.create("languageUtils")}return e.prototype.getLanguagePartFromCode=function(e){if(e.indexOf("-")<0)return e;var t=["NB-NO","NN-NO","nb-NO","nn-NO","nb-no","nn-no"],i=e.split("-");return this.formatLanguageCode(t.indexOf(e)>-1?i[1].toLowerCase():i[0])},e.prototype.formatLanguageCode=function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],i=e.split("-");return this.options.lowerCaseLng?i=i.map(function(e){return e.toLowerCase()}):2===i.length?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=s(i[1].toLowerCase()))):3===i.length&&(i[0]=i[0].toLowerCase(),2===i[1].length&&(i[1]=i[1].toUpperCase()),"sgn"!==i[0]&&2===i[2].length&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=s(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=s(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e},e.prototype.isWhitelisted=function(e,t){return("languageOnly"===this.options.load||this.options.nonExplicitWhitelist&&!t)&&(e=this.getLanguagePartFromCode(e)),!this.whitelist||!this.whitelist.length||this.whitelist.indexOf(e)>-1},e.prototype.toResolveHierarchy=function(e,t){var i=this;"string"==typeof(t=t||this.options.fallbackLng||[])&&(t=[t]);var n=[],r=function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];i.isWhitelisted(e,t)?n.push(e):i.logger.warn("rejecting non-whitelisted language code: "+e)};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e),!0),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):"string"==typeof e&&r(this.formatLanguageCode(e)),t.forEach(function(e){n.indexOf(e)<0&&r(i.formatLanguageCode(e))}),n},e}();i.default=a},{"./logger":14}],7:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=o(e("./logger"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","es_ar","et","eu","fi","fo","fur","fy","gl","gu","ha","he","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt","pt_br","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21}],l={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}};function h(){var e={};return a.forEach(function(t){t.lngs.forEach(function(i){return e[i]={numbers:t.nr,plurals:l[t.fc]}})}),e}var u=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];s(this,e),this.languageUtils=t,this.options=i,this.logger=r.default.create("pluralResolver"),this.rules=h()}return e.prototype.addRule=function(e,t){this.rules[e]=t},e.prototype.getRule=function(e){return this.rules[this.languageUtils.getLanguagePartFromCode(e)]},e.prototype.needsPlural=function(e){var t=this.getRule(e);return!(t&&t.numbers.length<=1)},e.prototype.getSuffix=function(e,t){var i=this,r=this.getRule(e);if(!r)return this.logger.warn("no plural rule found for: "+e),"";var o=function(){if(1===r.numbers.length)return{v:""};var e=r.noAbs?r.plurals(t):r.plurals(Math.abs(t)),n=r.numbers[e];2===r.numbers.length&&1===r.numbers[0]&&(2===n?n="plural":1===n&&(n=""));var o=function(){return i.options.prepend&&n.toString()?i.options.prepend+n.toString():n.toString()};return"v1"===i.options.compatibilityJSON?1===n?{v:""}:"number"==typeof n?{v:"_plural_"+n.toString()}:{v:o()}:"v2"===i.options.compatibilityJSON||2===r.numbers.length&&1===r.numbers[0]||2===r.numbers.length&&1===r.numbers[0]?{v:o()}:{v:i.options.prepend&&e.toString()?i.options.prepend+e.toString():e.toString()}}();return"object"===(void 0===o?"undefined":n(o))?o.v:void 0},e}();i.default=u},{"./logger":14}],8:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=a(e("./EventEmitter")),o=s(e("./utils"));function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):l(e,t))}var d=function(e){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments.length<=1||void 0===arguments[1]?{ns:["translation"],defaultNS:"translation"}:arguments[1];h(this,t);var r=u(this,e.call(this));return r.data=i,r.options=n,r}return c(t,e),t.prototype.addNamespaces=function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)},t.prototype.removeNamespaces=function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)},t.prototype.getResource=function(e,t,i){var n=(arguments.length<=3||void 0===arguments[3]?{}:arguments[3]).keySeparator||this.options.keySeparator;void 0===n&&(n=".");var r=[e,t];return i&&"string"!=typeof i&&(r=r.concat(i)),i&&"string"==typeof i&&(r=r.concat(n?i.split(n):i)),e.indexOf(".")>-1&&(r=e.split(".")),o.getPath(this.data,r)},t.prototype.addResource=function(e,t,i,n){var r=arguments.length<=4||void 0===arguments[4]?{silent:!1}:arguments[4],s=this.options.keySeparator;void 0===s&&(s=".");var a=[e,t];i&&(a=a.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(n=t,t=(a=e.split("."))[1]),this.addNamespaces(t),o.setPath(this.data,a,n),r.silent||this.emit("added",e,t,i,n)},t.prototype.addResources=function(e,t,i){for(var n in i)"string"==typeof i[n]&&this.addResource(e,t,n,i[n],{silent:!0});this.emit("added",e,t,i)},t.prototype.addResourceBundle=function(e,t,i,r,s){var a=[e,t];e.indexOf(".")>-1&&(r=i,i=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var l=o.getPath(this.data,a)||{};r?o.deepExtend(l,i,s):l=n({},l,i),o.setPath(this.data,a,l),this.emit("added",e,t,i)},t.prototype.removeResourceBundle=function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)},t.prototype.hasResourceBundle=function(e,t){return void 0!==this.getResource(e,t)},t.prototype.getResourceBundle=function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?n({},this.getResource(e,t)):this.getResource(e,t)},t.prototype.toJSON=function(){return this.data},t}(r.default);i.default=d},{"./EventEmitter":4,"./utils":16}],9:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=c(e("./logger")),s=c(e("./EventEmitter")),a=c(e("./postProcessor")),l=u(e("./compatibility/v1")),h=u(e("./utils"));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):d(e,t))}var m=function(e){function t(i){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];p(this,t);var r=f(this,e.call(this));return h.copy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector"],i,r),r.options=n,r.logger=o.default.create("translator"),r}return g(t,e),t.prototype.changeLanguage=function(e){e&&(this.language=e)},t.prototype.exists=function(e){var t=arguments.length<=1||void 0===arguments[1]?{interpolation:{}}:arguments[1];return"v1"===this.options.compatibilityAPI&&(t=l.convertTOptions(t)),void 0!==this.resolve(e,t)},t.prototype.extractFromKey=function(e,t){var i=t.nsSeparator||this.options.nsSeparator;void 0===i&&(i=":");var n=t.ns||this.options.defaultNS;if(i&&e.indexOf(i)>-1){var r=e.split(i);n=r[0],e=r[1]}return"string"==typeof n&&(n=[n]),{key:e,namespaces:n}},t.prototype.translate=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("object"!==(void 0===t?"undefined":r(t))?t=this.options.overloadTranslationOptionHandler(arguments):"v1"===this.options.compatibilityAPI&&(t=l.convertTOptions(t)),null==e||""===e)return"";"number"==typeof e&&(e=String(e)),"string"==typeof e&&(e=[e]);var i=t.lng||this.language;if(i&&"cimode"===i.toLowerCase())return e[e.length-1];var o=t.keySeparator||this.options.keySeparator||".",s=this.extractFromKey(e[e.length-1],t),a=s.key,h=s.namespaces,u=h[h.length-1],c=this.resolve(e,t),d=Object.prototype.toString.apply(c),p=["[object Number]","[object Function]","[object RegExp]"],f=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays;if(c&&"string"!=typeof c&&p.indexOf(d)<0&&(!f||"[object Array]"!==d)){if(!t.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(a,c,t):"key '"+a+" ("+this.language+")' returned an object instead of string.";var g="[object Array]"===d?[]:{};for(var m in c)g[m]=this.translate(""+a+o+m,n({joinArrays:!1,ns:h},t));c=g}else if(f&&"[object Array]"===d)(c=c.join(f))&&(c=this.extendTranslation(c,a,t));else{var b=!1,v=!1;if(this.isValidLookup(c)||void 0===t.defaultValue||(b=!0,c=t.defaultValue),this.isValidLookup(c)||(v=!0,c=a),v||b){this.logger.log("missingKey",i,u,a,c);var y=[];if("fallback"===this.options.saveMissingTo&&this.options.fallbackLng&&this.options.fallbackLng[0])for(var w=0;w<this.options.fallbackLng.length;w++)y.push(this.options.fallbackLng[w]);else"all"===this.options.saveMissingTo?y=this.languageUtils.toResolveHierarchy(t.lng||this.language):y.push(t.lng||this.language);this.options.saveMissing&&(this.options.missingKeyHandler?this.options.missingKeyHandler(y,u,a,c):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(y,u,a,c)),this.emit("missingKey",y,u,a,c)}c=this.extendTranslation(c,a,t),v&&c===a&&this.options.appendNamespaceToMissingKey&&(c=u+":"+a),v&&this.options.parseMissingKeyHandler&&(c=this.options.parseMissingKeyHandler(c))}return c},t.prototype.extendTranslation=function(e,t,i){var r=this;i.interpolation&&this.interpolator.init(i);var o=i.replace&&"string"!=typeof i.replace?i.replace:i;this.options.interpolation.defaultVariables&&(o=n({},this.options.interpolation.defaultVariables,o)),e=this.interpolator.interpolate(e,o,this.language),e=this.interpolator.nest(e,function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.translate.apply(r,t)},i),i.interpolation&&this.interpolator.reset();var s=i.postProcess||this.options.postProcess,l="string"==typeof s?[s]:s;return void 0!==e&&l&&l.length&&!1!==i.applyPostProcessor&&(e=a.default.handle(l,e,t,i,this)),e},t.prototype.resolve=function(e){var t=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=void 0;return"string"==typeof e&&(e=[e]),e.forEach(function(e){if(!t.isValidLookup(n)){var r=t.extractFromKey(e,i),o=r.key,s=r.namespaces;t.options.fallbackNS&&(s=s.concat(t.options.fallbackNS));var a=void 0!==i.count&&"string"!=typeof i.count,l=void 0!==i.context&&"string"==typeof i.context&&""!==i.context,h=i.lngs?i.lngs:t.languageUtils.toResolveHierarchy(i.lng||t.language);s.forEach(function(e){t.isValidLookup(n)||h.forEach(function(r){if(!t.isValidLookup(n)){var s=o,h=[s],u=void 0;a&&(u=t.pluralResolver.getSuffix(r,i.count)),a&&l&&h.push(s+u),l&&h.push(s+=""+t.options.contextSeparator+i.context),a&&h.push(s+=u);for(var c=void 0;c=h.pop();)t.isValidLookup(n)||(n=t.getResource(r,e,c,i))}})})}}),n},t.prototype.isValidLookup=function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)},t.prototype.getResource=function(e,t,i){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return this.resourceStore.getResource(e,t,i,n)},t}(s.default);i.default=m},{"./EventEmitter":4,"./compatibility/v1":10,"./logger":14,"./postProcessor":15,"./utils":16}],10:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertAPIOptions=s,i.convertJSONOptions=a,i.convertTOptions=l,i.appendBackwardsAPI=h;var n=r(e("../logger"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return e.interpolation={unescapeSuffix:"HTML"},e.interpolation.prefix=e.interpolationPrefix||"__",e.interpolation.suffix=e.interpolationSuffix||"__",e.interpolation.escapeValue=e.escapeInterpolation||!1,e.interpolation.nestingPrefix=e.reusePrefix||"$t(",e.interpolation.nestingSuffix=e.reuseSuffix||")",e}function s(e){return e.resStore&&(e.resources=e.resStore),e.ns&&e.ns.defaultNs?(e.defaultNS=e.ns.defaultNs,e.ns=e.ns.namespaces):e.defaultNS=e.ns||"translation",e.fallbackToDefaultNS&&e.defaultNS&&(e.fallbackNS=e.defaultNS),e.saveMissing=e.sendMissing,e.saveMissingTo=e.sendMissingTo||"current",e.returnNull=!e.fallbackOnNull,e.returnEmptyString=!e.fallbackOnEmpty,e.returnObjects=e.returnObjectTrees,e.joinArrays="\n",e.returnedObjectHandler=e.objectTreeKeyHandler,e.parseMissingKeyHandler=e.parseMissingKey,e.appendNamespaceToMissingKey=!0,e.nsSeparator=e.nsseparator,e.keySeparator=e.keyseparator,"sprintf"===e.shortcutFunction&&(e.overloadTranslationOptionHandler=function(e){for(var t=[],i=1;i<e.length;i++)t.push(e[i]);return{postProcess:"sprintf",sprintf:t}}),e.whitelist=e.lngWhitelist,e.preload=e.preload,"current"===e.load&&(e.load="currentOnly"),"unspecific"===e.load&&(e.load="languageOnly"),e.backend=e.backend||{},e.backend.loadPath=e.resGetPath||"locales/__lng__/__ns__.json",e.backend.addPath=e.resPostPath||"locales/add/__lng__/__ns__",e.backend.allowMultiLoading=e.dynamicLoad,e.cache=e.cache||{},e.cache.prefix="res_",e.cache.expirationTime=6048e5,e.cache.enabled=!!e.useLocalStorage,(e=o(e)).defaultVariables&&(e.interpolation.defaultVariables=e.defaultVariables),e}function a(e){return(e=o(e)).joinArrays="\n",e}function l(e){return(e.interpolationPrefix||e.interpolationSuffix||e.escapeInterpolation)&&(e=o(e)),e.nsSeparator=e.nsseparator,e.keySeparator=e.keyseparator,e.returnObjects=e.returnObjectTrees,e}function h(e){e.lng=function(){return n.default.deprecate("i18next.lng() can be replaced by i18next.language for detected language or i18next.languages for languages ordered by translation lookup."),e.services.languageUtils.toResolveHierarchy(e.language)[0]},e.preload=function(t,i){n.default.deprecate("i18next.preload() can be replaced with i18next.loadLanguages()"),e.loadLanguages(t,i)},e.setLng=function(t,i,r){if(n.default.deprecate("i18next.setLng() can be replaced with i18next.changeLanguage() or i18next.getFixedT() to get a translation function with fixed language or namespace."),"function"==typeof i&&(r=i,i={}),i||(i={}),!0===i.fixLng&&r)return r(null,e.getFixedT(t));e.changeLanguage(t,r)},e.addPostProcessor=function(t,i){n.default.deprecate("i18next.addPostProcessor() can be replaced by i18next.use({ type: 'postProcessor', name: 'name', process: fc })"),e.use({type:"postProcessor",name:t,process:i})}}},{"../logger":14}],11:[function(e,t,i){function n(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,load:"all",preload:!1,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",saveMissing:!1,saveMissingTo:"fallback",missingKeyHandler:!1,postProcess:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:function(){},parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,overloadTranslationOptionHandler:function(e){return{defaultValue:e[1]}},interpolation:{escapeValue:!0,format:function(e,t,i){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",defaultVariables:void 0}}}function r(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&e.whitelist.indexOf("cimode")<0&&e.whitelist.push("cimode"),e}Object.defineProperty(i,"__esModule",{value:!0}),i.get=n,i.transformOptions=r},{}],12:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o=v(e("./logger")),s=v(e("./EventEmitter")),a=v(e("./ResourceStore")),l=v(e("./Translator")),h=v(e("./LanguageUtils")),u=v(e("./PluralResolver")),c=v(e("./Interpolator")),d=v(e("./BackendConnector")),p=v(e("./CacheConnector")),f=e("./defaults"),g=v(e("./postProcessor")),m=b(e("./compatibility/v1"));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(t,r);o&&o.configurable&&void 0===e[r]&&Object.defineProperty(e,r,o)}return e}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):y(e,t))}var C=function(e){function t(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];w(this,t);var r=x(this,e.call(this));return r.options=(0,f.transformOptions)(i),r.services={},r.logger=o.default,r.modules={},n&&!r.isInitialized&&r.init(i,n),r}return S(t,e),t.prototype.init=function(e,t){var i=this;function n(e){if(e)return"function"==typeof e?new e:e}if("function"==typeof e&&(t=e,e={}),e||(e={}),"v1"===e.compatibilityAPI?this.options=r({},(0,f.get)(),(0,f.transformOptions)(m.convertAPIOptions(e)),{}):"v1"===e.compatibilityJSON?this.options=r({},(0,f.get)(),(0,f.transformOptions)(m.convertJSONOptions(e)),{}):this.options=r({},(0,f.get)(),this.options,(0,f.transformOptions)(e)),t||(t=function(){}),!this.options.isClone){this.modules.logger?o.default.init(n(this.modules.logger),this.options):o.default.init(null,this.options);var s=new h.default(this.options);this.store=new a.default(this.options.resources,this.options);var g=this.services;g.logger=o.default,g.resourceStore=this.store,g.resourceStore.on("added removed",function(e,t){g.cacheConnector.save()}),g.languageUtils=s,g.pluralResolver=new u.default(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON}),g.interpolator=new c.default(this.options),g.backendConnector=new d.default(n(this.modules.backend),g.resourceStore,g,this.options),g.backendConnector.on("*",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))}),g.backendConnector.on("loaded",function(e){g.cacheConnector.save()}),g.cacheConnector=new p.default(n(this.modules.cache),g.resourceStore,g,this.options),g.cacheConnector.on("*",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))}),this.modules.languageDetector&&(g.languageDetector=n(this.modules.languageDetector),g.languageDetector.init(g,this.options.detection,this.options)),this.translator=new l.default(this.services,this.options),this.translator.on("*",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];i.emit.apply(i,[e].concat(n))})}["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle"].forEach(function(e){i[e]=function(){return this.store[e].apply(this.store,arguments)}}),"v1"===this.options.compatibilityAPI&&m.appendBackwardsAPI(this);var b=function(){i.changeLanguage(i.options.lng,function(e,n){i.emit("initialized",i.options),i.logger.log("initialized",i.options),t(e,n)})};return this.options.resources||!this.options.initImmediate?b():setTimeout(b,0),this},t.prototype.loadResources=function(e){var t=this;if(e||(e=function(){}),this.options.resources)e(null);else{var i=function(){if(t.language&&"cimode"===t.language.toLowerCase())return{v:e()};var i=[],n=function(e){t.services.languageUtils.toResolveHierarchy(e).forEach(function(e){i.indexOf(e)<0&&i.push(e)})};n(t.language),t.options.preload&&t.options.preload.forEach(function(e){n(e)}),t.services.cacheConnector.load(i,t.options.ns,function(){t.services.backendConnector.load(i,t.options.ns,e)})}();if("object"===(void 0===i?"undefined":n(i)))return i.v}},t.prototype.reloadResources=function(e,t){e||(e=this.languages),t||(t=this.options.ns),this.services.backendConnector.reload(e,t)},t.prototype.use=function(e){return"backend"===e.type&&(this.modules.backend=e),"cache"===e.type&&(this.modules.cache=e),("logger"===e.type||e.log&&e.warn&&e.warn)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"postProcessor"===e.type&&g.default.addPostProcessor(e),this},t.prototype.changeLanguage=function(e,t){var i=this,n=function(n){e&&(i.emit("languageChanged",e),i.logger.log("languageChanged",e)),t&&t(n,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.t.apply(i,t)})};!e&&this.services.languageDetector&&(e=this.services.languageDetector.detect()),e&&(this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.translator.changeLanguage(e),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage(e)),this.loadResources(function(e){n(e)})},t.prototype.getFixedT=function(e,t){var i=this,n=function e(t,n){return(n=n||{}).lng=n.lng||e.lng,n.ns=n.ns||e.ns,i.t(t,n)};return n.lng=e,n.ns=t,n},t.prototype.t=function(){return this.translator&&this.translator.translate.apply(this.translator,arguments)},t.prototype.exists=function(){return this.translator&&this.translator.exists.apply(this.translator,arguments)},t.prototype.setDefaultNamespace=function(e){this.options.defaultNS=e},t.prototype.loadNamespaces=function(e,t){var i=this;if(!this.options.ns)return t&&t();"string"==typeof e&&(e=[e]),e.forEach(function(e){i.options.ns.indexOf(e)<0&&i.options.ns.push(e)}),this.loadResources(t)},t.prototype.loadLanguages=function(e,t){"string"==typeof e&&(e=[e]);var i=this.options.preload||[],n=e.filter(function(e){return i.indexOf(e)<0});if(!n.length)return t();this.options.preload=i.concat(n),this.loadResources(t)},t.prototype.dir=function(e){return e||(e=this.language),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr":"rtl"},t.prototype.createInstance=function(){return new t(arguments.length<=0||void 0===arguments[0]?{}:arguments[0],arguments[1])},t.prototype.cloneInstance=function(){var e=this,i=arguments[1],n=new t(r({},arguments.length<=0||void 0===arguments[0]?{}:arguments[0],this.options,{isClone:!0}),i);return["store","translator","services","language"].forEach(function(t){n[t]=e[t]}),n},t}(s.default);i.default=new C},{"./BackendConnector":2,"./CacheConnector":3,"./EventEmitter":4,"./Interpolator":5,"./LanguageUtils":6,"./PluralResolver":7,"./ResourceStore":8,"./Translator":9,"./compatibility/v1":10,"./defaults":11,"./logger":14,"./postProcessor":15}],13:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=r(e("./i18next"));function r(e){return e&&e.__esModule?e:{default:e}}i.default=n.default},{"./i18next":12}],14:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={type:"logger",log:function(e){this._output("log",e)},warn:function(e){this._output("warn",e)},error:function(e){this._output("error",e)},_output:function(e,t){console&&console[e]&&console[e].apply(console,Array.prototype.slice.call(t))}},s=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e),this.subs=[],this.init(t,i)}return e.prototype.init=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.prefix=t.prefix||"i18next:",this.logger=e||o,this.options=t,this.debug=!1!==t.debug},e.prototype.setDebug=function(e){this.debug=e,this.subs.forEach(function(t){t.setDebug(e)})},e.prototype.log=function(){this.forward(arguments,"log","",!0)},e.prototype.warn=function(){this.forward(arguments,"warn","",!0)},e.prototype.error=function(){this.forward(arguments,"error","")},e.prototype.deprecate=function(){this.forward(arguments,"warn","WARNING DEPRECATED: ",!0)},e.prototype.forward=function(e,t,i,n){n&&!this.debug||("string"==typeof e[0]&&(e[0]=i+this.prefix+" "+e[0]),this.logger[t](e))},e.prototype.create=function(t){var i=new e(this.logger,n({prefix:this.prefix+":"+t+":"},this.options));return this.subs.push(i),i},e}();i.default=new s},{}],15:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,i,n,r){var o=this;return e.forEach(function(e){o.processors[e]&&(t=o.processors[e].process(t,i,n,r))}),t}}},{}],16:[function(e,t,i){function n(e){return null==e?"":""+e}function r(e,t,i){e.forEach(function(e){t[e]&&(i[e]=t[e])})}function o(e,t,i){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}for(var r="string"!=typeof t?[].concat(t):t.split(".");r.length>1;){if(!e)return{};var o=n(r.shift());!e[o]&&i&&(e[o]=new i),e=e[o]}return e?{obj:e,k:n(r.shift())}:{}}function s(e,t,i){var n=o(e,t,Object);n.obj[n.k]=i}function a(e,t,i,n){var r=o(e,t,Object),s=r.obj,a=r.k;s[a]=s[a]||[],n&&(s[a]=s[a].concat(i)),n||s[a].push(i)}function l(e,t){var i=o(e,t),n=i.obj,r=i.k;if(n)return n[r]}function h(e,t,i){for(var n in t)n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?i&&(e[n]=t[n]):h(e[n],t[n],i):e[n]=t[n];return e}function u(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}Object.defineProperty(i,"__esModule",{value:!0}),i.makeString=n,i.copy=r,i.setPath=s,i.pushPath=a,i.getPath=l,i.deepExtend=h,i.regexEscape=u,i.escape=d;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function d(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return c[e]}):e}},{}],17:[function(e,t,i){t.exports=e("./dist/commonjs/index.js").default},{"./dist/commonjs/index.js":13}]},{},[1])(1)}(u)),u.exports),f=t(p);var g,m=function(){if(d)return c;d=1;var e,t=Object.create,i=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,a=e=>{throw TypeError(e)},l=(e,t,o,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of r(t))!s.call(e,l)&&l!==o&&i(e,l,{get:()=>t[l],enumerable:!(a=n(t,l))||a.enumerable});return e},h=(e,t,n)=>((e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),u=(e,t,i)=>t.has(e)||a("Cannot "+i),p=(e,t,i)=>(u(e,t,"read from private field"),i?i.call(e):t.get(e)),f=(e,t,i)=>t.has(e)?a("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),g=(e,t,i,n)=>(u(e,t,"write to private field"),n?n.call(e,i):t.set(e,i),i),m=(e,t,i)=>(u(e,t,"access private method"),i),b=((e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports))((e,t)=>{var i=-1;function n(e,t,f,g,m){if(e===t)return e?[[0,e]]:[];if(null!=f){var b=function(e,t,i){var n="number"==typeof i?{index:i,length:0}:i.oldRange,r="number"==typeof i?null:i.newRange,o=e.length,s=t.length;if(0===n.length&&(null===r||0===r.length)){var a=n.index,l=e.slice(0,a),h=e.slice(a),u=r?r.index:null,c=a+s-o;if(!(null!==u&&u!==c||c<0||c>s)){var d=t.slice(0,c);if((g=t.slice(c))===h){var p=Math.min(a,c);if((b=l.slice(0,p))===(w=d.slice(0,p)))return v(b,l.slice(p),d.slice(p),h)}}if(null===u||u===a){var f=a,g=(d=t.slice(0,f),t.slice(f));if(d===l){var m=Math.min(o-f,s-f);if((y=h.slice(h.length-m))===(x=g.slice(g.length-m)))return v(l,h.slice(0,h.length-m),g.slice(0,g.length-m),y)}}}if(n.length>0&&r&&0===r.length){var b=e.slice(0,n.index),y=e.slice(n.index+n.length);if(!(s<(p=b.length)+(m=y.length))){var w=t.slice(0,p),x=t.slice(s-m);if(b===w&&y===x)return v(b,e.slice(p,o-m),t.slice(p,s-m),y)}}return null}(e,t,f);if(b)return b}var y=o(e,t),w=e.substring(0,y);y=a(e=e.substring(y),t=t.substring(y));var x=e.substring(e.length-y),S=function(e,t){var s;if(!e)return[[1,t]];if(!t)return[[i,e]];var l=e.length>t.length?e:t,h=e.length>t.length?t:e,u=l.indexOf(h);if(-1!==u)return s=[[1,l.substring(0,u)],[0,h],[1,l.substring(u+h.length)]],e.length>t.length&&(s[0][0]=s[2][0]=i),s;if(1===h.length)return[[i,e],[1,t]];var c=function(e,t){var i=e.length>t.length?e:t,n=e.length>t.length?t:e;if(i.length<4||2*n.length<i.length)return null;function r(e,t,i){for(var n,r,s,l,h=e.substring(i,i+Math.floor(e.length/4)),u=-1,c="";-1!==(u=t.indexOf(h,u+1));){var d=o(e.substring(i),t.substring(u)),p=a(e.substring(0,i),t.substring(0,u));c.length<p+d&&(c=t.substring(u-p,u)+t.substring(u,u+d),n=e.substring(0,i-p),r=e.substring(i+d),s=t.substring(0,u-p),l=t.substring(u+d))}return 2*c.length>=e.length?[n,r,s,l,c]:null}var s,l,h,u,c,d=r(i,n,Math.ceil(i.length/4)),p=r(i,n,Math.ceil(i.length/2));if(!d&&!p)return null;s=p?d&&d[4].length>p[4].length?d:p:d,e.length>t.length?(l=s[0],h=s[1],u=s[2],c=s[3]):(u=s[0],c=s[1],l=s[2],h=s[3]);var f=s[4];return[l,h,u,c,f]}(e,t);if(c){var d=c[0],p=c[1],f=c[2],g=c[3],m=c[4],b=n(d,f),v=n(p,g);return b.concat([[0,m]],v)}return function(e,t){for(var n=e.length,o=t.length,s=Math.ceil((n+o)/2),a=s,l=2*s,h=new Array(l),u=new Array(l),c=0;c<l;c++)h[c]=-1,u[c]=-1;h[a+1]=0,u[a+1]=0;for(var d=n-o,p=d%2!=0,f=0,g=0,m=0,b=0,v=0;v<s;v++){for(var y=-v+f;y<=v-g;y+=2){for(var w=a+y,x=(P=y===-v||y!==v&&h[w-1]<h[w+1]?h[w+1]:h[w-1]+1)-y;P<n&&x<o&&e.charAt(P)===t.charAt(x);)P++,x++;if(h[w]=P,P>n)g+=2;else if(x>o)f+=2;else if(p){if((k=a+d-y)>=0&&k<l&&-1!==u[k])if(P>=(C=n-u[k]))return r(e,t,P,x)}}for(var S=-v+m;S<=v-b;S+=2){for(var C,k=a+S,E=(C=S===-v||S!==v&&u[k-1]<u[k+1]?u[k+1]:u[k-1]+1)-S;C<n&&E<o&&e.charAt(n-C-1)===t.charAt(o-E-1);)C++,E++;if(u[k]=C,C>n)b+=2;else if(E>o)m+=2;else if(!p){if((w=a+d-S)>=0&&w<l&&-1!==h[w]){var P;x=a+(P=h[w])-w;if(P>=(C=n-C))return r(e,t,P,x)}}}}return[[i,e],[1,t]]}(e,t)}(e=e.substring(0,e.length-y),t=t.substring(0,t.length-y));return w&&S.unshift([0,w]),x&&S.push([0,x]),p(S,m),g&&function(e){for(var t=!1,n=[],r=0,o=null,f=0,g=0,m=0,b=0,v=0;f<e.length;)0==e[f][0]?(n[r++]=f,g=b,m=v,b=0,v=0,o=e[f][1]):(1==e[f][0]?b+=e[f][1].length:v+=e[f][1].length,o&&o.length<=Math.max(g,m)&&o.length<=Math.max(b,v)&&(e.splice(n[r-1],0,[i,o]),e[n[r-1]+1][0]=1,r--,r--,f=r>0?n[r-1]:-1,g=0,m=0,b=0,v=0,o=null,t=!0)),f++;for(t&&p(e),function(e){function t(e,t){if(!e||!t)return 6;var i=e.charAt(e.length-1),n=t.charAt(0),r=i.match(l),o=n.match(l),s=r&&i.match(h),a=o&&n.match(h),p=s&&i.match(u),f=a&&n.match(u),g=p&&e.match(c),m=f&&t.match(d);return g||m?5:p||f?4:r&&!s&&a?3:s||a?2:r||o?1:0}for(var i=1;i<e.length-1;){if(0==e[i-1][0]&&0==e[i+1][0]){var n=e[i-1][1],r=e[i][1],o=e[i+1][1],s=a(n,r);if(s){var p=r.substring(r.length-s);n=n.substring(0,n.length-s),r=p+r.substring(0,r.length-s),o=p+o}for(var f=n,g=r,m=o,b=t(n,r)+t(r,o);r.charAt(0)===o.charAt(0);){n+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);var v=t(n,r)+t(r,o);v>=b&&(b=v,f=n,g=r,m=o)}e[i-1][1]!=f&&(f?e[i-1][1]=f:(e.splice(i-1,1),i--),e[i][1]=g,m?e[i+1][1]=m:(e.splice(i+1,1),i--))}i++}}(e),f=1;f<e.length;){if(e[f-1][0]==i&&1==e[f][0]){var y=e[f-1][1],w=e[f][1],x=s(y,w),S=s(w,y);x>=S?(x>=y.length/2||x>=w.length/2)&&(e.splice(f,0,[0,w.substring(0,x)]),e[f-1][1]=y.substring(0,y.length-x),e[f+1][1]=w.substring(x),f++):(S>=y.length/2||S>=w.length/2)&&(e.splice(f,0,[0,y.substring(0,S)]),e[f-1][0]=1,e[f-1][1]=w.substring(0,w.length-S),e[f+1][0]=i,e[f+1][1]=y.substring(S),f++),f++}f++}}(S),S}function r(e,t,i,r){var o=e.substring(0,i),s=t.substring(0,r),a=e.substring(i),l=t.substring(r),h=n(o,s),u=n(a,l);return h.concat(u)}function o(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;i<r;)e.substring(o,r)==t.substring(o,r)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return f(e.charCodeAt(r-1))&&r--,r}function s(e,t){var i=e.length,n=t.length;if(0==i||0==n)return 0;i>n?e=e.substring(i-n):i<n&&(t=t.substring(0,i));var r=Math.min(i,n);if(e==t)return r;for(var o=0,s=1;;){var a=e.substring(r-s),l=t.indexOf(a);if(-1==l)return o;s+=l,(0==l||e.substring(r-s)==t.substring(0,s))&&(o=s,s++)}}function a(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,o=0;i<r;)e.substring(e.length-r,e.length-o)==t.substring(t.length-r,t.length-o)?o=i=r:n=r,r=Math.floor((n-i)/2+i);return g(e.charCodeAt(e.length-r))&&r--,r}var l=/[^a-zA-Z0-9]/,h=/\s/,u=/[\r\n]/,c=/\n\r?\n$/,d=/^\r?\n\r?\n/;function p(e,t){e.push([0,""]);for(var n,r=0,s=0,l=0,h="",u="";r<e.length;)if(r<e.length-1&&!e[r][1])e.splice(r,1);else switch(e[r][0]){case 1:l++,u+=e[r][1],r++;break;case i:s++,h+=e[r][1],r++;break;case 0:var c=r-l-s-1;if(t){if(c>=0&&b(e[c][1])){var d=e[c][1].slice(-1);if(e[c][1]=e[c][1].slice(0,-1),h=d+h,u=d+u,!e[c][1]){e.splice(c,1),r--;var f=c-1;e[f]&&1===e[f][0]&&(l++,u=e[f][1]+u,f--),e[f]&&e[f][0]===i&&(s++,h=e[f][1]+h,f--),c=f}}if(m(e[r][1])){d=e[r][1].charAt(0);e[r][1]=e[r][1].slice(1),h+=d,u+=d}}if(r<e.length-1&&!e[r][1]){e.splice(r,1);break}if(h.length>0||u.length>0){h.length>0&&u.length>0&&(0!==(n=o(u,h))&&(c>=0?e[c][1]+=u.substring(0,n):(e.splice(0,0,[0,u.substring(0,n)]),r++),u=u.substring(n),h=h.substring(n)),0!==(n=a(u,h))&&(e[r][1]=u.substring(u.length-n)+e[r][1],u=u.substring(0,u.length-n),h=h.substring(0,h.length-n)));var g=l+s;0===h.length&&0===u.length?(e.splice(r-g,g),r-=g):0===h.length?(e.splice(r-g,g,[1,u]),r=r-g+1):0===u.length?(e.splice(r-g,g,[i,h]),r=r-g+1):(e.splice(r-g,g,[i,h],[1,u]),r=r-g+2)}0!==r&&0===e[r-1][0]?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,l=0,s=0,h="",u=""}""===e[e.length-1][1]&&e.pop();var v=!1;for(r=1;r<e.length-1;)0===e[r-1][0]&&0===e[r+1][0]&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)===e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),v=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),v=!0)),r++;v&&p(e,t)}function f(e){return e>=55296&&e<=56319}function g(e){return e>=56320&&e<=57343}function m(e){return g(e.charCodeAt(0))}function b(e){return f(e.charCodeAt(e.length-1))}function v(e,t,n,r){return b(e)||m(r)?null:function(e){for(var t=[],i=0;i<e.length;i++)e[i][1].length>0&&t.push(e[i]);return t}([[0,e],[i,t],[1,n],[0,r]])}function y(e,t,i,r){return n(e,t,i,r,!0)}y.INSERT=1,y.DELETE=i,y.EQUAL=0,t.exports=y}),v={};((e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})})(v,{CoreViewer:()=>hg,HOOKS:()=>L,Navigation:()=>dg,PageProgression:()=>S,PageSide:()=>P,PageViewMode:()=>fg,Profiler:()=>D,ReadyState:()=>N,UserAgentBaseCss:()=>cr,UserAgentCounterStylesCss:()=>fr,UserAgentPageCss:()=>ur,UserAgentTocCss:()=>dr,UserAgentXml:()=>hr,ValidationTxt:()=>lr,VivliostylePolyfillCss:()=>pr,VivliostyleViewportCss:()=>ar,VivliostyleViewportScreenCss:()=>sr,ZoomType:()=>pg,getHooksForName:()=>M,isDebug:()=>y,pageProgressionOf:()=>C,plugin:()=>z,printHTML:()=>mg,profile:()=>q,profiler:()=>G,registerHook:()=>O,removeHook:()=>B,setDebug:()=>w}),e=v,c=l(i({},"__esModule",{value:!0}),e);var y=!1;function w(e){y=e}var x,S=((x=S||{}).LTR="ltr",x.RTL="rtl",x);function C(e){switch(e){case"ltr":return"ltr";case"rtl":return"rtl";default:throw new Error(`unknown PageProgression: ${e}`)}}var k,E,P=(e=>(e.LEFT="left",e.RIGHT="right",e))(P||{}),N=((k=N||{}).LOADING="loading",k.INTERACTIVE="interactive",k.COMPLETE="complete",k),T=((E=T||{})[E.DEBUG=1]="DEBUG",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E);function I(e){let t=Array.from(e),i=null;return t[0]instanceof Error&&(i=t.shift()),{error:i,messages:t}}function A(e){let t=e.error,i=t&&(t.frameTrace||t.stack),n=[].concat(e.messages);return t&&(n.length>0&&(n=n.concat(["\n"])),n=n.concat([t.toString()]),i&&(n=n.concat(["\n"]).concat(i))),n}var _,R=new class{constructor(e){this.opt_console=e,h(this,"listeners",{})}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){let i=this.listeners[e];i&&i(t)}addListener(e,t){this.listeners[e]=t}debug(...e){let t=I(arguments);this.consoleDebug(A(t)),this.triggerListeners(1,t)}info(...e){let t=I(arguments);this.consoleInfo(A(t)),this.triggerListeners(2,t)}warn(...e){let t=I(arguments);this.consoleWarn(A(t)),this.triggerListeners(3,t)}error(...e){let t=I(arguments);this.consoleError(A(t)),this.triggerListeners(4,t)}},L=((_=L||{}).SIMPLE_PROPERTY="SIMPLE_PROPERTY",_.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",_.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",_.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",_.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",_.CONFIGURATION="CONFIGURATION",_.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",_.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",_.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",_.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK",_),F={};function O(e,t,i){if(L[e]){let n=F[e];n||(n=F[e]=[]),i?n.unshift(t):n.push(t)}else R.warn(new Error(`Skipping unknown plugin hook '${e}'.`))}function B(e,t){if(L[e]){let i=F[e];if(i){let e=i.indexOf(t);e>=0&&i.splice(e,1)}}else R.warn(new Error(`Ignoring unknown plugin hook '${e}'.`))}function M(e){return F[e]||[]}var z={registerHook:O,removeHook:B},D=class{constructor(e){this.performanceInstance=e,h(this,"timestamps",{}),h(this,"registerTiming"),h(this,"registerStartTiming"),h(this,"registerEndTiming"),this.registerTiming=V,this.registerStartTiming=this.registerStartTiming=V,this.registerEndTiming=this.registerEndTiming=V}forceRegisterStartTiming(e,t){U.call(this,e,"start",t)}forceRegisterEndTiming(e,t){U.call(this,e,"end",t)}printTimings(){let e=this.timestamps,t="";Object.keys(e).forEach(i=>{let n=e[i],r=n.length;for(let e=0;e<r;e++){let o=n[e];t+=i,r>1&&(t+=`(${e})`),t+=` => start: ${o.start}, end: ${o.end}, duration: ${o.end-o.start}\n`}}),R.info(t)}disable(){this.registerTiming=V,this.registerStartTiming=this.registerStartTiming=V,this.registerEndTiming=this.registerEndTiming=V}enable(){this.registerTiming=U,this.registerStartTiming=this.registerStartTiming=H,this.registerEndTiming=this.registerEndTiming=$}isEnabled(){return this.registerStartTiming===H}};function V(){}function U(e,t,i){i||(i=this.performanceInstance.now());let n,r=this.timestamps[e];r||(r=this.timestamps[e]=[]);for(let e=r.length-1;e>=0&&(n=r[e],!n||n[t]);e--)n=null;n||(n={},r.push(n)),n[t]=i}function H(e,t){this.registerTiming(e,"start",t)}function $(e,t){this.registerTiming(e,"end",t)}var j={now:Date.now},W=window&&window.performance,G=new D(W||j);G.forceRegisterStartTiming("load_vivliostyle");var q={profiler:{registerStartTiming:G.registerStartTiming,registerEndTiming:G.registerEndTiming,printTimings:G.printTimings,disable:G.disable,enable:G.enable}},X=navigator.userAgent.includes("Chrome")?"chromium":navigator.userAgent.includes("Firefox")?"firefox":navigator.userAgent.includes("AppleWebKit")?"webkit":"unknown",Y=/^[\s\p{Zs}\p{P}\p{Mn}]*[\p{L}\p{N}]\p{Mn}*(?:[\s\p{Zs}]*\p{P}\p{Mn}*)*/u,K="data-adapt-eloff",Z={};function J(e){return JSON.parse(e)}function Q(e){let t=e.match(/^([^#]*)/);return t?t[1]:e}var ee=window.location.href;function te(e){ee=e}var ie=window.location.href;function ne(e){ie=e}function re(e,t){if(/^data:/i.test(t))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);let i;if(t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`),e.match(/^\/\//))return i=t.match(/^(\w{2,}:)\/\//),i?i[1]+e:e;if(e.match(/^\//))return i=t.match(/^(\w{2,}:\/\/[^\/]+)\//),i?i[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=function(e){let t=e.match(/^([^#?]*)/);return t?t[1]:e}(t),e.match(/^#/))return t+e;let n=t.lastIndexOf("/");if(n<0)return e;let r=t.substr(0,n+1)+e,o="";for(i=r.match(/^([^?#]*)([?#].*)$/),i&&(r=i[1],o=i[2]);n=r.indexOf("/../"),!(n<=0);){let e=r.lastIndexOf("/",n-1);if(e<=0)break;r=r.substr(0,e)+r.substr(n+3)}return r.replace(/\/(\.\/)+/g,"/")+o}function oe(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(?:#|%23)file-(.*)-(\w+)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[3]}.${t[4]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}function se(e){return null==e?e:e.toString()}var ae=class{constructor(){h(this,"queue",[null])}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){let i=Math.floor(t/2),n=this.queue[i];if(n.compare(e)>0)return void(this.queue[t]=e);this.queue[t]=n,t=i}this.queue[1]=e}peek(){return this.queue[1]}remove(){let e=this.queue[1],t=this.queue.pop(),i=this.queue.length;if(i>1){let e=1;for(;;){let n=2*e;if(n>=i)break;if(this.queue[n].compare(t)>0)n+1<i&&this.queue[n+1].compare(this.queue[n])>0&&n++;else{if(!(n+1<i&&this.queue[n+1].compare(t)>0))break;n++}this.queue[e]=this.queue[n],e=n}this.queue[e]=t}return e}},le=["","-webkit-","-moz-"],he={};function ue(e,t){return CSS.supports(e+t,"unset")}function ce(e,t,i){let n=null==e?void 0:e.style;if(!n)return;if(t.startsWith("--"))return void n.setProperty(t,i||" ");let r=function(e){let t=he[e];if(t||null===t)return t;switch(e){case"behavior":case"template":case"ua-list-item-count":case"x-first-pseudo":return he[e]=null,null;case"text-combine-upright":if(ue("-webkit-","text-combine")&&!ue("","text-combine-upright"))return he[e]=["-webkit-text-combine"],["-webkit-text-combine"]}for(let i of le)if(ue(i,e))return t=[i+e],he[e]=t,t;return R.warn("Property not supported by the browser: ",e),he[e]=null,null}(t);if(r)for(let e of r){switch(e){case"-webkit-text-combine":if("all"===i)i="horizontal";break;case"text-combine-upright":if("all"===i)n.setProperty("text-indent","0")}n.setProperty(e,i)}}function de(e,t,i){try{let i=he[t];return e.style.getPropertyValue(i?i[0]:t)}catch(e){}return i||""}function pe(e){let t=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","lang");return!t&&"http://www.w3.org/1999/xhtml"==e.namespaceURI&&(t=e.getAttribute("lang")),t}var fe=class{constructor(){h(this,"list",[])}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){let e=this.list.join("");return this.list=[e],e}};function ge(e){return`\\${e.charCodeAt(0).toString(16)} `}function me(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,ge)}function be(e){return e.replace(/[\u0000-\u001F"\\]/g,ge)}function ve(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function ye(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function we(e,t){return e.replace(/[^-a-zA-Z0-9_]/g,function(e){return function(e,t){return(t="string"==typeof t?t:"\\u")+(65536|e.charCodeAt(0)).toString(16).substr(1)}(e,t)})}function xe(e){return we(e)}function Se(e,t){t="string"==typeof t?t:"\\u";let i=new RegExp(`${xe(t)}[0-9a-fA-F]{4}`,"g");return e.replace(i,function(e){return function(e,t){return t="string"==typeof t?t:"\\u",0===e.indexOf(t)?String.fromCharCode(parseInt(e.substring(t.length),16)):e}(e,t)})}function Ce(e,t){let i=0,n=e;for(;;){if(0==i||t(i-1),n==e||t(n),i==n)return i;let r=i+n>>1;t(r)?n=r:i=r+1}}function ke(e,t){return e-t}function Ee(e,t){let i={};for(let n of e){let e=t(n);e&&!i[e]&&(i[e]=n)}return i}function Pe(e,t){let i={};for(let n of e){let e=t(n);e&&(i[e]?i[e].push(n):i[e]=[n])}return i}var Ne=class{constructor(){h(this,"listeners",{})}dispatchEvent(e){let t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let i=0;i<t.length;i++)t[i](e)}}addEventListener(e,t,i){if(i)return;let n=this.listeners[e];n?n.includes(t)||n.push(t):this.listeners[e]=[t]}removeEventListener(e,t,i){if(i)return;let n=this.listeners[e];if(n){let e=n.indexOf(t);e>=0&&n.splice(e,1)}}},Te={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function Ie(e){if(1==e.nodeType){let t=e.getAttribute("id");if(t)return t}return null}function Ae(e){return`^${e}`}function _e(e){return e.replace(/[\[\]\(\),=;^]/g,Ae)}function Re(e){return e.substr(1)}function Le(e){return e&&e.replace(/\^[\[\]\(\),=;^]/g,Re)}function Fe(e){let t=[];do{let i=e.match(/^(\^,|[^,])*/),n=Le(i[0]);if(!(e=e.substr(i[0].length+1))&&!t.length)return n;t.push(n)}while(e);return t}function Oe(e){let t={};for(;e;){let i=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!i)return t;t[i[1]]=Fe(i[2]),e=e.substr(i[0].length)}return t}var Be=class{appendTo(e){e.append("!")}applyTo(e){return!1}},Me=class{constructor(e,t,i){this.index=e,this.id=t,this.sideBias=i}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(1!=e.node.nodeType)throw new Error("E_CFI_NOT_ELEMENT");let t,i=e.node,n=i.children,r=n.length,o=Math.floor(this.index/2)-1;if(o<0||0==r)t=i.firstChild,e.node=t||i;else{if(t=n[Math.min(o,r-1)],1&this.index){let i=t.nextSibling;i&&1!=i.nodeType?t=i:e.after=!0}e.node=t}if(this.id&&(e.after||this.id!=Ie(e.node))){let t=i.ownerDocument.getElementById(this.id);t?e.node=t:R.warn("E_CFI_ID_MISMATCH:",this.id)}return e.sideBias=this.sideBias,!0}},ze=class{constructor(e,t,i,n){this.offset=e,this.textBefore=t,this.textAfter=i,this.sideBias=n}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,i=e.node;for(;;){let e=i.nodeType;if(1==e)break;let n=i.nextSibling;if(3<=e&&e<=5){let e=i.textContent.length;if(t<=e)break;if(!n){t=e;break}t-=e}if(!n){t=0;break}i=n}e.node=i,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(_e(this.textBefore)),e.append(","),this.textAfter&&e.append(_e(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}},De=class e{constructor(){h(this,"steps",null)}fromString(e){let t=e.match(/^#?epubcfi\((.*)\)$/);if(!t)throw new Error("E_CFI_NOT_CFI");let i=decodeURIComponent(t[1]),n=0,r=[];for(;;){let e;switch(i.charAt(n)){case"/":{if(n++,t=i.substr(n).match(/^(0|[1-9][0-9]*)(\[(.*?)(;([^\]]|\^\])*)?\])?/),!t)throw new Error("E_CFI_NUMBER_EXPECTED");n+=t[0].length;let o=parseInt(t[1],10),s=t[3];e=Oe(t[4]),r.push(new Me(o,s,se(e.s)));break}case":":{if(n++,t=i.substr(n).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/),!t)throw new Error("E_CFI_NUMBER_EXPECTED");n+=t[0].length;let o=parseInt(t[1],10),s=t[4];s&&(s=Le(s));let a=t[7];a&&(a=Le(a)),e=Oe(t[10]),r.push(new ze(o,s,a,se(e.s)));break}case"!":n++,r.push(new Be);break;case"~":case"@":case"":return void(this.steps=r);default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(t){let i={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let t=0;t<this.steps.length;t++)if(!this.steps[t].applyTo(i)){i.ref=new e,i.ref.steps=this.steps.slice(t+1);break}return i}trim(e,t){return e.replace(/\s+/g," ").match(t?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(e,t,i,n){let r=[],o=e.parentNode,s="",a="";for(;e;){switch(e.nodeType){case 3:case 4:case 5:{let n=e.textContent,r=n.length;i?(t+=r,s||(s=n)):(t>r&&(t=r),i=!0,s=n.substr(0,t),a=n.substr(t)),e=e.previousSibling;continue}case 8:e=e.previousSibling;continue}break}for((t>0||s||a)&&(s=this.trim(s,!1),a=this.trim(a,!0),r.push(new ze(t,s,a,n)),n=null);o&&o&&9!=o.nodeType;){let t=i?null:Ie(e),s=i?1:0;for(;e;)1==e.nodeType&&(s+=2),e=e.previousSibling;r.push(new Me(s,t,n)),n=null,e=o,o=o.parentNode,i=!1}r.reverse(),this.steps?(r.push(new Be),this.steps=r.concat(this.steps)):this.steps=r}toString(){if(!this.steps)return"";let e=new fe;e.append("epubcfi(");for(let t=0;t<this.steps.length;t++)this.steps[t].appendTo(e);return e.append(")"),e.toString().replace(/%/g,"%25")}};function Ve(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}var Ue={fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0},He={};function $e(e,t,i,n){let r=Math.min((e-0)/i,(t-0)/n);return`matrix(${r},0,0,${r},0,0)`}function je(e){return`"${be(`${e}`)}"`}function We(e){return me(`${e}`)}function Ge(e,t){return e?`${me(e)}.${me(t)}`:me(t)}var qe=0,Xe=class{constructor(e,t){if(this.parent=e,this.resolver=t,h(this,"scopeKey"),h(this,"children",[]),h(this,"zero"),h(this,"one"),h(this,"_true"),h(this,"_false"),h(this,"values",{}),h(this,"funcs",{}),h(this,"builtIns",{}),this.scopeKey="S"+qe++,this.zero=new _t(this,0),this.one=new _t(this,1),this._true=new _t(this,!0),this._false=new _t(this,!1),e&&e.children.push(this),!e){let e=this.builtIns;e.floor=Math.floor,e.ceil=Math.ceil,e.round=Math.round,e.sqrt=Math.sqrt,e.min=Math.min,e.max=Math.max,e.letterbox=$e,e["css-string"]=je,e["css-name"]=We,e.typeof=e=>typeof e,this.defineBuiltInName("page-width",function(){return this.pageWidth()}),this.defineBuiltInName("page-height",function(){return this.pageHeight()}),this.defineBuiltInName("pref-font-family",function(){return this.pref.fontFamily}),this.defineBuiltInName("pref-night-mode",function(){return this.pref.nightMode}),this.defineBuiltInName("pref-hyphenate",function(){return this.pref.hyphenate}),this.defineBuiltInName("pref-margin",function(){return this.pref.margin}),this.defineBuiltInName("pref-line-height",function(){return this.pref.lineHeight}),this.defineBuiltInName("pref-column-width",function(){return this.pref.columnWidth*this.fontSize}),this.defineBuiltInName("pref-horizontal",function(){return this.pref.horizontal}),this.defineBuiltInName("pref-spread-view",function(){return this.pref.spreadView}),this.defineBuiltInName("pub-title",function(){return je(this.pubTitle?this.pubTitle:"")}),this.defineBuiltInName("doc-title",function(){return je(this.docTitle?this.docTitle:"")})}}defineBuiltInName(e,t){this.values[e]=new Tt(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}};function Ye(e){switch(null==e?void 0:e.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}var Ke={px:1,in:96,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function Ze(e){switch(e){case"q":return!CSS.supports("font-size","1q");case"lh":return!CSS.supports("line-height","1lh");case"rem":case"rlh":return!0;default:return!1}}var Je=class{constructor(e,t,i,n){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=i,h(this,"actualPageWidth",null),h(this,"pageWidth"),h(this,"actualPageHeight",null),h(this,"pageHeight"),h(this,"initialFontSize"),h(this,"rootFontSize",null),h(this,"isRelativeRootFontSize",null),h(this,"fontSize"),h(this,"rootLineHeight",null),h(this,"pref"),h(this,"scopes",{}),h(this,"pageAreaWidth",null),h(this,"pageAreaHeight",null),h(this,"pageVertical",null),h(this,"pubTitle",null),h(this,"docTitle",null),this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:i},this.initialFontSize=n,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:n},this.pref=Ue}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t,i){if(Ye(e)){let t=this.pageWidth()/100,n=this.pageHeight()/100,r=null!=this.pageAreaWidth?this.pageAreaWidth/100:t,o=null!=this.pageAreaHeight?this.pageAreaHeight/100:n,s=null!=i?i:this.pageVertical;switch(e){case"vw":return r;case"vh":return o;case"vi":return s?o:r;case"vb":return s?r:o;case"vmin":return r<o?r:o;case"vmax":return r>o?r:o;case"pvw":return t;case"pvh":return n;case"pvi":return s?n:t;case"pvb":return s?t:n;case"pvmin":return t<n?t:n;case"pvmax":return t>n?t:n}}return"em"==e||"rem"==e?t?this.initialFontSize:this.fontSize():"lh"==e||"rlh"==e?this.rootLineHeight:Ke[e]}evalName(e,t){do{let i=e.values[t];if(i||e.resolver&&(i=e.resolver.call(this,t,!1),i))return i;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,i,n){do{let r=e.funcs[t];if(r||e.resolver&&(r=e.resolver.call(this,t,!0),r))return r;let o=e.builtIns[t];if(o){if(n)return e.zero;let t=Array(i.length);for(let e=0;e<i.length;e++)t[e]=i[e].evaluate(this);return new _t(e,o.apply(this,t))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){let i="all"===e||!!this.pref.enabledMediaTypes[e];return t?!i:i}evalMediaTest(e,t){let i="",n=e.match(/^(min|max)-(.*)$/);n&&(i=n[1],e=n[2]);let r=null,o=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(r=t.evaluate(this))}switch(e){case"width":o=this.pageWidth();break;case"height":o=this.pageHeight();break;case"device-width":o=window.screen.availWidth;break;case"device-height":o=window.screen.availHeight;break;case"color":o=window.screen.pixelDepth}if(null!=o&&null!=r)switch(i){case"min":return o>=Number(r);case"max":return o<=Number(r);default:return o==r}else if(null!=o&&null==t)return 0!==o;return!1}evalSupportsTest(e,t,i){return!1}queryVal(e,t){let i=e&&this.scopes[e.scopeKey];return i?i[t]:void 0}storeVal(e,t,i){this.getScopeContext(e)[t]=i}},Qe=class{constructor(e){this.scope=e,h(this,"key"),this.scope=e,this.key="_"+qe++}toString(){let e=new fe;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,i){return e===this}dependOuter(e,t,i){let n=i[this.key];if(null!=n)return n!==He&&n;{i[this.key]=He;let n=this.dependCore(e,t,i);return i[this.key]=n,n}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return void 0!==t||(t=this.evaluateCore(e),this.scope&&e.storeVal(this.scope,this.key,t)),t}isMediaName(){return!1}},et=class extends Qe{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,i){return e===this||this.val.dependOuter(e,t,i)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){let i=this.val.expand(e,t);return i===this.val?this:new this.constructor(this.scope,i)}},tt=class extends Qe{constructor(e,t,i){super(e),this.lhs=t,this.rhs=i}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.lhs.evaluate(e),i=this.rhs.evaluate(e);return this.evalInfix(t,i)}dependCore(e,t,i){return e===this||this.lhs.dependOuter(e,t,i)||this.rhs.dependOuter(e,t,i)}appendTo(e,t){let i=this.getPriority();i<=t&&e.append("("),this.lhs.appendTo(e,i),e.append(this.getOp()),this.rhs.appendTo(e,i),i<=t&&e.append(")")}expand(e,t){let i=this.lhs.expand(e,t),n=this.rhs.expand(e,t);return i===this.lhs&&n===this.rhs?this:new this.constructor(this.scope,i,n)}},it=class extends tt{constructor(e,t,i){super(e,t,i)}getPriority(){return 1}},nt=class extends tt{constructor(e,t,i){super(e,t,i)}getPriority(){return 2}},rt=class extends tt{constructor(e,t,i){super(e,t,i)}getPriority(){return 3}},ot=class extends tt{constructor(e,t,i){super(e,t,i)}getPriority(){return 4}},st=class extends et{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}},at=class extends st{constructor(e,t){super(e,t)}getOp(){return"not "}},lt=class extends et{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}},ht=class extends it{constructor(e,t,i){super(e,t,i)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}},ut=class extends ht{constructor(e,t,i){super(e,t,i)}getOp(){return" and "}},ct=class extends it{constructor(e,t,i){super(e,t,i)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}},dt=class extends ct{constructor(e,t,i){super(e,t,i)}getOp(){return", "}},pt=class extends ct{constructor(e,t,i){super(e,t,i)}getOp(){return" or "}},ft=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return"<"}evalInfix(e,t){return e<t}},gt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return"<="}evalInfix(e,t){return e<=t}},mt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return">"}evalInfix(e,t){return e>t}},bt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return">="}evalInfix(e,t){return e>=t}},vt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return"=="}evalInfix(e,t){return e==t}},yt=class extends nt{constructor(e,t,i){super(e,t,i)}getOp(){return"!="}evalInfix(e,t){return e!=t}},wt=class extends rt{constructor(e,t,i){super(e,t,i)}getOp(){return"+"}evalInfix(e,t){return e+t}},xt=class extends rt{constructor(e,t,i){super(e,t,i)}getOp(){return" - "}evalInfix(e,t){return e-t}},St=class extends ot{constructor(e,t,i){super(e,t,i)}getOp(){return"*"}evalInfix(e,t){return e*t}},Ct=class extends ot{constructor(e,t,i){super(e,t,i)}getOp(){return"/"}evalInfix(e,t){return e/t}},kt=class extends ot{constructor(e,t,i){super(e,t,i)}getOp(){return"%"}evalInfix(e,t){return e%t}},Et=class extends Qe{constructor(e,t,i){var n;super(e),this.num=t,h(this,"unit"),this.unit=null!=(n=null==i?void 0:i.toLowerCase())?n:""}appendTo(e,t){e.append(this.num.toString()),e.append(me(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},Pt=class extends Qe{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,i){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,i)}},Nt=class extends Qe{constructor(e,t,i){super(e),this.not=t,this.name=i}appendTo(e,t){this.not&&e.append("not "),e.append(me(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},Tt=class extends Qe{constructor(e,t,i){super(e),this.fn=t,this.str=i}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}},It=class e extends Qe{constructor(e,t,i){super(e),this.qualifiedName=t,this.params=i}appendTo(e,t){e.append(this.qualifiedName),function(e,t){e.append("(");for(let i=0;i<t.length;i++)i&&e.append(","),t[i].appendTo(e,0);e.append(")")}(e,this.params)}evaluateCore(e){return e.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(e,this.params).evaluate(e)}dependCore(e,t,i){if(e===this)return!0;for(let n=0;n<this.params.length;n++)if(this.params[n].dependOuter(e,t,i))return!0;return t.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(e,t,i)}expand(t,i){let n=function(e,t,i){let n=t;for(let r=0;r<t.length;r++){let o=t[r].expand(e,i);if(t!==n)n[r]=o;else if(o!==t[r]){n=Array(t.length);for(let e=0;e<r;e++)n[e]=t[e];n[r]=o}}return n}(t,this.params,i);return n===this.params?this:new e(this.scope,this.qualifiedName,n)}},At=class e extends Qe{constructor(e,t,i,n){super(e),this.cond=t,this.ifTrue=i,this.ifFalse=n}appendTo(e,t){t>0&&e.append("("),this.cond.appendTo(e,0),e.append("?"),this.ifTrue.appendTo(e,0),e.append(":"),this.ifFalse.appendTo(e,0),t>0&&e.append(")")}evaluateCore(e){return this.cond.evaluate(e)?this.ifTrue.evaluate(e):this.ifFalse.evaluate(e)}dependCore(e,t,i){return e===this||this.cond.dependOuter(e,t,i)||this.ifTrue.dependOuter(e,t,i)||this.ifFalse.dependOuter(e,t,i)}expand(t,i){let n=this.cond.expand(t,i),r=this.ifTrue.expand(t,i),o=this.ifFalse.expand(t,i);return n===this.cond&&r===this.ifTrue&&o===this.ifFalse?this:new e(this.scope,n,r,o)}},_t=class extends Qe{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(be(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}},Rt=class e extends Qe{constructor(e,t,i){super(e),this.name=t,this.value=i}appendTo(e,t){e.append("("),e.append(be(this.name.name)),e.append(":"),this.value.appendTo(e,0),e.append(")")}evaluateCore(e){return e.evalMediaTest(this.name.name,this.value)}dependCore(e,t,i){return e===this||this.value.dependOuter(e,t,i)}expand(t,i){let n=this.value.expand(t,i);return n===this.value?this:new e(this.scope,this.name,n)}},Lt=class extends Qe{constructor(e,t,i,n){super(e),this.name=t,this.value=i,this.isFunc=n}appendTo(e,t){this.isFunc&&e.append(this.name),e.append("("),!this.isFunc&&this.name&&(e.append(this.name),e.append(":")),e.append(this.value),e.append(")")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},Ft=class extends Qe{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){let i=t[this.index];if(!i)throw new Error(`Parameter missing: ${this.index}`);return i}};function Ot(e,t,i){return t===e._false||t===e.zero||i==e._false||i==e.zero?e._false:t===e._true||t===e.one?i:i===e._true||i===e.one?t:new ht(e,t,i)}function Bt(e,t,i){return t===e.zero?i:i===e.zero?t:new wt(e,t,i)}function Mt(e,t,i){return t===e.zero?new lt(e,i):i===e.zero?t:new xt(e,t,i)}function zt(e,t,i){return t===e.zero||i===e.zero?e.zero:t===e.one?i:i===e.one?t:new St(e,t,i)}function Dt(e,t,i){return t===e.zero?e.zero:i===e.one?t:new Ct(e,t,i)}var Vt=class{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this);return null}visitEmpty(e){return null}visitSlash(e){return null}visitStr(e){return null}visitIdent(e){return null}visitNumeric(e){return null}visitNum(e){return null}visitInt(e){return this.visitNum(e)}visitHexColor(e){return null}visitURL(e){return null}visitURange(e){return null}visitSpaceList(e){return this.visitValues(e.values),null}visitCommaList(e){return this.visitValues(e.values),null}visitFunc(e){return this.visitValues(e.values),null}visitExpr(e){return null}},Ut=class extends Vt{constructor(){super(),h(this,"error",!1)}visitValues(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i],r=n.visit(this);if(this.error)return[];if(t)t[i]=r;else if(n!==r){t=new Array(e.length);for(let n=0;n<i;n++)t[n]=e[n];t[i]=r}}return t||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let t=this.visitValues(e.values);return this.error?jt:t===e.values?e:new ri(t)}visitCommaList(e){let t=this.visitValues(e.values);return this.error?jt:t===e.values?e:new oi(t)}visitFunc(e){let t=this.visitValues(e.values);return this.error?jt:t===e.values?e:new si(e.name,t)}visitExpr(e){return e}},Ht=class{toString(){let e=new fe;return this.appendTo(e,!0),e.toString()}stringValue(){let e=new fe;return this.appendTo(e,!1),e.toString()}toExpr(e,t){return null}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){return this}},$t=class e extends Ht{static get instance(){return this.empty||(this.empty=new e),this.empty}constructor(){super()}toExpr(e,t){return new _t(e,"")}appendTo(e,t){}visit(e){return e.visitEmpty(this)}};h($t,"empty");var jt=$t.instance,Wt=class e extends Ht{static get instance(){return this.slash||(this.slash=new e),this.slash}constructor(){super()}toExpr(e,t){return new _t(e,"/")}appendTo(e,t){e.append("/")}visit(e){return e.visitSlash(this)}};h(Wt,"slash");var Gt=Wt.instance,qt=class extends Ht{constructor(e){super(),this.str=e}toExpr(e,t){return new _t(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(be(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}},Xt={},Yt=class extends Ht{constructor(e){if(super(),this.name=e,Xt[e])throw new Error("E_INVALID_CALL");Xt[e]=this}toExpr(e,t){return new _t(e,this.name)}appendTo(e,t){t?e.append(me(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function Kt(e){let t=Xt[e];return t||(t=new Yt(e)),t}var Zt=class extends Ht{constructor(e,t){var i;super(),this.num=e,h(this,"unit"),this.unit=null!=(i=null==t?void 0:t.toLowerCase())?i:""}toExpr(e,t){return 0==this.num?e.zero:t&&"%"==this.unit?100==this.num?t:new St(e,t,new _t(e,this.num/100)):new Et(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},Jt=class extends Ht{constructor(e){super(),this.num=e}toExpr(e,t){return 0==this.num?e.zero:1==this.num?e.one:new _t(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},Qt=class extends Jt{constructor(e){super(e)}visit(e){return e.visitInt(this)}},ei=class extends Ht{constructor(e){super(),this.hex=e}appendTo(e,t){e.append("#"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},ti=class extends Ht{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(be(this.url)),e.append('")')}visit(e){return e.visitURL(this)}},ii=class extends Ht{constructor(e){super(),this.urangeText=e}appendTo(e,t){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function ni(e,t,i,n){var r,o;let s=t.length;if(s>0){null==(r=t[0])||r.appendTo(e,n);for(let r=1;r<s;r++)e.append(i),null==(o=t[r])||o.appendTo(e,n)}}var ri=class extends Ht{constructor(e){super(),this.values=e}appendTo(e,t){ni(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},oi=class extends Ht{constructor(e){super(),this.values=e}appendTo(e,t){ni(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}},si=class extends Ht{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(me(this.name)),e.append("("),ni(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}},ai=class extends Ht{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){this.expr instanceof _t||this.expr instanceof Et?this.expr.appendTo(e,0):(e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},li=class extends Ht{constructor(e){super(),this.text=e}appendTo(e,t){e.append(this.text||" ")}};function hi(e,t){if(e){if(e.isNumeric()){let i=e;return t.queryUnitSize(i.unit,!1)*i.num}if(e.isNum())return e.num}return 0}function ui(e,t){return new Zt(hi(e,t),"px")}var ci={absolute:Kt("absolute"),all:Kt("all"),always:Kt("always"),anywhere:Kt("anywhere"),auto:Kt("auto"),avoid:Kt("avoid"),balance:Kt("balance"),balance_all:Kt("balance-all"),block:Kt("block"),block_end:Kt("block-end"),block_start:Kt("block-start"),both:Kt("both"),bottom:Kt("bottom"),border_box:Kt("border-box"),break_all:Kt("break-all"),break_word:Kt("break-word"),clip:Kt("clip"),crop:Kt("crop"),cross:Kt("cross"),column:Kt("column"),discard:Kt("discard"),exclusive:Kt("exclusive"),_false:Kt("false"),fixed:Kt("fixed"),flex:Kt("flex"),flow_root:Kt("flow-root"),footnote:Kt("footnote"),footer:Kt("footer"),grid:Kt("grid"),header:Kt("header"),hidden:Kt("hidden"),horizontal_tb:Kt("horizontal-tb"),inherit:Kt("inherit"),initial:Kt("initial"),inline:Kt("inline"),inline_block:Kt("inline-block"),inline_end:Kt("inline-end"),inline_start:Kt("inline-start"),inside:Kt("inside"),keep:Kt("keep"),landscape:Kt("landscape"),left:Kt("left"),line:Kt("line"),list_item:Kt("list-item"),ltr:Kt("ltr"),manual:Kt("manual"),max_content:Kt("max-content"),min_content:Kt("min-content"),none:Kt("none"),normal:Kt("normal"),oeb_page_foot:Kt("oeb-page-foot"),oeb_page_head:Kt("oeb-page-head"),outside:Kt("outside"),padding_box:Kt("padding-box"),page:Kt("page"),relative:Kt("relative"),revert:Kt("revert"),right:Kt("right"),same:Kt("same"),scale:Kt("scale"),snap_block:Kt("snap-block"),snap_inline:Kt("snap-inline"),solid:Kt("solid"),spread:Kt("spread"),_static:Kt("static"),rtl:Kt("rtl"),table:Kt("table"),table_caption:Kt("table-caption"),table_cell:Kt("table-cell"),table_footer_group:Kt("table-footer-group"),table_header_group:Kt("table-header-group"),table_row:Kt("table-row"),top:Kt("top"),transparent:Kt("transparent"),unset:Kt("unset"),vertical_lr:Kt("vertical-lr"),vertical_rl:Kt("vertical-rl"),visible:Kt("visible"),_true:Kt("true")},di=new Zt(100,"%"),pi=new Zt(100,"pvw"),fi=new Zt(100,"pvh"),gi=new Zt(0,"px");new ii("U+0-10FFFF");var mi={"font-size":1,"line-height":2,color:3};function bi(e){return e===ci.inherit||e===ci.initial||e===ci.revert||e===ci.unset}function vi(e,t){return(mi[e]||Number.MAX_VALUE)-(mi[t]||Number.MAX_VALUE)}function yi(e){return(null==e?void 0:e.length)>2&&e.startsWith("--")}var wi=class{constructor(e,t,i,n){this.x1=e,this.y1=t,this.x2=i,this.y2=n}},xi=class{constructor(e,t){this.x=e,this.y=t}},Si=class{constructor(e,t,i,n){this.left=e,this.top=t,this.right=i,this.bottom=n}},Ci=class{constructor(e,t,i,n){this.low=e,this.high=t,this.winding=i,this.shapeId=n}},ki=class{constructor(e,t,i,n){this.y1=e,this.y2=t,this.x1=i,this.x2=n,h(this,"left",null),h(this,"right",null)}};function Ei(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}var Pi=class e{constructor(e){this.points=e}addSegments(e,t){let i=this.points,n=i.length,r=i[n-1];for(let o=0;o<n;o++){let n,s=i[o];n=r.y<s.y?new Ci(r,s,1,t):new Ci(s,r,-1,t),e.push(n),r=s}}withOffset(t,i){let n=[];for(let e of this.points)n.push(new xi(e.x+t,e.y+i));return new e(n)}};function Ni(e,t,i,n){let r=[];for(let o=0;o<20;o++){let s=2*o*Math.PI/20;r.push(new xi(e+i*Math.sin(s),t+n*Math.cos(s)))}return new Pi(r)}function Ti(e,t,i,n){return new Pi([new xi(e,t),new xi(i,t),new xi(i,n),new xi(e,n)])}var Ii=class{constructor(e,t,i,n){this.x=e,this.winding=t,this.shapeId=i,this.lowOrHigh=n}};function Ai(e,t){let i=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(i))throw new Error("Bad intersection");return i}function _i(e,t,i,n){let r,o,s,a;t.high.y<i&&R.warn("Error: inconsistent segment (1)"),t.low.y<=i?(r=Ai(t,i),o=t.winding):(r=t.low.x,o=0),t.high.y>=n?(s=Ai(t,n),a=t.winding):(s=t.high.x,a=0),r<s?(e.push(new Ii(r,o,t.shapeId,-1)),e.push(new Ii(s,a,t.shapeId,1))):(e.push(new Ii(s,a,t.shapeId,-1)),e.push(new Ii(r,o,t.shapeId,1)))}function Ri(e,t,i){let n,r=t+i,o=Array(r),s=Array(r);for(n=0;n<=r;n++)o[n]=0,s[n]=0;let a=[],l=!1,h=e.length;for(let i=0;i<h;i++){let h=e[i];o[h.shapeId]+=h.winding,s[h.shapeId]+=h.lowOrHigh;let u=!1;for(n=0;n<t;n++)if(o[n]&&!s[n]){u=!0;break}if(u)for(n=t;n<=r;n++)if(o[n]||s[n]){u=!1;break}l!=u&&(a.push(h.x),l=u)}return a}function Li(e,t){return t?Math.ceil(e/t)*t:e}function Fi(e,t){return t?Math.floor(e/t)*t:e}function Oi(e){return new wi(e.y1,-e.x2,e.y2,-e.x1)}function Bi(e){return new wi(-e.y2,e.x1,-e.y1,e.x2)}function Mi(e){return new Pi(e.points.map(e=>function(e){return new xi(e.y,-e.x)}(e)))}function zi(e,t){let i=t.length-1,n=new ki(e.y2,e.y2,e.x1,e.x2);for(;i>=0;){let e=n;n=t[i],(n.y2-n.y1<1||n.x1==e.x1&&n.x2==e.x2)&&(e.y1=n.y1,t.splice(i,1),n=e),i--}}function Di(e,t){let i=0,n=e.length;for(;i<n;){let r=Math.floor((i+n)/2);t>=e[r].y2?i=r+1:n=r}return i}function Vi(e,t){if(!e.length)return t;let i,n,r=t.y1;for(n=0;n<e.length&&(i=e[n],!(i.y2>t.y1&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2));n++)r=Math.max(r,i.y2);let o=r;for(;n<e.length&&(i=e[n],!(i.y1>=t.y2||i.x1-.1>t.x1||i.x2+.1<t.x2));n++)o=i.y2;return o=n===e.length?t.y2:Math.min(o,t.y2),o<=r?null:new wi(t.x1,r,t.x2,o)}function Ui(e,t){if(!e.length)return t;let i,n,r=t.y2;for(n=e.length-1;n>=0&&(i=e[n],!(n===e.length-1&&i.y2<t.y2))&&!(i.y1<t.y2&&i.x1-.1<=t.x1&&i.x2+.1>=t.x2);n--)r=Math.min(r,i.y1);let o=Math.min(r,i.y2);for(;n>=0&&(i=e[n],!(i.y2<=t.y1||i.x1-.1>t.x1||i.x2+.1<t.x2));n--)o=i.y1;return o=Math.max(o,t.y1),r<=o?null:new wi(t.x1,o,t.x2,r)}var Hi=class extends Vt{constructor(){super(),h(this,"propSet",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}},$i=class extends Vt{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}};function ji(e,t){if(e){let i=new $i(t);try{return e.visit(i),i.value}catch(e){R.warn(e,"toInt: ")}}return t}var Wi=class extends Vt{constructor(){super(),h(this,"collect",!1),h(this,"coords",[]),h(this,"name",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&0==e.num&&this.coords.push(new Zt(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,i,n,r){if(this.coords.length>0){let o=[];switch(this.coords.forEach((e,t)=>{if("%"==e.unit){let r=t%2==0?i:n;3==t&&"circle"==this.name&&(r=Math.sqrt((i*i+n*n)/2)),o.push(e.num*r/100)}else o.push(e.num*r.queryUnitSize(e.unit,!1))}),this.name){case"polygon":if(o.length%2==0){let i=[];for(let n=0;n<o.length;n+=2)i.push(new xi(e+o[n],t+o[n+1]));return new Pi(i)}break;case"rectangle":if(4==o.length)return Ti(e+o[0],t+o[1],e+o[0]+o[2],t+o[1]+o[3]);break;case"ellipse":if(4==o.length)return Ni(e+o[0],t+o[1],o[2],o[3]);break;case"circle":if(3==o.length)return Ni(e+o[0],t+o[1],o[2],o[2])}}return null}};function Gi(e,t,i,n,r,o){if(e){let s=new Wi;try{return e.visit(s),s.getShape(t,i,n,r,o)}catch(e){R.warn(e,"toShape:")}}return Ti(t,i,t+n,i+r)}var qi=class extends Vt{constructor(e){super(),this.reset=e,h(this,"counters",{}),h(this,"name",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function Xi(e,t){let i=new qi(t);try{e.visit(i)}catch(e){R.warn(e,"toCounters:")}return i.counters}var Yi=class extends Ut{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new ti(this.transformer.transformURL(e.url,this.baseUrl))}};function Ki(e){let t={};return Object.keys(e).forEach(i=>{t[i]=Array.from(e[i])}),t}function Zi(e,t){if("content"===t){let t=e.cloneNode(!0);return t.querySelectorAll("[data-adapt-pseudo]").forEach(e=>e.remove()),t.textContent||""}{let i=e.querySelector(`[data-adapt-pseudo="${t}"]`);return i&&i.textContent||""}}var Ji=class{constructor(e,t){this.targetId=e,this.resolved=t,h(this,"pageCounters",null),h(this,"spineIndex",-1),h(this,"pageIndex",-1)}equals(e){return this===e||!!e&&(this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex)}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},Qi=class{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}},en=class{constructor(e,t,i,n){this.counterStore=e,this.baseURL=t,this.rootScope=i,this.pageScope=n,h(this,"styler",null),h(this,"namedStringValues",{}),h(this,"runningElements",{})}setStyler(e){this.styler=e}getFragment(e){let t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(re(e,this.baseURL),this.baseURL);return"#"===t.charAt(0)&&(t=t.substring(1)),t}getPageCounterVal(e,t){let i=()=>{let t=this.counterStore.currentPageCounters[e];return t&&t.length?t[t.length-1]:null},n=new Tt(this.pageScope,()=>t(i()),`page-counter-${e}`);return this.counterStore.registerPageCounterExpr(e,e=>t(e[e.length-1]),n),n}getPageCountersVal(e,t){let i=()=>this.counterStore.currentPageCounters[e]||[],n=new Tt(this.pageScope,()=>t(i()),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,n),n}getTargetCounters(e,t,i){let n=this.counterStore.countersById[t];return!n&&i&&e&&(this.styler.styleUntilIdIsReached(e),n=this.counterStore.countersById[t]),n||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetPageText(e,t){if(this.counterStore.currentPage.elementsById[e]){let i=this.counterStore.currentPage.elementsById[e];if(i&&i.length>0){let e=i[0];return Zi(e,"before"===t||"after"===t||"marker"===t?t:"content")}return""}if(e in this.counterStore.pageTextById){let i=this.counterStore.pageTextById[e];return void 0!==i[t]?i[t]:i.content||""}return null}getTargetCounterVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e),o=this.getTargetCounters(n,r,!1);if(o&&o[t]){let e=o[t];return new _t(this.rootScope,i(e[e.length-1]||null))}let s=new Tt(this.pageScope,()=>{if(o=this.getTargetCounters(n,r,!0),o){if(o[t]){let e=o[t];return i(e[e.length-1]||null)}{let e=this.getTargetPageCounters(r);if(e){if(this.counterStore.resolveReference(r),e[t]){let n=e[t];return i(n[n.length-1]||null)}return i(0)}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counter-${t}-of-${e}`);return this.counterStore.registerTargetCounterExpr(t,i,s,r),s}getTargetCountersVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e);return new Tt(this.pageScope,()=>{let e=this.getTargetPageCounters(r);if(e){this.counterStore.resolveReference(r);let o=e[t]||[],s=this.getTargetCounters(n,r,!0)[t]||[];return i(o.concat(s))}return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counters-${t}-of-${e}`)}getTargetTextVal(e,t){let i=this.getTransformedId(e),n=new Tt(this.pageScope,()=>{if("first-letter"===t){let e=this.getTargetPageText(i,"before"),t=this.getTargetPageText(i,"content"),n=this.getTargetPageText(i,"after");if(null===e&&null===t&&null===n)return this.counterStore.saveReferenceOfCurrentPage(i,!1),"??";let r=(null!=e?e:"")+(null!=t?t:"")+(null!=n?n:"");this.counterStore.resolveReference(i);let o=r.match(Y);return o?o[0]:""}let e=this.getTargetPageText(i,t);return null!==e?(this.counterStore.resolveReference(i),e):(this.counterStore.saveReferenceOfCurrentPage(i,!1),"??")},`target-text-${t}-of-${e}`);return this.counterStore.registerTargetTextExpr(t,n,i),n}getNamedStringVal(e,t){return new Tt(this.pageScope,()=>this.getRunningValue(this.namedStringValues,e,t),`named-string-${t}-${e}`)}getRunningElementVal(e,t){return new Tt(this.pageScope,()=>this.getRunningValue(this.runningElements,e,t),`running-element-${t}-${e}`)}getRunningValue(e,t,i){let n=e[t];if(!n)return"";let r=Object.keys(n).map(e=>parseInt(e,10)).sort(ke),o=this.counterStore.currentPage,s=o.isBlankPage?o.offset-1:o.offset,a=o.isBlankPage?s:Math.max(s,...Array.from(o.container.querySelectorAll(`[${K}]`)).map(e=>parseInt(e.getAttribute(K),10))),l=-1,h=-1,u=-1,c=-1;for(let e=0;e<r.length;e++){let t=r[e],i=e>0?r[e-1]:-1,n=e<r.length-1?r[e+1]:-1;if(t>a)break;if(t>=s){if(l<0&&(l=t,c=-1),h<0)if(t===s)h=t;else{i<l&&(h=i);let e=o.container.querySelector(`[${K}="${t}"]`);if(e){let i=o.container.querySelector(`[${K}="${s}"]`);if(i||(i=o.container.querySelector(`[${K}="0"]`)),i)for(let n=i;n;n=n.firstElementChild)if(n===e){h=t;break}}else h<0&&(h=t)}u=t}else(n>a||n<0)&&(l=h=u=c=t)}return n[{first:l,start:h,last:u,"first-except":c}[i]]||""}setNamedString(e,t,i){(this.namedStringValues[e]||(this.namedStringValues[e]={}))[i]=t}setRunningElement(e,t){(this.runningElements[e]||(this.runningElements[e]={}))[t]=String(t)}},tn=class{constructor(e){this.documentURLTransformer=e,h(this,"countersById",{}),h(this,"pageCountersById",{}),h(this,"pageTextById",{}),h(this,"currentPageCounters",{}),h(this,"previousPageCounters",{}),h(this,"currentPageCountersStack",[]),h(this,"pageIndicesById",{}),h(this,"currentPage",null),h(this,"newReferencesOfCurrentPage",[]),h(this,"referencesToSolve",[]),h(this,"referencesToSolveStack",[]),h(this,"unresolvedReferences",{}),h(this,"resolvedReferences",{}),h(this,"pagesCounterExprs",[]),h(this,"pageCounterExprs",[]),h(this,"targetCounterExprs",[]),h(this,"targetTextExprs",[]),this.currentPageCounters.page=[0]}createCounterListener(e){return new Qi(this,e)}createCounterResolver(e,t,i){return new en(this,e,t,i)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){let t=this.currentPageCounters.page;t&&t.length?t[t.length-1]=e:this.currentPageCounters.page=[e]}updatePageCounters(e,t){this.previousPageCounters=Ki(this.currentPageCounters);let i,n=e["counter-reset"];if(n){let e=n.evaluate(t);e&&(i=Xi(e,!0))}if(i)for(let e in i)this.definePageCounter(e,i[e]);let r,o=e["counter-increment"];if(o){let e=o.evaluate(t);e&&(r=Xi(e,!1))}r?"page"in r||(r.page=1):(r={},r.page=1);for(let e in r){this.currentPageCounters[e]||this.definePageCounter(e,0);let t=this.currentPageCounters[e];t[t.length-1]+=r[e]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=Ki(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){let t=this.unresolvedReferences[e],i=this.resolvedReferences[e];i||(i=this.resolvedReferences[e]=[]);let n=!1;for(let r=0;r<this.referencesToSolve.length;){let o=this.referencesToSolve[r];if(o.targetId===e){if(o.resolve(),this.referencesToSolve.splice(r,1),t){let e=t.indexOf(o);e>=0&&t.splice(e,1)}i.push(o),n=!0}else r++}n||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some(t=>t.targetId===e)){let i=new Ji(e,t);this.newReferencesOfCurrentPage.push(i)}}finishPage(e,t){let i=Object.keys(this.currentPage.elementsById);if(i.length>0){let n=Ki(this.currentPageCounters);i.forEach(i=>{this.pageCountersById[i]=n;let r=this.currentPage.elementsById[i];if(r&&r.length>0){let e=r[0];this.pageTextById[i]={content:Zi(e,"content"),before:Zi(e,"before"),after:Zi(e,"after"),marker:Zi(e,"marker")}}let o=this.pageIndicesById[i];if(o&&o.pageIndex<t){let e=this.resolvedReferences[i];if(e){let t,n=this.unresolvedReferences[i];for(n||(n=this.unresolvedReferences[i]=[]);t=e.shift();)t.unresolve(),n.push(t)}}this.pageIndicesById[i]={spineIndex:e,pageIndex:t}})}let n,r=this.previousPageCounters;for(;n=this.newReferencesOfCurrentPage.shift();){let i;n.pageCounters=r,n.spineIndex=e,n.pageIndex=t,n.isResolved()?(i=this.resolvedReferences[n.targetId],i||(i=this.resolvedReferences[n.targetId]=[])):(i=this.unresolvedReferences[n.targetId],i||(i=this.unresolvedReferences[n.targetId]=[])),i.every(e=>!n.equals(e))&&i.push(n)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach(e=>{let i=this.unresolvedReferences[e];i&&(t=t.concat(i))}),t.sort((e,t)=>e.spineIndex-t.spineIndex||e.pageIndex-t.pageIndex);let i=[],n=null;return t.forEach(e=>{n&&n.spineIndex===e.spineIndex&&n.pageIndex===e.pageIndex?n.refs.push(e):(n={spineIndex:e.spineIndex,pageIndex:e.pageIndex,pageCounters:e.pageCounters,refs:[e]},i.push(n))}),i}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,i){"pages"===e?this.pagesCounterExprs.push({expr:i,format:t}):this.pageCounterExprs.push({expr:i,format:t})}registerTargetCounterExpr(e,t,i,n){this.targetCounterExprs.push({name:e,expr:i,format:t,transformedId:n})}registerTargetTextExpr(e,t,i){this.targetTextExprs.push({pseudoElement:e,expr:t,transformedId:i})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,i){if(e instanceof Tt){if("viv-leader"==e.str){let n=i.createElementNS("http://www.w3.org/1999/xhtml","span");return n.textContent=t,n.setAttribute("data-viv-leader",e.key),n.setAttribute("data-viv-leader-value",t),n}if(e.str.startsWith("running-element-")){let e=t&&i.querySelectorAll(`[${K}="${t}"]`);if(!e||0===e.length)return null;let n=e[e.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(n),n.style.position="",n.style.visibility="",n}if(e.str.startsWith("target-counter-")){let n=i.createElementNS("http://www.w3.org/1999/xhtml","span");return n.textContent=t,n.setAttribute(on,e.key),n}if(e.str.startsWith("target-text-")){let n=i.createElementNS("http://www.w3.org/1999/xhtml","span");return n.textContent=t,n.setAttribute(sn,e.key),n}}let n=this.pagesCounterExprs.findIndex(t=>t.expr===e)>=0,r=!n&&this.pageCounterExprs.findIndex(t=>t.expr===e)>=0;if(n||r){let r=i.createElementNS("http://www.w3.org/1999/xhtml","span");return r.textContent=t,r.setAttribute(n?nn:rn,e.key),r}return null}fixPageCounterInRunningElement(e){let t=e.querySelectorAll(`[${rn}]`);for(let e of t){let t=e.getAttribute(rn),i=this.pageCounterExprs.find(e=>e.expr.key===t),n=(null==i?void 0:i.expr).str,r=null==n?void 0:n.replace(/^page-counters?-/,""),o=this.currentPageCounters[r];o&&(e.textContent=i.format(o))}let i=e.querySelectorAll(`[${on}]`);for(let e of i)e.setAttribute(an,!0);let n=e.querySelectorAll(`[${sn}]`);for(let e of n)e.setAttribute(ln,!0)}finishLastPage(e){var t;let i=e.root.querySelectorAll(`[${nn}]`),n=e.contentContainer.childElementCount;for(let e of i){let t=e.getAttribute(nn),i=this.pagesCounterExprs.findIndex(e=>e.expr.key===t);e.textContent=this.pagesCounterExprs[i].format([n])}let r=e.root.querySelectorAll(`[${an}]`);for(let e of r){let t=e.getAttribute(on),i=this.targetCounterExprs.find(e=>e.expr.key===t);if(i&&i.transformedId){let t=this.pageCountersById[i.transformedId];if(t){let n=t[i.name];n&&(e.textContent=i.format(n[n.length-1]))}}}let o=e.root.querySelectorAll(`[${ln}]`);for(let e of o){let i=e.getAttribute(sn),n=this.targetTextExprs.find(e=>e.expr.key===i);if(n&&n.transformedId){let i=this.pageTextById[n.transformedId];i&&(e.textContent=null!=(t=i[n.pseudoElement])?t:"")}}}createLayoutConstraint(e){return new hn(this,e)}},nn="data-vivliostyle-pages-counter",rn="data-vivliostyle-page-counter",on="data-vivliostyle-target-counter",sn="data-vivliostyle-target-text",an="data-vivliostyle-target-counter-in-running",ln="data-vivliostyle-target-text-in-running",hn=class{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;let t=e.viewNode;if(!t||1!==t.nodeType)return!0;let i=t.getAttribute("data-vivliostyle-id")||t.getAttribute("id")||t.getAttribute("name");if(!i||!this.counterStore.resolvedReferences[i]&&!this.counterStore.unresolvedReferences[i])return!0;let n=this.counterStore.pageIndicesById[i];return!n||this.pageIndex>=n.pageIndex}};function un(e){if((e=e.substr(1)).match(/^[^0-9a-fA-F\n\r]$/))return e;let t=parseInt(e,16);return isNaN(t)?"":0===t||t>=55296&&t<=57343||t>1114111?"":String.fromCodePoint(t)}function cn(e){return e.replace(/\\([0-9a-fA-F]{1,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,un)}var dn=class{constructor(){h(this,"type"),h(this,"precededBySpace",!1),h(this,"num",0),h(this,"text",""),h(this,"position",0),this.type=0}toString(){switch(this.type){case 10:return"(";case 11:return")";case 12:return"{";case 13:return"}";case 14:return"[";case 15:return"]";case 16:return",";case 17:return";";case 18:return":";case 19:return"/";case 21:return"%";case 22:return"?";case 23:return"+";case 24:return"-";case 25:return"||";case 26:return"&&";case 31:return"!";case 32:return"$";case 33:return"^";case 34:return"|";case 35:return"~";case 36:return"*";case 37:return">";case 38:return"<";case 39:return"=";case 41:return"!=";case 42:return"$=";case 43:return"^=";case 44:return"|=";case 45:return"~=";case 46:return"*=";case 47:return">=";case 48:return"<=";case 49:return"==";case 50:return"::";case 51:return"\x3c!--";case 52:return"--\x3e";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return"@"+this.text;case 7:return"#"+this.text;case 6:return this.text+"(";case 9:return"."+this.text;case 0:return"/*EOF*/";default:return this.text}}};function pn(e,t){let i,n=Array(128);for(i=0;i<128;i++)n[i]=e;for(n.NaN=35==e?35:72,i=0;i<t.length;i+=2)n[t[i]]=t[i+1];return n}var fn=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];fn.NaN=80;var gn=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];gn.NaN=43;var mn=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];gn.NaN=43;var bn=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];bn.NaN=35;var vn=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];vn.NaN=45;var yn=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];yn.NaN=37;var wn=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];wn.NaN=38;var xn=pn(35,[61,36]),Sn=pn(35,[58,77]),Cn=pn(35,[61,36,124,50]),kn=pn(35,[38,51]),En=pn(35,[42,54]),Pn=pn(39,[42,55]),Nn=pn(54,[42,55,47,56]),Tn=pn(62,[62,82]),In=pn(35,[61,36,33,70]),An=pn(62,[45,71]),_n=pn(63,[45,81]),Rn=pn(76,[10,72,13,72]),Ln=pn(39,[39,46,10,72,13,72,92,48]),Fn=pn(39,[34,46,10,72,13,72,92,49]),On=pn(39,[39,47,10,74,13,74,92,48]),Bn=pn(39,[34,47,10,74,13,74,92,49]),Mn=pn(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),zn=pn(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),Dn=pn(39,[39,68,10,74,13,74,92,75,NaN,67]),Vn=pn(39,[34,68,10,74,13,74,92,75,NaN,67]),Un=pn(72,[9,39,10,39,13,39,32,39,41,69]),Hn=class{constructor(e,t){this.input=e,this.handler=t,h(this,"indexMask"),h(this,"buffer"),h(this,"tail",0),h(this,"curr",0),h(this,"position",0),this.indexMask=15,this.buffer=Array(this.indexMask+1);for(let e=0;e<=this.indexMask;e++)this.buffer[e]=new dn}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let e=this.tail,t=this.curr,i=this.indexMask;if(e>=t?t+=i:t--,t==e)throw new Error("F_CSSTOK_INTERNAL");let n=fn,r=this.input,o=this.position,s=this.buffer,a=0,l=0,h="",u=0,c=!1,d=s[e],p=-9;for(;;){let f=r.charCodeAt(o);switch(n[f]||n[65]){case 72:h=r.substring(l,o),a=isNaN(f)?0:54,n=fn;break;case 1:o++,c=!0;continue;case 2:l=o++,n=yn;continue;case 3:a=1,l=o++,n=gn;continue;case 4:l=o++,a=31,n=xn;continue;case 33:a=2,l=++o,n=Ln;continue;case 34:a=2,l=++o,n=Fn;continue;case 6:l=++o,a=7,n=gn;continue;case 7:l=o++,a=32,n=xn;continue;case 8:l=o++,a=21;break;case 9:l=o++,a=32,n=kn;continue;case 10:l=o++,a=10;break;case 11:l=o++,a=11;break;case 12:l=o++,a=36,n=xn;continue;case 13:l=o++,a=23;break;case 14:l=o++,a=16;break;case 15:a=24,l=o++,n=bn;continue;case 16:l=o++,n=mn;continue;case 78:l=o++,a=9,n=gn;continue;case 17:l=o++,a=19,n=En;continue;case 18:l=o++,a=18,n=Sn;continue;case 77:o++,a=50;break;case 19:l=o++,a=17;break;case 20:l=o++,a=38,n=In;continue;case 21:l=o++,a=39,n=xn;continue;case 22:l=o++,a=37,n=xn;continue;case 23:l=o++,a=22;break;case 24:l=++o,a=20,n=gn;continue;case 25:l=o++,a=14;break;case 26:l=o++,a=15;break;case 27:l=o++,a=12;break;case 28:l=o++,a=13;break;case 29:l=o++,p=l,a=1,n=Rn;continue;case 30:l=o++,a=33,n=xn;continue;case 31:l=o++,a=34,n=Cn;continue;case 32:l=o++,a=35,n=xn;continue;case 35:break;case 36:o++,a=a+41-31;break;case 37:a=5,u=parseInt(r.substring(l,o),10);break;case 38:a=4,u=parseFloat(r.substring(l,o));break;case 39:o++;continue;case 40:a=3,u=parseFloat(r.substring(l,o)),l=o++,n=gn;continue;case 41:a=3,u=parseFloat(r.substring(l,o)),h="%",l=o++;break;case 42:o++,n=wn;continue;case 43:if(h=cn(r.substring(l,o)),27===a&&63===f||1===a&&"u"===h.toLowerCase()&&/^(\bu\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\s+|\/\*([^*]|\*[^/])*\*\/)+[;}]/i.test(r.substring(o-1))){a=27,o++;continue}break;case 44:p=o++,n=Rn;continue;case 45:h=cn(r.substring(l,o));break;case 46:h=r.substring(l,o),o++;break;case 47:h=cn(r.substring(l,o)),o++;break;case 48:p=o,o+=2,n=On;continue;case 49:p=o,o+=2,n=Bn;continue;case 50:o++,a=25;break;case 51:o++,a=26;break;case 52:if(h=r.substring(l,o),1==a){if(o++,"url"==h.toLowerCase()){n=Mn;continue}a=6}break;case 53:if(h=cn(r.substring(l,o)),1==a){if(o++,"url"==h.toLowerCase()){n=Mn;continue}a=6}break;case 54:n=Pn,o++;continue;case 55:n=Nn,o++;continue;case 56:n=fn,o++;continue;case 57:n=Tn,o++,">"!==r[o]&&(a=1,n=gn);continue;case 81:a=51,h=r.substring(l,++o),n=fn;break;case 82:a=52,h=r.substring(l,++o),n=fn;break;case 58:a=5,n=yn,o++;continue;case 59:a=4,n=wn,o++;continue;case 60:a=1,n=gn,o++;continue;case 61:a=1,n=Rn,p=o++;continue;case 62:o--;break;case 63:o-=2;break;case 64:l=o++,n=zn;continue;case 65:l=++o,n=Dn;continue;case 66:l=++o,n=Vn;continue;case 67:a=8,h=cn(r.substring(l,o)),o++;break;case 69:o++;break;case 70:n=An,o++;continue;case 71:n=_n,o++;continue;case 79:if(o-p<8&&r.substring(p+1,o+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){o++;continue}case 68:a=8,h=cn(r.substring(l,o)),o++,n=Un;continue;case 74:if(o++,o-p<9&&r.substring(p+1,o).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;a=54,h="E_CSS_UNEXPECTED_NEWLINE",n=fn;break;case 73:if(o-p<9&&r.substring(p+1,o+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){o++,n=gn;continue}h=cn(r.substring(l,o));break;case 75:p=o++;continue;case 76:o++,n=vn;continue;default:if(n!==fn){a=54,h="E_CSS_UNEXPECTED_STATE";break}l=o,a=0}if(d.type=a,d.precededBySpace=c,d.num=u,d.text=h,d.position=l,e++,e>=t)break;n=fn,c=!1,d=s[e&i]}this.position=o,this.tail=e&i}},$n=null,jn=null;function Wn(){return $n}function Gn(e){if(!$n)throw new Error("E_TASK_NO_CONTEXT");$n.name||($n.name=e);let t=$n,i=new ir(t,t.top,e);return t.top=i,i.state=1,i}function qn(e){return new er(e)}function Xn(e,t,i){let n=Gn(e);n.handler=i;try{t(n)}catch(e){n.task.raise(e,n)}return n.result()}function Yn(e,t){return($n?$n.getScheduler():jn||function(e){return new Zn(e||new Kn)}()).run(e,t)}var Kn=class{currentTime(){return(new Date).valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}},Zn=class{constructor(e){this.timer=e,h(this,"timeout",1),h(this,"slice",25),h(this,"sliceOverTime",0),h(this,"queue"),h(this,"wakeupTime",null),h(this,"timeoutToken",null),h(this,"inTimeSlice",!1),h(this,"order",0),this.queue=new ae,jn||(jn=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(null!=this.timeoutToken){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let i=e-t;i<=this.timeout&&(i=this.timeout),this.wakeupTime=t+i,this.timeoutToken=this.timer.setTimeout(()=>{this.timeoutToken=null,this.doTimeSlice()},i)}schedule(e,t){let i=e,n=this.timer.currentTime();i.order=this.order++,i.scheduledTime=n+(t||0),this.queue.add(i),this.arm()}doTimeSlice(){null!=this.timeoutToken&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){let t=this.queue.peek();if(t.scheduledTime>e||(this.queue.remove(),t.canceled||t.resumeInternal(),e=this.timer.currentTime(),e>=this.sliceOverTime))break}}catch(e){R.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){let i=new Qn(this,t||"");i.top=new ir(i,null,"bootstrap"),i.top.state=1,i.top.then(()=>{let t=()=>{i.running=!1;for(let e of i.callbacks)try{e()}catch(e){R.error(e)}};try{e().then(e=>{i.result=e,t()})}catch(e){i.raise(e),t()}});let n=$n;return $n=i,this.schedule(i.top.suspend("bootstrap")),$n=n,i}},Jn=class{constructor(e){this.task=e,h(this,"scheduledTime",0),h(this,"order",0),h(this,"result",null),h(this,"canceled",!1)}compare(e){let t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){let e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;let t=$n;return $n=e,e.top.finish(this.result),$n=t,!0}return!1}cancel(){this.canceled=!0}},Qn=class{constructor(e,t){this.scheduler=e,this.name=t,h(this,"callbacks",[]),h(this,"exception",null),h(this,"running",!0),h(this,"result",null),h(this,"waitTarget",null),h(this,"top",null),h(this,"continuation",null)}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==$n&&this.continuation){this.continuation.cancel();let e=new Jn(this);this.waitTarget="interrupt",this.continuation=e,this.scheduler.schedule(e)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){let e=Gn("Task.join");if(this.running){let t=e.suspend(this);this.whenDone(()=>{t.schedule(this.result)})}else e.finish(this.result);return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&R.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let e=this.top;for(;e&&e!=t;)e=e.parent;e==t&&(this.top=e)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}\n\t---- async ---\n`:"";for(let e=this.top;e;e=e.parent)t+="\t",t+=e.getName(),t+="\n";e.frameTrace=t}}},er=class e{constructor(e){this.value=e}then(e){e(this.value)}thenAsync(e){return e(this.value)}thenReturn(t){return new e(t)}thenFinish(e){e.finish(this.value)}isPending(){return!1}get(){return this.value}},tr=class{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){let t=new ir(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=1,this.frame.parent=t,this.frame.then(i=>{e(i).then(e=>{t.finish(e)})}),t.result()}return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync(()=>new er(e)):new er(e)}thenFinish(e){this.isPending()?this.then(t=>{e.finish(t)}):e.finish(this.frame.res)}isPending(){return 1==this.frame.state}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}},ir=class{constructor(e,t,i){this.task=e,this.parent=t,this.name=i,h(this,"res",null),h(this,"state"),h(this,"callback",null),h(this,"handler",null),this.state=0}checkEnvironment(){if(!$n)throw new Error("F_TASK_NO_CONTEXT");if(this!==$n.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new tr(this)}finish(e){this.checkEnvironment(),$n&&!$n.exception&&(this.res=e),this.state=2;let t=this.parent;if($n&&($n.top=t),this.callback){try{this.callback(e)}catch(e){this.task.raise(e,t)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case 1:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case 2:{let t=this.task,i=this.parent;try{e(this.res),this.state=3}catch(e){this.state=3,t.raise(e,i)}break}case 3:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let e=Gn("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(R.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){let t=Gn("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){let t=Gn("Frame.loop"),i=n=>{try{for(;n;){let t=e();if(t.isPending())return void t.then(i);t.then(e=>{n=e})}t.finish(!0)}catch(e){t.task.raise(e,t)}};return i(!0),t.result()}loopWithFrame(e){let t=$n;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop(()=>{let i;do{let n=new nr(t,t.top);t.top=n,n.state=1,e(n),i=n.result()}while(!i.isPending()&&i.get());return i})}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");let t=new Jn(this.task);return this.task.continuation=t,$n=null,this.task.waitTarget=e||null,t}},nr=class extends ir{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}},rr=class{constructor(e,t){this.fetch=e,h(this,"name"),h(this,"arrived",!1),h(this,"resource",null),h(this,"task",null),h(this,"piggybacks",[]),this.name=t}start(){this.task||(this.task=Wn().getScheduler().run(()=>{let e=Gn("Fetcher.run");return this.fetch().then(t=>{let i=this.piggybacks;if(this.arrived=!0,this.resource=t,this.task=null,this.piggybacks=[],i)for(let e=0;e<i.length;e++)try{i[e](t)}catch(e){R.error(e,"Error:")}e.finish(t)}),e.result()},this.name))}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?qn(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},or=e=>{if(0==e.length)return qn(!0);if(1==e.length)return e[0].get().thenReturn(!0);let t=Gn("waitForFetches"),i=0;return t.loop(()=>{for(;i<e.length;){let t=e[i++];if(!t.hasArrived())return t.get().thenReturn(!0)}return qn(!1)}).then(()=>{t.finish(!0)}),t.result()},sr='\n@media screen {\n  [data-vivliostyle-viewer-viewport] {\n    background: #aaaaaa;\n  }\n\n  [data-vivliostyle-page-container] {\n    background: white;\n    z-index: 0;\n  }\n\n  [data-vivliostyle-viewer-viewport] {\n    box-sizing: border-box;\n    display: flex;\n    overflow: auto;\n    position: relative;\n  }\n\n  [data-vivliostyle-outer-zoom-box] {\n    margin: auto;\n    overflow: hidden;\n    flex: none;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {\n    display: flex;\n    flex: none;\n    justify-content: center;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="ltr"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="rtl"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row-reverse;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {\n    margin: 0 auto;\n    flex: none;\n    transform-origin: center top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-spread-container]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side="left"] {\n    margin-right: 1px;\n    transform-origin: right top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-spread-container]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side="right"] {\n    margin-left: 1px;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]\n    [data-vivliostyle-spread-container]\n    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page="true"] {\n    margin-left: auto;\n    margin-right: auto;\n    transform-origin: center top;\n  }\n}\n',ar="\n[data-vivliostyle-layout-box] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  z-index: -1;\n  transform-origin: left top;\n}\n\n[data-vivliostyle-debug] [data-vivliostyle-layout-box] {\n  right: auto;\n  bottom: auto;\n  overflow: visible;\n  z-index: auto;\n}\n\n[data-vivliostyle-spread-container] {\n  transform: scale(var(--viv-outputScale,1));\n  transform-origin: left top;\n}\n\n/* Emulate high pixel ratio using zoom & transform:scale() */\n@supports (zoom: 8) {\n  [data-vivliostyle-layout-box] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  [data-vivliostyle-spread-container] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */\n  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {\n    border-width: medium;\n    outline-width: medium;\n    column-rule-width: medium;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {\n    background-color: #f4f4f4;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {\n    border-radius: 4px;\n    background: #c7c7c7;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {\n    background: #7d7d7d;\n  }\n}\n\n[data-vivliostyle-page-container] {\n  position: relative;\n}\n\n[data-vivliostyle-bleed-box] {\n  position: absolute;\n  overflow: hidden;\n  background-origin: content-box !important;\n}\n\n[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {\n  display: none;\n}\n\n[data-vivliostyle-toc-box] {\n  position: absolute;\n  left: 3px;\n  top: 3px;\n  overflow: scroll;\n  overflow-x: hidden;\n  background: rgba(248, 248, 248, 0.9);\n  border-radius: 2px;\n  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);\n}\n\n@media print {\n  [data-vivliostyle-toc-box] {\n    display: none;\n  }\n\n  [data-vivliostyle-outer-zoom-box],\n  [data-vivliostyle-spread-container] {\n    width: 100% !important;\n    height: 100% !important;\n  }\n\n  [data-vivliostyle-spread-container] {\n    --viv-outputScale: 1 !important;\n    --viv-devicePixelRatio: 1 !important;\n    zoom: normal !important;\n    transform: none !important;\n    print-color-adjust: exact;\n  }\n\n  @supports (zoom: 8) {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      zoom: var(--viv-outputPixelRatio,1);\n      /* transform: scale(calc(1 / var(--viv-outputPixelRatio,1))); */\n      /* Use matrix instead of scale (Workaround for issue #1555) */\n      transform: matrix(calc(1 / var(--viv-outputPixelRatio,1)), 0, 5e-324, calc(1 / var(--viv-outputPixelRatio,1)), 0, 0);\n      transform-origin: left top;\n    }\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n    display: block !important;\n    max-height: 100vh;\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {\n    break-after: page;\n  }\n\n  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */\n  @-moz-document url-prefix()  {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {\n      top: -1px;\n      margin-top: 1px;\n      margin-bottom: -1px;\n    }\n    /* Workaround Gecko problem on page break */\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      break-after: auto !important;\n      height: 100% !important;\n    }\n  }\n}\n",lr="\n/*\n * Copyright 2013 Google, Inc.\n * Copyright 2015 Daishinsha Inc.\n * Copyright 2019 Vivliostyle Foundation\n *\n * CSS property validation.\n */\nNUM = POS_NUM | ZERO | NEGATIVE;\nNNEG_NUM = POS_NUM | ZERO;\nINT = POS_INT | ZERO | NEGATIVE;\nNNEG_INT = POS_INT | ZERO;\nPERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;\nSTRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;\nNNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;\nLENGTH = POS_LENGTH | ZERO | NEGATIVE;\nNNEG_LENGTH = POS_LENGTH | ZERO;\nPLENGTH = LENGTH | PERCENTAGE;\nPPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;\nALENGTH = LENGTH | auto;\nAPLENGTH = PLENGTH | auto;\nPAPLENGTH = PPLENGTH | auto;\nANGLE = POS_ANGLE | ZERO | NEGATIVE;\nLENGTH_OR_NUM = LENGTH | NUM;\nANGLE_OR_NUM = ANGLE | NUM;\nMIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;\nBG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;\nURI_OR_NONE = URI | none;\nIMAGE = URI | IMAGE_FUNCTION | none;\nbackground-attachment = COMMA( [scroll | fixed | local]+ );\nbackground-color = COLOR;\nbackground-image = COMMA( IMAGE+ );\nbackground-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\nbackground-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );\nborder-collapse = collapse | separate;\nBORDER_SIDE_COLOR = COLOR;\nBORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;\nBORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;\nborder-spacing = LENGTH LENGTH?;\nborder-top-color = BORDER_SIDE_COLOR;\nborder-right-color = BORDER_SIDE_COLOR;\nborder-bottom-color = BORDER_SIDE_COLOR;\nborder-left-color = BORDER_SIDE_COLOR;\nborder-top-style = BORDER_SIDE_STYLE;\nborder-right-style = BORDER_SIDE_STYLE;\nborder-bottom-style = BORDER_SIDE_STYLE;\nborder-left-style = BORDER_SIDE_STYLE;\nborder-top-width = BORDER_SIDE_WIDTH;\nborder-right-width = BORDER_SIDE_WIDTH;\nborder-bottom-width = BORDER_SIDE_WIDTH;\nborder-left-width = BORDER_SIDE_WIDTH;\nBORDER_RADIUS = PLENGTH{1,2};\nborder-top-left-radius = BORDER_RADIUS;\nborder-top-right-radius = BORDER_RADIUS;\nborder-bottom-right-radius = BORDER_RADIUS;\nborder-bottom-left-radius = BORDER_RADIUS;\nborder-image-source = IMAGE;\nborder-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */\nborder-image-width = [NUM | PLENGTH | auto]{1,4};\nborder-image-outset = [NUM | LENGTH]{1,4};\nborder-image-repeat = [ stretch | repeat | round | space ]{1,2};\nbottom = APLENGTH;\ncaption-side = top | bottom;\nclip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;\ncolor = COLOR;\nLIST_STYLE_TYPE = IDENT;\nTYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;\nATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);\nCONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |\n    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |\n    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |\n    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |\n    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |\n    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |\n    target-text([ STRING | URI ] [content | before | after | first-letter | marker]?) |\n    target-text(ATTR [content | before | after | first-letter | marker]?) |\n    leader([ dotted | solid | space ] | STRING ) |\n    open-quote | close-quote | no-open-quote | no-close-quote |\n    content([ text | before | after | first-letter | marker ]?) |\n    string(IDENT [first | start | last | first-except]?) |\n    element(IDENT [first | start | last | first-except]?) ]+;\nCONTENT = normal | none | CONTENT_LIST;\ncontent = CONTENT;\nCOUNTER = [ IDENT INT? ]+ | none;\ncounter-increment = COUNTER;\ncounter-reset = COUNTER;\ncounter-set = COUNTER;\ncursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |\n    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);\ndirection = ltr | rtl;\ndisplay = inline | block | list-item | inline-block | table | inline-table | table-row-group |\n    table-header-group | table-footer-group | table-row | table-column-group | table-column |\n    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |\n    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |\n    flow-root | grid | inline-grid | contents;\nempty-cells = show | hide;\nFAMILY = SPACE(IDENT+) | STRING;\nFAMILY_LIST = COMMA( FAMILY+ );\nfont-family = FAMILY_LIST;\nfont-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;\nfont-style = normal | italic | oblique;\nfont-weight = normal | bold | bolder | lighter | POS_NUM;\nheight = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nleft = APLENGTH;\nletter-spacing = normal | LENGTH_OR_NUM;\nline-height = normal | POS_NUM | PPLENGTH;\nlist-style-image = IMAGE;\nlist-style-position = inside | outside;\nlist-style-type = LIST_STYLE_TYPE | STRING | none;\nmargin-right = APLENGTH;\nmargin-left = APLENGTH;\nmargin-top = APLENGTH;\nmargin-bottom = APLENGTH;\nNPLENGTH = none | PLENGTH;\nmax-height = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-width = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-height = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-width = APLENGTH | MIN_MAX_FIT_CONTENT;\norphans = POS_INT;\noutline-offset = LENGTH;\noutline-color = COLOR | invert;\noutline-style = BORDER_SIDE_STYLE;\noutline-width = BORDER_SIDE_WIDTH;\noverflow = visible | hidden | scroll | auto | clip;\npadding-right = PPLENGTH;\npadding-left = PPLENGTH;\npadding-top = PPLENGTH;\npadding-bottom = PPLENGTH;\nPAGE_BREAK = auto | always | avoid | left | right | recto | verso;\npage-break-after = PAGE_BREAK;\npage-break-before = PAGE_BREAK;\npage-break-inside = avoid | auto;\nposition = static | relative | absolute | fixed | running(IDENT);\nquotes = [STRING STRING]+ | none | auto;\nright = APLENGTH;\ntable-layout = auto | fixed;\ntext-align = left | right | center | justify | start | end | match-parent | inside | outside;\ntext-indent = PLENGTH;\ntext-transform = capitalize | uppercase | lowercase | none;\ntop = APLENGTH;\nvertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;\nvisibility = visible | hidden | collapse;\nwhite-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;\nwidows = POS_INT;\nwidth = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nword-spacing = normal | LENGTH_OR_NUM;\nz-index = auto | INT;\n\n[epub,moz,webkit]hyphens = auto | manual | none;\n[webkit]hyphenate-character = auto | STRING;\n\n/* css-logical */\nmargin-block-start = APLENGTH;\nmargin-block-end = APLENGTH;\nmargin-inline-start = APLENGTH;\nmargin-inline-end = APLENGTH;\npadding-block-start = APLENGTH;\npadding-block-end = APLENGTH;\npadding-inline-start = APLENGTH;\npadding-inline-end = APLENGTH;\nborder-block-start-color = BORDER_SIDE_COLOR;\nborder-block-end-color = BORDER_SIDE_COLOR;\nborder-inline-start-color = BORDER_SIDE_COLOR;\nborder-inline-end-color = BORDER_SIDE_COLOR;\nborder-block-start-style = BORDER_SIDE_STYLE;\nborder-block-end-style = BORDER_SIDE_STYLE;\nborder-inline-start-style = BORDER_SIDE_STYLE;\nborder-inline-end-style = BORDER_SIDE_STYLE;\nborder-block-start-width = BORDER_SIDE_WIDTH;\nborder-block-end-width = BORDER_SIDE_WIDTH;\nborder-inline-start-width = BORDER_SIDE_WIDTH;\nborder-inline-end-width = BORDER_SIDE_WIDTH;\nblock-start = APLENGTH;\nblock-end = APLENGTH;\ninline-start = APLENGTH;\ninline-end = APLENGTH;\nblock-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\ninline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;\n\nmargin-inside = auto | APLENGTH;\nmargin-outside = auto | APLENGTH;\npadding-inside = PPLENGTH;\npadding-outside = PPLENGTH;\nborder-inside-color = BORDER_SIDE_COLOR;\nborder-outside-color = BORDER_SIDE_COLOR;\nborder-inside-style = BORDER_SIDE_STYLE;\nborder-outside-style = BORDER_SIDE_STYLE;\nborder-inside-width = BORDER_SIDE_WIDTH;\nborder-outside-width = BORDER_SIDE_WIDTH;\ninside = APLENGTH;\noutside = APLENGTH;\n\nSHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |\n    polygon( SPACE(PLENGTH+)+ );\n[epubx]shape-inside = SHAPE;\n[epubx,webkit]shape-outside = SHAPE;\n[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;\n\nTRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |\n scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);\n[epub]transform = none | TRANSFORM_FUNCTION+;\n[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */\n\nBOX = border-box | padding-box | content-box;\nSHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */\n[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );\n[webkit]background-origin = COMMA( BOX+ );\n[webkit]background-clip = COMMA( BOX+ );\n[webkit]box-shadow = none | COMMA( SHADOW+ );\ntext-shadow = none |  COMMA( SHADOW+ );\n[webkit]box-decoration-break = slice | clone;\nFILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))\n                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)\n                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);\nFILTER_FUNCTION_LIST = FILTER_FUNCTION+;\n[webkit]filter = none | FILTER_FUNCTION_LIST;\n\nopacity = NUM;\n\n[moz,webkit]column-width = LENGTH | auto;\n[moz,webkit]column-count = INT | auto;\n[moz,webkit]column-gap = LENGTH | normal;\n[moz,webkit]column-rule-color = COLOR;\n[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;\n[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;\nBREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;\nbreak-before = BREAK;\nbreak-after = BREAK;\nbreak-inside = auto | avoid | avoid-page | avoid-column | avoid-region;\n[webkit]column-span = none | auto | all;\n[moz]column-fill = auto | balance | balance-all;\nmargin-break = auto | keep | discard;\n\nsrc = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */\n\n[epubx,webkit]flow-from = IDENT;\n[epubx,webkit]flow-into = IDENT;\n[epubx]flow-linger = INT | none;\n[epubx]flow-priority = INT;\n[epubx]flow-options = none | [ exclusive || last || static ];\n[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */\n[epubx]min-page-width = LENGTH;\n[epubx]min-page-height = LENGTH;\n[epubx]required = true | false;\n[epubx]enabled = true | false;\n[epubx]conflicting-partitions = COMMA(IDENT+);\n[epubx]required-partitions = COMMA(IDENT+);\n[epubx]snap-height = LENGTH | none;\n[epubx]snap-width = LENGTH | none;\n[epubx]flow-consume = all | some;\n[epubx]utilization = NUM;\n[epubx]text-zoom = font-size | scale;\n\n[adapt]template = URI_OR_NONE | footnote;\n[adapt]behavior = IDENT;\n\n/* CSS Fonts */\nCOMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];\nDISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];\nHISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];\nCONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];\nfont-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];\nfont-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;\nNUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];\nNUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];\nNUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];\nfont-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];\nEAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];\nEAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];\nfont-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];\nfont-variant_css2 = normal | small-caps; /* for font shorthand */\nfont-size-adjust = none | NNEG_NUM;\n[webkit]font-kerning = auto | normal | none;\nfont-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );\nFONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;\nfont-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;\nfont-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */\nfont-display = [ auto | block | swap | fallback | optional ];\nunicode-range = COMMA( URANGE+ );\n\n/* CSS Images */\nimage-resolution = RESOLUTION;\nobject-fit = fill | contain | cover | none | scale-down;\nobject-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\n\n/* CSS Paged Media */\nPAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0\n          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0\n          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0\n          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0\n          | letter | legal | ledger;\nbleed = auto | LENGTH;\nmarks = none | [ crop || cross ];\nsize = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];\ncrop-offset = auto | LENGTH;\ncrop-marks-line-color = auto | COLOR;\n\n/* CSS Page Floats */\nclear = none | left | right | top | bottom | inline-start | inline-end | block-start | block-end | inside | outside | both | all | same | column | region | page;\nfloat-reference = inline | column | region | page;\nfloat = none | footnote | [ block-start || block-end || inline-start || inline-end || snap-block || snap-inline || left || right || top || bottom || inside || outside ];\nfloat-min-wrap-block = PPLENGTH;\n\n/* CSS Ruby */\nruby-align = start | center | space-between | space-around;\nruby-position = over | under | inter-character;\n\n/* CSS Size Adjust */\n[moz,webkit]text-size-adjust = auto | none | POS_PERCENTAGE;\n\n/* CSS Text */\n[webkit]line-break = auto | loose | normal | strict | anywhere;\noverflow-wrap = normal | break-word | anywhere;\n[moz]tab-size = NNEG_INT | NNEG_LENGTH;\n[moz]text-align-last = auto | start | end | left | right | center | justify | inside | outside;\ntext-justify = auto | none | inter-word | inter-character;\nword-break = normal | keep-all | break-all | break-word;\ntext-spacing-trim = auto | normal | space-all | trim-both | trim-auto |\n    [[ trim-start | space-start | space-first ] ||\n     [ trim-end | space-end | allow-end ] ||\n     [ trim-adjacent | space-adjacent ]];\ntext-autospace = normal | auto | no-autospace |\n    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];\nhanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];\n\n/* CSS Text Decoration */\n[webkit]text-decoration-color = COLOR;\n[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];\n[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];\n[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;\n[webkit]text-decoration-thickness = from-font | APLENGTH;\n[epub,webkit]text-emphasis-color = COLOR;\n[webkit]text-emphasis-position = [ over | under ] [ right | left ];\n[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;\n[webkit]text-underline-position = auto | [ under || [ left | right ]];\n\n[webkit]initial-letter = normal | [ POS_NUM POS_INT? ];\n\n/* CSS Transforms */\n[webkit]backface-visibility = visible | hidden;\n\n/* CSS UI */\n[moz,webkit]box-sizing = content-box | padding-box | border-box;\ntext-overflow = [clip | ellipsis | STRING]{1,2};\n\n/* CSS Writing Modes */\n[epub,webkit]text-combine = none | horizontal;\ntext-combine-upright = none | all; /* relaxed */\n[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;\nunicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;\n[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;\n\n/* CSS Flex box */\nFLEX_BASIS = content | PAPLENGTH;\nflex-direction = row | row-reverse | column | column-reverse;\nflex-wrap = nowrap | wrap | wrap-reverse;\norder = INT;\nflex-grow = NNEG_NUM;\nflex-shrink = NNEG_NUM;\nflex-basis = FLEX_BASIS;\nflex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];\njustify-content = flex-start | flex-end | center | space-between | space-around;\nalign-items = flex-start | flex-end | center | baseline | stretch;\nalign-self = auto | flex-start | flex-end | center | baseline | stretch;\nalign-content = flex-start | flex-end | center | space-between | space-around | stretch;\n\n/* Pointer Events */\ntouch-action = auto | none | [ pan-x || pan-y ] | manipulation;\n\n/* SVG 2 */\nOPACITY_VALUE = NUM | PERCENTAGE;\nDASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );\nPAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;\ncolor-interpolation = auto | sRGB | linearRGB;\ncolor-rendering = auto | optimizeSpeed | optimizeQuality;\nfill = PAINT;\nfill-opacity = OPACITY_VALUE;\nfill-rule = nonzero | evenodd;\nglyph-orientation-vertical = auto | NUM | ANGLE;\nimage-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;\nmarker-start = none | URI;\nmarker-mid = none | URI;\nmarker-end = none | URI;\npointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;\npaint-order = normal | [ fill || stroke || markers ];\nshape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;\nstop-color = COLOR;\nstop-opacity = OPACITY_VALUE;\nstroke = PAINT;\nstroke-dasharray = none | DASH_ARRAY;\nstroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;\nstroke-linecap = butt | round | square;\nstroke-linejoin = miter | round | bevel;\nstroke-miterlimit = NUM;\nstroke-opacity = OPACITY_VALUE;\nstroke-width = PERCENTAGE | LENGTH_OR_NUM;\ntext-anchor = start | middle | end;\ntext-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;\nvector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );\n\n/* SVG 1.1 */\nalignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;\nbaseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;\ndominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;\nmask = none | URI;\n\n/* css-masking-1 */\nSHAPE_RADIUS = PLENGTH | closest-side | farthest-side;\nFILL_RULE = nonzero | evenodd;\nSHAPE_BOX = BOX | margin-box;\nGEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;\nBASIC_SHAPE =\n    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )\n  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )\n  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )\n  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );\n[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];\nclip-rule = nonzero | evenodd;\n\n/* filters */\nflood-color = COLOR;\nflood-opacity = OPACITY_VALUE;\nlighting-color = COLOR;\n\n/* compositing-1 */\nBLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;\nmix-blend-mode = BLEND_MODE;\nisolation = auto | isolate;\nbackground-blend-mode = COMMA( BLEND_MODE+ );\n\n/* CSS GCPM */\nstring-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );\nfootnote-policy = auto | line;\n\n/* CSS Repeated Headers and Footers */\n[viv]repeat-on-break = auto | none | header | footer;\n\n/* Compatibility */\n[webkit]text-fill-color = COLOR;\n[webkit]text-stroke-color = COLOR;\n[webkit]text-stroke-width = BORDER_SIDE_WIDTH;\n\nDEFAULTS\n\nbackground-attachment: scroll;\nbackground-color: transparent;\nbackground-image: none;\nbackground-repeat: repeat;\nbackground-position: 0% 0%;\nbackground-clip: border-box;\nbackground-origin: padding-box;\nbackground-size: auto;\nborder-top-color: currentColor;\nborder-right-color: currentColor;\nborder-bottom-color: currentColor;\nborder-left-color: currentColor;\nborder-top-style: none;\nborder-right-style: none;\nborder-bottom-style: none;\nborder-left-style: none;\nborder-top-width: 3px;\nborder-right-width: 3px;\nborder-bottom-width: 3px;\nborder-left-width: 3px;\nborder-top-left-radius: 0;\nborder-top-right-radius: 0;\nborder-bottom-right-radius: 0;\nborder-bottom-left-radius: 0;\nborder-image-source: none;\nborder-image-slice: 100%;\nborder-image-width: 1;\nborder-image-outset: 0;\nborder-image-repeat: stretch;\ncolumn-count: auto;\ncolumn-gap: normal;\ncolumn-width: auto;\ncolumn-rule-color: currentColor;\ncolumn-rule-style: none;\ncolumn-rule-width: 3px;\ncolumn-fill: balance;\noutline-color: currentColor;\noutline-style: none;\noutline-width: 3px;\nflex-direction: row;\nflex-wrap: nowrap;\nfont-family: serif;\nfont-style: normal;\nfont-size: medium;\nfont-size-adjust: none;\nfont-kerning: auto;\nfont-feature-settings: normal;\nfont-variant-ligatures: normal;\nfont-variant-caps: normal;\nfont-variant-numeric: normal;\nfont-variant-east-asian: normal;\nfont-weight: normal;\nfont-stretch: normal;\nline-height: normal;\nlist-style-image: none;\nlist-style-position: outside;\nlist-style-type: disc;\nmargin-bottom: auto;\nmargin-left: auto;\nmargin-right: auto;\nmargin-top: auto;\npadding-bottom: auto;\npadding-left: auto;\npadding-right: auto;\npadding-top: auto;\ntext-autospace: normal;\ntext-emphasis-color: currentColor;\ntext-emphasis-style: none;\ntext-spacing-trim: normal;\ntext-stroke-color: currentColor;\ntext-stroke-width: 0;\nmarker-start: none;\nmarker-mid: none;\nmarker-end: none;\n\n/* css-logical */\nborder-block-start-color: currentColor;\nborder-block-end-color: currentColor;\nborder-inline-start-color: currentColor;\nborder-inline-end-color: currentColor;\nborder-inside-color: currentColor;\nborder-outside-color: currentColor;\nborder-block-start-style: none;\nborder-block-end-style: none;\nborder-inline-start-style: none;\nborder-inline-end-style: none;\nborder-inside-style: none;\nborder-outside-style: none;\nborder-block-start-width: 3px;\nborder-block-end-width: 3px;\nborder-inline-start-width: 3px;\nborder-inline-end-width: 3px;\nborder-inside-width: 3px;\nborder-outside-width: 3px;\n\nSHORTHANDS\n\nall = ALL;\nbackground = COMMA background-image [background-position [ / background-size ]] background-repeat\n     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */\nborder-top = border-top-width border-top-style border-top-color;\nborder-right = border-right-width border-right-style border-right-color;\nborder-bottom = border-bottom-width border-bottom-style border-bottom-color;\nborder-left = border-left-width border-left-style border-left-color;\nborder-inside = border-inside-width border-inside-style border-inside-color;\nborder-outside = border-outside-width border-outside-style border-outside-color;\nborder-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;\nborder-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;\nborder-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;\nborder = border-width border-style border-color;\nborder-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]\n     border-image-repeat;\nborder-radius = INSETS_SLASH border-top-left-radius border-top-right-radius\n     border-bottom-right-radius border-bottom-left-radius;\n[moz,webkit]columns = column-width column-count;\n[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;\nflex-flow = flex-direction flex-wrap;\noeb-column-number = column-count;\noutline = outline-width outline-style outline-color;\nlist-style = list-style-position list-style-type list-style-image;\nmargin = INSETS margin-top margin-right margin-bottom margin-left;\npadding = INSETS padding-top padding-right padding-bottom padding-left;\nfont = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;\nfont-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;\n[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;\nmarker = INSETS marker-start marker-mid marker-end;\n[webkit]text-stroke = text-stroke-width text-stroke-color;\ntext-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;\ntext-spacing = TEXT_SPACING text-autospace text-spacing-trim;\n\n/* css-logical */\nmargin-block = INSETS margin-block-start margin-block-end;\nmargin-inline = INSETS margin-inline-start margin-inline-end;\npadding-block = INSETS padding-block-start padding-block-end;\npadding-inline = INSETS padding-inline-start padding-inline-end;\nborder-block-width = INSETS border-block-start-width border-block-end-width;\nborder-block-style = INSETS border-block-start-style border-block-end-style;\nborder-block-color = INSETS border-block-start-color border-block-end-color;\nborder-inline-width = INSETS border-inline-start-width border-inline-end-width;\nborder-inline-style = INSETS border-inline-start-style border-inline-end-style;\nborder-inline-color = INSETS border-inline-start-color border-inline-end-color;\nborder-block = border-block-width border-block-style border-block-color;\nborder-inline = border-inline-width border-inline-style border-inline-color;\nborder-block-start = border-block-start-width border-block-start-style border-block-start-color;\nborder-block-end = border-block-end-width border-block-end-style border-block-end-color;\nborder-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;\nborder-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;\ninset-block-start = block-start;\ninset-block-end = block-end;\ninset-inline-start = inline-start;\ninset-inline-end = inline-end;\ninset-inside = inside;\ninset-outside = outside;\ninset-block = INSETS block-start block-end;\ninset-inline = INSETS inline-start inline-end;\ninset = INSETS top right bottom left;\n\n/* old names  */\nword-wrap = overflow-wrap;\n[adapt,webkit]margin-before = margin-block-start;\n[adapt,webkit]margin-after = margin-block-end;\n[adapt,webkit]margin-start = margin-inline-start;\n[adapt,webkit]margin-end = margin-inline-end;\n[adapt,webkit]padding-before = padding-block-start;\n[adapt,webkit]padding-after = padding-block-end;\n[adapt,webkit]padding-start = padding-inline-start;\n[adapt,webkit]padding-end = padding-inline-end;\n[adapt,webkit]border-before-color = border-block-start-color;\n[adapt,webkit]border-after-color = border-block-end-color;\n[adapt,webkit]border-start-color = border-inline-start-color;\n[adapt,webkit]border-end-color = border-inline-end-color;\n[adapt,webkit]border-before-style = border-block-start-style;\n[adapt,webkit]border-after-style = border-block-end-style;\n[adapt,webkit]border-start-style = border-inline-start-style;\n[adapt,webkit]border-end-style = border-inline-end-style;\n[adapt,webkit]border-before-width = border-block-start-width;\n[adapt,webkit]border-after-width = border-block-end-width;\n[adapt,webkit]border-start-width = border-inline-start-width;\n[adapt,webkit]border-end-width = border-inline-end-width;\n[adapt,webkit]before = block-start;\n[adapt,webkit]after = block-end;\n[adapt,webkit]start = inline-start;\n[adapt,webkit]end = inline-end;\n\n",hr='\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">\n<head>\n<style><![CDATA[\n\n.-vivliostyle-footnote-content {\n  float: footnote;\n}\n\n.-vivliostyle-table-cell-container {\n  display: block;\n}\n\n]]></style>\n</head>\n<body>\n\n<s:template id="footnote"><s:content/><s:include class="-vivliostyle-footnote-content"/></s:template>\n\n<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="-vivliostyle-table-cell-container"><s:content/></div></s:template>\n\n</body>\n</html>',ur='\n@namespace "http://www.w3.org/1999/xhtml";\n\n:root {\n  hyphens: -epubx-expr(pref-hyphenate? "auto": "manual");\n}\n:root[data-vivliostyle-epub-spine-properties~="page-spread-left"] {\n  break-before: left;\n}\n:root[data-vivliostyle-epub-spine-properties~="page-spread-right"] {\n  break-before: right;\n}\n\n@-adapt-footnote-area {\n  display: block;\n  margin-block-start: 0.5em;\n  margin-block-end: 0.5em;\n}\n\n@-adapt-footnote-area ::before {\n  display: block;\n  border-block-start-width: 1px;\n  border-block-start-style: solid;\n  border-block-start-color: black;\n  margin-block-end: 0.4em;\n  margin-inline-start: 0;\n  margin-inline-end: 60%;\n}\n\n/* default page master */\n@-epubx-page-master :background-host {\n  @-epubx-partition :layout-host {\n    -epubx-flow-from: body;\n    top: -epubx-expr(header.margin-bottom-edge);\n    bottom: -epubx-expr(page-height - footer.margin-top-edge);\n    left: 0px;\n    right: 0px;\n    column-width: 25em;\n  }\n  @-epubx-partition footer :oeb-page-foot {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-foot;\n    bottom: 0px;\n    left: 0px;\n    right: 0px;\n  }\n  @-epubx-partition header :oeb-page-head {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-head;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n  }\n}\n\n@page {\n  @top-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @top-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @top-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @left-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @left-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @left-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @right-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @right-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @right-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @bottom-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @bottom-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @bottom-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n}\n\n@media print {\n  @page {\n    margin: 10%;\n  }\n}\n',cr='\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace m "http://www.w3.org/1998/Math/MathML";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nhtml,\naddress,\nblockquote,\nbody,\ndd,\ndiv,\ndl,\ndt,\nfieldset,\nform,\nframe,\nframeset,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nnoframes,\nol,\np,\nul,\ncenter,\ndir,\nhr,\nmenu,\npre,\ndetails,\ndialog,\nlegend,\nlisting,\noptgroup,\noption,\nplaintext,\nsearch,\nxmp,\narticle,\nsection,\nnav,\naside,\nhgroup,\nfooter,\nheader,\nfigure,\nfigcaption,\nmain {\n  display: block;\n}\nli {\n  display: list-item;\n}\nhead {\n  display: none !important;\n}\ntable {\n  display: table;\n}\ntr {\n  display: table-row;\n}\nthead {\n  display: table-header-group;\n  break-after: avoid;\n}\ntbody {\n  display: table-row-group;\n}\ntfoot {\n  display: table-footer-group;\n  break-before: avoid;\n}\ncol {\n  display: table-column;\n}\ncolgroup {\n  display: table-column-group;\n}\ntd,\nth {\n  display: table-cell;\n}\ncaption {\n  display: table-caption;\n  text-align: center;\n}\nth {\n  font-weight: bolder;\n  text-align: center;\n}\n*[hidden],\nlink,\nstyle,\nscript {\n  display: none;\n}\nh1 {\n  font-size: 2em;\n  margin-block: 0.67em;\n}\nh2 {\n  font-size: 1.5em;\n  margin-block: 0.83em;\n}\nh3 {\n  font-size: 1.17em;\n  margin-block: 1em;\n}\nh4 {\n  font-size: 1em;\n  margin-block: 1.33em;\n}\nh5 {\n  font-size: 0.83em;\n  margin-block: 1.67em;\n}\nh6 {\n  font-size: 0.67em;\n  margin-block: 2.33em;\n}\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  font-weight: bold;\n  break-after: avoid;\n}\np,\nblockquote,\nfigure,\nul,\nol,\ndl,\ndir,\nmenu {\n  margin-block: 1em;\n}\nb,\nstrong {\n  font-weight: bolder;\n}\nblockquote,\nfigure {\n  margin-inline: 40px;\n}\ni,\ncite,\ndfn,\nem,\nvar,\naddress {\n  font-style: italic;\n}\npre,\ntt,\ncode,\nkbd,\nsamp {\n  font-family: monospace;\n  text-spacing: none;\n  hanging-punctuation: none;\n}\nlisting,\nplaintext,\nxmp,\npre {\n  white-space: pre;\n}\npre[wrap] {\n  white-space: pre-wrap;\n}\nbutton,\ntextarea,\ninput,\nselect {\n  display: inline-block;\n}\nbig {\n  font-size: 1.17em;\n}\nsmall,\nsub,\nsup {\n  font-size: 0.83em;\n}\nsub {\n  vertical-align: sub;\n}\nsup {\n  vertical-align: super;\n}\ntable {\n  box-sizing: border-box;\n  border-spacing: 2px;\n  border-collapse: separate;\n  text-indent: initial;\n}\nthead,\ntbody,\ntfoot,\ntable > tr {\n  vertical-align: middle;\n}\ntr,\ntd,\nth {\n  vertical-align: inherit;\n}\ns,\nstrike,\ndel {\n  text-decoration: line-through;\n}\nhr {\n  border-style: inset;\n  border-width: 1px;\n  margin-block: 0.5em;\n}\nhr[color],\nhr[noshade] {\n  border-style: solid;\n}\nol,\nul,\ndir,\nmenu {\n  padding-inline-start: 40px;\n}\ndd {\n  margin-inline-start: 40px;\n}\nol ul,\nul ol,\nul ul,\nol ol {\n  margin-block: 0;\n}\nul {\n  list-style-type: disc;\n}\nol ul,\nul ul {\n  list-style-type: circle;\n}\nol ol ul,\nol ul ul,\nul ol ul,\nul ul ul {\n  list-style-type: square;\n}\nol { list-style-type: decimal; }\nol[type="1"], li[type="1"] { list-style-type: decimal; }\nol[type=a], li[type=a] { list-style-type: lower-alpha; }\nol[type=A], li[type=A] { list-style-type: upper-alpha; }\nol[type=i], li[type=i] { list-style-type: lower-roman; }\nol[type=I], li[type=I] { list-style-type: upper-roman; }\nul[type=none], li[type=none] { list-style-type: none; }\nul[type=disc], li[type=disc] { list-style-type: disc; }\nul[type=circle], li[type=circle] { list-style-type: circle; }\nul[type=square], li[type=square] { list-style-type: square; }\nu,\nins {\n  text-decoration: underline;\n}\ncenter {\n  text-align: center;\n}\nq::before {\n  content: open-quote;\n}\nq::after {\n  content: close-quote;\n}\n\nruby {\n  display: ruby;\n}\nrp {\n  display: none;\n}\nrbc {\n  display: ruby-base-container;\n}\nrtc {\n  display: ruby-text-container;\n}\nrb {\n  display: ruby-base;\n  white-space: nowrap;\n}\nrt {\n  display: ruby-text;\n}\nrtc,\nrt {\n  text-emphasis: none;\n  white-space: nowrap;\n  line-height: 1;\n}\nrtc,\nrt {\n  font-size: 50%;\n}\nrtc:lang(zh-TW),\nrt:lang(zh-TW) {\n  font-size: 30%;\n}\nrtc > rt,\nrtc > rt:lang(zh-TW) {\n  font-size: 100%;\n}\n\n/* Bidi settings */\nbdo[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: bidi-override;\n}\nbdo[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: bidi-override;\n}\n*[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: isolate;\n}\n*[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: isolate;\n}\n\n/* MathML */\nm|math[display="block"] {\n  display: block;\n  display: block math;\n}\n\n/*------------------ epub-specific ---------------------*/\n\na[epub|type="noteref"],\na[epub\\:type="noteref"] {\n  font-size: 0.75em;\n  vertical-align: super;\n  line-height: 0.01;\n}\n\na[epub|type="noteref"]:href-epub-type(footnote, aside),\na[epub\\:type="noteref"]:href-epub-type(footnote, aside) {\n  -adapt-template: footnote;\n  text-decoration: none;\n}\n\naside[epub|type="footnote"],\naside[epub\\:type="footnote"] {\n  display: none;\n}\n\naside[epub|type="footnote"]:footnote-content,\naside[epub\\:type="footnote"]:footnote-content {\n  display: block;\n  margin: 0.25em;\n  font-size: 1.2em;\n  line-height: 1.2;\n}\n\nepub|trigger {\n  display: none;\n}\n\nepub|switch {\n  display: inline;\n}\n\nepub|default {\n  display: inline;\n}\n\nepub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] {\n  display: inline;\n}\n\nepub|case[required-namespace::supported] ~ epub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] ~ epub|default {\n  display: none;\n}\n',dr='\n@namespace "http://www.w3.org/1999/xhtml";\n\n*:not([data-vivliostyle-role=doc-toc],\n  [data-vivliostyle-role=doc-toc] *,\n  :has([data-vivliostyle-role=doc-toc]),\n  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {\n  display: none;\n}\n\n[hidden] {\n  display: revert;\n}\n\n[data-vivliostyle-role=doc-toc] li a {\n  -adapt-behavior: toc-node-anchor;\n}\n\n[data-vivliostyle-role=doc-toc] li {\n  -adapt-behavior: toc-node;\n}\n\n[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {\n  -adapt-behavior: toc-node-first-child;\n}\n\n[data-vivliostyle-role=doc-toc] :is(ol,ul),\n[data-vivliostyle-role=doc-toc]:is(ol,ul) {\n  -adapt-behavior: toc-container;\n}\n',pr='\n[data-viv-margin-discard~="block-start"] {\n  margin-block-start: 0 !important;\n}\n[data-viv-margin-discard~="block-end"] {\n  margin-block-end: 0 !important;\n}\n[data-viv-margin-discard~="inline-start"] {\n  margin-inline-start: 0 !important;\n}\n[data-viv-margin-discard~="inline-end"] {\n  margin-inline-end: 0 !important;\n}\n\n[data-viv-box-break~="inline-start"]:not([data-viv-box-break~="clone"]) {\n  margin-inline-start: 0 !important;\n  padding-inline-start: 0 !important;\n  border-inline-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-end-start-radius: 0 !important;\n}\n[data-viv-box-break~="inline-end"]:not([data-viv-box-break~="clone"]) {\n  margin-inline-end: 0 !important;\n  padding-inline-end: 0 !important;\n  border-inline-end-width: 0 !important;\n  border-start-end-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-start"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>thead)) {\n  margin-block-start: 0 !important;\n  padding-block-start: 0 !important;\n  border-block-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-start-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-end"]:not([data-viv-box-break~="clone"]):not(table[style*="border-collapse: collapse"]:has(>tfoot)) {\n  margin-block-end: 0 !important;\n  padding-block-end: 0 !important;\n  border-block-end-width: 0 !important;\n  border-end-start-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~="block-start"][data-viv-box-break~="text-start"] {\n  text-indent: 0 !important;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] {\n  text-align-last: justify !important;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] > * {\n  text-align-last: auto;\n}\n[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"]:not([data-viv-box-break~="justify"]) {\n  text-align-last: auto !important;\n}\n\nspan.viv-anonymous-block {\n  display: block;\n}\n\n[data-vivliostyle-page-container] {\n  text-spacing-trim: space-all;\n  text-autospace: no-autospace;\n}\nviv-ts-open.viv-ts-auto > viv-ts-inner,\nviv-ts-open.viv-ts-trim > viv-ts-inner {\n  margin-inline-start: -0.5em;\n}\nviv-ts-close.viv-ts-auto > viv-ts-inner,\nviv-ts-close.viv-ts-trim > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-close.viv-hang-end > viv-ts-inner,\nviv-ts-close.viv-hang-last > viv-ts-inner {\n  letter-spacing: -1em;\n}\nviv-ts-open.viv-ts-auto::before,\nviv-ts-close.viv-ts-auto::after,\nviv-ts-close.viv-hang-end::after {\n  content: " ";\n  font-family: Courier, monospace;\n  word-spacing: normal;\n  letter-spacing: -0.11em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\nviv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {\n  letter-spacing: 0.4em;\n}\nviv-ts-close.viv-hang-hw > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-open.viv-hang-first > viv-ts-inner {\n  display: inline-block;\n  line-height: 1;\n  inline-size: 1em;\n  text-indent: 0;\n  text-align: end;\n  text-align-last: end;\n  margin-inline-start: -1em;\n}\nviv-ts-thin-sp::after {\n  content: " ";\n  font-family: Times, serif;\n  word-spacing: normal;\n  letter-spacing: -0.125em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\n[style*=text-decoration] :is(viv-ts-thin-sp, viv-ts-close.viv-ts-auto)::after {\n  visibility: visible;\n}\n\nspan[data-viv-leader] {\n  text-combine-upright: none;\n  text-orientation: mixed;\n  white-space: pre;\n}\n\n/* ::marker */\n/* Mozilla Bullet font (https://github.com/mozilla/gecko-dev/blob/master/layout/style/res/Mozilla_Bullet.woff2) */\n@font-face {\n  font-family: "-viv-moz-bullet";\n  src: url("data:font/woff2;base64,d09GMgABAAAAAAScAAsAAAAACfAAAARNAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAhBIRCAqGMIRJATYCJAMsCxgABCAFhF4HaBsuCMgehXEsLOlXaXd7sgbPQ172fjLwdhYFM92mABaiTuRVdO5/mx9I5UJiJom3phLRQw/TSF2M/vo25+pNyWkNws81NrUDAAf0QOdfcf7nmPEyBPZtCbbZEDuosskKZG922ZhBenh05qcSXktf6s3Oy9dAkWsyDzMoM5QTKcwKNjFayUPSREGFhUMrdE8MJsH052qGcYNO3pbEaYIBoDTItIKGAqhDdKHRD0kkKg6QGSCWEfueTNr3P6OvYaIbDH/8ULEAbjQtUt+hT/qmX/SH/twwMLDqN4jxzXjy4PHtltSA6lINqkpRd7N7onVBP20y7YBWyDIHFEBjqKBFMmECfQcTZtD3MmEB/SATVtCPM2ED/TQTdtCfS0/pEsN4ySin3r8q8xHE+0D0XMg8gJi4YrNpNv3qetXuDyeo6OBNZrq5gi7ouC1zcmB2Fd+FewIhcUIfszpF1hzXhrmMCwxaznRyZjig6Y2W7+bBn2DL8fJu/2oHbWc6X80+LUTXcVzv8O3IOy4qKVyFw/DHaMtfzNQEi5gbFT/EDpiofbpkYq2dQui6WcpfxrVBEJ/KxbLA4ZroZoVx+iE+QeTIiI7oKuoUIk/a1ekEOoNFjozm0suYYUelq13/88K1c3PTH9O9Q0d5LZbu7+J2aT7XP23KyQs+34WTU7r8d/k0l6dLl98Dn+/BSUZc7U0mm7FqhSMO9EHV/j5FB4qYX4aXNaKwz/4RRfAWsW8xGW+hvr8PTAf6IP9mRpkDwwv7QFz9HRuOeGWfd8rkyYsWTVy4vpG/pgVNWzBx0aTeIgeq58XFVfZXVduwuOq51a77aT0XLVw4v1PBFjRsQzO+tVeVp3KIwqfKbd6sdjzGvFSuPMquGpMT29lkrhwbE5uz6cGHhIETB06oUk+6tHLJgfnu/3nVnJzYxiXNjQNjYqsu+vCgYKDla5uUOzTNDZg46eCBd3d3gSk9Kz/bFiv8hvOzCT5eqyjBGerT+EiG/JGqwbC+UQ6Bv9bmKGWMj8Yn+fPVRJxKBGqTFXQyM9DhHSlvEHmLVxyYjY/Fdd3hACfLyP3VVZLvVR7B0pxSsGIBqHhwT5sSMOMkRG0BJhpsWMkEO24KwE0pqp3tIYTWCIjJjuBiGNTKTj8JoBLKAn4TmPFnj9oywZwFGx4egp1g3oObeLHdwUO2pFcYTITZCa2c1GQbNg6RCsu9bpikThhAWnLaBi3LM8+5VbMU6rUn30owOC83ULcfBlClb5BBre46BinaWRal85SUvlCbUx1Nbyj2HWCxBTkEgWScQKzsTioJW0IanAYRZqET4mZLSKU2JABII9np01lQ7lOt3srtM1KAeqgQPhYJSMCZJRuAukRZB1CF35gB1MJBr4ilIPZchNyIlDkpRt+3s96cz9K8XKQvCdZfcqWxgtLoXZ2AoKAyVSRRxSRmsYjVOriP089q3z6gdMjE5KI7kzumWzpnAwAAAA==") format("woff2");\n}\n[data-adapt-pseudo="marker"] {\n  unicode-bidi: isolate;\n  font-variant-numeric: tabular-nums;\n  white-space: pre;\n  text-transform: none;\n}\n[data-adapt-pseudo="marker"]._viv-marker-bullet {\n  font-family: "-viv-moz-bullet";\n  font-style: normal;\n  font-weight: normal;\n}\n[data-adapt-pseudo="marker"]._viv-marker-outside {\n  position: absolute;\n  text-indent: 0;\n}\n[data-adapt-pseudo="marker"] > ._viv-marker-outside-content {\n  position: absolute;\n  inset-inline-end: 0;\n}\n\n/* initial-letter */\n[style*="--viv-initialLetter"]:has(>[data-adapt-pseudo="first-letter"])::first-letter {\n  -webkit-initial-letter: var(--viv-initialLetter);\n  initial-letter: var(--viv-initialLetter);\n}\n',fr=String.raw`
@counter-style decimal-leading-zero {
  system: extends decimal;
  pad: 2 '0';
}
@counter-style arabic-indic {
  system: numeric;
  symbols:          ;
}
@counter-style armenian {
  system: additive;
  range: 1 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 ;
}
@counter-style upper-armenian {
  system: extends armenian;
}
@counter-style lower-armenian {
  system: additive;
  range: 1 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 ;
}
@counter-style bengali {
  system: numeric;
  symbols:          ;
}
@counter-style cambodian {
  system: numeric;
  symbols:          ;
}
@counter-style khmer {
  system: extends cambodian;
}
@counter-style cjk-decimal {
  system: numeric;
  range: 0 infinite;
  symbols:          ;
  suffix: "";
}
@counter-style devanagari {
  system: numeric;
  symbols:          ;
}
@counter-style georgian {
  system: additive;
  range: 1 19999;
  additive-symbols: 10000 , 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 ;
}
@counter-style gujarati {
  system: numeric;
  symbols:          ;
}
@counter-style gurmukhi {
  system: numeric;
  symbols:          ;
}
@counter-style hebrew {
  system: additive;
  range: 1 10999;
  additive-symbols: 10000 \5D9\5F3, 9000 \5D8\5F3, 8000 \5D7\5F3, 7000 \5D6\5F3, 6000 \5D5\5F3, 5000 \5D4\5F3, 4000 \5D3\5F3, 3000 \5D2\5F3, 2000 \5D1\5F3, 1000 \5D0\5F3, 400 \5EA, 300 \5E9, 200 \5E8, 100 \5E7, 90 \5E6, 80 \5E4, 70 \5E2, 60 \5E1, 50 \5E0, 40 \5DE, 30 \5DC, 20 \5DB, 19 \5D9\5D8, 18 \5D9\5D7, 17 \5D9\5D6, 16 \5D8\5D6, 15 \5D8\5D5, 10 \5D9, 9 \5D8, 8 \5D7, 7 \5D6, 6 \5D5, 5 \5D4, 4 \5D3, 3 \5D2, 2 \5D1, 1 \5D0;
}
@counter-style kannada {
  system: numeric;
  symbols:          ;
}
@counter-style lao {
  system: numeric;
  symbols:          ;
}
@counter-style malayalam {
  system: numeric;
  symbols:          ;
}
@counter-style mongolian {
  system: numeric;
  symbols:          ;
}
@counter-style myanmar {
  system: numeric;
  symbols:          ;
}
@counter-style oriya {
  system: numeric;
  symbols:          ;
}
@counter-style persian {
  system: numeric;
  symbols:          ;
}
@counter-style lower-roman {
  system: additive;
  range: 1 3999;
  additive-symbols: 1000 m, 900 cm, 500 d, 400 cd, 100 c, 90 xc, 50 l, 40 xl, 10 x, 9 ix, 5 v, 4 iv, 1 i;
}
@counter-style upper-roman {
  system: additive;
  range: 1 3999;
  additive-symbols: 1000 M, 900 CM, 500 D, 400 CD, 100 C, 90 XC, 50 L, 40 XL, 10 X, 9 IX, 5 V, 4 IV, 1 I;
}
@counter-style tamil {
  system: numeric;
  symbols:          ;
}
@counter-style telugu {
  system: numeric;
  symbols:          ;
}
@counter-style thai {
  system: numeric;
  symbols:          ;
}
@counter-style tibetan {
  system: numeric;
  symbols:          ;
}
@counter-style lower-alpha {
  system: alphabetic;
  symbols: a b c d e f g h i j k l m n o p q r s t u v w x y z;
}
@counter-style lower-latin {
  system: extends lower-alpha;
}
@counter-style upper-alpha {
  system: alphabetic;
  symbols: A B C D E F G H I J K L M N O P Q R S T U V W X Y Z;
}
@counter-style upper-latin {
  system: extends upper-alpha;
}
@counter-style lower-greek {
  system: alphabetic;
  symbols:                        ;
}
@counter-style hiragana {
  system: alphabetic;
  symbols:                                                ;
  suffix: "";
}
@counter-style hiragana-iroha {
  system: alphabetic;
  symbols:                                               ;
  suffix: "";
}
@counter-style katakana {
  system: alphabetic;
  symbols:                                                ;
  suffix: "";
}
@counter-style katakana-iroha {
  system: alphabetic;
  symbols:                                               ;
  suffix: "";
}
@counter-style cjk-earthly-branch {
  system: fixed;
  symbols:            ;
  suffix: "";
  fallback: cjk-decimal;
}
@counter-style cjk-heavenly-stem {
  system: fixed;
  symbols:          ;
  suffix: "";
  fallback: cjk-decimal;
}
@counter-style japanese-informal {
  system: additive;
  range: -9999 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 , 0 ;
  suffix: "";
  negative: ;
  fallback: cjk-decimal;
}
@counter-style japanese-formal {
  system: additive;
  range: -9999 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 , 0 ;
  suffix: "";
  negative: ;
  fallback: cjk-decimal;
}
@counter-style korean-hangul-formal {
  system: additive;
  range: -9999 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 , 0 ;
  suffix: ', ';
  negative: " ";
  fallback: cjk-decimal;
}
@counter-style korean-hanja-informal {
  system: additive;
  range: -9999 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 , 0 ;
  suffix: ', ';
  negative: " ";
  fallback: cjk-decimal;
}
@counter-style korean-hanja-formal {
  system: additive;
  range: -9999 9999;
  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 , 0 ;
  suffix: ', ';
  negative: " ";
  fallback: cjk-decimal;
}
`+"\n@counter-style lower-armenian {\n  system: additive;\n  range: 1 9999;\n  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 ;\n}\n@counter-style upper-armenian {\n  system: additive;\n  range: 1 9999;\n  additive-symbols: 9000 , 8000 , 7000 , 6000 , 5000 , 4000 , 3000 , 2000 , 1000 , 900 , 800 , 700 , 600 , 500 , 400 , 300 , 200 , 100 , 90 , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 , 9 , 8 , 7 , 6 , 5 , 4 , 3 , 2 , 1 ;\n}\n@counter-style lower-russian {\n  system: alphabetic;\n  symbols:                            ;\n  suffix: ') ';\n}\n@counter-style upper-russian {\n  system: alphabetic;\n  symbols:                            ;\n}";function gr(e,t,i){let n=Gn("fetchFromURL"),r={method:i||"GET",mode:"cors"},o=n.suspend(),s={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};return fetch(e,r).then(i=>{var n;return s.status=i.status,s.url=i.url,s.statusText=i.statusText,s.contentType=null==(n=i.headers.get("Content-Type"))?void 0:n.replace(/;.*$/,"").toLowerCase(),i.ok?"blob"===t?i.blob():"arraybuffer"===t?i.arrayBuffer():"json"===t?i.json():/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?(s.contentType="text/html",i.arrayBuffer().then(e=>new TextDecoder("Shift_JIS").decode(e))):(/^data:,(<|%3c)/i.test(e)&&(s.contentType="text/html"),i.text()):i.text()}).then(e=>{"blob"===t&&e instanceof Blob?s.responseBlob=e:"arraybuffer"===t&&e instanceof ArrayBuffer?s.responseBlob=mr([e]):"json"===t?s.responseText=JSON.stringify(e):"string"==typeof e&&(s.responseText=e),o.schedule(s)}).catch(t=>{R.warn(t,`Error fetching ${e}`),o.schedule(s)}),n.result()}function mr(e,t){return new Blob(e,{type:t||"application/octet-stream"})}var br=class{constructor(e,t){this.parser=e,this.type=t,h(this,"resources",{}),h(this,"fetchers",{})}load(e,t,i){e=Q(e);let n=this.resources[e];return void 0!==n?qn(n):this.fetch(e,t,i).get()}fetchInner(e,t,i){let n=Gn("fetch"),r=e.endsWith("?viv-toc-box");r&&(e=e.replace("?viv-toc-box",""));let o=re("user-agent.xml",ie),s=!r&&e===o;return s&&(e=`data:application/xml,${encodeURIComponent(hr)}`),gr(e,this.type).then(a=>{if(a.status>=400&&t)throw new Error((i||`Failed to fetch required resource: ${e}`)+` (${a.status}${a.statusText?" "+a.statusText:""})`);r?(e+="?viv-toc-box",a.url+="?viv-toc-box"):s&&(a.url=e=o),this.parser(a,this).then(t=>{delete this.fetchers[e],this.resources[e]=t,n.finish(t)})}),n.result()}fetch(e,t,i){if(e=Q(e),this.resources[e])return null;let n=this.fetchers[e];return n||(n=new rr(()=>this.fetchInner(e,t,i),`Fetch ${e}`),this.fetchers[e]=n,n.start()),n}get(e){return this.resources[Q(e)]}delete(e){delete this.resources[Q(e)]}};function vr(e,t){let i=e.responseText;return qn(i?J(i):null)}function yr(e,t,i){let n=new rr(()=>{let n=Gn("loadElement"),r=n.suspend(e),o=!1,s=null,a=e=>{o||(o=!0,null!==s&&(clearTimeout(s),s=null),r.schedule(e?e.type:"timeout"))};if(e.addEventListener("load",a,!1),e.addEventListener("error",a,!1),e.addEventListener("abort",a,!1),"http://www.w3.org/2000/svg"==e.namespaceURI)t&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),s=setTimeout(a,300);else if("script"===e.localName)s=setTimeout(a,3e3);else if(t)if("img"===e.localName){let n=e;"lazy"===n.loading&&(n.loading="eager"),n.src=t,i&&(n.alt=i),n.complete?setTimeout(()=>a(new Event("load")),0):s=setTimeout(a,3e4)}else e.src=t,i&&(e.alt=i);return n.result()},`loadElement ${t||e.localName}`);return n.start(),n}var wr=33554432,xr=50331648,Sr=67108864,Cr=class{constructor(e){this.scope=e,h(this,"flavor"),this.flavor="Author"}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,i,n){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startCounterStyleRule(e){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,i){}startPartitionRule(e,t,i){}startPartitionGroupRule(e,t,i){}startRuleBody(){}property(e,t,i){}endRule(){}startFuncWithSelector(e,t){}endFuncWithSelector(){}pushSelectorText(e){}getImportantSpecificity(){switch(this.flavor){case"UA":return 0;case"User":return 100663296;default:return 83886080}}getBaseSpecificity(){switch(this.flavor){case"UA":return 0;case"User":return 16777216;default:return wr}}},kr=class extends Cr{constructor(){super(null),h(this,"stack",[]),h(this,"tokenizer",null),h(this,"slave",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){var i;R.warn(e,null!=(i=null==t?void 0:t.toString())?i:"")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,i,n){this.slave.attributeSelector(e,t,i,n)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startCounterStyleRule(e){this.slave.startCounterStyleRule(e)}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,i){this.slave.startPageMasterRule(e,t,i)}startPartitionRule(e,t,i){this.slave.startPartitionRule(e,t,i)}startPartitionGroupRule(e,t,i){this.slave.startPartitionGroupRule(e,t,i)}startRuleBody(){this.slave.startRuleBody()}property(e,t,i){this.slave.property(e,t,i)}endRule(){this.slave.endRule()}startFuncWithSelector(e,t){this.slave.startFuncWithSelector(e,t)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},Er=class extends Cr{constructor(e,t,i){super(e),this.owner=t,this.topLevel=i,h(this,"depth",0),t&&(this.flavor=t.flavor)}getCurrentToken(){var e;return null==(e=this.owner)?void 0:e.getCurrentToken()}error(e,t){var i;null==(i=this.owner)||i.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){0==--this.depth&&!this.topLevel&&this.owner.popHandler()}},Pr=class extends Er{constructor(e,t,i){super(e,t,i)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new Er(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startCounterStyleRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_COUNTER_STYLE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e,t){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,i){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}},Nr=[],Tr=[],Ir=[],Ar=[],_r=[],Rr=[],Lr=[],Fr=[],Or=[],Br=[],Mr=[],zr=[],Dr=[],Vr=55,Ur=56;Nr[1]=28,Nr[36]=29,Nr[7]=29,Nr[9]=29,Nr[14]=29,Nr[18]=29,Nr[50]=29,Nr[20]=30,Nr[13]=27,Nr[0]=200,Tr[1]=46,Tr[0]=200,Rr[1]=2,Rr[36]=4,Rr[7]=6,Rr[9]=8,Rr[14]=10,Rr[18]=14,Rr[50]=42,Ir[37]=11,Ir[23]=12,Ir[35]=56,Ir[1]=1,Ir[36]=3,Ir[7]=5,Ir[9]=7,Ir[14]=9,Ir[12]=13,Ir[18]=55,Ir[50]=58,Ir[16]=41,Ar[37]=11,Ar[23]=12,Ar[35]=56,Ar[1]=1,Ar[36]=3,Ar[7]=5,Ar[9]=7,Ar[14]=9,Ar[18]=55,_r[1]=2,_r[36]=4,_r[7]=6,_r[9]=8,_r[18]=14,_r[50]=42,_r[14]=10,_r[12]=13,Lr[1]=15,Lr[7]=16,Lr[4]=17,Lr[5]=18,Lr[3]=19,Lr[2]=20,Lr[8]=21,Lr[27]=57,Lr[16]=22,Lr[19]=23,Lr[6]=24,Lr[11]=25,Lr[17]=26,Lr[13]=48,Lr[31]=47,Lr[23]=54,Lr[0]=44,Fr[1]=31,Fr[4]=32,Fr[5]=32,Fr[3]=33,Fr[2]=34,Fr[10]=40,Fr[6]=38,Fr[31]=36,Fr[24]=36,Fr[32]=35,Or[1]=45,Or[16]=37,Or[37]=37,Or[38]=37,Or[47]=37,Or[48]=37,Or[39]=37,Or[49]=37,Or[41]=37,Or[26]=37,Or[25]=37,Or[23]=37,Or[24]=37,Or[19]=37,Or[21]=37,Or[36]=37,Or[18]=37,Or[22]=37,Or[11]=39,Or[12]=43,Or[17]=49,Br[0]=200,Br[12]=50,Br[13]=51,Br[14]=50,Br[15]=51,Br[10]=50,Br[11]=51,Br[17]=53,Mr[0]=200,Mr[12]=50,Mr[13]=52,Mr[14]=50,Mr[15]=51,Mr[10]=50,Mr[11]=51,Mr[17]=53,zr[0]=200,zr[12]=50,zr[13]=51,zr[14]=50,zr[15]=51,zr[10]=50,zr[11]=51,Dr[11]=0,Dr[16]=0,Dr[22]=1,Dr[18]=1,Dr[26]=2,Dr[25]=2,Dr[38]=3,Dr[37]=3,Dr[48]=3,Dr[47]=3,Dr[39]=3,Dr[49]=3,Dr[41]=3,Dr[23]=4,Dr[24]=4,Dr[36]=5,Dr[19]=5,Dr[21]=5,Dr[0]=6,Dr[Vr]=2,Dr[Ur]=2;var Hr=class{constructor(e,t,i,n){this.actions=e,this.tokenizer=t,this.handler=i,this.baseURL=n,h(this,"valStack",[]),h(this,"namespacePrefixToURI",{}),h(this,"defaultNamespaceURI",null),h(this,"propName",null),h(this,"propImportant",!1),h(this,"exprContext"),h(this,"result",null),h(this,"importReady",!1),h(this,"importURL",null),h(this,"importCondition",null),h(this,"errorBrackets",[]),h(this,"ruleStack",[]),h(this,"regionRule",!1),h(this,"pageRule",!1),h(this,"inStyleDeclaration",!1),this.exprContext=2}extractVals(e,t){let i=[],n=this.valStack;for(;t<n.length&&(i.push(n[t++]),t!==n.length);){if(n[t++]!==e)throw new Error("Unexpected state");t===n.length&&i.push(jt)}return i}valStackReduce(e,t){let i,n=this.valStack,r=n.length,o=0;do{if(i=n[--r],")"===e&&i instanceof li)if(")"===i.text)o++;else if("("===i.text){if(0===o)return null;o--}}while(void 0!==i&&"string"!=typeof i);let s=n.length-(r+1);if(s>1&&n.splice(r+1,s,new ri(n.slice(r+1,n.length))),","==e)return null;r++;do{i=n[--r]}while(void 0!==i&&("string"!=typeof i||","==i));if(s=n.length-(r+1),"("==i){")"!=e&&0!==t.type&&(this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=Mr);let i=new si(n[r-1],this.extractVals(",",r+1));if(n.splice(r-1,s+2,i),"var"===i.name){let e=i.values[0]instanceof Yt&&i.values[0].name;(!yi(e)||e===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${i.toString()}`,t),this.actions=Mr)}return i}if(";"!=e||r>=0)return this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=Mr,null;if(s>1)return new oi(this.extractVals(",",r+1));let a=n[0];return a instanceof Ht?a:a?new li(a.toString()):jt}exprError(e,t){this.actions=this.propName?Mr:Br,R.warn(e,t.toString())}exprStackReduce(e,t){let i,n=this.valStack,r=this.handler,o=n.pop();for(;;){let s=n.pop();if(11==e){let t=[o];for(;16==s;)t.unshift(n.pop()),s=n.pop();if("string"==typeof s){if("{"==s){for(;t.length>=2;){let e=t.shift(),i=t.shift(),n=new dt(r.getScope(),e,i);t.unshift(n)}return n.push(new ai(t[0])),!0}if("("==s){let i=n.pop(),s=n.pop();o=new It(r.getScope(),Ge(s,i),t),e=0;continue}}if(10==s){o.isMediaName()&&(o=new Rt(r.getScope(),o,null)),e=0;continue}}else if("string"==typeof s){n.push(s);break}if(s<0)if(-31==s)o=new st(r.getScope(),o);else if(-24==s)o=new lt(r.getScope(),o);else{if(-57!=s)return this.exprError("F_UNEXPECTED_STATE",t),!1;o=new at(r.getScope(),o)}else{if(Dr[e]>Dr[s]){n.push(s);break}switch(i=n.pop(),s){case 26:o=new ht(r.getScope(),i,o);break;case Vr:o=new ut(r.getScope(),i,o);break;case Ur:o=new pt(r.getScope(),i,o);break;case 25:o=new ct(r.getScope(),i,o);break;case 38:o=new ft(r.getScope(),i,o);break;case 37:o=new mt(r.getScope(),i,o);break;case 48:o=new gt(r.getScope(),i,o);break;case 47:o=new bt(r.getScope(),i,o);break;case 39:case 49:o=new vt(r.getScope(),i,o);break;case 41:o=new yt(r.getScope(),i,o);break;case 23:o=new wt(r.getScope(),i,o);break;case 24:o=new xt(r.getScope(),i,o);break;case 36:o=new St(r.getScope(),i,o);break;case 19:o=new Ct(r.getScope(),i,o);break;case 21:o=new kt(r.getScope(),i,o);break;case 18:if(!(n.length>1))return this.exprError("E_CSS_EXPR_COND",t),!1;switch(n[n.length-1]){case 22:n.pop(),o=new At(r.getScope(),n.pop(),i,o);break;case 10:if(!i.isMediaName())return this.exprError("E_CSS_MEDIA_TEST",t),!1;o=new Rt(r.getScope(),i,o)}break;case 22:if(18!=e)return this.exprError("E_CSS_EXPR_COND",t),!1;case 10:return n.push(i),n.push(s),n.push(o),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return n.push(o),!1}readSupportsTest(e){let t,i,n=6===e.type,r=this.tokenizer;if(n)i=e.text,t=e.position+i.length+1;else{if(10!==e.type)return null;{let n=r.nthToken(1),o=r.nthToken(2);if(1===n.type&&18===o.type)r.consume(),r.consume(),i=n.text,t=o.position+1;else{if(10===n.type||6===n.type||1===n.type&&"not"===n.text.toLowerCase()&&(10===o.type||6===o.type))return null;t=e.position+1}}}let o,s=0,a=0;for(;s>=0;)switch(r.consume(),o=r.token(),o.type){case 11:s--;break;case 10:case 6:s++;break;case 16:0===s&&a++;break;case 0:return this.exprError("E_CSS_UNEXPECTED_EOF",o),null}r.consume();let l=o.position,h=n&&"selector"===i&&a>0?"":r.input.substring(t,l).trim();return new Lt(this.handler.getScope(),i,h,n)}readPseudoParams(){let e=[];for(;;){let t=this.tokenizer.token();switch(t.type){case 1:e.push(t.text);break;case 23:e.push("+");break;case 4:case 5:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(23===t.type)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(1===t.type&&("even"===t.text||"odd"===t.text))return this.tokenizer.consume(),[2,"odd"===t.text?1:0];switch(t.type){case 3:if(e&&t.num<0)return null;case 1:if(e&&"-"===t.text.charAt(0))return null;if("n"===t.text||"-n"===t.text){if(e&&t.precededBySpace)return null;let i="-n"===t.text?-1:1;3===t.type&&(i=t.num);let n=0;this.tokenizer.consume(),t=this.tokenizer.token();let r=24===t.type,o=23===t.type||r;if(o&&(this.tokenizer.consume(),t=this.tokenizer.token()),5===t.type){if(n=t.num,1/n==-1/0){if(n=0,o)return null}else if(n<0){if(o)return null}else if(n>=0&&!o)return null;this.tokenizer.consume()}else if(o)return null;return[i,r&&n>0?-n:n]}if("n-"===t.text||"-n-"===t.text){if(e&&t.precededBySpace)return null;let i="-n-"===t.text?-1:1;if(3===t.type&&(i=t.num),this.tokenizer.consume(),t=this.tokenizer.token(),5===t.type)return t.num<0||1/t.num==-1/0?null:(this.tokenizer.consume(),[i,t.num])}else{let i=t.text.match(/^n(-[0-9]+)$/);if(i)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[3===t.type?t.num:1,parseInt(i[1],10)]);if(i=t.text.match(/^-n(-[0-9]+)$/),i)return this.tokenizer.consume(),[-1,parseInt(i[1],10)]}return null;case 5:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){let i=this.handler.getScope();if(!i)return null;if(t=t||i._true,e){let n=e.split(/\s+/);for(let e of n)switch(e){case"vertical":t=Ot(i,t,new st(i,new Pt(i,"pref-horizontal")));break;case"horizontal":t=Ot(i,t,new Pt(i,"pref-horizontal"));break;case"day":t=Ot(i,t,new st(i,new Pt(i,"pref-night-mode")));break;case"night":t=Ot(i,t,new Pt(i,"pref-night-mode"));break;default:t=i._false}}return t===i._true?null:new ai(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"counter-style":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,i,n,r,o){let s,a,l,h,u,c,d,p=this.handler,f=this.tokenizer,g=this.valStack,m=null;for(i&&(this.inStyleDeclaration=!0),n&&(this.exprContext=2,this.valStack.push("{"));e>0;--e)if(s=f.token(),r&&null===m&&(m=s.position-1,"("===f.input[m]&&m++),this.actions===Lr&&this.errorBrackets.length>0&&(s.type===this.errorBrackets[this.errorBrackets.length-1]||17===s.type||31===s.type)){if(s.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),11===s.type&&this.valStackReduce(")",s))){f.consume();continue}g.push(new li(s.toString())),f.consume()}else switch(this.actions[s.type]){case 28:if(!this.inStyleDeclaration||18!=f.nthToken(1).type){this.isInsidePropertyOnlyRule()?(p.error("E_CSS_COLON_EXPECTED",f.nthToken(1)),this.actions=Mr):(this.actions=Rr,p.startSelectorRule());continue}this.propName=s.text,this.propImportant=!1,f.consume(),f.consume(),this.actions=Lr,g.splice(0,g.length);continue;case 46:if(18!=f.nthToken(1).type){this.actions=Mr,p.error("E_CSS_COLON_EXPECTED",f.nthToken(1));continue}this.propName=s.text,this.propImportant=!1,f.consume(),f.consume(),this.actions=Lr,g.splice(0,g.length);continue;case 29:this.actions=Rr,p.startSelectorRule();continue;case 1:if(!s.precededBySpace){this.actions=zr,p.error("E_CSS_SPACE_EXPECTED",s);continue}p.descendantSelector();case 2:if(34==f.nthToken(1).type)if(f.consume(),f.consume(),l=this.namespacePrefixToURI[s.text],null!=l)switch(s=f.token(),s.type){case 1:p.tagSelector(l,s.text),this.actions=r?Ar:Ir,f.consume();break;case 36:p.tagSelector(l,null),this.actions=r?Ar:Ir,f.consume();break;default:this.actions=Br,p.error("E_CSS_NAMESPACE",s)}else this.actions=Br,p.error("E_CSS_UNDECLARED_PREFIX",s);else p.tagSelector(this.defaultNamespaceURI,s.text),this.actions=r?Ar:Ir,f.consume();continue;case 3:if(!s.precededBySpace){this.actions=zr,p.error("E_CSS_SPACE_EXPECTED",s);continue}p.descendantSelector();case 4:if(34==f.nthToken(1).type)switch(f.consume(),f.consume(),s=f.token(),s.type){case 1:p.tagSelector(null,s.text),this.actions=r?Ar:Ir,f.consume();break;case 36:p.tagSelector(null,null),this.actions=r?Ar:Ir,f.consume();break;default:this.actions=Br,p.error("E_CSS_NAMESPACE",s)}else p.tagSelector(this.defaultNamespaceURI,null),this.actions=r?Ar:Ir,f.consume();continue;case 5:s.precededBySpace&&p.descendantSelector();case 6:if(!s.text){p.error("E_CSS_SYNTAX",s),f.consume();continue}p.idSelector(s.text),this.actions=r?Ar:Ir,f.consume();continue;case 7:s.precededBySpace&&p.descendantSelector();case 8:p.classSelector(s.text),this.actions=r?Ar:Ir,f.consume();continue;case 55:s.precededBySpace&&p.descendantSelector();case 14:f.consume(),s=f.token();e:switch(s.type){case 1:p.pseudoclassSelector(s.text,null),f.consume(),this.actions=r?Ar:Ir;continue;case 6:switch(h=s.text,f.consume(),h){case"is":case"not":case"where":case"has":this.actions=Rr,p.startFuncWithSelector(h),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,"has"===h)?this.actions=Ir:this.actions=zr;continue;case"lang":case"href-epub-type":if(s=f.token(),1===s.type){d=[s.text],f.consume(),"href-epub-type"===h&&16===f.token().type&&(f.consume(),s=f.token(),1===s.type&&(d.push(s.text),f.consume()));break}break e;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":case"nth":if(d=this.readNthPseudoParams(),d){if("nth-child"===h||"nth-last-child"===h){if(a=f.nthToken(0),1===a.type&&"of"===a.text){f.consume(),this.actions=Rr,p.startFuncWithSelector(h,d),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,!1)?this.actions=r?Ar:Ir:this.actions=zr;continue}break}if("nth"===h){if(a=f.nthToken(0),1===a.type&&"of"===a.text){if(f.consume(),a=f.token(),1!==a.type)break e;d.push(a.text),f.consume()}break}break}break e;default:d=this.readPseudoParams()}if(s=f.token(),11==s.type){p.pseudoclassSelector(h,d),f.consume(),this.actions=r?Ar:Ir;continue}}p.error("E_CSS_PSEUDOCLASS_SYNTAX",s),this.actions=Br;continue;case 58:s.precededBySpace&&p.descendantSelector();case 42:switch(f.consume(),s=f.token(),s.type){case 1:p.pseudoelementSelector(s.text,null),this.actions=r?Ar:Ir,f.consume();continue;case 6:if(h=s.text,f.consume(),"nth-fragment"==h){if(d=this.readNthPseudoParams(),null===d)break}else d=this.readPseudoParams();if(s=f.token(),11==s.type){p.pseudoelementSelector(h,d),this.actions=r?Ar:Ir,f.consume();continue}}p.error("E_CSS_PSEUDOELEM_SYNTAX",s),this.actions=Br;continue;case 9:s.precededBySpace&&p.descendantSelector();case 10:if(f.consume(),s=f.token(),1==s.type)h=s.text,f.consume();else if(36==s.type)h=null,f.consume();else{if(34!=s.type){this.actions=zr,p.error("E_CSS_ATTR",s),f.consume();continue}h=""}if(s=f.token(),34==s.type){if(l=h&&this.namespacePrefixToURI[h],void 0===l){this.actions=zr,p.error("E_CSS_UNDECLARED_PREFIX",s),f.consume();continue}if(f.consume(),s=f.token(),1!=s.type){this.actions=zr,p.error("E_CSS_ATTR_NAME_EXPECTED",s);continue}h=s.text,f.consume(),s=f.token()}else l="";switch(s.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:u=s.type,f.consume(),s=f.token();break;case 15:p.attributeSelector(l,h,0,null),this.actions=r?Ar:Ir,f.consume();continue;default:this.actions=zr,p.error("E_CSS_ATTR_OP_EXPECTED",s);continue}switch(s.type){case 1:case 2:p.attributeSelector(l,h,u,s.text),f.consume(),s=f.token();break;default:this.actions=zr,p.error("E_CSS_ATTR_VAL_EXPECTED",s);continue}if(15!=s.type){this.actions=zr,p.error("E_CSS_ATTR",s);continue}this.actions=r?Ar:Ir,f.consume();continue;case 11:p.childSelector(),this.actions=_r,f.consume();continue;case 12:p.adjacentSiblingSelector(),this.actions=_r,f.consume();continue;case 56:p.followingSiblingSelector(),this.actions=_r,f.consume();continue;case 13:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push("[selector]"),this.inStyleDeclaration=!0),p.startRuleBody(),this.actions=Nr,f.consume();continue;case 41:p.nextSelector(),this.actions=Rr,f.consume();continue;case 15:g.push(Kt(s.text)),f.consume();continue;case 16:u=parseInt(s.text,16),g.push(new ei(s.text)),f.consume();continue;case 17:g.push(new Jt(s.num)),f.consume();continue;case 18:g.push(new Qt(s.num)),f.consume();continue;case 19:g.push(new Zt(s.num,s.text)),f.consume();continue;case 20:g.push(new qt(s.text)),f.consume();continue;case 21:g.push(new ti(re(s.text,this.baseURL))),f.consume();continue;case 57:g.push(new ii(s.text)),f.consume();continue;case 22:this.valStackReduce(",",s),g.push(","),f.consume();continue;case 23:g.push(Gt),f.consume();continue;case 24:h=s.text.toLowerCase(),"-epubx-expr"==h||"env"==h?(this.actions=Fr,this.exprContext=0,g.push("{")):(g.push(h),g.push("("),this.errorBrackets.length>0&&this.errorBrackets.push(11)),f.consume();continue;case 25:this.valStackReduce(")",s),f.consume();continue;case 47:if(f.consume(),s=f.token(),a=f.nthToken(1),1==s.type&&"important"==s.text.toLowerCase()&&(17==a.type||0==a.type||13==a.type)){f.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",s);continue;case 54:switch(a=f.nthToken(1),a.type){case 4:case 3:case 5:if(!a.precededBySpace){f.consume();continue}}g.push(new li("+")),f.consume();continue;case 26:f.consume();case 48:c=this.valStackReduce(";",s),c&&this.propName&&p.property(this.propName,c,this.propImportant),this.actions=i?Tr:Nr;continue;case 44:for(f.consume();g.length>0;){let e=g.length;if(c=this.valStackReduce(";",s),!c||g.length===e)break}return t?(this.result=c,!0):(this.propName&&c&&p.property(this.propName,c,this.propImportant),!0);case 31:if(a=f.nthToken(1),9==a.type)10!=f.nthToken(2).type||f.nthToken(2).precededBySpace?(g.push(new Pt(p.getScope(),Ge(s.text,a.text))),this.actions=Or):(g.push(s.text,a.text,"("),f.consume()),f.consume();else{if(2==this.exprContext||3==this.exprContext)"not"==s.text.toLowerCase()?(f.consume(),g.push(new Nt(p.getScope(),!0,a.text))):("only"==s.text.toLowerCase()&&(f.consume(),s=a),g.push(new Nt(p.getScope(),!1,s.text)));else{if(4===this.exprContext&&"not"===s.text.toLowerCase()&&g[g.length-1]!==Vr&&g[g.length-1]!==Ur&&(10===a.type||6===a.type)){g.push(-57),f.consume();continue}g.push(new Pt(p.getScope(),s.text))}this.actions=Or}f.consume();continue;case 38:if(4===this.exprContext){g.push(this.readSupportsTest(s)),this.actions=Or;continue}g.push(null,s.text,"("),f.consume();continue;case 32:g.push(new _t(p.getScope(),s.num)),f.consume(),this.actions=Or;continue;case 33:h=s.text,"%"==h&&(h=this.propName&&this.propName.match(/height|^(top|bottom)$/)?"vh":"vw"),g.push(new Et(p.getScope(),s.num,h)),f.consume(),this.actions=Or;continue;case 34:g.push(new _t(p.getScope(),s.text)),f.consume(),this.actions=Or;continue;case 35:f.consume(),s=f.token(),5!=s.type||s.precededBySpace?this.exprError("E_CSS_SYNTAX",s):(g.push(new Ft(p.getScope(),s.num)),f.consume(),this.actions=Or);continue;case 36:g.push(-s.type),f.consume();continue;case 37:this.actions=Fr,this.exprStackReduce(s.type,s),g.push(s.type),f.consume();continue;case 45:"and"===s.text.toLowerCase()&&g[g.length-2]!==Ur&&-57!==g[g.length-2]?(this.actions=Fr,this.exprStackReduce(Vr,s),g.push(Vr),f.consume()):"or"===s.text.toLowerCase()&&g[g.length-2]!==Vr&&-57!==g[g.length-2]?(this.actions=Fr,this.exprStackReduce(Ur,s),g.push(Ur),f.consume()):this.exprError("E_CSS_SYNTAX",s);continue;case 39:this.exprStackReduce(s.type,s)&&(this.actions=Lr),f.consume();continue;case 43:this.exprStackReduce(11,s)&&(this.propName||3==this.exprContext?this.exprError("E_CSS_UNEXPECTED_BRC",s):(1==this.exprContext?p.startWhenRule(g.pop()):p.startMediaRule(g.pop()),this.ruleStack.push("media"),p.startRuleBody(),this.actions=Nr)),f.consume();continue;case 49:if(this.exprStackReduce(11,s))return this.propName||3!=this.exprContext?(this.exprError("E_CSS_UNEXPECTED_SEMICOL",s),this.actions=Nr,f.consume(),!1):(this.importCondition=g.pop(),this.importReady=!0,this.actions=Nr,f.consume(),!1);f.consume();continue;case 40:if(4===this.exprContext){let e=this.readSupportsTest(s);if(e){g.push(e),this.actions=Or;continue}}g.push(s.type),f.consume();continue;case 27:if(this.actions=Nr,f.consume(),p.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case"page":case"-epubx-page-master":case"-epubx-partition-group":this.inStyleDeclaration=!0}continue;case 30:switch(h=s.text.toLowerCase(),h){case"import":if(f.consume(),s=f.token(),2==s.type||8==s.type){if(this.importURL=s.text,f.consume(),s=f.token(),17==s.type||0==s.type)return this.importReady=!0,f.consume(),!1;this.propName=null,this.exprContext=3,this.actions=Fr,g.push("{");continue}p.error("E_CSS_IMPORT_SYNTAX",s),this.actions=Br;continue;case"namespace":switch(f.consume(),s=f.token(),s.type){case 1:if(h=s.text,f.consume(),s=f.token(),(2==s.type||8==s.type)&&17==f.nthToken(1).type){this.namespacePrefixToURI[h]=s.text,f.consume(),f.consume();continue}break;case 2:case 8:if(17==f.nthToken(1).type){this.defaultNamespaceURI=s.text,f.consume(),f.consume();continue}}p.error("E_CSS_NAMESPACE_SYNTAX",s),this.actions=Br;continue;case"charset":if(f.consume(),s=f.token(),2==s.type&&17==f.nthToken(1).type){h=s.text.toLowerCase(),"utf-8"!=h&&"utf-16"!=h&&p.error(`E_CSS_UNEXPECTED_CHARSET ${h}`,s),f.consume(),f.consume();continue}p.error("E_CSS_CHARSET_SYNTAX",s),this.actions=Br;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(12==f.nthToken(1).type){switch(f.consume(),f.consume(),h){case"font-face":p.startFontFaceRule(),this.inStyleDeclaration=!0;break;case"-epubx-page-template":p.startPageTemplateRule();break;case"-epubx-define":p.startDefineRule(),this.inStyleDeclaration=!0;break;case"-epubx-viewport":p.startViewportRule(),this.inStyleDeclaration=!0}this.ruleStack.push(h),p.startRuleBody();continue}break;case"-adapt-footnote-area":switch(f.consume(),s=f.token(),s.type){case 12:f.consume(),p.startFootnoteRule(null),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(f.consume(),s=f.token(),1==s.type&&12==f.nthToken(1).type){h=s.text,f.consume(),f.consume(),p.startFootnoteRule(h),this.ruleStack.push("-adapt-footnote-area"),p.startRuleBody(),this.inStyleDeclaration=!0;continue}}break;case"-epubx-region":f.consume(),p.startRegionRule(),this.regionRule=!0,this.actions=Rr;continue;case"page":f.consume(),p.startPageRule(),this.pageRule=!0,this.actions=_r;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(f.consume(),s=f.token(),12==s.type){f.consume(),p.startPageMarginBoxRule(h),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-when":f.consume(),this.propName=null,this.exprContext=1,this.actions=Fr,g.push("{");continue;case"media":f.consume(),this.propName=null,this.exprContext=2,this.actions=Fr,g.push("{");continue;case"supports":f.consume(),this.propName=null,this.exprContext=4,this.actions=Fr,g.push("{");continue;case"-epubx-flow":if(1==f.nthToken(1).type&&12==f.nthToken(2).type){p.startFlowRule(f.nthToken(1).text),f.consume(),f.consume(),f.consume(),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"counter-style":if(1==f.nthToken(1).type&&12==f.nthToken(2).type){p.startCounterStyleRule(f.nthToken(1).text),f.consume(),f.consume(),f.consume(),this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{f.consume(),s=f.token();let e=null,t=null,i=[];for(1==s.type&&(e=s.text,f.consume(),s=f.token()),18==s.type&&1==f.nthToken(1).type&&(t=f.nthToken(1).text,f.consume(),f.consume(),s=f.token());6==s.type&&"class"==s.text.toLowerCase()&&1==f.nthToken(1).type&&11==f.nthToken(2).type;)i.push(f.nthToken(1).text),f.consume(),f.consume(),f.consume(),s=f.token();if(12==s.type){switch(f.consume(),h){case"-epubx-page-master":p.startPageMasterRule(e,t,i);break;case"-epubx-partition":p.startPartitionRule(e,t,i);break;case"-epubx-partition-group":p.startPartitionGroupRule(e,t,i)}this.ruleStack.push(h),p.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case"":p.error(`E_CSS_UNEXPECTED_AT${h}`,s),this.actions=zr;continue;default:p.error(`E_CSS_AT_UNKNOWN ${h}`,s),this.actions=Br;continue}p.error(`E_CSS_AT_SYNTAX ${h}`,s),this.actions=Br;continue;case 50:this.errorBrackets.push(s.type+1),f.consume();continue;case 52:if(0==this.errorBrackets.length){this.actions=Nr;continue}case 51:if(r&&0==this.errorBrackets.length&&11==s.type)return f.consume(),p.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==s.type&&this.errorBrackets.pop(),0==this.errorBrackets.length&&13==s.type&&(this.actions=Nr),f.consume();continue;case 53:0==this.errorBrackets.length&&(this.actions=Nr),f.consume();continue;case 200:return!0;default:if(n)return!!this.exprStackReduce(11,s)&&(this.result=g.pop(),!0);if(r){switch(s.type){case 16:case 11:if(this.actions===Rr)p.error("E_CSS_SYNTAX",s);else{let e=f.input.substring(m,s.position);p.pushSelectorText(e),m=s.position+1}if(16===s.type){p.nextSelector(),this.actions=Rr,f.consume();continue}return p.endFuncWithSelector(),f.consume(),!0;case 37:case 23:case 35:if(o){this.actions=Ir;continue}break;case 12:case 14:case 10:this.errorBrackets.push(s.type+1)}p.error("E_CSS_SYNTAX",s),f.consume(),this.actions=zr;continue}if(this.actions!==Br&&this.actions!==zr&&this.actions!==Mr){if(54==s.type)p.error("E_CSS_SYNTAX",s);else{if(this.actions===Lr){switch(s.type){case 10:case 12:case 14:this.errorBrackets.push(s.type+1)}g.push(new li(s.toString())),f.consume();continue}if(12===s.type&&this.actions==Fr&&g.length>0){p.startMediaRule(g.pop()),this.ruleStack.push("media"),p.startRuleBody(),this.actions=Nr,f.consume();continue}if(17===s.type&&this.actions==Fr)return this.actions=Nr,f.consume(),!1;p.error("E_CSS_SYNTAX",s)}this.isInsidePropertyOnlyRule()?this.actions=Mr:this.actions=zr;continue}f.consume();continue}return!1}},$r=class extends Cr{constructor(e){super(null),this.scope=e}error(e,t){R.warn(e,t.toString())}getScope(){return this.scope}};function jr(e,t,i,n,r){let o=Gn("parseStylesheet"),s=new Hr(Nr,e,t,i),a=null;return r&&(a=function(e,t,i){let n=new Hr(Fr,e,t,i);return n.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),n.result}(new Hn(r,t),t,i)),a=s.makeCondition(n,a&&a.toExpr()),a&&(t.startMediaRule(a),t.startRuleBody()),o.loop(()=>{for(;!s.runParser(100,!1,!1,!1,!1);){if(s.importReady){let e=re(s.importURL,i);s.importCondition&&(t.startMediaRule(s.importCondition),t.startRuleBody());let n=Gn("parseStylesheet.import");return Gr(e,t,null,null).then(()=>{s.importCondition&&t.endRule(),s.importReady=!1,s.importURL=null,s.importCondition=null,n.finish(!0)}),n.result()}let e=o.timeSlice();if(e.isPending)return e}return qn(!1)}).then(()=>{a&&t.endRule(),o.finish(!0)}),o.result()}function Wr(e,t,i,n,r){return Xn("parseStylesheetFromText",o=>{jr(new Hn(e,t),t,i,n,r).thenFinish(o)},(t,i)=>{R.warn(i,`Failed to parse stylesheet text: ${e}`),t.finish(!1)})}function Gr(e,t,i,n){return Xn("parseStylesheetFromURL",r=>{gr(e).then(o=>{o.responseText?Wr(o.responseText,t,e,i,n).then(t=>{t||R.warn(`Failed to parse stylesheet from ${e}`),r.finish(!0)}):r.finish(!0)})},(t,i)=>{R.warn(i,"Exception while fetching and parsing:",e),t.finish(!0)})}function qr(e,t,i){let n=new Hr(Lr,t,new $r(e),i);return n.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),n.result}var Xr={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function Yr(e,t,i){if(t instanceof Tt&&"viv-leader"===t.str)return new ai(t);let n=t.evaluate(e);switch(typeof n){case"number":return function(e){return!!Xr[e]}(i)?n==Math.round(n)?new Qt(n):new Jt(n):new Zt(n,"px");case"string":return n?qr(t.scope,new Hn(n,null),""):jt;case"boolean":return n?ci._true:ci._false;case"undefined":return jt}throw new Error("E_UNEXPECTED")}function Kr(e,t){let i={};return Object.keys(e).forEach(n=>{let r=i[n]={},o=e[n];Object.keys(o).forEach(e=>{r[e]=o[e].map(e=>{let i=t?e.logical:e.physical,n=t?e.physical:e.logical;return{regexp:new RegExp(`(-?)${i}(-?)`),to:`$1${n}$2`}})})}),i}function Zr(e,t,i,n){let r=n[t];if(!r)throw new Error(`unknown writing-mode: ${t}`);let o=r[i||"ltr"];if(!o)throw new Error(`unknown direction: ${i}`);for(let t of o){let i=e.replace(t.regexp,t.to);if(i!==e)return i}return e}var Jr={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},Qr=Kr(Jr,!0);function eo(e,t,i){return Zr(e,t,i||null,Qr)}var to=Kr(Jr,!1);function io(e,t,i){return Zr(e,t,i||null,to)}var no={"horizontal-tb":[{logical:"line-left",physical:"left"},{logical:"line-right",physical:"right"},{logical:"over",physical:"top"},{logical:"under",physical:"bottom"}],"vertical-rl":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}],"vertical-lr":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}]};function ro(e,t,i){var n;let r=t,o={width:r.style.width,height:r.style.height};function s(i){return e.getElementComputedStyle(t).getPropertyValue(i)}let a="horizontal-tb"!==s("writing-mode"),l=a?"height":"width",h=a?"width":"height";function u(e,t){r.style[e]=t;let i=s(e);return r.style[e]=o[e],i}let c={};for(let e of i){let i;switch(e){case"max-content inline size":i=u(l,"max-content");break;case"min-content inline size":i=u(l,"min-content");break;case"fit-content inline size":i=u(l,"fit-content");break;case"max-content block size":i=u(h,"max-content");break;case"min-content block size":i=u(h,"min-content");break;case"fit-content block size":i=u(h,"fit-content");break;case"max-content width":i=u("width","max-content");break;case"max-content height":i=u("height","max-content");break;case"min-content width":i=u("width","min-content");break;case"min-content height":i=u("height","min-content");break;case"fit-content width":i=u("width","fit-content");break;case"fit-content height":i=u("height","fit-content")}"0px"===i&&1===t.childNodes.length&&"img"===(null==(n=t.firstElementChild)?void 0:n.localName)&&!t.firstElementChild.complete&&(i="1px"),c[e]=parseFloat(i)}return c}function oo(e){var t,i;return"clone"===(null==(t=null==e?void 0:e.style)?void 0:t["box-decoration-break"])||"clone"===(null==(i=null==e?void 0:e.style)?void 0:i["-webkit-box-decoration-break"])}function so(e){let t=e.getAttribute("data-viv-box-break");return t?t.split(" "):[]}function ao(e,t){e.setAttribute("data-viv-box-break",t.join(" "))}function lo(e,t){let i=so(e);i.includes(t)||(i.push(t),ao(e,i))}function ho(e,t){let i=function(e){let t=e.getAttribute("data-viv-margin-discard");return t?t.split(" "):[]}(e);i.includes(t)||(i.push(t),function(e,t){e.setAttribute("data-viv-margin-discard",t.join(" "))}(e,i))}var uo={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function co(e){return!!uo[e]}var po={left:!0,right:!0,recto:!0,verso:!0};function fo(e){return!!po[e]}var go={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function mo(e){return!!go[e]}function bo(e,t){if(!e)return t;if(!t)return e;if(fo(t))return t;if(fo(e))return e;{let i=co(e),n=co(t);if(!i||!n)return n?t:i?e:mo(t)?t:mo(e)?e:t;switch(t){case"column":return e;case"region":return"column"===e?t:e;default:return t}}}function vo(e){return co(e)?e:"auto"}O("SIMPLE_PROPERTY",function(e){let t=e.name,i=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:i===ci.always?ci.page:i,important:e.important};default:return e}});var yo,wo,xo,So,Co,ko,Eo=((e,n,r)=>(r=null!=e?t(o(e)):{},l(!n&&e&&e.__esModule?r:i(r,"default",{value:e,enumerable:!0}),e)))(b());function Po(e){return e.reduce((e,t)=>t[0]===Eo.default.DELETE?e:e+t[1],"")}function No(e,t,i){let n=0,r=0;return e.some(e=>{for(let o=0;o<e[1].length;o++){switch(e[0]*i){case Eo.default.INSERT:n++;break;case Eo.default.DELETE:n--,r++;break;case Eo.default.EQUAL:r++}if(r>t)return!0}return!1}),Math.max(Math.min(t,r-1)+n,0)}(e=>{e.isInstanceOfBlockFormattingContext=function(e){return e&&"Block"===e.formattingContextType}})(yo||(yo={})),(e=>{var t;(t=e.FloatReference||(e.FloatReference={})).INLINE="inline",t.COLUMN="column",t.REGION="region",t.PAGE="page"})(wo||(wo={})),(e=>{e.isInstanceOfAfterIfContinuesLayoutConstraint=function(e){return e&&"AfterIfContinue"==e.flagmentLayoutConstraintType}})(xo||(xo={})),(e=>{e.isInstanceOfRepetitiveElementsOwnerFormattingContext=function(e){return!!e&&("RepetitiveElementsOwner"===e.formattingContextType||Co.isInstanceOfTableFormattingContext(e))},e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=function(e){return!!e&&("RepetitiveElementsOwner"===e.flagmentLayoutConstraintType||Co.isInstanceOfTableRowLayoutConstraint(e))}})(So||(So={})),(e=>{e.isInstanceOfTableFormattingContext=function(e){return e&&"Table"===e.formattingContextType},e.isInstanceOfTableRowLayoutConstraint=function(e){return e&&"TableRow"===e.flagmentLayoutConstraintType}})(Co||(Co={})),(e=>{var t,i;(t=e.Whitespace||(e.Whitespace={}))[t.IGNORE=0]="IGNORE",t[t.NEWLINE=1]="NEWLINE",t[t.PRESERVE=2]="PRESERVE",(i=e.ShadowType||(e.ShadowType={}))[i.NONE=0]="NONE",i[i.CONTENT=1]="CONTENT",i[i.ROOTLESS=2]="ROOTLESS",i[i.ROOTED=3]="ROOTED"})(ko||(ko={}));var To={transform:!0,"transform-origin":!0},Io={top:!0,bottom:!0,left:!0,right:!0},Ao=class{constructor(e,t,i){this.target=e,this.name=t,this.value=i}},_o={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function Ro(e,t){let i=_o[t];return i?()=>{for(let t=0;t<e.length;t++)try{i(e[t])}catch(e){}}:null}var Lo=class e extends Ne{constructor(e,t){super(),this.container=e,this.bleedBox=t,h(this,"pageAreaElement",null),h(this,"delayedItems",[]),h(this,"hrefHandler"),h(this,"elementsById",{}),h(this,"dimensions",{width:0,height:0}),h(this,"isFirstPage",!1),h(this,"isLastPage",!1),h(this,"isBlankPage",!1),h(this,"isAutoPageWidth",!0),h(this,"isAutoPageHeight",!0),h(this,"spineIndex",0),h(this,"position",null),h(this,"offset",-1),h(this,"side",null),h(this,"fetchers",[]),h(this,"marginBoxes",{top:{},bottom:{},left:{},right:{}}),h(this,"pageType",null),this.hrefHandler=e=>{let t=e.currentTarget,i=t.getAttribute("href")||t.getAttributeNS("http://www.w3.org/1999/xlink","href");if(i){let n={type:"hyperlink",target:null,currentTarget:null,anchorElement:t,href:i,preventDefault(){e.preventDefault()}};this.dispatchEvent(n)}}}setAutoPageWidth(t){this.isAutoPageWidth=t,t?this.container.setAttribute(e.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(e.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(t){this.isAutoPageHeight=t,t?this.container.setAttribute(e.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(e.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(e,t){let i=this.elementsById[t];i?i.push(e):this.elementsById[t]=[e]}finish(e,t){Object.keys(this.elementsById).forEach(e=>{let t=this.elementsById[e];for(let e=0;e<t.length;)this.container.contains(t[e])?e++:t.splice(e,1);0===t.length&&delete this.elementsById[e]});let i=this.delayedItems;for(let e=0;e<i.length;e++){let t=i[e];t.target===this.container&&"transform"===t.name&&!this.isAutoPageWidth&&!this.isAutoPageHeight||ce(t.target,t.name,t.value.toString())}let n=t.getElementClientRect(this.container);this.dimensions.width=n.width,this.dimensions.height=n.height;for(let t=0;t<e.length;t++){let i=e[t],n=this.elementsById[i.ref],r=this.elementsById[i.observer];if(n&&r){let e=Ro(n,i.action);if(e)for(let t=0;t<r.length;t++)r[t].addEventListener(i.event,e,!1)}}}};h(Lo,"AUTO_PAGE_WIDTH_ATTRIBUTE","data-vivliostyle-auto-page-width"),h(Lo,"AUTO_PAGE_HEIGHT_ATTRIBUTE","data-vivliostyle-auto-page-height");var Fo=Lo,Oo=ko.Whitespace;function Bo(e){switch(e){case"normal":case"nowrap":return Oo.IGNORE;case"pre-line":return Oo.NEWLINE;case"pre":case"pre-wrap":case"break-spaces":return Oo.PRESERVE;default:return null}}function Mo(e,t){if(!e)return!0;if(1==e.nodeType)return!1;let i=e.textContent;switch(t){case Oo.PRESERVE:return 0==i.length;case Oo.NEWLINE:return!!i.match(/^[ \t]*$/);case Oo.IGNORE:default:return!!i.match(/^[ \t\r\n\f]*$/)}}var zo=class{constructor(e,t){this.flowName=e,this.parentFlowName=t,h(this,"forcedBreakOffsets",[]),h(this,"formattingContext",null)}},Do=class{constructor(e,t,i,n,r,o,s,a,l){this.flowName=e,this.element=t,this.startOffset=i,this.priority=n,this.linger=r,this.exclusive=o,this.repeated=s,this.last=a,this.breakBefore=l,h(this,"startPage",-1)}isBetter(e){return!!this.exclusive&&(!e.exclusive||this.priority>e.priority||this.last)}};function Vo(e,t){return e.top-t.top}function Uo(e,t){return t.right-e.right}function Ho(e,t){var i,n;return e===t||!(!e||!t)&&((e.node===t.node||!!e.shadowContext&&!!t.shadowContext&&e.shadowType===ko.ShadowType.ROOTLESS&&t.shadowType===ko.ShadowType.ROOTLESS&&(null==(i=e.node)?void 0:i.outerHTML)===(null==(n=t.node)?void 0:n.outerHTML))&&e.shadowType===t.shadowType&&Xo(e.shadowContext,t.shadowContext)&&Xo(e.nodeShadow,t.nodeShadow)&&Ho(e.shadowSibling,t.shadowSibling))}function $o(e,t){if(e===t)return!0;if(!e||!t||e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let i=0;i<e.steps.length;i++)if(!Ho(e.steps[i],t.steps[i]))return!1;return!0}function jo(e,t){return{steps:[{node:e.sourceNode,shadowType:Go.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:null!=t?t:e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function Wo(e,t){let i=new Ko(e.node,t,0);return i.shadowType=e.shadowType,i.shadowContext=e.shadowContext,i.nodeShadow=e.nodeShadow,i.shadowSibling=e.shadowSibling?Wo(e.shadowSibling,t.copy()):null,i.formattingContext=e.formattingContext,i.fragmentIndex=e.fragmentIndex+1,i}var Go=ko.ShadowType,qo=class{constructor(e,t,i,n,r,o,s){this.owner=e,this.root=t,this.xmldoc=i,this.parentShadow=n,this.type=o,this.styler=s,h(this,"subShadow",null),r&&(r.subShadow=this)}equals(e){return!!e&&(this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&Xo(this.parentShadow,e.parentShadow))}};function Xo(e,t){return e===t||!!e&&!!t&&e.equals(t)}var Yo=class{constructor(e,t){this.outer=e,this.count=t}},Ko=class e{constructor(e,t,i){this.sourceNode=e,this.parent=t,this.boxOffset=i,h(this,"offsetInNode",0),h(this,"after",!1),h(this,"shadowType"),h(this,"shadowContext"),h(this,"nodeShadow",null),h(this,"shadowSibling",null),h(this,"shared",!1),h(this,"inline",!0),h(this,"overflow",!1),h(this,"breakPenalty"),h(this,"display",null),h(this,"floatReference"),h(this,"floatSide",null),h(this,"clearSide",null),h(this,"floatMinWrapBlock",null),h(this,"columnSpan",null),h(this,"verticalAlign","baseline"),h(this,"captionSide","top"),h(this,"inlineBorderSpacing",0),h(this,"blockBorderSpacing",0),h(this,"flexContainer",!1),h(this,"whitespace"),h(this,"hyphenateCharacter"),h(this,"breakWord"),h(this,"establishesBFC",!1),h(this,"containingBlockForAbsolute",!1),h(this,"breakBefore",null),h(this,"breakAfter",null),h(this,"viewNode",null),h(this,"clearSpacer",null),h(this,"inheritedProps"),h(this,"vertical"),h(this,"direction"),h(this,"firstPseudo"),h(this,"lang",null),h(this,"preprocessedTextContent",null),h(this,"formattingContext"),h(this,"repeatOnBreak",null),h(this,"pluginProps",{}),h(this,"fragmentIndex",1),h(this,"afterIfContinues",null),h(this,"footnotePolicy",null),h(this,"pageType"),this.shadowType=Go.NONE,this.shadowContext=t?t.shadowContext:null,this.breakPenalty=t?t.breakPenalty:0,this.floatReference=wo.FloatReference.INLINE,this.whitespace=t?t.whitespace:Oo.IGNORE,this.hyphenateCharacter=t?t.hyphenateCharacter:null,this.breakWord=!!t&&t.breakWord,this.inheritedProps=t?t.inheritedProps:{},this.vertical=!!t&&t.vertical,this.direction=t?t.direction:"ltr",this.firstPseudo=t?t.firstPseudo:null,this.formattingContext=t?t.formattingContext:null,this.pageType=t?t.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=wo.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:Oo.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=!!this.parent&&this.parent.breakWord,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=!!this.parent&&this.parent.vertical,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new e(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let e=this;do{if(e.shared)break;e.shared=!0,e=e.parent}while(e);return this}clone(){let e,t=this.cloneItem(),i=t;for(;null!=(e=i.parent);)e=e.cloneItem(),i.parent=e,i=e;return t}toNodePositionStep(){var e;return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:null===(null==(e=this.viewNode)?void 0:e.parentNode)?0:this.fragmentIndex}}toNodePosition(){var e,t,i;let n=this,r=[];n.shadowType===ko.ShadowType.ROOTLESS&&(n.floatReference!==wo.FloatReference.INLINE||"footnote"===n.floatSide)&&null!=(i=null==(t=null==(e=n.shadowContext)?void 0:e.styler)?void 0:t.style)&&i._pseudos&&(n=n.parent);do{(!n.firstPseudo||!n.parent||n.parent.firstPseudo===n.firstPseudo)&&r.push(n.toNodePositionStep()),n=n.parent}while(n);let o=this.preprocessedTextContent?function(e,t){return No(e,t,-1)}(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:r,offsetInNode:o,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let e=this.parent;for(;e;){if(e.establishesBFC)return!0;e=e.parent}return!1}getContainingBlockForAbsolute(){let e=this.parent;for(;e;){if(e.containingBlockForAbsolute)return e;e=e.parent}return null}belongsTo(e){return this.formattingContext===e&&!!this.parent&&this.parent.formattingContext===e}},Zo=class e{constructor(e){this.primary=e,h(this,"floats",null)}clone(){let t=new e(this.primary);if(this.floats){t.floats=[];for(let e=0;e<this.floats.length;++e)t.floats[e]=this.floats[e]}return t}isSamePosition(e){if(!e)return!1;if(this===e)return!0;if(!$o(this.primary,e.primary))return!1;if(this.floats){if(!e.floats||this.floats.length!==e.floats.length)return!1;for(let t=0;t<this.floats.length;t++)if(!$o(this.floats[t],e.floats[t]))return!1}else if(e.floats)return!1;return!0}},Jo=class e{constructor(e,t){this.chunkPosition=e,this.flowChunk=t}clone(){return new e(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(e){return!!e&&(this===e||this.chunkPosition.isSamePosition(e.chunkPosition))}},Qo=class e{constructor(){h(this,"positions",[]),h(this,"startBreakType",null),h(this,"breakAfter",null)}clone(){let t=new e,i=this.positions,n=t.positions;for(let e=0;e<i.length;e++)n[e]=i[e].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(e){if(this===e)return!0;if(!e||this.positions.length!==e.positions.length)return!1;for(let t=0;t<this.positions.length;t++)if(!this.positions[t].isSamePosition(e.positions[t]))return!1;return!0}hasContent(e){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=e}},es=class e{constructor(){h(this,"page",0),h(this,"flows",{}),h(this,"flowPositions",{}),h(this,"isBlankPage",!1),h(this,"highestSeenOffset",0),h(this,"highestSeenNode"),h(this,"lookupPositionOffset")}clone(){let t=new e;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let e in this.flowPositions)t.flowPositions[e]=this.flowPositions[e].clone();return t}isSamePosition(e){if(this===e)return!0;if(!e||this.page!==e.page)return!1;let t=Object.keys(this.flowPositions),i=Object.keys(e.flowPositions);if(t.length!==i.length)return!1;for(let i of t)if(!this.flowPositions[i].isSamePosition(e.flowPositions[i]))return!1;return!0}hasContent(e,t){let i=this.flowPositions[e];return!!i&&i.hasContent(t)}startSideOfFlow(e){var t;let i=null==(t=this.flowPositions[e])?void 0:t.startBreakType;return i&&fo(i)?i:"any"}firstFlowChunkOfFlow(e){let t=this.flowPositions[e];if(!t)return null;let i=t.positions[0];return i?i.flowChunk:null}},ts=class{constructor(e){this.element=e,h(this,"left",0),h(this,"top",0),h(this,"marginLeft",0),h(this,"marginRight",0),h(this,"marginTop",0),h(this,"marginBottom",0),h(this,"borderLeft",0),h(this,"borderRight",0),h(this,"borderTop",0),h(this,"borderBottom",0),h(this,"paddingLeft",0),h(this,"paddingRight",0),h(this,"paddingTop",0),h(this,"paddingBottom",0),h(this,"width",0),h(this,"height",0),h(this,"originX",0),h(this,"originY",0),h(this,"exclusions",null),h(this,"innerShape",null),h(this,"computedBlockSize",0),h(this,"snapWidth",0),h(this,"snapHeight",0),h(this,"snapOffsetX",0),h(this,"snapOffsetY",0),h(this,"vertical",!1),h(this,"rtl",!1),h(this,"borderBoxSizing",!1)}getInsetTop(){return this.marginTop+(this.borderBoxSizing?0:this.borderTop+this.paddingTop)}getInsetBottom(){return this.marginBottom+(this.borderBoxSizing?0:this.borderBottom+this.paddingBottom)}getInsetLeft(){return this.marginLeft+(this.borderBoxSizing?0:this.borderLeft+this.paddingLeft)}getInsetRight(){return this.marginRight+(this.borderBoxSizing?0:this.borderRight+this.paddingRight)}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?this.rtl?e.bottom:e.top:this.rtl?e.right:e.left}getEndEdge(e){return this.vertical?this.rtl?e.top:e.bottom:this.rtl?e.left:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical,this.rtl=e.rtl,this.borderBoxSizing=e.borderBoxSizing}setVerticalPosition(e,t){this.top=e,this.height=t,ce(this.element,"top",`${e}px`),ce(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,ce(this.element,"left",`${e}px`),ce(this.element,"width",`${t}px`)}setBlockPosition(e,t){if(this.vertical){let i=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+i*this.getBoxDir(),t)}else this.setVerticalPosition(e,t)}setInlinePosition(e,t){if(this.vertical)if(this.rtl){let i=t+this.marginTop+this.marginBottom+(this.borderBoxSizing?0:this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom);this.setVerticalPosition(e+i*this.getInlineDir(),t)}else this.setVerticalPosition(e,t);else if(this.rtl){let i=t+this.marginLeft+this.marginRight+(this.borderBoxSizing?0:this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight);this.setHorizontalPosition(e+i*this.getInlineDir(),t)}else this.setHorizontalPosition(e,t)}clear(){let e,t=this.element;for(;e=t.lastChild;)t.removeChild(e)}getInnerShape(){let e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):Ti(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){let e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new wi(e,t,e+this.width,t+this.height)}getPaddingRect(){let e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,i=this.paddingLeft+this.width+this.paddingRight,n=this.paddingTop+this.height+this.paddingBottom;return new wi(e,t,e+i,t+n)}getOuterShape(e,t){let i=this.getOuterRect();return Gi(e,i.x1,i.y1,i.x2-i.x1,i.y2-i.y1,t)}getOuterRect(){let e=this.originX+this.left,t=this.originY+this.top,i=this.getInsetLeft()+this.width+this.getInsetRight(),n=this.getInsetTop()+this.height+this.getInsetBottom();return new wi(e,t,e+i,t+n)}},is=class extends Vt{constructor(e,t,i,n){super(),this.elem=e,this.context=t,this.rootContentValue=i,this.exprContentListener=n}visitStrInner(e,t){var i;if(!t){if(3===(null==(i=this.elem.lastChild)?void 0:i.nodeType))return void(this.elem.lastChild.textContent+=e);t=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue instanceof ti)this.elem.setAttribute("src",e.url);else{let t=this.elem.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let t=e.toExpr(),i=t.evaluate(this.context);if("string"==typeof i){t instanceof Pt&&(i=qr(t.scope,new Hn(i,null),"").stringValue()),this.elem.ownerDocument;let e=this.exprContentListener(t,i,this.elem.ownerDocument);!e&&i&&t instanceof Tt&&t.str.startsWith("running-element-")&&(i=""),this.visitStrInner(i,e)}return null}};function ns(e){return null!=e&&e!==jt&&e!==ci.normal&&e!==ci.none&&!bi(e)}var rs=wo.FloatReference;function os(e){switch(e){case rs.INLINE:return!1;case rs.COLUMN:case rs.REGION:case rs.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}function ss(e,t,i,n){let r=t?"vertical-rl":"horizontal-tb";if(("top"===e||"bottom"===e)&&(e=io(e,r,i)),"block-start"===e&&(e="inline-start"),"block-end"===e&&(e="inline-end"),"inline-start"===e||"inline-end"===e){let t=function(e,t){let i=no[t];if(!i)throw new Error(`unknown writing-mode: ${t}`);for(let t=0;t<i.length;t++)if(i[t].physical===e)return i[t].logical;return e}(eo(e,r,i),r);"line-left"===t?e="left":"line-right"===t&&(e="right")}else"inside"===e?e="left"===n?"right":"left":"outside"===e&&(e="left"===n?"left":"right");return"left"!==e&&"right"!==e&&(R.warn(`Invalid float value: ${e}. Fallback to left.`),e="left"),e}var as=class{constructor(e,t,i,n,r,o){this.nodePosition=e,this.floatReference=t,this.floatSide=i,this.clearSide=n,this.flowName=r,this.floatMinWrapBlock=o,h(this,"order",null),h(this,"id",null)}getOrder(){if(null===this.order)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}},ls=class{constructor(){h(this,"floats",[]),h(this,"nextPageFloatIndex",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex(t=>$o(t.nodePosition,e.nodePosition))>=0)throw new Error("A page float with the same source node is already registered");{let t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){let t=this.floats.findIndex(t=>$o(t.nodePosition,e));return t>=0?this.floats[t]:null}findPageFloatById(e){let t=this.floats.findIndex(t=>t.id===e);return t>=0?this.floats[t]:null}},hs=class{constructor(e,t,i,n,r,o){this.floatReference=e,this.floatSide=t,this.clearSide=i,this.continuations=n,this.area=r,this.continues=o}hasFloat(e){return this.continuations.some(t=>t.float===e)}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){let i=this.continuations[t].float;if(!i.isAllowedOnContext(e))return i}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let e=this.continuations.map(e=>e.float);return Math.min.apply(null,e.map(e=>e.getOrder()))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach(e=>{this.continuations.push(e)})}getFlowName(){let e=this.continuations[0].float.flowName;return this.continuations.every(t=>t.float.flowName===e),e}},us=class{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return!!e&&(this===e||this.float===e.float&&$o(this.nodePosition,e.nodePosition))}},cs=class{constructor(e,t,i,n,r,o,s){this.parent=e,this.floatReference=t,this.container=i,this.flowName=n,this.generatingNodePosition=r,h(this,"children",[]),h(this,"writingMode"),h(this,"direction"),h(this,"invalidated",!1),h(this,"floatStore"),h(this,"forbiddenFloats",[]),h(this,"floatFragments",[]),h(this,"stashedFloatFragments",[]),h(this,"floatAnchors",{}),h(this,"floatsDeferredToNext",[]),h(this,"floatsDeferredFromPrevious"),h(this,"layoutConstraints",[]),h(this,"locked",!1),e&&e.children.push(this),this.writingMode=o||e&&e.writingMode||ci.horizontal_tb,this.direction=s||e&&e.direction||ci.ltr,this.floatStore=e?e.floatStore:new ls;let a=this.getPreviousSibling();this.floatsDeferredFromPrevious=a?[].concat(a.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,i,n){let r=this.children.indexOf(e);r<0&&(r=this.children.length);for(let e=r-1;e>=0;e--){let r=this.children[e];if(r.floatReference===t&&r.flowName===i&&$o(r.generatingNodePosition,n))return r;if(r=r.getPreviousSiblingOf(null,t,i,n),r)return r}return null}getPreviousSibling(){let e,t=this,i=this.parent;for(;i;){if(e=i.getPreviousSiblingOf(t,this.floatReference,this.flowName,this.generatingNodePosition),e)return e;t=i,i=i.parent}return null}getContainer(e){return e&&e!==this.floatReference?this.getParent(e).getContainer(e):this.container}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){let t=e.getId(),i=e.floatReference;i===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),(new ps).findByFloat(e).forbid(e,this)):this.getParent(i).forbid(e)}isForbidden(e){let t=e.getId(),i=e.floatReference;return i===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(i).isForbidden(e)}addPageFloatFragment(e,t){let i=e.floatReference;i!==this.floatReference?this.getParent(i).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort((e,t)=>e.getOrder()-t.getOrder())),t||this.invalidate()}removePageFloatFragment(e,t){let i=e.floatReference;if(i!==this.floatReference)this.getParent(i).removePageFloatFragment(e,t);else{let i=this.floatFragments.indexOf(e);if(i>=0){let e=this.floatFragments.splice(i,1)[0],n=e.area&&e.area.element;n&&n.parentNode&&n.parentNode.removeChild(n),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);let t=this.floatFragments.findIndex(t=>t.hasFloat(e));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return!(!(this.floatFragments.length>0)||e&&!this.floatFragments.some(e))||!!this.parent&&this.parent.hasFloatFragments(e)}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments(t=>t.continues&&t.getFlowName()===e)}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){let e=Object.assign({},this.floatAnchors);return this.children.reduce((e,t)=>Object.assign(e,t.collectPageFloatAnchors()),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some(t=>t.float.getId()===e))return!0;let t=this.collectPageFloatAnchors()[e];return!!(t&&this.container&&this.container.element)&&this.container.element.contains(t)}deferPageFloat(e){let t=e.float;if(t.floatReference===this.floatReference){let i=this.floatsDeferredToNext.findIndex(e=>e.float===t);i>=0?this.floatsDeferredToNext.splice(i,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);let i=e.getOrder();return!!this.floatsDeferredToNext.some(t=>t.float.getOrder()<i&&!e.isAllowedToPrecede(t.float))||!!this.parent&&this.parent.hasPrecedingFloatsDeferredToNext(e,!0)}getLastFollowingFloatInFragments(e){let t=e.getOrder(),i=null;if(this.floatFragments.forEach(e=>{e.continuations.forEach(e=>{let n=e.float,r=n.getOrder();r>t&&(!i||r>i.getOrder())&&(i=n)})}),this.parent){let t=this.parent.getLastFollowingFloatInFragments(e);t&&(!i||t.getOrder()>i.getOrder())&&(i=t)}return i}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter(t=>!e||t.float.flowName===e);return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort((e,t)=>e.float.getOrder()-t.float.getOrder())}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;let t=this.floatsDeferredToNext.filter(t=>!e||t.float.flowName===e);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[],t=[];for(let i=this.children.length-1;i>=0;i--){let n=this.children[i];t.includes(n.flowName)||(t.push(n.flowName),e=e.concat(n.floatsDeferredToNext.map(e=>e.float)),e=e.concat(n.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){let t=this.floatFragments[e],i=t.findNotAllowedFloat(this);if(i)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(i),this.removeEndFloatFragments(t.floatSide)),!0}return!(this.floatReference!==rs.REGION||!this.parent.locked)&&this.parent.checkAndForbidNotAllowedFloat()}checkAndForbidFloatFollowingDeferredFloat(){let e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce((e,t)=>e.concat(t.continuations.map(e=>e.float)),[]);t.sort((e,t)=>t.getOrder()-e.getOrder());for(let i of t){let t=i.getOrder();if(e.some(e=>!i.isAllowedToPrecede(e)&&t>e.getOrder())){if(this.locked)this.invalidate();else{this.forbid(i);let e=this.findPageFloatFragment(i);this.removePageFloatFragment(e)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked)return void this.invalidate();this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach(e=>{this.floatsDeferredToNext.findIndex(t=>e.equals(t))>=0||this.floatFragments.some(t=>t.hasFloat(e.float))||this.floatsDeferredToNext.push(e)})}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach(e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach(e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)})}),this.container.clear()),this.children.forEach(e=>{e.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(e=>{delete this.floatAnchors[e]}))}detachChildren(){let e=this.children.splice(0);return e.forEach(e=>{e.floatFragments.forEach(e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)})}),e}attachChildren(e){e.forEach(e=>{this.children.push(e),e.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){let t=this.writingMode.toString(),i=this.direction.toString();if("inside"===e||"outside"===e){let t=!!this.container.element.closest("[data-vivliostyle-page-side='left']");e="inside"===e?t?"right":"left":t?"left":"right"}return io(e,t,i)}toPhysical(e){return eo(e,this.writingMode.toString(),this.direction.toString())}toLogicalFloatSides(e){let t=e.split(" "),i=[];for(let e of t){let t=this.toLogical(e);i.includes(t)||i.push(t)}let n=[],r=!1,o=!1;for(let e=0;e<i.length;e++){let t=i[e];t.includes("block")?r||(i.slice(e+1).some(e=>e.includes("block"))?(n.push("snap-block"),r=!0):n.push(t)):t.includes("inline")&&(o||(i.slice(e+1).some(e=>e.includes("inline"))?(n.push("snap-inline"),o=!0):n.push(t)))}return n}removeEndFloatFragments(e){let t=this.toLogicalFloatSides(e)[0];if("block-end"===t||"inline-end"===t){let e=0;for(;e<this.floatFragments.length;){let i=this.floatFragments[e];this.toLogicalFloatSides(i.floatSide)[0]===t?this.removePageFloatFragment(i):e++}}}stashEndFloatFragments(e){let t=e.floatReference;if(t!==this.floatReference)return void this.getParent(t).stashEndFloatFragments(e);let i=this.toLogicalFloatSides(e.floatSide)[0];if("block-end"===i||"snap-block"===i||"inline-end"===i||"snap-inline"===i){let t=0;for(;t<this.floatFragments.length;){let n=this.floatFragments[t],r=this.toLogicalFloatSides(n.floatSide)[0];(r===i||"snap-block"===i&&"block-end"===r||"snap-inline"===i&&"inline-end"===r)&&n.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(n),this.floatFragments.splice(t,1)):t++}}}restoreStashedFragments(e){e===this.floatReference?(this.stashedFloatFragments.forEach(e=>{this.addPageFloatFragment(e,!0)}),this.stashedFloatFragments.splice(0)):this.getParent(e).restoreStashedFragments(e)}discardStashedFragments(e){e===this.floatReference?this.stashedFloatFragments.splice(0):this.getParent(e).discardStashedFragments(e)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort((e,t)=>t.getOrder()-e.getOrder()):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,i,n,r){this.container;let o=this.toLogical(e),s=this.toPhysical(e),a=t&&this.toLogical(t),l=t&&this.toPhysical(t),h=this.getLimitValueInner(o,a,i,n,r);if(this.parent&&this.parent.container){let e=this.parent.getLimitValue(s,l,i,n,r);switch(s){case"top":case"left":return Math.max(h,e);case"bottom":case"right":return Math.min(h,e)}}return h}getLimitValueInner(e,t,i,n,r){this.container;let o=this.getLimitValuesInner(i,n,r,e,t);switch(e){case"block-start":return this.container.vertical?o.right:o.top;case"block-end":return this.container.vertical?o.left:o.bottom;case"inline-start":return this.container.vertical?this.container.rtl?o.bottom:o.top:this.container.rtl?o.right:o.left;case"inline-end":return this.container.vertical?this.container.rtl?o.top:o.bottom:this.container.rtl?o.left:o.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,i,n,r){this.container;let o=this.container.originX,s=this.container.originY,a=this.container.getPaddingRect(),l={top:a.y1-s,left:a.x1-o,bottom:a.y2-s,right:a.x2-o,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function h(i,n,r){return"%"===i.unit?r*i.num/100:e.convertLengthToPx(i,n,t)}let u=this.floatFragments;return u.length>0&&(l=u.reduce((e,t)=>{if(i&&!i(t,this))return e;let[o,s]=this.toLogicalFloatSides(t.floatSide);if(s&&(n&&s.includes("block")===n.includes("block")&&s!==n||r&&s.includes("block")===r.includes("block")&&s!==r))return e;let l=t.area,u=t.continuations[0].float.floatMinWrapBlock,c=e.top,d=e.left,p=e.bottom,f=e.right,g=e.floatMinWrapBlockStart,m=e.floatMinWrapBlockEnd;switch(o){case"inline-start":l.vertical?c=Math.max(c,l.top+l.height):d=Math.max(d,l.left+l.width);break;case"block-start":l.vertical?(u&&l.left<f&&(g=h(u,l.rootViewNodes[0],a.x2-a.x1)),f=Math.min(f,l.left)):(u&&l.top+l.height>c&&(g=h(u,l.rootViewNodes[0],a.y2-a.y1)),c=Math.max(c,l.top+l.height));break;case"inline-end":l.vertical?p=Math.min(p,l.top):f=Math.min(f,l.left);break;case"block-end":l.vertical?(u&&l.left+l.width>d&&(m=h(u,l.rootViewNodes[0],a.x2-a.x1)),d=Math.max(d,l.left+l.width)):(u&&l.top<p&&(m=h(u,l.rootViewNodes[0],a.y2-a.y1)),p=Math.min(p,l.top));break;default:throw new Error(`Unknown logical float side: ${o}`)}return{top:c,left:d,bottom:p,right:f,floatMinWrapBlockStart:g,floatMinWrapBlockEnd:m}},l)),l.left+=o,l.right+=o,l.top+=s,l.bottom+=s,l}setFloatAreaDimensions(e,t,i,n,r,o,s){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,i,n,r,o,s);let a=this.toLogicalFloatSides(i);if("snap-block"===a[0]){if(!s["block-start"]&&!s["block-end"])return null}else if(a[0].includes("block")&&!s[a[0]])return null;e.clientLayout;let l,h,u,c,d=a.find(e=>e.includes("inline")&&s["inline-start"===e?"inline-end":"inline-start"]),p=a.find(e=>e.includes("block")),f=this.getLimitValue("block-start",d,e.layoutContext,e.clientLayout),g=this.getLimitValue("block-end",d,e.layoutContext,e.clientLayout),m=this.getLimitValue("inline-start",p,e.layoutContext,e.clientLayout),b=this.getLimitValue("inline-end",p,e.layoutContext,e.clientLayout),v=e.vertical?e.originX:e.originY,y=e.vertical?e.originY:e.originX;function w(t,i){let n=t(e.bands,i);return n?(e.vertical&&(n=Bi(n)),f=e.vertical?Math.min(f,n.x2):Math.max(f,n.y1),g=e.vertical?Math.max(g,n.x1):Math.min(g,n.y2),!0):o}if(f=e.vertical?Math.min(f,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+v):Math.max(f,e.top+v),g=e.vertical?Math.max(g,e.left+v):Math.min(g,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+v),r){let t=e.vertical?Oi(new wi(g,m,f,b)):new wi(m,f,b,g);if(("block-start"===a[0]||"snap-block"===a[0]||"inline-start"===a[0]||"snap-inline"===a[0])&&!w(Vi,t)||("block-end"===a[0]||"snap-block"===a[0]||"inline-end"===a[0]||"snap-inline"===a[0])&&!w(Ui,t)||(u=(g-f)*e.getBoxDir(),l=u-e.getInsetBefore()-e.getInsetAfter(),c=(b-m)*e.getInlineDir(),h=c-e.getInsetStart()-e.getInsetEnd(),!o&&(l<=0||h<=0)))return null}else{l=e.computedBlockSize,u=l+e.getInsetBefore()+e.getInsetAfter();let t=(g-f)*e.getBoxDir();if("snap-block"===a[0]){if(null===n)a[0]="block-start";else{let e=this.container.getPaddingRect(),t=this.container.getBoxDir()*(n-(this.container.vertical?e.x2:e.y1)),i=this.container.getBoxDir()*((this.container.vertical?e.x1:e.y2)-n-u);a[0]=t<=i?"block-start":"block-end"}if(!s[a[0]]){if(!s["block-end"])return null;a[0]="block-end"}}else if("snap-inline"===a[0])if(null===n)a[0]="inline-start";else if(s["inline-start"])a[0]="inline-start";else{if(!s["inline-end"])return null;a[0]="inline-end"}if(!o&&t<u)return null;h="inline-start"===a[0]||"inline-end"===a[0]||a[1]?ro(e.clientLayout,e.element,["fit-content inline size"])["fit-content inline size"]:e.adjustContentRelativeSize?e.getContentInlineSize():e.vertical?e.height:e.width,c=h+e.getInsetStart()+e.getInsetEnd();let i=(b-m)*e.getInlineDir();if(!o&&i<c)return null}return f-=v,g-=v,m-=y,b-=y,a.some(e=>"inline-start"===e||"snap-inline"===e)||1===a.length&&("block-start"===a[0]||"snap-block"===a[0])?e.setInlinePosition(m,h):(a.some(e=>"inline-end"===e)||1===a.length&&"block-end"===a[0])&&e.setInlinePosition(b-c*e.getInlineDir(),h),a.some(e=>"block-start"===e||"snap-block"===e)||1===a.length&&("inline-start"===a[0]||"snap-inline"===a[0])?e.setBlockPosition(f,l):(a.some(e=>"block-end"===e)||1===a.length&&"inline-end"===a[0])&&e.setBlockPosition(g-u*e.getBoxDir(),l),a.join(" ")}getFloatFragmentExclusions(){let e=this.floatFragments.map(e=>e.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){let e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach(t=>{e.appendChild(t.area.element)})}getMaxReachedAfterEdge(){let e=this.getContainer().vertical;return this.floatFragments.reduce((t,i)=>{let n=i.getOuterRect();return e?Math.min(t,n.x1):Math.max(t,n.y2)},e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let e=this.getContainer().vertical;return this.floatFragments.filter(e=>"block-end"===e.floatSide).reduce((t,i)=>{let n=i.getOuterRect();return e?Math.max(t,n.x2):Math.min(t,n.y1)},e?0:1/0)}getPageFloatClearEdge(e,t){function i(e){return t=>e.isAnchorAlreadyAppeared(t.float.getId())}function n(t,n){return("inline-start"!==e||!t.floatSide.includes("inline-end")&&"block-end"!==t.floatSide)&&("inline-end"!==e||!t.floatSide.includes("inline-start")&&"block-start"!==t.floatSide)&&t.continuations.some(i(n))}let r=t.getPaddingRect(),o=t.vertical?r.x1:r.y2,s=this;for(;s;){if(s.floatsDeferredToNext.some(i(s)))return o;s=s.parent}function a(e){return e.floatFragments.some(t=>n(t,e))||e.children.some(e=>a(e))}if("column"===e||"region"===e||"page"===e)for(s=this;s;s=s.parent)if(s.floatReference===e){if(a(s))return o;break}t.clientLayout;let l=this.getLimitValue("block-start",null,t.layoutContext,t.clientLayout,n);return this.getLimitValue("block-end",null,t.layoutContext,t.clientLayout,n)*t.getBoxDir()<o*t.getBoxDir()?o:l}getPageFloatPlacementCondition(e,t,i){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,i);let n={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!i)return n;let r,o=this.toLogicalFloatSides(t)[0],s=this.toLogical(i);r="all"===s?["block-start","block-end","inline-start","inline-end"]:"both"===s?["inline-start","inline-end"]:"same"===s?"snap-block"===o?["block-start","block-end"]:[o]:[s];let a=e.getOrder();function l(e){return t=>(!e||t.floatSide.includes(e))&&t.getOrder()<a}function h(e,t){return e.children.some(e=>e.floatFragments.some(l(t))||h(e,t))}function u(e,t){let i=e.parent;return!!i&&(i.floatFragments.some(l(t))||u(i,t))}if("column"===i||"region"===i||"page"===i){for(let e=this;e;e=e.parent)if(e.floatReference===i){(e.floatFragments.some(l(null))||h(e,null))&&(n["block-start"]=!1,n["block-end"]=!1,n["inline-start"]=!1,n["inline-end"]=!1);break}return n}return r.forEach(e=>{switch(e){case"block-start":n[e]=!h(this,e);break;case"block-end":n[e]=!u(this,e);break;case"inline-start":case"inline-end":n[e]=!this.floatFragments.some(l(e));break;default:throw new Error(`Unexpected side: ${e}`)}}),n}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){let t=e.layoutContext,i=e.clientLayout,n=this,r=null;for(;n&&n.container;){let o=n.getLimitValuesInner(t,i);r?e.vertical?(o.right<r.right&&(r.right=o.right,r.floatMinWrapBlockStart=o.floatMinWrapBlockStart),o.left>r.left&&(r.left=o.left,r.floatMinWrapBlockEnd=o.floatMinWrapBlockEnd)):(o.top>r.top&&(r.top=o.top,r.floatMinWrapBlockStart=o.floatMinWrapBlockStart),o.bottom<r.bottom&&(r.bottom=o.bottom,r.floatMinWrapBlockEnd=o.floatMinWrapBlockEnd)):r=o,n=n.parent}let o=Math.max(r.floatMinWrapBlockStart,r.floatMinWrapBlockEnd);return(e.vertical?r.right-r.left:r.bottom-r.top)<=o}getMaxBlockSizeOfPageFloats(){let e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(t=>{let i=t.area;return e?i.width:i.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},ds=[],ps=class{static register(e){ds.push(e)}findByNodeContext(e){for(let t=ds.length-1;t>=0;t--){let i=ds[t];if(i.appliesToNodeContext(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=ds.length-1;t>=0;t--){let i=ds[t];if(i.appliesToFloat(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}};ps.register(new class{appliesToNodeContext(e){return os(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,i){let n=e.floatReference;e.floatSide;let r=e.floatSide,o=e.toNodePosition();return i.resolveFloatReferenceFromColumnSpan(n,e.columnSpan,e).thenAsync(i=>{n=i,t.flowName;let s=new as(o,n,r,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(s),qn(s)})}createPageFloatFragment(e,t,i,n,r){let o=e[0].float;return new hs(o.floatReference,t,i,e,n,r)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,i){}forbid(e,t){}});var fs=hs,gs=class e extends as{constructor(e,t,i,n,r){super(e,t,"block-end",null,i,r),this.footnotePolicy=n}isAllowedToPrecede(t){return!(t instanceof e)}},ms=class extends fs{constructor(e,t,i,n){super(e,"block-end",null,t,i,n)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof gs||this.getOrder()<e.getOrder()}},bs=class{constructor(e){this.footnote=e}allowLayout(e){return!$o(e.toNodePosition(),this.footnote.nodePosition)}};function vs(e){let t,i=(null==e?void 0:e.toString())||"block";switch(i){case"inline-flex":t="flex";break;case"inline-grid":t="grid";break;case"inline-table":t="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":t="block";break;default:t=i}return Kt(t)}function ys(e){return e===ci.absolute||e===ci.fixed}function ws(e){return e instanceof si&&"running"===e.name}function xs(e,t,i,n){return e===ci.none||(ys(t)?(i=ci.none,e=vs(e)):(i&&i!==ci.none&&!bi(i)||n)&&(e=vs(e))),{display:e,position:t,float:i}}function Ss(e,t,i,n){return xs(e,t,i,n).display===ci.block}function Cs(e){return e instanceof Yt||e instanceof ri||"string"==typeof e}function ks(e){if(!Cs(e))return!1;let t=e.toString();switch(t){case"inline":case"inline-block":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return t.includes("inline")}}function Es(e){return!!Cs(e)&&e.toString().includes("list-item")}function Ps(e){if(!Cs(e))return!1;switch(e.toString()){case"block":case"flex":case"grid":case"table":case"list-item":case"flow-root":return!0;default:return!1}}function Ns(e){if(!Cs(e))return!1;switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}ps.register(new class{appliesToNodeContext(e){return"footnote"===e.floatSide}appliesToFloat(e){return e instanceof gs}createPageFloat(e,t,i){let n=rs.REGION,r=t.getPageFloatLayoutContext(n);t.getPageFloatLayoutContext(rs.PAGE).hasSameContainerAs(r)&&(n=rs.PAGE);let o=e.toNodePosition();t.flowName;let s=new gs(o,n,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(s),qn(s)}createPageFloatFragment(e,t,i,n,r){let o=e[0].float;return new ms(o.floatReference,e,n,r)}findPageFloatFragment(e,t){let i=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter(e=>e instanceof ms);return i.length,i[0]||null}adjustPageFloatArea(e,t,i){e.isFootnote=!0,e.adjustContentRelativeSize=!1;let n=e.element;e.vertical=i.layoutContext.applyFootnoteStyle(t.vertical,i.layoutContext.nodeContext&&"rtl"===i.layoutContext.nodeContext.direction,n),e.convertPercentageSizesToPx(n),i.setComputedInsets(n,e),i.setComputedWidthAndHeight(n,e)}forbid(e,t){let i=e;switch(i.footnotePolicy){case ci.line:{let e=new bs(i);t.addLayoutConstraint(e,i.floatReference);break}}}});var Ts=1e5;function Is(e){let t=e.element.style;t.columnGap=Ts-(e.vertical?e.height:e.width)+"px",t.columnFill="auto",t.columnCount="1",t.columnWidth="0"}function As(e){let t=e.element.style;t.columnWidth="",t.columnCount="",t.columnGap="",t.columnFill=""}function _s(e){return"1"===e.element.style.columnCount}function Rs(e,t){let i=t?e.bottom:Math.max(Math.abs(e.left),Math.abs(e.right));return Math.round(i/Ts)}function Ls(e,t){let i=Rs(e,t);if(0===i)return 0;let n=t?e.top:Math.min(Math.abs(e.left),Math.abs(e.right)),r=Math.round(n/Ts),o=r*Ts,s=i*Ts;return t?(e.top-=o,e.bottom-=s,e.bottom<e.top&&(e.bottom+=Ts),e.right-=o,e.left-=s):e.left<-Ts/2?(e.right+=o,e.left+=s,e.left>e.right&&(e.left-=Ts),e.top+=o,e.bottom+=s):(e.left-=o,e.right-=s,e.right<e.left&&(e.right+=Ts),e.top+=o,e.bottom+=s),e.width=e.right-e.left,e.height=e.bottom-e.top,r}function Fs(e,t){for(let i=0;i<e.length;i++)Ls(e[i],t)}function Os(e,t,i){var n;let r=e.getElementClientRect(t),o=Ls(r,i);if(1===o){let s=e.getElementComputedStyle(t);if("table-cell"===s.display||"-vivliostyle-table-cell-container"===t.className&&null!=(n=t.parentElement)&&n.parentElement&&"table-cell"===(s=e.getElementComputedStyle(t.parentElement.parentElement)).display){let n=t.closest("[data-vivliostyle-column]"),a=null==n?void 0:n.style,l=i?"width":"height",h=a&&parseFloat(a[l]);if(h){let u=h,c=o,d=parseFloat(s.paddingBlockEnd),p=parseFloat(s.borderBlockEndWidth),f=Math.ceil(d+p);for(;f-- >0&&c===o&&--u>0;){a[l]=`${u}px`;let s=e.getElementClientRect(t);if(c=Ls(s,i),c<o||c===o&&(i?s.right>r.right:s.top<r.top))return n.setAttribute("data-vivliostyle-column-height-adjusted","true"),s}a[l]=`${h}px`}}}return r}function Bs(e,t){var i,n;if(1===e.nodeType){let t=e;"column"===(null==(i=t.style)?void 0:i.breakAfter)&&(t.style.breakAfter="")}if(1===t.nodeType){let e=t;"column"===(null==(n=e.style)?void 0:n.breakBefore)&&(e.style.breakBefore="")}}function Ms(e){for(let t=1===e.nodeType?e:e.parentElement;t;t=t.parentElement){let e=t.style;if(!e||t.hasAttribute("data-vivliostyle-column"))break;if(!isNaN(parseFloat(e.columnCount))||!isNaN(parseFloat(e.columnWidth)))return t;if("absolute"===e.position)break}return null}function zs(e,t,i,n){let r=e.viewNode;if(!r)return NaN;let o=1===r.nodeType?r:r.parentElement;if(o&&"http://www.w3.org/1999/xhtml"===o.namespaceURI){let e=o.style;if("br"===o.localName||"wbr"===o.localName||e&&ks(e.display)&&/^([\d\.]|super|(text-)?top)/.test(e.verticalAlign))return NaN}if(r===o){if(e.after||!e.inline){if(e.after&&!e.inline&&o.querySelector("ruby")){let e=o.parentNode,t=o.nextSibling;e.removeChild(o),e.insertBefore(o,t)}let i=Os(t,o,n);if(0===i.left&&0===i.top&&0===i.right&&0===i.bottom)return NaN;if(i.right>=i.left&&i.bottom>=i.top)return e.after?n?i.left:i.bottom:n?i.right:i.top}return NaN}{let o=NaN,s=r.ownerDocument.createRange(),a=r.textContent.length;if(!a)return NaN;e.after&&(i+=a),i>=a&&(i=a-1),s.setStart(r,i),s.setEnd(r,i+1);let l=t.getRangeClientRects(s);return Fs(l,n),l=l.filter(e=>e.right>e.left&&e.bottom>e.top),l.length?(o=n?Math.min.apply(null,l.map(e=>e.left)):Math.max.apply(null,l.map(e=>e.bottom)),o):NaN}}function Ds(e,t,i){let n=_s(t);n&&As(t);let r=t.clientLayout.getElementClientRect(e);n&&Is(t);let o=t.getComputedMargin(e);return i?r.width+o.left+o.right:r.height+o.top+o.bottom}function Vs(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function Us(e,t){var i;if(e)for(let n=e.lastChild,r=n;n!==t;n=r)r=n.previousSibling,(1!==n.nodeType||!n.hasAttribute("data-vivliostyle-float-box-moved")||"inline"!==(null==(i=t.style)?void 0:i.display))&&e.removeChild(n)}var Hs="data-adapt-spec";function $s(e){return!!e.getAttribute(Hs)}function js(e){var t;if(1!==(null==e?void 0:e.nodeType))return!1;let i=e;if($s(i))return!0;let n=null==(t=i.style)?void 0:t.position;return"absolute"===n||"fixed"===n}function Ws(e){let t=null==e?void 0:e.viewNode;return 1===(null==t?void 0:t.nodeType)&&$s(t)}function Gs(e){return"inline"!==e&&(ks(e)||Ns(e))}function qs(e){var t;for(let i=e.parent;i;i=i.parent)if(("inline"!==i.display||i.vertical!==(null==(t=i.parent)?void 0:t.vertical))&&ks(i.display))return i;return null}var Xs=class{calculateOffset(e){return Ys(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}};function Ys(e,t){return{current:t.reduce((t,i)=>t+i.calculateOffset(e),0),minimum:t.reduce((t,i)=>t+i.calculateMinimumOffset(e),0)}}var Ks=class extends Xs{constructor(e,t,i,n){super(),this.position=e,this.breakOnEdge=t,this.overflows=i,this.computedBlockSize=n,h(this,"overflowIfRepetitiveElementsDropped"),h(this,"isEdgeUpdated",!1),h(this,"edge",0),this.overflowIfRepetitiveElementsDropped=i}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(mo(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var t;let i=e.calculateClonedPaddingBorder(this.position);if(this.edge=zs(this.position,e.clientLayout,0,e.vertical)+i,this.position.after||this.position.inline){if(this.position.after&&"table-cell"===(null==(t=this.position.shadowContext)?void 0:t.root.id)){let t=e.element.parentElement,i=null==t?void 0:t.closest("table, [style*='display: table;']");if(i){let n="collapse"===i.style.borderCollapse,r=0,o=0;for(let s=t;s;s=s.parentElement){let a=e.clientLayout.getElementComputedStyle(s);if((s===t||s===i&&!n)&&(r+=e.parseComputedLength(a.paddingBlockEnd)),s===i&&!n&&(r+=e.parseComputedLength(a.borderSpacing.replace(/^\S+ (\S+)$/,"$1"))),n?o=Math.max(o,e.parseComputedLength(a.borderBlockEndWidth)):(s===t||s===i)&&(o+=e.parseComputedLength(a.borderBlockEndWidth)),s===i)break}this.edge+=(e.vertical?-1:1)*(r+o)}}}else{let t=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*t}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let t=this.edge,i=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*i.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*i.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:t}=e.parent;if(!So.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;let i=t.getRepetitiveElements();return!!i&&i.isFirstContentNode(e)}},Zs=class{find(e){let t=M("RESOLVE_LAYOUT_PROCESSOR");for(let i=0;i<t.length;i++){let n=t[i](e);if(n)return n}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}},Js=class{layout(e,t,i){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,i,n){return new Ks(e.copy(),t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,i,n){var r;if(!i.viewNode||!i.viewNode.parentNode||i.shadowType===ko.ShadowType.ROOTLESS&&Ws(i))return;let o=i.viewNode;"viv-ts-inner"===(null==(r=o.parentElement)?void 0:r.localName)&&(o=o.parentElement.parentElement);let s=o.parentNode;Us(s,o),n&&s.removeChild(o)}finishBreak(e,t,i,n){let r=i||null!=t.viewNode&&1==t.viewNode.nodeType&&!t.after;return e.clearOverflownViewNodes(t,r),n&&e.layoutContext.processFragmentedBlockEdge(t),qn(!0)}},Qs=class{constructor(e){this.parent=e,h(this,"formattingContextType","Block")}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}},ea=new Js,ta=yo.isInstanceOfBlockFormattingContext;O("RESOLVE_FORMATTING_CONTEXT",(e,t,i,n,r,o)=>{let s=e.parent;return!s&&e.formattingContext||s&&e.formattingContext!==s.formattingContext?null:e.establishesBFC||!e.formattingContext&&Ss(i,n,r,o)?new Qs(s?s.formattingContext:null):null}),O("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof Qs?ea:null);var ia=class{constructor(){h(this,"initialBreakPositions",null),h(this,"initialStateOfFormattingContext",null),h(this,"initialPosition"),h(this,"initialFragmentLayoutConstraints")}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){let i=Gn("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);let n=this.resolveLayoutMode(e);return n.doLayout(e,t).then(r=>{let o=n.accept(r,t);o=n.postLayout(r,this.initialPosition,t,o),o?i.finish(r):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(i))}),i.result()}prepareLayout(e,t){}clearNodes(e){let t,i,n=e.viewNode||e.parent.viewNode;for(;t=n.lastChild;)n.removeChild(t);for(;i=n.nextSibling;)i.parentNode.removeChild(i)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}},na=class{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}},ra=class{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){let t=this.strategy,i=t.initialState(e),n=Gn("LayoutIterator");return n.loopWithFrame(e=>{let n;for(;i.nodeContext;){n=i.nodeContext.viewNode?1!==i.nodeContext.viewNode.nodeType?Mo(i.nodeContext.viewNode,i.nodeContext.whitespace)?i.nodeContext.after?t.afterIgnoredTextNode(i):t.startIgnoredTextNode(i):i.nodeContext.after?t.afterNonElementNode(i):t.startNonElementNode(i):i.nodeContext.inline?i.nodeContext.after?t.afterInlineElementNode(i):t.startInlineElementNode(i):i.nodeContext.after?t.afterNonInlineElementNode(i):t.startNonInlineElementNode(i):i.nodeContext.after?t.afterNonDisplayableNode(i):t.startNonDisplayableNode(i);let r=(n&&n.isPending()?n:qn(!0)).thenAsync(()=>i.break?qn(null):this.layoutContext.nextInTree(i.nodeContext,i.atUnforcedBreak));if(r.isPending())return void r.then(t=>{i.break?e.breakLoop():(i.nodeContext=t,e.continueLoop())});if(i.break)return void e.breakLoop();i.nodeContext=r.get()}t.finish(i),e.breakLoop()}).then(()=>{n.finish(i.nodeContext)}),n.result()}},oa=class extends na{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){let i=!e.leadingEdge&&co(e.breakAtTheEdge);if(i){let i=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;i.viewNode.parentNode.removeChild(i.viewNode),t.pageBreakType=e.breakAtTheEdge}return i}saveEdgeAndProcessOverflow(e,t){let i=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return i&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),i}processLayoutConstraint(e,t,i){let n=e.nodeContext,r=!t.allowLayout(n);return r&&(i.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),n=e.nodeContext=n.modify(),n.overflow=!0),r}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=bo(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,i;return e.onStartEdges?(t=this.endEmptyNonInlineBox(e),i=t&&t.isPending()?t:qn(!0),i=i.thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),qn(!0)))):(t=this.endNonInlineBox(e),i=t&&t.isPending()?t:qn(!0)),i.thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=bo(e.breakAtTheEdge,e.nodeContext.breakAfter)),qn(!0)))}},sa=[];function aa(e,t,i){return e-=i,0===t?0===e:e%t===0&&e/t>=0}var la=class{constructor(e){this.matchers=e}matches(){return this.matchers.some(e=>e.matches())}},ha=class{constructor(e){this.matchers=e}matches(){return this.matchers.every(e=>e.matches())}},ua=class e{constructor(e,t,i){this.elementOffset=e,this.a=t,this.b=i}static registerFragmentIndex(t,i,n){let r=e.fragmentIndices;(!r[t]||r[t].priority<=n)&&(r[t]={fragmentIndex:i,priority:n})}static clearFragmentIndices(){e.fragmentIndices={}}matches(){let t=e.fragmentIndices[this.elementOffset];return null!=t&&null!=t.fragmentIndex&&aa(t.fragmentIndex,this.a,this.b)}};h(ua,"fragmentIndices",{});var ca=ua,da=class{static buildViewConditionMatcher(e,t){let i=t.split("_");return"NFS"==i[0]?new ca(e,parseInt(i[1],10),parseInt(i[2],10)):null}static buildAllMatcher(e){return new ha(e)}static buildAnyMatcher(e){return new la(e)}},pa={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant-ligatures":!0,"font-variant-caps":!0,"font-variant-numeric":!0,"font-variant-east-asian":!0,"font-weight":!0,"glyph-orientation-vertical":!0,"hanging-punctuation":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,quotes:!0,"ruby-align":!0,"ruby-position":!0,"shape-rendering":!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-autospace":!0,"text-decoration-skip":!0,"text-decoration-skip-ink":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-fill-color":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-rendering":!0,"text-shadow":!0,"text-size-adjust":!0,"text-spacing-trim":!0,"text-stroke-color":!0,"text-stroke-width":!0,"text-transform":!0,"text-underline-offset":!0,"text-underline-position":!0,"text-wrap":!0,"text-wrap-mode":!0,"text-wrap-style":!0,visibility:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"writing-mode":!0},fa=["image-resolution","orphans","widows"],ga={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0,"http://www.w3.org/1998/Math/MathML":!0},ma=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],ba=["max-%","min-%","%"],va=(()=>{let e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let i=0;i<ma.length;i++)for(let n=0;n<e.length;n++){t[ma[i].replace("%",e[n])]=!0}return t})();function ya(e,t){let i={};for(let t of ma)for(let n in e){let r=t.replace("%",n),o=t.replace("%",e[n]);i[r]=o,i[o]=r}for(let e of ba)for(let n in t){let r=e.replace("%",n),o=e.replace("%",t[n]);i[r]=o,i[o]=r}return i}var wa=ya({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),xa=ya({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),Sa=ya({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),Ca=ya({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"}),ka=ya({inside:"right",outside:"left"},{}),Ea=ya({inside:"left",outside:"right"},{}),Pa=class e{constructor(e,t){this.value=e,this.priority=t}getBaseValue(){return this}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new e(i,this.priority)}increaseSpecificity(t){return 0==t?this:new e(this.value,this.priority+t)}evaluate(e,t,i,n){return t&&yi(t)?this.value:gh(e,this.value,t,i,n)}isEnabled(e){return!0}},Na=class e extends Pa{constructor(e,t,i){super(e,t),this.condition=i}getBaseValue(){return new Pa(this.value,this.priority)}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new e(i,this.priority,this.condition)}increaseSpecificity(t){return 0==t?this:new e(this.value,this.priority+t,this.condition)}isEnabled(e){try{return!!this.condition.evaluate(e)}catch(e){R.warn(e)}return!1}};function Ta(e,t,i){return(!t||i.priority>=t.priority)&&i.isEnabled(e)?i.getBaseValue():t}function Ia(e,t,i,n){if(e)if(i){let r=e[t];(!r||i.priority>=r.priority)&&(n?i.isEnabled(n)&&(e[t]=i.getBaseValue()):e[t]=i)}else delete e[t]}var Aa={"region-id":!0,"fragment-selector-id":!0};function _a(e){return!!Aa[e]}function Ra(e){return"_"===e.charAt(0)&&"_viewConditionalStyles"!==e}function La(e){return"_"!==e.charAt(0)&&!Aa[e]}function Fa(e){return!!pa[e]||yi(e)}function Oa(e,t){return e[t]}function Ba(e,t,i){i?e[t]=i:delete e[t]}function Ma(e,t){return e[t]}function za(e,t){let i=e[t];return i||(i={},e[t]=i),i}var Da=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function Va(e,t){return e[t]}function Ua(e,t){let i=e[t];return i||(i=[],e[t]=i),i}function Ha(e,t,i,n,r,o,s){var a,l;if([{id:r,styleKey:"_pseudos"},{id:o,styleKey:"_regions"}].forEach(e=>{if(e.id){let i=za(t,e.styleKey);(t=i[e.id])||(t={},i[e.id]=t)}}),s){let e=Da(t);t={},e.push({styles:t,matcher:s})}for(let r in i)if(!Ra(r))if(_a(r)){let e=Va(i,r),n=Ua(t,r);Array.prototype.push.apply(n,e)}else{let o=Oa(i,r);if(!o.isEnabled(e))continue;let s=o.increaseSpecificity(n);Ia(t,r,s,e);let h=null==(l=null==(a=e.style)?void 0:a.validatorSet.shorthands[r])?void 0:l.propList;if(h)for(let i of h){let n=new Pa(jt,s.priority);Ia(t,i,n,e)}}}function $a(e,t){if(e.length>0){e.sort((e,t)=>t.getPriority()-e.getPriority());let i=null;for(let n=e.length-1;n>=0;n--)i=e[n],i.chained=t,t=i;return i}return t}var ja=class extends Ut{constructor(e,t){super(),this.props=e,this.context=t,h(this,"propName","")}setPropName(e){this.propName=e}getFontSize(){let e=Oa(this.props,"font-size");if(!e.value.isNumeric())return Ke.em;let t=e.value;if(!function(e){switch(null==e?void 0:e.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}(t.unit))throw new Error("Unexpected state");return t.num*Ke[t.unit]}visitNumeric(e){return this.context,"font-size"===this.propName?Ga(e,this.getFontSize(),this.context):"em"===e.unit||"rem"===e.unit||"lh"===e.unit||"rlh"===e.unit?Wa(e,this.getFontSize(),this.context):e}visitExpr(e){return"font-size"==this.propName?gh(this.context,e,this.propName).visit(this):e}};function Wa(e,t,i){let n=e.unit,r=e.num;return"em"===n?new Zt(r*t,"px"):"rem"===n?new Zt(r*i.fontSize(),"px"):"rlh"===n?new Zt(r*i.rootLineHeight,"px"):e}function Ga(e,t,i){let n=(e=Wa(e,t,i)).unit,r=e.num;return"px"===n?e:new Zt("%"===n?r/100*t:r*i.queryUnitSize(n,!1),"px")}var qa=class{apply(e){}mergeWith(e){return new Ya([this,e])}clone(){return this}},Xa=class extends qa{constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},Ya=class e extends qa{constructor(e){super(),this.list=e}apply(e){for(let t=0;t<this.list.length;t++)this.list[t].apply(e)}mergeWith(e){return this.list.push(e),this}clone(){return new e([].concat(this.list))}},Ka=class extends qa{constructor(e,t,i,n,r){super(),this.style=e,this.specificity=t,this.pseudoelement=i,this.regionId=n,this.viewConditionId=r}apply(e){Ha(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},Za=class extends qa{constructor(){super(),h(this,"chained",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},Ja=class extends Za{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},Qa=class extends Za{constructor(e){super(),this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},el=class extends Za{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},tl=class extends Za{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);let i=t+this.localName;e.insertInTable(e.nstags,i,this.chained)}return!0}},il=class extends Za{constructor(e,t){super(),this.epubTypePatt=e,this.targetLocalName=t}apply(e){let t=e.currentElement;if(t instanceof HTMLAnchorElement&&t.hash&&t.href==t.baseURI.replace(/#.*$/,"")+t.hash){let i=t.hash.substring(1),n=t.ownerDocument.getElementById(i);if(n&&(!this.targetLocalName||n.localName==this.targetLocalName)){let t=n.getAttributeNS("http://www.idpf.org/2007/ops","type")||n.getAttribute("epub:type");t&&t.match(this.epubTypePatt)&&this.chained.apply(e)}}}},nl=class extends Za{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function rl(e,t,i,n){if(!e)return!1;if(null!==t)return n(e,t,i);for(let t of e.getAttributeNames())if((t===i||t.endsWith(`:${i}`))&&n(e,t===i?"":e.lookupNamespaceURI(t.split(":")[0]),i))return!0;return!1}var ol=class extends Za{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){rl(e.currentElement,this.ns,this.name,(e,t,i)=>e.hasAttributeNS(t,i))&&this.chained.apply(e)}},sl=class extends Za{constructor(e,t,i){super(),this.ns=e,this.name=t,this.value=i}apply(e){rl(e.currentElement,this.ns,this.name,(e,t,i)=>e.getAttributeNS(t,i)==this.value)&&this.chained.apply(e)}getPriority(){return"type"==this.name&&"http://www.idpf.org/2007/ops"==this.ns?9:0}makePrimary(e){return"type"==this.name&&"http://www.idpf.org/2007/ops"==this.ns&&(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0)}},al=class extends Za{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){rl(e.currentElement,this.ns,this.name,(e,t,i)=>!!ga[e.getAttributeNS(t,i)])&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},ll=class extends Za{constructor(e,t,i){super(),this.ns=e,this.name=t,this.regexp=i}apply(e){rl(e.currentElement,this.ns,this.name,(e,t,i)=>{var n;return!(null==(n=e.getAttributeNS(t,i))||!n.match(this.regexp))})&&this.chained.apply(e)}},hl=class extends Za{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},ul=class extends Za{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}},cl=class extends Za{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}},dl=class extends Za{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return aa(e,this.a,this.b)}},pl=class extends dl{constructor(e,t){super(e,t)}apply(e){let t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}},fl=class extends dl{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;null===t&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},gl=class extends dl{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let i=e.currentElement;do{let e=i.namespaceURI,n=i.localName,r=t[e];r||(r=t[e]={}),r[n]=(r[n]||0)+1}while(i=i.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}},ml=class extends Za{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}},bl=class extends Za{constructor(){super()}apply(e){!1===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}},vl=class extends Za{constructor(){super()}apply(e){!0===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}},yl=class extends Za{constructor(){super()}apply(e){let t=e.currentElement;(!0===t.selected||!0===t.checked)&&this.chained.apply(e)}getPriority(){return 5}},wl=class extends Za{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},xl=class e extends qa{constructor(){super(),h(this,"applied",!1)}apply(e){this.applied=!0}clone(){let t=new e;return t.applied=this.applied,t}},Sl=class extends Za{constructor(e){super(),h(this,"checkAppliedAction"),h(this,"firstActions",[]),this.checkAppliedAction=new xl;for(let t of e)this.firstActions.push($a(t,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map(e=>e instanceof Za?e.getPriority():0))}positive(){return!0}relational(){return!1}},Cl=class extends Sl{positive(){return!1}},kl=class extends Sl{constructor(e){super([]),this.selectorTexts=e}apply(e){for(let t of this.selectorTexts){let i,n;/^\s*[+~]/.test(t)?(n=e.currentElement.parentNode,i=`:scope > :nth-child(${Array.from(n.children).indexOf(e.currentElement)+1}) ${t}`):(n=e.currentElement,i=`:scope ${t}`);try{if(n.querySelector(i)){this.checkAppliedAction.apply(e);break}}catch(e){}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},El=class extends dl{constructor(e,t,i){super(e,t),h(this,"checkAppliedAction"),h(this,"firstActions",[]),this.checkAppliedAction=new xl;for(let e of i)this.firstActions.push($a(e,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;if(!this.checkAppliedAction.applied)return;this.checkAppliedAction.applied=!1;let t=1,i=e.currentElement.previousElementSibling;for(;i;)this.matchesSelector(i,e)&&t++,i=i.previousElementSibling;this.matchANPlusB(t)&&this.chained.apply(e)}matchesSelector(e,t){let i=t.currentElement,n=t.currentNamespace,r=t.currentLocalName,o=t.currentId,s=t.currentClassNames,a=t.currentSiblingOrder;t.currentElement=e,t.currentNamespace=e.namespaceURI||"",t.currentLocalName=e.localName,t.currentId=e.id,t.currentClassNames=e.classList?Array.from(e.classList):[];let l=1,h=e.previousElementSibling;for(;h;)l++,h=h.previousElementSibling;t.currentSiblingOrder=l;for(let e of this.firstActions)if(e.apply(t),this.checkAppliedAction.applied)break;let u=this.checkAppliedAction.applied;return this.checkAppliedAction.applied=!1,t.currentElement=i,t.currentNamespace=n,t.currentLocalName=r,t.currentId=o,t.currentClassNames=s,t.currentSiblingOrder=a,u}getPriority(){return 5}},Pl=class extends El{constructor(e,t,i){super(e,t,i)}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;if(!this.checkAppliedAction.applied)return;this.checkAppliedAction.applied=!1;let t=1,i=e.currentElement.nextElementSibling;for(;i;)this.matchesSelector(i,e)&&t++,i=i.nextElementSibling;this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},Nl=class{constructor(e,t,i){this.condition=e,this.viewConditionId=t,this.viewCondition=i}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}},Tl=class e extends Nl{constructor(e,t,i){super(e,t,i)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return 0==t&&this.increment(e),!1}pop(e,t){return 0==t&&(this.decrement(e),!0)}},Il=class e extends Nl{constructor(e,t,i){super(e,t,i)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return 0==t?this.increment(e):1==t&&this.decrement(e),!1}pop(e,t){return 0==t?(this.decrement(e),!0):(1==t&&this.increment(e),!1)}},Al=class e extends Nl{constructor(e,t,i){super(e,t,i),h(this,"fired",!1)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return!!this.fired&&(this.decrement(e),!0)}pop(e,t){return this.fired?(this.decrement(e),!0):(0==t&&(this.fired=!0,this.increment(e)),!1)}},_l=class e extends Nl{constructor(e,t,i){super(e,t,i),h(this,"fired",!1)}fresh(t){return new e(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(e,t){return this.fired&&(-1==t?this.increment(e):0==t&&this.decrement(e)),!1}pop(e,t){if(this.fired){if(-1==t)return this.decrement(e),!0;0==t&&this.increment(e)}else 0==t&&(this.fired=!0,this.increment(e));return!1}},Rl=class{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.processPseudoelementProps(this.afterprop,this.element),!0)}},Ll=class{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.lang=this.lang,!0)}},Fl=class{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.quotes=this.oldQuotes,!0)}},Ol=class extends Ut{constructor(e){super(),this.element=e}createValueFromString(e,t){return"url"===t?new ti(e||"about:invalid"):new qt(e||"")}visitFunc(e){if("attr"!==e.name)return super.visitFunc(e);let t="string",i=null,n=null;if(e.values[0]instanceof ri){let n=e.values[0].values;n.length>=2&&(t=n[1].stringValue()),i=n[0].stringValue()}else i=e.values[0].stringValue();return n=e.values.length>1?this.createValueFromString(e.values[1].stringValue(),t):this.createValueFromString(null,t),this.element&&this.element.hasAttribute(i)?this.createValueFromString(this.element.getAttribute(i),t):n}};function Bl(e){if(ns(e)){if(e instanceof qt)return e.stringValue();if(e instanceof ri)return e.values.map(e=>Bl(e)).join("")}return""}var Ml=class extends Ut{constructor(e,t,i){super(),this.cascade=e,this.element=t,this.counterResolver=i}visitIdent(e){let t=this.cascade,i=t.quotes,n=Math.floor(i.length/2)-1;switch(e.name){case"open-quote":{let e=i[2*Math.min(n,t.quoteDepth)];return t.quoteDepth++,e}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,i[2*Math.min(n,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new qt("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new qt("")}return e}format(e,t){return this.cascade.counterStyleStore.format(t,e)}visitFuncCounter(e){let t=e[0].toString(),i=e.length>1?e[1].stringValue():"decimal",n=this.cascade.counters[t];if(n&&n.length){let e=n&&n.length&&n[n.length-1]||0;return new qt(this.format(e,i))}{let e=new ai(this.counterResolver.getPageCounterVal(t,e=>this.format(e||0,i)));return new ri([e])}}visitFuncCounters(e){let t=e[0].toString(),i=e[1].stringValue(),n=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],o=new fe;if(r&&r.length)for(let e=0;e<r.length;e++)e>0&&o.append(i),o.append(this.format(r[e],n));let s=new ai(this.counterResolver.getPageCountersVal(t,e=>{let t=[];if(e.length)for(let i=0;i<e.length;i++)t.push(this.format(e[i],n));let r=o.toString();return r.length&&t.push(r),t.length?t.join(i):this.format(0,n)}));return new ri([s])}visitFuncTargetCounter(e){let t,i=e[0];t=i instanceof ti?i.url:i.stringValue();let n=e[1].toString(),r=e.length>2?e[2].stringValue():"decimal",o=new ai(this.counterResolver.getTargetCounterVal(t,n,e=>this.format(e||0,r)));return new ri([o])}visitFuncTargetCounters(e){let t,i=e[0];t=i instanceof ti?i.url:i.stringValue();let n=e[1].toString(),r=e[2].stringValue(),o=e.length>3?e[3].stringValue():"decimal",s=new ai(this.counterResolver.getTargetCountersVal(t,n,e=>{let t=e.map(e=>this.format(e,o));return t.length?t.join(r):this.format(0,o)}));return new ri([s])}visitFuncTargetText(e){let t,i=e[0];t=i instanceof ti?i.url:i.stringValue();let n=e.length>1?e[1].stringValue():"content",r=new ai(this.counterResolver.getTargetTextVal(t,n));return new ri([r])}visitFuncString(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new ai(this.counterResolver.getNamedStringVal(t,i))}visitFuncElement(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new ai(this.counterResolver.getRunningElementVal(t,i))}visitFuncContent(e){var t,i,n,r,o,s;let a=e.length>0?e[0].stringValue():"text",l="";switch(a){case"text":l=this.element.textContent;break;case"before":case"after":case"marker":{let e=Ma(this.cascade.currentStyle,"_pseudos");l=Bl(null==(i=null==(t=null==e?void 0:e[a])?void 0:t.content)?void 0:i.value)}break;case"first-letter":{let e=Ma(this.cascade.currentStyle,"_pseudos"),t=(Bl(null==(r=null==(n=null==e?void 0:e.before)?void 0:n.content)?void 0:r.value)||this.element.textContent||Bl(null==(s=null==(o=null==e?void 0:e.after)?void 0:o.content)?void 0:s.value)).match(Y);l=t?t[0]:""}}return new qt(l)}visitFuncLeader(e){let t="";if(e[0]instanceof Yt)switch(e[0].stringValue()){case"dotted":t=".";break;case"solid":t="_";break;case"space":t=" "}else e[0]instanceof qt&&(t=e[0].stringValue());return 0==t.length?new qt(""):new ai(new Tt(null,()=>t,"viv-leader"))}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case"target-text":if(e.values.length>=1&&e.values.length<=2)return this.visitFuncTargetText(e.values);break;case"string":if(e.values.length<=2)return this.visitFuncString(e.values);break;case"element":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case"content":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case"leader":if(e.values.length<=1)return this.visitFuncLeader(e.values)}return e}};function zl(e,t,i){let n;if(1===e.nodeType)n=Array.from(e.getClientRects());else{let i=e.ownerDocument.createRange();i.selectNodeContents(e),n=t.getRangeClientRects(i)}return n.reduce((e,t)=>e+("vertical-rl"===i||"vertical-lr"===i?t.height:t.width),0)}O("POST_LAYOUT_BLOCK",(e,t,i)=>{let n=t.filter(e=>e.after&&1===e.viewNode.nodeType&&e.viewNode.getAttribute("data-viv-leader"));for(let e of n){let t=function(e){a.textContent="rtl"===d?(e.startsWith("")?"":"")+e+(e.endsWith("")?"":""):e},n=function(){let e=i.clientLayout.getElementClientRect(l);return"vertical-rl"===c||"vertical-lr"===c?"rtl"===d?e.top-=S:e.bottom+=S:"rtl"===d?e.left-=S:e.right+=S,m.left>e.left||m.right<e.right||m.top>e.top||m.bottom<e.bottom},r=function(){let e,i,r=u.repeat(1e4);if(t(r),n()){e=1,i=1e4;for(let r=0;r<16;r++){let r="",o=Math.floor((e+i)/2);for(let e=0;e<o;e++)r+=u;if(t(r),n())i=o;else{if(e==o)return;e=o}}t(u)}},o=function(e){let t=0,n=l.parentElement;for(;n&&n!==s.viewNode;)t+=i.getComputedInsets(n)[e],n=n.parentElement;return t},s=e.parent;for(;s&&s.inline;)s=s.parent;let a=e.viewNode,l=a.parentElement,h=l.getAttribute("data-adapt-pseudo"),u=a.getAttribute("data-viv-leader-value"),{writingMode:c,direction:d,marginInlineEnd:p}=i.clientLayout.getElementComputedStyle(l);a.style.marginInlineStart="1px",t(u),l.style.display="inline-block",l.style.textIndent="0";let f=Ms(s.viewNode),g=(null==f?void 0:f.style.columnFill)||null;f&&(f.style.columnFill="auto");let m=i.clientLayout.getElementClientRect(s.viewNode),b=i.clientLayout.getElementClientRect(l),v=i.parseComputedLength(p),y=[],w=l.parentElement;for(;w.parentElement&&w.parentElement!==s.viewNode;)w=w.parentElement;let x=w.nextSibling;for(;x;){if(1===x.nodeType){let e=x,{display:t,float:n,position:r}=i.clientLayout.getElementComputedStyle(e);if("none"!==n||"absolute"===r||"fixed"===r){x=x.nextSibling;continue}if(ks(t))y.push(e);else if(Ps(t))break}else if(3===x.nodeType){let e=x;e.length>0&&y.push(e)}x=x.nextSibling}let S=y.reduce((e,t)=>e+zl(t,i.clientLayout,c),0);if("after"!==h){let e=zl(w,i.clientLayout,c),t=zl(l,i.clientLayout,c);S+=e-t}"vertical-rl"===c||"vertical-lr"===c?("rtl"===d?m.top+=v:m.bottom-=v,m.top=Math.min(b.top,m.top),m.bottom=Math.max(b.bottom,m.bottom)):("rtl"===d?m.left+=v:m.right-=v,m.left=Math.min(b.left,m.left),m.right=Math.max(b.right,m.right)),r();let C=i.clientLayout.getElementClientRect(l);l.style.float="rtl"==d?"left":"right";let k=i.clientLayout.getElementClientRect(l),E=0;E="rtl"==d?"vertical-rl"==c||"vertical-lr"==c?C.top-k.top-o("top"):C.left-k.left-o("left"):"vertical-rl"==c||"vertical-lr"==c?k.bottom-C.bottom-o("bottom"):k.right-C.right-o("right"),E-=S,E=Math.max(0,E-.1),l.style.float="",a.style.marginInlineStart=`${E}px`,f&&(g?f.style.columnFill=g:f.style.removeProperty("column-fill"))}});var Dl=1/1048576;function Vl(e,t){for(let i in e)t[i]=e[i].clone()}var Ul=class e{constructor(){h(this,"nsCount",0),h(this,"nsPrefix",{}),h(this,"tags",{}),h(this,"nstags",{}),h(this,"epubtypes",{}),h(this,"classes",{}),h(this,"ids",{}),h(this,"pagetypes",{}),h(this,"order",0)}clone(){let t=new e;t.nsCount=this.nsCount;for(let e in this.nsPrefix)t.nsPrefix[e]=this.nsPrefix[e];return Vl(this.tags,t.tags),Vl(this.nstags,t.nstags),Vl(this.epubtypes,t.epubtypes),Vl(this.classes,t.classes),Vl(this.ids,t.ids),Vl(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(e,t,i){let n=e[t];n&&(i=n.mergeWith(i)),e[t]=i}createInstance(e,t,i,n,r){return new Hl(this,e,t,i,n,r)}nextOrder(){return this.order+=Dl}},Hl=class{constructor(e,t,i,n,r,o){this.context=t,this.counterListener=i,this.counterResolver=n,this.counterStyleStore=o,h(this,"code"),h(this,"stack",[[],[]]),h(this,"conditions",{}),h(this,"currentElement",null),h(this,"currentElementOffset",null),h(this,"currentStyle",null),h(this,"currentClassNames",null),h(this,"currentLocalName",""),h(this,"currentNamespace",""),h(this,"currentId",""),h(this,"currentXmlId",""),h(this,"currentNSTag",""),h(this,"currentEpubTypes",null),h(this,"currentPageType",null),h(this,"previousPageType",null),h(this,"firstPageType",null),h(this,"pageTypePageCounts",{}),h(this,"isFirst",!0),h(this,"isRoot",!0),h(this,"counters",{}),h(this,"counterScoping",[{}]),h(this,"quotes"),h(this,"quoteDepth",0),h(this,"lang",""),h(this,"siblingOrderStack",[0]),h(this,"currentSiblingOrder",0),h(this,"siblingTypeCountsStack",[{}]),h(this,"currentSiblingTypeCounts"),h(this,"currentFollowingSiblingOrder",null),h(this,"followingSiblingOrderStack"),h(this,"followingSiblingTypeCountsStack",[{}]),h(this,"currentFollowingSiblingTypeCounts"),h(this,"viewConditions",{}),h(this,"dependentConditions",[]),h(this,"elementStack"),this.code=e,this.quotes=[new qt(""),new qt(""),new qt(""),new qt("")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter(e=>e!==t),0===this.viewConditions[e].length&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(this.currentElementOffset,t=da.buildViewConditionMatcher(this.currentElementOffset,e));let i=this.dependentConditions.map(e=>{let t=this.viewConditions[e];return t&&t.length>0?1===t.length?t[0]:da.buildAnyMatcher([].concat(t)):null}).filter(e=>e);return i.length<=0?t:null===t?1===i.length?i[0]:da.buildAllMatcher(i):da.buildAllMatcher([t].concat(i))}applyAction(e,t){let i=e[t];i&&i.apply(this)}pushRule(e,t,i){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=i,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=$l,this.currentPageType=t,this.applyActions()}defineCounter(e,t){let i=this.counterScoping[this.counterScoping.length-1];i||(i={},this.counterScoping[this.counterScoping.length-1]=i),this.counters[e]?(i[e]&&this.counters[e].pop(),this.counters[e].push(t)):this.counters[e]=[t],i[e]=!0}pushCounters(e){var t,i,n,r,o,s,a;let l=ci.inline,h=e.display;if(h&&(l=h.evaluate(this.context)),l===ci.none)return this.currentElement.setAttribute("data-viv-display-none","true"),void this.counterScoping.push(null);if(this.currentElement.closest("[data-viv-display-none]"))return void this.counterScoping.push(null);let u=ci.inline,c=e.float;c&&(u=c.evaluate(this.context));let d=null,p=null,f=null,g=e["counter-reset"];if(g){let e=g.evaluate(this.context);e&&(d=Xi(e,!0))}let m=e["counter-set"];if(m){let e=m.evaluate(this.context);e&&(f=Xi(e,!1))}let b=e["counter-increment"];if(b){let e=b.evaluate(this.context);e&&(p=Xi(e,!1))}if(("ol"==this.currentLocalName||"ul"==this.currentLocalName)&&"http://www.w3.org/1999/xhtml"==this.currentNamespace&&(d||(d={}),d["list-item"]=(null!=(i=null==(t=this.currentElement)?void 0:t.start)?i:1)-1),Es(l)&&(p||(p={}),p["list-item"]=null!=(n=p["list-item"])?n:1,/^\s*[-+]?\d/.test(null!=(o=null==(r=this.currentElement)?void 0:r.getAttribute("value"))?o:"")&&(f||(f={}),f["list-item"]=this.currentElement.value)),(null==(s=this.currentElement)?void 0:s.parentNode.nodeType)===Node.DOCUMENT_NODE&&(d||(d={}),void 0===d.footnote&&(d.footnote=0)),u===ci.footnote&&(p||(p={}),void 0===p.footnote)){let e=null==(a=this.currentStyle["counter-increment"])?void 0:a.value;(!e||!(e===ci.footnote||e instanceof ri&&e.values.includes(ci.footnote)))&&(p.footnote=1)}if(d)for(let e in d)this.defineCounter(e,d[e]);if(p)for(let e in p){this.counters[e]||this.defineCounter(e,0);let t=this.counters[e];t[t.length-1]+=p[e]}if(f)for(let e in f)if(this.counters[e]){let t=this.counters[e];t[t.length-1]=f[e]}else this.defineCounter(e,f[e]);if(Es(l)){let t=this.counters["list-item"],i=t[t.length-1];e["ua-list-item-count"]=new Pa(new Jt(i),0);let n=za(e,"_pseudos");n.marker||(n.marker={})}this.counterScoping.push(null)}popCounters(){let e=this.counterScoping.pop();if(e)for(let t in e){let e=this.counters[t];e&&(1==e.length?delete this.counters[t]:e.pop())}}setNamedStrings(e){let t=e["string-set"];if(!t)return;t=t.filterValue(new Ml(this,this.currentElement,this.counterResolver));let i=t.value instanceof oi?t.value.values:[t.value];for(let e of i)if(e instanceof ri){let t=e.values[0].stringValue(),i=e.values.slice(1).map(e=>Bl(e)).join("");this.counterResolver.setNamedString(t,i,this.currentElementOffset)}delete e["string-set"]}setRunningElement(e){let t=e.position;if((null==t?void 0:t.value)instanceof si&&"running"===t.value.name){let e=t.value.values[0].stringValue();this.counterResolver.setRunningElement(e,this.currentElementOffset)}}processPseudoelementProps(e,t){this.pushCounters(e);let i=e.content;i&&(e.content=i.filterValue(new Ml(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,i,n){var r,o,s;this.currentPageType=null,this.currentElement=t,this.currentElementOffset=n,this.currentStyle=i,this.currentNamespace=t.namespaceURI,this.currentLocalName=t.localName;let a=this.code.nsPrefix[this.currentNamespace];this.currentNSTag=a?a+this.currentLocalName:"",this.currentId=t.getAttribute("id"),this.currentXmlId=t.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");let l=t.getAttribute("class");this.currentClassNames=l?l.split(/\s+/):$l;let h=t.getAttributeNS("http://www.idpf.org/2007/ops","type");this.currentEpubTypes=h?h.split(/\s+/):$l;let u=pe(t);u&&(this.stack[this.stack.length-1].push(new Ll(this.lang)),this.lang=u.toLowerCase());let c=this.isRoot,d=this.siblingOrderStack;this.currentSiblingOrder=++d[d.length-1],d.push(0);let p=this.siblingTypeCountsStack,f=this.currentSiblingTypeCounts=p[p.length-1],g=f[this.currentNamespace];g||(g=f[this.currentNamespace]={}),g[this.currentLocalName]=(g[this.currentLocalName]||0)+1,p.push({});let m=this.followingSiblingOrderStack;null!==m[m.length-1]?this.currentFollowingSiblingOrder=--m[m.length-1]:this.currentFollowingSiblingOrder=null,m.push(null);let b=this.followingSiblingTypeCountsStack,v=this.currentFollowingSiblingTypeCounts=b[b.length-1];v&&v[this.currentNamespace]&&v[this.currentNamespace][this.currentLocalName]--,b.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],e,t),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(t);let y=i.quotes,w=null;if(y){let e=y.evaluate(this.context);e&&(w=new Fl(this.quotes),e===ci.none?this.quotes=[new qt(""),new qt("")]:e===ci.auto||e===ci.initial?this.quotes=[new qt(""),new qt(""),new qt(""),new qt("")]:e instanceof ri&&(this.quotes=e.values))}this.pushCounters(this.currentStyle);let x=this.currentId||this.currentXmlId||t.getAttribute("name")||"";if(c||x){let e={};Object.keys(this.counters).forEach(t=>{e[t]=Array.from(this.counters[t])}),this.counterListener.countersOfId(x,e)}let S=Ma(this.currentStyle,"_pseudos");if(S){let i=!0;for(let n of jl){n||(i=!1);let a=S[n];if(a)if(("before"===n||"after"===n)&&!ns(null==(r=a.content)?void 0:r.value)||"marker"===n&&!Es(null==(o=Oa(this.currentStyle,"display"))?void 0:o.value)||("footnote-call"===n||"footnote-marker"===n)&&(null==(s=Oa(this.currentStyle,"float"))?void 0:s.value)!==ci.footnote)delete S[n];else if(i){if(this.processPseudoelementProps(a,t),"marker"===n)this.processMarkerPseudoelementProps(a,t,e);else if("first-letter"===n&&a["initial-letter"]){let e=a["initial-letter"].evaluate(this.context);e!==ci.normal&&!bi(e)&&(this.currentStyle["--viv-initialLetter"]=new Pa(e,0)),delete a["initial-letter"]}}else this.stack[this.stack.length-2].push(new Rl(a,t))}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),w&&this.stack[this.stack.length-2].push(w)}processMarkerPseudoelementProps(e,t,i){var n,r,o,s,a;if(!ns(null==(n=e.content)?void 0:n.value)&&Es(null==(r=this.currentStyle.display)?void 0:r.value)){let n=this.getInheritedPropertyValue("list-style-type",i,t),r=this.getInheritedPropertyValue("list-style-image",i,t);if(r instanceof ti)e.content=new Pa(new ri([r,new qt(" ")]),0);else if(n instanceof qt)e.content=new Pa(n,0);else if(n instanceof Yt&&n!==ci.none){let t=null==(s=null==(o=this.currentStyle["ua-list-item-count"])?void 0:o.value)?void 0:s.num;null!=t&&(e.content=new Pa(new qt(this.counterStyleStore.formatMarker(n.name,t)),0)),e["list-style-type"]=new Pa(n,0)}}if(!ks(null==(a=Oa(this.currentStyle,"display"))?void 0:a.value)){let n=this.getInheritedPropertyValue("list-style-position",i,t);n&&(e["list-style-position"]=new Pa(n,0))}}getInheritedPropertyValue(e,t,i){var n;for(let n=i;n;n=n.parentElement){let i=(n===this.currentElement?this.currentStyle:t.getStyle(n,!1))[e];if(i){let t=i.evaluate(this.context,e);if(t===ci.inherit||t===ci.unset||t===ci.revert)continue;if(t===ci.initial)break;return t}}let r=t.validatorSet;return null!=(n=null==r?void 0:r.defaultValues[e])?n:null}applyAttrFilterInner(e,t){for(let i in t)La(i)&&!yi(i)&&(t[i]=t[i].filterValue(e))}applyAttrFilter(e){let t=new Ol(e),i=this.currentStyle,n=Ma(i,"_pseudos");for(let e in n)this.applyAttrFilterInner(t,n[e]);this.applyAttrFilterInner(t,i)}applyVarFilter(e,t,i){var n,r,o;let s=e[0],a=new ph(e,t,i),l={};for(let h in s)if(Ra(h)){let n=Ma(s,h);for(let r in n)this.applyVarFilter([n[r],...e],t,i)}else if(La(h)){let e=Oa(s,h),i=e.value;for(let e=0;;e++){if(e>=32){i=jt;break}let t=i.visit(a);if(a.error){i=jt,a.error=!1;break}if(t===i)break;i=t}if(i!==e.value){let a=t.validatorSet,u=null==(n=null==a?void 0:a.shorthands[h])?void 0:n.clone();if(u)if(bi(i)){for(let t of u.propList){let n=new Pa(i,e.priority),r=Oa(s,t);Ba(l,t,Ta(this.context,r,n))}delete s[h]}else{let n=qr(t.scope,new Hn(i.toString(),null),"");if(n&&(n.visit(u),!u.error)){for(let t of u.propList){let i=new Pa(null!=(o=null!=(r=u.values[t])?r:a.defaultValues[t])?o:ci.initial,e.priority),n=Oa(s,t);Ba(l,t,Ta(this.context,n,i))}delete s[h]}}else s[h]=new Pa(i,e.priority)}if(l[h]){let e=Oa(s,h);e&&e.value!==jt&&Ia(l,h,e,this.context)}}for(let e in l)s[e]=l[e]}applyCalcFilter(e,t){let i=new fh(t);for(let n in e)if(Ra(n)){let i=Ma(e,n);for(let e in i)this.applyCalcFilter(i[e],t)}else if(La(n)&&!yi(n)){let t=Oa(e,n),r=t.value.visit(i);r!==t.value&&(e[n]=new Pa(r,t.priority))}}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),""!=this.currentLocalName&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),null!==this.currentPageType&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.stack.push([]);for(let t=1;t>=-1;--t){let i=this.stack[this.stack.length-t-2];for(e=0;e<i.length;)i[e].push(this,t)?i.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){let t=this.stack[this.stack.length-e-2],i=0;for(;i<t.length;)t[i].pop(this,e)?t.splice(i,1):i++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},$l=[],jl=["before","transclusion-before","footnote-call","footnote-marker","marker","inner","first-letter","first-line","","transclusion-after","after"],Wl=null,Gl=class extends Pr{constructor(e,t,i,n,r,o,s){super(e,t,s),this.condition=i,this.regionId=r,this.validatorSet=o,h(this,"chain",null),h(this,"specificity",0),h(this,"elementStyle",null),h(this,"conditionCount",0),h(this,"pseudoelement",null),h(this,"footnoteContent",!1),h(this,"cascade"),h(this,"state"),h(this,"viewConditionId",null),h(this,"insideSelectorRule"),h(this,"invalid",!1),this.cascade=n?n.cascade:Wl?Wl.clone():new Ul,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){let t=$a(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return 0!=this.state&&(this.reportAndSkip(e),!0)}tagSelector(e,t){!t&&!e||(t&&(this.specificity+=1),t&&e?this.chain.push(new tl(e,t.toLowerCase())):t?this.chain.push(new el(t.toLowerCase())):this.chain.push(new nl(e)))}invalidSelector(e){R.warn(e),this.chain.push(new wl("")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof Yl;e=e.parent)e.parent.invalid=!0}classSelector(e){this.pseudoelement?this.invalidSelector(`::${this.pseudoelement} followed by .${e}`):(this.specificity+=256,this.chain.push(new Ja(e)))}pseudoclassSelector(e,t){if(this.pseudoelement)this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);else{switch(e.toLowerCase()){case"enabled":this.chain.push(new bl);break;case"disabled":this.chain.push(new vl);break;case"checked":this.chain.push(new yl);break;case"root":case"scope":this.chain.push(new cl);break;case"link":this.chain.push(new el("a")),this.chain.push(new ol("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&t.length>=1&&"string"==typeof t[0]){let e=t[0],i=new RegExp(`(^|\\s)${xe(e)}($|\\s)`),n=t[1];this.chain.push(new il(i,n))}else this.chain.push(new wl(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new wl(""));break;case"lang":if(t&&1==t.length&&"string"==typeof t[0]){let e=t[0];this.chain.push(new hl(new RegExp(`^${xe(e.toLowerCase())}($|-)`)))}else this.chain.push(new wl(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{let i=ql[e.toLowerCase()];t&&2==t.length?this.chain.push(new i(t[0],t[1])):this.chain.push(new wl(""));break}case"first-child":this.chain.push(new ul);break;case"last-child":this.chain.push(new fl(0,1));break;case"first-of-type":this.chain.push(new pl(0,1));break;case"last-of-type":this.chain.push(new gl(0,1));break;case"only-child":this.chain.push(new ul),this.chain.push(new fl(0,1));break;case"only-of-type":this.chain.push(new pl(0,1)),this.chain.push(new gl(0,1));break;case"empty":this.chain.push(new ml);break;case"before":case"after":case"first-line":case"first-letter":return void this.pseudoelementSelector(e,t);default:return void this.invalidSelector(`Unknown pseudo-class :${e}`)}this.specificity+=256}}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"marker":case"inner":case"after-if-continues":if(this.pseudoelement)return void this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);this.pseudoelement=e;break;case"first-n-lines":if(t&&1==t.length&&"number"==typeof t[0]){let i=Math.round(t[0]);if(i>0&&i==t[0]){if(this.pseudoelement)return void this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);this.pseudoelement=`first-${i}-lines`;break}}this.chain.push(new wl(""));break;case"nth-fragment":t&&2==t.length?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new wl(""));break;default:return void this.invalidSelector(`Unknown pseudo-element ::${e}`)}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new Qa(e))}attributeSelector(e,t,i,n){let r;switch(this.specificity+=256,t=t.toLowerCase(),n=n||"",i){case 0:r=new ol(e,t);break;case 39:r=new sl(e,t,n);break;case 45:r=!n||n.match(/\s/)?new wl(""):new ll(e,t,new RegExp(`(^|\\s)${xe(n)}($|\\s)`));break;case 44:r=new ll(e,t,new RegExp(`^${xe(n)}($|-)`));break;case 43:r=n?new ll(e,t,new RegExp(`^${xe(n)}`)):new wl("");break;case 42:r=n?new ll(e,t,new RegExp(`${xe(n)}$`)):new wl("");break;case 46:r=n?new ll(e,t,new RegExp(xe(n))):new wl("");break;case 50:if("supported"!=n)return void this.invalidSelector(`Unsupported :: attr selector op: ${n}`);r=new al(e,t);break;default:return void this.invalidSelector(`Unsupported attr selector: ${i}`)}this.chain.push(r)}descendantSelector(){let e="d"+Xl++;this.processChain(new Xa(new Tl(e,this.viewConditionId,null))),this.chain=[new wl(e)],this.viewConditionId=null}childSelector(){let e="c"+Xl++;this.processChain(new Xa(new Il(e,this.viewConditionId,null))),this.chain=[new wl(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e="a"+Xl++;this.processChain(new Xa(new Al(e,this.viewConditionId,null))),this.chain=[new wl(e)],this.viewConditionId=null}followingSiblingSelector(){let e="f"+Xl++;this.processChain(new Xa(new _l(e,this.viewConditionId,null))),this.chain=[new wl(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,t){super.error(e,t),1==this.state&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),1==this.state&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t=t?"xxx-bogus-xxx":"footnote"),new Ka(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let i;i=this.condition?new Na(t,0,this.condition):new Pa(t,0),Ua(this.elementStyle,e).push(i)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){"display"==e&&(t===ci.oeb_page_head||t===ci.oeb_page_foot)&&(this.simpleProperty("flow-options",new ri([ci.exclusive,ci._static]),i),this.simpleProperty("flow-into",t,i),t=ci.block),M("SIMPLE_PROPERTY").forEach(n=>{let r=n({name:e,value:t,important:i});e=r.name,t=r.value,i=r.important});let n=(i?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),r=this.condition?new Na(t,n,this.condition):new Pa(t,n);Ia(this.elementStyle,e,r)}finish(){return this.cascade}startFuncWithSelector(e,t){let i;switch(e){case"is":i=new Yl(this);break;case"not":i=new Kl(this);break;case"where":i=new Zl(this);break;case"has":i=new Jl(this);break;case"nth-child":t&&t.length>=2&&(i=new Ql(this,t[0],t[1]));break;case"nth-last-child":t&&t.length>=2&&(i=new eh(this,t[0],t[1]))}i&&(i.startSelectorRule(),this.owner.pushHandler(i))}},ql={"nth-child":class extends dl{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},"nth-of-type":pl,"nth-last-child":fl,"nth-last-of-type":gl},Xl=0,Yl=class e extends Gl{constructor(e){super(e.scope,e.owner,e.condition,e,e.regionId,e.validatorSet,!1),this.parent=e,h(this,"parentChain"),h(this,"chains",[]),h(this,"maxSpecificity",0),h(this,"selectorTexts",[]),this.parentChain=e.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new kl(this.selectorTexts):this.positive()?new Sl(this.chains):new Cl(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new wl("")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}error(t,i){super.error(t,i),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let n=!1;for(let t=this;t instanceof e;t=t.parent)if(t.forgiving()){n=!0;break}n||this.owner.popHandler()}pushSelectorText(e){this.chain&&this.relational()&&this.selectorTexts.push(e)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},Kl=class extends Yl{positive(){return!1}forgiving(){return!1}},Zl=class extends Yl{increasingSpecificity(){return!1}},Jl=class extends Yl{relational(){return!0}},Ql=class extends Yl{constructor(e,t,i){super(e),this.a=t,this.b=i}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(new El(this.a,this.b,this.chains)),this.parent.specificity+=256+this.maxSpecificity):this.parentChain.push(new wl("")),this.owner.popHandler()}forgiving(){return!0}},eh=class extends Ql{endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(new Pl(this.a,this.b,this.chains)),this.parent.specificity+=256+this.maxSpecificity):this.parentChain.push(new wl("")),this.owner.popHandler()}},th=class extends Pr{constructor(e,t){super(e,t,!1)}property(e,t,i){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{let i=e.match(/height|^(top|bottom)$/)?"vh":"vw",n=new Et(this.scope,100,i);this.scope.defineName(e,t.toExpr(this.scope,n))}}},ih=class extends Pr{constructor(e,t,i,n,r,o){super(e,t,!1),this.condition=i,this.elementStyle=n,this.validatorSet=r,this.ruleType=o,h(this,"order"),this.order=0}property(e,t,i){i?R.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){R.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){R.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity();n+=this.order,this.order+=Dl;let r=this.condition?new Na(t,n,this.condition):new Pa(t,n);Ia(this.elementStyle,e,r)}},nh=class extends $r{constructor(e,t){super(e),this.validatorSet=t,h(this,"elementStyle",{}),h(this,"order",0)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){R.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){R.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?Sr:xr;n+=this.order,this.order+=Dl;let r=new Pa(t,n);Ia(this.elementStyle,e,r)}};function rh(e,t){let i=Da(e);i&&i.forEach(e=>{e.matcher.matches()&&t(e.styles)})}function oh(e,t,i){rh(i,i=>{ch(e,i,t)})}function sh(e,t,i,n){let r=new nh(e,t),o=new Hn(n,r);try{!function(e,t,i){new Hr(Tr,e,t,i).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}(o,r,i)}catch(e){R.warn(e,"Style attribute parse error:")}return r.elementStyle}function ah(e,t,i){let n=e["writing-mode"];if(n){let e=n.evaluate(t,"writing-mode");if(e&&e!==ci.inherit&&e!==ci.revert&&e!==ci.unset)return e===ci.vertical_rl}return i}function lh(e,t,i){let n=e.direction;if(n){let e=n.evaluate(t,"direction");if(e&&e!==ci.inherit&&e!==ci.revert&&e!==ci.unset)return e===ci.rtl}return i}function hh(e,t,i,n,r){let o={};for(let t in e)La(t)&&(o[t]=Oa(e,t));return oh(o,t,e),uh(e,i,n,(e,i)=>{ch(o,i,t),oh(o,t,i)}),o}function uh(e,t,i,n){let r=Ma(e,"_regions");if((t||i)&&r){if(i){let e=["footnote"];t=t?t.concat(e):e}for(let e of t){let t=r[e];t&&n(e,t)}}}function ch(e,t,i){for(let n in t)if(La(n)){let r=Oa(t,n),o=e[n];e[n]=Ta(i,o,r)}}var dh=(e,t,i,n,r,o)=>{var s,a;let l=i?n?Sa:wa:n?Ca:xa,h=r?ka:Ea;for(let i in e){let n=e[i];if(!n)continue;let u,c=null!=(s=l[i])?s:l[h[i]],d=null!=(a=h[i])?a:h[l[i]],p=null!=c?c:d;if(p){let t=e[p];if(t&&t.priority>n.priority||c&&d&&c!==d&&(p=d,t=e[p],t&&t.priority>n.priority))continue;u=va[c]?c:va[d]?d:i}else u=i,i.startsWith("text-align")&&(n.value===ci.inside||n.value===ci.outside)&&(n=new Pa(r===(n.value===ci.inside)?ci.right:ci.left,n.priority));t[u]=o(i,n)}},ph=class extends Ut{constructor(e,t,i){super(),this.elementStyles=e,this.styler=t,this.element=i}getVarValue(e){var t,i,n,r,o;let s=null!=(t=this.element)?t:this.styler.root;if(null!=(i=this.elementStyles)&&i.length){for(let t of this.elementStyles){let i=null==(n=t[e])?void 0:n.value;if(i)return i}this.element&&(s=this.element.parentElement)}for(;s;s=s.parentElement){let t=null==(o=null==(r=this.styler.getStyle(s,!1))?void 0:r[e])?void 0:o.value;if(t)return t}return null}visitFunc(e){if("var"!==e.name)return super.visitFunc(e);let t=e.values[0]instanceof Yt&&e.values[0].name;return t&&yi(t)?this.getVarValue(t)||(e.values.length<2?(this.error=!0,jt):2===e.values.length?e.values[1]:new oi(e.values.slice(1))):(this.error=!0,jt)}},fh=class extends Ut{constructor(e,t,i,n){super(),this.context=e,this.resolveViewportUnit=t,this.percentRef=i,this.vertical=n}visitFunc(e){let t=super.visitFunc(e);if("calc"!==e.name)return t;let i=t.toString().replace(/^calc\b/,"-epubx-expr");if(/\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\W|\Wvar\(\s*--/i.test(i))return t;let n=qr(this.context.rootScope,new Hn(i,null),"");if(n instanceof ai)try{let e=n.expr.evaluate(this.context);"number"==typeof e&&!isNaN(e)&&(/\d(px|in|pt|pc|cm|mm|q|rem|rlh)\W/i.test(i)?t=new Zt(e,"px"):/\d[a-z]/i.test(i)||(t=new Jt(e)))}catch(e){R.warn(e)}return t}visitNumeric(e){return this.resolveViewportUnit&&(Ye(e.unit)||function(e){switch(null==e?void 0:e.toLowerCase()){case"rem":case"rlh":return!0;default:return!1}}(e.unit))?new Zt(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),"px"):"number"==typeof this.percentRef&&"%"===e.unit?new Zt(e.num*this.percentRef/100,"px"):e}};function gh(e,t,i,n,r){try{if(t instanceof ai)return t.expr instanceof Tt&&(t.expr.str.startsWith("named-string-")||t.expr.str.startsWith("running-element-"))?t:Yr(e,t.expr,i);if(t instanceof Zt||t instanceof si||t instanceof ri||t instanceof oi)return t.visit(new fh(e,!0,n,r))}catch(e){return R.warn(e),jt}return t}var mh={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function bh(e){let t=e instanceof Ht?e:"string"==typeof e?Kt(e):ci.none;if(t===ci.none)return mh;let i=t instanceof ri?t.values:[t],n=Object.create(mh);for(let e of i)if(e instanceof Yt)switch(e.name){case"first":n.first=!0;break;case"force-end":n.forceEnd=!0,n.allowEnd=!1;break;case"allow-end":n.forceEnd=!1,n.allowEnd=!0;break;case"last":n.last=!0}return n}function vh(e){return!(e.first||e.last||e.forceEnd||e.allowEnd)}var yh={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},wh={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},xh={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function Sh(e){let t=e instanceof Ht?e:"string"==typeof e?Kt(e):ci.normal;if(t===ci.normal)return wh;if(t===ci.auto)return xh;let i=t instanceof ri?t.values:[t],n=Object.create(wh);for(let e of i)if(e instanceof Yt)switch(e.name){case"trim-both":case"trim-auto":return xh;case"space-all":return yh;case"trim-start":n.trimStart=!0,n.spaceFirst=!1;break;case"space-start":n.trimStart=!1,n.spaceFirst=!1;break;case"space-first":n.trimStart=!1,n.spaceFirst=!0;break;case"trim-end":n.trimEnd=!0,n.allowEnd=!1;break;case"space-end":n.trimEnd=!1,n.allowEnd=!1;break;case"allow-end":n.trimEnd=!1,n.allowEnd=!0;break;case"trim-adjacent":n.trimAdjacent=!0;break;case"space-adjacent":n.trimAdjacent=!1}return n}var Ch={ideographAlpha:!1,ideographNumeric:!1},kh={ideographAlpha:!0,ideographNumeric:!0};function Eh(e){let t=e instanceof Ht?e:"string"==typeof e?Kt(e):ci.normal;if(t===ci.normal||t===ci.auto)return kh;if(t===ci.none)return Ch;let i=t instanceof ri?t.values:[t],n=Object.create(Ch);for(let e of i)if(e instanceof Yt)switch(e.name){case"no-autospace":return Ch;case"ideograph-alpha":n.ideographAlpha=!0;break;case"ideograph-numeric":n.ideographNumeric=!0}return n}function Ph(e,t){return!(e.ideographAlpha||e.ideographNumeric||t.trimStart||t.spaceFirst||t.trimEnd||t.allowEnd||t.trimAdjacent)}function Nh(e){return e?(e=e.toLowerCase(),/^zh\b.*-(hant|tw|hk)\b/.test(e)?"zh-hant":/^zh\b/.test(e)?"zh-hans":/^ja\b/.test(e)?"ja":/^ko\b/.test(e)?"ko":e):null}var Th=new class{getPolyfilledInheritedProps(){return["hanging-punctuation","text-autospace","text-spacing-trim"]}preprocessSingleDocument(e){e.body&&this.preprocessForTextSpacing(e.body)}preprocessForTextSpacing(e){var t;let i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);for(let e=i.nextNode();e;e=i.nextNode()){if("http://www.w3.org/1999/xhtml"!==e.parentElement.namespaceURI||"true"===(null==(t=e.parentElement.dataset)?void 0:t.mathTypeset))continue;let i=e.textContent.replace(/(?![()\[\]{}])[\p{Ps}\p{Pe}\p{Pf}\p{Pi}\u3000]\p{M}*(?=\P{M})|.(?=(?![()\[\]{}])[\p{Ps}\p{Pe}\p{Pf}\p{Pi}\u3000])|(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]\p{M}*(?=(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])[\p{L}\p{Nd}])|(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])[\p{L}\p{Nd}]\p{M}*(?=(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF])/gsu,"$&\0").split("\0");if(i.length>1){let t=i.length-1;for(let n=0;n<t;n++)e.parentNode.insertBefore(document.createTextNode(i[n]),e);e.textContent=i[t]}}}processGeneratedContent(e,t,i,n,r,o){r=Nh(r);let s=Eh(t),a=Sh(i),l=bh(n);if(vh(l)&&Ph(s,a))return;this.preprocessForTextSpacing(e);let h=e.style.whiteSpace;0===(o?e.offsetHeight:e.offsetWidth)&&(e.style.whiteSpace="pre");let u=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),c=null,d=null;for(let e=u.nextNode();e;e=d){d=u.nextNode();let t=!c,i=!c||/\n$/.test(c.textContent),n=!d||/^\n/.test(d.textContent),h=!d;this.processTextSpacing(e,t||i,t,i,n,h,c,d,s,a,l,r,o),c=e}e.style.whiteSpace=h}postLayoutBlock(e,t){var i,n,r,o,s,a,l;let h=!e||1===e.fragmentIndex&&function(){let e=t[0];for(let t=e;;t=t.parent)if(!t||!t.inline){if(1!==(null==t?void 0:t.fragmentIndex))return!1;break}if(!e.inline)return!0;for(let t=e.viewNode.previousSibling;t;t=t.previousSibling)if(!Mo(t,e.whitespace)&&!c(t))return!1;return!0}(),u=h||function(){var e,i;let n,r=t[0];for(;r&&r.inline&&(n=null==(e=r.viewNode)?void 0:e.previousSibling,!n||(3===n.nodeType&&/^[ \t\r\n\f]*$/.test(n.textContent)&&r.whitespace!==Oo.PRESERVE&&(n=n.previousSibling),!n));)r=r.parent;for(;n;){if(1===n.nodeType){if("br"===n.localName)return!0;let e=null==(i=n.style)?void 0:i.display;if(e&&"inline"!==e)return!/^(inline|ruby)\b/.test(e)}else if(3===n.nodeType)if(r.whitespace===Oo.PRESERVE){if(/\n$/.test(n.textContent))return!0}else if(r.whitespace===Oo.NEWLINE&&/\n[ \t\r\n\f]*$/.test(n.textContent))return!0;n=n.lastChild}return!1}();function c(e){var t;if(1!==(null==e?void 0:e.nodeType))return!1;let i=e;if(i.hasAttribute(Hs))return!0;let{position:n,float:r}=null!=(t=i.style)?t:{};return"absolute"===n||"fixed"===n||r&&"none"!==r}let d=-1;for(let p=0;p<t.length;p++){let f=t[p];if(!f.after&&f.inline&&!f.display&&f.parent&&f.viewNode.parentNode&&f.viewNode.nodeType===Node.TEXT_NODE&&!Mo(f.viewNode,f.whitespace)){let g=function(e){var t,i,n;if(1===(null==(t=e.viewNode)?void 0:t.nodeType))return"br"===e.viewNode.localName;if(3===(null==(i=e.viewNode)?void 0:i.nodeType)){if(e.whitespace===Oo.PRESERVE){if(/\n$/.test(e.viewNode.textContent))return!0}else if(e.whitespace===Oo.NEWLINE&&/\n[ \t\r\n\f]*$/.test(e.viewNode.textContent))return!0;if("br"===(null==(n=e.viewNode.previousElementSibling)?void 0:n.localName))return Mo(e.viewNode,e.whitespace)}return!1},m=function(e){var t,i,n;if(1===(null==(t=e.viewNode)?void 0:t.nodeType))return"br"===e.viewNode.localName;if(3===(null==(i=e.viewNode)?void 0:i.nodeType)){if(e.whitespace===Oo.PRESERVE){if(/^\n/.test(e.viewNode.textContent))return!0}else if(e.whitespace===Oo.NEWLINE&&/^[ \t\r\n\f]*\n/.test(e.viewNode.textContent))return!0;if("br"===(null==(n=e.viewNode.nextElementSibling)?void 0:n.localName))return Mo(e.viewNode,e.whitespace)}return!1},b=Nh(null!=(o=null!=(n=null!=(i=f.lang)?i:f.parent.lang)?n:null==e?void 0:e.lang)?o:null==(r=null==e?void 0:e.parent)?void 0:r.lang),v=Eh(f.inheritedProps["text-autospace"]),y=Sh(f.inheritedProps["text-spacing-trim"]),w=bh(f.inheritedProps["hanging-punctuation"]);if(vh(w)&&Ph(v,y)||/\b(flex|grid)\b/.test(f.parent.display))continue;d<0&&(d=p);let x=null,S=null,C=p===d,k=p===d&&h,E=p===d&&u,P=!1,N=!1;for(let e=p-1;e>=0;e--){let i=t[e];if(g(i)){E=!0;break}if(!i.display&&i.viewNode.nodeType===Node.TEXT_NODE&&i.viewNode.textContent.length>0){x=i.viewNode;break}if(i.display&&!/^(inline|ruby)\b/.test(i.display)||1===(null==(s=i.viewNode)?void 0:s.nodeType)&&("br"===i.viewNode.localName||Te[i.viewNode.localName]))break;0===e&&(C=!0,h&&(k=!0,E=!0))}for(let e=p+1;e<t.length;e++){let i=t[e];if(m(i)){P=!0;break}if(i.viewNode!==f.viewNode&&!i.display&&i.viewNode.nodeType===Node.TEXT_NODE&&i.viewNode.textContent.length>0){S=i.viewNode;break}if(i.display&&!/^(inline|ruby)\b/.test(i.display)||1===(null==(a=i.viewNode)?void 0:a.nodeType)&&("br"===i.viewNode.localName||Te[i.viewNode.localName])){e===t.length-1&&c(i.viewNode)&&(N=!0);break}if(e===t.length-1){P=!0,N=!0;for(let e=i.viewNode.nextSibling;e;e=e.nextSibling)if(!c(e)){N=!1;break}}}if("inline-block"===(null==(l=f.parent)?void 0:l.display)){if(!k){let e=f.parent.viewNode.firstChild;for(;Mo(e,f.whitespace);)e=e.nextSibling;f.viewNode===e&&(k=!0)}if(!N){let e=f.parent.viewNode.lastChild;for(;Mo(e,f.whitespace);)e=e.previousSibling;f.viewNode===e&&(N=!0)}}if(this.processTextSpacing(f.viewNode,C,k,E,P,N,x,S,v,y,w,b,f.vertical)>0)break}}}processTextSpacing(e,t,i,n,r,o,s,a,l,h,u,c,d){let p,f,g,m=e.textContent,b=e.ownerDocument,v=0;function y(){if(t)return!0;if(!s)return!1;p||(p=b.createRange(),p.selectNode(e));let i=p.getClientRects()[0];if(!i)return!1;f||(f=b.createRange(),f.selectNode(s));let n=f.getClientRects(),r=n[n.length-1];return!!r&&(v||(v=Rs(r,d)),d?i.top<r.top+r.height-i.width||i.left+i.width<r.left+i.width/10||i.left>r.left+r.width-i.width/10:i.left<r.left+r.width-i.height||i.top>r.top+r.height-i.height/10||i.top+i.height<r.top+i.height/10)}function w(){if(!a)return!1;p||(p=b.createRange(),p.selectNode(e));let t=p.getClientRects()[0];if(!t)return!1;v||(v=Rs(t,d)),g||(g=b.createRange(),g.selectNode(a));let i=g.getClientRects()[0];return!!i&&(d?t.top+t.height>i.top+t.width||t.left>i.left+i.width-t.width/10||t.left+t.width<i.left+t.width/10:t.left+t.width>i.left+t.height||t.top+t.height<i.top+t.height/10||t.top>i.top+i.height-t.height/10)}let x,S=!1,C=!1,k=!1,E=!1;if(i&&u.first&&/^[\p{Ps}\p{Pf}\p{Pi}'"\u3000]\p{M}*$/u.test(m)?(x="viv-ts-open",S=!0,C=!0):o&&u.last&&/^[\p{Pe}\p{Pf}\p{Pi}'"]\p{M}*$/u.test(m)?(x="viv-ts-close",S=!0,k=!0):(u.forceEnd||u.allowEnd)&&/^[]\p{M}*$/u.test(m)?(x="viv-ts-close",S=!0,E=!0):(h.trimStart||h.spaceFirst||h.trimAdjacent)&&/^[]\p{M}*$/u.test(m)?(x="viv-ts-open",S=!0):(h.trimEnd||h.allowEnd||h.trimAdjacent)&&(/^[]\p{M}*$/u.test(m)||"zh-hans"===c&&/^[]\p{M}*$/u.test(m)||"zh-hant"!==c&&/^[]\p{M}*$/u.test(m))&&(x="viv-ts-close",S=!0),S){let t=function(e){let t=.7*parseFloat(b.defaultView.getComputedStyle(e).fontSize);return(d?e.offsetHeight:e.offsetWidth)>t},l=function(){return d?c.offsetLeft:c.offsetTop};if("viv-ts-inner"===e.parentElement.localName)return 0;let c=b.createElement(x),p=b.createElement("viv-ts-inner");c.appendChild(p),e.parentNode.insertBefore(c,e),p.appendChild(e);let f=t(p);if(f||C||k||E)if("viv-ts-open"===x)if(C)c.className="viv-hang-first";else if(i||n)h.trimStart?c.className="viv-ts-trim":c.className="viv-ts-space";else if(h.trimStart||h.spaceFirst||!y()){if(h.trimAdjacent&&s&&/[\p{Ps}\p{Pi}\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]\p{M}*$/u.test(s.textContent)&&(!/[\p{Pe}\p{Pf}]\p{M}*$/u.test(s.textContent)||"viv-ts-inner"===s.parentElement.localName&&t(s.parentElement)))c.className="viv-ts-trim";else if((h.trimStart||h.spaceFirst)&&y()){let e=l();c.className="viv-ts-auto",e===l()&&!y()&&(c.className="viv-ts-trim")}}else c.className="viv-ts-space";else if("viv-ts-close"===x)if(k)c.className=f?"viv-hang-last":"viv-hang-last viv-hang-hw";else if(o||r){let e=l();E?(c.className=f?u.allowEnd&&h.allowEnd?"viv-ts-auto":"viv-hang-end":"viv-hang-end viv-hang-hw",u.allowEnd&&e===l()&&(h.trimEnd?c.className="viv-ts-trim":h.allowEnd?(c.className="viv-hang-end",e===l()&&(c.className="")):c.className="viv-ts-space")):h.trimEnd?c.className="viv-ts-trim":h.allowEnd?(c.className="viv-ts-auto",e===l()&&(c.className="")):c.className="viv-ts-space"}else if(a&&/^[\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]/u.test(a.textContent))f&&h.trimAdjacent&&(c.className="viv-ts-trim");else if(E){let e=w(),t=e&&u.allowEnd;t||(c.className=f?"viv-hang-end":"viv-hang-end viv-hang-hw"),f?t&&h.trimEnd?c.className="viv-ts-auto":t||w()?!e&&u.allowEnd&&(h.trimEnd?(c.className="viv-ts-auto",w()||(c.className="viv-hang-end")):(c.className="viv-ts-space",w()||(h.allowEnd?(c.className="viv-ts-auto",w()||(c.className="viv-hang-end")):c.className="viv-hang-end"))):c.className="":!e&&!w()&&(c.className="")}else if(h.trimEnd||h.allowEnd)if(w())h.allowEnd?c.className="viv-ts-space":c.className="viv-ts-auto";else{let e=l();c.className="viv-ts-auto",e===l()&&(c.className="")}}function P(e){var t;let i=null==(t=null==e?void 0:e.ownerDocument.defaultView)?void 0:t.getComputedStyle(e);return!!i&&("upright"===i.textOrientation||"all"===i.textCombineUpright||"horizontal"===i["-webkit-text-combine"])}function N(e,t){if(1===e.nodeType){let t=b.defaultView.getComputedStyle(e);if(parseFloat(t.marginInlineEnd)||parseFloat(t.borderInlineEndWidth)||parseFloat(t.paddingInlineEnd))return!0}let i=e.parentElement;if(i&&!i.contains(t))return N(i,t);if(1===t.nodeType){let e=b.defaultView.getComputedStyle(t);if(parseFloat(e.marginInlineStart)||parseFloat(e.borderInlineStartWidth)||parseFloat(e.paddingInlineStart))return!0}let n=t.parentElement;return!(!n||n.contains(e))&&N(e,n)}return(l.ideographAlpha||l.ideographNumeric)&&(s&&/^(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]/u.test(m)&&(l.ideographAlpha&&/(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])\p{L}\p{M}*$/u.test(s.textContent)||l.ideographNumeric&&/(?![\uFF01-\uFF60])\p{Nd}\p{M}*$/u.test(s.textContent))&&!(d&&P(s.parentElement))&&!N(s,e)&&e.parentNode.insertBefore(b.createElement("viv-ts-thin-sp"),e),a&&/(?!\p{P})[\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF]\p{M}*$/u.test(m)&&(l.ideographAlpha&&/^(?![\p{sc=Han}\u3041-\u30FF\u31C0-\u31FF\uFF01-\uFF60])\p{L}/u.test(a.textContent)||l.ideographNumeric&&/^(?![\uFF01-\uFF60])\p{Nd}/u.test(a.textContent))&&!(d&&P(a.parentElement))&&!N(e,a)&&e.parentNode.insertBefore(b.createElement("viv-ts-thin-sp"),e.nextSibling)),v}registerHooks(){O("POLYFILLED_INHERITED_PROPS",this.getPolyfilledInheritedProps.bind(this)),O("PREPROCESS_SINGLE_DOCUMENT",this.preprocessSingleDocument.bind(this)),O("POST_LAYOUT_BLOCK",this.postLayoutBlock.bind(this),!0)}};Th.registerHooks();var Ih=(new DOMParser).parseFromString('<root xmlns="http://www.pyroxy.com/ns/shadow"/>',"text/xml"),Ah=["footnote-marker","marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],_h="data-adapt-pseudo";function Rh(e){return e.getAttribute(_h)||""}function Lh(e,t){e.setAttribute(_h,t)}var Fh=class{constructor(e,t,i,n,r){this.element=e,this.style=t,this.styler=i,this.context=n,this.exprContentListener=r,h(this,"contentProcessed",{})}getStyle(e,t){let i=Rh(e);this.styler&&i&&i.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let n=Ma(this.style,"_pseudos"),r=(null==n?void 0:n[i])||{};if(i.match(/^first-/)&&!r["x-first-pseudo"]){let e,t=1;"first-letter"==i?t=0:null!=(e=i.match(/^first-([0-9]+)-lines$/))&&(t=e[1]-0),r["x-first-pseudo"]=new Pa(new Qt(t),0)}return r}processContent(e,t,i){let n=Rh(e);if(!this.contentProcessed[n]){this.contentProcessed[n]=!0,"marker"===n&&this.processMarker(e,t,i);let r=t.content;ns(r)&&(r.visit(new is(e.classList.contains("_viv-marker-outside")&&e.firstElementChild||e,this.context,r,this.exprContentListener)),function(e){Th.preprocessForTextSpacing(e)}(e))}}processMarker(e,t,i){let n=t.content,r=t["list-style-position"],o=t["list-style-type"];if(ns(n))if(n instanceof ti)t.content=new ri([n]);else if(n instanceof qt&&o instanceof Yt){let n=o.name.toLowerCase();if(("disc"===n||"circle"===n||"square"===n||"disclosure-open"===n||"disclosure-closed"===n)&&(e.classList.add("_viv-marker-bullet"),"disclosure-open"===n||"disclosure-closed"===n)){let e="rtl"===i.direction,r=i.vertical;t.content=new qt("disclosure-open"===n?r?" ":" ":r?e?" ":" ":e?" ":" ")}}if(r===ci.outside){e.classList.add("_viv-marker-outside");let n=e.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","span");n.classList.add("_viv-marker-outside-content"),e.appendChild(n);let r=i.inheritedProps["text-spacing-trim"];r&&"space-all"!==r&&(t["text-spacing-trim"]=ci.normal),i.inheritedProps["hanging-punctuation"]&&(t["hanging-punctuation"]=ci.none)}delete t["list-style-position"],delete t["list-style-type"]}};xo.isInstanceOfAfterIfContinuesLayoutConstraint;var Oh=ca.registerFragmentIndex;ca.clearFragmentIndices;var Bh=class{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){let i=t.viewNode.ownerDocument.createElement("div"),n=new jh(e,i,t),r=n.getColumn().pageBreakType;return n.getColumn().pageBreakType=null,n.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed["after-if-continues"]=!1,n.getColumn().pageBreakType=r;let e=i.firstChild;return ce(e,"display","block"),qn(e)})}createNodePositionForPseudoElement(){let e=Ih.createElementNS("http://www.w3.org/1999/xhtml","div");Lh(e,"after-if-continues");let t=this.createShadowContext(e),i={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new Zo(i)}createShadowContext(e){return new qo(this.sourceNode,e,null,null,null,ko.ShadowType.ROOTED,this.styler)}},Mh=class e{constructor(e,t,i){this.nodeContext=e,this.afterIfContinues=t,this.pseudoElementHeight=i,h(this,"flagmentLayoutConstraintType","AfterIfContinue")}allowLayout(e,t,i){return!(t&&!e||e&&e.overflow)}nextCandidate(e){return!1}postLayout(e,t,i,n){}finishBreak(e,t){return this.getRepetitiveElements().affectTo(e)?this.afterIfContinues.createElement(t,this.nodeContext).thenAsync(e=>(this.nodeContext.viewNode.appendChild(e),qn(!0))):qn(!0)}getRepetitiveElements(){return new zh(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof e&&this.afterIfContinues==t.afterIfContinues}getPriorityOfFinishBreak(){return 9}},zh=class{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;let t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let e=t.parentNode;e;e=e.parentNode)if(e===this.nodeContext.sourceNode)return!0;return!1}};function Dh(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return qn(e);let i=e.afterIfContinues;return i.createElement(t,e).thenAsync(n=>{let r=function(e,t,i){let n=e.viewNode;n.appendChild(i);let r=Ds(i,t,e.vertical);return n.removeChild(i),r}(e,t,n);return t.fragmentLayoutConstraints.push(new Mh(e,i,r)),qn(e)})}function Vh(e,t){return e.thenAsync(e=>Dh(e,t))}var Uh=class{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every(t=>t.allowLayout(e))}},Hh=class extends Xs{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,h(this,"alreadyEvaluated",!1),h(this,"breakNodeContext",null)}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!!this.breakNodeContext||t>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}},$h=class e extends ts{constructor(t,i,n,r,o){super(t),this.layoutContext=i,this.clientLayout=n,this.layoutConstraint=r,this.pageFloatLayoutContext=o,h(this,"last"),h(this,"viewDocument"),h(this,"flowRootFormattingContext",null),h(this,"isFloat",!1),h(this,"isFootnote",!1),h(this,"startEdge",0),h(this,"endEdge",0),h(this,"beforeEdge",0),h(this,"afterEdge",0),h(this,"footnoteEdge",0),h(this,"box",null),h(this,"chunkPositions",null),h(this,"bands",null),h(this,"overflown",!1),h(this,"breakPositions",null),h(this,"pageBreakType",null),h(this,"forceNonfitting",!0),h(this,"leftFloatEdge",0),h(this,"rightFloatEdge",0),h(this,"bottommostFloatTop",0),h(this,"stopAtOverflow",!0),h(this,"lastAfterPosition",null),h(this,"fragmentLayoutConstraints",[]),h(this,"pseudoParent",null),h(this,"nodeContextOverflowingDueToRepetitiveElements",null),h(this,"blockDistanceToBlockEndFloats",NaN),h(this,"breakAtTheEdgeBeforeFloat",null),new.target===e&&function(e){e.element.setAttribute("data-vivliostyle-column","true")}(this),this.last=t.lastChild,this.viewDocument=t.ownerDocument,o.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!(!e.floatSide||this.isFloat&&!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let t=Gn("openAllViews"),i=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let n=i.length-1,r=null;return t.loop(()=>{for(;n>=0;){let t=r,o=i[n];if(r=Wo(o,t),n===i.length-1&&!r.formattingContext&&(r.formattingContext=this.flowRootFormattingContext),0==n&&(r.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;let s=this.layoutContext.setCurrent(r,0==n&&0==r.offsetInNode);if(n--,s.isPending())return s}return qn(!1)}).then(()=>{t.finish(r)}),t.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?function(e,t){return No(e,t,1)}(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){var i,n;if(e.firstPseudo&&e.inline&&!e.after&&0==e.firstPseudo.count&&1!=e.viewNode.nodeType){let t=e.viewNode.textContent,r=t.match(Y),o=r?r[0].length:0;if(!r&&3===(null==(i=e.sourceNode)?void 0:i.nodeType)&&3===(null==(n=e.sourceNode.nextSibling)?void 0:n.nodeType)&&t===e.sourceNode.textContent){let i=t+e.sourceNode.nextSibling.textContent,n=i.match(Y);if(n){let t=n[0];o=t.length,e.sourceNode.textContent=t,e.viewNode.textContent=t,e.sourceNode.nextSibling.textContent=i.substr(o)}}return this.layoutContext.peelOff(e,o)}return qn(e)}buildViewToNextBlockEdge(e,t){let i=!1,n=Gn("buildViewToNextBlockEdge");return n.loopWithFrame(n=>{var r;if(e.viewNode&&!Ws(e)&&"http://www.w3.org/1999/xhtml"===(null==(r=e.viewNode.parentElement)?void 0:r.namespaceURI)&&(t.push(e.copy()),t.length>1e3)){let t=1===e.viewNode.nodeType?e.viewNode:e.viewNode.parentElement;if(Rs(this.clientLayout.getElementClientRect(t),this.vertical)>=2)return void n.breakLoop()}this.maybePeelOff(e,0).then(r=>{r!==e&&(Ws(e=r)||t.push(e.copy())),this.nextInTree(e).then(t=>{(e=t)?((i||!this.layoutConstraint.allowLayout(e))&&(i=!0,(e=e.modify()).overflow=!0),this.isFloatNodeContext(e)&&(os(e.floatReference)||"footnote"===e.floatSide)?this.layoutFloatOrFootnote(e).then(t=>{e=t,this.pageFloatLayoutContext.isInvalidated()&&(e=null),e?n.continueLoop():n.breakLoop()}):e.inline?n.continueLoop():n.breakLoop()):n.breakLoop()})})}).then(()=>{n.finish(e)}),n.result()}nextInTree(e,t){return Vh(this.layoutContext.nextInTree(e,t),this)}buildDeepElementView(e){if(!e.viewNode)return qn(e);let t=[],i=e.sourceNode,n=Gn("buildDeepElementView");return n.loopWithFrame(n=>{e.viewNode&&e.inline&&!Ws(e)?t.push(e.copy()):(t.length>0&&this.postLayoutBlock(e,t),t=[]),this.maybePeelOff(e,0).then(r=>{let o=r;if(o!==e){let r=o;for(;r&&r.sourceNode!=i;)r=r.parent;if(null==r)return e=o,void n.breakLoop();Ws(o)||t.push(o.copy())}this.nextInTree(o).then(t=>{(e=t)&&e.sourceNode!=i?this.layoutConstraint.allowLayout(e)?n.continueLoop():((e=e.modify()).overflow=!0,this.stopAtOverflow?n.breakLoop():n.continueLoop()):n.breakLoop()})})}).then(()=>{t.length>0&&this.postLayoutBlock(e,t),n.finish(e)}),n.result()}createFloat(e,t,i,n){let r=this.viewDocument.createElement("div");return this.vertical?(n>=this.height&&(n-=.1),n<1&&(n=0),ce(r,"height",`${i}px`),ce(r,"width",`${n}px`)):(i>=this.width&&(i-=.1),i<1&&(i=0),ce(r,"width",`${i}px`),ce(r,"height",`${n}px`)),ce(r,"float",t),ce(r,"clear",t),this.element.insertBefore(r,e),r}killFloats(){let e=this.element.firstChild;for(;e;){let t=e.nextSibling;if(1==e.nodeType){let t=e,i=t.style.cssFloat;if("left"!=i&&"right"!=i&&"none"!==i)break;this.element.removeChild(t)}e=t}}createFloats(){let e=this.element.firstChild,t=this.bands,i=this.vertical?this.getTopEdge():this.getLeftEdge(),n=this.vertical?this.getBottomEdge():this.getRightEdge(),r=null;for(let o of t){let t=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-i,t),o.right=this.createFloat(e,"right",n-o.x2,t),o.x1<n&&o.x2>i?r=o:r||ce(o.right,"float","none")}if(r){let e=t[t.length-1],i=this.vertical?-this.getLeftEdge():this.getBottomEdge();r!==e&&e.y2>=i&&(this.footnoteEdge=this.vertical?-r.y2:r.y2)}}calculateEdge(e,t,i,n){let r;if(e&&Vs(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(r=zs(e,this.clientLayout,0,this.vertical),!isNaN(r)))return r;let o=n-(e=t[i]).boxOffset;for(;;){if(r=zs(e,this.clientLayout,o,this.vertical),!isNaN(r))return r;if(o>0)o--;else{if(--i<0)return this.beforeEdge;1!=(e=t[i]).viewNode.nodeType&&(o=e.viewNode.textContent.length)}}}parseComputedLength(e){let t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?this.clientLayout.adjustLengthValue(parseFloat(t[0])):0}getComputedMargin(e){let t=this.clientLayout.getElementComputedStyle(e),i=new Si(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.marginLeft),i.top=this.parseComputedLength(t.marginTop),i.right=this.parseComputedLength(t.marginRight),i.bottom=this.parseComputedLength(t.marginBottom)),i}getComputedPaddingBorder(e){let t=this.clientLayout.getElementComputedStyle(e),i=new Si(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),i}getComputedInsets(e){let t=this.clientLayout.getElementComputedStyle(e),i=new Si(0,0,0,0);if(t){if("border-box"==t.boxSizing)return this.getComputedMargin(e);i.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return i}setComputedInsets(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.marginLeft=this.parseComputedLength(i.marginLeft),t.borderLeft=this.parseComputedLength(i.borderLeftWidth),t.paddingLeft=this.parseComputedLength(i.paddingLeft),t.marginTop=this.parseComputedLength(i.marginTop),t.borderTop=this.parseComputedLength(i.borderTopWidth),t.paddingTop=this.parseComputedLength(i.paddingTop),t.marginRight=this.parseComputedLength(i.marginRight),t.borderRight=this.parseComputedLength(i.borderRightWidth),t.paddingRight=this.parseComputedLength(i.paddingRight),t.marginBottom=this.parseComputedLength(i.marginBottom),t.borderBottom=this.parseComputedLength(i.borderBottomWidth),t.paddingBottom=this.parseComputedLength(i.paddingBottom))}setComputedWidthAndHeight(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.width=this.parseComputedLength(i.width),t.height=this.parseComputedLength(i.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let t=Gn("layoutFloat"),i=e.viewNode,n=ss(e.floatSide,e.vertical,e.direction,this.layoutContext.page.side);return ce(i,"float","none"),ce(i,"display","inline-block"),ce(i,"vertical-align","top"),this.buildDeepElementView(e).then(r=>{let o=Os(this.clientLayout,i,this.vertical),s=this.getComputedMargin(i),a=new wi(o.left-s.left,o.top-s.top,o.right+s.right,o.bottom+s.bottom),l=this.rtl?this.endEdge:this.startEdge,h=this.rtl?this.startEdge:this.endEdge,u=e.parent;for(;u&&u.inline;)u=u.parent;if(u){let t=u.viewNode.ownerDocument.createElement("div");t.style.left="0px",t.style.top="0px",this.vertical?(t.style.bottom="0px",t.style.width="1px"):(t.style.right="0px",t.style.height="1px"),u.viewNode.appendChild(t);let r=Os(this.clientLayout,t,this.vertical);l=Math.max(this.rtl?this.getEndEdge(r):this.getStartEdge(r),l),h=Math.min(this.rtl?this.getStartEdge(r):this.getEndEdge(r),h),u.viewNode.removeChild(t);let o=this.vertical?a.y2-a.y1:a.x2-a.x1;"left"==n?h=Math.max(h,l+o):l=Math.min(l,h-o),u!==e.parent&&!e.firstPseudo&&(u.viewNode.appendChild(i),i.setAttribute("data-vivliostyle-float-box-moved","true"))}let c=new wi(l,this.getBoxDir()*this.beforeEdge,h,this.getBoxDir()*this.afterEdge),d=a;this.vertical&&(d=Oi(a));let p=this.getBoxDir();if(d.y1<this.bottommostFloatTop*p){let e=d.y2-d.y1;d.y1=this.bottommostFloatTop*p,d.y2=d.y1+e}(function(e,t,i,n){let r=i.y1,o=i.x2-i.x1,s=i.y2-i.y1,a=Di(t,r);for(;;){let l=r+s;if(l>e.y2)return!1;let h=e.x1,u=e.x2;for(let e=a;e<t.length&&t[e].y1<l;e++){let i=t[e];i.x1>h&&(h=i.x1),i.x2<u&&(u=i.x2)}if(h+o<=u||a>=t.length)return"left"==n?(i.x1=h,i.x2=h+o):(i.x1=u-o,i.x2=u),i.y2+=r-i.y1,i.y1=r,!0;r=t[a].y2,a++}})(c,this.bands,d,n),this.vertical&&(a=Bi(d));let f=this.getComputedInsets(i);ce(i,"width",a.x2-a.x1-f.left-f.right+"px"),ce(i,"height",a.y2-a.y1-f.top-f.bottom+"px"),ce(i,"position","absolute"),e.display,ce(i,"display",e.display);let g,m=null;if(u&&(m=u.containingBlockForAbsolute?u:u.getContainingBlockForAbsolute()),m){let e=m.viewNode.ownerDocument.createElement("div");e.style.position="absolute",m.vertical?e.style.right="0":e.style.left="0",e.style.top="0",m.viewNode.appendChild(e),g=Os(this.clientLayout,e,this.vertical),m.viewNode.removeChild(e)}else g={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(m?m.vertical:this.vertical)?ce(i,"right",g.right-a.x2+"px"):ce(i,"left",a.x1-g.left+"px"),ce(i,"top",a.y1-g.top+"px"),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let b=this.vertical?a.x1:a.y2,v=this.vertical?a.x2:a.y1;this.isOverflown(b)&&0!=this.breakPositions.length?((e=e.modify()).overflow=!0,t.finish(e)):(this.killFloats(),c=new wi(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(c=Oi(c)),function(e,t,i,n,r){for(n||(n=[new ki(i.y1,i.y2,i.x1,i.x2)]);n.length>0&&n[0].y2<=e.y1;)n.shift();if(0==n.length)return;n[0].y1<e.y1&&(n[0].y1=e.y1);let o,s=0==t.length?e.y1:t[t.length-1].y2;s<e.y2&&t.push(new ki(s,e.y2,e.x1,e.x2));let a=Di(t,n[0].y1);for(let i of n){if(a==t.length)break;for(t[a].y1<i.y1&&(o=t[a],a++,t.splice(a,0,new ki(i.y1,o.y2,o.x1,o.x2)),o.y2=i.y1);a<t.length&&(o=t[a++],o.y2>i.y2&&(t.splice(a,0,new ki(i.y2,o.y2,o.x1,o.x2)),o.y2=i.y2),i.x1!=i.x2&&("left"==r?o.x1=Math.min(i.x2,e.x2):o.x2=Math.max(i.x1,e.x1)),o.y2!=i.y2););}zi(e,t)}(c,this.bands,d,null,n),this.createFloats(),"left"==n?this.leftFloatEdge=b:this.rightFloatEdge=b,this.bottommostFloatTop=v,this.updateMaxReachedAfterEdge(b),t.finish(r))}),t.result()}setupFloatArea(e,t,i,n,r,o){let s=this.pageFloatLayoutContext,a=s.getContainer(t),l=e.element;a.element.parentNode.appendChild(l),e.isFloat=!0,e.originX=a.originX,e.originY=a.originY,e.vertical=a.vertical,e.rtl=a.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(a.exclusions||[]).concat(),e.forceNonfitting=!s.hasFloatFragments(),e.innerShape=null;let h=a.getPaddingRect();e.setHorizontalPosition(h.x1-a.originX,h.x2-h.x1),e.setVerticalPosition(h.y1-a.originY,h.y2-h.y1),r.adjustPageFloatArea(e,a,this),e.init();let u=!!s.setFloatAreaDimensions(e,t,i,n,!0,!s.hasFloatFragments(),o);return u?(e.killFloats(),e.init()):a.element.parentNode.removeChild(l),u}createPageFloatArea(e,t,i,n,r){let o=this.element.ownerDocument.createElement("div");ce(o,"position","absolute");let s=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),a=new cs(null,rs.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),l=s.getContainer(),h=new Yh(t,o,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,a,l);return a.setContainer(h),this.setupFloatArea(h,e.floatReference,t,i,n,r)?h:null}layoutSinglePageFloatFragment(e,t,i,n,r,o,s){let a=this.pageFloatLayoutContext,l=(e=(s?s.continuations:[]).concat(e))[0].float,h=a.getPageFloatPlacementCondition(l,t,i),u=this.createPageFloatArea(l,t,o,r,h),c={floatArea:u,pageFloatFragment:null,newPosition:null};if(!u)return qn(c);let d=Gn("layoutSinglePageFloatFragment"),p=!1,f=0;return d.loopWithFrame(t=>{if(f>=e.length)return void t.breakLoop();let i=e[f],r=new Zo(i.nodePosition);u.layout(r,!0).then(e=>{c.newPosition=e,!e||n?(f++,t.continueLoop()):(p=!0,t.breakLoop())})}).then(()=>{if(!p){let s=a.setFloatAreaDimensions(u,l.floatReference,t,o,!1,n,h);if(s){let t=r.createPageFloatFragment(e,s,i,u,!!c.newPosition);a.addPageFloatFragment(t,!0),c.pageFloatFragment=t}else p=!0}d.finish(c)}),d.result()}layoutPageFloatInner(e,t,i,n){let r=this.pageFloatLayoutContext,o=e.float;function s(t,i){i?r.removePageFloatFragment(i,!0):t&&t.element.parentNode.removeChild(t.element),r.restoreStashedFragments(o.floatReference),r.deferPageFloat(e)}r.stashEndFloatFragments(o);let a=Gn("layoutPageFloatInner");return this.layoutSinglePageFloatFragment([e],o.floatSide,o.clearSide,!r.hasFloatFragments(),t,i,n).then(e=>{let t=e.floatArea,i=e.pageFloatFragment,l=e.newPosition;i?this.layoutStashedPageFloats(o.floatReference,[n]).then(e=>{if(e){if(r.addPageFloatFragment(i),r.discardStashedFragments(o.floatReference),l){let e=new us(o,l.primary);r.deferPageFloat(e)}a.finish(!0)}else s(t,i),a.finish(!1)}):(s(t,i),a.finish(!1))}),a.result()}layoutStashedPageFloats(e,t){let i=this.pageFloatLayoutContext,n=i.getStashedFloatFragments(e),r=[],o=[],s=!1,a=Gn("layoutStashedPageFloats"),l=0;return a.loopWithFrame(e=>{if(l>=n.length)return void e.breakLoop();let i=n[l];if(t.includes(i))return l++,void e.continueLoop();let a=(new ps).findByFloat(i.continuations[0].float);this.layoutSinglePageFloatFragment(i.continuations,i.floatSide,i.clearSide,!1,a,null).then(t=>{let i=t.floatArea;i&&r.push(i);let n=t.pageFloatFragment;n?(o.push(n),l++,e.continueLoop()):(s=!0,e.breakLoop())})}).then(()=>{s?(o.forEach(e=>{i.removePageFloatFragment(e,!0)}),r.forEach(e=>{let t=e.element;t&&t.parentNode&&t.parentNode.removeChild(t)})):n.forEach(e=>{let t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)}),a.finish(!s)}),a.result()}setFloatAnchorViewNode(e){let t=e.viewNode.parentNode,i=t.ownerDocument.createElement("span");i.setAttribute(Hs,"1"),"footnote"===e.floatSide&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",i),t.appendChild(i),t.removeChild(e.viewNode);let n=e.modify();return n.after=!0,n.viewNode=i,n}resolveFloatReferenceFromColumnSpan(e,t,i){let n=Gn("resolveFloatReferenceFromColumnSpan"),r=this.pageFloatLayoutContext,o=r.getPageFloatLayoutContext(rs.REGION);return r.getContainer().width<o.getContainer().width&&e===rs.COLUMN?t===ci.auto?this.buildDeepElementView(i.copy()).then(t=>{let i=t.viewNode,r=ro(this.clientLayout,i,["min-content inline size"])["min-content inline size"],o=this.getComputedMargin(i);this.vertical?r+=o.top+o.bottom:r+=o.left+o.right,r>this.width?n.finish(rs.REGION):n.finish(e)}):t===ci.all?n.finish(rs.REGION):n.finish(e):n.finish(e),n.result()}layoutPageFloat(e){let t,i=this.pageFloatLayoutContext,n=(new ps).findByNodeContext(e),r=i.findPageFloatByNodePosition(e.toNodePosition());return t=r?qn(r):n.createPageFloat(e,i,this),t.thenAsync(t=>{let r=jo(e,0),o=this.setFloatAnchorViewNode(e),s=n.findPageFloatFragment(t,i),a=new us(t,r);if(s&&s.hasFloat(t))return i.registerPageFloatAnchor(t,o.viewNode),qn(o);if(i.isForbidden(t)||i.hasPrecedingFloatsDeferredToNext(t))return i.deferPageFloat(a),i.registerPageFloatAnchor(t,o.viewNode),qn(o);if(this.nodeContextOverflowingDueToRepetitiveElements)return qn(null);{let e=zs(o,this.clientLayout,0,this.vertical);return this.isOverflown(e)?qn(o):this.layoutPageFloatInner(a,n,e,s).thenAsync(e=>e?qn(null):(i.registerPageFloatAnchor(t,o.viewNode),qn(o)))}})}processLineStyling(e,t,i){let n=Gn("processLineStyling"),r=i.concat([]);i.splice(0,i.length);let o=0,s=e.firstPseudo;return 0==s.count&&(s=s.outer),n.loopWithFrame(i=>{if(!s)return void i.breakLoop();let n=this.findLinePositions(r),a=s.count-o;if(n.length<=a)return void i.breakLoop();let l=this.findAcceptableBreakInside(r,n[a-1],!0);null!=l?this.finishBreak(l,!1,!1).then(()=>{o+=a,this.layoutContext.peelOff(l,0).then(n=>{s=(e=n).firstPseudo,r=[],this.buildViewToNextBlockEdge(e,r).then(e=>{t=e,i.continueLoop()})})}):i.breakLoop()}).then(()=>{Array.prototype.push.apply(i,r),n.finish(t)}),n.result()}isLoneImage(e){return!(2!=e.length&&this.breakPositions.length>0)&&(e[0].sourceNode==e[1].sourceNode&&Te[e[0].sourceNode.localName])}getTrailingMarginEdgeAdjustment(e){let t=0,i=0;for(let n=e.length-1;n>=0;n--){let r=e[n];if(!r.after||!r.viewNode||1!=r.viewNode.nodeType)break;let o=this.getComputedMargin(r.viewNode),s=this.vertical?-o.left:o.bottom;s>0?t=Math.max(t,s):i=Math.min(i,s)}return t+i}layoutBreakableBlock(e){let t=Gn("layoutBreakableBlock"),i=[];return this.buildViewToNextBlockEdge(e,i).then(n=>{let r=i.length-1;if(r<0)return void t.finish(n);this.postLayoutBlock(n,i);let o,s=this.calculateEdge(n,i,r,i[r].boxOffset),a=!1;if(!n||!Vs(n.viewNode)){let e=Ys(n,this.collectElementsOffset());a=this.isOverflown(s+(this.vertical?-1:1)*e.minimum),this.isOverflown(s+(this.vertical?-1:1)*e.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=n)}null==n&&(s+=this.getTrailingMarginEdgeAdjustment(i)),this.updateMaxReachedAfterEdge(s),o=e.firstPseudo?this.processLineStyling(e,n,i):qn(n),o.then(e=>{i.length>0&&(this.saveBoxBreakPosition(i),a&&!this.isLoneImage(i)&&e&&((e=e.modify()).overflow=!0)),t.finish(e)})}),t.result()}postLayoutBlock(e,t){M("POST_LAYOUT_BLOCK").forEach(i=>{i(e,t,this)})}findEndOfLine(e,t,i){let n,r=this.vertical?e-1:e+1,o=0,s=t[0].boxOffset,a=o,l=t.length-1,h=t[l].boxOffset;for(;s<h;){n=s+Math.ceil((h-s)/2),a=o;let e=l;for(;a<e;){let i=a+Math.ceil((e-a)/2);t[i].boxOffset>n?e=i-1:a=i}let u=this.calculateEdge(null,t,a,n);if(this.vertical?u<=r:u>=r){for(h=n-1;t[a].boxOffset==n;)a--;l=a}else i&&this.updateMaxReachedAfterEdge(u),s=n,o=a}return{nodeContext:t[a],index:s,checkPointIndex:a}}findAcceptableBreakInside(e,t,i){var n,r,o;let s=this.findEndOfLine(t,e,!0),a=s.nodeContext;if(0===s.checkPointIndex&&s.index===a.boxOffset)return null;let l=a.viewNode;if(1!=l.nodeType&&"viv-ts-inner"!==(null==(n=l.parentElement)?void 0:n.localName)){let t=l;a=this.resolveTextNodeBreaker(a).breakTextNode(t,a,s.index,e,s.checkPointIndex,i)}else{let e=qs(a);if(e){if((null==(r=this.breakPositions)?void 0:r[0])instanceof Hh&&null!=e&&e.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode))return null;for(a=e;!a.after&&a.inline&&a.parent;){let e=null==(o=a.viewNode)?void 0:o.previousSibling;for(;e&&(Mo(e,a.parent.whitespace)||js(e));)e=e.previousSibling;if(e)break;a=a.parent}}}return this.clearOverflownViewNodes(a,!1),a}resolveTextNodeBreaker(e){return M("RESOLVE_TEXT_NODE_BREAKER").reduce((t,i)=>i(e)||t,Wh.instance)}getRangeBoxes(e,t){let i=[],n=e.ownerDocument.createRange(),r=!1,o=e,s=null,a=!1,l=!0;for(;l;){let e=!0;do{let i=null;o==t&&(l=1===t.nodeType&&!(!t.firstChild||r));let h=1===o.nodeType?o:null;h?r?r=!1:$s(h)?e=!a:!h.firstChild||Te[h.localName]||/^r(uby|[bt]c?)$/.test(h.localName)||Gs(this.clientLayout.getElementComputedStyle(h).display)?(e=!a,e?("ruby"===h.localName&&o.firstChild&&(o=o.firstChild),n.setStartBefore(o),a=!0,s=o):/^r(uby|tc?)$/.test(h.localName)||(s=o),o.contains(t)&&(l=!1)):i=o.firstChild:(a||(null==o.parentNode?l=!1:(n.setStartBefore(o),a=!0)),s=o),i||(i=o.nextSibling,i||(r=!0,i=o.parentNode)),o=i}while(e&&l);if(a){n.setEndAfter(s);let e=this.clientLayout.getRangeClientRects(n);Fs(e,this.vertical);for(let t=0;t<e.length;t++)i.push(e[t]);a=!1}}return i}findLinePositions(e){let t=[],i=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);i.sort(this.vertical?Uo:Vo);let n=0,r=0,o=0,s=0,a=0,l=this.getBoxDir();for(;;){if(a<i.length){let e=i[a],t=1;if(s>0){let i=Math.max(this.getBoxSize(e),1);t=l*this.getBeforeEdge(e)<l*n?l*(this.getAfterEdge(e)-n)/i:l*this.getAfterEdge(e)>l*r?l*(r-this.getBeforeEdge(e))/i:1}if(0==s||t>=.6||t>=.2&&this.getStartEdge(e)>=o-1){o=this.getEndEdge(e),this.vertical?(n=0==s?e.right:Math.max(n,e.right),r=0==s?e.left:Math.min(r,e.left)):(n=0==s?e.top:Math.min(n,e.top),r=0==s?e.bottom:Math.max(r,e.bottom)),s++,a++;continue}}if(s>0&&(t.push(r),s=0),a>=i.length)break}return t.sort(ke),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;for(let i=e;i;i=i.parent)if(!i.inline&&oo(i.viewNode)){let e=this.getComputedPaddingBorder(i.viewNode);t+=i.vertical?-e.left:e.bottom,"table"===i.display&&(t+=(i.vertical?-1:1)*i.blockBorderSpacing)}return t}getOffsetByRepetitiveElements(e){let t;return t=e?e.calculateOffset(this):Ys(null,this.collectElementsOffset()),t.current}findBoxBreakPosition(e,t){let i=this.element.parentNode,n=this.element.nextSibling;i.removeChild(this.element),i.insertBefore(this.element,n);let r,o,s=e.checkPoints,a=s[0];for(;a.parent&&a.inline;)a=a.parent;t?(r=1,o=1):(r=Math.max((a.inheritedProps.widows||2)-0,1),o=Math.max((a.inheritedProps.orphans||2)-0,1));let l=this.calculateClonedPaddingBorder(a),h=this.findLinePositions(s),u=this.footnoteEdge-l,c=this.getBoxDir(),d=this.getOffsetByRepetitiveElements(e);u-=c*d;let p=this.findFirstOverflowingEdgeAndCheckPoint(s);isNaN(p.edge)&&(p.edge=c*(1/0));let f=Ce(h.length,e=>{let t=h[e];return this.vertical?t<u||t<=p.edge:t>u||t>=p.edge}),g=f<=0;g&&(f=Ce(h.length,e=>this.vertical?h[e]<u:h[e]>u));let m,b=s[s.length-1].viewNode;if("viv-ts-inner"===(null==b?void 0:b.parentElement.localName)&&(b=b.parentElement.parentElement),(f===h.length&&b.nextSibling||f>=h.length-1&&b.parentElement.querySelector(".MJXc-display"))&&(r=0),f=Math.min(h.length-r,f),f<o)return null;if(u=h[f-1],m=g?p.checkPoint:this.findAcceptableBreakInside(e.checkPoints,u,t),m){let e=this.getAfterEdgeOfBlockContainer(m);!isNaN(e)&&c*(u-e)>0&&(u=e),this.computedBlockSize=c*(u-this.beforeEdge)+d}return m}getAfterEdgeOfBlockContainer(e){let t=e;do{t=t.parent}while(t&&t.inline);return t?(t=t.copy().modify(),t.after=!0,zs(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let t=e.findIndex(e=>e.overflow);if(t<0)return{edge:NaN,checkPoint:null};let i=e[t];return{edge:this.calculateEdge(null,e,t,i.boxOffset),checkPoint:i}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,i){e.formattingContext;let n=(new Zs).find(e.formattingContext).finishBreak(this,e,t,i);return n||(n=ea.finishBreak(this,e,t,i)),n}findAcceptableBreakPosition(){let e=null,t=null,i=0,n=0;do{i=n,n=Number.MAX_VALUE;for(let r=this.breakPositions.length-1;r>=0&&!t;--r){e=this.breakPositions[r],t=e.findAcceptableBreak(this,i);let o=e.getMinBreakPenalty();o>i&&(n=Math.min(n,o))}}while(n>i&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,i,n){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return qn(e);let r=Gn("doFinishBreak"),o=!1;if(!e){if(this.forceNonfitting)return R.warn("Could not find any page breaks?!!"),this.skipTailEdges(t).then(e=>{e?((e=e.modify()).overflow=!1,this.finishBreak(e,o,!0).then(()=>{r.finish(e)})):r.finish(e)}),r.result();e=i,o=!0,this.computedBlockSize=n}return this.finishBreak(e,o,!0).then(()=>{r.finish(e)}),r.result()}isBreakable(e){for(let t=e;t;t=t.parent)if(js(t.viewNode))return!1;return!!e.after||"http://www.w3.org/2000/svg"!==e.sourceNode.namespaceURI&&!e.flexContainer}zeroIndent(e){let t=e.toString();return""==t||"auto"==t||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e)return!1;for(let t=e;t;t=t.parent)if(js(t.viewNode))return!1;if(Vs(e.viewNode))return!1;let i=zs(e,this.clientLayout,0,this.vertical),n=Ys(e,this.collectElementsOffset()),r=this.isOverflown(i+(this.vertical?-1:1)*n.minimum);if(this.isOverflown(i+(this.vertical?-1:1)*n.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){let e=i+this.getTrailingMarginEdgeAdjustment(t),r=this.footnoteEdge-this.getBoxDir()*n.current;i=this.vertical?Math.min(i,Math.max(e,r)):Math.max(i,Math.min(e,r))}return this.updateMaxReachedAfterEdge(i),r}checkOverflowAndSaveEdgeAndBreakPosition(e,t,i,n){if(!e||Vs(e.viewNode))return!1;let r=this.checkOverflowAndSaveEdge(e,t);return(i||!r)&&this.saveEdgeBreakPosition(e,n,r),r}applyClearance(e){if(!e.viewNode.parentNode||e.floatReference!==rs.INLINE)return!1;let t=this.getComputedMargin(e.viewNode),i=e.viewNode.ownerDocument.createElement("div");this.vertical?(i.style.bottom="0px",i.style.width="1px",i.style.marginRight=`${t.right}px`):(i.style.right="0px",i.style.height="1px",i.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(i,e.viewNode);let n=Os(this.clientLayout,i,this.vertical),r=this.getBeforeEdge(n),o=this.getBoxDir(),s="same"===e.clearSide?e.floatSide:e.clearSide,a=/^(top|bottom|inside|outside|(block|inline)-(start|end))$/.test(s)?ss(s,e.vertical,e.direction,this.layoutContext.page.side):s,l="left"===a||"right"===a?"rtl"===e.direction==("left"===a)?"inline-end":"inline-start":a,h=this.pageFloatLayoutContext.getPageFloatClearEdge(l,this);switch(a){case"left":h=o*Math.max(h*o,this.leftFloatEdge*o);break;case"right":h=o*Math.max(h*o,this.rightFloatEdge*o);break;default:h=o*Math.max(h*o,Math.max(this.rightFloatEdge*o,this.leftFloatEdge*o))}if(r*o+1/(this.clientLayout.pixelRatio||1)>h*o)return e.viewNode.parentNode.removeChild(i),!1;{let s=Math.max(1,(h-r)*o);this.vertical?i.style.width=`${s}px`:i.style.height=`${s}px`,n=Os(this.clientLayout,i,this.vertical);let a=this.getAfterEdge(n);if(!e.floatSide)if(this.vertical){let e=a-t.right-h;e>0==t.right>=0&&(e+=t.right),i.style.marginLeft=`${e}px`}else{let e=h-(a+t.top);e>0==t.top>=0&&(e+=t.top),i.style.marginBottom=`${e}px`}return e.clearSpacer=i,!0}}isBFC(e){return!(!ta(e)&&!So.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,t,i){var n;let r=e.after?null==(n=e.parent)?void 0:n.formattingContext:e.formattingContext;if(r&&!this.isBFC(r))return qn(e);let o=Gn("skipEdges"),s=!i&&t&&e&&e.after,a=i,l=null,h=[],u=[],c=!1;function d(){return!!i||!t&&co(a)&&!function(){var t;if(!l||e.floatSide)return!1;for(let e=l;null!=e&&e.parent;e=e.parent){let i=e.after?e.viewNode:null==(t=e.viewNode)?void 0:t.previousSibling;for(;i&&(Mo(i,e.parent.whitespace)||js(i));)i=i.previousSibling;if(i)return!1}return!0}()}let p=()=>{(e=h[0]||e).viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=a};return o.loopWithFrame(i=>{for(var n;e;){e.formattingContext;let r=(new Zs).find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(Mo(e.viewNode,e.whitespace))break;if(!e.after)return d()?p():this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)?(e=(this.stopAtOverflow&&l||e).modify()).overflow=!0:(e=e.modify()).breakBefore=a,void i.breakLoop()}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=mo(a)?a:null),r&&r.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&t&&0===this.breakPositions.length&&this.saveEdgeBreakPosition(e.copy(),a,!1),!e.inline&&!e.repeatOnBreak&&(l?qs(l):this.breakPositions[this.breakPositions.length-1]instanceof Hh)&&this.saveEdgeBreakPosition(e.copy(),a,!1),!this.isBFC(e.formattingContext)||So.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&Mo(e.sourceNode.firstChild,e.whitespace))return h.push(e.copy()),a=bo(a,e.breakBefore),d()?p():(this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)||!this.layoutConstraint.allowLayout(e))&&((e=(this.stopAtOverflow&&l||e).modify()).overflow=!0),void i.breakLoop()}if(1!=e.viewNode.nodeType)break;let o=e.viewNode.style;if(e.after){e.floatSide&&(a=null!=a?a:this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let n=e.sourceNode;if("svg"===n.localName||"math"===n.localName||"true"===n.getAttribute("data-math-typeset")){c=!1,l=e.copy(),u.push(l),a=bo(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!this.stopAtOverflow,a);break}if(e.inline||r&&r.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(c){if(d())return p(),void i.breakLoop();h=[],t=!1,s=!1,a=null}c=!1,l=e.copy(),u.push(l),a=bo(a,e.breakAfter),o&&(!this.zeroIndent(o.paddingBottom)||!this.zeroIndent(o.borderBottomWidth))&&(u=[l])}else{if(h.push(e.copy()),a=bo(a,e.breakBefore),l&&co(a)&&Bs(l.viewNode,e.viewNode),(e.pageType!=(null==(n=e.parent)?void 0:n.pageType)||!co(a))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!this.stopAtOverflow,a),(e=e.modify()).overflow=!0,this.stopAtOverflow))return void i.breakLoop();let t=e.viewNode.localName;if(Te[t])return d()?p():this.checkOverflowAndSaveEdgeAndBreakPosition(l,null,!0,a)&&((e=(this.stopAtOverflow&&l||e).modify()).overflow=!0),void i.breakLoop();o&&!(this.zeroIndent(o.paddingTop)&&this.zeroIndent(o.borderTopWidth))&&(s=!1,u=[]),c=!0}}while(0);let o=this.nextInTree(e,s);if(o.isPending())return void o.then(t=>{e=t,i.continueLoop()});e=o.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(l,u,!this.stopAtOverflow,a)?l&&this.stopAtOverflow&&((e=l.modify()).overflow=!0):co(a)&&(this.pageBreakType=a),i.breakLoop()}).then(()=>{l&&(this.lastAfterPosition=l.toNodePosition()),o.finish(e)}),o.result()}skipTailEdges(e){let t=e.copy(),i=Gn("skipEdges"),n=null,r=!1;return i.loopWithFrame(i=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(Mo(e.viewNode,e.whitespace))break;if(!e.after)return co(n)&&(this.pageBreakType=n),void i.breakLoop()}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer))return n=bo(n,e.breakBefore),co(n)&&(this.pageBreakType=n),void i.breakLoop();if(1!=e.viewNode.nodeType)break;let t=e.viewNode.style;if(e.after){if(r){if(co(n))return this.pageBreakType=n,void i.breakLoop();n=null}r=!1,n=bo(n,e.breakAfter)}else{n=bo(n,e.breakBefore);let r=e.viewNode.localName;if(Te[r])return co(n)&&(this.pageBreakType=n),void i.breakLoop();if(t&&(!this.zeroIndent(t.paddingTop)||!this.zeroIndent(t.borderTopWidth)))return void i.breakLoop()}r=!0}while(0);let t=this.layoutContext.nextInTree(e);if(t.isPending())return void t.then(t=>{e=t,i.continueLoop()});e=t.get()}t=null,i.breakLoop()}).then(()=>{i.finish(t)}),i.result()}layoutFloatOrFootnote(e){return os(e.floatReference)||"footnote"===e.floatSide?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,i){let n=Gn("layoutNext");return this.skipEdges(e,t,i||null).then(i=>{if(!(e=i)||this.pageBreakType||this.stopByOverflow(e))n.finish(e);else{let i=e.formattingContext;(new Zs).find(i).layout(e,this,t).thenFinish(n)}}),n.result()}clearOverflownViewNodes(e,t){if(e)for(let i=e.parent;e;e=i,i=i?i.parent:null){let n=(i||e).formattingContext;(new Zs).find(n).clearOverflownViewNodes(this,i,e,t),t=!1}}initGeom(){let e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let i=this.originX+this.left+this.getInsetLeft(),n=this.originY+this.top+this.getInsetTop();this.box=new wi(i,n,i+this.width,n+this.height),this.startEdge=t?this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left:0,this.endEdge=t?this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=function(e,t,i,n,r,o){o&&(e=Oi(e),t=t.map(e=>Mi(e)),i=i.map(e=>Mi(e)));let s,a,l,h=t.length,u=i?i.length:0,c=[],d=[];for(s=0;s<h;s++)t[s].addSegments(d,s);for(s=0;s<u;s++)i[s].addSegments(d,s+h);let p=d.length;d.sort(Ei);let f=0;for(;d[f].shapeId>=h;)f++;let g=d[f].low.y;g>e.y1&&c.push(new ki(e.y1,g,e.x2,e.x2));let m=0,b=[];for(;m<p&&(l=d[m]).low.y<g;)l.high.y>g&&b.push(l),m++;for(;m<p||b.length>0;){let t=e.y2,i=Math.min(Li(Math.ceil(g+n),r),e.y2);for(a=0;a<b.length&&t>i;a++)l=b[a],l.low.x==l.high.x?l.high.y<t&&(t=Math.max(Fi(l.high.y,r),i)):l.low.x!=l.high.x&&(t=i);for(t>e.y2&&(t=e.y2);m<p&&(l=d[m]).low.y<t;)if(l.high.y<g)m++;else{if(!(l.low.y<i)){let e=Fi(l.low.y,r);e<t&&(t=e);break}l.low.y==l.high.y&&l.low.y==g||(b.push(l),t=i),m++}let o=[];for(a=0;a<b.length;a++)_i(o,b[a],g,t);o.sort((e,t)=>e.x-t.x||e.lowOrHigh-t.lowOrHigh);let s=Ri(o,h,u);if(0==s.length)c.push(new ki(g,t,e.x2,e.x2));else{let i=0,n=e.x1;for(a=0;a<s.length;a+=2){let t=Math.max(e.x1,s[a]),r=Math.min(e.x2,s[a+1])-t;r>i&&(i=r,n=t)}0==i?c.push(new ki(g,t,e.x2,e.x2)):c.push(new ki(g,t,Math.max(n,e.x1),Math.min(n+i,e.x2)))}if(t==e.y2)break;for(g=t,a=b.length-1;a>=0;a--)b[a].high.y<=t&&b.splice(a,1)}return zi(e,c),c}(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],ce(this.element,"width",`${this.width}px`),ce(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,i){e.formattingContext;let n=e.copy(),r=(new Zs).find(e.formattingContext),o=this.calculateClonedPaddingBorder(n),s=r.createEdgeBreakPosition(n,t,i,this.computedBlockSize+o);this.breakPositions.push(s)}saveBoxBreakPosition(e){let t=e[0].breakPenalty;if(t){let i=e[0];for(;i.parent&&i.inline;)i=i.parent;t=i.breakPenalty}let i=new Hh(e,t);this.breakPositions.push(i)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,i){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return qn(e);if(this.isFullWithPageFloats())return e.primary.after&&1===e.primary.steps.length?qn(null):qn(e);(function(e){return e.element.hasAttribute("data-vivliostyle-column")})(this)&&Is(this);let n=Gn("layout");return this.openAllViews(e.primary).then(e=>{let r=null;if(e.viewNode)r=e.copy();else{let e=t=>{t.nodeContext.viewNode&&(r=t.nodeContext,this.layoutContext.removeEventListener("nextInTree",e))};this.layoutContext.addEventListener("nextInTree",e)}let o=new qh(t,i);o.layout(e,this).then(e=>{this.doFinishBreak(e,o.context.overflownNodeContext,r,o.initialComputedBlockSize).then(e=>{let t=null;t=this.pseudoParent?qn(null):this.doFinishBreakOfFragmentLayoutConstraints(e),t.then(()=>{if(this.pageFloatLayoutContext.isInvalidated())n.finish(null);else if(e){this.overflown=!0;let t=new Zo(e.toNodePosition());n.finish(t)}else n.finish(null)})})})}),n.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let t=Gn("doFinishBreakOfFragmentLayoutConstraints"),i=[].concat(this.fragmentLayoutConstraints);i.sort((e,t)=>e.getPriorityOfFinishBreak()-t.getPriorityOfFinishBreak());let n=0;return t.loop(()=>n<i.length?i[n++].finishBreak(e,this).thenReturn(!0):qn(!1)).then(()=>{t.finish(!0)}),t.result()}doLayout(e,t,i){let n=Gn("doLayout"),r=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,n.loopWithFrame(n=>{for(;e;){let o=!0;if(this.layoutNext(e,t,i||null).then(s=>{if(t=!1,i=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,(e=this.nodeContextOverflowingDueToRepetitiveElements).overflow=!0):e=s,this.pageFloatLayoutContext.isInvalidated())n.breakLoop();else if(this.pageBreakType)n.breakLoop();else if(e&&this.stopByOverflow(e)){r=e;let t=this.findAcceptableBreakPosition();e=t.nodeContext,t.breakPosition&&t.breakPosition.breakPositionChosen(this),n.breakLoop()}else o?o=!1:n.continueLoop()}),o)return void(o=!1)}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),n.breakLoop()}).then(()=>{n.finish({nodeContext:e,overflownNodeContext:r})}),n.result()}redoLayout(){let e=this.chunkPositions,t=this.element.lastChild;for(;t!=this.last;){let e=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=e}this.killFloats(),this.init();let i=Gn("redoLayout"),n=0,r=null,o=!0;return i.loopWithFrame(t=>{if(n<e.length){let i=e[n++];return void this.layout(i,o).then(e=>{o=!1,e?(r=e,t.breakLoop()):t.continueLoop()})}t.breakLoop()}).then(()=>{i.finish(r)}),i.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach(t=>{if(So.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(t)){let i=t.getRepetitiveElements();e.push(i)}if(xo.isInstanceOfAfterIfContinuesLayoutConstraint(t)){let i=t.getRepetitiveElements();e.push(i)}Co.isInstanceOfTableRowLayoutConstraint(t)&&t.getElementsOffsetsForTableCell(this).forEach(t=>{e.push(t)})});return e}},jh=class{constructor(e,t,i){h(this,"startNodeContexts",[]),h(this,"column"),this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=i.formattingContext,this.column.pseudoParent=e;let n=this.column.calculateClonedPaddingBorder(i);this.column.footnoteEdge=this.column.footnoteEdge-n;let r=this;this.column.openAllViews=function(e){return $h.prototype.openAllViews.call(this,e).thenAsync(e=>(r.startNodeContexts.push(e.copy()),qn(e)))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){let t=this.column.findAcceptableBreakPosition();if(e){let e=this.startNodeContexts[0].copy(),i=new Ks(e,null,e.overflow,0);if(i.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:i,nodeContext:e}}return t}finishBreak(e,t,i){return this.column.finishBreak(e,t,i)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){let t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return $o(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},Wh=class{breakTextNode(e,t,i,n,r,o){if(t.after)t.offsetInNode=e.length;else{let n=i-t.boxOffset,r=e.data;n=173==r.charCodeAt(n)?this.breakAfterSoftHyphen(e,r,n,t):this.breakAfterOtherCharacter(e,r,n,t),n>0&&(t=this.updateNodeContext(t,n,e))}return t}breakAfterSoftHyphen(e,t,i,n){let r=/[\u0620\u0626\u0628\u062A-\u062E\u0633-\u0647\u0649\u064A\u066E\u066F\u0678-\u0687\u069A-\u06BF\u06C1\u06C2\u06CC\u06CE\u06D0\u06D1\u06FA-\u06FC\u06FF\u0712-\u0714\u071A-\u071D\u071F-\u0727\u0729\u072B\u072D\u072E\u074E-\u0758\u075C-\u076A\u076D-\u0770\u0772\u0775-\u0777\u077A-\u077F\u07CA-\u07EA\u07FA\u0841-\u0845\u0848\u084A-\u0853\u0855\u0860\u0862-\u0865\u0868\u0883-\u0886\u0889-\u088D\u08A0-\u08A9\u08AF\u08B0\u08B3-\u08B8\u08BA-\u08C8\u1807\u180A\u1820-\u1878\u1887-\u18A8\u18AA\u200D\uA840-\uA871\u{10AC0}-\u{10AC4}\u{10AD3}-\u{10AD6}\u{10AD8}-\u{10ADC}\u{10ADE}-\u{10AE0}\u{10AEB}-\u{10AEE}\u{10B80}\u{10B82}\u{10B86}-\u{10B88}\u{10B8A}\u{10B8B}\u{10B8D}\u{10B90}\u{10BAD}\u{10BAE}\u{10D01}-\u{10D21}\u{10D23}\u{10EC3}\u{10EC4}\u{10F30}-\u{10F32}\u{10F34}-\u{10F44}\u{10F51}-\u{10F53}\u{10F70}-\u{10F73}\u{10F76}-\u{10F81}\u{10FB0}\u{10FB2}\u{10FB3}\u{10FB8}\u{10FBB}\u{10FBC}\u{10FBE}\u{10FBF}\u{10FC1}\u{10FC4}\u{10FCA}\u{1E900}-\u{1E943}]\p{Mn}*$/u.test(t.slice(0,i))?"":"";if(e.replaceData(i,t.length-i,n.breakWord?"":r+Gh(n)),r){let e=n.preprocessedTextContent[0][1];n.preprocessedTextContent[0][1]=e.slice(0,i+1)+r+e.slice(i+1)}return i+1}breakAfterOtherCharacter(e,t,i,n){let r=t.charAt(i);i++;let o=t.charAt(i);return e.replaceData(i,t.length-i,!n.breakWord&&ye(r)&&ye(o)?Gh(n):""),i}updateNodeContext(e,t,i){return(e=e.modify()).offsetInNode+=t,e.breakBefore=null,e}};function Gh(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}h(Wh,"instance"),Wh.instance=new Wh;var qh=class extends ia{constructor(e,t){super(),this.leadingEdge=e,h(this,"breakAfter"),h(this,"initialPageBreakType",null),h(this,"initialComputedBlockSize",0),h(this,"initialOverflown",!1),h(this,"context",{overflownNodeContext:null}),this.breakAfter=t||null}resolveLayoutMode(e){return new Xh(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||(sa=[])}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){let e=t.viewNode;e&&Us(e.parentNode,e),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}},Xh=class{constructor(e,t,i){this.leadingEdge=e,this.breakAfter=t,this.context=i}doLayout(e,t){let i=Gn("DefaultLayoutMode.doLayout");return function(e,t){let i=Gn("processAfterIfContinuesOfAncestors"),n=e;return i.loop(()=>{if(null!==n){let e=Dh(n,t);return n=n.parent,e.thenReturn(!0)}return qn(!1)}).then(()=>{i.finish(!0)}),i.result()}(e,t).then(()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then(e=>{this.context.overflownNodeContext=e.overflownNodeContext,i.finish(e.nodeContext)})}),i.result()}accept(e,t){return!!(t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||t.fragmentLayoutConstraints.length<=0)||t.fragmentLayoutConstraints.every(i=>i.allowLayout(e,this.context.overflownNodeContext,t))}postLayout(e,t,i,n){return n||(n=!i.fragmentLayoutConstraints.some(t=>t.nextCandidate(e))),i.fragmentLayoutConstraints.forEach(r=>{r.postLayout(n,e,t,i)}),n}},Yh=class extends $h{constructor(e,t,i,n,r,o,s){super(t,i,n,r,o),this.floatSide=e,this.parentContainer=s,h(this,"rootViewNodes",[]),h(this,"floatMargins",[]),h(this,"adjustContentRelativeSize",!0)}openAllViews(e){return super.openAllViews(e).thenAsync(e=>(e&&this.fixFloatSizeAndPosition(e),qn(e)))}convertPercentageSizesToPx(e){let t=this.parentContainer.getPaddingRect(),i=t.x2-t.x1,n=t.y2-t.y1;function r(t,i){t.forEach(t=>{let n=de(e,t);if(n&&"%"===n.charAt(n.length-1)){let r=parseFloat(n);ce(e,t,`${i*r/100}px`)}})}r(["width","max-width","min-width"],i),r(["height","max-height","min-height"],n),r(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?n:i),["margin-top","margin-right","margin-bottom","margin-left"].forEach(t=>{"auto"===de(e,t)&&ce(e,t,"0")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){let e=this.floatSide;if(this.parentContainer.vertical){if("block-end"===e||"left"===e){let e=de(t,"height");""!==e&&"auto"!==e&&ce(t,"margin-top","auto")}}else if("block-end"===e||"bottom"===e){let e=de(t,"width");""!==e&&"auto"!==e&&ce(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,t)=>{let i=Os(this.clientLayout,e,this.vertical),n=this.floatMargins[t];return this.vertical?n.top+i.height+n.bottom:n.left+i.width+n.right}))}},Kh=class{constructor(e,t){this.parent=e,this.rootSourceNode=t,h(this,"formattingContextType","RepetitiveElementsOwner"),h(this,"isRoot",!1),h(this,"repetitiveElements",null)}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){let t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do{if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e}while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||sa.some(e=>e.root===this.rootSourceNode&&(this.repetitiveElements=e.elements,!0))||(this.repetitiveElements=new Zh(e,this.rootSourceNode),sa.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}},Zh=class{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,h(this,"headerSourceNode",null),h(this,"footerSourceNode",null),h(this,"headerViewNode",null),h(this,"footerViewNode",null),h(this,"headerNodePosition",null),h(this,"footerNodePosition",null),h(this,"headerHeight",0),h(this,"footerHeight",0),h(this,"isSkipHeader",!1),h(this,"isSkipFooter",!1),h(this,"enableSkippingFooter",!0),h(this,"enableSkippingHeader",!0),h(this,"doneInitialLayout",!1),h(this,"firstContentSourceNode",null),h(this,"lastContentSourceNode",null),h(this,"affectedNodeCache",[]),h(this,"afterLastContentNodeCache",[]),h(this,"allowInsert",!1),h(this,"allowInsertRepeatitiveElements")}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=jo(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=jo(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=Ds(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=Ds(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,i){return!this.headerNodePosition||this.isSkipHeader?qn(!0):this.appendElementToFragment(this.headerNodePosition,e,t,i)}appendFooterToFragment(e,t,i){return!this.footerNodePosition||this.isSkipFooter?qn(!0):this.appendElementToFragment(this.footerNodePosition,e,t,i)}appendElementToFragment(e,t,i,n){let r=t.viewNode.ownerDocument,o=t.viewNode,s=r.createElement("div");o.appendChild(s);let a=new jh(n,s,t),l=a.getColumn().pageBreakType;return a.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,a.layout(new Zo(e),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,o.removeChild(s),this.moveChildren(s,o,i),a.getColumn().pageBreakType=l,qn(!0)))}moveChildren(e,t,i){if(t)for(;e.firstChild;){let n=e.firstChild;e.removeChild(n),n.setAttribute(Hs,"1"),i?t.insertBefore(n,i):t.appendChild(n)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)||((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight)),t}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)||(!this.enableSkippingFooter&&e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight)),t}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0))}findResultFromCache(e,t,i){let n=t.filter(t=>t.nodeContext.sourceNode===e.sourceNode&&t.nodeContext.after===e.after);if(n.length>0)return n[0].result;{let n=i(e);return t.push({nodeContext:e,result:n}),n}}isAfterNodeContextOf(e,t,i){let n=[];for(let i=e;i;i=i.parentNode){if(t.sourceNode===i)return t.after;n.push(i)}for(let e=t.sourceNode;e;e=e.parentNode){let t=n.indexOf(e);if(t>=0)return!!i&&0===t;for(let t=e;t;t=t.previousElementSibling)if(n.includes(t))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}},Jh=class{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,i,n){let r=this.formattingContext.getRepetitiveElements();return r&&(i.clientLayout,r.doneInitialLayout||(r.updateHeight(i),r.doneInitialLayout=!0)),n}},Qh=class{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,i,n){return n}},eu=class extends Jh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}},tu=class extends Qh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return!e.belongsTo(this.formattingContext)&&!e.after&&t.fragmentLayoutConstraints.unshift(new iu(e)),this.processor.doLayout(e,t)}},iu=class e{constructor(e){h(this,"flagmentLayoutConstraintType","RepetitiveElementsOwner"),h(this,"nodeContext");let t=e.formattingContext;this.nodeContext=t.getRootNodeContext(e)}allowLayout(e,t,i){let n=this.getRepetitiveElements();return!(n&&!Vs(this.nodeContext.viewNode)&&n.isEnableToUpdateState())||!(t&&!e||e&&e.overflow)}nextCandidate(e){let t=this.getRepetitiveElements();return!(!t||!t.isEnableToUpdateState())&&(t.updateState(),!0)}postLayout(e,t,i,n){let r=this.getRepetitiveElements();r&&e&&n.stopAtOverflow&&(null==t||r.isAfterLastContent(t))&&r.preventSkippingFooter()}finishBreak(e,t){let i=this.nodeContext.formattingContext,n=this.getRepetitiveElements();if(!n)return qn(!0);let r=this.nodeContext;return function(e,t,i){let n=e.getRepetitiveElements();if(n){let r=e.getRootNodeContext(t);if(r.viewNode){let e=r.viewNode.firstChild;return n.appendHeaderToFragment(r,e,i)}}return qn(!0)}(i,r,t).thenAsync(()=>function(e,t,i){let n=e.getRepetitiveElements();if(n&&!n.isSkipFooter){let r=e.getRootNodeContext(t);if(r.viewNode)return n.appendFooterToFragment(r,null,i)}return qn(!0)}(i,r,t).thenAsync(()=>(n.prepareLayoutFragment(),qn(!0))))}getRepetitiveElements(){return this.nodeContext.formattingContext.getRepetitiveElements()}equalsTo(t){return t instanceof e&&this.nodeContext.formattingContext===t.nodeContext.formattingContext}getPriorityOfFinishBreak(){return 10}},nu=class extends ia{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.formattingContext.getRepetitiveElements();return e.belongsTo(this.formattingContext)||t.doneInitialLayout?(!e.belongsTo(this.formattingContext)&&!e.after&&t&&t.preventSkippingHeader(),new tu(this.formattingContext,this.processor)):new eu(this.formattingContext,this.processor)}},ru=class extends oa{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=t.getRepetitiveElements();if(i.parent&&t.rootSourceNode===i.parent.sourceNode){switch(i.repeatOnBreak){case"header":if(!n.isHeaderRegistered())return n.setHeaderNodeContext(i),qn(!0);i.repeatOnBreak="none";break;case"footer":if(!n.isFooterRegistered())return n.setFooterNodeContext(i),qn(!0);i.repeatOnBreak="none"}n.firstContentSourceNode||(n.firstContentSourceNode=i.sourceNode)}return oa.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext;return i.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),"header"===i.repeatOnBreak||"footer"===i.repeatOnBreak?qn(!0):oa.prototype.afterNonInlineElementNode.call(this,e)}};function ou(e,t){e&&function(e,t){for(let i=e;i;i=i.parent){let e=i.formattingContext;e&&e instanceof Kh&&!i.belongsTo(e)&&t(e,i)}}(e.after?e.parent:e,(e,i)=>{Co.isInstanceOfTableFormattingContext(e)||t.fragmentLayoutConstraints.push(new iu(i))})}var su=new class extends Js{layout(e,t,i){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);let n=e.formattingContext;return n.getRootViewNode(e)?(i&&ou(e.parent,t),e.belongsTo(n)?Js.prototype.layout.call(this,e,t,i):new nu(n,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){let t=function(e){let t=e.formattingContext;return t&&t instanceof Kh?t:null}(e).getRepetitiveElements();return t&&!t.allowInsertRepeatitiveElements&&(t.isHeaderSourceNode(e.sourceNode)||t.isFooterSourceNode(e.sourceNode))&&e.viewNode.parentNode.removeChild(e.viewNode),!1}doInitialLayout(e,t){e.formattingContext;let i=Gn("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(i),i.result()}layoutEntireBlock(e,t){let i=e.formattingContext,n=new ru(i,t);return new ra(n,t.layoutContext).iterate(e)}doLayout(e,t){let i=e.formattingContext,n=Gn("doLayout");return Vh(t.layoutContext.nextInTree(e,!1),t).then(e=>{let r=e;n.loopWithFrame(e=>{for(;r;){let n=!0;if(t.layoutNext(r,!1).then(o=>{r=o,t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||r&&t.stopByOverflow(r)||r&&r.after&&r.sourceNode==i.rootSourceNode?e.breakLoop():n?n=!1:e.continueLoop()}),n)return void(n=!1)}e.breakLoop()}).then(()=>{n.finish(r)})}),n.result()}finishBreak(e,t,i,n){return Js.prototype.finishBreak.call(this,e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Js.prototype.clearOverflownViewNodes(e,t,i,n)}};O("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof Kh&&!Co.isInstanceOfTableFormattingContext(e)?su:null);var au=class{constructor(e,t){this.rowIndex=e,this.sourceNode=t,h(this,"cells",[])}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(e=>e.height))}},lu=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,h(this,"viewElement"),h(this,"colSpan"),h(this,"rowSpan"),h(this,"height",0),h(this,"anchorSlot",null),this.viewElement=i,this.colSpan=i.colSpan||1,this.rowSpan=i.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}},hu=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,this.cell=i}},uu=class{constructor(e,t,i){this.column=e,this.cellNodeContext=i,h(this,"pseudoColumn"),h(this,"empty",!1),this.pseudoColumn=new jh(e,t,i)}findAcceptableBreakPosition(){let e=this.cellNodeContext.viewNode,{verticalAlign:t,alignContent:i}=e.style;"top"!==t&&"baseline"!==t&&ce(e,"vertical-align","top"),i&&"normal"!==i&&ce(e,"align-content","normal");let n=this.pseudoColumn.findAcceptableBreakPosition(!0);return ce(e,"vertical-align",t),i&&"normal"!==i&&ce(e,"align-content",i),n}},cu=class{constructor(e,t){this.viewNode=e,this.side=t}},du=class extends Ks{constructor(e,t,i,n){super(e,t,i,n),h(this,"formattingContext"),h(this,"acceptableCellBreakPositions",null),h(this,"rowIndex",null),this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){let i=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(e=>!!e.nodeContext)?i:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();this.getAcceptableCellBreakPositions().forEach(t=>{e+=t.breakPosition.getMinBreakPenalty()});let t=this.getCellFragments();return e+=Math.max(0,...t.map(e=>e.cellNodeContext.breakPenalty)),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){this.formattingContext;let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(e=>e.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return null!=this.rowIndex?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},pu=class extends Xs{constructor(e,t,i){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=i,h(this,"acceptableCellBreakPositions",null)}findAcceptableBreak(e,t){if(this!==e.breakPositions[0]&&t<this.getMinBreakPenalty())return null;let i=this.getCellFragments(),n=this.getAcceptableCellBreakPositions(),r=n.every(e=>!!e.nodeContext)&&n.some((e,t)=>{let n=i[t].pseudoColumn,r=e.nodeContext;return!n.isStartNodeContext(r)&&!n.isLastAfterNodeContext(r)});return this.beforeNodeContext.overflow=n.some(e=>e.nodeContext&&e.nodeContext.overflow),r?this.beforeNodeContext:null}getMinBreakPenalty(){this.formattingContext.getRowByIndex(this.rowIndex);let e=this.beforeNodeContext.breakPenalty,t=this.getAcceptableCellBreakPositions(),i=this.getCellFragments();e+=Math.max(0,...i.map(e=>e.cellNodeContext.breakPenalty));let n=t.some((e,t)=>e.breakPosition instanceof Hh&&i[t].cellNodeContext.sourceNode.rowSpan>1);return t.forEach((t,r)=>{let o=t.breakPosition.getMinBreakPenalty();n&&t.breakPosition instanceof Ks&&t.breakPosition.overflows&&o>=3&&(i[r].column.checkOverflowAndSaveEdge(t.nodeContext,null)||(o-=3)),e+=o}),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(e=>e.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},fu=class extends Kh{constructor(e,t){super(e,t),this.tableSourceNode=t,h(this,"formattingContextType","Table"),h(this,"vertical",!1),h(this,"columnCount",-1),h(this,"tableWidth",0),h(this,"captions",[]),h(this,"colGroups",null),h(this,"colWidths",null),h(this,"inlineBorderSpacing",0),h(this,"rows",[]),h(this,"slots",[]),h(this,"cellFragments",[]),h(this,"lastRowViewNode",null),h(this,"cellBreakPositions",[]),h(this,"repetitiveElements",null)}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return 0===this.cellBreakPositions.length;case"table-cell":return!this.cellBreakPositions.some(t=>t.cellNodePosition.steps[0].node===e.sourceNode);default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let i=this.rows[e];i||(this.addRow(e,new au(e,null)),i=this.rows[e]),i.addCell(t);let n=e+t.rowSpan,r=this.getRowSlots(e),o=0;for(;r[o];)o++;for(;e<n;e++){r=this.getRowSlots(e);for(let i=o;i<o+t.colSpan;i++){let n=r[i]=new hu(e,i,t);t.anchorSlot||t.setAnchorSlot(n)}}}getRowByIndex(e){return this.rows[e]}findRowIndexBySourceNode(e){return this.rows.findIndex(t=>e===t.sourceNode)}addCellFragment(e,t,i){let n=this.cellFragments[e];n||(n=this.cellFragments[e]=[]),n[t]=i}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((e,t)=>t.cell!==e[e.length-1]?e.concat(t.cell):e,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(t=>t.rowIndex+t.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((e,t)=>e+t.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(t=>{t.cells.forEach(t=>{let i=Os(e,t.viewElement,this.vertical);t.viewElement=null,t.setHeight(this.vertical?i.width:i.height)})})}findCellFromColumn(e){if(!e)return null;let t=null,i=0,n=0;e:for(i=0;i<this.cellFragments.length;i++)if(this.cellFragments[i])for(n=0;n<this.cellFragments[i].length;n++)if(this.cellFragments[i][n]&&e===this.cellFragments[i][n].pseudoColumn.getColumn()){t=this.rows[i].cells[n];break e}if(!t)return null;for(;i<this.slots.length;i++)for(;n<this.slots[i].length;n++){let e=this.slots[i][n];if(e.cell===t)return{rowIndex:e.rowIndex,columnIndex:e.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let t=[];return this.slots.reduce((i,n,r)=>{if(r>=e.rowIndex)return i;let o=n[e.columnIndex]&&this.getCellFragmentOfCell(n[e.columnIndex].cell);return!o||t.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),i),t.push(o)),i},[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach(t=>{t.cells.forEach((t,i)=>{e[i]||(e[i]={collected:[],elements:[]});let n=e[i],r=this.getCellFragmentOfCell(t);!r||n.collected.includes(r)||(this.collectElementsOffsetFromColumn(r.pseudoColumn.getColumn(),n.elements),n.collected.push(r))})}),[new gu(e.map(e=>e.elements))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach(e=>{if(So.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(e)){let i=e.getRepetitiveElements();t.push(i)}Co.isInstanceOfTableRowLayoutConstraint(e)&&e.getElementsOffsetsForTableCell(null).forEach(e=>{t.push(e)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},gu=class{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,e=>e.current)}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,e=>e.minimum)}calculateMaxOffsetOfColumn(e,t){let i=0;return this.repeatitiveElementsInColumns.forEach(n=>{let r=Ys(e,n);i=Math.max(i,t(r))}),i}};function mu(e){return function(e){return"table-row-group"===e||"table-header-group"===e||"table-footer-group"===e}(e)||function(e){return"table"===e||"inline-table"===e}(e)}function bu(e,t,i){let n=e.nodeContext,r=n.display,o=n.parent?n.parent.display:null,s=!1;if("inline-table"===o&&!(n.formattingContext instanceof fu))for(let e=n.parent;e;e=e.parent)if(e.formattingContext instanceof fu){s=e.formattingContext===t;break}return s||"table-row"===r&&!mu(o)||"table-cell"===r&&"table-row"!==o&&!mu(o)||n.formattingContext instanceof fu&&n.formattingContext!==t?i.buildDeepElementView(n).thenAsync(t=>(e.nodeContext=t,qn(!0))):null}var vu=class extends oa{constructor(e,t){super(),this.formattingContext=e,this.column=t,h(this,"rowIndex",-1),h(this,"columnIndex",0),h(this,"inRow",!1),h(this,"checkPoints",[]),h(this,"inHeaderOrFooter",!1)}startNonInlineElementNode(e){let t=this.formattingContext,i=bu(e,t,this.column);if(i)return i;this.postLayoutBlockContents(e);let n=e.nodeContext,r=n.display,o=t.getRepetitiveElements();switch(r){case"table":t.inlineBorderSpacing=n.inlineBorderSpacing;break;case"table-caption":{let e=new cu(n.viewNode,n.captionSide);t.captions.push(e);break}case"table-header-group":return o.isHeaderRegistered()||(this.inHeaderOrFooter=!0,o.setHeaderNodeContext(n)),qn(!0);case"table-footer-group":return o.isFooterRegistered()||(this.inHeaderOrFooter=!0,o.setFooterNodeContext(n)),qn(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,n.sourceNode,this.columnIndex=0,t.addRow(this.rowIndex,new au(this.rowIndex,n.sourceNode)),o.firstContentSourceNode||(o.firstContentSourceNode=n.sourceNode))}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=i.display,r=this.column.clientLayout;if(this.postLayoutBlockContents(e),i.sourceNode===t.tableSourceNode){let n=r.getElementComputedStyle(t.getRootViewNode(i));t.tableWidth=parseFloat(n[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(n){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,qn(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=i.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let e=i.viewNode;t.addCell(this.rowIndex,new lu(this.rowIndex,this.columnIndex,e)),this.columnIndex++}}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let t=e.nodeContext;t&&t.viewNode&&!Ws(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},yu=class e extends oa{constructor(e,t){super(!0),this.formattingContext=e,this.column=t,h(this,"inRow",!1),h(this,"currentRowIndex",-1),h(this,"currentColumnIndex",0),h(this,"originalStopAtOverflow"),h(this,"inHeader"),h(this,"inFooter"),this.originalStopAtOverflow=t.stopAtOverflow,t.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(e){let t=this.formattingContext.colWidths,i=0;for(let n=0;n<e.colSpan;n++)i+=t[e.anchorSlot.columnIndex+n];return i+=this.formattingContext.inlineBorderSpacing*(e.colSpan-1),i}layoutCell(e,t,i){let n=e.rowIndex,r=e.columnIndex,o=e.colSpan,s=t.viewNode;t.verticalAlign,o>1&&(ce(s,"box-sizing","border-box"),ce(s,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(e)}px`));let a=s.ownerDocument.createElement("div");s.appendChild(a);let l=new uu(this.column,a,t);return this.formattingContext.addCellFragment(n,r,l),1===i.primary.steps.length&&i.primary.after&&(l.empty=!0),l.pseudoColumn.layout(i,!0).thenReturn(!0)}hasBrokenCellAtSlot(e){let t=this.formattingContext.cellBreakPositions[0];return!!t&&t.cell.anchorSlot.columnIndex===e}extractRowSpanningCellBreakPositions(){let e=this.formattingContext.cellBreakPositions;if(0===e.length)return[];let t=[],i=0;do{let n=e[i],r=n.cell.rowIndex;if(r<this.currentRowIndex){let o=t[r];o||(o=t[r]=[]),o.push(n),e.splice(i,1)}else i++}while(i<e.length);return t}layoutRowSpanningCellsFromPreviousFragment(e){let t=this.formattingContext,i=this.extractRowSpanningCellBreakPositions(),n=i.reduce(e=>e+1,0);if(0===n)return qn(!0);let r=this.column.layoutContext,o=e.nodeContext;o.viewNode.parentNode.removeChild(o.viewNode);let s=Gn("layoutRowSpanningCellsFromPreviousFragment"),a=qn(!0),l=0,h=[];return i.forEach(e=>{a=a.thenAsync(()=>{let i=Wo(e[0].cellNodePosition.steps[1],o.parent);return r.setCurrent(i,!1).thenAsync(()=>{let o=qn(!0),s=0;function a(e){for(;s<e;){if(!h.includes(s)){let e=i.viewNode.ownerDocument.createElement("td");ce(e,"padding","0"),i.viewNode.appendChild(e)}s++}}return e.forEach(e=>{o=o.thenAsync(()=>{let t=e.cell;a(t.anchorSlot.columnIndex);let o=e.cellNodePosition,u=Wo(o.steps[0],i);return u.offsetInNode=o.offsetInNode,u.after=o.after,u.fragmentIndex=o.steps[0].fragmentIndex+1,r.setCurrent(u,!1).thenAsync(()=>{let i=e.breakChunkPosition;for(let e=0;e<t.colSpan;e++)h.push(s+e);return s+=t.colSpan,this.layoutCell(t,u,i).thenAsync(()=>(u.viewNode.rowSpan=t.rowIndex+t.rowSpan-this.currentRowIndex+n-l,qn(!0)))})})}),o.thenAsync(()=>(a(t.getColumnCount()),l++,qn(!0)))})})}),a.then(()=>{r.setCurrent(o,!0,e.atUnforcedBreak).then(()=>{s.finish(!0)})}),s.result()}startTableRow(e){if(this.inHeader||this.inFooter)return qn(!0);let t=e.nodeContext,i=this.formattingContext;return this.currentRowIndex<0?(t.sourceNode,this.currentRowIndex=i.findRowIndexBySourceNode(t.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(e).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge)&&0===i.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length&&(this.resetColumn(),t.overflow=!0,e.break=!0),qn(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(e=>{let t=this.formattingContext.cellBreakPositions[e.columnIndex];if(t&&t.cell.anchorSlot.columnIndex==e.anchorSlot.columnIndex){let e=t.cellNodePosition.steps[0],i=this.column.layoutContext.xmldoc.getElementOffset(e.node);Oh(i,e.fragmentIndex+1,1)}})}startTableCell(e){if(this.inHeader||this.inFooter)return qn(!0);let t=e.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let i=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!i)return e.break=!0,qn(!0);let n=t.copy().modify();n.after=!0,e.nodeContext=n;let r,o=Gn("startTableCell");if(this.hasBrokenCellAtSlot(i.anchorSlot.columnIndex)){let e=this.formattingContext.cellBreakPositions.shift();t.fragmentIndex=e.cellNodePosition.steps[0].fragmentIndex+1,r=qn(e.breakChunkPosition)}else r=this.column.nextInTree(t,e.atUnforcedBreak).thenAsync(e=>{e.viewNode&&t.viewNode.removeChild(e.viewNode);let i=jo(e,0);return qn(new Zo(i))});return r.then(n=>{this.layoutCell(i,t,n).then(()=>{this.afterNonInlineElementNode(e),this.currentColumnIndex++,o.finish(!0)})}),o.result()}startNonInlineBox(e){let t=bu(e,this.formattingContext,this.column);if(t)return t;let i=e.nodeContext,n=this.formattingContext.getRepetitiveElements(),r=i.display;return"table-header-group"===r&&n&&n.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!0,qn(!0)):"table-footer-group"===r&&n&&n.isFooterSourceNode(i.sourceNode)?(this.inFooter=!0,qn(!0)):"table-row"===r?this.startTableRow(e):"table-cell"===r?this.startTableCell(e):qn(!0)}endNonInlineBox(e){let t=e.nodeContext;if("table-row"===t.display&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let e=t.copy().modify();e.after=!1;let i=new pu(this.currentRowIndex,e,this.formattingContext);this.column.breakPositions.push(i)}return qn(!0)}afterNonInlineElementNode(t){let i=t.nodeContext,n=this.formattingContext.getRepetitiveElements(),r=i.display;if("table-header-group"===r?n&&!n.allowInsertRepeatitiveElements&&n.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!1,i.viewNode.parentNode.removeChild(i.viewNode)):ce(i.viewNode,"display","table-row-group"):"table-footer-group"===r&&(n&&!n.allowInsertRepeatitiveElements&&n.isFooterSourceNode(i.sourceNode)?(this.inFooter=!1,i.viewNode.parentNode.removeChild(i.viewNode)):ce(i.viewNode,"display","table-row-group")),r&&e.ignoreList[r])i.viewNode.parentNode.removeChild(i.viewNode);else{if(i.sourceNode!==this.formattingContext.tableSourceNode)return super.afterNonInlineElementNode(t);i.overflow=this.column.checkOverflowAndSaveEdge(i,null),this.resetColumn(),t.break=!0}return qn(!0)}};h(yu,"ignoreList",{"table-caption":!0,"table-column-group":!0,"table-column":!0});var wu=yu,xu=[],Su=class{layoutEntireTable(e,t){let i=e.formattingContext,n=new vu(i,t);return new ra(n,t.layoutContext).iterate(e)}getColumnWidths(e,t,i,n){let r=e.ownerDocument,o=r.createElement("tr"),s=[];for(let e=0;e<t;e++){let e=r.createElement("td");o.appendChild(e),s.push(e)}e.parentNode.insertBefore(o,e.nextSibling);let a=s.map(e=>{let t=Os(n,e,i),r=i?t.height:t.width;return Math.ceil(r)});return e.parentNode.removeChild(o),a}getColGroupElements(e){let t=[],i=e.firstElementChild;for(;i;)"colgroup"===i.localName&&t.push(i),i=i.nextElementSibling;return t}normalizeAndGetColElements(e){let t=[];return e.forEach(e=>{let i=e.span;e.removeAttribute("span");let n=e.firstElementChild;for(;n;){if("col"===n.localName){let r=n.span;for(n.removeAttribute("span"),i-=r;r-- >1;){let i=n.cloneNode(!0);e.insertBefore(i,n),t.push(i)}t.push(n)}n=n.nextElementSibling}for(;i-- >0;)n=e.ownerDocument.createElement("col"),e.appendChild(n),t.push(n)}),t}addMissingColElements(e,t,i,n){if(e.length<i){let r=n.ownerDocument.createElement("colgroup");t.push(r);for(let t=e.length;t<i;t++){let t=n.ownerDocument.createElement("col");r.appendChild(t),e.push(t)}}}normalizeColGroups(e,t,i){let n=e.vertical,r=e.lastRowViewNode;if(!r)return;e.lastRowViewNode=null;let o=r.ownerDocument.createDocumentFragment(),s=e.getColumnCount();if(!(s>0))return void(e.colGroups=o);let a=e.colWidths=this.getColumnWidths(r,s,n,i.clientLayout),l=this.getColGroupElements(t),h=this.normalizeAndGetColElements(l);this.addMissingColElements(h,l,s,t),h.forEach((e,t)=>{ce(e,n?"height":"width",`${a[t]}px`)}),l.forEach(e=>{o.appendChild(e.cloneNode(!0))}),e.colGroups=o}doInitialLayout(e,t){let i=e.formattingContext;i.vertical=e.vertical,i.initializeRepetitiveElements(e.vertical),e.sourceNode;let n=function(e){let t=xu.findIndex(t=>t.root===e),i=xu[t];return i?i.tableLayoutOption:null}(e.sourceNode);!function(e){let t=xu.findIndex(t=>t.root===e);t>=0&&xu.splice(t,1)}(e.sourceNode);let r=Gn("TableLayoutProcessor.doInitialLayout"),o=e.copy();return this.layoutEntireTable(e,t).then(s=>{let a=s.viewNode,l=Os(t.clientLayout,a,t.vertical),h=t.vertical?l.left:l.bottom;if(h+=(t.vertical?-1:1)*Ys(e,t.collectElementsOffset()).current,!(t.isOverflown(h)||n&&n.calculateBreakPositionsInside))return t.breakPositions.push(new Pu(o)),void r.finish(s);this.normalizeColGroups(i,a,t),i.updateCellSizes(t.clientLayout),r.finish(null)}),r.result()}addCaptions(e,t,i){let n=e.captions;n.forEach((e,r)=>{e&&(t.insertBefore(e.viewNode,i),"top"===e.side&&(n[r]=null))})}addColGroups(e,t,i){e.colGroups&&0===this.getColGroupElements(t).length&&(t.insertBefore(e.colGroups.cloneNode(!0),i),ce(t,"table-layout","fixed"),ce(t,e.vertical?"height":"width",`${e.tableWidth}px`))}removeColGroups(e,t){if(e.colGroups&&t){let e=this.getColGroupElements(t);e&&e.forEach(e=>{t.removeChild(e)})}}doLayout(e,t){let i=e.formattingContext,n=i.getRootViewNode(e),r=n.firstChild;this.addCaptions(i,n,r),this.addColGroups(i,n,r);let o=new wu(i,t),s=new ra(o,t.layoutContext),a=Gn("TableFormattingContext.doLayout");return s.iterate(e).thenFinish(a),a.result()}layout(e,t,i){let n,r=e.formattingContext,o=r.getRootViewNode(e),s=Gn("TableFormattingContext.layout");return o?(i&&ou(e.parent,t),n=new ku(r,this).layout(e,t)):n=t.buildDeepElementView(e),n.then(e=>{s.finish(e),t.element.hasAttribute("data-vivliostyle-column-height-adjusted")&&(ce(t.element,"width",`${t.width}px`),ce(t.element,"height",`${t.height}px`),t.element.removeAttribute("data-vivliostyle-column-height-adjusted"))}),s.result()}createEdgeBreakPosition(e,t,i,n){return new du(e,t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return Cu(e),!1}finishBreak(e,t,i,n){let r=t.formattingContext;if("table-row"===t.display){t.sourceNode;let i,n=r.findRowIndexBySourceNode(t.sourceNode);if(r.cellBreakPositions=[],i=t.after?r.getRowSpanningCellsOverflowingTheRow(n):r.getCellsFallingOnRow(n),i.length){let o=Gn("TableLayoutProcessor.finishBreak"),s=0;return o.loopWithFrame(e=>{if(s===i.length)return void e.breakLoop();let t=i[s++],o=r.getCellFragmentOfCell(t),a=o.findAcceptableBreakPosition().nodeContext,l=o.cellNodeContext,h=l.toNodePosition(),u=new Zo(a.toNodePosition());r.cellBreakPositions.push({cellNodePosition:h,breakChunkPosition:u,cell:t});let c=l.viewNode;o.column.layoutContext.processFragmentedBlockEdge(o.cellNodeContext),n<t.rowIndex+t.rowSpan-1&&(c.rowSpan=n-t.rowIndex+1),o.empty?e.continueLoop():o.pseudoColumn.finishBreak(a,!1,!0).then(()=>{(function(e,t,i){let n=t.getRepetitiveElements();if(!n||!n.isHeaderRegistered()&&!n.isFooterRegistered())return;let r=t.vertical,o=e.column,s=e.pseudoColumn.getColumnElement(),a=e.cellNodeContext.viewNode,l=Os(o.clientLayout,a,r),h=o.getComputedPaddingBorder(a);if(r){ce(s,"max-width",`${l.right-o.footnoteEdge-n.calculateOffset(i)-h.right}px`)}else{ce(s,"max-height",`${o.footnoteEdge-n.calculateOffset(i)-l.top-h.top}px`)}})(o,r,a),e.continueLoop()})}).then(()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),Cu(t),r.finishFragment(),o.finish(!0)}),o.result()}}return Cu(t),r.finishFragment(),ea.finishBreak(e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Js.prototype.clearOverflownViewNodes(e,t,i,n)}};function Cu(e){let t,i="table-row"===e.display?e.viewNode.parentElement:"table"===e.display?e.viewNode.querySelector("tbody"):null;if(!i)return;try{t=i.querySelectorAll(":scope>tr:has(>:empty):not(:has(>:not([rowspan]:not([rowspan='1']),:empty)))")}catch(e){return}if(0===t.length)return;let n=Array.from(t).reduce((t,i)=>{let n=i.getBoundingClientRect();return t+(e.vertical?n.width:n.height)},0),r=t[t.length-1],o=Array.from(i.children).indexOf(r),s=Array.from(r.children).reduce((e,t)=>{let n=t.rowSpan;return n>1&&o+n<i.childElementCount?Math.max(e,n):e},0),a=s?i.children[o+s-1]:i.lastElementChild;if(a!=i.lastElementChild&&a.querySelector(":scope>*>div>div"))for(let e=a;e&&e!==i.lastElementChild;e=e.nextElementSibling)if(e.querySelector(":scope>[rowspan]:not([rowspan='1'])")){a=e;break}let l=a.getBoundingClientRect(),h=n+(e.vertical?l.width:l.height);ce(a,e.vertical?"width":"height",`${h}px`)}var ku=class extends ia{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.tableFormattingContext.getRepetitiveElements();return t&&t.doneInitialLayout?(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&t&&t.preventSkippingHeader(),new Tu(this.tableFormattingContext,this.processor)):new Eu(this.tableFormattingContext,this.processor)}clearNodes(e){super.clearNodes(e);let t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}},Eu=class extends Jh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}},Pu=class extends Ks{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new Nu(this.position.sourceNode))}},Nu=class e{constructor(e){this.tableRootNode=e,h(this,"flagmentLayoutConstraintType","EntireTable")}allowLayout(e,t,i){return e.overflow,!1}nextCandidate(e){return!0}postLayout(e,t,i,n){t.sourceNode,xu.push({root:t.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(e,t){return qn(!0)}equalsTo(t){return t instanceof e&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},Tu=class extends Qh{constructor(e,t){super(e),this.processor=t}doLayout(e,t){let i=this.formattingContext.getRepetitiveElements();if(i&&!i.isAfterLastContent(e)){let i=new Iu(e);t.fragmentLayoutConstraints.some(e=>i.equalsTo(e))||t.fragmentLayoutConstraints.unshift(i)}return this.processor.doLayout(e,t)}},Iu=class e extends iu{constructor(e){super(e),h(this,"flagmentLayoutConstraintType","TableRow"),h(this,"cellFragmentLayoutConstraints",[])}allowLayout(e,t,i){let n=this.getRepetitiveElements();return!(n&&!i.pseudoParent&&!Vs(this.nodeContext.viewNode)&&n.isEnableToUpdateState())||!(t&&!e||e&&e.overflow)}nextCandidate(e){let t=this.nodeContext.formattingContext;return!!this.collectCellFragmentLayoutConstraints(e,t).some(t=>t.constraints.some(t=>t.nextCandidate(e)))||super.nextCandidate(e)}postLayout(e,t,i,n){let r=this.nodeContext.formattingContext;if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(t,r),this.cellFragmentLayoutConstraints.forEach(t=>{t.constraints.forEach(r=>{r.postLayout(e,t.breakPosition,i,n)})}),!e){let e=r.getRootViewNode(this.nodeContext);(new Su).removeColGroups(r,e),this.removeDummyRowNodes(i)}super.postLayout(e,t,i,n)}finishBreak(e,t){this.nodeContext.formattingContext;let i=Gn("finishBreak"),n=this.cellFragmentLayoutConstraints.reduce((e,t)=>e.concat(t.constraints.map(e=>({constraint:e,breakPosition:t.breakPosition}))),[]),r=0;return i.loop(()=>{if(r<n.length){let e=n[r++];return e.constraint.finishBreak(e.breakPosition,t).thenReturn(!0)}return qn(!1)}).then(()=>{i.finish(!0)}),i.result().thenAsync(()=>super.finishBreak(e,t))}removeDummyRowNodes(e){if(e&&"table-row"===e.display&&e.viewNode)for(;e.viewNode.previousElementSibling;){let t=e.viewNode.previousElementSibling;t.parentNode&&t.parentNode.removeChild(t)}}collectCellFragmentLayoutConstraints(e,t){return this.getCellFragemnts(e,t).map(e=>({constraints:e.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:e.breakPosition}))}getCellFragemnts(e,t){let i=Number.MAX_VALUE;e&&"table-row"===e.display&&(e.sourceNode,i=t.findRowIndexBySourceNode(e.sourceNode)+1),i=Math.min(t.cellFragments.length,i);let n=[];for(let e=0;e<i;e++)t.cellFragments[e]&&t.cellFragments[e].forEach(e=>{e&&n.push({fragment:e,breakPosition:e.findAcceptableBreakPosition().nodeContext})});return n}getElementsOffsetsForTableCell(e){let t=this.nodeContext.formattingContext,i=t.findCellFromColumn(e);return i?t.collectElementsOffsetOfUpperCells(i):t.collectElementsOffsetOfHighestColumn()}equalsTo(t){return t instanceof e&&this.nodeContext.formattingContext===t.nodeContext.formattingContext}},Au=new Su;function _u(e){return e.reduce((e,t)=>e+t,0)/e.length}O("RESOLVE_FORMATTING_CONTEXT",function(e,t,i,n,r,o){if(!t)return null;if(i===ci.table){let t=e.parent;return new fu(t?t.formattingContext:null,e.sourceNode)}return null}),O("RESOLVE_LAYOUT_PROCESSOR",function(e){return e instanceof fu?Au:null});var Ru=class{constructor(e,t){this.layoutResult=e,this.penalty=t}};function Lu(e){return e.vertical?e.width:e.height}function Fu(e,t){e.vertical?e.width=t:e.height=t}var Ou=class{constructor(e,t,i){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=i,h(this,"originalContainerBlockSize"),this.originalContainerBlockSize=Lu(e)}balanceColumns(e){let t=Gn("ColumnBalancer#balanceColumns");this.preBalance(e),this.savePageFloatLayoutContexts(e),this.layoutContainer.clear();let i=[this.createTrialResult(e)];return t.loopWithFrame(e=>{this.hasNextCandidate(i)?(this.updateCondition(i),this.columnGenerator().then(t=>{this.savePageFloatLayoutContexts(t),this.layoutContainer.clear(),t?(i.push(this.createTrialResult(t)),e.continueLoop()):e.breakLoop()})):e.breakLoop()}).then(()=>{let e=i.reduce((e,t)=>t.penalty<e.penalty?t:e,i[0]);this.restoreContents(e.layoutResult),this.postBalance(),t.finish(e.layoutResult)}),t.result()}createTrialResult(e){let t=this.calculatePenalty(e);return new Ru(e,t)}preBalance(e){}postBalance(){Fu(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){let t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){let t=this.layoutContainer.element;e.columns.forEach(e=>{t.appendChild(e.element)}),e.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}};function Bu(e){let t=e[e.length-1];if(0===t.penalty)return!1;let i=e[e.length-2];if(i&&t.penalty>=i.penalty)return!1;let n=t.layoutResult.columns;return Math.max.apply(null,n.map(e=>e.computedBlockSize))>Math.max.apply(null,n.map(e=>e.getMaxBlockSizeOfPageFloats()))+1}function Mu(e,t){var i;let n=e[e.length-1].layoutResult.columns,r=Math.max.apply(null,n.map(e=>isNaN(e.blockDistanceToBlockEndFloats)?e.computedBlockSize:e.computedBlockSize-e.blockDistanceToBlockEndFloats+1))-1;if(r<Lu(t)?Fu(t,r):Fu(t,Lu(t)-1),t.vertical){let e=parseFloat(null==(i=t.element.style)?void 0:i.width);t.originX=e-t.width}}var zu=class extends Ou{constructor(e,t,i,n){super(i,e,t),this.columnCount=n,h(this,"originalPosition",null),h(this,"foundUpperBound",!1)}preBalance(e){let t=e.columns.reduce((e,t)=>e+t.computedBlockSize,0);Fu(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):null===e}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let t=e.columns;return Du(t)?1/0:Math.max.apply(null,t.map(e=>e.computedBlockSize))}hasNextCandidate(e){if(1===e.length)return!0;if(this.foundUpperBound)return Bu(e);{let t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!Du(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):Lu(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)Mu(e,this.layoutContainer);else{let e=Math.min(this.originalContainerBlockSize,Lu(this.layoutContainer)+.1*this.originalContainerBlockSize);Fu(this.layoutContainer,e)}}};function Du(e){if(e.length<=1)return!1;let t=e[e.length-1].computedBlockSize,i=e.slice(0,e.length-1);return i.every(e=>t>e.computedBlockSize+6)}var Vu=class extends Ou{constructor(e,t,i){super(i,e,t)}calculatePenalty(e){if(e.columns.every(e=>0===e.computedBlockSize))return 1/0;let t=e.columns.filter(e=>!e.pageBreakType).map(e=>e.computedBlockSize);return function(e){let t=_u(e);return _u(e.map(e=>{let i=e-t;return i*i}))}(t)}hasNextCandidate(e){return Bu(e)}updateCondition(e){Mu(e,this.layoutContainer)}},Uu=new Set(["decimal","disc","square","circle","disclosure-open","disclosure-closed"]),Hu=new Set(["cyclic","numeric","alphabetic","symbolic","additive","fixed"]),$u=new Set(["fixed","extends"]);function ju(e){return e instanceof Yt&&"none"!==e.name.toLowerCase()}function Wu(e){return e.name}function Gu(e){return e instanceof qt||e instanceof Yt}function qu(e){return e instanceof qt?e.str:e.name}function Xu(e){if(Gu(e))return!0;if(e instanceof ri&&2===e.values.length){let t=e.values[0],i=e.values[1];return Gu(t)&&Gu(i)}return!1}function Yu(e){return e instanceof Qt||e instanceof Yt&&"infinite"===e.name}function Ku(e,t){return e instanceof Qt?e.num:t?-1/0:1/0}function Zu(e){if(!(e instanceof ri&&2===e.values.length))return!1;let t=e.values[0],i=e.values[1];return!(!Yu(t)||!Yu(i))&&!(Ku(t,!0)>Ku(i,!1))}function Ju(e){return e instanceof Yt&&"auto"===e.name||Zu(e)||e instanceof oi&&e.values.length>=1&&e.values.every(e=>Zu(e))}function Qu(e){return e instanceof Yt?null:(Zu(e)?[e]:e.values).map(e=>function(e){return{lower:Ku(e.values[0],!0),upper:Ku(e.values[1],!1)}}(e))}function ec(e){if(!(e instanceof ri&&2===e.values.length))return!1;let t=e.values[0],i=e.values[1];return t instanceof Qt&&t.num>=0&&Gu(i)||Gu(t)&&i instanceof Qt&&i.num>=0}function tc(e){let[t,i]=e.values;return t instanceof Qt?[t.num,qu(i)]:[i.num,qu(t)]}function ic(e){return ec(e)}function nc(e){return Gu(e)||e instanceof ri&&e.values.length>=1&&e.values.every(e=>Gu(e))}function rc(e){if(ec(e))return!0;if(e instanceof oi&&e.values.length>=1){let t=1/0;for(let i of e.values){if(!ec(i))return!1;let[e]=tc(i);if(e>=t)return!1;t=e}return!0}return!1}var oc=new Set(["auto","bullets","numbers","words","spell-out"]);function sc(e,t){switch(e){case"system":return function(e){if(e instanceof Yt)return Hu.has(e.name);if(e instanceof ri&&2===e.values.length){let t=e.values[0],i=e.values[1];if(t instanceof Yt){let e=t.name;return $u.has(e)&&("fixed"===e&&i instanceof Qt||"extends"===e&&ju(i))}}return!1}(t);case"negative":return Xu(t);case"prefix":case"suffix":return Gu(t);case"range":return Ju(t);case"pad":return ic(t);case"fallback":return ju(t);case"symbols":return nc(t);case"additive-symbols":return rc(t);case"speak-as":return function(e){return e instanceof Yt&&oc.has(e.name)||ju(e)}(t);default:return!0}}function ac(e,t){var i;let n=null==(i=e[t])?void 0:i.value;return null==n?null:n}function lc(e){let t=e.get("decimal");return t||(t=Oc.createDecimal(e),e.set("decimal",t)),t}var hc,uc,cc,dc,pc,fc,gc,mc,bc,vc,yc,wc,xc,Sc,Cc,kc,Ec,Pc,Nc,Tc,Ic,Ac,_c,Rc,Lc=class e{constructor(e,t){f(this,kc),h(this,"_store"),f(this,hc),f(this,uc),f(this,cc),f(this,dc),f(this,pc),f(this,fc),f(this,gc),f(this,mc),this._store=e;let i=ac(t,"negative");g(this,hc,i&&Xu(i)?function(e){if(Gu(e))return{prefix:qu(e),suffix:null};{let t=e.values[0],i=e.values[1];return{prefix:qu(t),suffix:qu(i)}}}(i):null);let n=ac(t,"prefix");g(this,uc,n&&Gu(n)?qu(n):null);let r=ac(t,"suffix");g(this,cc,r&&Gu(r)?qu(r):null);let o=ac(t,"range");g(this,dc,o&&Ju(o)?Qu(o):null);let s=ac(t,"pad");g(this,pc,s&&ic(s)?function(e){let[t,i]=tc(e);return{minLength:t,symbol:i}}(s):null);let a=ac(t,"fallback");g(this,fc,a&&ju(a)?Wu(a):null);let l=ac(t,"symbols");g(this,gc,l&&nc(l)?function(e){return Gu(e)?[qu(e)]:e.values.map(e=>qu(e))}(l):null);let u=ac(t,"additive-symbols");g(this,mc,u&&rc(u)?function(e){if(ec(e)){let[t,i]=tc(e);return[{weight:t,symbol:i}]}return e.values.map(e=>{let[t,i]=tc(e);return{weight:t,symbol:i}})}(u):null)}static create(e,t){return function(e){let t=ac(e,"system");return t instanceof Yt&&"cyclic"===t.name}(t)?new Bc(e,t):function(e){let t=ac(e,"system");if(t instanceof Yt&&"fixed"===t.name)return!0;if(t instanceof ri&&2===t.values.length){let[e,i]=t.values;return e instanceof Yt&&"fixed"===e.name&&i instanceof Qt}return!1}(t)?new Mc(e,t):function(e){let t=ac(e,"system");return t instanceof Yt&&"alphabetic"===t.name}(t)?new Hc(e,t):function(e){let t=ac(e,"system");return t instanceof Yt&&"numeric"===t.name}(t)?new $c(e,t):function(e){let t=ac(e,"system");return t instanceof Yt&&"additive"===t.name}(t)?new jc(e,t):function(e){let t=ac(e,"system");if(t instanceof ri&&2===t.values.length){let[e,i]=t.values;return e instanceof Yt&&"extends"===e.name&&ju(i)}return!1}(t)?new Jc(e,t):new Uc(e,t)}static createDecimal(t){return new $c(t,p(e,bc))}static createDisc(t){return new Bc(t,p(e,vc))}static createSquare(t){return new Bc(t,p(e,yc))}static createCircle(t){return new Bc(t,p(e,wc))}static createDisclosureOpen(t){return new Bc(t,p(e,xc))}static createDisclosureClosed(e){return new Bc(e,p(this,Sc))}static createNone(t){return new Bc(t,p(e,Cc))}static get CHINESE_LONGHAND_NAMES(){return od.NAMES}static createChineseLonghand(e,t){return new od(e,t)}static createEthiopicNumeric(e){return new ld(e)}_getNegative(){return p(this,hc)}static _getNegativeFrom(e){return e._getNegative()}_getPrefix(){return p(this,uc)}static _getPrefixFrom(e){return e._getPrefix()}_getSuffix(){return p(this,cc)}static _getSuffixFrom(e){return e._getSuffix()}static _getAutoRangeFrom(e){return e._getAutoRange()}_getRange(){return p(this,dc)}static _getRangeFrom(e){return e._getRange()}_getPad(){return p(this,pc)}static _getPadFrom(e){return e._getPad()}_getFallback(){var e;return null!=(e=this._store.get(p(this,fc)))?e:null}static _getFallbackFrom(e){return e._getFallback()}_getSymbols(){return p(this,gc)}static _getSymbolsFrom(e){return e._getSymbols()}_getAdditiveSymbols(){return p(this,mc)}static _getAdditiveSymbolsFrom(e){return e._getAdditiveSymbols()}static _useNegativeSignFrom(e,t){return e._usesNegativeSign(t)}static _generateInitialRepresentationFrom(e,t){return e._generateInitialRepresentation(t)}format(e){return m(this,kc,Rc).call(this,e,new Set)}formatMarker(e){return m(this,kc,Pc).call(this)+this.format(e)+m(this,kc,Nc).call(this)}};hc=new WeakMap,uc=new WeakMap,cc=new WeakMap,dc=new WeakMap,pc=new WeakMap,fc=new WeakMap,gc=new WeakMap,mc=new WeakMap,bc=new WeakMap,vc=new WeakMap,yc=new WeakMap,wc=new WeakMap,xc=new WeakMap,Sc=new WeakMap,Cc=new WeakMap,kc=new WeakSet,Ec=function(){var e;return null!=(e=this._getNegative())?e:{prefix:"-",suffix:null}},Pc=function(){var e;return null!=(e=this._getPrefix())?e:""},Nc=function(){var e;return null!=(e=this._getSuffix())?e:". "},Tc=function(){var e;return null!=(e=this._getRange())?e:this._getAutoRange()},Ic=function(){var e;return null!=(e=this._getPad())?e:{minLength:0,symbol:""}},Ac=function(){var e;return null!=(e=this._getFallback())?e:lc(this._store)},_c=function(e,t){let{minLength:i,symbol:n}=m(this,kc,Ic).call(this);if(0===i||""===n)return e;let{prefix:r,suffix:o}=m(this,kc,Ec).call(this),s=t?[...r].length+(o?[...o].length:0):0,a=i-[...e].length-s;if(a<=0)return e;let l=[...n].length,h=Math.ceil(a/l);return n.repeat(h)+e},Rc=function(e,t){var i,n,r;if(t.has(this))return m(i=lc(this._store),kc,Rc).call(i,e,new Set);if(t.add(this),!function(e,t){return t.some(({lower:t,upper:i})=>e>=t&&e<=i)}(e,m(this,kc,Tc).call(this))){let i=m(this,kc,Ac).call(this);return m(n=i,kc,Rc).call(n,e,t)}let o=this._usesNegativeSign(e),s=o?Math.abs(e):e,a=this._generateInitialRepresentation(s);if(null===a){let i=m(this,kc,Ac).call(this);return m(r=i,kc,Rc).call(r,e,t)}let l=m(this,kc,_c).call(this,a,o);if(o){let{prefix:e,suffix:t}=m(this,kc,Ec).call(this);l=e+l+(null!=t?t:"")}return l},f(Lc,bc,{system:new Pa(Kt("numeric"),0),symbols:new Pa(new ri([new qt("0"),new qt("1"),new qt("2"),new qt("3"),new qt("4"),new qt("5"),new qt("6"),new qt("7"),new qt("8"),new qt("9")]),0)}),f(Lc,vc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(" "),0)}),f(Lc,yc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(" "),0)}),f(Lc,wc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(" "),0)}),f(Lc,xc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(" "),0)}),f(Lc,Sc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(" "),0)}),f(Lc,Cc,{system:new Pa(Kt("cyclic"),0),symbols:new Pa(new qt(""),0),suffix:new Pa(new qt(""),0)});var Fc,Oc=Lc,Bc=class extends Oc{constructor(e,t){super(e,t)}_getAutoRange(){return[{lower:-1/0,upper:1/0}]}_usesNegativeSign(e){return!1}_generateInitialRepresentation(e){let t=this._getSymbols();if(!t||0===t.length)return null;let i=t.length;return t[((e-1)%i+i)%i]}},Mc=class extends Oc{constructor(e,t){super(e,t),f(this,Fc),g(this,Fc,function(e){let t=ac(e,"system");return t instanceof Yt?1:t.values[1].num}(t))}_getAutoRange(){return[{lower:-1/0,upper:1/0}]}_usesNegativeSign(e){return!1}_generateInitialRepresentation(e){var t;let i=this._getSymbols();return i&&0!==i.length&&null!=(t=i[e-p(this,Fc)])?t:null}};Fc=new WeakMap;var zc,Dc,Vc,Uc=class extends Oc{constructor(e,t){super(e,t)}_getAutoRange(){return[{lower:1,upper:1/0}]}_usesNegativeSign(e){return e<0}_generateInitialRepresentation(e){let t=this._getSymbols();if(!t||0===t.length||e<1)return null;let i=t.length,n=t[(e-1)%i],r=Math.ceil(e/i);return n.repeat(r)}},Hc=class extends Oc{constructor(e,t){super(e,t)}_getAutoRange(){return[{lower:1,upper:1/0}]}_usesNegativeSign(e){return e<0}_generateInitialRepresentation(e){let t=this._getSymbols();if(!t||t.length<2||e<1)return null;let i=t.length,n="",r=e;for(;0!==r;)r-=1,n=t[r%i]+n,r=Math.floor(r/i);return n}},$c=class extends Oc{constructor(e,t){super(e,t)}_getAutoRange(){return[{lower:-1/0,upper:1/0}]}_usesNegativeSign(e){return e<0}_generateInitialRepresentation(e){let t=this._getSymbols();if(!t||t.length<2)return null;let i=t.length;if(0===e)return t[0];let n="",r=e;for(;0!==r;)n=t[r%i]+n,r=Math.floor(r/i);return n}},jc=class extends Oc{constructor(e,t){super(e,t)}_getAutoRange(){return[{lower:0,upper:1/0}]}_usesNegativeSign(e){return e<0}_generateInitialRepresentation(e){let t=this._getAdditiveSymbols();if(!t||0===t.length)return null;let i="";if(0===e){let e=t.find(e=>0===e.weight);return e?e.symbol:null}let n=e;for(let e of t){let{weight:t,symbol:r}=e;if(0===t||t>n)continue;let o=Math.floor(n/t);if(i+=r.repeat(o),n-=t*o,0===n)return i}return null}},Wc=class extends Oc{constructor(e,t){super(e,t),f(this,Dc),f(this,zc);let i=function(e){return Wu(ac(e,"system").values[1])}(t),n=i.toLowerCase();g(this,zc,"disc"===n||"circle"===n||"square"===n||"disclosure-open"===n||"disclosure-closed"===n?n:i)}_getNegative(){var e;return null!=(e=super._getNegative())?e:Oc._getNegativeFrom(m(this,Dc,Vc).call(this))}_getPrefix(){var e;return null!=(e=super._getPrefix())?e:Oc._getPrefixFrom(m(this,Dc,Vc).call(this))}_getSuffix(){var e;return null!=(e=super._getSuffix())?e:Oc._getSuffixFrom(m(this,Dc,Vc).call(this))}_getAutoRange(){return Oc._getAutoRangeFrom(m(this,Dc,Vc).call(this))}_getRange(){var e;return null!=(e=super._getRange())?e:Oc._getRangeFrom(m(this,Dc,Vc).call(this))}_getPad(){var e;return null!=(e=super._getPad())?e:Oc._getPadFrom(m(this,Dc,Vc).call(this))}_getFallback(){var e;return null!=(e=super._getFallback())?e:Oc._getFallbackFrom(m(this,Dc,Vc).call(this))}_getSymbols(){var e;return null!=(e=super._getSymbols())?e:Oc._getSymbolsFrom(m(this,Dc,Vc).call(this))}_getAdditiveSymbols(){var e;return null!=(e=super._getAdditiveSymbols())?e:Oc._getAdditiveSymbolsFrom(m(this,Dc,Vc).call(this))}_usesNegativeSign(e){return Oc._useNegativeSignFrom(m(this,Dc,Vc).call(this),e)}_generateInitialRepresentation(e){return super._getSymbols()||super._getAdditiveSymbols()?null:Oc._generateInitialRepresentationFrom(m(this,Dc,Vc).call(this),e)}};zc=new WeakMap,Dc=new WeakSet,Vc=function(e=new Set){var t;if(e.has(this))return lc(this._store);e.add(this);let i=this._store.get(p(this,zc));return i?i instanceof Wc?m(t=i,Dc,Vc).call(t,e):i:lc(this._store)};var Gc,qc,Xc,Yc,Kc,Zc,Jc=Wc,Qc=class e extends Oc{constructor(t,i){let{chars:n,descriptors:r}=p(e,Kc).get(i);super(t,r),f(this,Zc),g(this,Zc,n)}_getAutoRange(){return[{lower:-9999,upper:9999}]}_usesNegativeSign(e){return e<0}_generateInitialRepresentation(e){let t=p(this,Zc);if(0===e)return t.digits[0];let i=[],n=0,r=e;for(;r>0;)i.unshift({digit:r%10,position:n}),r=Math.floor(r/10),n++;let o=t.informal&&e>=10&&e<=19,s="",a=!1;for(let e=0;e<i.length;e++){let{digit:n,position:r}=i[e],l=e===i.length-1;0===n?!l&&!a&&(a=!0):(a&&(s+=t.digits[0],a=!1),o&&1===r?s+=t.markers[r]:(s+=t.digits[n],r>0&&(s+=t.markers[r])))}return s}};Gc=new WeakMap,qc=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,Kc=new WeakMap,Zc=new WeakMap,f(Qc,Gc,{chars:{digits:["","","","","","","","","",""],markers:["","","",""],informal:!0},descriptors:{suffix:new Pa(new qt(""),0),fallback:new Pa(Kt("cjk-decimal"),0),range:new Pa(new ri([new Qt(-9999),new Qt(9999)]),0),negative:new Pa(new qt(""),0)}}),f(Qc,qc,{chars:{digits:["","","","","","","","","",""],markers:["","","",""],informal:!1},descriptors:{suffix:new Pa(new qt(""),0),fallback:new Pa(Kt("cjk-decimal"),0),range:new Pa(new ri([new Qt(-9999),new Qt(9999)]),0),negative:new Pa(new qt(""),0)}}),f(Qc,Xc,{chars:{digits:["","","","","","","","","",""],markers:["","","",""],informal:!0},descriptors:{suffix:new Pa(new qt(""),0),fallback:new Pa(Kt("cjk-decimal"),0),range:new Pa(new ri([new Qt(-9999),new Qt(9999)]),0),negative:new Pa(new qt(""),0)}}),f(Qc,Yc,{chars:{digits:["","","","","","","","","",""],markers:["","","",""],informal:!1},descriptors:{suffix:new Pa(new qt(""),0),fallback:new Pa(Kt("cjk-decimal"),0),range:new Pa(new ri([new Qt(-9999),new Qt(9999)]),0),negative:new Pa(new qt(""),0)}}),h(Qc,"NAMES",new Set(["simp-chinese-informal","simp-chinese-formal","trad-chinese-informal","trad-chinese-formal","cjk-ideographic"])),f(Qc,Kc,new Map([["simp-chinese-informal",p(Qc,Gc)],["simp-chinese-formal",p(Qc,qc)],["trad-chinese-informal",p(Qc,Xc)],["trad-chinese-formal",p(Qc,Yc)],["cjk-ideographic",p(Qc,Xc)]]));var ed,td,id,nd,rd,od=Qc,sd=class e extends Oc{constructor(t){super(t,p(e,ed))}_getAutoRange(){return[{lower:1,upper:1/0}]}_usesNegativeSign(e){return!1}_generateInitialRepresentation(t){if(t<1)return null;if(1===t)return p(e,id)[1];let i=[],n=t;for(;n>0;)i.push(n%100),n=Math.floor(n/100);let r=i.length,o="";for(let t=r-1;t>=0;t--){let n=i[t],s=t%2==1;if(!(0===n||t===r-1&&1===n||s&&1===n)){let t=Math.floor(n/10),i=n%10;o+=p(e,td)[t]+p(e,id)[i]}s?0!==n&&(o+=p(e,nd)):0!==t&&(o+=p(e,rd))}return o}};ed=new WeakMap,td=new WeakMap,id=new WeakMap,nd=new WeakMap,rd=new WeakMap,f(sd,ed,{range:new Pa(new ri([new Qt(1),Kt("infinite")]),0),suffix:new Pa(new qt("/ "),0)}),f(sd,td,["","","","","","","","","",""]),f(sd,id,["","","","","","","","","",""]),f(sd,nd,""),f(sd,rd,"");var ad,ld=sd,hd=class{constructor(){f(this,ad),g(this,ad,new Map),p(this,ad).set("none",Oc.createNone(p(this,ad))),p(this,ad).set("decimal",Oc.createDecimal(p(this,ad))),p(this,ad).set("disc",Oc.createDisc(p(this,ad))),p(this,ad).set("square",Oc.createSquare(p(this,ad))),p(this,ad).set("circle",Oc.createCircle(p(this,ad))),p(this,ad).set("disclosure-open",Oc.createDisclosureOpen(p(this,ad))),p(this,ad).set("disclosure-closed",Oc.createDisclosureClosed(p(this,ad)));for(let e of Oc.CHINESE_LONGHAND_NAMES)p(this,ad).set(e,Oc.createChineseLonghand(p(this,ad),e));p(this,ad).set("ethiopic-numeric",Oc.createEthiopicNumeric(p(this,ad)))}define(e,t){if(!function(e){return!("none"===e.toLowerCase()||Uu.has(e))}(e))return null;let i=Oc.create(p(this,ad),t);return p(this,ad).set(e,i),i}getStyle(e){var t;return null!=(t=p(this,ad).get(e))?t:null}format(e,t){var i;return(null!=(i=this.getStyle(e))?i:lc(p(this,ad))).format(t)}formatMarker(e,t){var i;return(null!=(i=this.getStyle(e))?i:lc(p(this,ad))).formatMarker(t)}};ad=new WeakMap;var ud=class{constructor(e,t,i){h(this,"endStuckFixed"),h(this,"endFixed"),h(this,"endSlipped"),this.endStuckFixed=e,this.endFixed=t,this.endSlipped=i}},cd=class{constructor(){h(this,"map",[])}getMaxFixed(){return 0==this.map.length?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return 0==this.map.length?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(0==this.map.length)this.map.push(new ud(e,e,e));else{let t=this.map[this.map.length-1],i=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=i):this.map.push(new ud(e,e,i))}}addSlippedRange(e){0==this.map.length?this.map.push(new ud(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){let t=Ce(this.map.length,t=>e<=this.map[t].endFixed),i=this.map[t];return i.endSlipped-Math.max(0,i.endStuckFixed-e)}fixedBySlipped(e){let t=Ce(this.map.length,t=>e<=this.map[t].endSlipped),i=this.map[t];return i.endStuckFixed-(i.endSlipped-e)}},dd=class e{constructor(t,i,n,r,o,s,a,l){if(this.context=t,this.style=i,this.offset=n,this.isRoot=r,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=a,this.isParentBoxDisplayed=l,h(this,"flowName"),h(this,"isBlockValue",null),h(this,"hasBoxValue",null),h(this,"styleValues",{}),h(this,"beforeBox",null),h(this,"afterBox",null),h(this,"breakBefore",null),this.flowName=o.flowName,this.hasBox()){let r=i._pseudos;if(r&&r.before){let i=new e(t,r.before,n,!1,o,this.isBlock(),a,!0);ns(i.styleValue("content"))&&(this.beforeBox=i,this.breakBefore=i.breakBefore)}}this.breakBefore=bo(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&co(this.breakBefore)&&(o.breakBefore=bo(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,i,n){if(this.hasBox()){let r=this.style._pseudos;if(r&&r.after){let o=new e(this.context,r.after,t,!1,this.flowChunk,i,n,!0);ns(o.styleValue("content"))&&(this.afterBox=o)}}}styleValue(e,t){if(!(e in this.styleValues)){let i=this.style[e];this.styleValues[e]=i?i.evaluate(this.context,e):t||null}return this.styleValues[e]}displayValue(){return this.styleValue("display",ci.inline)}isBlock(){if(null===this.isBlockValue){let e=this.displayValue(),t=this.styleValue("position"),i=this.styleValue("float");this.isBlockValue=Ss(e,t,i,this.isRoot)}return this.isBlockValue}hasBox(){return null===this.hasBoxValue&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==ci.none&&!ws(this.styleValue("position"))),this.hasBoxValue}getBreakValue(e){let t=null;if(this.isBlock()){let i=this.styleValue(`break-${e}`);i&&(t=i.toString())}return t}},pd=class{constructor(e){this.context=e,h(this,"stack",[]),h(this,"atBlockStart",!0),h(this,"atFlowStart",!0),h(this,"atStartStack",[])}empty(){return 0===this.stack.length}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(e=>e.displayValue()!==ci.none)}push(e,t,i,n){let r=this.lastBox();n&&r&&n.flowName!==r.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let o=n||r.flowChunk,s=this.atFlowStart||!!n,a=this.isCurrentBoxDisplayed(),l=new dd(this.context,e,t,i,o,s||this.atBlockStart,s,a);return this.stack.push(l),this.atBlockStart=l.hasBox()?!l.beforeBox&&l.isBlock():this.atBlockStart,this.atFlowStart=l.hasBox()?!l.beforeBox&&s:this.atFlowStart,l}encounteredTextNode(e){let t=this.lastBox();if((e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&t.hasBox()){let i=Bo(t.styleValue("white-space",ci.normal).toString());i&&!Mo(e,i)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){let t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){let e=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=bo(t.flowChunk.breakBefore,e)}let i=this.lastBox();if(i)if(i.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let e=this.atStartStack.pop();this.atBlockStart=e.atBlockStart,this.atFlowStart=e.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,i=this.stack[t];for(i===e&&(t--,i=this.stack[t]);t>=0;){if(i.flowName!==e.flowName)return e.offset;if(!i.atBlockStart||i.isRoot)return i.offset;e=i,i=this.stack[--t]}throw new Error("No block start offset found!")}},fd=class{constructor(e,t,i,n,r,o,s,a,l){this.xmldoc=e,this.scope=i,this.context=n,this.primaryFlows=r,this.validatorSet=o,this.counterListener=s,h(this,"root"),h(this,"cascadeHolder"),h(this,"last"),h(this,"rootStyle",{}),h(this,"styleMap",{}),h(this,"flows",{}),h(this,"flowChunks",[]),h(this,"flowListener",null),h(this,"flowToReach",null),h(this,"idToReach",null),h(this,"cascade"),h(this,"offsetMap"),h(this,"primary",!0),h(this,"primaryStack",[]),h(this,"rootBackgroundAssigned",!1),h(this,"rootLayoutAssigned",!1),h(this,"lastOffset"),h(this,"breakBeforeValues",{}),h(this,"boxStack"),h(this,"bodyReached",!0),this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(n,s,a,e.lang,l),this.offsetMap=new cd;let u=e.getElementOffset(this.root);this.lastOffset=u,this.boxStack=new pd(n),this.offsetMap.addStuckRange(u);let c=this.getAttrStyle(this.root);if("http://www.w3.org/1999/xhtml"===(this.cascade.pushElement(this,this.root,c,u),this.postprocessTopStyle(c,!1),this.root.namespaceURI))this.bodyReached=!1;this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${u}`]=c,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,i){let n=e[i];return n&&n.evaluate(this.context)!==t[i]}transferPropsToRoot(e,t){for(let i in t){let n=e[i];if(n)this.rootStyle[i]=n,delete e[i];else{let e=t[i];e&&(this.rootStyle[i]=new Pa(e,wr))}}}postprocessTopStyle(e,t){var i;if(t)for(let i of["writing-mode","direction"])e[i]&&(!t||!this.rootStyle[i])&&(this.rootStyle[i]=e[i]);else for(let t in e)Fa(t)&&(this.rootStyle[t]=e[t]);if(!this.rootBackgroundAssigned){let t=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,i=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(t&&!bi(t)||i&&!bi(i))&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned)for(let t=0;t<gd.length;t++)if(this.hasProp(e,this.validatorSet.layoutProps,gd[t])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}if(!t){let t=e["font-size"],n=!0;if(t&&!bi(t.value)){let e=t.evaluate(this.context);if(e instanceof Zt){let t=e.num;switch(e.unit){case"em":case"rem":t*=this.context.initialFontSize;break;case"%":t*=this.context.initialFontSize/100;break;case"lh":case"rlh":t*=this.context.initialFontSize*Ke.lh/Ke.em;break;default:{let i=Ke[e.unit];i&&(t*=i),n=!1}}this.context.rootFontSize=t,this.context.isRelativeRootFontSize=n}}let r=null!=(i=this.context.rootFontSize)?i:this.context.initialFontSize,o=e["line-height"];if(o&&!bi(o.value)){let e=o.evaluate(this.context);if(e instanceof Jt)this.context.rootLineHeight=e.num*r;else if(e instanceof Zt){let t=e.num;switch(e.unit){case"em":case"rem":t*=r;break;case"%":t*=r/100;break;case"lh":case"rlh":t*=this.context.initialFontSize*this.context.pref.lineHeight;break;default:{let i=Ke[e.unit];i&&(t*=i)}}this.context.rootLineHeight=t}}else this.context.rootLineHeight=this.context.fontSize()*this.context.pref.lineHeight}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){let t=e.getAttribute("style");if(t)return sh(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;let t=this.context,i=this.xmldoc.getElementOffset(this.root);if(e<i){let e=this.getStyle(this.root,!1),n=Oa(e,"flow-into"),r=n?n.evaluate(t,"flow-into").toString():"body",o=this.encounteredFlowElement(r,e,this.root,i);this.boxStack.empty()&&this.boxStack.push(e,i,!0,o)}let n=this.xmldoc.getNodeByOffset(e),r=this.xmldoc.getNodeOffset(n,0,!1);if(!(r>=this.lastOffset))for(;;){if(1!=n.nodeType)r+=n.textContent.length;else{let e=n,i=this.getStyle(e,!1),o=i["flow-into"];if(o){let n=o.evaluate(t,"flow-into").toString();this.encounteredFlowElement(n,i,e,r)}r++}if(r>=this.lastOffset)break;let e=n.firstChild;if(null==e)for(;e=n.nextSibling,!e;)if(n=n.parentNode,n===this.root)return;n=e}}resetFlowChunkStream(e){this.flowListener=e;for(let e=0;e<this.flowChunks.length;e++)this.flowListener.encounteredFlowChunk(this.flowChunks[e],this.flows[this.flowChunks[e].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;null!=this.flowToReach&&(t+=5e3,this.styleUntil(t,0)!=Number.POSITIVE_INFINITY););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;this.idToReach&&(t+=5e3,this.styleUntil(t,0)!==Number.POSITIVE_INFINITY););this.idToReach=null}encounteredFlowElement(e,t,i,n){let r=0,o=Number.POSITIVE_INFINITY,s=!1,a=!1,l=!1,h=t["flow-options"];if(h){let e=function(e){if(e){let t=new Hi;try{return e.visit(t),t.propSet}catch(e){R.warn(e,"toSet:")}}return{}}(h.evaluate(this.context,"flow-options"));s=!!e.exclusive,a=!!e.static,l=!!e.last}let u=t["flow-linger"];u&&(o=ji(u.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));let c=t["flow-priority"];c&&(r=ji(c.evaluate(this.context,"flow-priority"),0));let d=this.breakBeforeValues[n]||null,p=this.flows[e];if(!p){let t=this.boxStack.lastFlowName();p=this.flows[e]=new zo(e,t)}let f=new Do(e,i,n,r,o,s,a,l,d);return this.flowChunks.push(f),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(f,p),f}registerForcedBreakOffset(e,t,i){if(co(e)){let e=this.flows[i].forcedBreakOffsets;(0===e.length||e[e.length-1]<t)&&e.push(t)}let n=this.breakBeforeValues[t];this.breakBeforeValues[t]=bo(n,e)}styleUntil(e,t){let i,n=-1;if(e<=this.lastOffset&&(i=this.offsetMap.slippedByFixed(e),n=i+t,n<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n);if(null==this.last)return Number.POSITIVE_INFINITY;let r=this.context;for(;;){let o=this.last.firstChild;if(null==o)for(;;){if(1==this.last.nodeType){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let e=this.boxStack.pop(this.lastOffset),t=null;if(e.afterBox){let i=e.afterBox.getBreakValue("before");this.registerForcedBreakOffset(i,e.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(e):e.afterBox.offset,e.flowName),t=e.afterBox.getBreakValue("after")}t=bo(t,e.getBreakValue("after")),this.registerForcedBreakOffset(t,this.lastOffset,e.flowName)}if(o=this.last.nextSibling,o)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(n):Number.POSITIVE_INFINITY}if(this.last=o,1!=this.last.nodeType)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let o=this.last,s=this.getAttrStyle(o);this.primaryStack.push(this.primary),this.cascade.pushElement(this,o,s,this.lastOffset);let a=o.getAttribute("id")||o.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");a&&a===this.idToReach&&(this.idToReach=null),!this.bodyReached&&"body"==o.localName&&o.parentNode==this.root&&(this.postprocessTopStyle(s,!0),this.bodyReached=!0);let l,h=s["flow-into"];if(h){let e=h.evaluate(r,"flow-into").toString(),t=this.encounteredFlowElement(e,s,o,this.lastOffset);this.primary=!!this.primaryFlows[e],l=this.boxStack.push(s,this.lastOffset,o===this.root,t)}else l=this.boxStack.push(s,this.lastOffset,o===this.root),o===this.xmldoc.body&&(l.breakBefore=bo(l.flowChunk.breakBefore,l.breakBefore));let u=this.boxStack.nearestBlockStartOffset(l);if(0===u){let e=s.page,t=e&&!bi(e.value)&&e.value.toString();t&&"auto"!==t.toLowerCase()&&(this.cascade.firstPageType=t)}if(this.registerForcedBreakOffset(l.breakBefore,u,l.flowName),l.beforeBox){let e=l.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(e,l.beforeBox.atBlockStart?u:l.offset,l.flowName)}if(this.primary&&l.displayValue()===ci.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=s,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&0===u)continue;if(e<this.lastOffset&&(n<0&&(i=this.offsetMap.slippedByFixed(e),n=i+t),n<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n)}}}getStyle(e,t){let i=this.xmldoc.getElementOffset(e),n=`e${i}`;return t&&(i=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=i&&this.styleUntil(i,0),this.styleMap[n]}processContent(e,t,i){}},gd=["column-count","column-width","column-fill"],md=class{constructor(e){this.validator=e,h(this,"success",null),h(this,"failure",null),h(this,"code",0)}isSpecial(){return 0!=this.code}markAsStartGroup(){this.code=-1}isStartGroup(){return-1==this.code}markAsEndGroup(){this.code=-2}isEndGroup(){return-2==this.code}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},bd=class{constructor(e,t){this.where=e,this.success=t,h(this,"what",-1)}},vd=class e{constructor(){h(this,"nodes",[]),h(this,"connections",[]),h(this,"match",[]),h(this,"nomatch",[]),h(this,"error",[]),h(this,"emptyHead",!0)}connect(e,t){for(let i=0;i<e.length;i++)this.connections[e[i]].what=t;e.splice(0,e.length)}clone(){let t=new e;for(let e=0;e<this.nodes.length;e++){let i=this.nodes[e],n=new md(i.validator);n.code=i.code,t.nodes.push(n)}for(let e=0;e<this.connections.length;e++){let i=this.connections[e],n=new bd(i.where,i.success);n.what=i.what,t.connections.push(n)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(e,t,i){let n=this.nodes.length,r=new md(Ed);i>=0?t?r.markAsStartAlternate(i):r.markAsEndAlternate(i):t?r.markAsStartGroup():r.markAsEndGroup(),this.nodes.push(r),this.connect(e,n);let o=new bd(n,!0),s=new bd(n,!1);e.push(this.connections.length),this.connections.push(s),e.push(this.connections.length),this.connections.push(o)}endSpecialGroup(){let e=[this.match,this.nomatch,this.error];for(let t=0;t<e.length;t++)this.addSpecialToArr(e[t],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(e){this.addSpecialToArr(this.match,!1,e)}startClause(e){if(this.nodes.length)throw new Error("invalid call");let t=new md(Ed);t.markAsStartAlternate(e),this.nodes.push(t);let i=new bd(0,!0),n=new bd(0,!1);this.nomatch.push(this.connections.length),this.connections.push(n),this.match.push(this.connections.length),this.connections.push(i)}addPrimitive(e){let t=this.nodes.length;this.nodes.push(new md(e));let i=new bd(t,!0),n=new bd(t,!1);this.connect(this.match,t),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(n),this.match.push(this.connections.length),this.connections.push(i)}isSimple(){return 1==this.nodes.length&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof Cd}addGroup(e,t){if(0==e.nodes.length)return;let i=this.nodes.length;if(4==t&&1==i&&e.isPrimitive()&&this.isPrimitive())return void(this.nodes[0].validator=this.nodes[0].validator.combine(e.nodes[0].validator));for(let t=0;t<e.nodes.length;t++)this.nodes.push(e.nodes[t]);4==t?(this.emptyHead=!0,this.connect(this.nomatch,i)):this.connect(this.match,i);let n=this.connections.length;for(let t=0;t<e.connections.length;t++){let n=e.connections[t];n.where+=i,n.what>=0&&(n.what+=i),this.connections.push(n)}for(let t=0;t<e.match.length;t++)this.match.push(e.match[t]+n);if(3==t&&this.connect(this.match,i),2==t||3==t)for(let t=0;t<e.nomatch.length;t++)this.match.push(e.nomatch[t]+n);else if(this.emptyHead){for(let t=0;t<e.nomatch.length;t++)this.nomatch.push(e.nomatch[t]+n);this.emptyHead=e.emptyHead}else for(let t=0;t<e.nomatch.length;t++)this.error.push(e.nomatch[t]+n);for(let t=0;t<e.error.length;t++)this.error.push(e.error[t]+n);e.nodes=null,e.connections=null}finish(e,t){let i=this.nodes.length;this.nodes.push(e),this.nodes.push(t),this.connect(this.match,i),this.connect(this.nomatch,i+1),this.connect(this.error,i+1);for(let e of this.connections)e.success?this.nodes[e.where].success=this.nodes[e.what]:this.nodes[e.where].failure=this.nodes[e.what];for(let e=0;e<i;e++)if(null==this.nodes[e].failure||null==this.nodes[e].success)throw new Error("Invalid validator state");return this.nodes[0]}},yd=256,wd=512,xd=1024,Sd=class extends Vt{constructor(){super()}validateForShorthand(e,t){let i=e[t].visit(this);return i?[i]:null}},Cd=class e extends Sd{constructor(e,t,i){super(),this.allowed=e,this.idents=t,this.units=i}visitEmpty(e){return 1&this.allowed?e:null}visitSlash(e){return 2048&this.allowed?e:null}visitStr(e){return 2&this.allowed?e:null}visitIdent(e){return this.idents[e.name.toLowerCase()]||(4&this.allowed||64&this.allowed&&CSS.supports("color",e.name)?e:null)}visitNumeric(e){return 0!=e.num||this.allowed&wd?e.num<0&&!(this.allowed&yd)?null:this.units[e.unit]?e:null:"%"==e.unit&&this.allowed&xd?e:null}visitNum(e){return 0==e.num?this.allowed&wd?e:null:e.num<=0&&!(this.allowed&yd)?null:16&this.allowed?e:null}visitInt(e){if(0==e.num)return this.allowed&wd?e:null;if(e.num<=0&&!(this.allowed&yd))return null;if(48&this.allowed)return e;return this.idents[`${e.num}`]||null}visitHexColor(e){return 64&this.allowed&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(e.hex)?e:null}visitURL(e){return 128&this.allowed?e:null}visitURange(e){return 4096&this.allowed?e:null}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return 64&this.allowed&&CSS.supports("color",e.toString())||8192&this.allowed&&CSS.supports("background-image",e.toString())||"calc"===e.name&&1848&this.allowed?e:null}visitExpr(e){return 2046&this.allowed?e:null}combine(t){let i={},n={};for(let e in this.idents)i[e]=this.idents[e];for(let e in t.idents)i[e]=t.idents[e];for(let e in this.units)n[e]=this.units[e];for(let e in t.units)n[e]=t.units[e];return new e(this.allowed|t.allowed,i,n)}},kd={},Ed=new Cd(0,kd,kd),Pd=class extends Sd{constructor(e){super(),h(this,"successTerminal"),h(this,"failureTerminal"),h(this,"first"),this.successTerminal=new md(null),this.failureTerminal=new md(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,i){let n=t?[]:e,r=this.first,o=i,s=null,a=null;for(;r!==this.successTerminal&&r!==this.failureTerminal;){if(o>=e.length){r=r.failure;continue}let l=e[o],h=l;if(r.isSpecial()){let e=!0;r.isStartGroup()?(s?s.push(a):s=[a],a=[]):r.isEndGroup()?a=s.length>0?s.pop():null:r.isEndAlternate()?a[r.getAlternate()]="taken":e=null==a[r.getAlternate()],r=e?r.success:r.failure}else{if(0==o&&!t&&r.validator instanceof Nd&&this instanceof Nd){if(h=new ri(e).visit(r.validator),h){o=e.length,r=r.success;continue}}else if(0==o&&!t&&r.validator instanceof Td&&this instanceof Nd){if(h=new oi(e).visit(r.validator),h){o=e.length,r=r.success;continue}}else h=l.visit(r.validator);if(!h){r=r.failure;continue}if(h!==l&&e===n){n=[];for(let t=0;t<o;t++)n[t]=e[t]}e!==n&&(n[o-i]=h),o++,r=r.success}}return r===this.successTerminal&&(t?n.length>0:o==e.length)?n:null}validateSingle(e){let t=null,i=this.first;for(;i!==this.successTerminal&&i!==this.failureTerminal;)e?i.isSpecial()?i=i.success:(t=e.visit(i.validator),t?(e=null,i=i.success):i=i.failure):i=i.failure;return i===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},Nd=class extends Pd{constructor(e){super(e)}visitSpaceList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new ri(t):null}visitCommaList(e){let t=this.first,i=!1;for(;t;){if(t.validator instanceof Td){i=!0;break}t=t.failure}if(i){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new oi(t):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}},Td=class extends Pd{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new oi(t):null}validateForShorthand(e,t){let i,n=this.first;for(;n!==this.failureTerminal;){if(i=n.validator.validateForShorthand(e,t),i)return i;n=n.failure}return null}},Id=class extends Pd{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new si(e.name,t):null}},Ad=class{tryParse(e,t,i){return t}success(e,t){}},_d=class extends Ad{constructor(e,t){super(),this.name=t,h(this,"validator"),this.validator=e.validators[this.name]}tryParse(e,t,i){if(i.values[this.name])return t;let n=this.validator.validateForShorthand(e,t);if(n){let e=n.length,r=e>1?new ri(n):n[0];return this.success(r,i),t+e}return t}success(e,t){t.values[this.name]=e}},Rd=class extends _d{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let i=0;i<this.names.length;i++)t.values[this.names[i]]=e}},Ld=class extends Ad{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,i){let n=t;if(this.slash){if(e[t]!=Gt)return n;if(++t==e.length)return n}let r=this.nodes[0].tryParse(e,t,i);if(r==t)return n;t=r;for(let n=1;n<this.nodes.length&&t<e.length&&(r=this.nodes[n].tryParse(e,t,i),r!=t);n++)t=r;return t}},Fd=class extends Vt{constructor(){super(...arguments),h(this,"syntax",null),h(this,"propList",null),h(this,"error",!1),h(this,"values",{}),h(this,"validatorSet",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new _d(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){var i,n;if(!this.error){for(let r of this.propList)t.simpleProperty(r,null!=(n=null!=(i=this.values[r])?i:this.validatorSet.defaultValues[r])?n:ci.initial,e);return!0}return!1}propagateDefaultingValue(e,t,i){for(let n of this.propList)i.simpleProperty(n,e,t)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},Od=class extends Fd{constructor(){super()}validateList(e){let t=0,i=0;for(;t<e.length;){let n=this.syntax[i].tryParse(e,t,this);if(n>t)t=n,i=0;else if(++i==this.syntax.length){this.error=!0;break}}return t}},Bd=class extends Fd{constructor(){super()}validateList(e){if(e.length>this.syntax.length||0==e.length)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let i=t;for(;i>=e.length;)i=1==i?0:i-2;if(this.syntax[t].tryParse(e,i,this)!=i+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new Rd(this.validatorSet,this.propList)}},Md=["unicode-bidi","direction","margin-block-start","margin-block-end","margin-inline-start","margin-inline-end","padding-block-start","padding-block-end","padding-inline-start","padding-inline-end","border-block-start-color","border-block-end-color","border-inline-start-color","border-inline-end-color","border-block-start-style","border-block-end-style","border-inline-start-style","border-inline-end-style","border-block-start-width","border-block-end-width","border-inline-start-width","border-inline-end-width","block-start","block-end","inline-start","inline-end","block-size","inline-size","max-block-size","max-inline-size","min-block-size","min-inline-size","behavior","bleed","conflicting-partitions","crop-offset","crop-marks-line-color","enabled","flow-consume","flow-from","flow-into","flow-linger","flow-options","flow-priority","font-display","font-size-adjust","font-stretch_css3","font-variant_css2","glyph-orientation-vertical","marks","min-page-height","min-page-width","repeat-on-break","required","required-partitions","ruby-align","shape-inside","snap-height","snap-width","template","text-decoration-skip","text-justify","text-zoom","unicode-range","utilization","wrap-flow"],zd={SIMPLE:Od,INSETS:Bd,INSETS_SLASH:class extends Fd{constructor(){super()}validateList(e){let t=e.length;for(let i=0;i<e.length;i++)if(e[i]===Gt){t=i;break}if(t>this.syntax.length||0==e.length)return this.error=!0,0;for(let i=0;i<this.syntax.length;i++){let n,r=i;for(;r>=t;)r=1==r?0:r-2;if(t+1<e.length)for(n=t+i+1;n>=e.length;)n-=n==t+2?1:2;else n=r;let o=[e[r],e[n]];if(2!=this.syntax[i].tryParse(o,0,this))return this.error=!0,0}return e.length}},COMMA:class extends Od{constructor(){super()}mergeIn(e,t){var i,n;for(let r of this.propList){let o=null!=(n=null!=(i=t[r])?i:this.validatorSet.defaultValues[r])?n:ci.initial,s=e[r];s||(s=[],e[r]=s),s.push(o)}}visitCommaList(e){let t={};for(let i=0;i<e.values.length;i++)if(this.values={},e.values[i]instanceof oi?this.error=!0:(e.values[i].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&i!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let e in t)this.values[e]="background-color"==e?t[e].pop():new oi(t[e]);return null}},FONT:class extends Od{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size","font-stretch","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian")}validateList(e){let t=super.validateList(e),i=this.values["font-variant_css2"];i&&(delete this.values["font-variant_css2"],this.values["font-variant-caps"]=i);let n=this.values["font-stretch_css3"];if(n&&(delete this.values["font-stretch_css3"],this.values["font-stretch"]=n),t+2>e.length)return this.error=!0,t;this.error=!1;let r=this.validatorSet.validators;if(!e[t].visit(r["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===Gt){if(t++,t+2>e.length)return this.error=!0,t;if(!e[t].visit(r["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}let o=t==e.length-1?e[t]:new ri(e.slice(t,e.length));return o.visit(r["font-family"])?(this.values["font-family"]=o,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;let t=[this.values["font-family"]];for(let i=1;i<e.values.length;i++)t.push(e.values[i]);let i=new oi(t);return i.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=i:this.error=!0,null}visitIdent(e){let t=this.validatorSet.systemFonts[e.name];if(t)for(let e in t)this.values[e]=t[e];else this.error=!0;return null}},TEXT_SPACING:class extends Od{validateList(e){if(1===e.length&&e[0]instanceof Yt)switch(e[0].name.toLowerCase()){case"normal":e=[this.validatorSet.defaultValues["text-autospace"],this.validatorSet.defaultValues["text-spacing-trim"]];break;case"auto":e=[ci.auto,ci.auto];break;case"none":e=[Kt("no-autospace"),Kt("space-all")]}return super.validateList(e)}},ALL:class extends Od{constructor(){super()}init(e,t){super.init(e,t);for(let e in this.validatorSet.validators)Md.includes(e)||this.propList.push(e)}validateList(e){return this.error=!0,0}}},Dd=["initial-letter"],Vd=class{constructor(){h(this,"validators",{}),h(this,"prefixes",{}),h(this,"defaultValues",{}),h(this,"namedValidators",{}),h(this,"systemFonts",{}),h(this,"shorthands",{}),h(this,"layoutProps",{}),h(this,"backgroundProps",{})}addReplacement(e,t){let i;if(3==t.type)i=new Zt(t.num,t.text);else if(7==t.type)i=new ei(t.text);else{if(1!=t.type)throw new Error("unexpected replacement");i=Kt(t.text)}if(e.isPrimitive()){let t=e.nodes[0].validator.idents;for(let e in t)t[e]=i;return e}throw new Error("unexpected replacement")}newGroup(e,t){let i=new vd;if("||"==e){for(let e=0;e<t.length;e++){let n=new vd;n.startClause(e),n.addGroup(t[e],1),n.endClause(e),i.addGroup(n,0==e?1:4)}let e=new vd;return e.startSpecialGroup(),e.addGroup(i,3),e.endSpecialGroup(),e}{let n;switch(e){case" ":n=1;break;case"|":case"||":n=4;break;default:throw new Error("unexpected op")}for(let e=0;e<t.length;e++)i.addGroup(t[e],0==e?1:n);return i}}addCounts(e,t,i){let n=new vd;for(let i=0;i<t;i++)n.addGroup(e.clone(),1);if(i==Number.POSITIVE_INFINITY)n.addGroup(e,3);else for(let r=t;r<i;r++)n.addGroup(e.clone(),2);return n}primitive(e){let t=new vd;return t.addPrimitive(e),t}newFunc(e,t){let i;switch(e){case"COMMA":i=new Td(t);break;case"SPACE":i=new Nd(t);break;default:i=new Id(e.toLowerCase(),t)}return this.primitive(i)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new Cd(64,kd,kd)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new Cd(8192,kd,kd)),this.namedValidators.POS_INT=this.primitive(new Cd(32,kd,kd)),this.namedValidators.POS_NUM=this.primitive(new Cd(16,kd,kd)),this.namedValidators.POS_PERCENTAGE=this.primitive(new Cd(8,kd,{"%":jt})),this.namedValidators.NEGATIVE=this.primitive(new Cd(yd,kd,kd)),this.namedValidators.ZERO=this.primitive(new Cd(wd,kd,kd)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new Cd(xd,kd,kd)),this.namedValidators.POS_LENGTH=this.primitive(new Cd(8,kd,{em:jt,ex:jt,ch:jt,rem:jt,lh:jt,rlh:jt,vw:jt,vh:jt,vi:jt,vb:jt,vmin:jt,vmax:jt,pvw:jt,pvh:jt,pvi:jt,pvb:jt,pvmin:jt,pvmax:jt,cm:jt,mm:jt,in:jt,px:jt,pt:jt,pc:jt,q:jt})),this.namedValidators.POS_ANGLE=this.primitive(new Cd(8,kd,{deg:jt,grad:jt,rad:jt,turn:jt})),this.namedValidators.POS_TIME=this.primitive(new Cd(8,kd,{s:jt,ms:jt})),this.namedValidators.FREQUENCY=this.primitive(new Cd(8,kd,{Hz:jt,kHz:jt})),this.namedValidators.RESOLUTION=this.primitive(new Cd(8,kd,{dpi:jt,dpcm:jt,dppx:jt})),this.namedValidators.URI=this.primitive(new Cd(128,kd,kd)),this.namedValidators.URANGE=this.primitive(new Cd(4096,kd,kd)),this.namedValidators.IDENT=this.primitive(new Cd(4,kd,kd)),this.namedValidators.STRING=this.primitive(new Cd(2,kd,kd)),this.namedValidators.SLASH=this.primitive(new Cd(2048,kd,kd));let e={"font-family":Kt("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let i=e.token();if(0==i.type)return null;let n={"":!0};if(14==i.type){do{if(e.consume(),i=e.token(),1!=i.type)throw new Error("Prefix name expected");n[i.text]=!0,e.consume(),i=e.token()}while(16==i.type);if(15!=i.type)throw new Error("']' expected");e.consume(),i=e.token()}if(1!=i.type)throw new Error("Property name expected");if(2==t?"SHORTHANDS"==i.text:"DEFAULTS"==i.text)return e.consume(),null;let r=i.text;if(e.consume(),2!=t){if(39!=e.token().type)throw new Error("'=' expected");this.isBuiltIn(r)||(this.prefixes[r]=n)}else if(18!=e.token().type)throw new Error("':' expected");return r}parseValidators(e){for(;;){let t=this.readNameAndPrefixes(e,1);if(!t)return;let i,n=[],r=[],o="",s=!0,a=()=>{if(0==n.length)throw new Error("No values");return 1==n.length?n[0]:this.newGroup(o,n)},l=e=>{if(s)throw new Error(`'${e}': unexpected`);if(o&&o!=e)throw new Error(`mixed operators: '${e}' and '${o}'`);o=e,s=!0},h=null;for(;!h;){e.consume();let t=e.token();switch(t.type){case 1:if(s||l(" "),this.isBuiltIn(t.text)){let e=this.namedValidators[t.text];if(!e)throw new Error(`'${t.text}' unexpected`);n.push(e.clone())}else{let e={};e[t.text.toLowerCase()]=Kt(t.text),n.push(this.primitive(new Cd(0,e,kd)))}s=!1;break;case 5:{let e={};e[`${t.num}`]=new Qt(t.num),n.push(this.primitive(new Cd(0,e,kd))),s=!1;break}case 34:l("|");break;case 25:l("||");break;case 14:s||l(" "),r.push({vals:n,op:o,b:"["}),o="",n=[],s=!0;break;case 6:s||l(" "),r.push({vals:n,op:o,b:"(",fn:t.text}),o="",n=[],s=!0;break;case 15:{i=a();let e=r.pop();if("["!=e.b)throw new Error("']' unexpected");n=e.vals,n.push(i),o=e.op,s=!1;break}case 11:{i=a();let e=r.pop();if("("!=e.b)throw new Error("')' unexpected");n=e.vals,n.push(this.newFunc(e.fn,i)),o=e.op,s=!1;break}case 18:if(s)throw new Error("':' unexpected");e.consume(),n.push(this.addReplacement(n.pop(),e.token()));break;case 22:if(s)throw new Error("'?' unexpected");n.push(this.addCounts(n.pop(),0,1));break;case 36:if(s)throw new Error("'*' unexpected");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(s)throw new Error("'+' unexpected");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(e.consume(),t=e.token(),5!=t.type)throw new Error("<int> expected");let i=t.num,r=i;if(e.consume(),t=e.token(),16==t.type){if(e.consume(),t=e.token(),5!=t.type)throw new Error("<int> expected");r=t.num,e.consume(),t=e.token()}if(13!=t.type)throw new Error("'}' expected");n.push(this.addCounts(n.pop(),i,r));break}case 17:if(h=a(),r.length>0)throw new Error(`unclosed '${r.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=h:h.isSimple()?this.validators[t]=h.nodes[0].validator:this.validators[t]=new Nd(h)}}parseDefaults(e){for(;;){let t=this.readNameAndPrefixes(e,2);if(!t)return;let i=[];for(;;){e.consume();let t=e.token();if(17==t.type){e.consume();break}switch(t.type){case 1:i.push(Kt(t.text));break;case 4:i.push(new Jt(t.num));break;case 5:i.push(new Qt(t.num));break;case 3:i.push(new Zt(t.num,t.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=i.length>1?new ri(i):i[0]}}parseShorthands(e){for(;;){let t=this.readNameAndPrefixes(e,3);if(!t)return;let i,n=e.nthToken(1);1==n.type&&zd[n.text]?(i=new zd[n.text],e.consume()):i=new Od,i.setOwner(this);let r=!1,o=[],s=!1,a=[],l=[];for(;!r;)switch(e.consume(),n=e.token(),n.type){case 1:if(this.validators[n.text])o.push(i.syntaxNodeForProperty(n.text)),n.text.includes("_")||l.push(n.text);else{if(!(this.shorthands[n.text]instanceof Bd))throw new Error(`'${n.text}' is neither a simple property nor an inset shorthand`);{let e=this.shorthands[n.text];o.push(e.createSyntaxNode()),l.push(...e.propList)}}break;case 19:if(o.length>0||s)throw new Error("unexpected slash");s=!0;break;case 14:a.push({slash:s,syntax:o}),o=[],s=!1;break;case 15:{let e=new Ld(o,s),t=a.pop();o=t.syntax,s=t.slash,o.push(e);break}case 17:r=!0,e.consume();break;default:throw new Error("unexpected token")}i.init(o,l),this.shorthands[t]=i}}parse(e){let t=new Hn(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){var t;let i={};for(let n of e){let e=this.shorthands[n],r=e?e.propList:[n];for(let e of r)i[e]=null!=(t=this.defaultValues[e])?t:ci.initial}return i}validatePropertyAndHandleShorthand(e,t,i,n){let r=n.ruleType;if(yi(e)||"font-face"===r||function(e){let t=new Hd;return e.visit(t),t.varFound}(t))return void n.simpleProperty(e,t,i);if("counter-style"===r)return void(sc(e,t)?n.simpleProperty(e,t,i):n.invalidPropertyValue(e,t));let o="",s=e,a=(e=e.toLowerCase()).match(/^-([a-z]+)-([-a-z0-9]+)$/);a&&(o=a[1],e=a[2]);let l=this.prefixes[e];if(!l||!l[o])return void(CSS.supports(s,t.toString())?n.simpleProperty(s,t,i):o&&!le.includes(`-${o}-`)||n.unknownProperty(s,t));if(Dd.includes(e)&&!Object.keys(l).some(t=>ue(t?`-${t}-`:"",e)))return void n.unknownProperty(s,t);let h=this.validators[e];if(h){let r=bi(t)||t.isExpr()?t:t.visit(h);r?n.simpleProperty(e,r,i):!o&&CSS.supports(e,t.toString())?n.simpleProperty(e,t,i):n.invalidPropertyValue(s,t)}else{let r=this.shorthands[e].clone();bi(t)?r.propagateDefaultingValue(t,i,n):(t.visit(r),r.finish(i,n)||n.invalidPropertyValue(s,t))}}};function Ud(){let e=new Vd;return e.initBuiltInValidators(),e.parse(lr),e}var Hd=class extends Vt{constructor(){super(...arguments),h(this,"varFound",!1)}visitFunc(e){return"var"===e.name?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function $d(e){return Object.keys(e).filter(e=>!["src","font-family","font-display"].includes(e)).sort()}function jd(e,t){let i={};for(let n in e)i[n]=Oa(e,n).evaluate(t,n);return i}(new Date).valueOf();var Wd=class{constructor(e){this.properties=e,h(this,"fontTraitKey"),h(this,"src"),h(this,"blobURLs",[]),h(this,"blobs",[]),h(this,"family"),this.fontTraitKey=function(e){let t=new fe;for(let i of $d(e))t.append(`${i}:${e[i].toString()};`);return t.toString()}(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){let i=new fe;i.append("@font-face {\n  font-family: "),i.append(this.family),i.append(";\n  ");for(let e of $d(this.properties))i.append(e),i.append(": "),this.properties[e].appendTo(i,!0),i.append(";\n  ");if(t){i.append('src: url("');let e=function(e){return URL.createObjectURL(e)}(t);i.append(e),this.blobURLs.push(e),this.blobs.push(t),i.append('")')}else i.append("src: "),i.append(e);return i.append(";\n}\n"),i.toString()}},Gd=class{constructor(e){this.deobfuscator=e,h(this,"familyMap",{})}registerFamily(e,t){let i=e.family,n=this.familyMap[i],r=t.family;if(n){if(n!=r)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[i]=r}filterFontFamily(e){if(e instanceof oi){let t=e.values,i=[];for(let e of t){let t=this.familyMap[e.stringValue()];t&&i.push(Kt(t)),i.push(e)}return new oi(i)}{let t=this.familyMap[e.stringValue()];return t?new oi([Kt(t),e]):e}}},qd=class{constructor(e,t,i){this.head=e,this.body=t,h(this,"srcURLMap",{}),h(this,"familyPrefix"),h(this,"familyCounter",0),this.familyPrefix=i||"Fnt_"}getViewFontFamily(e,t){let i=e.family,n=t.familyMap[i];return n||(n=this.familyPrefix+ ++this.familyCounter,t.familyMap[i]=n,n)}initFont(e,t,i){let n=Gn("initFont"),r=e.src,o={};for(let t of $d(e.properties))o[t]=e.properties[t];let s=this.getViewFontFamily(e,i);o["font-family"]=Kt(s);let a=new Wd(o),l=this.head.ownerDocument.createElement("style");return l.textContent=a.makeAtRule(r,t),this.head.appendChild(l),R.debug("Load font:",r),n.finish(a),n.result()}loadFont(e,t){let i=e.src,n=e.family+";"+i,r=this.srcURLMap[n];return r?r.piggyback(n=>{let r=n;r.traitsEqual(e)?(t.registerFamily(e,r),R.debug("Found already-loaded font:",i)):R.warn("E_FONT_FACE_INCOMPATIBLE",e.src)}):(r=new rr(()=>{let n=Gn("loadFont"),r=i.replace(/^url\("([^"]+)"\).*$/,"$1"),o=t.deobfuscator?t.deobfuscator(r):null;return o?gr(r,"blob").then(i=>{i.responseBlob?o(i.responseBlob).then(i=>{this.initFont(e,i,t).thenFinish(n)}):n.finish(null)}):this.initFont(e,null,t).thenFinish(n),n.result()},`loadFont ${i}`),this.srcURLMap[n]=r,r.start()),r}findOrLoadFonts(e,t){let i=[];for(let n of e)n.src&&n.family?i.push(this.loadFont(n,t)):R.warn("E_FONT_FACE_INVALID");return or(i).thenAsync(()=>this.waitFontLoading())}waitFontLoading(){let e=this.head.ownerDocument.fonts,t=0;if(e.forEach(e=>{"unloaded"===e.status&&(t++,e.load().catch(e=>{}))}),0===t)return qn(!0);let i=Gn("waitFontLoading");return i.loop(()=>i.sleep(20).thenAsync(()=>"loading"===e.status?qn(!0):qn(!1))).thenFinish(i),i.result()}},Xd=1,Yd=class{constructor(e,t,i,n,r){this.name=t,this.pseudoName=i,this.classes=n,this.parent=r,h(this,"specified",{}),h(this,"children",[]),h(this,"pageMaster",null),h(this,"index",0),h(this,"key"),h(this,"_scope"),this._scope=e,this.key="p"+Xd++,r&&(this.index=r.children.length,r.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){let t=this.specified,i=e.specified;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}},Kd=class extends Yd{constructor(e){super(e,null,null,[],null),this.specified.width=new Pa(pi,0),this.specified.height=new Pa(fi,0)}},Zd=class extends Xe{constructor(e,t){super(e,function(e,t){let n=e.match(/^([^.]+)\.([^.]+)$/);if(n){let e=i.pageMaster.keyMap[n[1]];if(e){let i=this.lookupInstance(e);if(i)return t?i.resolveFunc(n[2]):i.resolveName(n[2])}}return null}),this.pageMaster=t;let i=this}},Jd=class e extends Yd{constructor(e,t,i,n,r,o,s){super(e,t,i,n,r),this.condition=o,this.specificity=s,h(this,"keyMap",{}),e instanceof Zd||(this._scope=new Zd(e,this)),this.pageMaster=this,this.specified.width=new Pa(pi,0),this.specified.height=new Pa(fi,0),this.specified["wrap-flow"]=new Pa(ci.auto,0),this.specified.position=new Pa(ci.relative,0),this.specified.overflow=new Pa(ci.visible,0)}createInstance(e){return new fp(e,this)}clone(t){let i=new e(this.scope,this.name,t.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(i),this.cloneChildren(i),i}resetScope(){this.scope.pageMaster=this}},Qd=class e extends Yd{constructor(e,t,i,n,r){super(e,t,i,n,r),this.pageMaster=r.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key),this.specified["wrap-flow"]=new Pa(ci.auto,0)}createInstance(e){return new gp(e,this)}clone(t){let i=new e(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}},ep=class e extends Yd{constructor(e,t,i,n,r){super(e,t,i,n,r),this.pageMaster=r.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key)}createInstance(e){return new mp(e,this)}clone(t){let i=new e(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}};function tp(e,t,i){return!t||t===ci.auto||bi(t)?null:t.toExpr(e,i)}function ip(e,t,i){return!t||t===ci.auto||bi(t)?e.zero:t.toExpr(e,i)}function np(e,t,i){return!t||bi(t)?e.zero:t===ci.auto?null:t.toExpr(e,i)}function rp(e,t,i,n){return!t||i===ci.none||bi(t)?e.zero:t.toExpr(e,n)}function op(e,t,i){return!t||bi(t)?i:t===ci._true?e._true:t===ci._false?e._false:t.toExpr(e,e.zero)}var sp=class{constructor(e,t){this.parentInstance=e,this.pageBox=t,h(this,"cascaded",{}),h(this,"style",{}),h(this,"autoWidth",null),h(this,"autoHeight",null),h(this,"children",[]),h(this,"isAutoWidth",!1),h(this,"isAutoHeight",!1),h(this,"isTopDependentOnAutoHeight",!1),h(this,"isRightDependentOnAutoWidth",!1),h(this,"calculatedWidth",0),h(this,"calculatedHeight",0),h(this,"pageMasterInstance",null),h(this,"namedValues",{}),h(this,"namedFuncs",{}),h(this,"vertical",!1),h(this,"rtl",!1),h(this,"suppressEmptyBoxGeneration",!1),h(this,"borderBoxSizing",!1),e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){let i=this.resolveName(e),n=this.resolveName(t);if(!i||!n)throw new Error("E_INTERNAL");return Bt(this.pageBox.scope,i,n)}resolveName(e){let t=this.namedValues[e];if(t)return t;let i=this.style[e];switch(i&&(t=i.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height")}if(!t){let i;if("extent"==e)i=this.vertical?"width":"height";else if("measure"==e)i=this.vertical?"height":"width";else{let t=this.vertical?wa:xa;i=e;for(let e in t)i=i.replace(e,t[e])}i!=e&&(t=this.resolveName(i))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{let e=this.pageBox.scope,i=new Ft(e,0),n=this.resolveName("column-count"),r=this.resolveName("column-width"),o=this.resolveName("column-gap");t=Mt(e,zt(e,new It(e,"min",[i,n]),Bt(e,r,o)),o);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){let e=this.pageBox.scope,t=this.style,i=op(e,t.enabled,e._true),n=tp(e,t.page,e.zero);if(n){let t=new Pt(e,"page-number");i=Ot(e,i,new vt(e,n,t))}let r=tp(e,t["min-page-width"],e.zero);r&&(i=Ot(e,i,new bt(e,new Pt(e,"page-width"),r)));let o=tp(e,t["min-page-height"],e.zero);o&&(i=Ot(e,i,new bt(e,new Pt(e,"page-height"),o))),i=this.boxSpecificEnabled(i),t.enabled=new ai(i)}boxSpecificEnabled(e){return e}initHorizontal(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=tp(e,t.left,i),r=tp(e,t["margin-left"],i),o=rp(e,t["border-left-width"],t["border-left-style"],i),s=ip(e,t["padding-left"],i),a=tp(e,t.width,i),l=tp(e,t["max-width"],i),h=ip(e,t["padding-right"],i),u=rp(e,t["border-right-width"],t["border-right-style"],i),c=tp(e,t["margin-right"],i),d=tp(e,t.right,i),p=Bt(e,o,s),f=Bt(e,o,h);if(n&&d&&a){let t=Mt(e,i,Bt(e,a,Bt(e,Bt(e,n,p),f)));r?c?d=Mt(e,t,c):c=Mt(e,t,Bt(e,d,r)):(t=Mt(e,t,d),c?r=Mt(e,t,c):(r=zt(e,t,new _t(e,.5)),c=r))}else{r||(r=e.zero),c||(c=e.zero),!n&&!d&&!a&&(n=e.zero),n||a?n||d?!a&&!d&&(a=this.autoWidth,this.isAutoWidth=!0):n=e.zero:(a=this.autoWidth,this.isAutoWidth=!0);let o=Mt(e,i,Bt(e,Bt(e,r,p),Bt(e,c,f)));this.isAutoWidth&&(l||(l=Mt(e,o,n||d)),!this.vertical&&(tp(e,t["column-width"],null)||tp(e,t["column-count"],null))&&(a=l,this.isAutoWidth=!1)),n?a?d||(d=Mt(e,o,Bt(e,n,a))):a=Mt(e,o,Bt(e,n,d)):n=Mt(e,o,Bt(e,d,a))}let g=ip(e,t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),i);t.left=new ai(n),t["margin-left"]=new ai(r),t["border-left-width"]=new ai(o),t["padding-left"]=new ai(s),t.width=new ai(a),t["max-width"]=new ai(l||a),t["padding-right"]=new ai(h),t["border-right-width"]=new ai(u),t["margin-right"]=new ai(c),t.right=new ai(d),t["snap-width"]=new ai(g)}initVertical(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null,r=tp(e,t.top,n),o=tp(e,t["margin-top"],i),s=rp(e,t["border-top-width"],t["border-top-style"],i),a=ip(e,t["padding-top"],i),l=tp(e,t.height,n),h=tp(e,t["max-height"],n),u=ip(e,t["padding-bottom"],i),c=rp(e,t["border-bottom-width"],t["border-bottom-style"],i),d=tp(e,t["margin-bottom"],i),p=tp(e,t.bottom,n),f=Bt(e,s,a),g=Bt(e,c,u);if(r&&p&&l){let t=Mt(e,n,Bt(e,l,Bt(e,Bt(e,r,f),g)));o?d?p=Mt(e,t,o):d=Mt(e,t,Bt(e,p,o)):(t=Mt(e,t,p),d?o=Mt(e,t,d):(o=zt(e,t,new _t(e,.5)),d=o))}else{o||(o=e.zero),d||(d=e.zero),!r&&!p&&!l&&(r=e.zero),r||l?r||p?!l&&!p&&(l=this.autoHeight,this.isAutoHeight=!0):r=e.zero:(l=this.autoHeight,this.isAutoHeight=!0);let i=Mt(e,n,Bt(e,Bt(e,o,f),Bt(e,d,g)));this.isAutoHeight&&(h||(h=Mt(e,i,r||p)),this.vertical&&(tp(e,t["column-width"],null)||tp(e,t["column-count"],null))&&(l=h,this.isAutoHeight=!1)),r?l?p||(p=Mt(e,i,Bt(e,r,l))):l=Mt(e,i,Bt(e,p,r)):r=Mt(e,i,Bt(e,p,l))}let m=ip(e,t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),i);t.top=new ai(r),t["margin-top"]=new ai(o),t["border-top-width"]=new ai(s),t["padding-top"]=new ai(a),t.height=new ai(l),t["max-height"]=new ai(h||l),t["padding-bottom"]=new ai(u),t["border-bottom-width"]=new ai(c),t["margin-bottom"]=new ai(d),t.bottom=new ai(p),t["snap-height"]=new ai(m)}initColumns(){let e=this.pageBox.scope,t=this.style,i=tp(e,t[this.vertical?"height":"width"],null),n=tp(e,t["column-width"],i),r=tp(e,t["column-count"],null),o=function(e,t,i){return!t||t===ci.normal||bi(t)?null:t.toExpr(e,i)}(e,t["column-gap"],null);o||(o=new Et(e,1,"em")),n&&!r&&(r=new It(e,"floor",[Dt(e,Bt(e,i,o),Bt(e,n,o))]),r=new It(e,"max",[e.one,r])),r||(r=e.one),n=Mt(e,Dt(e,Bt(e,i,o),r),o),t["column-width"]=new ai(n),t["column-count"]=new ai(r),t["column-gap"]=new ai(o)}depends(e,t,i){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,i)}init(e){var t;e.registerInstance(this.pageBox.key,this);let i=this.pageBox.scope,n=this.style,r=this.parentInstance?this.parentInstance.getActiveRegions(e):null,o=hh(this.cascaded,e,r,!1);this.vertical=ah(o,e,!!this.parentInstance&&this.parentInstance.vertical),this.rtl=lh(o,e,!!this.parentInstance&&this.parentInstance.rtl),this.borderBoxSizing=(null==(t=o["box-sizing"])?void 0:t.value)===ci.border_box;let s=!!(e instanceof Lf&&e.currentLayoutPosition&&new Pt(i,"left-page").evaluate(e));dh(o,n,this.vertical,this.rtl,s,(e,t)=>t.value),this.autoWidth=new Tt(i,()=>this.calculatedWidth,"autoWidth"),this.autoHeight=new Tt(i,()=>this.calculatedHeight,"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){var i,n;let r=this.style[t];return!r&&Fa(t)&&this.pageMasterInstance instanceof Hp&&(r="font-size"===t&&e.isRelativeRootFontSize&&e.rootFontSize?new Zt(e.rootFontSize,"px"):null==(n=(null==(i=e.styler)?void 0:i.rootStyle)[t])?void 0:n.value),r&&(r=gh(e,r,t)),r}getPropAsNumber(e,t){var i,n;let r=this.style[t];if(r){let o=/\b(height|top|bottom)\b/.test(t)?null!=(i=e.pageAreaHeight)?i:e.pageHeight():null!=(n=e.pageAreaWidth)?n:e.pageWidth();r=gh(e,r,t,o)}return hi(r,e)}getSpecial(e,t){let i=Va(this.cascaded,t);if(i){let t=[];for(let n=0;n<i.length;n++){let r=i[n].evaluate(e,"");r&&r!==jt&&t.push(r)}if(t.length)return t}return null}getActiveRegions(e){let t=this.getSpecial(e,"region-id");if(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i].toString();return e}return null}propagateProperty(e,t,i,n){this.propagatePropertyToElement(e,t.element,i,n)}propagatePropertyToElement(e,t,i,n){let r=this.getProp(e,i);r&&(r.isNumeric()&&Ze(r.unit)&&(r=ui(r,e)),"font-family"===i&&(r=n.filterFontFamily(r)),(i.startsWith("background")||"z-index"===i)&&t.parentElement.hasAttribute("data-vivliostyle-bleed-box")&&(t=t.parentElement),ce(t,i,r.toString()))}propagateDelayedProperty(e,t,i,n){let r=this.getProp(e,i);r&&n.push(new Ao(t.element,i,r))}assignLeftPosition(e,t){let i=this.getPropAsNumber(e,"left"),n=this.getPropAsNumber(e,"margin-left"),r=this.getPropAsNumber(e,"padding-left"),o=this.getPropAsNumber(e,"border-left-width"),s=this.getPropAsNumber(e,"width");t.setHorizontalPosition(i,s),ce(t.element,"margin-left",`${n}px`),ce(t.element,"padding-left",`${r}px`),ce(t.element,"border-left-width",`${o}px`),t.marginLeft=n,t.borderLeft=o,t.paddingLeft=r}assignRightPosition(e,t){let i=this.getPropAsNumber(e,"right"),n=this.getPropAsNumber(e,"snap-height"),r=this.getPropAsNumber(e,"margin-right"),o=this.getPropAsNumber(e,"padding-right"),s=this.getPropAsNumber(e,"border-right-width");if(ce(t.element,"margin-right",`${r}px`),ce(t.element,"padding-right",`${o}px`),ce(t.element,"border-right-width",`${s}px`),t.marginRight=r,t.borderRight=s,this.vertical&&n>0){let e=i+t.getInsetRight(),r=e-Math.floor(e/n)*n;r>0&&(t.snapOffsetX=n-r,o+=t.snapOffsetX)}t.paddingRight=o,t.snapWidth=n}assignTopPosition(e,t){let i=this.getPropAsNumber(e,"snap-height"),n=this.getPropAsNumber(e,"top"),r=this.getPropAsNumber(e,"margin-top"),o=this.getPropAsNumber(e,"padding-top"),s=this.getPropAsNumber(e,"border-top-width");if(t.top=n,t.marginTop=r,t.borderTop=s,t.snapHeight=i,!this.vertical&&i>0){let e=n+t.getInsetTop(),r=e-Math.floor(e/i)*i;r>0&&(t.snapOffsetY=i-r,o+=t.snapOffsetY)}t.paddingTop=o,ce(t.element,"top",`${n}px`),ce(t.element,"margin-top",`${r}px`),ce(t.element,"padding-top",`${o}px`),ce(t.element,"border-top-width",`${s}px`)}assignBottomPosition(e,t){let i=this.getPropAsNumber(e,"margin-bottom"),n=this.getPropAsNumber(e,"padding-bottom"),r=this.getPropAsNumber(e,"border-bottom-width"),o=this.getPropAsNumber(e,"height")-t.snapOffsetY;ce(t.element,"height",`${o}px`),ce(t.element,"margin-bottom",`${i}px`),ce(t.element,"padding-bottom",`${n}px`),ce(t.element,"border-bottom-width",`${r}px`),t.height=o-t.snapOffsetY,t.marginBottom=i,t.borderBottom=r,t.paddingBottom=n}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){ce(t.element,"border-top-width","0px");let i=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,i):(this.assignTopPosition(e,t),i-=t.snapOffsetY,t.height=i,ce(t.element,"height",`${i}px`))}sizeWithMaxWidth(e,t){ce(t.element,"border-left-width","0px");let i=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,i);else{this.assignRightPosition(e,t),i-=t.snapOffsetX,t.width=i;let n=this.getPropAsNumber(e,"right");ce(t.element,"right",`${n}px`),ce(t.element,"width",`${i}px`)}}prepareContainer(e,t,i,n,r){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&ce(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&ce(t.element,"direction",this.rtl?"rtl":"ltr"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let i=0;i<ap.length;i++)this.propagateProperty(e,t,ap[i],n)}transferContentProps(e,t,i,n){for(let i=0;i<hp.length;i++)this.propagateProperty(e,t,hp[i],n);if(this.style["text-overflow"]){let e=t.element.firstElementChild;ce(e,"text-overflow","inherit"),ce(e,"overflow","inherit")}}transferSingleUriContentProps(e,t,i){let n=()=>{var e,t;let i=null==(t=null!=(e=this.cascaded.width)?e:this.cascaded[this.vertical?"block-size":"inline-size"])?void 0:t.value;return!!i&&i!==ci.auto&&!bi(i)},r=()=>{var e,t;let i=null==(t=null!=(e=this.cascaded.height)?e:this.cascaded[this.vertical?"inline-size":"block-size"])?void 0:t.value;return!!i&&i!==ci.auto&&!bi(i)};for(let o=0;o<up.length;o++){let s=up[o];if("width"!==s&&"height"!==s)this.propagatePropertyToElement(e,t,s,i);else{if("width"===s&&!n()||"height"===s&&!r())continue;ce(t,s,"100%")}}}finishContainer(e,t,i,n,r,o,s){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;let a=(this.vertical||!n)&&this.isAutoHeight,l=(!this.vertical||!n)&&this.isAutoWidth,h=null;if(l||a){l&&ce(t.element,"width","auto"),a&&ce(t.element,"height","auto");let e=n&&_s(n);e&&As(n),h=o.getElementClientRect(n?n.element:t.element),e&&Is(n),l&&(this.calculatedWidth=Math.ceil(h.right-h.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),a&&(this.calculatedHeight=h.bottom-h.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))}if((this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),r>1){let i=this.getPropAsNumber(e,"column-rule-width"),n=this.getProp(e,"column-rule-style"),o=this.getProp(e,"column-rule-color");if(i>0&&n&&n!=ci.none&&o!=ci.transparent){let s=this.getPropAsNumber(e,"column-gap"),a=this.vertical?t.height:t.width,l=this.vertical?"border-top":"border-left";for(let e=1;e<r;e++){let h=this.vertical?(a+s)*e/r-s/2+t.paddingTop-i/2:(a+s)*e/r-s/2+t.paddingLeft-i/2,u=this.vertical?t.width+t.paddingLeft+t.paddingRight:t.height+t.paddingTop+t.paddingBottom,c=t.element.ownerDocument.createElement("div");ce(c,"position","absolute"),ce(c,this.vertical?"left":"top","0px"),ce(c,this.vertical?"top":"left",`${h}px`),ce(c,this.vertical?"height":"width","0px"),ce(c,this.vertical?"width":"height",`${u}px`),ce(c,l,`${i}px ${n.toString()}${o?` ${o.toString()}`:""}`),t.element.insertBefore(c,t.element.firstChild)}}}for(let i=0;i<lp.length;i++)this.propagateProperty(e,t,lp[i],s);for(let n=0;n<cp.length;n++)this.propagateDelayedProperty(e,t,cp[n],i.delayedItems)}applyCascadeAndInit(e,t){let i=this.cascaded,n=this.pageBox.specified;for(let e in n)this instanceof Hp&&"vivliostyle-page-rule-master"==this.pageBox.pseudoName&&("writing-mode"===e||"direction"===e)||La(e)&&Ba(i,e,Oa(n,e));if(this.pageBox.pseudoName==dp)for(let e in t)(e.match(/^background-/)||"writing-mode"==e)&&(i[e]=t[e]);if("layout-host"==this.pageBox.pseudoName)for(let e in t)!e.match(/^background-/)&&"writing-mode"!=e&&(i[e]=t[e]);e.pushRule(this.pageBox.classes,null,i);let r=i.content;r&&(i.content=r.filterValue(new Ml(e,null,e.counterResolver))),this.init(e.context);for(let i of this.pageBox.children)i.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(let t of this.children)t.resolveAutoSizing(e)}},ap=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","box-sizing","outline-style","outline-color","outline-width","overflow","visibility"],lp=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-start-start-radius","border-start-end-radius","border-end-start-radius","border-end-end-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","box-shadow","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],hp=["color","font-family","font-size","font-style","font-weight","line-height","letter-spacing","text-align","text-align-last","text-decoration","text-indent","text-transform","white-space","text-wrap","text-wrap-mode","text-wrap-style","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-stretch","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-skip-ink","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-fill-color","text-orientation","text-shadow","text-stroke-color","text-stroke-width","text-underline-offset","text-underline-position","text-overflow"],up=["width","height","image-resolution","object-fit","object-position"],cp=["transform","transform-origin"],dp="background-host",pp=class extends sp{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort((e,t)=>t.pageBox.specificity-e.pageBox.specificity||e.pageBox.index-t.pageBox.index)}},fp=class extends sp{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){let t=this.pageBox.pageMaster;return t.condition&&(e=Ot(t.scope,e,t.condition)),e}adjustPageLayout(e,t,i){}},gp=class extends sp{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}},mp=class extends sp{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,i){let n=null;if(t instanceof Yt&&(n=[t]),t instanceof oi&&(n=t.values),n){let t=this.pageBox.scope;for(let r=0;r<n.length;r++)if(n[r]instanceof Yt){let o=Ge(n[r].name,"enabled"),s=new Pt(t,o);i&&(s=new st(t,s)),e=Ot(t,e,s)}}return e}boxSpecificEnabled(e){let t=this.pageBox.scope,i=this.style,n=op(t,i.required,t._false)!==t._false;if(n||this.isAutoHeight){let n=function(e,t,i){return!t||bi(t)?new _t(e,i):t.toExpr(e,e.zero)}(t,i["flow-from"],"body");e=Ot(t,e,new It(t,"has-content",[n]))}if(e=this.processPartitionList(e,i["required-partitions"],!1),e=this.processPartitionList(e,i["conflicting-partitions"],!0),n){let i=this.pageMasterInstance.style.enabled,n=i?i.toExpr(t,null):t._true;n=Ot(t,n,e),this.pageMasterInstance.style.enabled=new ai(n)}return e}prepareContainer(e,t,i,n,r){var o;this.pageBox.pageMaster instanceof zp||(ce(t.element,"overflow","hidden"),t.element.setAttribute("data-vivliostyle-page-partition",null!=(o=this.pageBox.name)?o:"")),super.prepareContainer(e,t,i,n,r)}},bp=class extends Pr{constructor(e,t,i,n){super(e,t,!1),this.target=i,this.validatorSet=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,i){this.target.specified[e]=new Pa(t,i?xr:Sr)}},vp=class extends bp{constructor(e,t,i,n){super(e,t,i,n)}},yp=class e extends bp{constructor(e,t,i,n){super(e,t,i,n),i.specified.width=new Pa(di,0),i.specified.height=new Pa(di,0)}startPartitionRule(e,t,i){let n=new ep(this.scope,e,t,i,this.target),r=new vp(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(t,i,n){let r=new Qd(this.scope,t,i,n,this.target),o=new e(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}},wp=class extends bp{constructor(e,t,i,n){super(e,t,i,n)}startPartitionRule(e,t,i){let n=new ep(this.scope,e,t,i,this.target),r=new vp(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(e,t,i){let n=new Qd(this.scope,e,t,i,this.target),r=new yp(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}};function xp(e){var t,i;let n=null==(t=e["writing-mode"])?void 0:t.value,r=null==(i=e.direction)?void 0:i.value;return n===ci.vertical_lr||n!==ci.vertical_rl&&r!==ci.rtl?"ltr":"rtl"}var Sp={a10:{width:new Zt(26,"mm"),height:new Zt(37,"mm")},a9:{width:new Zt(37,"mm"),height:new Zt(52,"mm")},a8:{width:new Zt(52,"mm"),height:new Zt(74,"mm")},a7:{width:new Zt(74,"mm"),height:new Zt(105,"mm")},a6:{width:new Zt(105,"mm"),height:new Zt(148,"mm")},a5:{width:new Zt(148,"mm"),height:new Zt(210,"mm")},a4:{width:new Zt(210,"mm"),height:new Zt(297,"mm")},a3:{width:new Zt(297,"mm"),height:new Zt(420,"mm")},a2:{width:new Zt(420,"mm"),height:new Zt(594,"mm")},a1:{width:new Zt(594,"mm"),height:new Zt(841,"mm")},a0:{width:new Zt(841,"mm"),height:new Zt(1189,"mm")},b10:{width:new Zt(31,"mm"),height:new Zt(44,"mm")},b9:{width:new Zt(44,"mm"),height:new Zt(62,"mm")},b8:{width:new Zt(62,"mm"),height:new Zt(88,"mm")},b7:{width:new Zt(88,"mm"),height:new Zt(125,"mm")},b6:{width:new Zt(125,"mm"),height:new Zt(176,"mm")},b5:{width:new Zt(176,"mm"),height:new Zt(250,"mm")},b4:{width:new Zt(250,"mm"),height:new Zt(353,"mm")},b3:{width:new Zt(353,"mm"),height:new Zt(500,"mm")},b2:{width:new Zt(500,"mm"),height:new Zt(707,"mm")},b1:{width:new Zt(707,"mm"),height:new Zt(1e3,"mm")},b0:{width:new Zt(1e3,"mm"),height:new Zt(1414,"mm")},c10:{width:new Zt(28,"mm"),height:new Zt(40,"mm")},c9:{width:new Zt(40,"mm"),height:new Zt(57,"mm")},c8:{width:new Zt(57,"mm"),height:new Zt(81,"mm")},c7:{width:new Zt(81,"mm"),height:new Zt(114,"mm")},c6:{width:new Zt(114,"mm"),height:new Zt(162,"mm")},c5:{width:new Zt(162,"mm"),height:new Zt(229,"mm")},c4:{width:new Zt(229,"mm"),height:new Zt(324,"mm")},c3:{width:new Zt(324,"mm"),height:new Zt(458,"mm")},c2:{width:new Zt(458,"mm"),height:new Zt(648,"mm")},c1:{width:new Zt(648,"mm"),height:new Zt(917,"mm")},c0:{width:new Zt(917,"mm"),height:new Zt(1297,"mm")},"jis-b10":{width:new Zt(32,"mm"),height:new Zt(45,"mm")},"jis-b9":{width:new Zt(45,"mm"),height:new Zt(64,"mm")},"jis-b8":{width:new Zt(64,"mm"),height:new Zt(91,"mm")},"jis-b7":{width:new Zt(91,"mm"),height:new Zt(128,"mm")},"jis-b6":{width:new Zt(128,"mm"),height:new Zt(182,"mm")},"jis-b5":{width:new Zt(182,"mm"),height:new Zt(257,"mm")},"jis-b4":{width:new Zt(257,"mm"),height:new Zt(364,"mm")},"jis-b3":{width:new Zt(364,"mm"),height:new Zt(515,"mm")},"jis-b2":{width:new Zt(515,"mm"),height:new Zt(728,"mm")},"jis-b1":{width:new Zt(728,"mm"),height:new Zt(1030,"mm")},"jis-b0":{width:new Zt(1030,"mm"),height:new Zt(1456,"mm")},letter:{width:new Zt(8.5,"in"),height:new Zt(11,"in")},legal:{width:new Zt(8.5,"in"),height:new Zt(14,"in")},ledger:{width:new Zt(11,"in"),height:new Zt(17,"in")}},Cp=new Zt(.24,"pt");new Zt(3,"mm");var kp=new Zt(10,"mm"),Ep=new Zt(13,"mm");function Pp(e){let t={width:pi,height:fi,bleed:gi,bleedOffset:gi,cropOffset:gi},i=e.size;if(i&&i.value!==ci.auto){let e,n,r=i.value;if(r.isSpaceList()?(e=r.values[0],n=r.values[1]):(e=r,n=null),e.isNumeric())t.width=e,t.height=n||e;else{let i=e.name&&Sp[e.name.toLowerCase()];i&&(n&&n===ci.landscape?(t.width=i.height,t.height=i.width):(t.width=i.width,t.height=i.height))}}let n=e.marks,r=e.bleed,o=n&&!bi(n.value)?n.value:ci.none,s=r&&!bi(r.value)?r.value:ci.auto;if(s===ci.auto){if(o!==ci.none){let e=!1;e=o.isSpaceList()?o.values.some(e=>e===ci.crop):o===ci.crop,e&&(t.bleed=new Zt(6,"pt"))}}else s.isNumeric()&&(t.bleed=s);let a=e["crop-offset"],l=a&&!bi(a.value)?a.value:ci.auto;return l===ci.auto?o!==ci.none&&(t.bleedOffset=Ep):l.isNumeric()&&(t.cropOffset=l),t}function Np(e,t){let i={},n=Math.max(0,e.bleed.num)*t.queryUnitSize(e.bleed.unit,!1),r=!e.cropOffset.num&&e.bleedOffset.num?e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1):Math.max(0,e.cropOffset.num*t.queryUnitSize(e.cropOffset.unit,!1)-n),o=n+r,s=e.width;s===pi?t.pref.defaultPaperSize?i.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):i.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-2*o:i.pageWidth=s.num*t.queryUnitSize(s.unit,!1);let a=e.height;return a===fi?t.pref.defaultPaperSize?i.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):i.pageHeight=t.viewportHeight-2*o:i.pageHeight=a.num*t.queryUnitSize(a.unit,!1),i.bleed=n,i.bleedOffset=r,i.cropOffset=o,i}function Tp(e,t,i){let n=e.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("width",t),n.setAttribute("height",i),n.style.position="absolute",n}function Ip(e,t,i,n){n=n||"polyline";let r=e.createElementNS("http://www.w3.org/2000/svg",n);return r.setAttribute("stroke",i===ci.auto?"#010101":i.toString()),r.setAttribute("stroke-width",t),r.setAttribute("fill","none"),r}var Ap=(e=>(e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right",e))(Ap||{}),_p=(e=>(e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e))(_p||{});function Rp(e,t,i,n){let r=!1,o=!1,s=e.marks;if(s){let e=s.value;e instanceof ri?e.values.forEach(e=>{e===ci.crop?r=!0:e===ci.cross&&(o=!0)}):e===ci.crop?r=!0:e===ci.cross&&(o=!0)}let a=t.bleed;if(!r&&!o)return;let l=i.container,h=l.ownerDocument,u=hi(Cp,n),c=Math.max(0,t.bleedOffset-hi(kp,n)),d=t.bleedOffset-c,p=e["crop-marks-line-color"],f=p&&!bi(p.value)?p.value:ci.auto;r&&Object.keys(Ap).forEach(e=>{let t=Ap[e],i=function(e,t,i,n,r,o,s){let a=r;a<=o+2*Ke.mm&&(a=o+r/2);let l=Math.max(r,a),h=o+l+i/2,u=Tp(e,h,h),c=[[0,o+r],[r,o+r],[r,o+r-a]],d=c.map(e=>[e[1],e[0]]);("top right"===t||"bottom right"===t)&&(c=c.map(e=>[o+l-e[0],e[1]]),d=d.map(e=>[o+l-e[0],e[1]])),("bottom left"===t||"bottom right"===t)&&(c=c.map(e=>[e[0],o+l-e[1]]),d=d.map(e=>[e[0],o+l-e[1]]));let p=Ip(e,i,n);p.setAttribute("points",c.map(e=>e.join(",")).join(" ")),u.appendChild(p);let f=Ip(e,i,n);return f.setAttribute("points",d.map(e=>e.join(",")).join(" ")),u.appendChild(f),t.split(" ").forEach(e=>{u.style[e]=`${s}px`}),u}(h,t,u,f,d,a,c);l.appendChild(i)}),o&&Object.keys(_p).forEach(e=>{let t=_p[e],i=function(e,t,i,n,r,o){let s,a,l=2*r;"top"===t||"bottom"===t?(s=l,a=r):(s=r,a=l);let h=Tp(e,s,a),u=Ip(e,i,n);u.setAttribute("points",`0,${a/2} ${s},${a/2}`),h.appendChild(u);let c=Ip(e,i,n);c.setAttribute("points",`${s/2},0 ${s/2},${a}`),h.appendChild(c);let d,p=Ip(e,i,n,"circle");switch(p.setAttribute("cx",s/2),p.setAttribute("cy",a/2),p.setAttribute("r",r/4),h.appendChild(p),t){case"top":d="bottom";break;case"bottom":d="top";break;case"left":d="right";break;case"right":d="left"}return Object.keys(_p).forEach(e=>{let i=_p[e];i===t?h.style[i]=`${o}px`:i!==d&&(h.style[i]="0",h.style[`margin-${i}`]="auto")}),h}(h,t,u,f,d,c);l.appendChild(i)})}var Lp=(()=>{let e={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0,"border-radius":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-bottom-right-radius":!0,"border-bottom-left-radius":!0,"border-start-start-radius":!0,"border-start-end-radius":!0,"border-end-start-radius":!0,"border-end-end-radius":!0,"box-shadow":!0,"box-sizing":!0};return["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end","inside","outside"].forEach(t=>{e[`margin-${t}`]=!0,e[`padding-${t}`]=!0,e[`border-${t}-width`]=!0,e[`border-${t}-style`]=!0,e[`border-${t}-color`]=!0}),e})(),Fp={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"start"},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"center"},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"end"},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"end"},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"center"},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"start"}},Op=(()=>{let e=Fp;return Object.keys(e).sort((t,i)=>e[t].order-e[i].order)})(),Bp="vivliostyle-page-rule-master",Mp="_marginBoxes",zp=class extends Jd{constructor(e,t,i){super(e,null,Bp,[],t,null,0),h(this,"pageMarginBoxes",{});let n=Pp(i);new Dp(this.scope,this,i,n),this.createPageMarginBoxes(i),this.applySpecified(i,n)}createPageMarginBoxes(e){let t=e[Mp];t&&Op.forEach(i=>{t[i]&&(this.pageMarginBoxes[i]=new Up(this.scope,this,i,e))})}applySpecified(e,t){this.specified.position=new Pa(ci.relative,0),this.specified.width=new Pa(t.width,0),this.specified.height=new Pa(t.height,0);for(let t in e)!Lp[t]&&"background-clip"!==t&&(this.specified[t]=e[t])}createInstance(e){return new Hp(e,this)}},Dp=class extends ep{constructor(e,t,i,n){super(e,null,null,[],t),this.pageSize=n,new Vp(this.scope,this),this.applySpecified(i)}applySpecified(e){this.specified["wrap-flow"]=new Pa(ci.auto,0),this.specified["z-index"]=new Pa(new Qt(0),0),this.specified.position=new Pa(ci.absolute,0),this.specified.overflow=new Pa(ci.visible,0);for(let t in Lp)Lp.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new Gp(e,this)}},Vp=class extends ep{constructor(e,t){super(e,null,null,[],t),this.specified["flow-from"]=new Pa(Kt("body"),0)}createInstance(e){return new qp(e,this)}},Up=class extends ep{constructor(e,t,i,n){super(e,null,null,[],t),this.marginBoxName=i,this.applySpecified(n)}applySpecified(e){let t=e[Mp][this.marginBoxName];for(let i in e){let n=e[i],r=t[i];(pa[i]||r&&r.value===ci.inherit)&&(this.specified[i]=n)}for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e)){let i=t[e];i&&i.value!==jt&&i.value!==ci.inherit&&i.value!==ci.unset&&i.value!==ci.revert&&(this.specified[e]=i)}}createInstance(e){return new Xp(e,this)}},Hp=class extends fp{constructor(e,t){super(e,t),h(this,"pageAreaDimension",null),h(this,"pageMarginBoxInstances",{})}applyCascadeAndInit(e,t){let i=this.cascaded;for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"writing-mode":case"direction":i[e]=t[e]}super.applyCascadeAndInit(e,t)}initHorizontal(){let e=this.style;e.left=gi,e["margin-left"]=gi,e["border-left-width"]=gi,e["padding-left"]=gi,e["padding-right"]=gi,e["border-right-width"]=gi,e["margin-right"]=gi,e.right=gi}initVertical(){let e=this.style;e.top=gi,e["margin-top"]=gi,e["border-top-width"]=gi,e["padding-top"]=gi,e["padding-bottom"]=gi,e["border-bottom-width"]=gi,e["margin-bottom"]=gi,e.bottom=gi}setPageAreaDimension(e){this.pageAreaDimension=e;let t=this.style;t.width=new ai(e.borderBoxWidth),t.height=new ai(e.borderBoxHeight),t["padding-left"]=new ai(e.marginLeft),t["padding-right"]=new ai(e.marginRight),t["padding-top"]=new ai(e.marginTop),t["padding-bottom"]=new ai(e.marginBottom)}adjustPageLayout(e,t,i){let n=t.marginBoxes,r={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},o={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(n.top,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.bottom,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.left,!1,o,e,i),this.sizeMarginBoxesAlongVariableDimension(n.right,!1,o,e,i)}sizeMarginBoxesAlongVariableDimension(e,t,i,n,r){let o="start",s="center",a="end",l=this.pageBox.scope,h={},u={},c={};for(let i in e){let n=Fp[i];if(n){let o=e[i],s=this.pageMarginBoxInstances[i],a=new $p(o,s.style,t,l,r);h[n.positionAlongVariableDimension]=o,u[n.positionAlongVariableDimension]=s,c[n.positionAlongVariableDimension]=a}}let d={start:i.start.evaluate(n),end:i.end.evaluate(n),extent:i.extent.evaluate(n)},p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),f=!1,g={};Object.keys(h).forEach(e=>{let o=e,s=tp(l,u[o].style[t?"max-width":"max-height"],i.extent);if(s){let e=s.evaluate(n);if(p[o]>e){let i=c[o]=new Wp(h[o],u[o].style,t,l,r,e);g[o]=i.getOuterSize(),f=!0}}}),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),f=!1,[o,s,a].forEach(e=>{var t;p[e]=null!=(t=g[e])?t:p[e]}));let m={};Object.keys(h).forEach(e=>{let o=e,s=tp(l,u[o].style[t?"min-width":"min-height"],i.extent);if(s){let e=s.evaluate(n);if(p[o]<e){let i=c[o]=new Wp(h[o],u[o].style,t,l,r,e);m[o]=i.getOuterSize(),f=!0}}}),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(c,d.extent),[o,s,a].forEach(e=>{p[e]=m[e]||p[e]}));let b=d.start+d.extent,v=d.start+(d.start+d.extent);[o,s,a].forEach(e=>{let i=p[e];if(null!=i){let n=h[e],r=0;switch(e){case o:r=t?n.left:n.top;break;case s:r=(v-i)/2;break;case a:r=b-i}t?n.setHorizontalPosition(r,i-n.getInsetLeft()-n.getInsetRight()):n.setVerticalPosition(r,i-n.getInsetTop()-n.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,t){var i;let n=e.start,r=e.center,o=e.end,s={};if(r){let e=new jp([n,o]),a=this.distributeAutoMarginBoxSizes(r,e,t);null!=a.xSize&&(s.center=a.xSize);let l=null!=(i=a.xSize)?i:r.getOuterSize(),h=Math.max((t-l)/2,0);n&&(s.start=n.hasAutoSize()?h:n.getOuterSize()),o&&(s.end=o.hasAutoSize()?h:o.getOuterSize())}else{let e=this.distributeAutoMarginBoxSizes(n,o,t);null!=e.xSize&&(s.start=e.xSize),null!=e.ySize&&(s.end=e.ySize)}return s}distributeAutoMarginBoxSizes(e,t,i){let n={xSize:null,ySize:null};if(e instanceof $p&&e.minMaxFitContent&&(n.xSize=e.getOuterSize()),t instanceof $p&&t.minMaxFitContent&&(n.ySize=t.getOuterSize()),e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){let r=e.getOuterMaxContentSize(),o=t.getOuterMaxContentSize();if(r>0&&o>0){let s=r+o;if(s<i)n.xSize=i*r/s;else{let o=e.getOuterMinContentSize(),a=o+t.getOuterMinContentSize();a<i?n.xSize=o+(i-a)*(r-o)/(s-a):a>0&&(n.xSize=i*o/a)}n.xSize>0&&(n.ySize=i-n.xSize)}else r>0?n.xSize=i:o>0&&(n.ySize=i)}else e.hasAutoSize()?n.xSize=Math.max(i-t.getOuterSize(),0):t.hasAutoSize()&&(n.ySize=Math.max(i-e.getOuterSize(),0));else e?e.hasAutoSize()&&(n.xSize=i):t&&t.hasAutoSize()&&(n.ySize=i);return n}prepareContainer(e,t,i,n,r){t.element.setAttribute("data-vivliostyle-page-box",!0),super.prepareContainer(e,t,i,n,r)}},$p=class{constructor(e,t,i,n,r){this.container=e,this.isHorizontal=i,this.clientLayout=r,h(this,"hasAutoSize_"),h(this,"size",null),h(this,"minMaxFitContent",null);let o=t[i?"width":"height"];if(this.hasAutoSize_=!o||o===ci.auto||bi(o),this.minMaxFitContent=o instanceof Yt&&("min-content"===o.name||"max-content"===o.name||"fit-content"===o.name)?o.name:null,this.minMaxFitContent){let e=this.getSize();if(this.isHorizontal){let t=e["min-content"===this.minMaxFitContent?"min-content width":"max-content"===this.minMaxFitContent?"max-content width":"fit-content width"];this.container.setHorizontalPosition(this.container.left,t)}else{let t=e["min-content"===this.minMaxFitContent?"min-content height":"max-content"===this.minMaxFitContent?"max-content height":"fit-content height"];this.container.setVerticalPosition(this.container.top,t)}}}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let e=this.isHorizontal?["max-content width","min-content width","fit-content width"]:["max-content height","min-content height","fit-content height"];this.size=ro(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["max-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["max-content height"]+this.container.getInsetBottom()}getOuterMinContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["min-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["min-content height"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},jp=class{constructor(e){this.params=e}hasAutoSize(){return this.params.some(e=>{var t;return null!=(t=null==e?void 0:e.hasAutoSize())&&t})}getOuterMaxContentSize(){let e=this.params.map(e=>{var t;return null!=(t=null==e?void 0:e.getOuterMaxContentSize())?t:0});return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){let e=this.params.map(e=>{var t;return null!=(t=null==e?void 0:e.getOuterMinContentSize())?t:0});return Math.max.apply(null,e)*e.length}getOuterSize(){let e=this.params.map(e=>{var t;return null!=(t=null==e?void 0:e.getOuterSize())?t:0});return Math.max.apply(null,e)*e.length}},Wp=class extends $p{constructor(e,t,i,n,r,o){super(e,t,i,n,r),h(this,"fixedSize"),this.fixedSize=o}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},Gp=class extends mp{constructor(e,t){super(e,t),h(this,"borderBoxWidth",null),h(this,"borderBoxHeight",null),h(this,"contentBoxWidth",null),h(this,"contentBoxHeight",null),h(this,"marginTop",null),h(this,"marginRight",null),h(this,"marginBottom",null),h(this,"marginLeft",null)}applyCascadeAndInit(e,t){for(let e in t)e.match(/^background-/)&&(this.cascaded[e]=t[e]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.contentBoxWidth=e.contentBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.contentBoxHeight=e.contentBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let t,i,n,r=this.style,o=this.pageBox.pageSize,s=this.pageBox.scope,a=e.start,l=e.end,h=e.extent,u=o[h].toExpr(s,null),c=tp(s,r[h],u),d=tp(s,r[`margin-${a}`],u),p=tp(s,r[`margin-${l}`],u),f=ip(s,r[`padding-${a}`],u),g=ip(s,r[`padding-${l}`],u),m=rp(s,r[`border-${a}-width`],r[`border-${a}-style`],u),b=rp(s,r[`border-${l}-width`],r[`border-${l}-style`],u),v=Bt(s,Bt(s,m,f),Bt(s,b,g));return c?(this.borderBoxSizing?(i=c,n=Mt(s,i,v)):(n=c,i=Bt(s,n,v)),t=Mt(s,u,i),d||p?d?p=Mt(s,t,d):d=Mt(s,t,p):(d=zt(s,t,new _t(s,.5)),p=d)):(d||(d=s.zero),p||(p=s.zero),t=Bt(s,d,p),i=Mt(s,u,t),n=Mt(s,i,v),c=this.borderBoxSizing?i:n),r[a]=new ai(d),r[l]=new ai(p),r[`margin-${a}`]=gi,r[`margin-${l}`]=gi,r[`border-${a}-width`]=new ai(m),r[`border-${l}-width`]=new ai(b),r[`padding-${a}`]=new ai(f),r[`padding-${l}`]=new ai(g),r[h]=new ai(c),r[`max-${h}`]=new ai(c),{borderBoxExtent:i,contentBoxExtent:n,marginStart:d,marginEnd:p}}prepareContainer(e,t,i,n,r){t.element.setAttribute("data-vivliostyle-page-area-container",!0),super.prepareContainer(e,t,i,n,r)}},qp=class extends mp{constructor(e,t){super(e,t)}applyCascadeAndInit(e,t){for(let e in t)e.match(/^column.*$/)&&(this.cascaded[e]=t[e]);super.applyCascadeAndInit(e,{})}initHorizontal(){let e=this.style,t=this.parentInstance.style,i=this.pageBox.scope;e.left=t["padding-left"],e.width=new ai(this.parentInstance.contentBoxWidth),e["margin-left"]=new ai(new lt(i,t.left.toExpr(i,null))),e["margin-right"]=new ai(new lt(i,t.right.toExpr(i,null))),e["border-left-width"]=t.left,e["border-right-width"]=t.right,e["border-left-style"]=ci.solid,e["border-right-style"]=ci.solid,e["border-left-color"]=ci.transparent,e["border-right-color"]=ci.transparent}initVertical(){let e=this.style,t=this.parentInstance.style,i=this.pageBox.scope;e.top=t["padding-top"],e.height=new ai(this.parentInstance.contentBoxHeight),e["margin-top"]=new ai(new lt(i,t.top.toExpr(i,null))),e["margin-bottom"]=new ai(new lt(i,t.bottom.toExpr(i,null))),e["border-top-width"]=t.top,e["border-bottom-width"]=t.bottom,e["border-top-style"]=ci.solid,e["border-bottom-style"]=ci.solid,e["border-top-color"]=ci.transparent,e["border-bottom-color"]=ci.transparent}prepareContainer(e,t,i,n,r){t.element.setAttribute("data-vivliostyle-page-area",!0),i.pageAreaElement=t.element,super.prepareContainer(e,t,i,n,r),e.pageAreaWidth=t.width,e.pageAreaHeight=t.height}},Xp=class extends mp{constructor(e,t){super(e,t),h(this,"boxInfo"),h(this,"suppressEmptyBoxGeneration",!0);let i=t.marginBoxName;this.boxInfo=Fp[i],e.pageMarginBoxInstances[i]=this}prepareContainer(e,t,i,n,r){t.element.setAttribute("data-vivliostyle-page-margin-box",this.pageBox.marginBoxName),this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,i,n,r)}applyVerticalAlign(e,t){ce(t,"display","flex"),ce(t,"flex-flow",this.vertical?this.rtl?"row-reverse":"row":"column");let i=this.getProp(e,"vertical-align"),n=null;i===Kt("middle")?n="center":i===Kt("top")?n="flex-start":i===Kt("bottom")&&(n="flex-end"),n&&ce(t,"justify-content",n);let r=this.getProp(e,"content");if(this.vertical||r instanceof ti||r instanceof ai&&r.expr instanceof Tt&&r.expr.str.startsWith("running-element-")){let e="center";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||"end"===this.boxInfo.positionAlongVariableDimension?e=this.vertical||this.rtl?"start":"end":(this.boxInfo.isInRightColumn||"start"===this.boxInfo.positionAlongVariableDimension)&&(e=this.vertical||this.rtl?"end":"start")),ce(t,"align-items",e)}}positionAlongVariableDimension(e,t){let i=this.style,n=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,a="left"===r,l=a?t.borderBoxWidth:t.borderBoxHeight,h=tp(n,i[s],l),u=a?t.marginLeft:t.marginTop;if("start"===this.boxInfo.positionAlongVariableDimension)i[r]=new ai(u);else if(h){let e=ip(n,i[`margin-${r}`],l),t=ip(n,i[`margin-${o}`],l),s=ip(n,i[`padding-${r}`],l),a=ip(n,i[`padding-${o}`],l),c=rp(n,i[`border-${r}-width`],i[`border-${r}-style`],l),d=rp(n,i[`border-${o}-width`],i[`border-${o}-style`],l),p=Bt(n,h,Bt(n,this.borderBoxSizing?n.zero:Bt(n,Bt(n,s,a),Bt(n,c,d)),Bt(n,e,t)));switch(this.boxInfo.positionAlongVariableDimension){case"center":i[r]=new ai(Bt(n,u,Dt(n,Mt(n,l,p),new _t(n,2))));break;case"end":i[r]=new ai(Mt(n,Bt(n,u,l),p))}}}positionAndSizeAlongFixedDimension(e,t){let i=this.style,n=this.pageBox.scope,r=this.borderBoxSizing,o=e.inside,s=e.outside,a=e.extent,l=t[`margin${s.charAt(0).toUpperCase()}${s.substring(1)}`],h=np(n,i[`margin-${o}`],l),u=np(n,i[`margin-${s}`],l),c=ip(n,i[`padding-${o}`],l),d=ip(n,i[`padding-${s}`],l),p=rp(n,i[`border-${o}-width`],i[`border-${o}-style`],l),f=rp(n,i[`border-${s}-width`],i[`border-${s}-style`],l),g=tp(n,i[a],l),m=null;function b(e){if(m)return m;m={extent:g?g.evaluate(e):null,marginInside:h?h.evaluate(e):null,marginOutside:u?u.evaluate(e):null};let t=l.evaluate(e),i=0;return r||[p,c,d,f].forEach(t=>{t&&(i+=t.evaluate(e))}),(null===m.marginInside||null===m.marginOutside)&&i+m.extent+m.marginInside+m.marginOutside>t&&(null===m.marginInside&&(m.marginInside=0),null===m.marginOutside&&(m.marginOutside=0)),null!==m.extent&&null!==m.marginInside&&null!==m.marginOutside&&(m.marginOutside=null),null===m.extent?(m.extent=t-i-m.marginInside-m.marginOutside,null===m.marginInside&&(m.marginInside=0),null===m.marginOutside&&(m.marginOutside=0)):"number"==typeof m.extent&&(null===m.marginInside&&"number"==typeof m.marginOutside?m.marginInside=t-i-m.extent-m.marginOutside:"number"==typeof m.marginInside&&null===m.marginOutside?m.marginOutside=t-i-m.extent-m.marginInside:m.marginInside=m.marginOutside=(t-i-m.extent)/2),m}i[a]=new ai(new Tt(n,function(){let e=b(this).extent;return null===e?"auto":e},a)),i[`margin-${o}`]=new ai(new Tt(n,function(){let e=b(this).marginInside;return null===e?"auto":e},`margin-${o}`)),i[`margin-${s}`]=new ai(new Tt(n,function(){let e=b(this).marginOutside;return null===e?"auto":e},`margin-${s}`)),"left"===o?i.left=new ai(Bt(n,t.marginLeft,t.borderBoxWidth)):"top"===o&&(i.top=new ai(Bt(n,t.marginTop,t.borderBoxHeight)))}initHorizontal(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,i,n,r,o,s){super.finishContainer(e,t,i,n,r,o,s);let a=i.marginBoxes,l=this.pageBox.marginBoxName,h=this.boxInfo;h.isInLeftColumn||h.isInRightColumn?!h.isInTopRow&&!h.isInBottomRow&&(h.isInLeftColumn?a.left[l]=t:h.isInRightColumn&&(a.right[l]=t)):h.isInTopRow?a.top[l]=t:h.isInBottomRow&&(a.bottom[l]=t);let u=this.parentInstance.pageAreaDimension,c=this.getProp(e,"width"),d=c instanceof Yt&&("min-content"===c.name||"max-content"===c.name||"fit-content"===c.name)?c.name:null,p=this.getPropAsNumber(e,"min-width"),f=this.getPropAsNumber(e,"max-width");if(d||p||f){d&&ce(t.element,"width",d),p&&ce(t.element,"min-width",`${p}px`),f&&ce(t.element,"max-width",`${f}px`);let i=this.getProp(e,"margin-left"),n=this.getProp(e,"margin-right");if(h.isInLeftColumn){let r=u.borderBoxWidth.evaluate(e)+u.marginRight.evaluate(e);ce(t.element,"right",`${r}px`),(i===ci.auto||n!==ci.auto)&&ce(t.element,"margin-left","auto"),n===ci.auto&&ce(t.element,"margin-right","auto")}else h.isInRightColumn&&(ce(t.element,"right","0"),(n===ci.auto||i!==ci.auto)&&ce(t.element,"margin-right","auto"),i===ci.auto&&ce(t.element,"margin-left","auto"))}let g=this.getProp(e,"height"),m=g instanceof Yt&&("min-content"===g.name||"max-content"===g.name||"fit-content"===g.name)?g.name:null,b=this.getPropAsNumber(e,"min-height"),v=this.getPropAsNumber(e,"max-height");if(m||b||v){m&&ce(t.element,"height",m),b&&ce(t.element,"min-height",`${b}px`),v&&ce(t.element,"max-height",`${v}px`);let i=this.getProp(e,"margin-top"),n=this.getProp(e,"margin-bottom");if(h.isInTopRow){let r=u.borderBoxHeight.evaluate(e)+u.marginBottom.evaluate(e);ce(t.element,"bottom",`${r}px`),(i===ci.auto||n!==ci.auto)&&ce(t.element,"margin-top","auto"),n===ci.auto&&ce(t.element,"margin-bottom","auto")}else h.isInBottomRow&&(ce(t.element,"bottom","0"),(n===ci.auto||i!==ci.auto)&&ce(t.element,"margin-bottom","auto"),i===ci.auto&&ce(t.element,"margin-top","auto"))}}},Yp=class{constructor(e,t,i,n,r){this.pageScope=t,this.rootPageBoxInstance=i,this.context=n,this.docElementStyle=r,h(this,"pageMasterCache",{}),h(this,"pageCascadeInstance"),this.pageCascadeInstance=e,this.definePageProgression()}definePageProgression(){let e=this.pageScope,t=this.context,i=t.isVersoFirstPage,n=new Pt(e,"page-number"),r=new vt(e,new kt(e,n,new _t(e,2)),i?e.one:e.zero);e.defineName("recto-page",new st(e,r)),e.defineName("verso-page",r),"ltr"===(t.pageProgression||xp(this.docElementStyle))?(e.defineName("left-page",r),e.defineName("right-page",new st(e,r))):(e.defineName("left-page",new st(e,r)),e.defineName("right-page",r))}getCascadedPageStyle(e){let t={};return this.pageCascadeInstance.pushRule([],e,t),this.pageCascadeInstance.popRule(),t}getPageRulePageMaster(e,t){let i=e.pageBox;if(0===Object.keys(t).length)return i.resetScope(),e;let n=this.makeCacheKey(t,i),r=this.pageMasterCache[n];return r||(r=i.pseudoName===dp?this.generatePageRuleMaster(t):this.generateCascadedPageMaster(t,i),this.pageMasterCache[n]=r),r.pageBox.resetScope(),r}makeCacheKey(e,t){var i;let n=this.makeCascadeValueObjectKey(e),r=(null==(i=this.context.currentLayoutPosition)?void 0:i.page)%2;return`${t.key}^${n}^${r}`}makeCascadeValueObjectKey(e){let t=[];for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let n,r=e[i];n=r instanceof Pa?`${r.value}`:this.makeCascadeValueObjectKey(r),t.push(i+n+(r.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){let t=new zp(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.pageCascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){let i=t.clone({pseudoName:Bp}),n=i.specified,r=e.size;if(r&&!bi(r.value)){let t=Pp(e),i=r.priority;Ia(n,"width",new Pa(t.width,i),this.context),Ia(n,"height",new Pa(t.height,i),this.context)}["counter-reset","counter-increment"].forEach(t=>{n[t]&&(e[t]=n[t])});let o=i.createInstance(this.rootPageBoxInstance);return o.applyCascadeAndInit(this.pageCascadeInstance,this.docElementStyle),o.resolveAutoSizing(this.context),o}},Kp=class extends Za{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},Zp=class extends Za{constructor(e){super(),this.scope=e}apply(e){1===new Pt(this.scope,"page-number").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},Jp=class extends Za{constructor(e){super(),this.scope=e}apply(e){new Pt(this.scope,"blank-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},Qp=class extends Za{constructor(e){super(),this.scope=e}apply(e){new Pt(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},ef=class extends Za{constructor(e){super(),this.scope=e}apply(e){new Pt(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},tf=class extends Za{constructor(e){super(),this.scope=e}apply(e){new Pt(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},nf=class extends Za{constructor(e){super(),this.scope=e}apply(e){new Pt(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},rf=class extends dl{constructor(e,t,i){super(t,i),this.scope=e,this.a=t,this.b=i}apply(e){let t=e.context,i=t.layoutPositionAtPageStart.page;t.blankPageAtStart&&i--,i&&this.matchANPlusB(i)&&this.chained.apply(e)}getPriority(){return 2}},of=class extends dl{constructor(e,t,i,n){super(t,i),this.scope=e,this.a=t,this.b=i,this.pageType=n}apply(e){if(e.currentPageType!==this.pageType)return;let t=e.pageTypePageCounts[this.pageType]||0;this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 3}},sf=class extends Ka{constructor(e,t){super(e,t,null,null,null)}apply(e){!function(e,t,i,n){Ha(e,t,i,n,null,null,null);let r=i[Mp];if(r){let i=za(t,Mp);for(let t in r)if(r.hasOwnProperty(t)){let o=i[t];o||(o={},i[t]=o),Ha(e,o,r[t],n,null,null,null)}}}(e.context,e.currentStyle,this.style,this.specificity)}},af=class extends Gl{constructor(e,t,i,n,r){super(e,t,null==i?void 0:i.condition,i,null,n,!1),this.pageProps=r,h(this,"currentPageSelectors",[]),h(this,"currentNamedPageSelector",""),h(this,"currentPseudoPageClassSelectors",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,t){this.currentNamedPageSelector=t,t&&(this.chain.push(new Kp(t)),this.specificity+=65536)}pseudoclassSelector(e,t){if(e=e.toLowerCase(),t)if("nth"===e){let i=t[0],n=t[1];if(3===t.length&&"string"==typeof t[2]){let r=t[2];this.currentPseudoPageClassSelectors.push(`:${e}(${i}n${n<0?n:"+"+n} of ${r})`),this.chain.push(new of(this.scope,i,n,r)),this.specificity+=256}else this.currentPseudoPageClassSelectors.push(`:${e}(${i}n${n<0?n:"+"+n})`),this.chain.push(new rf(this.scope,i,n)),this.specificity+=256}else this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`);else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case"first":this.chain.push(new Zp(this.scope)),this.specificity+=256;break;case"blank":this.chain.push(new Jp(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new Qp(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new ef(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new tf(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new nf(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`)}}finishSelector(){let e;e=this.currentNamedPageSelector||this.currentPseudoPageClassSelectors.length?[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()):null,this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,i){if(("bleed"===e||"marks"===e)&&!this.currentPageSelectors.some(e=>null===e.selectors))return;super.simpleProperty(e,t,i);let n=Oa(this.elementStyle,e),r=this.pageProps;if("bleed"===e||"marks"===e)r[""]||(r[""]={}),Object.keys(r).forEach(t=>{Ba(r[t],e,n)});else if("size"===e){let t=r[""];this.currentPageSelectors.forEach(i=>{let o=new Pa(n.value,n.priority+i.specificity),s=i.selectors?i.selectors.join(""):"",a=r[s];a?Ia(a,e,o):(a=r[s]={},Ba(a,e,o),t&&["bleed","marks"].forEach(e=>{t[e]&&Ba(a,e,t[e])}))})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new sf(this.elementStyle,e)}startPageMarginBoxRule(e){let t=za(this.elementStyle,Mp),i=t[e];i||(i={},t[e]=i);let n=new lf(this.scope,this.owner,this.validatorSet,i);this.owner.pushHandler(n)}},lf=class extends Pr{constructor(e,t,i,n){super(e,t,!1),this.validatorSet=i,this.boxStyle=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity(),r=new Pa(t,n);Ba(this.boxStyle,e,r)}},hf=!0,uf=[];function cf(e,t){return e===t||(e.src||t.src?e.src===t.src:e.textContent===t.textContent)}function df(e){let t=Array.from(e.querySelectorAll("body > :not(script):not(link):not(style) ~ script"));return Array.from(e.querySelectorAll("head > script, body > script")).filter(e=>!t.includes(e))}function pf(e,t,i){if(!hf)return qn(!1);if((null==i||!i.inHead)&&(null==i||!i.atEnd)&&df(e.ownerDocument).includes(e))return qn(!1);let n=e.textContent,r=e.src,o="module"===e.type,s=r&&r.includes("/MathJax.js");if(s){if(t.document.head.querySelector("script[src*='/MathJax.js']"))return qn(!0);t.MathJax||(t.MathJax={MathML:{extensions:["content-mathml.js"]},showProcessingMessages:!1,messageStyle:"none",skipStartupTypeset:!0,CommonHTML:{linebreaks:{automatic:!0}},"fast-preview":{disabled:!0},AuthorInit:function(){t.MathJax.Hub.processSectionDelay=0}})}let a=(o||r)&&e.async&&!s,l=(o&&!a||r&&e.defer)&&!s,h=!(null!=i&&i.atEnd)&&((null==i?void 0:i.forceDefer)||l||a);if(gf(t)||(t.onload=null),h)return uf.some(t=>cf(t,e))||uf.push(e),qn(!0);for(let i of t.document.head.getElementsByTagName("script"))i.hasAttribute("data-vivliostyle-scripting")&&cf(i,e)&&t.document.head.removeChild(i);let u=t.document.createElement("script");u.textContent=n,r&&(u.src=r),u.async=a,u.defer=l,u.setAttribute("data-vivliostyle-scripting","true");for(let t of e.attributes)["src","async","defer"].includes(t.name)||u.setAttribute(t.name,t.value);if(R.debug("script:",r),r){let e=yr(u);return t.document.head.appendChild(u),or([e])}return t.document.head.appendChild(u),qn(!0)}function ff(e,t,i){var n;let r=null!=(n=t.document.querySelector("[data-vivliostyle-textcontent]"))?n:t.document.createElement("div");return r.style.position="fixed",r.style.fontSize="0",r.setAttribute("data-vivliostyle-textcontent","true"),r.setAttribute("aria-hidden","true"),r.style.fontFamily=function(e,t){var i;let n={},r=e=>{var t;let i=null==(t=e["font-family"])?void 0:t.value;if(i)if(i.values)for(let e of i.values)n[e.stringValue()]=!0;else n[i.stringValue()]=!0;let o=e._marginBoxes;if(o)for(let e of Object.values(o))r(e)},o=e=>{if(e instanceof Ka)r(e.style);else if(e instanceof qa||Array.isArray(e))for(let t of Object.values(e))o(t)};for(let e of Object.values(t.cascade.code))for(let t of Object.values(null!=e?e:{}))o(t);for(let t of e.querySelectorAll("[style]"))null!=(i=t.style)&&i.fontFamily&&(n[t.style.fontFamily]=!0);return Object.keys(n).join(",")}(e,i),r.textContent=e.documentElement.textContent,t.document.body.appendChild(r),r}function gf(e){return!!hf&&(uf.length>0||!!e.document.head.querySelector("script[data-vivliostyle-scripting]"))}var mf=(e,t,i)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,(e,n)=>`url("${i.transformURL(n,t)}"`).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,(e,n)=>`url('${i.transformURL(n,t)}'`).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,(e,n)=>`url(${i.transformURL(n,t)}`),bf={},vf=class e extends Ne{constructor(e,t,i,n,r,o,s,a,l,u,c,d,p){super(),this.flowName=e,this.context=t,this.viewport=i,this.styler=n,this.regionIds=r,this.xmldoc=o,this.docFaces=s,this.footnoteStyle=a,this.stylerProducer=l,this.page=u,this.customRenderer=c,this.fallbackMap=d,this.documentURLTransformer=p,h(this,"document"),h(this,"exprContentListener"),h(this,"nodeContext",null),h(this,"viewRoot",null),h(this,"isFootnote",!1),h(this,"sourceNode",null),h(this,"offsetInNode",0),h(this,"viewNode",null),this.document=i.document,this.exprContentListener=n.counterListener.getExprContentListener()}clone(){return new e(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(e,t,i,n,r,o,s,a){var l;let h=this.getPseudoMap(i,this.regionIds,this.isFootnote,this.nodeContext,o);if(!h)return a;let u=[],c=Ih.createElementNS("http://www.pyroxy.com/ns/shadow","root"),d=c;for(let o of Ah){let s;if(o){if(!h[o]||"footnote-marker"==o&&(!t||!this.isFootnote))continue;if(o.match(/^first-/)){let t=n.display;if(!t||t===ci.inline)continue;let i=e.firstElementChild;if(i&&Mo(i.previousSibling)){let e=r.getStyle(i,!1);if(e){let t=Oa(e,"display");if(null!=t&&t.value&&t.value!==ci.inline)continue}}}if("before"===o||"after"===o||"marker"===o){let e=h[o].content;if(!e||!ns(e.value)||"marker"===o&&(!Es(n.display)||(null==(l=Oa(i,"behavior"))?void 0:l.value)===Kt("toc-node")))continue}u.push(o),s=Ih.createElementNS("http://www.w3.org/1999/xhtml","span"),Lh(s,o)}else s=Ih.createElementNS("http://www.pyroxy.com/ns/shadow","content");d.appendChild(s),o.match(/^first-/)&&(d=s)}if(!u.length)return a;let p=new Fh(e,i,r,o,this.exprContentListener);return new qo(e,c,null,s,a,Go.ROOTLESS,p)}getPseudoMap(e,t,i,n,r){let o=Ma(e,"_pseudos");if(!o)return null;let s={};for(let e in o){let n=s[e]={};ch(n,o[e],r),oh(n,r,o[e]),uh(o[e],t,i,(e,t)=>{ch(n,t,r),rh(t,e=>{ch(n,e,r)})})}return s}createRefShadow(e,t,i,n,r){let o=Gn("createRefShadow");return this.xmldoc.store.load(e).then(s=>{let a=s;if(a){let o=a.getElement(e);if(o){let e=this.stylerProducer.getStylerForDoc(a);r=new qo(i,o,a,n,r,t,e)}}o.finish(r)}),o.result()}createShadows(e,t,i,n,r,o,s){let a,l=Gn("createShadows"),h=n.template;if(h instanceof ti||h===ci.footnote){let t=h instanceof ti?h.url:re("user-agent.xml#footnote",ie);a=this.createRefShadow(t,Go.ROOTLESS,e,s,null)}else a=qn(null);return a.then(a=>{let h=null;if("http://www.pyroxy.com/ns/shadow"==e.namespaceURI&&"include"==e.localName){let t=e.getAttribute("href"),i=null;t?i=s?s.xmldoc:this.xmldoc:s&&(t="http://www.w3.org/1999/xhtml"==s.owner.namespaceURI?s.owner.getAttribute("href"):s.owner.getAttributeNS("http://www.w3.org/1999/xlink","href"),i=s.parentShadow?s.parentShadow.xmldoc:this.xmldoc),t&&(t=re(t,i.url),h=this.createRefShadow(t,Go.ROOTED,e,s,a))}null==h&&(h=qn(a));let u=null;h.then(a=>{if(n.display===ci.table_cell){let t=re("user-agent.xml#table-cell",ie);u=this.createRefShadow(t,Go.ROOTLESS,e,s,a)}else u=qn(a);u.then(a=>{a=this.createPseudoelementShadow(e,t,i,n,r,o,s,a),l.finish(a)})})}),l.result()}setViewRoot(e,t){this.viewRoot=e,this.isFootnote=t}computeStyle(e,t,i,n){var r;let o=this.context,s=hh(i,o,this.regionIds,this.isFootnote,this.nodeContext),a=!(null!=(r=this.nodeContext)&&r.parent);a&&(!s["writing-mode"]&&this.styler.rootStyle["writing-mode"]&&(s["writing-mode"]=this.styler.rootStyle["writing-mode"]),!s.direction&&this.styler.rootStyle.direction&&(s.direction=this.styler.rootStyle.direction));let l=e;e=ah(s,o,e);let h=!a&&e!==l;t=lh(s,o,t);let u=!!new Pt(o.style.pageScope,"left-page").evaluate(o);if(dh(s,n,e,t,u,(t,i)=>{let n;h&&(e?/^(min-|max-)?(height|inline-size)$/.test(t)&&(n=o.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(t)&&(n=o.pageAreaWidth));let r=i.evaluate(o,t,n,e);return"font-family"==t&&(r=this.docFaces.filterFontFamily(r)),r}),h){let t=n[e?"height":"width"];(!t||t===ci.auto)&&(n[e?"height":"width"]=ci.max_content)}if(ws(n.position))return n.position=ci.fixed,n.visibility=ci.hidden,e;let c=n.position,d=n.float,p=xs(n.display||("http://www.w3.org/1999/xhtml"===this.sourceNode.namespaceURI?ci.inline:void 0),c,d,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach(e=>{p[e]&&(n[e]=p[e])}),e}inheritFromSourceParent(e){let t=this.nodeContext.sourceNode,i=[],n=null,r=this.nodeContext.shadowContext,o=-1;for(;t&&1==t.nodeType;){let e=r&&r.root==t;if(!e||r.type==Go.ROOTLESS){let e=(r?r.styler:this.styler).getStyle(t,!1);i.push(e),n=n||pe(t)}e?(t=r.owner,r=r.parentShadow):(t=t.parentNode,o++)}let s=0===o,a=this.context.queryUnitSize("em",s),l={"font-size":new Pa(new Zt(a,"px"),0)};s&&(l["line-height"]=new Pa(new Jt(this.context.pref.lineHeight),0));let h=new ja(l,this.context);for(let e=i.length-1;e>=0;--e){let t,n,r=i[e],o=[];for(let e in r)Fa(e)&&o.push(e);o.sort(vi);for(let s of o){h.setPropName(s);let o=Oa(r,s),a=o;if(!bi(o.value)){if("font-size"===s&&e===i.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize)a=new Pa(new Zt(this.context.rootFontSize,"px"),o.priority);else if("line-height"===s&&e===i.length-1&&this.context.rootLineHeight&&o.value instanceof Zt&&("lh"===o.value.unit||"rlh"===o.value.unit))a=new Pa(new Zt(this.context.rootLineHeight,"px"),o.priority);else if(0===e&&o.value instanceof Zt&&"lh"===o.value.unit){let e=this.getLineHeightUnitSize(s,t,n);null!=e&&(a=new Pa(new Zt(o.value.num*e,"px"),o.priority))}else yi(s)||(a=o.filterValue(h));"font-size"===s?t=a.value:"line-height"===s&&(n=a.value),l[s]=a}}}for(let t in e)Fa(t)||(l[t]=e[t]);return{lang:n,elementStyle:l}}resolveURL(e){return e=re(e,this.xmldoc.url),this.fallbackMap[e]||e}inheritLangAttribute(){this.nodeContext.lang=pe(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(e){let t=M("POLYFILLED_INHERITED_PROPS").reduce((e,t)=>e.concat(t()),[].concat(fa)).filter(t=>e[t]);if(t.length){let i=this.nodeContext.inheritedProps;if(this.nodeContext.parent){i=this.nodeContext.inheritedProps={};for(let e in this.nodeContext.parent.inheritedProps)i[e]=this.nodeContext.parent.inheritedProps[e]}t.forEach(t=>{let n=e[t];if(n){if(bi(n))n===ci.initial&&(i[t]=void 0);else if(n instanceof Qt)i[t]=n.num;else if(n instanceof Yt)i[t]=n.name;else if(n instanceof Zt){let e=n;switch(e.unit){case"dpi":case"dpcm":case"dppx":i[t]=e.num*Ke[e.unit];break;default:i[t]=n}}else i[t]=n;["widows","orphans"].includes(t)||delete e[t]}})}}resolveFormattingContext(e,t,i,n,r,o){let s=M("RESOLVE_FORMATTING_CONTEXT");for(let a=0;a<s.length;a++){let l=s[a](e,t,i,n,r,o);if(l)return void(e.formattingContext=l)}}createElementView(e,t){var i,n;let r=!0,o=Gn("createElementView"),s=this.sourceNode,a=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,l=a.getStyle(s,!1);if(!this.nodeContext.shadowContext){let e=this.xmldoc.getElementOffset(s);ca.registerFragmentIndex(e,this.nodeContext.fragmentIndex,0)}let h={};if(!this.nodeContext.parent){let e=this.inheritFromSourceParent(l);l=e.elementStyle,this.nodeContext.lang=e.lang}let u=l.position,c=l.float,d=l["float-reference"],p=c&&!bi(c.value)&&c.value!==ci.none&&d&&!bi(d.value)?function(e){switch(e){case"inline":return rs.INLINE;case"column":return rs.COLUMN;case"region":return rs.REGION;case"page":return rs.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}(d.value.toString()):null;if(this.nodeContext.parent&&(ws(null==u?void 0:u.value)||p&&os(p))){let e=this.inheritFromSourceParent(l);l=e.elementStyle,this.nodeContext.lang=e.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,"rtl"===this.nodeContext.direction,l,h),p&&os(p)&&h.display===ci.block&&(h.display=ci.flow_root),a.processContent(s,h,this.nodeContext),this.transferPolyfilledInheritedProps(h),this.inheritLangAttribute(),h.direction&&(this.nodeContext.direction=h.direction.toString());let f=h["flow-into"];if(f&&f.toString()!=this.flowName)return o.finish(!1),o.result();if(hf&&"script"===s.localName&&"http://www.w3.org/1999/xhtml"===s.namespaceURI)return pf(s,this.viewport.window).thenFinish(o),o.result();let g=h.display;if(bi(g)&&(g=g===ci.initial||g===ci.unset?ci.inline:g===ci.inherit?(null==(i=this.nodeContext.parent)?void 0:i.display)&&Kt(null==(n=this.nodeContext.parent)?void 0:n.display):null),g===ci.none)return o.finish(!1),o.result();let m=null==this.nodeContext.parent;return this.nodeContext.flexContainer=g===ci.flex,this.createShadows(s,m,l,h,a,this.context,this.nodeContext.shadowContext).then(t=>{this.nodeContext.nodeShadow=t;let i=h.position,n=h.float,u=h.clear,c=this.nodeContext.vertical?ci.vertical_rl:ci.horizontal_tb,d=this.nodeContext.parent?this.nodeContext.parent.vertical?ci.vertical_rl:ci.horizontal_tb:c,f=function(e){return"true"===e.getAttribute("data-vivliostyle-flow-root")}(s),b=h["column-count"],v=h["column-width"],y=b&&b!==ci.auto&&!bi(b)||v&&v!==ci.auto&&!bi(v);this.nodeContext.establishesBFC=function(e,t,i,n,r,o,s){return r=r||o||ci.horizontal_tb,!!s||!!i&&i!==ci.none&&!bi(i)||ys(t)||e===ci.inline_block||e===ci.table_cell||e===ci.table_caption||e==ci.flex||e==ci.grid||e==ci.flow_root||(e===ci.block||e===ci.list_item)&&!!n&&n!==ci.visible&&n!==ci.clip&&!bi(n)||!!o&&r!==o}(g,i,n,h.overflow,c,d,y||f),this.nodeContext.containingBlockForAbsolute=function(e){return e===ci.relative||e===ci.absolute||e===ci.fixed}(i),this.nodeContext.isInsideBFC()&&n!==ci.footnote&&(!p||!os(p))&&(n=null,u=null);let w=n instanceof ri||n===ci.left||n===ci.right||n===ci.top||n===ci.bottom||n===ci.inline_start||n===ci.inline_end||n===ci.block_start||n===ci.block_end||n===ci.snap_block||n===ci.snap_inline||n===ci.inside||n===ci.outside||n===ci.footnote;n&&(delete h.float,n===ci.footnote&&(this.isFootnote?(w=!1,h.display=ci.block):h.display=ci.inline)),u&&(u===ci.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(u=Kt(this.nodeContext.parent.clearSide)),(u===ci.left||u===ci.right||u===ci.top||u===ci.bottom||u===ci.inline_start||u===ci.inline_end||u===ci.block_start||u===ci.block_end||u===ci.inside||u===ci.outside||u===ci.both||u===ci.all||u===ci.same||u===ci.column||u===ci.region||u===ci.page)&&(delete h.clear,h.display&&h.display!=ci.inline&&(this.nodeContext.clearSide=u.toString())));let x=Es(g)&&!!h["ua-list-item-count"],S=h["break-inside"];(w||S&&!bi(S)&&S!==ci.auto)&&this.nodeContext.breakPenalty++,g&&g!==ci.inline&&ks(g)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!w&&!g||ks(g)||Ns(g),this.nodeContext.display=g?g.toString():"inline",this.nodeContext.floatSide=w?n.toString():null,this.nodeContext.floatReference=p||rs.INLINE;let C=h["float-min-wrap-block"];this.nodeContext.floatMinWrapBlock=C&&!bi(C)?C:null;let k=this.isInsideNonRootMultiColumn(),E=h["column-span"];if(this.nodeContext.columnSpan=k||!E||bi(E)?null:E,!this.nodeContext.inline){let e=h["break-after"];e&&!bi(e)&&(!k||e!==ci.column)&&(this.nodeContext.breakAfter=e.toString(),uo[this.nodeContext.breakAfter]&&(h["break-after"]=ci.column));let t=h["break-before"];t&&!bi(t)&&(!k||t!==ci.column)&&(this.nodeContext.breakBefore=t.toString(),uo[this.nodeContext.breakBefore]&&(this.isAtStartOfPage()?delete h["break-before"]:h["break-before"]=ci.column),1!==this.nodeContext.fragmentIndex&&(this.nodeContext.breakBefore=null));let i=h.page,n=i&&!bi(i)&&i.toString();!n&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||g===ci.table_header_group||g===ci.table_footer_group)&&(n=this.styler.cascade.currentPageType),n&&"auto"!==n.toLowerCase()?this.nodeContext.pageType=n:n=this.nodeContext.pageType,this.styler.cascade.currentPageType!==n&&(n||h.position!==ci.fixed)&&(1===this.nodeContext.fragmentIndex&&!fo(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore="page"),n!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=n)}this.nodeContext.verticalAlign=h["vertical-align"]&&h["vertical-align"].toString()||"baseline",this.nodeContext.captionSide=h["caption-side"]&&h["caption-side"].toString()||"top";let P=h["border-collapse"];if(!P||P===Kt("separate")){let e,t,i=h["border-spacing"];i&&(i instanceof ri?(e=i.values[0],t=i.values[1]):e=t=i,e.isNumeric()&&(this.nodeContext.inlineBorderSpacing=hi(e,this.context)),t.isNumeric()&&(this.nodeContext.blockBorderSpacing=hi(t,this.context)))}let N=h["footnote-policy"];this.nodeContext.footnotePolicy=N&&!bi(N)?N:null;let T=h["x-first-pseudo"];if(T){let e=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new Yo(e,T.num)}this.nodeContext.inline||this.processAfterIfcontinues(s,l,a,this.context);let I=h["white-space"];if(I){let e=Bo(I.toString());null!==e&&(this.nodeContext.whitespace=e)}let A=h["hyphenate-character"];A&&A instanceof qt&&(this.nodeContext.hyphenateCharacter=A.str);let _=h["word-break"],L=h["line-break"],F=h["overflow-wrap"];(_===ci.break_all||L===ci.anywhere||F===ci.break_word||F===ci.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,e,g,i,n,m),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(e=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,e)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(h),this.findAndProcessRepeatingElements(s,a));let O,B=!1,M=[],z=s.namespaceURI,D=s.localName,V=D;if("http://www.w3.org/1999/xhtml"==z?("html"==D||"body"==D||"script"==D||"link"==D||"meta"==D?D="div":"vide_"==D?D="video":"audi_"==D?D="audio":"object"==D&&(B=!!this.customRenderer),s.hasAttribute(_h)&&s.hasAttribute("src")&&h.content instanceof ti&&(D="img")):"http://www.idpf.org/2007/ops"==z?(D="span",z="http://www.w3.org/1999/xhtml"):"http://www.pyroxy.com/ns/shadow"==z?(z="http://www.w3.org/1999/xhtml",D=this.nodeContext.inline?"span":"div"):B=!!this.customRenderer,x)g=ks(g)?ci.inline:ci.block,h.display=g,D=e?"li":"div";else if("body"==D||"li"==D)D="div";else if("q"==D)D="span";else if("a"==D){let e=h["hyperlink-processing"];e&&"normal"!=e.toString()&&(D="span")}if(h.behavior&&"none"!=h.behavior.toString()&&this.customRenderer&&(B=!0),s.dataset&&"true"===s.getAttribute("data-math-typeset")&&(B=!0),B){let e=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;O=this.customRenderer(s,e,h)}else O=qn(null);O.then(t=>{var i,n,a,l,u;if(t)B&&(r="true"==t.getAttribute("data-adapt-process-children"));else{if(h.display===ci.none)return void o.finish(!1);t=this.createElement(z,D)}D!=V&&(t.setAttribute("data-vivliostyle-original-tag",V),("html"===V||"body"===V)&&(t.role="presentation")),"a"==D&&t.addEventListener("click",this.page.hrefHandler,!1),"iframe"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI&&function(e){e.addEventListener("load",()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(e,t){return"mouse-events"===e}}},!1)}(t);let c=this.nodeContext.inheritedProps["image-resolution"],d=[],p=h.width,f=h.height,m=s.getAttribute("width"),b=s.getAttribute("height"),v=p===ci.auto||!p&&!m,y=f===ci.auto||!f&&!b,w=s.attributes,S=w.length,C=null,k=null;g===ci.table_cell&&"a"===(null==(a=null==(n=null==(i=this.nodeContext.parent)?void 0:i.viewNode)?void 0:n.lastElementChild)?void 0:a.localName)&&t.appendChild(this.nodeContext.parent.viewNode.lastElementChild);for(let i=0;i<S;i++){let n=w[i],r=n.namespaceURI,o=n.localName,s=n.nodeValue;if(r){if("http://www.w3.org/2000/xmlns/"==r)continue;"http://www.w3.org/1999/xlink"==r&&"href"==o&&(s=this.documentURLTransformer.transformURL(this.resolveURL(s),this.xmldoc.url))}else{if(!hf&&o.match(/^on/)||"style"==o)continue;if(("id"==o||"name"==o)&&e){let e=this.documentURLTransformer.transformFragment(s,this.xmldoc.url);t.setAttribute(o,s),t.setAttribute("data-vivliostyle-id",e);let i=t.ownerDocument.createElement("a");i.setAttribute(o,e),i.setAttribute(Hs,"1"),i.style.position="absolute",t.appendChild(i),this.page.registerElementWithId(t,e);continue}if("src"==o||"href"==o||"poster"==o)s=this.resolveURL(s),"href"===o&&(s=this.documentURLTransformer.transformURL(s,this.xmldoc.url));else if("srcset"==o)s=s.split(",").map(e=>this.resolveURL(e.trim())).join(",");else if("data"===o&&B&&"object"===D&&t.hasAttribute("data"))continue;if("poster"===o&&"video"===D&&"http://www.w3.org/1999/xhtml"===z&&v&&y){let e=new Image,i=yr(e,s);M.push(i),d.push({image:e,element:t,fetcher:i})}}if("http://www.w3.org/2000/svg"==z&&/^[A-Z\-]+$/.test(o)&&(o=o.toLowerCase()),this.isSVGUrlAttribute(o)&&(s=mf(s,this.xmldoc.url,this.documentURLTransformer)),r){let e=bf[r];e&&(o=`${e}:${o}`)}if("src"!=o||r||"img"!=D&&"input"!=D||"http://www.w3.org/1999/xhtml"!=z)if("alt"!=o||r||"img"!=D||"http://www.w3.org/1999/xhtml"!=z)if("href"==o&&"image"==D&&"http://www.w3.org/2000/svg"==z&&"http://www.w3.org/1999/xlink"==r)this.page.fetchers.push(yr(t,s));else if(r)t.setAttributeNS(r,o,s);else try{t.setAttribute(o,s)}catch(e){R.warn(e)}else k=s;else C=s}if(C){let e="input"===D?new Image:t,i=yr(e,C,k);e!==t&&(t.src=C);let n=()=>{var e,t;if(h.position===ci.fixed)return!0;for(let i=null==(e=this.nodeContext.parent)?void 0:e.viewNode;i&&i!==this.viewRoot;i=i.parentElement)if("fixed"===(null==(t=i.style)?void 0:t.position))return!0;return!1};v||y||(()=>{let e=this.nodeContext.vertical?p:f;return e instanceof Zt&&"%"===e.unit})()||n()?(v&&y&&c&&1!==c&&d.push({image:e,element:t,fetcher:i}),M.push(i)):this.page.fetchers.push(i)}delete h.content;let E=h["list-style-image"];if(E&&E instanceof ti){let e=E.url;M.push(yr(new Image,e))}if(this.preprocessElementStyle(h),this.applyComputedStyles(t,h),this.nodeContext.inline)e||(lo(t,"inline-start"),oo(t)&&lo(t,"clone"));else if(e){if(!ys(h.position)){let e=h["margin-break"],i=this.getBreakTypeAt(this.nodeContext);(e===ci.discard&&null!==i||e!==ci.keep&&"auto"===i&&!this.nodeContext.floatSide)&&ho(t,"block-start")}}else{let e=this.nodeContext.vertical?"width":"height";de(t,e)&&ce(t,e,"table-row"===this.nodeContext.display?"0.01px":""),lo(t,"block-start"),oo(t)&&lo(t,"clone"),ho(t,"block-start")}if(x&&t.setAttribute("value",h["ua-list-item-count"].stringValue()),t.classList.contains("_viv-marker-outside-content")&&Es(null==(u=null==(l=this.nodeContext.parent)?void 0:l.parent)?void 0:u.display)){let e=this.viewport.window.getComputedStyle(this.nodeContext.parent.parent.viewNode),i=parseFloat(e.borderInlineStartWidth)+parseFloat(e.paddingInlineStart)+parseFloat(e.textIndent);i&&(t.style.insetInlineEnd=`${i}px`)}this.viewNode=t,M.length?or(M).then(()=>{c>0&&this.modifyElemDimensionWithImageResolution(d,c,h,this.nodeContext.vertical),o.finish(r)}):o.timeSlice().then(()=>{o.finish(r)})})}),o.result()}isAtStartOfPage(){var e,t;for(let i=this.nodeContext;null!=i&&i.parent&&!i.after;i=i.parent){let n=i!==this.nodeContext||i.viewNode?null==(t=i.viewNode)?void 0:t.previousSibling:null==(e=i.parent.viewNode)?void 0:e.lastChild;for(;n&&(Mo(n,i.parent.whitespace)||js(n));)n=n.previousSibling;if(n)return!1}return!0}isInsideNonRootMultiColumn(){var e;let t=null==(e=this.nodeContext.parent)?void 0:e.viewNode;return!(!t||!Ms(t))}getBreakTypeAt(e){var t,i,n,r,o;if(this.isInsideTable(e))return null;for(let n=e;n&&!n.after;n=n.parent){if(co(n.breakBefore))return n.breakBefore;if(1===n.fragmentIndex&&!n.parent)return n.sourceNode===n.sourceNode.ownerDocument.documentElement?"page":null;if(null!=(t=n.parent)&&t.floatSide)return null;let e=null==(i=n.parent)?void 0:i.viewNode;if(e){let t=this.viewport.window.getComputedStyle(e),i=parseFloat(t.paddingBlockStart),r=parseFloat(t.borderBlockStartWidth);if(i||r)return null;let o=null==e?void 0:e.firstChild;for(;o&&(Mo(o,n.parent.whitespace)||!n.floatSide&&js(o));)o=o.nextSibling;if(o&&o!==n.viewNode)return null}}let s=null==(o=null==(r=null==(n=this.context)?void 0:n.currentLayoutPosition)?void 0:r.flowPositions[this.flowName])?void 0:o.startBreakType;return co(s)?s:"auto"}isInsideTable(e){for(let t=e;t&&!t.after;t=t.parent)if(t.display&&t.display.startsWith("table"))return!0;return!1}processAfterIfcontinues(e,t,i,n){let r=this.getPseudoMap(t,this.regionIds,this.isFootnote,this.nodeContext,n);if(r&&r["after-if-continues"]&&r["after-if-continues"].content){let r=new Fh(e,t,i,n,this.exprContentListener);this.nodeContext.afterIfContinues=new Bh(e,r)}}isSVGUrlAttribute(t){return e.SVG_URL_ATTRIBUTES.includes(t.toLowerCase())}modifyElemDimensionWithImageResolution(e,t,i,n){e.forEach(e=>{if("load"===e.fetcher.get().get()){let r=e.image,o=r.width/t,s=r.height/t,a=e.element;if(o>0&&s>0)if(i["box-sizing"]===ci.border_box&&(i["border-left-style"]!==ci.none&&(o+=hi(i["border-left-width"],this.context)),i["border-right-style"]!==ci.none&&(o+=hi(i["border-right-width"],this.context)),i["border-top-style"]!==ci.none&&(s+=hi(i["border-top-width"],this.context)),i["border-bottom-style"]!==ci.none&&(s+=hi(i["border-bottom-width"],this.context))),t>1){let e=i["max-width"]||ci.none,t=i["max-height"]||ci.none;if(e===ci.none&&t===ci.none)ce(a,"max-width",`${o}px`);else if(e!==ci.none&&t===ci.none)ce(a,"width",`${o}px`);else if(e===ci.none&&t!==ci.none)ce(a,"height",`${s}px`);else{e.isNumeric(),t.isNumeric();let i=e,r=t;"%"!==i.unit?ce(a,"max-width",`${Math.min(o,hi(i,this.context))}px`):"%"!==r.unit?ce(a,"max-height",`${Math.min(s,hi(r,this.context))}px`):n?ce(a,"height",`${s}px`):ce(a,"width",`${o}px`)}}else if(t<1){let e=i["min-width"]||gi,t=i["min-height"]||gi;e.isNumeric(),e.isNumeric();let r=e,l=t;0===r.num&&0===l.num?ce(a,"min-width",`${o}px`):0!==r.num&&0===l.num?ce(a,"width",`${o}px`):0===r.num&&0!==l.num?ce(a,"height",`${s}px`):"%"!==r.unit?ce(a,"min-width",`${Math.max(o,hi(r,this.context))}px`):"%"!==l.unit?ce(a,"min-height",`${Math.max(s,hi(l,this.context))}px`):n?ce(a,"height",`${s}px`):ce(a,"width",`${o}px`)}}})}preprocessElementStyle(e){M("PREPROCESS_ELEMENT_STYLE").forEach(t=>{t(this.nodeContext,e)})}findAndProcessRepeatingElements(e,t){for(let i=e.firstChild;i;i=i.nextSibling){if(1!==i.nodeType)continue;let e={},n=t.getStyle(i,!1);if(this.computeStyle(this.nodeContext.vertical,"rtl"===this.nodeContext.direction,n,e),!this.processRepeatOnBreak(e))continue;if(this.nodeContext.formattingContext instanceof Kh&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let r=this.nodeContext.parent,o=r&&r.formattingContext;return this.nodeContext.formattingContext=new Kh(o,this.nodeContext.sourceNode),void this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical)}}processRepeatOnBreak(e){let t=e["repeat-on-break"];return t!==ci.none&&((t===ci.auto||bi(t))&&(t=e.display===ci.table_header_group?ci.header:e.display===ci.table_footer_group?ci.footer:ci.none),t&&t!==ci.none)?t.toString():null}createTextNodeView(){let e=Gn("createTextNodeView");return this.preprocessTextContent().then(()=>{let t=this.offsetInNode||0,i=Po(this.nodeContext.preprocessedTextContent).substr(t);this.viewNode=document.createTextNode(i),e.finish(!0)}),e.result()}preprocessTextContent(){if(null!=this.nodeContext.preprocessedTextContent)return qn(!0);let e,t=e=this.sourceNode.textContent,i=Gn("preprocessTextContent"),n=M("PREPROCESS_TEXT_CONTENT"),r=0;return i.loop(()=>r>=n.length?qn(!1):n[r++](this.nodeContext,t).thenAsync(e=>(t=e,qn(!0)))).then(()=>{this.nodeContext.preprocessedTextContent=function(e,t){return(0,Eo.default)(e,t,0)}(e,t),i.finish(!0)}),i.result()}createNodeView(e,t){let i,n=Gn("createNodeView"),r=!0;return 1==this.sourceNode.nodeType?i=this.createElementView(e,t):8==this.sourceNode.nodeType?(this.viewNode=null,i=qn(!0)):i=this.createTextNodeView(),i.then(e=>{var t;if(r=e,this.nodeContext.viewNode=this.viewNode,this.viewNode){let e=(e,t)=>1===(null==e?void 0:e.nodeType)&&Rh(e)===t,i=this.nodeContext.parent,n=i?e(this.viewNode,"after")&&e(i.viewNode,"first-letter")&&null!=(t=i.viewNode)&&t.hasChildNodes()?i.parent.viewNode:i.viewNode:this.viewRoot;n&&(this.nodeContext.inline&&!(3===this.viewNode.nodeType&&Mo(this.viewNode))&&!n.hasChildNodes()&&so(n).includes("block-start")&&lo(n,"text-start"),n.appendChild(this.viewNode),function(e){var t;if(1!==e.nodeType)return;let i=e,n=i.style,r="column"===(null==n?void 0:n.breakBefore),o=i.previousElementSibling,s=o&&"column"===(null==(t=o.style)?void 0:t.breakAfter);if(!r&&!s)return;let a=Ms(i);if(!a)return;let l=a.ownerDocument.defaultView.getComputedStyle(a),{writingMode:h,direction:u,columnGap:c,fontSize:d}=l,p="vertical-rl"===h||"vertical-lr"===h,f="rtl"===u,g=(parseFloat(c)||parseFloat(d)||16)/2,m=a.getBoundingClientRect(),b=i.getBoundingClientRect();(p?b.top>m.bottom+g:f?b.right<m.left-g:b.left>m.right+g)&&(r&&(n.breakBefore=""),s&&o&&(o.style.breakAfter=""),n.marginBlockStart=`${Ts}px`)}(this.viewNode))}n.finish(r)}),n.result()}setCurrent(e,t,i){return this.nodeContext=e,e?(this.sourceNode=e.sourceNode,this.offsetInNode=e.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(t,!!i):qn(!0)}processShadowContent(e){if(null==e.shadowContext||"content"!=e.sourceNode.localName||"http://www.pyroxy.com/ns/shadow"!=e.sourceNode.namespaceURI)return e;let t,i,n=e.boxOffset,r=e.shadowContext,o=e.parent,s=r.subShadow||r.parentShadow;r.subShadow?(t=r.root,i=r.type,i==Go.ROOTLESS&&(t=t.firstChild)):(t=r.owner.firstChild,i=Go.ROOTLESS);let a=e.sourceNode.nextSibling;if(a?(e.sourceNode=a,e.resetView()):e.shadowSibling?e=e.shadowSibling:t?e=null:(e=e.parent.modify()).after=!0,t){let r=new Ko(t,o,n);return r.shadowContext=s,r.shadowType=i,r.shadowSibling=e,r}return e.boxOffset=n,e}nextPositionInTree(e){let t=e.boxOffset+1;if(e.after){if(!e.parent)return null;if(e.shadowType!=Go.ROOTED){let i=e.sourceNode.nextSibling;if(i)return(e=e.modify()).boxOffset=t,e.sourceNode=i,e.resetView(),this.processShadowContent(e)}return e.shadowSibling?((e=e.shadowSibling.modify()).boxOffset=t,e):((e=e.parent.modify()).boxOffset=t,e.after=!0,e)}{if(e.nodeShadow){let i=e.nodeShadow.root;if(e.nodeShadow.type==Go.ROOTLESS&&(i=i.firstChild),i){let n=new Ko(i,e,t);return n.shadowContext=e.nodeShadow,n.shadowType=e.nodeShadow.type,this.processShadowContent(n)}}let i=e.sourceNode.firstChild;if(i)return this.processShadowContent(new Ko(i,e,t));if(1!=e.sourceNode.nodeType){t+=Po(e.preprocessedTextContent).length-1-e.offsetInNode}return(e=e.modify()).boxOffset=t,e.after=!0,e}}isTransclusion(e,t,i){let n=Oa(t,"hyperlink-processing");if(!n)return!1;let r=n.evaluate(this.context,"hyperlink-processing");return!!r&&r.toString()==i}nextInTree(e,t){let i=this.nextPositionInTree(e);if(!i||i.after)return qn(i);let n=Gn("nextInTree");return this.setCurrent(i,!0,t).then(e=>{(!i.viewNode||!e)&&(i=i.modify(),i.after=!0,i.viewNode||(i.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:i}),n.finish(i)}),n.result()}addImageFetchers(e){if(e instanceof oi){let t=e.values;for(let e=0;e<t.length;e++)this.addImageFetchers(t[e])}else if(e instanceof ti){let t=e.url;this.page.fetchers.push(yr(new Image,t))}}applyComputedStyles(e,t){var i,n,r;let o=t["background-image"];o&&this.addImageFetchers(o);let s,a,l=t.position===ci.relative,h=null===(null==(i=this.nodeContext)?void 0:i.parent)&&null===(null==(n=this.sourceNode)?void 0:n.parentElement)&&!(null==(r=this.viewRoot)||!r.parentElement),u=Object.keys(t);u.sort(vi);for(let i of u){if(xf[i])continue;let n=t[i];if(n&&(n!==jt||yi(i))){if(n=n.visit(new Yi(this.xmldoc.url,this.documentURLTransformer)),n instanceof Zt)if("em"===n.unit){let e=this.getEmUnitSize(i,s);null!=e&&(n=new Zt(n.num*e,"px"))}else if("lh"===n.unit){let e=this.getLineHeightUnitSize(i,s,a);null!=e&&(n=new Zt(n.num*e,"px"))}else Ze(n.unit)&&(n=ui(n,this.context));if(("font-size"===i||"line-height"===i)&&("font-size"===i?s=n:a=n,this.viewport.layoutUnitAdj&&n instanceof Zt&&"%"!==n.unit&&"em"!==n.unit&&"lh"!==n.unit&&(n=new li(`calc(${n.toString()} - var(--viv-layoutUnitAdj))`))),To[i]||l&&Io[i]){this.page.delayedItems.push(new Ao(e,i,n));continue}h&&this.page.pageAreaElement&&Fa(i)?ce(this.page.pageAreaElement.parentElement.parentElement,i,n.toString()):ce(e,i,n.toString())}}}parsePlusLayoutUnitAdj(e){if(e.endsWith("px")){let t=parseFloat(e);if(!isNaN(t))return Math.round((t+this.viewport.layoutUnitAdj)*this.viewport.layoutUnitPerPixel)/this.viewport.layoutUnitPerPixel}return null}getLineHeightUnitSize(e,t,i){var n,r,o,s,a,l;let h=1===(null==(o=null==(r=null==(n=this.nodeContext)?void 0:n.parent)?void 0:r.viewNode)?void 0:o.nodeType)?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,u=h?this.parsePlusLayoutUnitAdj(h.lineHeight):this.context.rootLineHeight;if("line-height"===e||"font-size"===e)return u;let c=null;if(i){if(!(i instanceof Jt||i instanceof Zt&&("em"===i.unit||"%"===i.unit))){if(i instanceof Zt&&"lh"!==i.unit){let e=this.context.queryUnitSize(i.unit,!1);if(null!=e)return i.num*e}return null}c=i instanceof Zt&&"%"===i.unit?i.num/100:i.num}if(null==c)for(let e=null==(a=null==(s=this.nodeContext)?void 0:s.parent)?void 0:a.viewNode;e&&1===e.nodeType;e=e.parentNode){let t=null==(l=null==e?void 0:e.style)?void 0:l.lineHeight;if(t){/^[0-9.]+$/.test(t)&&(c=parseFloat(t));break}}if(null!=c){if(t&&!(t instanceof Zt))return null;let e=h?this.parsePlusLayoutUnitAdj(h.fontSize):this.context.rootFontSize;if(t instanceof Zt){let i=Ga(t,e,this.context).num;return"number"!=typeof i||isNaN(i)?null:c*i}return null==e?null:c*e}return u}getEmUnitSize(e,t){var i,n,r;let o=1===(null==(r=null==(n=null==(i=this.nodeContext)?void 0:i.parent)?void 0:n.viewNode)?void 0:r.nodeType)?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,s=o?this.parsePlusLayoutUnitAdj(o.fontSize):this.context.rootFontSize;if("font-size"===e||null==t)return s;if(t instanceof Zt){let e=Ga(t,s,this.context).num;if("number"==typeof e&&!isNaN(e))return e}return null}applyPseudoelementStyle(e,t,i){if(e.after)return;let n=this.sourceNode,r=(e.shadowContext?e.shadowContext.styler:this.styler).getStyle(n,!1),o=Ma(r,"_pseudos");if(!o||(r=o[t],!r))return;let s={};e.vertical=this.computeStyle(e.vertical,"rtl"===e.direction,r,s);let a=s.content;ns(a)&&(a.visit(new is(i,this.context,a,this.exprContentListener)),delete s.content),this.applyComputedStyles(i,s)}peelOff(e,t){let i=Gn("peelOff"),n=e.firstPseudo,r=e.offsetInNode,o=e.after;if(t>0){let i=e.viewNode.textContent;e.viewNode.textContent=i.substr(0,t),r+=t}else if(!o&&e.viewNode&&0==r){let t=e.viewNode.parentNode;t&&t.removeChild(e.viewNode)}let s=e.boxOffset+t,a=[];for(;e.firstPseudo===n;)a.push(e),e=e.parent;let l=a.pop(),h=l.shadowSibling;return i.loop(()=>{for(;a.length>0;){l=a.pop(),e=new Ko(l.sourceNode,e,s),0==a.length&&(e.offsetInNode=r,e.after=o),e.shadowType=l.shadowType,e.shadowContext=l.shadowContext,e.nodeShadow=l.nodeShadow,e.shadowSibling=l.shadowSibling?l.shadowSibling:h,h=null;let t=this.setCurrent(e,!1);if(t.isPending())return t}return qn(!1)}).then(()=>{i.finish(e)}),i.result()}createElement(e,t){return"http://www.w3.org/1999/xhtml"==e?this.document.createElement(t):this.document.createElementNS(e,t)}applyFootnoteStyle(e,t,i){let n={},r=Ma(this.footnoteStyle,"_pseudos");if(e=this.computeStyle(e,t,this.footnoteStyle,n),r&&r.before){let n={},o=this.createElement("http://www.w3.org/1999/xhtml","span");Lh(o,"before"),i.appendChild(o),this.computeStyle(e,t,r.before,n),delete n.content,this.applyComputedStyles(o,n)}return delete n.content,this.applyComputedStyles(i,n),e}processFragmentedBlockEdge(e){var t,i,n;let r=!e.inline&&e.after?e.parent:e,o=!1;if(e.inline&&e.after&&!e.shadowContext&&1===(null==(t=e.sourceNode.nextSibling)?void 0:t.nodeType)){let t=e.sourceNode.nextSibling,n=null==(i=Oa(this.styler.getStyle(t,!1),"display"))?void 0:i.value.toString();o=n&&!ks(n)||"true"===t.getAttribute("data-math-typeset")&&/^\s*(\$\$|\\\[)/.test(t.textContent)}let s=0;for(let e=r;e;e=e.parent){if(1!==(null==(n=e.viewNode)?void 0:n.nodeType))continue;let t=e.viewNode;if(t.style)if(e.inline){if(lo(t,"inline-end"),oo(t)){let i=e.vertical?t.offsetWidth:t.offsetHeight;lo(t,"clone"),(e.vertical?t.offsetWidth:t.offsetHeight)>i&&this.fixClonedBoxDecorationOverflow(t)}}else{let i=this.nodeContext.vertical?"width":"height";if(de(t,i)&&ce(t,i,""),lo(t,"block-end"),!s++&&e!==r){let{textAlign:e}=this.viewport.window.getComputedStyle(t);if("justify"!==e||o)lo(t,"text-end");else{let e=this.createChildAnonymousBlockIfNeeded(t);e?e!==t?ao(e,["block-start","text-start","block-end","text-end","justify"]):(lo(t,"text-end"),lo(t,"justify")):lo(t,"text-end")}}oo(t)&&lo(t,"clone"),ho(t,"block-end")}}}fixClonedBoxDecorationOverflow(e){let t=this.viewport.window.getComputedStyle(e),i=-(parseFloat(t.paddingInlineEnd)+parseFloat(t.borderInlineEndWidth));isNaN(i)||(e.style.marginInlineEnd=`${i}px`)}createChildAnonymousBlockIfNeeded(e){let t=e=>{let{display:i,position:n,float:r}=this.viewport.window.getComputedStyle(e);if("ruby"===e.localName||Te[e.localName])return!1;if("br"===e.localName)return!0;if(("inline"===i||"contents"===i)&&e.hasChildNodes()){let i=e.lastElementChild;if(i&&(!i.nextSibling||i.nextSibling===e.lastChild&&Mo(i.nextSibling))){let e=t(i);if(e||null===e)return e}for(let e=null==i?void 0:i.previousElementSibling;e;e=e.previousElementSibling){let i=t(e);if(i||null===i)return null}return!1}if("none"===i||"absolute"===n||"fixed"===n||r&&"none"!==r||e.hasAttribute(Hs)){let i=e.previousElementSibling;return!(!i||!(i.nextSibling===e||i.nextSibling===e.previousSibling&&Mo(i.nextSibling)))&&t(i)}return!(!i||ks(i))},i=null;for(let n=e.lastElementChild;n;n=n.previousElementSibling){let e=t(n);if(e){i=n;break}if(null===e)return null}if(!i)return e;if(i===e.lastElementChild&&(!i.nextSibling||i.nextSibling===e.lastChild&&Mo(i.nextSibling)))return null;let n=e.ownerDocument.createElement("span");n.className="viv-anonymous-block";for(let e=i.nextSibling,t=null;e;e=t)t=e.nextSibling,n.appendChild(e);return e.appendChild(n),n}convertLengthToPx(e,t,i){let n=e.num,r=e.unit;if(function(e){switch(null==e?void 0:e.toLowerCase()){case"em":case"rem":case"lh":case"rlh":return!0;default:return!1}}(r)){let n=t;for(;n&&1!==n.nodeType;)n=n.parentNode;let r=parseFloat(i.getElementComputedStyle(n)["font-size"]);return this.context,Wa(e,r,this.context).num}{let t=this.context.queryUnitSize(r,!1);return t?n*t:e}}isSameNodePositionStep(e,t){if(e.shadowContext){if(!t.shadowContext)return!1;let i=1===e.node.nodeType?e.node:e.node.parentElement,n=1===t.node.nodeType?t.node:t.node.parentElement;return e.shadowContext.owner===t.shadowContext.owner&&Rh(i)===Rh(n)}return e.node===t.node}isSameNodePosition(e,t){return e.offsetInNode===t.offsetInNode&&e.after==t.after&&e.steps.length===t.steps.length&&e.steps.every((e,i)=>{let n=t.steps[i];return this.isSameNodePositionStep(e,n)})}isPseudoelement(e){return!!Rh(e)}};h(vf,"SVG_URL_ATTRIBUTES",["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"]);var yf,wf=vf,xf={"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,"margin-break":!0,page:!0},Sf=class{constructor(e){h(this,"layoutBox"),h(this,"window"),h(this,"pixelRatio"),h(this,"scaleRatio"),h(this,"layoutUnitPerPixel"),this.layoutBox=e.layoutBox,this.window=e.window,this.pixelRatio=e.pixelRatio,this.scaleRatio=e.scaleRatio,this.layoutUnitPerPixel=e.layoutUnitPerPixel}subtractOffsets(e,t){let i=t.left,n=t.top;return{left:e.left-i,top:e.top-n,right:e.right-i,bottom:e.bottom-n,width:e.width,height:e.height}}getRangeClientRects(e){let t=e.getClientRects(),i=this.layoutBox.getBoundingClientRect();return Array.from(t).map(e=>this.subtractOffsets(e,i))}getElementClientRect(e){let t=e.getBoundingClientRect();if(0===t.left&&0===t.top&&0===t.right&&0===t.bottom)return t;let i=this.layoutBox.getBoundingClientRect();return this.subtractOffsets(t,i)}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}adjustLengthValue(e){return this.layoutUnitPerPixel?Math.floor(e*this.layoutUnitPerPixel)/this.layoutUnitPerPixel:e}},Cf=class{constructor(e,t,i,n,r,o){this.window=e,this.fontSize=t,this.pixelRatio=i,h(this,"document"),h(this,"root"),h(this,"outerZoomBox"),h(this,"contentContainer"),h(this,"layoutBox"),h(this,"width"),h(this,"height"),h(this,"scaleRatio",1),h(this,"layoutUnitPerPixel"),h(this,"layoutUnitAdj",0),this.document=e.document,this.root=n||this.document.body;let s=this.root.firstElementChild;s||(s=this.document.createElement("div"),s.setAttribute("data-vivliostyle-outer-zoom-box","true"),s.role="presentation",this.root.appendChild(s));let a=s.firstElementChild;switch(a||(a=this.document.createElement("div"),a.setAttribute("data-vivliostyle-spread-container","true"),a.role="presentation",s.appendChild(a)),i>0&&CSS.supports("zoom","8")&&(ce(this.root,"--viv-outputPixelRatio",`${i}`),ce(this.root,"--viv-devicePixelRatio",`${e.devicePixelRatio}`),this.scaleRatio=i/e.devicePixelRatio),X){case"chromium":this.layoutUnitPerPixel=64*(this.pixelRatio||e.devicePixelRatio),this.layoutUnitAdj=1/this.layoutUnitPerPixel;break;case"firefox":this.layoutUnitPerPixel=60,this.layoutUnitAdj=1/this.layoutUnitPerPixel;break;default:this.layoutUnitPerPixel=64,this.layoutUnitAdj=0}this.layoutUnitAdj&&ce(this.root,"--viv-layoutUnitAdj",`${this.layoutUnitAdj}px`);let l=s.nextElementSibling;l||(l=this.document.createElement("div"),l.setAttribute("data-vivliostyle-layout-box","true"),l.role="presentation",this.root.appendChild(l)),this.outerZoomBox=s,this.contentContainer=a,this.layoutBox=l,this.width=r||parseFloat(e.getComputedStyle(this.root).width)||this.root.offsetWidth||e.innerWidth,this.height=o||parseFloat(e.getComputedStyle(this.root).height)||this.root.offsetHeight||e.innerHeight;let u=794,c=1056,d=!e.outerWidth&&!e.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&800===e.innerWidth&&600===e.innerHeight;(!this.width||!r&&d)&&(this.width=u),(!this.height||!o&&d)&&(this.height=c)}resetZoom(){ce(this.outerZoomBox,"width",""),ce(this.outerZoomBox,"height",""),ce(this.contentContainer,"width",""),ce(this.contentContainer,"height",""),ce(this.contentContainer,"transform","")}zoom(e,t,i){ce(this.root,"--viv-outputScale",`${i}`),ce(this.outerZoomBox,"width",e*i+"px"),ce(this.outerZoomBox,"height",t*i+"px"),ce(this.contentContainer,"width",`${e}px`),ce(this.contentContainer,"height",`${t}px`)}clear(){let e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}},kf=class{constructor(e,t,i){this.store=e,this.url=t,this.document=i,h(this,"lang",null),h(this,"totalOffset",-1),h(this,"root"),h(this,"body"),h(this,"head"),h(this,"last"),h(this,"lastOffset",1),h(this,"idMap"),this.root=i.documentElement;let n=null,r=null;if("http://www.w3.org/1999/xhtml"==this.root.namespaceURI){for(let e=this.root.firstChild;e;e=e.nextSibling){if(1!=e.nodeType)continue;let t=e;if("http://www.w3.org/1999/xhtml"==t.namespaceURI)switch(t.localName){case"head":r=t;break;case"body":n=t}}this.lang=this.root.getAttribute("lang")}this.body=n,this.head=r,this.last=this.root,this.last.setAttribute(K,"0")}doc(){return new If([this.document])}getElementOffset(e){let t=e.getAttribute(K);if(t)return parseInt(t,10);let i=this.lastOffset,n=this.last;for(;n!=e;){let e=n.firstChild;if(!e)for(;e=n.nextSibling,!e;)if(n=n.parentNode,null==n)throw new Error("Internal error");n=e,1==e.nodeType?(e.setAttribute(K,i.toString()),++i):i+=e.textContent.length}return this.lastOffset=i,this.last=e,i-1}getNodeOffset(e,t,i){let n=0,r=e,o=null;if(1==r.nodeType){if(!i)return this.getElementOffset(r)}else{if(n=t,o=r.previousSibling,!o)return r=r.parentNode,n+=1,this.getElementOffset(r)+n;r=o}for(;;){for(;r.lastChild;)r=r.lastChild;if(1==r.nodeType)break;if(n+=r.textContent.length,o=r.previousSibling,!o){r=r.parentNode;break}r=o}return n+=1,this.getElementOffset(r)+n}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t,i=this.root;for(;;){if(t=this.getElementOffset(i),t>=e)return i;let n=i.children;if(!n)break;let r=Ce(n.length,t=>{let i=n[t];return this.getElementOffset(i)>e});if(0==r)break;i=n[r-1]}let n=t+1,r=i,o=r.firstChild||r.nextSibling,s=null;for(;;){if(o){if(1==o.nodeType||(r=o,s=r,n+=o.textContent.length,n>e&&!/^\s*$/.test(o.textContent)))break}else if(r=r.parentNode,!r)break;o=r.nextSibling}return o&&s&&/^\s*$/.test(s.textContent)&&(s=o),s||i}buildIdMap(e){let t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);let i=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");i&&!this.idMap[i]&&(this.idMap[i]=e);for(let t=e.firstElementChild;t;t=t.nextElementSibling)this.buildIdMap(t)}getElement(e){let t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;let i=t[2],n=this.document.getElementById(i);return!n&&this.document.getElementsByName&&(n=this.document.getElementsByName(i)[0]),n||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),n=this.idMap[i]),n}},Ef=((yf=Ef||{}).TEXT_HTML="text/html",yf.TEXT_XML="text/xml",yf.APPLICATION_XML="application/xml",yf.APPLICATION_XHTML_XML="application/xhtml+xml",yf.IMAGE_SVG_XML="image/svg+xml",yf);function Pf(e,t,i){let n,r=i||new DOMParser;try{n=r.parseFromString(e,t)}catch(e){}if(!n)return null;{let e=n.documentElement,t="parsererror";if(e.localName===t)return null;for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(i.localName===t)return null}return n}function Nf(e,t){let i=e.responseXML;if(!i){let t=new DOMParser,n=e.responseText;if(n){let r=function(e){let t=e.contentType;if(t){let e=Object.keys(Ef);for(let i=0;i<e.length;i++)if(Ef[e[i]]===t)return t;if(t.match(/\+xml$/))return"application/xml"}let i=e.url.match(/\.([^./#?]+)([#?]|$)/);if(i)switch(i[1]){case"html":case"htm":return"text/html";case"xhtml":case"xht":return"application/xhtml+xml";case"svg":case"svgz":return"image/svg+xml";case"opf":case"xml":return"application/xml"}return null}(e);if(i=Pf(n,r||"application/xml",t),i&&!r){let e=i.documentElement;"html"!==e.localName.toLowerCase()||e.namespaceURI?"svg"===e.localName.toLowerCase()&&"image/svg+xml"!==i.contentType&&(i=Pf(n,"image/svg+xml",t)):i=Pf(n,"text/html",t)}i||(i=Pf(n,"text/html",t))}}return qn(i?new kf(t,e.url,i):null)}var Tf=new class e{constructor(e){this.fn=e}check(e){return this.fn(e)}withAttribute(t,i){return new e(e=>this.check(e)&&1==e.nodeType&&e.getAttribute(t)==i)}withChild(t,i){return new e(e=>{if(!this.check(e))return!1;let n=new If([e]);return n=n.child(t),i&&(n=n.predicate(i)),n.size()>0})}}(e=>!0),If=class e{constructor(e){this.nodes=e}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let i=[];for(let e of this.nodes)t.check(e)&&i.push(e);return new e(i)}forEachNode(t){let i=[],n=e=>{i.push(e)};for(let e=0;e<this.nodes.length;e++)t(this.nodes[e],n);return new e(i)}forEach(e){let t=[];for(let i=0;i<this.nodes.length;i++)t.push(e(this.nodes[i]));return t}forEachNonNull(e){let t=[];for(let i=0;i<this.nodes.length;i++){let n=e(this.nodes[i]);null!=n&&t.push(n)}return t}child(e){return this.forEachNode((t,i)=>{for(let n=t.firstChild;n;n=n.nextSibling)1==n.nodeType&&n.localName==e&&i(n)})}childElements(){return this.forEachNode((e,t)=>{for(let i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&t(i)})}attribute(e){return this.forEachNonNull(t=>1==t.nodeType?t.getAttribute(e):null)}textContent(){return this.forEach(e=>e.textContent)}},Af=new rr(()=>{let e=Gn("uaStylesheetBase"),t=Ud(),i=re("user-agent-base.css",ie),n=new Gl(null,null,null,null,null,t,!0);return n.startStylesheet("UA"),function(e){Wl=e}(n.cascade),Wr(cr,n,i,null,null).thenFinish(e),e.result()},"uaStylesheetBaseFetcher"),_f=class extends ih{constructor(e,t,i,n,r,o){super(e,t,null,i,n,"counter-style"),this.counterStyleName=r,this.counterStyles=o}endRule(){super.endRule(),this.counterStyles.define(this.counterStyleName,this.elementStyle)||R.warn(`E_CSS_COUNTER_STYLE_INVALID: @counter-style ${this.counterStyleName}`)}},Rf=class{constructor(e,t,i,n,r,o,s,a,l,u,c){this.store=e,this.rootScope=t,this.pageScope=i,this.cascade=n,this.rootBox=r,this.fontFaces=o,this.footnoteProps=s,this.flowProps=a,this.viewportProps=l,this.pageProps=u,this.counterStyleStore=c,h(this,"fontDeobfuscator"),h(this,"validatorSet"),this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",function(e){let t=this,i=t.currentLayoutPosition,n=i.firstFlowChunkOfFlow(e);return t.matchPageSide(i.startSideOfFlow(e))&&i.hasContent(e,t.lookupOffset)&&!!n&&!t.flowChunkIsAfterParentFlowForcedBreak(n)}),this.pageScope.defineName("page-number",new Tt(this.pageScope,function(){return this.pageNumberOffset+this.currentLayoutPosition.page},"page-number")),this.pageScope.defineName("blank-page",new Tt(this.pageScope,function(){let e=this.currentLayoutPosition;return null==e?void 0:e.isBlankPage},"blank-page"))}sizeViewport(e,t,i,n){if(this.viewportProps.length){let r=new Je(this.rootScope,e,t,i),o=function(e,t){let i={};for(let n=0;n<t.length;n++)Ha(e,i,t[n],0,null,null,null);return i}(r,this.viewportProps),s=o.width,a=o.height,l=o["text-zoom"],h=1;if(s&&a||l){let o=Ke.em;if((l?l.evaluate(r,"text-zoom"):null)===ci.scale&&(h=o/i,i=o,e*=h,t*=h),s&&a){let e=hi(s.evaluate(r,"width"),r),t=hi(a.evaluate(r,"height"),r);if(e>0&&t>0)return{width:n&&n.spreadView?2*(e+n.pageBorder):e,height:t,fontSize:i}}}}return{width:e,height:t,fontSize:i}}},Lf=class extends Je{constructor(e,t,i,n,r,o,s,a,l,u,c,d,p){super(e.rootScope,n.width,n.height,n.fontSize),this.style=e,this.xmldoc=t,this.viewport=n,this.clientLayout=r,this.fontMapper=o,this.customRenderer=s,this.fallbackMap=a,this.pageNumberOffset=l,this.documentURLTransformer=u,this.counterStore=c,h(this,"lang"),h(this,"primaryFlows",{body:!0}),h(this,"rootPageBoxInstance",null),h(this,"styler",null),h(this,"stylerMap",null),h(this,"currentLayoutPosition",null),h(this,"layoutPositionAtPageStart",null),h(this,"lookupOffset",0),h(this,"faces"),h(this,"pageBoxInstances",{}),h(this,"pageManager",null),h(this,"rootPageFloatLayoutContext"),h(this,"pageBreaks",{}),h(this,"pageProgression",null),h(this,"isVersoFirstPage",!1),h(this,"blankPageAtStart",!1),h(this,"pageSheetSize",{}),h(this,"pageSheetHeight",0),h(this,"pageSheetWidth",0),this.lang=t.lang||i,this.faces=new Gd(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new cs(null,null,null,null,null,null,null),this.pageProgression=d||null,this.isVersoFirstPage=!!p;for(let t in e.flowProps){let i=Oa(e.flowProps[t],"flow-consume");i&&(i.evaluate(this,"flow-consume")==ci.all?this.primaryFlows[t]=!0:delete this.primaryFlows[t])}}init(){let e=Gn("StyleInstance.init"),t=this.counterStore.createCounterListener(this.xmldoc.url),i=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new fd(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,t,i,this.style.counterStyleStore),i.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let n=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=xp(n)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(0===this.pageNumberOffset?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let r=this.style.rootBox;this.rootPageBoxInstance=new pp(r);let o=this.style.cascade.createInstance(this,t,i,this.lang,this.style.counterStyleStore);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(o,n),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new Yp(o,this.style.pageScope,this.rootPageBoxInstance,this,n);let s=[];for(let e of this.style.fontFaces){if(e.condition&&!e.condition.evaluate(this))continue;let t=jd(e.properties,this),i=new Wd(t);s.push(i)}this.fontMapper.findOrLoadFonts(s,this.faces).then(()=>{(function(e,t,i){if(!hf)return qn(!1);let n=df(e);if(0===n.length)return qn(!1);let r=n.some(e=>!(e.async||e.defer||"module"===e.type)),o=r?ff(e,t,i):null,s=t.document.fonts,a=t.$,l=!1,h=Gn("loadScripts");return h.loop(()=>{if(0===n.length)return r?h.sleep(20).thenAsync(()=>{var e,i;return"loading"===s.status||t.document.documentElement.classList.contains("wf-loading")||null!=(e=t.FontJSON)&&e.Font&&null!=(i=t.ret)&&i.readyState&&t.ret.readyState<4?qn(!0):qn(!1)}):qn(!1);let e=n.shift();return pf(e,t,{inHead:!0,forceDefer:l}).thenAsync(()=>(!l&&t.$!==a&&(uf.push(e),l=!0),0===n.length&&r&&(R.debug("dispatchEvent: DOMContentLoaded (document)"),t.document.dispatchEvent(new Event("DOMContentLoaded"))),qn(!0)))}).then(()=>{o&&o.remove(),h.finish(!0)}),h.result()})(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)});let a=this.style.pageProps;return a[""]||(a[""]={}),Object.keys(a).forEach(e=>{let t=a[e];this.styler.cascade.applyVarFilter([t],this.styler,null),this.styler.cascade.applyCalcFilter(t,this.styler.context);let i=Np(Pp(t),this);this.pageSheetSize[e]={width:i.pageWidth+2*i.cropOffset,height:i.pageHeight+2*i.cropOffset}}),e.result()}matchStartPageSide(e){let t=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),i="ltr"==this.pageProgression;switch(e){case"left":return t!==i;case"right":return t===i;case"recto":return t;case"verso":return!t;default:return!0}}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){let i=this.style.store.getStyleForDoc(e),n=new Je(i.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),r=this.counterStore.createCounterListener(e.url),o=this.counterStore.createCounterResolver(e.url,i.rootScope,i.pageScope);t=new fd(e,i.cascade,i.rootScope,n,this.primaryFlows,i.validatorSet,r,o,i.counterStyleStore),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){let i=this.currentLayoutPosition;if(i){i.flows[e.flowName]?t=i.flows[e.flowName]:i.flows[e.flowName]=t;let n=i.flowPositions[e.flowName];n||(n=new Qo,i.flowPositions[e.flowName]=n);let r=function(e){return{steps:[{node:e,shadowType:Go.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}(e.element),o=new Zo(r),s=new Jo(o,e);n.positions.push(s)}}evalSupportsTest(e,t,i){if(i)return"selector"===e&&this.evalSupportsSelector(t);if(!e)return!1;let n=!0;let r=new class{unknownProperty(e,t){n=!1}invalidPropertyValue(e,t){n=!1}simpleProperty(e,t,i){}},o=qr(this.style.rootScope,new Hn(t,null),"");return!!o&&(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,o,!1,r),n)}evalSupportsSelector(e){let t=new Of(null),i=new Hn(e+"{}",t);return!!new Hr(Nr,i,t,"").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)&&!t.cascadeParserHandler.invalid}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let i=0;i<e.positions.length;i++){let n=e.positions[i].chunkPosition.primary,r=n.steps[0].node,o=n.offsetInNode,s=n.after,a=0;for(;r.ownerDocument!=this.xmldoc.document;)a++,r=n.steps[a].node,s=!1,o=0;let l=this.xmldoc.getNodeOffset(r,o,s);l<t&&(t=l)}return t}getPosition(e,t){if(!e)return 0;let i=Number.POSITIVE_INFINITY;for(let n in this.primaryFlows){let r=e.flowPositions[n];if(!t&&(!r||0==r.positions.length)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(n),r=this.currentLayoutPosition.flowPositions[n],e!=this.currentLayoutPosition&&r&&(r=r.clone(),e.flowPositions[n]=r)),r){let e=this.getConsumedOffset(r);e<i&&(i=e)}}return i}dumpLocation(e){R.debug("Location - page",this.currentLayoutPosition.page),R.debug("  current:",e),R.debug("  lookup:",this.lookupOffset);for(let e in this.currentLayoutPosition.flowPositions){let t=this.currentLayoutPosition.flowPositions[e];for(let i of t.positions)R.debug("  Chunk",`${e}:`,i.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new Pt(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let t in e.flowPositions){let i=e.flowPositions[t];if(i&&i.positions.length>0){let e=i.positions[0].flowChunk;if(this.getConsumedOffset(i)===e.startOffset){let e=i.positions[0].flowChunk.breakBefore,t=i.startBreakType;i.startBreakType=vo(bo(t,e))}}}}selectPageMaster(e){let t=this.currentLayoutPosition,i=this.getPosition(t);if(i==Number.POSITIVE_INFINITY)return null;let n,r=this.rootPageBoxInstance.children;for(let o=0;o<r.length;o++){if(n=r[o],n.pageBox.pseudoName===Bp)continue;let s=1;n.pageBox.pseudoName===dp&&(!this.actualPageWidth||!this.actualPageHeight)&&(s=1/0);let a=n.getProp(this,"utilization");a&&a.isNum()&&(s=a.num);let l=this.queryUnitSize("em",!1),h=this.pageWidth()*this.pageHeight(),u=Math.ceil(s*h/(l*l)),c=this.styler.cascade.currentPageType;this.lookupOffset=this.styler.styleUntil(i,u),this.styler.cascade.currentPageType=c,this.updateStartSide(t),this.layoutPositionAtPageStart=t.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let d=n.getProp(this,"enabled");if(!d||d===ci._true){if(1===t.page&&this.blankPageAtStart){n.style={};let t=e.size;e={},t&&(e.size=t)}return this.pageManager.getPageRulePageMaster(n,e)}}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){let t=this.layoutPositionAtPageStart.flows,i=t[e.flowName].parentFlowName;if(i){let n=e.startOffset,r=t[i].forcedBreakOffsets;if(!r.length||n<r[0])return!1;let o=Ce(r.length,e=>r[e]>n)-1,s=r[o],a=this.layoutPositionAtPageStart.flowPositions[i],l=this.getConsumedOffset(a);return!(s<l)&&(l<s||!this.matchPageSide(a.startBreakType))}return!1}setFormattingContextToColumn(e,t){let i=this.currentLayoutPosition.flows[t];i.formattingContext||(i.formattingContext=new Qs(null)),e.flowRootFormattingContext=i.formattingContext}layoutDeferredPageFloats(e){let t=e.pageFloatLayoutContext,i=t.getDeferredPageFloatContinuations(),n=e=>{if(e.floatReference!==rs.PAGE)return!1;let t=this.layoutPositionAtPageStart.flowPositions.body,i=t&&this.getConsumedOffset(t),n=this.xmldoc.getNodeOffset(e.nodePosition.steps[0].node,0,!1);return null!=n&&null!=i&&n>i},r=Gn("layoutDeferredPageFloats"),o=!1,s=0;return r.loopWithFrame(r=>{if(s===i.length)return void r.breakLoop();let a=i[s++],l=a.float;if(n(l))return void r.breakLoop();let h=(new ps).findByFloat(l),u=h.findPageFloatFragment(l,t);if(!u||!u.hasFloat(l))return t.isForbidden(l)||t.hasPrecedingFloatsDeferredToNext(l)?(t.deferPageFloat(a),void r.breakLoop()):void e.layoutPageFloatInner(a,h,null,u).then(e=>{if(!e)return void r.breakLoop();let i=t.parent.isInvalidated();i?r.breakLoop():(t.isInvalidated()&&!i&&(o=!0,t.validate()),r.continueLoop())});r.continueLoop()}).then(()=>{o&&t.invalidate(),r.finish(!0)}),r.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0){if(e.lastAfterPosition){let i;return t?(i=t.clone(),i.primary=e.lastAfterPosition):i=new Zo(e.lastAfterPosition),i}return null}return null}layoutColumn(e,t){let i=this.currentLayoutPosition.flowPositions[t];if(!i||!this.matchPageSide(i.startBreakType))return qn(!0);this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);let n=Gn("layoutColumn");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated())return void n.finish(!0);let r=[],o=[],s=!0;n.loopWithFrame(n=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t))n.breakLoop();else{for(;i.positions.length-o.length>0;){let t=0;for(;o.includes(t);)t++;let a=i.positions[t];if(a.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(a.flowChunk))break;for(let e=t+1;e<i.positions.length;e++){if(o.includes(e))continue;let n=i.positions[e];if(n.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(n.flowChunk))break;n.flowChunk.isBetter(a.flowChunk)&&(a=n,t=e)}let l=a.flowChunk,h=!0;if(e.layout(a.chunkPosition,s,i.breakAfter).then(u=>{if(e.pageFloatLayoutContext.isInvalidated())n.breakLoop();else{if(s=!1,a.flowChunk.repeated&&(null===u||l.exclusive)&&r.push(t),l.exclusive)return o.push(t),void n.breakLoop();{let s=!!u||!!e.pageBreakType,l=this.getLastAfterPositionIfDeferredFloatsExists(e,u);if(e.pageBreakType&&l?(a.chunkPosition=l,i.breakAfter=e.pageBreakType,e.pageBreakType=null):(o.push(t),(u||l)&&(a.chunkPosition=u||l,r.push(t)),i.startBreakType=vo(e.pageBreakType)),s)return void n.breakLoop()}e.forceNonfitting=!1,h?h=!1:n.continueLoop()}}),h)return void(h=!1)}n.breakLoop()}}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){i.positions=i.positions.filter((e,t)=>r.includes(t)||!o.includes(t)),"column"===i.breakAfter&&(i.breakAfter=null),e.saveDistanceToBlockEndFloats();let t=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(t)}n.finish(!0)})}),n.result()}createLayoutConstraint(e){let t=this.currentLayoutPosition.page-1,i=this.counterStore.createLayoutConstraint(t);return new Uh([i].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,i,n,r,o,s,a,l,h,u,c,d,p){let f,g=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,m=r.element,b=new cs(a,rs.COLUMN,null,s,null,null,null),v=this.currentLayoutPosition.clone(),y=Gn("createAndLayoutColumn");return y.loopWithFrame(e=>{let y=this.createLayoutConstraint(b);if(l>1){let e=this.viewport.document.createElement("div");if(ce(e,"position","absolute"),m.appendChild(e),f=new $h(e,d,this.clientLayout,y,b),f.forceNonfitting=p,f.vertical=r.vertical,f.rtl=r.rtl,f.snapHeight=r.snapHeight,f.snapWidth=r.snapWidth,r.vertical){let e=(r.rtl?l-o-1:o)*(u+h)+r.paddingTop,t=parseFloat(m.style.width);f.setHorizontalPosition(r.paddingLeft+t-r.width,r.width),f.setVerticalPosition(e,u)}else{let e=(r.rtl?l-o-1:o)*(u+h)+r.paddingLeft;f.setVerticalPosition(r.paddingTop,r.height),f.setHorizontalPosition(e,u)}f.originX=t,f.originY=i}else f=new $h(m,d,this.clientLayout,y,b),f.copyFrom(r);f.exclusions=g?[]:n.concat(),f.innerShape=c,b.setContainer(f),(f.vertical?f.height:f.width)>=0?this.layoutColumn(f,s).then(()=>{b.isInvalidated()||b.finish(),f.pageFloatLayoutContext.isInvalidated()&&!a.isInvalidated()?(f.pageFloatLayoutContext.validate(),this.currentLayoutPosition=v.clone(),f.element!==m&&m.removeChild(f.element),e.continueLoop()):e.breakLoop()}):(b.finish(),e.breakLoop())}).then(()=>{y.finish(f)}),y.result()}setPagePageFloatLayoutContextContainer(e,t,i){(t instanceof qp||t instanceof fp&&!(t instanceof Hp))&&e.setContainer(i)}getRegionPageFloatLayoutContext(e,t,i,n){let r=t.getProp(this,"writing-mode")||null,o=t.getProp(this,"direction")||null;return new cs(e,rs.REGION,i,n,null,r,o)}layoutFlowColumnsWithBalancing(e,t,i,n,r,o,s,a,l){let h=this.currentLayoutPosition.clone(),u=this.getRegionPageFloatLayoutContext(o,t,s,a),c=!0,d=()=>(this.currentLayoutPosition=h.clone(),this.layoutFlowColumns(e,t,i,n,r,o,u,s,a,l,c).thenAsync(e=>qn(e?{columns:e,position:this.currentLayoutPosition}:null)));return d().thenAsync(e=>{if(!e)return qn(null);if(l<=1)return qn(e.columns);let i=t.getProp(this,"column-fill")||ci.balance,n=this.currentLayoutPosition.flowPositions[a],r=function(e,t,i,n,r,o,s){if(t===ci.auto)return null;{let a=0===s.positions.length,l=o[o.length-1],h=!(!l||!l.pageBreakType);return a||h?new zu(i,n,r,e):t===ci.balance_all?new Vu(i,n,r):null}}(l,i,d,u,s,e.columns,n);return r?(c=!1,o.lock(),u.lock(),r.balanceColumns(e).thenAsync(e=>(o.unlock(),o.validate(),u.unlock(),this.currentLayoutPosition=e.position,qn(e.columns)))):qn(e.columns)})}layoutFlowColumns(e,t,i,n,r,o,s,a,l,h,u){let c=Gn("layoutFlowColumns"),d=this.currentLayoutPosition.clone(),p=t.getPropAsNumber(this,"column-gap"),f=h>1?t.getPropAsNumber(this,"column-width"):a.vertical?a.height:a.width,g=t.getActiveRegions(this),m=Gi(t.getProp(this,"shape-inside"),0,0,a.width,a.height,this),b=new wf(l,this,this.viewport,this.styler,g,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),v=0,y=null,w=[];return c.loopWithFrame(e=>{this.createAndLayoutColumn(t,i,n,r,a,v++,l,s,h,p,f,m,b,u).then(t=>o.isInvalidated()?(w=null,void e.breakLoop()):((!!t.pageBreakType&&"column"!==t.pageBreakType||v===h)&&!s.isInvalidated()&&s.finish(),s.isInvalidated()?(v=0,this.currentLayoutPosition=d.clone(),s.validate(),void(s.isLocked()?(w=null,e.breakLoop()):e.continueLoop())):(y=t,w[v-1]=y,y.pageBreakType&&"column"!=y.pageBreakType&&(v=h,"region"!=y.pageBreakType&&(this.pageBreaks[l]=!0)),void(v<h?e.continueLoop():e.breakLoop()))))}).then(()=>{c.finish(w)}),c.result()}layoutContainer(e,t,i,n,r,o,s){t.reset();let a=t.getProp(this,"enabled");if(a&&a!==ci._true)return qn(!0);let l=Gn("layoutContainer"),h=t.getProp(this,"wrap-flow")===ci.auto,u=t.getProp(this,"flow-from"),c=this.viewport.document.createElement("div");c.role=t instanceof Xp?"complementary":"presentation";let d=t.getProp(this,"position");ce(c,"position",d?d.name:"absolute");let p=t instanceof Hp;t instanceof mp?i.appendChild(c):i.insertBefore(c,i.firstChild);let f=new ts(c);f.vertical=t.vertical,f.rtl=t.rtl,f.borderBoxSizing=t.borderBoxSizing,f.exclusions=o,t.prepareContainer(this,f,e,this.faces,this.clientLayout),t instanceof Hp&&(f.width<=0||f.height<=0)&&R.warn("Negative or zero page area size"),f.originX=n,f.originY=r,n+=f.left+f.marginLeft+f.borderLeft,r+=f.top+f.marginTop+f.borderTop,this.setPagePageFloatLayoutContextContainer(s,t,f);let g,m=!1;if(u&&u.isIdent())if(this.pageBreaks[u.toString()])s.isInvalidated()||t.finishContainer(this,f,e,null,1,this.clientLayout,this.faces),g=qn(!0);else{let i=Gn("layoutContainer.inner"),a=u.toString(),l=t.getPropAsNumber(this,"column-count");this.layoutFlowColumnsWithBalancing(e,t,n,r,o,s,f,a,l).then(n=>{if(!s.isInvalidated()){let i=n[0];i.element===c&&(f=i),f.computedBlockSize=Math.max.apply(null,n.map(e=>e.computedBlockSize)),t.finishContainer(this,f,e,i,l,this.clientLayout,this.faces);let r=this.currentLayoutPosition.flowPositions[a];r&&"region"===r.breakAfter&&(r.breakAfter=null)}i.finish(!0)}),g=i.result()}else{let n=t.getProp(this,"content");if(n instanceof ai&&n.expr instanceof Tt&&n.expr.str.startsWith("running-element-"))n.visit(new is(c,this,n,this.counterStore.getExprContentListener()));else if(ns(n)){let i="span";n instanceof ti&&(i="img");let r=this.viewport.document.createElement(i);n.visit(new is(r,this,n,this.counterStore.getExprContentListener())),c.appendChild(r),"img"==i&&t.transferSingleUriContentProps(this,r,this.faces),t.transferContentProps(this,f,e,this.faces),"span"==i&&function(e,t,i,n,r,o){Th.processGeneratedContent(e,t,i,n,r,o)}(r,t.getProp(this,"text-autospace"),t.getProp(this,"text-spacing-trim"),t.getProp(this,"hanging-punctuation"),this.lang,t.vertical)}else t.suppressEmptyBoxGeneration&&(i.removeChild(c),m=!0);m||t.finishContainer(this,f,e,null,1,this.clientLayout,this.faces),g=qn(!0)}return g.then(()=>{if(s.isInvalidated())return void l.finish(!0);if(!t.isAutoHeight||Math.floor(f.computedBlockSize)>0){if(!m&&!h){let e=t.getProp(this,"shape-outside"),i=f.getOuterShape(e,this);o.push(i)}}else if(0==t.children.length)return i.removeChild(c),void l.finish(!0);let a=p?0:t.children.length-1;l.loop(()=>{for(;a>=0&&a<t.children.length;){let i=t.children[p?a++:a--],l=this.layoutContainer(e,i,c,n,r,o,s);if(l.isPending())return l.thenAsync(()=>qn(!s.isInvalidated()));if(s.isInvalidated())break}return qn(!1)}).then(()=>{l.finish(!0)})}),l.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let t=i.positions.length-1;t>=0;t--){let n=i.positions[t];n.flowChunk.startPage>=0&&n.flowChunk.startPage+n.flowChunk.linger-1<=e&&i.positions.splice(t,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let t=i.positions.length-1;t>=0;t--){let n=i.positions[t];n.flowChunk.startPage<0&&n.flowChunk.startOffset<this.lookupOffset&&(n.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let t in this.primaryFlows){let i=e.flowPositions[t];if(i&&i.positions.length>0)return!1}return!0}layoutNextPage(e,t){var i;let n=e.container===e.bleedBox;this.pageBreaks={},t?(this.currentLayoutPosition=t.clone(),this.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(this.currentLayoutPosition=new es,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang);if((t=this.currentLayoutPosition).page>1e4)throw new Error("Too many pages generated (over 10000 pages)");let r=t.startSideOfFlow("body");t.isBlankPage=fo(r)&&this.matchPageSide(r),e.isBlankPage=t.isBlankPage,t.page++;let o=this.styler.cascade.previousPageType;null==e.pageType&&(e.pageType=null!=(i=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)?i:"",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType);let s=this.pageManager.pageCascadeInstance;e.pageType&&(o!==e.pageType&&(s.pageTypePageCounts[e.pageType]=0),s.pageTypePageCounts[e.pageType]=(s.pageTypePageCounts[e.pageType]||0)+1),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=t.clone();let a=n?{}:this.pageManager.getCascadedPageStyle(e.pageType);if(this.styler.cascade.applyVarFilter([a],this.styler,null),this.styler.cascade.applyCalcFilter(a,this.styler.context),!n){let t=new Pt(this.style.pageScope,"left-page");e.side=t.evaluate(this)?"left":"right",e.container.setAttribute("data-vivliostyle-page-side",e.side)}let l=this.selectPageMaster(a);if(!l)return qn(null);let h=0;if(!n){e.setAutoPageWidth(l.pageBox.specified.width.value===pi),e.setAutoPageHeight(l.pageBox.specified.height.value===fi),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(a,this);let t=Np(Pp(a),this);this.setPageSizeAndBleed(t,e),Rp(a,t,e,this),h=t.bleedOffset+t.bleed}let u=!n&&l.getProp(this,"writing-mode")||ci.horizontal_tb;this.pageVertical=u!=ci.horizontal_tb;let c=l.getProp(this,"direction")||ci.ltr,d=new cs(this.rootPageFloatLayoutContext,rs.PAGE,null,null,null,u,c),p=Gn("layoutNextPage");return p.loopWithFrame(t=>{this.layoutContainer(e,l,e.bleedBox,h,h,[],d).then(()=>{d.isInvalidated()||d.finish(),d.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),d.validate(),t.continueLoop()):t.breakLoop()})}).then(()=>{l.adjustPageLayout(this,e,this.clientLayout),n||(this.processLinger(),t=this.currentLayoutPosition,Object.keys(t.flowPositions).forEach(e=>{let i=t.flowPositions[e],n=i.breakAfter;n&&("page"===n||!this.matchPageSide(n))&&(i.breakAfter=null)})),this.currentLayoutPosition=this.layoutPositionAtPageStart=null,t.highestSeenOffset=this.styler.getReachedOffset();let i=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(i,this.clientLayout),this.noMorePrimaryFlows(t)&&(t=null),p.finish(t)}),p.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+2*e.cropOffset,this.pageSheetHeight=e.pageHeight+2*e.cropOffset,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.right=`${e.bleedOffset}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.bottom=`${e.bleedOffset}px`,t.bleedBox.style.padding=`${e.bleed}px`}},Ff=class e extends Gl{constructor(e,t,i,n){super(e.rootScope,e,t,i,n,e.validatorSet,!i),this.masterHandler=e,h(this,"insideRegion",!1)}startPageTemplateRule(){}startPageMasterRule(e,t,i){let n=new Jd(this.masterHandler.pageScope,e,t,i,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new wp(n.scope,this.masterHandler,n,this.validatorSet))}startWhenRule(t){let i=t.expr;null!=this.condition&&(i=Ot(this.scope,this.condition,i)),this.masterHandler.pushHandler(new e(this.masterHandler,i,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new th(this.scope,this.owner))}startFontFaceRule(){let e={};this.masterHandler.fontFaces.push({properties:e,condition:this.condition}),this.masterHandler.pushHandler(new ih(this.scope,this.owner,null,e,this.masterHandler.validatorSet,"font-face"))}startCounterStyleRule(e){this.masterHandler.pushHandler(new _f(this.scope,this.owner,{},this.masterHandler.validatorSet,e,this.masterHandler.counterStyles))}startFlowRule(e){let t=this.masterHandler.flowProps[e];t||(t={},this.masterHandler.flowProps[e]=t),this.masterHandler.pushHandler(new ih(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startViewportRule(){let e={};this.masterHandler.viewportProps.push(e),this.masterHandler.pushHandler(new ih(this.scope,this.owner,this.condition,e,this.masterHandler.validatorSet))}startFootnoteRule(e){let t=this.masterHandler.footnoteProps;if(e){let i=za(t,"_pseudos");t=i[e],t||(t={},i[e]=t)}this.masterHandler.pushHandler(new ih(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let e=new af(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(e),e.startPageRule()}startRuleBody(){if(Gl.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let t="R"+this.masterHandler.regionCount++;this.special("region-id",Kt(t)),this.endRule();let i=new e(this.masterHandler,this.condition,this,t);this.masterHandler.pushHandler(i),i.startRuleBody()}}},Of=class extends kr{constructor(e){super(),this.validatorSet=e,h(this,"rootScope"),h(this,"pageScope"),h(this,"rootBox"),h(this,"cascadeParserHandler"),h(this,"regionCount",0),h(this,"fontFaces",[]),h(this,"counterStyles",new hd),h(this,"footnoteProps",{}),h(this,"flowProps",{}),h(this,"viewportProps",[]),h(this,"pageProps",{}),this.rootScope=new Xe(null),this.pageScope=new Xe(this.rootScope),this.rootBox=new Kd(this.rootScope),this.cascadeParserHandler=new Ff(this,null,null,null),this.slave=this.cascadeParserHandler}};function Bf(e,t){return t.parseOPSResource(e)}var Mf=class extends br{constructor(e){super(Bf,"document"),this.fontDeobfuscator=e,h(this,"styleByKey",{}),h(this,"styleFetcherByKey",{}),h(this,"styleByDocURL",{}),h(this,"triggersByDocURL",{}),h(this,"validatorSet",null),h(this,"styleSheets",[]),h(this,"triggerSingleDocumentPreprocessing",!1)}init(e,t){this.setStyleSheets(e,t);let i=Gn("OPSDocStore.init");return this.validatorSet=Ud(),Af.get().then(()=>{this.triggerSingleDocumentPreprocessing=!0,i.finish(!0)}),i.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=re(oe(t),ee)),this.styleSheets.push({url:t,text:e.text,flavor:"Author",classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=re(oe(t),ee)),this.styleSheets.push({url:t,text:e.text,flavor:"User",classes:null,media:null})}parseOPSResource(e){let t=Gn("OPSDocStore.load"),i=e.url,n=i.endsWith("?viv-toc-box");return Nf(e,this).then(e=>{var r;if(!e)return void t.finish(null);if(this.triggerSingleDocumentPreprocessing){let t=M("PREPROCESS_SINGLE_DOCUMENT");for(let i=0;i<t.length;i++)try{t[i](e.document)}catch(e){R.warn("Error during single document preprocessing:",e)}}let o=[],s=e.document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","trigger");for(let e=0;e<s.length;e++){let t=s[e],i=t.getAttributeNS("http://www.w3.org/2001/xml-events","observer"),n=t.getAttributeNS("http://www.w3.org/2001/xml-events","event"),r=t.getAttribute("action"),a=t.getAttribute("ref");i&&n&&r&&a&&o.push({observer:i,event:n,action:r,ref:a})}this.triggersByDocURL[i]=o;let a=[];if(a.push({url:re("user-agent-page.css",ie),text:ur,flavor:"UA",classes:null,media:null}),a.push({url:re("user-agent-counter-styles.css",ie),text:fr,flavor:"UA",classes:null,media:null}),n)a.push({url:re("user-agent-toc.css",ie),text:dr,flavor:"UA",classes:null,media:null});else{let t=e.document.querySelectorAll("style, link, meta");for(let e of t){let t=e.namespaceURI,n=e.localName;if("http://www.w3.org/1999/xhtml"==t)if("style"==n){let t=e.getAttribute("class"),n=e.getAttribute("media"),r=e.getAttribute("title");a.push({url:i,text:e.textContent,flavor:"Author",classes:r?t:null,media:n})}else if("link"==n){let t=e.getAttribute("href"),n=null==(r=e.getAttribute("rel"))?void 0:r.split(/\s+/),o=e.getAttribute("class"),s=e.getAttribute("media");if(t&&null!=n&&n.includes("stylesheet")&&(!n.includes("alternate")||o)){let n=re(t,i),r=e.getAttribute("title");a.push({url:n,text:null,classes:r?o:null,media:s,flavor:"Author"})}}else"meta"==n&&"viewport"==e.getAttribute("name")&&a.push({url:i,text:this.processViewportMeta(e),flavor:"Author",classes:null,media:null})}for(let e=0;e<this.styleSheets.length;e++)a.push(this.styleSheets[e])}let l="";for(let e=0;e<a.length;e++)l+=a[e].url,l+="^",a[e].text&&(l+=a[e].text),l+="^";let h=this.styleByKey[l];if(h)return this.styleByDocURL[i]=h,void t.finish(e);let u=this.styleFetcherByKey[l];u||(u=new rr(()=>{let e=Gn("fetchStylesheet"),t=0,i=new Of(this.validatorSet);return e.loop(()=>{if(t<a.length){let e=a[t++];return i.startStylesheet(e.flavor),null!==e.text?Wr(e.text,i,e.url,e.classes,e.media).thenReturn(!0):Gr(e.url,i,e.classes,e.media)}return qn(!1)}).then(()=>{let t=i.cascadeParserHandler.finish();h=new Rf(this,i.rootScope,i.pageScope,t,i.rootBox,i.fontFaces,i.footnoteProps,i.flowProps,i.viewportProps,i.pageProps,i.counterStyles),this.styleByKey[l]=h,delete this.styleFetcherByKey[l],e.finish(h)}),e.result()},`FetchStylesheet ${i}`),this.styleFetcherByKey[l]=u,u.start()),u.get().then(n=>{this.styleByDocURL[i]=n,t.finish(e)})}),t.result()}processViewportMeta(e){return""}},zf="";function Df(e){let t=Array.from(e.querySelectorAll("nav[*|type],nav[epub\\:type]"));if(t.length>0||(t=Array.from(e.querySelectorAll("[role=doc-toc]")),t.length>0))return t;for(let i of e.querySelectorAll("nav,.toc,#toc,#table-of-contents,#contents,[role=directory]")){if(t.find(e=>e.contains(i)))continue;let e=i;/^h[1-6]$/.test(e.localName)&&(e=e.previousElementSibling?e.nextElementSibling:e.parentElement),e&&e.querySelector("li a[href]")&&t.push(e)}return t}var Vf=class{constructor(e,t,i,n,r,o,s,a,l,u){this.store=e,this.url=t,this.lang=i,this.clientLayout=n,this.fontMapper=r,this.rendererFactory=s,this.fallbackMap=a,this.documentURLTransformer=l,this.counterStore=u,h(this,"pref"),h(this,"page",null),h(this,"instance",null),this.pref=Ve(o),this.pref.spreadView=!1}setAutoHeight(e,t){if(0!=t--)for(let i=e.firstChild;i;i=i.nextSibling)if(1==i.nodeType){let e=i;"auto"!=de(e,"height","auto")&&(ce(e,"height","auto"),this.setAutoHeight(e,t)),"absolute"==de(e,"position","static")&&(ce(e,"position","relative"),this.setAutoHeight(e,t))}}makeCustomRenderer(e){let t=this.rendererFactory.makeCustomRenderer(e);return(e,i,n)=>{let r=n.behavior;if(r)switch(r.toString()){case"toc-node-anchor":n.color=ci.inherit,n["text-decoration"]=ci.none;break;case"toc-node":n.display=ci.block,n.margin=gi,n.padding=gi,n["padding-inline-start"]=new Zt(1.25,"em");break;case"toc-node-first-child":n.display=ci.inline_block,n.margin=new Zt(.2,"em"),n["vertical-align"]=ci.top,n.color=ci.inherit,n["text-decoration"]=ci.none;break;case"toc-container":n.padding=gi}if(!r||"toc-node"!=r.toString()&&"toc-container"!=r.toString())return t(e,i,n);let o=e.firstChild;o&&1!==o.nodeType&&Mo(o)&&e.replaceChild(e.ownerDocument.createComment(o.textContent),o);let s=i.getAttribute("data-adapt-class");if("toc-node"==s){let e=i.firstChild;e.textContent!=zf&&(e.textContent=zf,ce(e,"cursor","pointer"),e.addEventListener("click",Uf,!1),e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),i.setAttribute("aria-expanded","false"),"0px"!==i.style.height&&(e.tabIndex=0))}let a=i.ownerDocument.createElement("div");if(a.setAttribute("data-adapt-process-children","true"),"toc-node"==r.toString()){let t=i.ownerDocument.createElement("div");if(t.textContent="",ce(t,"margin","0.2em 0 0 -1em"),ce(t,"margin-inline-start","-1em"),ce(t,"margin-inline-end","0"),ce(t,"display","inline-block"),ce(t,"width","1em"),ce(t,"text-align","center"),ce(t,"vertical-align","top"),ce(t,"cursor","default"),ce(t,"font-family","Menlo,sans-serif"),a.appendChild(t),ce(a,"overflow","hidden"),a.setAttribute("data-adapt-class","toc-node"),a.setAttribute("role","treeitem"),"toc-node"==s||"toc-container"==s){ce(a,"height","0px");let t=e.firstElementChild;t&&"a"===t.localName&&(t.tabIndex=-1)}else i.setAttribute("role","tree")}else"toc-node"==s&&(a.setAttribute("data-adapt-class","toc-container"),a.setAttribute("role","group"),a.setAttribute("aria-hidden","true"));return qn(a)}}showTOC(e,t,i,n,r){if(this.page)return qn(this.page);let o=Gn("showTOC"),s=new Fo(e,e);this.page=s;let a=Q(this.url)+"?viv-toc-box";return this.store.load(a).then(n=>{for(let e of Df(n.document))e.setAttribute("data-vivliostyle-role","doc-toc");let a=this.store.getStyleForDoc(n),l=a.sizeViewport(i,1e5,r);t=new Cf(t.window,l.fontSize,0,t.root,l.width,l.height);let h=this.makeCustomRenderer(n),u=new Lf(a,n,this.lang,t,this.clientLayout,this.fontMapper,h,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=u,u.pref=this.pref,u.init().then(()=>{u.layoutNextPage(s,null).then(()=>{this.setAutoHeight(e,2),o.finish(s)})})}),o.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&"visible"===this.page.container.style.visibility}getTOC(){if(!this.page)return[];function e(e){if(!e)return[];let i=e.querySelectorAll(":scope > [role=treeitem] > a[href]");return Array.from(i).map(t)}function t(t){let i=new URL(t.href),[,n]=i.hash.match(/^#?(.*)$/);return{id:n,title:t.innerText,children:e(t.parentElement.querySelector("[role=group]"))}}return e(this.page.container.querySelector("[role=tree]"))}};function Uf(e){let t=e.target,i=t.textContent==zf;t.textContent=i?"":zf;let n=t.parentNode;t.setAttribute("aria-expanded",i?"true":"false"),n.setAttribute("aria-expanded",i?"true":"false");let r=n.firstChild;for(;r;){if(1===r.nodeType){let e=r,t=e.getAttribute("data-adapt-class");if("toc-container"===t){if(e.setAttribute("aria-hidden",i?"false":"true"),e.firstChild){r=e.firstChild;continue}}else if("toc-node"===t&&(e.style.height=i?"auto":"0px",e.children.length>=2&&(e.children[1].tabIndex=i?0:-1),e.children.length>=3&&(e.children[0].tabIndex=i?0:-1,!i))){let t=e.children[0];if(""==t.textContent){t.textContent=zf,t.setAttribute("aria-expanded","false"),e.setAttribute("aria-expanded","false"),r=e.children[2];continue}}}for(;!r.nextSibling&&r.parentNode!==n;)r=r.parentNode;r=r.nextSibling}e.stopPropagation()}var Hf=class extends Mf{constructor(){super(null),h(this,"plainXMLStore"),h(this,"jsonStore"),h(this,"opfByURL",{}),h(this,"primaryOPFByEPubURL",{}),h(this,"deobfuscators",{}),h(this,"documents",{}),this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=new br(Nf,"document"),this.jsonStore=new br(vr,"text")}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,t,i){return this.plainXMLStore.load(e,t,i)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,i){return this.jsonStore.load(e,t,i)}loadPubDoc(e){let t=Gn("loadPubDoc");return gr(e,null,"HEAD").then(i=>{if(i.status>=400)this.loadEPUBDoc(e).then(n=>{n?t.finish(n):(R.error(`Failed to fetch a source document from ${e} (${i.status}${i.statusText?" "+i.statusText:""})`),t.finish(null))});else if(!i.status&&!i.responseXML&&!i.responseText&&!i.responseBlob&&!i.contentType&&/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),"application/oebps-package+xml"==i.contentType||/\.opf(?:[#?]|$)/.test(e)){let[,i,n]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(i,n).thenFinish(t)}else"application/ld+json"==i.contentType||"application/webpub+json"==i.contentType||"application/audiobook+json"==i.contentType||"application/json"==i.contentType||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(i=>{if(!i)return this.reportLoadError(e),void t.finish(null);let n=new Jf(this,e);n.initWithWebPubManifest(i,void 0,e).then(()=>{t.finish(n)})}):this.loadWebPub(e).then(i=>{i?t.finish(i):this.loadEPUBDoc(e).then(i=>{i?t.finish(i):(R.error(`Failed to load ${e}.`),t.finish(null))})})}),t.result()}loadEPUBDoc(e){let t=Gn("loadEPUBDoc");e.endsWith("/")||(e+="/"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");let i=e+"META-INF/container.xml";return this.loadAsPlainXML(i).then(i=>{if(i){let n=i.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(let i of n)if(i)return void this.loadOPF(e,i).thenFinish(t)}t.finish(null)}),t.result()}loadOPF(e,t){let i=e+t,n=this.opfByURL[i];if(n)return qn(n);let r=Gn("loadOPF");return this.loadAsPlainXML(i,!0,`Failed to fetch EPUB OPF ${i}`).then(t=>{t?(n=new Jf(this,e),this.opfByURL[i]=n,this.primaryOPFByEPubURL[e]=n,this.plainXMLStore.resources[e+"META-INF/container.xml"]?this.loadAsPlainXML(e+"META-INF/encryption.xml").then(e=>{n.initWithXMLDoc(t,e).then(()=>{r.finish(n)})}):n.initWithXMLDoc(t,null).then(()=>{r.finish(n)})):this.reportLoadError(i)}),r.result()}loadWebPub(e){let t=Gn("loadWebPub");return this.load(e).then(i=>{if(i)if(i.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{let n=i.document,r=new Jf(this,e),o=n.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(o){let i=o.getAttribute("href");if(/^#/.test(i)){let e=J(n.getElementById(i.substr(1)).textContent);r.initWithWebPubManifest(e,n).then(()=>{t.finish(r)})}else{let i=re(o.getAttribute("href"),e);this.loadAsJSON(i,!0,`Failed to fetch Publication Manifest ${i}`).then(e=>{r.initWithWebPubManifest(e,n,i).then(()=>{t.finish(r)})})}}else r.initWithWebPubManifest({},n).then(()=>{r.toc&&r.toc.src===i.url&&0===Df(n).length&&(r.toc=null),t.finish(r)})}else this.reportLoadError(e)}),t.result()}addDocument(e,t){let i=Gn("EPUBDocStore.load"),n=Q(e);return(this.documents[n]=this.parseOPSResource({status:200,statusText:"",url:n,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(i),i.result()}reportLoadError(e){let t=e=>e.replace(/([^:/?#]|^)[/?#].*/,"$1");e.startsWith("data:")?R.error(`Failed to load ${e}. Invalid data.`):e.startsWith("http:")&&ee.startsWith("https:")?R.error(`Failed to load ${e}. Mixed Content ("http:" content on "https:" context) is not allowed.`):(()=>{let i=t(e);return!(i===t(ee)||Object.keys(this.resources).find(e=>this.resources[e]&&t(e)===i)||!/^https?:?\/\/[^/]/.test(e)||/\.(xhtml|xht|xml|opf)$/i.test(e))})()?R.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):R.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let t=Q(e),i=this.documents[t];if(i)return i.isPending()?i:qn(i.get());{let e=Gn("EPUBDocStore.load");return i=super.load(t,!0,`Failed to fetch a source document from ${t}`),i.then(i=>{i?e.finish(i):this.reportLoadError(t)}),e.result()}}processViewportMeta(e){let t=e.getAttribute("content");if(!t)return"";let i,n={};for(;null!=(i=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/));)t=t.substr(i[0].length),n[i[1]]=i[2];let r=n.width-0,o=n.height-0;if(r&&o){return`@-epubx-viewport{width:${r}px;height:${o}px;}`+(!!Object.values(this.primaryOPFByEPubURL).find(e=>e.prePaginated)?`@page{size:${r}px ${o}px;margin:0;}`:"@page{margin:0;}")}return""}},$f=class{constructor(){h(this,"id",null),h(this,"src",""),h(this,"mediaType",null),h(this,"title",null),h(this,"itemRefElement",null),h(this,"spineIndex",-1),h(this,"compressedSize",0),h(this,"compressed",null),h(this,"epage",0),h(this,"epageCount",0),h(this,"startPage",null),h(this,"skipPagesBefore",null),h(this,"itemProperties"),this.itemProperties=Z}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=re(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");let i=e.getAttribute("properties");i&&(this.itemProperties=function(e){let t={};for(let i=0;i<e.length;i++)t[e[i]]=!0;return t}(i.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}};function jf(e){return e.id}function Wf(e){return t=>{let i=Gn("deobfuscator");return function(e,t){let i=Gn("makeDigest"),n=i.suspend();return window.crypto.subtle.digest(e,(new TextEncoder).encode(t)).then(e=>{n.schedule(new Uint8Array(e))}),i.result()}("SHA-1",e).then(e=>{let n=t.slice(0,1040),r=t.slice(1040,t.size);(function(e){let t=Gn("readBlob"),i=new FileReader,n=t.suspend(i);return i.addEventListener("load",()=>{n.schedule(i.result)},!1),i.readAsArrayBuffer(e),t.result()})(n).then(t=>{let n=new DataView(t);for(let t=0;t<n.byteLength;t++){let i=n.getUint8(t);i^=e[t%20],n.setUint8(t,i)}i.finish(mr([n,r]))})}),i.result()}}var Gf={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#",opf:"http://www.idpf.org/2007/opf"},qf="http://idpf.org/epub/vocab/package/meta/#",Xf={language:`${Gf.dcterms}language`,title:`${Gf.dcterms}title`,creator:`${Gf.dcterms}creator`,layout:`${Gf.rendition}layout`,titleType:`${qf}title-type`,displaySeq:`${qf}display-seq`,alternateScript:`${qf}alternate-script`,role:`${qf}role`};function Yf(e,t){let i={};return(n,r)=>{var o,s,a,l,h,u;let c,d,p=n.r||i,f=r.r||i;if(e==Xf.title&&(c="main"==(null==(o=p[Xf.titleType])?void 0:o[0].v),d="main"==(null==(s=f[Xf.titleType])?void 0:s[0].v),c!=d))return c?-1:1;let g=parseInt(null==(a=p[Xf.displaySeq])?void 0:a[0].v,10);isNaN(g)&&(g=Number.MAX_VALUE);let m=parseInt(null==(l=f[Xf.displaySeq])?void 0:l[0].v,10);return isNaN(m)&&(m=Number.MAX_VALUE),g!=m?g-m:e!=Xf.language&&t&&(c=(null==(h=p[Xf.language]||p[Xf.alternateScript])?void 0:h[0].v)==t,d=(null==(u=f[Xf.language]||f[Xf.alternateScript])?void 0:u[0].v)==t,c!=d)?c?-1:1:n.o-r.o}}var Kf={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},Zf="viv-id-",Jf=class{constructor(e,t){this.store=e,this.pubURL=t,h(this,"opfXML",null),h(this,"encXML",null),h(this,"items",null),h(this,"spine",null),h(this,"itemMap",null),h(this,"itemMapByPath",null),h(this,"uid",null),h(this,"bindings",{}),h(this,"lang",null),h(this,"epageCount",0),h(this,"prePaginated",!1),h(this,"epageIsRenderedPage",!0),h(this,"epageCountCallback",null),h(this,"metadata",{}),h(this,"toc",null),h(this,"cover",null),h(this,"fallbackMap",{}),h(this,"pageProgression",null),h(this,"documentURLTransformer"),this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let e=this;return new class{transformFragment(e,t){return Zf+we(t+(e?`#${e}`:""),":")}transformURL(t,i){let n=t.match(/^([^#]*)#?(.*)$/);if(n){let t=n[1]||i.replace(/\?viv-toc-box$/,""),r=decodeURIComponent(n[2]);if(t&&e.spine.some(e=>e.src===t))return`#${this.transformFragment(r,t)}`}return t}restoreURL(e){"#"===e.charAt(0)&&(e=e.substring(1)),0===e.indexOf(Zf)&&(e=e.substring(7));let t=Se(e,":").match(/^([^#]*)#?(.*)$/);return t?[t[1],t[2]]:[]}}}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=re("",this.pubURL);return e===t||e+"/"===t?"":("/"!=t.charAt(t.length-1)&&(t+="/"),e.substr(0,t.length)==t?decodeURIComponent(e.substr(t.length)):null)}return e}initWithXMLDoc(e,t){this.opfXML=e,this.encXML=t;let i=e.doc().child("package"),n=i.attribute("unique-identifier")[0];if(n){let t=e.getElement(`${e.url}#${n}`);t&&(this.uid=t.textContent.replace(/[ \n\r\t]/g,""))}let r={};this.items=i.child("manifest").child("item").asArray().map(t=>{let i=new $f,n=t;i.initWithElement(n,e.url);let o=n.getAttribute("fallback");return o&&!Kf[i.mediaType]&&(r[i.src]=o),!this.toc&&i.itemProperties.nav&&(this.toc=i),!this.cover&&i.itemProperties["cover-image"]&&(this.cover=i),i}),this.itemMap=Ee(this.items,jf),this.itemMapByPath=Ee(this.items,e=>this.getPathFromURL(e.src));for(let e in r){let t=e;for(;;){let i=this.itemMap[r[t]];if(!i)break;if(Kf[i.mediaType]){this.fallbackMap[e]=i.src;break}t=i.src}}this.spine=i.child("spine").child("itemref").asArray().map((e,t)=>{let i=e,n=i.getAttribute("idref"),r=this.itemMap[n];return r&&(r.itemRefElement=i,r.spineIndex=t),r});let o=i.child("spine").attribute("page-progression-direction")[0];o&&(this.pageProgression=C(o));let s=t?t.doc().child("encryption").child("EncryptedData").predicate(Tf.withChild("EncryptionMethod",Tf.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],a=i.child("bindings").child("mediaType").asArray();for(let e=0;e<a.length;e++){let t=a[e].getAttribute("handler"),i=a[e].getAttribute("media-type");i&&t&&this.itemMap[t]&&(this.bindings[i]=this.itemMap[t].src)}if(this.metadata=function(e,t){let i;if(t){i={};for(let e in Gf)i[e]=Gf[e];let e;for(;null!=(e=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/));)t=t.substr(e[0].length),i[e[1]]=e[2]}else i=Gf;let n=e=>{if(e){let t=e.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(t){let e=t[2]?i[t[2]]:qf;if(e)return e+t[3]}}return null},r=1,o=e.childElements().forEachNonNull(e=>{if("meta"==e.localName){let t=n(e.getAttribute("property"));if(t)return{name:t,value:e.textContent,id:e.getAttribute("id"),order:r++,refines:e.getAttribute("refines"),lang:null,scheme:n(e.getAttribute("scheme")),role:null}}else if("http://purl.org/dc/elements/1.1/"==e.namespaceURI)return{name:Gf.dcterms+e.localName,order:r++,lang:e.getAttribute("xml:lang"),value:e.textContent,id:e.getAttribute("id"),refines:null,scheme:null,role:e.getAttribute("role")||e.getAttribute("opf:role")};return null}),s=Pe(o,e=>e.refines),a=e=>function(e,t){let i={};for(let n in e)i[n]=t(e[n],n);return i}(e,(e,t)=>e.map(e=>{let t={v:e.value,o:e.order};e.scheme&&(t.s=e.scheme);let i=s[`#${e.id}`]||[];if(i.length||e.lang||e.role){e.lang&&i.push({name:Xf.language,value:e.lang,lang:null,id:null,refines:e.id,scheme:null,order:e.order,role:null}),e.role&&i.push({name:Xf.role,value:e.role,lang:null,id:null,refines:e.id,scheme:null,order:e.order,role:null});let n=Pe(i,e=>e.name);t.r=a(n)}return t})),l=a(Pe(o,e=>e.refines?null:e.name)),h=null;l[Xf.language]&&(h=l[Xf.language][0].v);let u=e=>{for(let t in e){let i=e[t];i.sort(Yf(t,h));for(let e=0;e<i.length;e++){let t=i[e].r;t&&u(t)}}};return u(l),l}(i.child("metadata"),i.attribute("prefix")[0]),this.metadata[Xf.language]&&(this.lang=this.metadata[Xf.language][0].v),this.metadata[Xf.layout]&&(this.prePaginated="pre-paginated"===this.metadata[Xf.layout][0].v),s.length>0&&this.uid){let e=Wf(this.uid);for(let t=0;t<s.length;t++)this.store.deobfuscators[this.pubURL+s[t]]=e}return this.prePaginated&&this.assignAutoPages(),qn(!0)}assignAutoPages(){let e=0;for(let t of this.spine){let i=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=i,e+=i}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&0==this.epageCount&&this.assignAutoPages(),qn(!0);let t=0,i=0,n=Gn("countEPages");return n.loopWithFrame(e=>{if(i===this.spine.length)return void e.breakLoop();let n=this.spine[i++];n.epage=t,this.store.load(n.src).then(i=>{let r=1800,o=i.lang||this.lang;o&&o.match(/^(ja|ko|zh)/)&&(r/=3),n.epageCount=Math.ceil(i.getTotalOffset()/r),t+=n.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),e.continueLoop()})}).thenFinish(n),n.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let i=this.opfXML=new kf(null,"",(new DOMParser).parseFromString("<spine></spine>","text/xml"));return e.forEach(e=>{let t=new $f;t.initWithParam(e),t.id;let n=i.document.createElement("itemref");n.setAttribute("idref",t.id),i.root.appendChild(n),t.itemRefElement=n,this.itemMap[t.id]=t;let r=this.getPathFromURL(e.url);null==r&&(r=e.url),this.itemMapByPath[r]=t,this.items.push(t)}),t?this.store.addDocument(e[0].url,t):qn(null)}initWithWebPubManifest(e,t,i){var n,r,o,s;e.readingProgression&&(this.pageProgression=e.readingProgression),void 0===this.metadata&&(this.metadata={});let a=e.name||(null==(n=e.metadata)?void 0:n.title)||(null==t?void 0:t.title);a&&(this.metadata[Xf.title]=(Array.isArray(a)?a:[a]).map(e=>{var t;return{v:null!=(t=e.value)?t:e}}));let l=e.author||e.creator||(null==(r=e.metadata)?void 0:r.author)||Array.from(null!=(o=null==t?void 0:t.querySelectorAll("meta[name='author'], meta[name='DC.Creator']"))?o:[]).map(e=>e.content);l&&0!==l.length&&(this.metadata[Xf.creator]=(Array.isArray(l)?l:[l]).map(e=>{var t;return{v:null!=(t=e.name)?t:e}}));let h=e.inLanguage||(null==(s=e.metadata)?void 0:s.language)||(null==t?void 0:t.documentElement.lang)||(null==t?void 0:t.documentElement.getAttribute("xml:lang"));h&&(this.metadata[Xf.language]=(Array.isArray(h)?h:[h]).map(e=>({v:e})));let u=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&null!==u){e.readingOrder=[encodeURI(u)];for(let i of function(e){let t=Df(e),i=[];for(let e of t)for(let t of e.querySelectorAll("li a[href]"))i.push(t);return i}(t)){let t=i.getAttribute("href");if(/^(https?:)?\/\//.test(t)||/\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(t))continue;let n=Q(re(t,this.pubURL)),r=this.getPathFromURL(n),o=null!==r?encodeURI(r):n;-1==e.readingOrder.indexOf(o)&&e.readingOrder.push(o)}}let c=[],d=0,p=-1;[e.readingOrder,e.resources].forEach(t=>{t instanceof Array&&t.forEach(n=>{let r=t===e.readingOrder,o="string"==typeof n?n:n.url||n.href,s="string"==typeof n?"":n.encodingFormat||n.href&&n.type||"";if(r||"text/html"===s||"application/xhtml+xml"===s||!s&&"stylesheet"!==n.rel&&/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(o)){let e=i?i.replace(/\/[^/]+$/,"/"):this.pubURL,t={url:re(oe(o),e),index:d++,startPage:null,skipPagesBefore:null};"contents"===n.rel&&-1===p&&(p=t.index),c.push(t)}})});let f=Gn("initWithWebPubManifest");return this.initWithChapters(c).then(()=>{var t,n;-1!==p&&(this.toc=this.items[p]),this.toc||(this.toc=i?null==(t=this.items)?void 0:t[0]:this.itemMapByPath[u]);let r=null==(n=e.readingOrder)?void 0:n.length;r&&r<this.items.length&&this.items.splice(r),f.finish(!0)}),f.result()}getCFI(e,t){let i=this.spine[e],n=Gn("getCFI");return this.store.load(i.src).then(e=>{let r=e.getNodeByOffset(t),o=null;if(r){let n=e.getNodeOffset(r,0,!1),s=t-n,a=new De;a.prependPathFromNode(r,s,!1,null),i.itemRefElement&&a.prependPathFromNode(i.itemRefElement,0,!1,null),o=a.toString()}n.finish(o)}),n.result()}resolveFragment(e){return Xn("resolveFragment",t=>{if(!e)return void t.finish(null);let i,n=new De;if(n.fromString(e),this.opfXML){let e=n.navigate(this.opfXML.document);if(1!=e.node.nodeType||e.after||!e.ref)return void t.finish(null);let r=e.node,o=r.getAttribute("idref");if("itemref"!=r.localName||!o||!this.itemMap[o])return void t.finish(null);i=this.itemMap[o],n=e.ref}else i=this.spine[0];this.store.load(i.src).then(e=>{let r=n.navigate(e.document),o=e.getNodeOffset(r.node,r.offset,r.after);t.finish({spineIndex:i.spineIndex,offsetInItem:o,pageIndex:-1})})},(t,i)=>{R.warn(i,"Cannot resolve fragment:",e),t.finish(null)})}resolveEPage(e){return Xn("resolveEPage",t=>{if(e<=0)return void t.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});if(this.epageIsRenderedPage){let i=this.spine.findIndex(t=>0==t.epage&&0==t.epageCount||t.epage<=e&&t.epage+t.epageCount>e);-1==i&&(i=this.spine.length-1);let n=this.spine[i];(!n||0==n.epageCount)&&(n=this.spine[--i]);let r=Math.floor(e-n.epage);return void t.finish({spineIndex:i,offsetInItem:-1,pageIndex:r})}let i=Ce(this.spine.length,t=>{let i=this.spine[t];return i.epage+i.epageCount>e});i==this.spine.length&&i--;let n=this.spine[i];this.store.load(n.src).then(r=>{(e-=n.epage)>n.epageCount&&(e=n.epageCount);let o=0;if(e>0){let t=r.getTotalOffset();o=Math.round(t*e/n.epageCount),o==t&&o--}t.finish({spineIndex:i,offsetInItem:o,pageIndex:-1})})},(t,i)=>{R.warn(i,"Cannot resolve epage:",e),t.finish(null)})}getEPageFromPosition(e){let t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){return qn(t.epage+e.pageIndex)}if(e.offsetInItem<=0)return qn(t.epage);let i=Gn("getEPage");return this.store.load(t.src).then(n=>{let r=n.getTotalOffset(),o=Math.min(r,e.offsetInItem);i.finish(t.epage+o*t.epageCount/r)}),i.result()}},Qf=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}}),eg=class{constructor(e,t,i,n,r){this.opf=e,this.viewport=t,this.fontMapper=i,this.pageSheetSizeReporter=r,h(this,"spineItems",[]),h(this,"spineItemLoadingContinuations",[]),h(this,"pref"),h(this,"clientLayout"),h(this,"counterStore"),h(this,"tocAutohide",!1),h(this,"tocVisible",!1),h(this,"tocView"),this.pref=Ve(n),this.clientLayout=new Sf(t),this.counterStore=new tn(e.documentURLTransformer)}getPage(e){let t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{let t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,i){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);let n=e.pages[i];if(t.isFirstPage=0==e.item.spineIndex&&0==i,e.pages[i]=t,this.opf.epageIsRenderedPage){if(0==i&&e.item.spineIndex>0){let t=this.opf.spine[e.item.spineIndex-1];e.item.epage=t.epage+t.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce((e,t)=>e+t.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(n)e.instance.viewport.contentContainer.replaceChild(t.container,n.container),n.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let n=null;if(i>0)n=e.pages[i-1].container.nextElementSibling;else for(let t=e.item.spineIndex+1;t<this.spineItems.length;t++){let e=this.spineItems[t];if(e&&e.pages[0]){n=e.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,n)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+i)}renderSinglePage(e,t){let i=Gn("renderSinglePage"),n=e.pages[t?t.page:0],r=this.makePage(e,t);return n&&(r.pageType=n.pageType),e.instance.layoutNextPage(r,t).then(n=>{let o=(t=n)?t.page-1:e.layoutPositions.length-1;this.finishPageContainer(e,r,o),this.counterStore.finishPage(r.spineIndex,o);let s=null;if(t){let i=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,i&&e.pages[t.page]&&(t.isSamePosition(i)||(s=this.renderSinglePage(e,t)))}s||(s=qn(!0)),s.then(()=>{let n=this.counterStore.getUnresolvedRefsToPage(r),s=0;i.loopWithFrame(e=>{if(s++,s>n.length)return void e.breakLoop();let t=n[s-1];t.refs=t.refs.filter(e=>!e.isResolved()),0!==t.refs.length?this.getPageViewItem(t.spineIndex).then(i=>{if(!i)return void e.continueLoop();let{currentPageType:n,previousPageType:s}=i.instance.styler.cascade,a=i.instance.scopes;i.instance.scopes={},this.counterStore.pushPageCounters(t.pageCounters),this.counterStore.pushReferencesToSolve(t.refs);let l=i.layoutPositions[t.pageIndex];this.renderSinglePage(i,l).then(t=>{i.instance.styler.cascade.currentPageType=n,i.instance.styler.cascade.previousPageType=s,i.instance.scopes=a,this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let l=t.pageAndPosition.position;l.spineIndex===r.spineIndex&&l.pageIndex===o&&(r=t.pageAndPosition.page),e.continueLoop()})}):e.continueLoop()}).then(()=>{r.container.parentElement||(r=e.pages[o]),r.isLastPage=!t&&e.item.spineIndex===this.opf.spine.length-1,r.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),r.container.setAttribute("data-vivliostyle-page-index",o),r.container.setAttribute("data-vivliostyle-spine-index",r.spineIndex),i.finish({pageAndPosition:Qf(r,o),nextLayoutPosition:t})})})}),i.result()}normalizeSeekPosition(e,t){let i=e.pageIndex,n=-1;if(i<0){n=e.offsetInItem;let r=Ce(t.layoutPositions.length,e=>t.instance.getPosition(t.layoutPositions[e],!0)>n);i=r===t.layoutPositions.length?t.complete?t.layoutPositions.length-1:Number.POSITIVE_INFINITY:r-1}else i===Number.POSITIVE_INFINITY&&-1!==e.offsetInItem&&(n=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:i,offsetInItem:n}}findPage(e,t){let i=Gn("findPage");return this.getPageViewItem(e.spineIndex).then(n=>{if(!n)return void i.finish(null);let r,o=null;i.loopWithFrame(s=>{let a=this.normalizeSeekPosition(e,n);r=a.pageIndex,o=n.pages[r],o?s.breakLoop():n.complete?(r=n.layoutPositions.length-1,o=n.pages[r],s.breakLoop()):t?this.renderPage(a).then(e=>{e&&(o=e.page,r=e.position.pageIndex),s.breakLoop()}):i.sleep(100).then(()=>{s.continueLoop()})}).then(()=>{i.finish(Qf(o,r))})}),i.result()}renderPage(e){let t=Gn("renderPage");return this.getPageViewItem(e.spineIndex).then(i=>{if(!i)return void t.finish(null);let n=this.normalizeSeekPosition(e,i),r=n.pageIndex,o=n.offsetInItem,s=i.pages[r];s?t.finish(Qf(s,r)):t.loopWithFrame(e=>{if(r<i.layoutPositions.length)return void e.breakLoop();if(i.complete)return r=i.layoutPositions.length-1,void e.breakLoop();let t=i.layoutPositions[i.layoutPositions.length-1];this.renderSinglePage(i,t).then(n=>{let a=n.pageAndPosition.page;if(t=n.nextLayoutPosition,t){if(o>=0&&i.instance.getPosition(t)>o)return s=a,r=i.layoutPositions.length-2,void e.breakLoop();e.continueLoop()}else s=a,r=n.pageAndPosition.position.pageIndex,i.complete=!0,e.breakLoop()})}).then(()=>{s=s||i.pages[r];let e=i.layoutPositions[r];s?t.finish(Qf(s,r)):this.renderSinglePage(i,e).then(e=>{e.nextLayoutPosition||(i.complete=!0),t.finish(e.pageAndPosition)})})}),t.result()}renderAllPages(){let e=Gn("renderAllPages");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then(t=>{e.loopWithFrame(t=>{this.spineItems.some(e=>null==e?void 0:e.pages.some(e=>null==e?void 0:e.fetchers.some(e=>!e.arrived)))?e.sleep(100).then(()=>{t.continueLoop()}):t.breakLoop()}).then(()=>{e.finish(t)})}),e.result()}renderPagesUpto(e,t){let i=Gn("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});let n,r=e.spineIndex,o=e.pageIndex,s=0;return t&&(s=r),i.loopWithFrame(t=>{let i={spineIndex:s,pageIndex:s===r?o:Number.POSITIVE_INFINITY,offsetInItem:s===r?e.offsetInItem:-1};this.renderPage(i).then(e=>{n=e,++s>r?t.breakLoop():t.continueLoop()})}).then(()=>{i.finish(n)}),i.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){let i=e.spineIndex,n=e.pageIndex,r=Gn("nextPage");return this.getPageViewItem(i).then(e=>{if(e){if(e.complete&&n==e.layoutPositions.length-1){if(i>=this.opf.spine.length-1)return void r.finish(null);i++,n=0;let t=this.spineItems[i],o=t&&t.pages[0],s=e.pages[e.pages.length-1];o&&s&&o.side==s.side&&(t.pages.forEach(e=>{e.container&&e.container.remove()}),this.spineItems[i]=null,this.spineItemLoadingContinuations[i]=null)}else n++;this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t).thenFinish(r)}else r.finish(null)}),r.result()}previousPage(e,t){let i=e.spineIndex,n=e.pageIndex;if(0==n){if(0==i)return qn(null);i--,n=Number.POSITIVE_INFINITY}else n--;return this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t)}isRectoPage(e,t){let i="left"===e.side,n="ltr"===this.getCurrentPageProgression(t);return!i&&n||i&&!n}getSpread(e,t){let i=this.getPage(e);if(!i)return qn({left:null,right:null});let n,r=Gn("getSpread"),o="left"===i.side;return n=this.isRectoPage(i,e)?this.previousPage(e,t):this.nextPage(e,t),n.then(t=>{let i=this.getPage(e),n=t&&t.page;n&&n.side===i.side&&(n=null),o?r.finish({left:i,right:n}):r.finish({left:n,right:i})}),r.result()}nextSpread(e,t){let i=this.getPage(e);if(!i)return qn(null);let n=this.isRectoPage(i,e),r=this.nextPage(e,t);return n?r:r.thenAsync(e=>{if(e){if(e.page.side===i.side)return r;let n=this.nextPage(e.position,t);return n.thenAsync(e=>e?n:r)}return qn(null)})}previousSpread(e,t){let i=this.getPage(e);if(!i)return qn(null);let n=this.isRectoPage(i,e),r=this.previousPage(e,t),o=i.container.previousElementSibling;return n?r.thenAsync(e=>e?e.page.side===i.side||e.page.container!==o?r:this.previousPage(e.position,t):qn(null)):r}navigateToEPage(e,t,i){let n=Gn("navigateToEPage");return this.opf.resolveEPage(e).then(e=>{e?this.findPage(e,i).thenFinish(n):n.finish(null)}),n.result()}navigateToFragment(e,t,i){let n=Gn("navigateToCFI");return this.opf.resolveFragment(e).then(e=>{e?this.findPage(e,i).thenFinish(n):n.finish(null)}),n.result()}navigateTo(e,t,i){R.debug("Navigate to",e);let n=this.opf.getPathFromURL(Q(e));if(!n){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))n=this.opf.getPathFromURL(this.opf.opfXML.url);else if("#"===e.charAt(0)){let t=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?(n=this.opf.getPathFromURL(t[0]),null==n&&(n=t[0])):n=t[0],e=t[0]+(t[1]?`#${t[1]}`:"")}if(null==n)return qn(null)}let r=this.opf.itemMapByPath[n];if(!r){if(this.opf.opfXML&&n==this.opf.getPathFromURL(this.opf.opfXML.url)){let n=e.indexOf("#");if(n>=0)return this.navigateToFragment(e.substr(n+1),t,i)}return qn(null)}let o=Gn("navigateTo");return this.getPageViewItem(r.spineIndex).then(t=>{if(!t)return void o.finish(null);let n=t.xmldoc.getElement(e);this.findPage({spineIndex:r.spineIndex,pageIndex:-1,offsetInItem:n?t.xmldoc.getElementOffset(n):0},i).thenFinish(o)}),o.result()}makePage(e,t){let i=e.instance.viewport,n=i.document.createElement("div");n.setAttribute("data-vivliostyle-page-container","true"),n.role="presentation",y||(n.style.visibility="hidden"),i.layoutBox.appendChild(n);let r=i.document.createElement("div");r.setAttribute("data-vivliostyle-bleed-box","true"),r.role="presentation",n.appendChild(r);let o=new Fo(n,r);if(o.spineIndex=e.item.spineIndex,o.position=t,o.offset=e.instance.getPosition(t),0===o.offset&&(!e.instance.blankPageAtStart||0!==e.pages.length)){let t=this.opf.documentURLTransformer.transformFragment("",e.item.src);r.setAttribute("id",t),o.registerElementWithId(r,t)}if(i!==this.viewport){let e=$e(this.viewport.width,this.viewport.height,i.width,i.height),t=qr(null,new Hn(e,null),"");o.delayedItems.push(new Ao(n,"transform",t))}return o}makeObjectView(e,t,i,n){let r=t.getAttribute("data"),o=null;if(r){r=re(r,e.url);let i=t.getAttribute("media-type");if(!i){let e=this.opf.getPathFromURL(r);if(e){let t=this.opf.itemMapByPath[e];t&&(i=t.mediaType)}}if(i){let e=this.opf.bindings[i];if(e){o=this.viewport.document.createElement("iframe"),o.style.border="none";let n=ve(r),s=ve(i),a=new fe;a.append(e),a.append("?src="),a.append(n),a.append("&type="),a.append(s);for(let e=t.firstChild;e;e=e.nextSibling)if(1==e.nodeType){let t=e;if("param"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI){let e=t.getAttribute("name"),i=t.getAttribute("value");e&&i&&(a.append("&"),a.append(encodeURIComponent(e)),a.append("="),a.append(encodeURIComponent(i)))}}o.setAttribute("src",a.toString());let l=t.getAttribute("width");l&&o.setAttribute("width",l);let h=t.getAttribute("height");h&&o.setAttribute("height",h)}}}return o||(o=this.viewport.document.createElement("object"),r&&o.setAttribute("data",r),o.setAttribute("data-adapt-process-children","true")),qn(o)}makeMathJaxView(e,t,i,n){let r=function(){let e=window.MathJax;return e?e.Hub:null}();if(r){let n=i.ownerDocument,o=n.createElement("span");i.appendChild(o);let s=n.importNode(t,!0);this.resolveURLsInMathML(s,e),o.appendChild(s);let a=r.queue;a.Push(["Typeset",r,o]);let l=Gn("makeMathJaxView"),h=l.suspend();return a.Push(()=>{h.schedule(o)}),l.result()}return qn(null)}resolveURLsInMathML(e,t){if(null!=e){if(1===e.nodeType&&"mglyph"===e.tagName){let i=Array.from(e.attributes);for(let n of i){if("src"!==n.name)continue;let i=re(n.nodeValue,t.url);n.namespaceURI?e.setAttributeNS(n.namespaceURI,n.name,i):e.setAttribute(n.name,i)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeCustomRenderer(e){return(t,i,n)=>"object"==t.localName&&"http://www.w3.org/1999/xhtml"==t.namespaceURI?this.makeObjectView(e,t,i,n):"http://www.w3.org/1998/Math/MathML"==t.namespaceURI||t.dataset&&"true"==t.dataset.mathTypeset?this.makeMathJaxView(e,t,i,n):qn(null)}getPageViewItem(e){if(-1===e||e>=this.opf.spine.length)return qn(null);let t=this.spineItems[e];if(t)return qn(t);let i=Gn("getPageViewItem"),n=this.spineItemLoadingContinuations[e];if(n){let e=i.suspend();return n.push(e),i.result()}n=this.spineItemLoadingContinuations[e]=[];let r=this.opf.spine[e],o=this.opf.store;return o.load(r.src).then(s=>{var a;let l=r.itemRefElement.getAttribute("properties");l&&s.root.setAttribute("data-vivliostyle-epub-spine-properties",l),r.title=s.document.title;let h=o.getStyleForDoc(s),u=this.makeCustomRenderer(s),c=this.viewport,d=h.sizeViewport(c.width,c.height,c.fontSize,this.pref);(d.width!=c.width||d.height!=c.height||d.fontSize!=c.fontSize)&&(c=new Cf(c.window,d.fontSize,c.pixelRatio,c.root,d.width,d.height));let p,f,g=null==(a=this.spineItems[0])?void 0:a.instance.isVersoFirstPage,m=this.spineItems[e-1];if(null!==r.startPage)p=r.startPage-1,f=p;else{if(!(e>0)||m&&m.complete){p=m?m.instance.pageNumberOffset+m.pages.length:0;let e=this.counterStore.currentPageCounters.page;f=e&&e.length?e[e.length-1]:p}else p=r.epage||e,!this.opf.prePaginated&&p%2==(g?1:0)&&p++,f=p;null!==r.skipPagesBefore&&(p+=r.skipPagesBefore,f+=r.skipPagesBefore)}this.counterStore.forceSetPageCounter(f);let b=new Lf(h,s,this.opf.lang,c,this.clientLayout,this.fontMapper,u,this.opf.fallbackMap,p,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,g);b.pref=this.pref;let v=this.opf.metadata&&this.opf.metadata[Xf.title];b.pubTitle=v&&v[0]&&v[0].v||"",b.docTitle=r.title||"",b.init().then(()=>{!this.opf.pageProgression&&b.pageProgression&&(this.opf.pageProgression=b.pageProgression),t={item:r,xmldoc:s,instance:b,layoutPositions:[null],pages:[],complete:!1},this.spineItems[e]=t,i.finish(t),n.forEach(e=>{e.schedule(t)})})}),i.result()}removeRenderedPages(){let e=this.spineItems;for(let t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let e=this.spineItems;for(let t of e)if(t){let e=t.pages;for(let t of e)if(t.isAutoPageWidth&&t.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(e=>e&&e.pages.length>0)}showTOC(e){let t=this.opf,i=t.toc;if(this.tocAutohide=e,!i)return qn(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),qn(this.tocView.page);let n=Gn("showTOC");this.tocView||(this.tocView=new Vf(t.store,i.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));let r=this.viewport,o=Math.min(344,Math.round(.67*r.width)-16),s=r.height-6,a=r.document.createElement("div");return r.root.appendChild(a),y||(a.style.visibility="hidden"),a.style.width=`${o+16}px`,a.style.maxHeight=`${s}px`,a.setAttribute("data-vivliostyle-toc-box","true"),a.setAttribute("role","navigation"),this.tocView.showTOC(a,r,o,s,this.viewport.fontSize).then(e=>{a.style.visibility="visible",a.setAttribute("aria-hidden","false"),n.finish(e)}),n.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}},tg="data-vivliostyle-viewer-status",ig=(e=>(e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread",e))(ig||{}),ng=class{constructor(e,t,i,n){this.window=e,this.viewportElement=t,this.instanceId=i,this.callbackFn=n,h(this,"fontMapper"),h(this,"kick"),h(this,"sendCommand"),h(this,"resizeListener"),h(this,"hyperlinkListener"),h(this,"pageRuleStyleElement"),h(this,"pageSheetSizeAlreadySet",!1),h(this,"renderTask",null),h(this,"actions"),h(this,"readyState"),h(this,"packageURL"),h(this,"opf"),h(this,"touchActive"),h(this,"touchX"),h(this,"touchY"),h(this,"needResize"),h(this,"resized"),h(this,"needRefresh"),h(this,"viewportSize"),h(this,"currentPage"),h(this,"currentSpread"),h(this,"pagePosition"),h(this,"fontSize"),h(this,"zoom"),h(this,"fitToScreen"),h(this,"pageViewMode"),h(this,"waitForLoading"),h(this,"renderAllPages"),h(this,"pref"),h(this,"pageSizes"),h(this,"pixelRatio"),h(this,"pixelRatioLimit"),h(this,"viewport"),h(this,"opfView");let r=t.ownerDocument,o=(e,t)=>{let i=r.getElementById(e);return i||(i=r.createElement("style"),i.id=e,t&&(i.textContent=t),r.head.appendChild(i)),i};o("vivliostyle-viewport-screen-css",sr),o("vivliostyle-viewport-css",ar),o("vivliostyle-polyfill-css",pr),t.setAttribute("data-vivliostyle-viewer-viewport",!0),y&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(tg,"loading"),this.fontMapper=new qd(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=e=>{},this.pageRuleStyleElement=o("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState="loading",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode="singlePage",this.waitForLoading=!1,this.renderAllPages=!0,this.pref={fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0},this.pageSizes=[],this.pixelRatioLimit="chromium"===X&&"currentCSSZoom"in Element.prototype?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let e=T;R.addListener(e.DEBUG,e=>{this.callback({t:"debug",content:e})}),R.addListener(e.INFO,e=>{this.callback({t:"info",content:e})}),R.addListener(e.WARN,e=>{this.callback({t:"warn",content:e})}),R.addListener(e.ERROR,e=>{this.callback({t:"error",content:e})})}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(tg,e),this.callback({t:"readystatechange"}))}loadPublication(e){G.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.fragment,n=e.authorStyleSheet,r=e.userStyleSheet;this.viewport=null;let o=Gn("loadPublication");return this.configure(e).then(()=>{let e=new Hf;e.init(n,r).then(()=>{let n=re(oe(t),this.window.location.href);this.packageURL=[n],e.loadPubDoc(n).then(e=>{e?(this.opf=e,this.render(i).then(()=>{o.finish(!0)})):o.finish(!1)})})}),o.result()}loadXML(e){G.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.document,n=e.fragment,r=e.authorStyleSheet,o=e.userStyleSheet;this.viewport=null;let s=Gn("loadXML");return this.configure(e).then(()=>{let e=new Hf;e.init(r,o).then(()=>{let r=t.map((e,t)=>({url:re(oe(e.url),this.window.location.href),index:t,startPage:e.startPage,skipPagesBefore:e.skipPagesBefore}));this.packageURL=r.map(e=>e.url),this.opf=new Jf(e,""),this.opf.initWithChapters(r,i).then(()=>{this.render(n).then(()=>{s.finish(!0)})})})}),s.result()}render(e){let t;return this.cancelRenderingTask(),t=e?this.opf.resolveFragment(e).thenAsync(e=>(this.pagePosition=e,qn(!0))):qn(!0),t.thenAsync(()=>(G.registerEndTiming("beforeRender"),this.resize()))}resolveLength(e){let t,i=parseFloat(e);if("string"==typeof e&&(t=e.match(/[a-z]+$/))){let e=t[0];if("em"===e||"rem"===e)return i*this.fontSize;let n=Ke[e];if(n)return i*n}return i}configure(e){if("boolean"==typeof e.autoresize&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),"number"==typeof e.fontSize){let t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if("object"==typeof e.viewport&&e.viewport){let t=e.viewport,i={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(i.width>=200||i.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=i,this.needResize=!0)}if("boolean"==typeof e.hyphenate&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),"boolean"==typeof e.horizontal&&(this.pref.horizontal=e.horizontal,this.needResize=!0),"boolean"==typeof e.nightMode&&(this.pref.nightMode=e.nightMode,this.needResize=!0),"number"==typeof e.lineHeight&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),"number"==typeof e.columnWidth&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),"string"==typeof e.fontFamily&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),"boolean"==typeof e.load&&(this.waitForLoading=e.load),"boolean"==typeof e.renderAllPages&&(this.renderAllPages=e.renderAllPages),"string"==typeof e.userAgentRootURL&&(te(e.userAgentRootURL.replace(/resources\/?$/,"")),ne(e.userAgentRootURL)),"string"==typeof e.rootURL&&(te(e.rootURL),ne(`${ee}resources/`)),"string"==typeof e.pageViewMode&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),"number"==typeof e.pageBorder&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),"number"==typeof e.zoom&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),"boolean"==typeof e.fitToScreen&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),"object"==typeof e.defaultPaperSize&&"number"==typeof e.defaultPaperSize.width&&"number"==typeof e.defaultPaperSize.height&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),"boolean"==typeof e.allowScripts&&e.allowScripts!==hf&&(function(e){hf=e}(e.allowScripts),this.needResize=!0),"number"==typeof e.pixelRatio){let t=Math.min(e.pixelRatio,this.pixelRatioLimit);t!==this.pixelRatio&&(this.pixelRatio=t,this.needResize=!0)}return this.configurePlugins(e),qn(!0)}configurePlugins(e){M("CONFIGURATION").forEach(t=>{let i=t(e);this.needResize=i.needResize||this.needResize,this.needRefresh=i.needRefresh||this.needRefresh})}pageReplacedListener(e){let t=this.currentPage,i=this.currentSpread,n=e.target;i?(i.left===n||i.right===n)&&this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){let t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach(t=>{t&&e(t)})}removePageListeners(){this.forCurrentPages(e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(e=>{ce(e.container,"display","none")}),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),ce(e.container,"visibility","visible"),ce(e.container,"display","block")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),i=parseFloat(e.right.container.style.width);t&&i&&t!==i&&(t<i?e.left.container.style.marginLeft=i-t+"px":e.right.container.style.marginRight=t-i+"px")}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){let e=Gn("reportPosition");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(t=>{let i=this.currentPage;(this.waitForLoading&&i.fetchers.length>0?or(i.fetchers):qn(!0)).then(()=>{this.sendLocationNotification(i,t).thenFinish(e)})}),e.result()}createViewport(){let e=this.viewportElement;if(this.viewportSize){let t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new Cf(this.window,this.fontSize,this.pixelRatio,e,t.width,t.height)}return new Cf(this.window,this.fontSize,this.pixelRatio,e)}resolveSpreadView(e,t){switch(this.pageViewMode){case"singlePage":return!1;case"spread":return!0;default:return null!=e&&(e.width-this.pref.pageBorder)/e.height>=(t?2*t.width/t.height:1.45)&&(!!t||e.width>800)}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute("data-vivliostyle-spread-view",e.toString())}sizeIsGood(){var e;let t=this.createViewport(),i=(null==(e=this.opfView)?void 0:e.hasPages())&&!this.opfView.hasAutoSizedPages(),n=this.resolveSpreadView(t,this.resized&&i?this.pageSizes[0]:null);this.resized=!1;let r=this.pref.spreadView!==n;return this.updateSpreadView(n),!(this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize)&&(!!(!r&&t.width==this.viewport.width&&t.height==this.viewport.height||!r&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent))||!!i&&(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0))}setPageSize(e,t,i,n){this.pageSizes[n]=e,this.setPageSizePageRules(t,i,n),0===n&&"autoSpread"===this.pageViewMode&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,e))}setPageSizePageRules(e,t,i){var n,r;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[i].width!==(null==(n=this.pageSizes[i-1])?void 0:n.width)||this.pageSizes[i].height!==(null==(r=this.pageSizes[i-1])?void 0:r.height))){let e=function(e){let t=.75*e;return Math.ceil(t)},t=Math.max(...this.pageSizes.map(e=>e.width)),i=Math.max(...this.pageSizes.map(e=>e.height)),n=e(t),r=e(i),o=`@page {size: ${n}pt ${r}pt; margin: 0 ${-(n*((this.pixelRatio||1)-1)+2)}pt ${-(r*((this.pixelRatio||1)-1)+2)}pt 0;}`;this.pageRuleStyleElement.textContent=o,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.tocVisible,t=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new eg(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){this.needRefresh=!1,this.removePageListeners();let i=this.resolveSpreadView(this.viewport,e.dimensions);return i!==this.pref.spreadView&&this.updateSpreadView(i),i?this.opfView.getSpread(this.pagePosition,t).thenAsync(t=>t.left||t.right?!t.left||!t.right||this.resolveSpreadView(this.viewport,t.left.dimensions)&&this.resolveSpreadView(this.viewport,t.right.dimensions)?(this.showSpread(t),this.setSpreadZoom(t),this.currentPage="left"===e.side?t.left:t.right,qn(null)):(this.updateSpreadView(!1),this.showPage(e),this.setPageZoom(e),this.currentPage=e,qn(null)):qn(null)):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,qn(null))}setPageZoom(e){var t;let i=this.getAdjustedZoomFactor(e.dimensions);null==(t=this.viewport)||t.zoom(e.dimensions.width,e.dimensions.height,i)}setSpreadZoom(e){var t;let i=this.getSpreadDimensions(e);null==(t=this.viewport)||t.zoom(i.width,i.height,this.getAdjustedZoomFactor(i))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,i=0;return e.left&&(t+=e.left.dimensions.width,i=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,i=Math.max(i,e.right.dimensions.height)),e.left&&e.right&&(t+=2*this.pref.pageBorder,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:i}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");if("fit inside viewport"===e){let e;return this.pref.spreadView?(this.currentSpread,e=this.getSpreadDimensions(this.currentSpread)):e=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(e)}throw new Error(`unknown zoom type: ${e}`)}calculateZoomFactorToFitInsideViewPort(e){if(!this.viewport)return this.zoom;let t=this.viewport.width/e.width,i=this.viewport.height/e.height;return Math.min(t,i)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new og),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return qn(!0);this.setReadyState("loading"),this.cancelRenderingTask();let e=Wn().getScheduler().run(()=>Xn("resize",t=>{this.opf?(this.renderTask=e,G.registerStartTiming("render (resize)"),this.reset(),this.pagePosition&&(0==this.pagePosition.pageIndex&&0==this.pagePosition.offsetInItem||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then(i=>{i?(this.pagePosition=i.position,this.showCurrent(i.page,!0).then(()=>{this.setReadyState("interactive"),this.opf.countEPages(e=>{let t={t:"nav",epageCount:e,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||0==this.pagePosition.pageIndex&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(t.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(t)}).then(()=>{this.reportPosition().then(i=>{(this.renderAllPages?this.opfView.renderAllPages():qn(null)).then(()=>{this.renderTask===e&&(this.renderTask=null),G.registerEndTiming("render (resize)"),hf&&gf(this.window)?function(e){if(!hf)return qn(!1);let t=Gn("loadScripts");return t.loop(()=>0===uf.length?qn(!1):pf(uf.shift(),e,{atEnd:!0}).thenReturn(uf.length>0)).then(()=>{R.debug("dispatchEvent: DOMContentLoaded (window)"),e.dispatchEvent(new Event("DOMContentLoaded")),R.debug("dispatchEvent: load (window)"),e.dispatchEvent(new Event("load")),t.finish(!0)}),t.result()}(this.window).then(()=>{this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i)}):(this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(i))})})})})):t.finish(!1)})):t.finish(!1)},(e,t)=>{if(!(t instanceof og))throw t;G.registerEndTiming("render (resize)"),R.debug(t.message)}));return qn(!0)}sendLocationNotification(e,t){let i=Gn("sendLocationNotification"),n={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then(e=>{n.epage=e,n.epageCount=this.opf.epageCount,t&&(n.cfi=t),this.callback(n),i.finish(!0)}),i.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){var t;let i;if("complete"!==this.readyState&&"next"!==e.where&&this.setReadyState("loading"),"string"==typeof e.where){let t;switch(e.where){case"next":t=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":t=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":t=this.opfView.lastPage;break;case"first":t=this.opfView.firstPage;break;default:return qn(!0)}t&&(i=()=>t.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if("number"==typeof e.epage){let t=e.epage;i=()=>this.opfView.navigateToEPage(t,this.pagePosition,!this.renderAllPages)}else if("string"==typeof e.url){let t=e.url;i=()=>this.opfView.navigateTo(t,this.pagePosition,!this.renderAllPages)}else{if("number"!=typeof(null==(t=e.position)?void 0:t.spineIndex))return qn(!0);{let t=e.position;i=()=>this.opfView.findPage(t,!this.renderAllPages)}}if(!this.opfView)return qn(!0);let n=Gn("moveTo");return i.call(this.opfView).then(e=>{let t;if(e){this.pagePosition=e.position;let i=Gn("moveTo.showCurrent");t=i.result(),this.showCurrent(e.page,!this.renderAllPages).then(()=>{this.reportPosition().thenFinish(i)})}else t=qn(!0);t.then(e=>{"loading"===this.readyState&&this.setReadyState("interactive"),n.finish(e)})}),n.result()}showTOC(e){let t=!!e.autohide,i=e.v,n=this.opfView.isTOCVisible(),r=t!=this.opfView.tocAutohide&&"hide"!=i;if(n){if("show"==i&&!r)return qn(!0)}else if("hide"==i)return qn(!0);if(n&&"show"!=i)return this.opfView.hideTOC(),qn(!0);{let e=Gn("showTOC");return this.opfView.showTOC(t).then(i=>{if(i){if(r&&(i.listeners={}),t){let e=()=>{this.opfView.hideTOC()};i.addEventListener("hyperlink",e,!1)}i.addEventListener("hyperlink",this.hyperlinkListener,!1)}e.finish(!0)}),e.result()}}runCommand(e){let t=e.a||"";return Xn("runCommand",i=>{let n=this.actions[t];n?n.call(this,e).then(()=>{this.callback({t:"done",a:t}),i.finish(!0)}):(R.error("No such action:",t),i.finish(!0))},(e,i)=>{R.error(i,"Error during action:",t),e.finish(!0)})}initEmbed(e){let t=sg(e),i=null,n=this;Yn(()=>{let e=Gn("commandLoop"),r=Wn().getScheduler();return n.hyperlinkListener=e=>{let t=e,i="#"===t.href.charAt(0)||n.packageURL.some(e=>t.href.substr(0,e.length)==e);if(i){e.preventDefault();let o={t:"hyperlink",href:t.href,internal:i};r.run(()=>(n.callback(o),qn(!0)))}},e.loopWithFrame(e=>{if(n.needResize)n.resize().then(()=>{e.continueLoop()});else if(n.needRefresh)n.currentPage&&n.showCurrent(n.currentPage,!this.renderAllPages).then(()=>{e.continueLoop()});else if(t){let i=t;t=null,n.runCommand(i).then(()=>{e.continueLoop()})}else{let t=Gn("waitForCommand");i=t.suspend(this),t.result().then(()=>{e.continueLoop()})}}).thenFinish(e),e.result()}),n.kick=()=>{let e=i;e&&(i=null,e.schedule(!0))},n.sendCommand=e=>!t&&(t=sg(e),n.kick(),!0),this.window.adapt_command=n.sendCommand}},rg=(e=>(e.FIT_INSIDE_VIEWPORT="fit inside viewport",e))(rg||{}),og=class e extends Error{constructor(){super(),h(this,"name","RenderingCanceledError"),h(this,"message","Page rendering has been canceled"),h(this,"stack"),Object.setPrototypeOf(this,e.prototype),this.stack=(new Error).stack}};function sg(e){return"string"==typeof e?J(e):e}var ag=S;function lg(e){let t={};return Object.keys(e).forEach(i=>{let n=e[i];switch(i){case"autoResize":t.autoresize=n;break;case"pageBorderWidth":t.pageBorder=n;break;default:t[i]=n}}),t}var hg=class{constructor(e,t){this.settings=e,h(this,"initialized",!1),h(this,"adaptViewer_"),h(this,"options"),h(this,"eventTarget"),h(this,"readyState"),w(e.debug),this.adaptViewer_=new ng(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options={autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:"autoSpread",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8},t&&this.setOptions(t),this.eventTarget=new Ne,Object.defineProperty(this,"readyState",{get(){return this.adaptViewer_.readyState}})}setOptions(e){let t=Object.assign({a:"configure"},lg(e));this.adaptViewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){let t={type:e.t},i=e;Object.keys(i).forEach(e=>{"t"!==e&&(t[e]=i[e])}),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,i){e&&(Array.isArray(e)?e[0]&&("string"==typeof e[0]||e[0].url):"string"==typeof e||e.url)?this.loadDocumentOrPublication(e,null,t,i):this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}})}loadPublication(e,t,i){e?this.loadDocumentOrPublication(null,e,t,i):this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}})}loadDocumentOrPublication(e,t,i,n){let r=i||{};function o(e){if(e)return e.map(e=>({url:e.url||null,text:e.text||null}))}let s=o(r.authorStyleSheet),a=o(r.userStyleSheet);n&&Object.assign(this.options,n);let l=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:ug(e)||t,document:r.documentObject,fragment:r.fragment,authorStyleSheet:s,userStyleSheet:a},lg(this.options));this.initialized?this.adaptViewer_.sendCommand(l):(this.initialized=!0,this.adaptViewer_.initEmbed(l))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case"left":return this.getCurrentPageProgression()===ag.LTR?"previous":"next";case"right":return this.getCurrentPageProgression()===ag.LTR?"next":"previous";default:return e}}navigateToPage(e,t){"epage"===e?this.adaptViewer_.sendCommand({a:"moveTo",epage:t}):this.adaptViewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.adaptViewer_.sendCommand({a:"moveTo",url:e})}navigateToPosition(e){var t,i;this.adaptViewer_.sendCommand({a:"moveTo",position:{spineIndex:e.spineIndex,pageIndex:null!=(t=e.pageIndex)?t:-1,offsetInItem:null!=(i=e.offsetInItem)?i:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(e,t){let i=null==e?"toggle":e?"show":"hide";this.adaptViewer_.sendCommand({a:"toc",v:i,autohide:t})}queryZoomFactor(e){return this.adaptViewer_.queryZoomFactor(e)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var e,t;return null==(t=null==(e=this.adaptViewer_.opfView)?void 0:e.tocView)?void 0:t.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function ug(e){function t(e){return"number"==typeof e?e:null}function i(e){return"string"==typeof e?{url:e,startPage:null,skipPagesBefore:null}:{url:e.url,startPage:t(e.startPage),skipPagesBefore:t(e.skipPagesBefore)}}return Array.isArray(e)?e.map(i):e?[i(e)]:null}var cg,dg=((cg=dg||{}).PREVIOUS="previous",cg.NEXT="next",cg.LEFT="left",cg.RIGHT="right",cg.FIRST="first",cg.LAST="last",cg.EPAGE="epage",cg),pg=rg,fg=ig;G.forceRegisterEndTiming("load_vivliostyle");var gg=class{constructor(e,{title:t="",printCallback:i=e=>e.print(),errorCallback:n=null,hideIframe:r=!0,removeIframe:o=!0}){h(this,"htmlDoc"),h(this,"title"),h(this,"printCallback"),h(this,"errorCallback"),h(this,"hideIframe"),h(this,"removeIframe"),h(this,"iframe"),h(this,"iframeWin"),h(this,"window"),this.htmlDoc=e,this.title=t,this.printCallback=i,this.errorCallback=n,this.hideIframe=r,this.removeIframe=o}init(){this.iframe=document.createElement("iframe"),this.hideIframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.borderWidth="0"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`\n      <!DOCTYPE html>\n      <html data-vivliostyle-paginated="true">\n        <head>\n          <meta charset='utf-8'/>\n          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>\n          <title>${this.title}</title>\n          <style>\n            html[data-vivliostyle-paginated] {\n              width: 100%;\n              height: 100%;\n            }\n            html[data-vivliostyle-paginated] body,\n            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {\n              width: 100% !important;\n              height: 100% !important;\n            }\n            html[data-vivliostyle-paginated],\n            html[data-vivliostyle-paginated] body {\n              margin: 0;\n              padding: 0;\n            }\n          </style>\n          <style id='vivliostyle-page-rules'></style>\n        </head>\n        <body onload='parent.printInstance.runInIframe(window)'>\n          <div id="vivliostyle-viewer-viewport"></div>\n        </body>\n      </html>`,document.body.appendChild(this.iframe)}runInIframe(e){return this.iframeWin=e,this.preparePrint().then(()=>this.browserPrint()).then(()=>this.cleanUp())}preparePrint(){this.iframeWin.document.title=this.title;let e=new Blob([this.htmlDoc],{type:"text/html"}),t=URL.createObjectURL(e),i=new hg({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise(e=>{i.addListener("readystatechange",()=>{"complete"===i.readyState&&e()}),this.errorCallback&&i.addListener("error",e=>{var t,i;let n=null!=(i=null==(t=e.content.error)?void 0:t.toString())?i:e.content.messages.join("\n");this.errorCallback(n)}),i.loadDocument({url:t})})}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function mg(e,t){new gg(e,t).init()}return c}(),b=e({__proto__:null,default:t(m)},[m]);!function(e){e.Default="",e.Auto="auto",e.Preset="preset",e.Custom="custom",e.Zero="0"}(g||(g={}));const v=[{name:"letter",description:"Letter"},{name:"legal",description:"Legal"},{name:"ledger",description:"Ledger"},{name:"a10",description:"A10"},{name:"a9",description:"A9"},{name:"a8",description:"A8"},{name:"a7",description:"A7"},{name:"a6",description:"A6"},{name:"a5",description:"A5"},{name:"a4",description:"A4"},{name:"a3",description:"A3"},{name:"a2",description:"A2"},{name:"a1",description:"A1"},{name:"a0",description:"A0"},{name:"b10",description:"B10 (ISO)"},{name:"b9",description:"B9 (ISO)"},{name:"b8",description:"B8 (ISO)"},{name:"b7",description:"B7 (ISO)"},{name:"b6",description:"B6 (ISO)"},{name:"b5",description:"B5 (ISO)"},{name:"b4",description:"B4 (ISO)"},{name:"b3",description:"B3 (ISO)"},{name:"b2",description:"B2 (ISO)"},{name:"b1",description:"B1 (ISO)"},{name:"b0",description:"B0 (ISO)"},{name:"jis-b10",description:"JIS-B10"},{name:"jis-b9",description:"JIS-B9"},{name:"jis-b8",description:"JIS-B8"},{name:"jis-b7",description:"JIS-B7"},{name:"jis-b6",description:"JIS-B6"},{name:"jis-b5",description:"JIS-B5"},{name:"jis-b4",description:"JIS-B4"},{name:"jis-b3",description:"JIS-B3"},{name:"jis-b2",description:"JIS-B2"},{name:"jis-b1",description:"JIS-B1"},{name:"jis-b0",description:"JIS-B0"},{name:"c10",description:"C10"},{name:"c9",description:"C9"},{name:"c8",description:"C8"},{name:"c7",description:"C7"},{name:"c6",description:"C6"},{name:"c5",description:"C5"},{name:"c4",description:"C4"},{name:"c3",description:"C3"},{name:"c2",description:"C2"},{name:"c1",description:"C1"},{name:"c0",description:"C0"}],y={customWidth:"210mm",customHeight:"297mm",customMargin:"10%",baseFontSize:"12pt",baseLineHeight:"1.2",baseFontFamily:"serif",viewerFontSize:16,cropMarks:"crop cross",bleed:"3mm",cropOffset:"9mm"};class w{constructor(e){this.PresetSize=w.PresetSize,this.pageSizeMode=a.observable(g.Default),this.presetSize=a.observable(v[9]),this.isLandscape=a.observable(!1),this.customWidth=a.observable(y.customWidth),this.customHeight=a.observable(y.customHeight),this.pageSizeImportant=a.observable(!1),this.pageMarginMode=a.observable(g.Default),this.customMargin=a.observable(y.customMargin),this.pageMarginImportant=a.observable(!1),this.firstPageMarginZero=a.observable(!1),this.firstPageMarginZeroImportant=a.observable(!1),this.forceHtmlBodyMarginZero=a.observable(!1),this.widowsOrphans=a.observable(""),this.widowsOrphansImportant=a.observable(!1),this.imageMaxSizeToFitPage=a.observable(!1),this.imageMaxSizeToFitPageImportant=a.observable(!1),this.imageKeepAspectRatio=a.observable(!1),this.imageKeepAspectRatioImportant=a.observable(!1),this.baseFontSize=a.observable(y.baseFontSize),this.baseFontSizeSpecified=a.observable(!1),this.baseFontSizeImportant=a.observable(!1),this.baseLineHeight=a.observable(y.baseLineHeight),this.baseLineHeightSpecified=a.observable(!1),this.baseLineHeightImportant=a.observable(!1),this.baseFontFamily=a.observable(y.baseFontFamily),this.baseFontFamilySpecified=a.observable(!1),this.baseFontFamilyImportant=a.observable(!1),this.cropMarks=a.observable(y.cropMarks),this.cropMarksSpecified=a.observable(!1),this.cropMarksImportant=a.observable(!1),this.bleed=a.observable(y.bleed),this.bleedSpecified=a.observable(!1),this.bleedImportant=a.observable(!1),this.cropOffset=a.observable(y.cropOffset),this.cropOffsetSpecified=a.observable(!1),this.cropOffsetImportant=a.observable(!1),this.customStyleAsUserStyle=a.observable(!1),this.allImportant=a.observable(!1),this.pageOtherStyle=a.observable(""),this.firstPageOtherStyle=a.observable(""),this.rootOtherStyle=a.observable(""),this.beforeOtherStyle=a.observable(""),this.afterOtherStyle=a.observable(""),this.viewerFontSize=null,this.setViewerFontSizeObservable=e=>{this.viewerFontSize=e;const t=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];t&&(t.value=this.fontSizePxToPercent(Number(e()),100,5).toString())},this.viewerFontSizePercent=a.pureComputed({read(){if(!this.viewerFontSize)return 100;return this.fontSizePxToPercent(Number(this.viewerFontSize()),100,5)},write(e){if(!this.viewerFontSize)return;const t=parseFloat(String(e));let i=t&&this.fontSizePercentToPx(t);if(!i||Number(i)<5||Number(i)>72){const e=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];e&&(e.value="100"),i=y.viewerFontSize}this.viewerFontSize(Number(i))},owner:this}),this.cssText=a.pureComputed({read:this.toCSSText,write:this.fromCSSText,owner:this}),this.allImportant.subscribe(e=>{this.pageSizeImportant(e),this.pageMarginImportant(e),this.firstPageMarginZeroImportant(e),this.widowsOrphansImportant(e),this.imageMaxSizeToFitPageImportant(e),this.imageKeepAspectRatioImportant(e),this.baseFontSizeImportant(e),this.baseLineHeightImportant(e),this.baseFontFamilyImportant(e),this.cropMarksImportant(e),this.bleedImportant(e),this.cropOffsetImportant(e)}),this.cropMarksSpecified.subscribe(e=>{e?this.bleedSpecified(!0):(this.bleedSpecified(!1),this.cropOffsetSpecified(!1))}),this.pageStyleRegExp=new RegExp("^((?:\\n|.)*?)\\/\\*<viewer>\\*\\/\\s*(?:@page\\s*\\{\\s*(?:size:\\s*([^\\s!;{}]+)(?:\\s+([^\\s!;{}]+))?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:margin:\\s*([^\\s!;{}]+(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:marks:\\s*([^\\s!;{}]+(?:\\s+[^\\s!;{}]+)?)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:bleed:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:crop-offset:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?(?:@page\\s*:first\\s*\\{\\s*(margin:\\s*0(?:\\w+|%)?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?((?:html|:root),\\s*body\\s*\\{\\s*margin:\\s*0(?:\\w+|%)?\\s*!important(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:(?:html|:root)\\s*\\{\\s*(?:font-size:\\s*(calc\\([^()]+\\)|[^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:line-height:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:font-family:\\s*([^!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?([^{}]*)\\}\\s*)?(?:body\\s*\\{\\s*(?:[-\\w]+:\\s*inherit\\s*!important(?:;|(?=[\\s{}]))\\s*)+\\}\\s*)?(?:\\*\\s*\\{\\s*widows:\\s*(1|999)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*orphans:\\s*\\25\\s*\\26(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:img,\\s*svg\\s*\\{\\s*(max-inline-size:\\s*100%\\s*(!important)?(?:;|(?=[\\s{}]))\\s*max-block-size:\\s*100vb\\s*\\28(?:;|(?=[\\s{}]))\\s*)?(object-fit:\\s*contain\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?\\}\\s*)?((?:\\n|.)*)$"),e&&this.copyFrom(e)}fontSizePxToPercent(e,t,i){let n=e/y.viewerFontSize*(t||100);return i&&(n=n.toPrecision(i).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),n}fontSizePercentToPx(e,t,i){let n=e/(t||100)*y.viewerFontSize;return i&&(n=n.toPrecision(i).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),n}fromCSSText(e){const t=this.pageStyleRegExp.exec(e);if(t){const[,e,i,n,r,o,s,a,l,h,u,c,d,p,f,m,b,y,w,x,S,C,k,E,P,N,T,I,A,_,R,L]=t;let F=L,O=k,B=w,M=b,z=p,D=P,V=i,U=n,H=0,$=0;if(this.beforeOtherStyle(e),"landscape"==V||"portrait"==V?(this.isLandscape("landscape"==V),V=U,U=null):"landscape"!=U&&"portrait"!=U||(this.isLandscape("landscape"==U),U=null),null!=V){if(null==U)if("auto"==V)this.pageSizeMode(g.Auto);else{const e=v.find(e=>e.name.toLowerCase()==V.toLowerCase());e?(this.pageSizeMode(g.Preset),this.presetSize(e)):(this.pageSizeMode(g.Custom),this.customWidth(V),this.customHeight(V))}else this.pageSizeMode(g.Custom),this.customWidth(V),this.customHeight(U);this.pageSizeImportant(!!r),r?H++:$++}else this.pageSizeMode(g.Default);null!=o?(this.pageMarginMode("0"==o?g.Zero:g.Custom),"0"==o?this.pageMarginMode(g.Zero):(this.pageMarginMode(g.Custom),this.customMargin(o)),this.pageMarginImportant(!!s),s?H++:$++):this.pageMarginMode(g.Default),null!=a?(this.cropMarksSpecified(!0),this.cropMarks(a),this.cropMarksImportant(!!l),l?H++:$++):this.cropMarksSpecified(!1),null!=h?(this.bleedSpecified(!0),this.bleed(h),this.bleedImportant(!!u),u?H++:$++):this.bleedSpecified(!1),null!=c?(this.cropOffsetSpecified(!0),this.cropOffset(c),this.cropOffsetImportant(!!d),d?H++:$++):this.cropOffsetSpecified(!1),z=z||"",this.pageOtherStyle(z),f?(this.firstPageMarginZero(!0),this.firstPageMarginZeroImportant(!!m),m?H++:$++):this.firstPageMarginZero(!1),M=M||"",this.firstPageOtherStyle(M),y?this.forceHtmlBodyMarginZero(!0):this.forceHtmlBodyMarginZero(!1),null!=B?(B=B.replace(/^\s*calc\([.\d]+\s*\*\s*([.\d]+\w+)\)\s*$/,"$1"),this.baseFontSizeSpecified(!0),this.baseFontSize(B),this.baseFontSizeImportant(!!x),x?H++:$++):this.baseFontSizeSpecified(!1),null!=S?(this.baseLineHeightSpecified(!0),this.baseLineHeight(S),this.baseLineHeightImportant(!!C),C?H++:$++):this.baseLineHeightSpecified(!1),null!=O?(O=O.trim(),this.baseFontFamilySpecified(!0),this.baseFontFamily(O),this.baseFontFamilyImportant(!!E),E?H++:$++):this.baseFontFamilySpecified(!1),D=D||"",this.rootOtherStyle(D),null!=N?(this.widowsOrphans(N),this.widowsOrphansImportant(!!T),T?H++:$++):this.widowsOrphans(g.Default),I?(this.imageMaxSizeToFitPage(!0),this.imageMaxSizeToFitPageImportant(!!A),A?H++:$++):this.imageMaxSizeToFitPage(!1),_?(this.imageKeepAspectRatio(!0),this.imageKeepAspectRatioImportant(!!R),R?H++:$++):this.imageKeepAspectRatio(!1),F=F.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"",this.afterOtherStyle(F),this.allImportant(H>0&&0==$)}else{const t=e.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"";this.afterOtherStyle(t)}}toCSSText(){function e(e){return e?" !important":""}let t=this.beforeOtherStyle();if(t+="/*<viewer>*/\n",this.pageSizeMode()!=g.Default||this.pageMarginMode()!=g.Default||this.cropMarksSpecified()||this.bleedSpecified()||this.cropOffsetSpecified()||this.pageOtherStyle()){if(t+="@page { ",this.pageSizeMode()!=g.Default){switch(t+="size: ",this.pageSizeMode()){case g.Auto:t+="auto";break;case g.Preset:t+=this.presetSize().name,this.isLandscape()&&(t+=" landscape");break;case g.Custom:t+=`${this.customWidth()} ${this.customHeight()}`;break;default:throw new Error(`Unknown pageSizeMode ${this.pageSizeMode()}`)}t+=`${e(this.pageSizeImportant())}; `}if(this.pageMarginMode()!=g.Default){switch(t+="margin: ",this.pageMarginMode()){case g.Auto:t+="auto";break;case g.Zero:t+="0";break;case g.Custom:t+=`${this.customMargin()}`;break;default:throw new Error(`Unknown pageMarginMode ${this.pageMarginMode()}`)}t+=`${e(this.pageMarginImportant())}; `}this.cropMarksSpecified()&&(t+=`marks: ${this.cropMarks()}${e(this.cropMarksImportant())}; `),this.bleedSpecified()&&(t+=`bleed: ${this.bleed()}${e(this.bleedImportant())}; `),this.cropOffsetSpecified()&&(t+=`crop-offset: ${this.cropOffset()}${e(this.cropOffsetImportant())}; `),t+=this.pageOtherStyle(),t+="}\n"}if((this.firstPageMarginZero()||this.firstPageOtherStyle())&&(t+="@page :first { ",this.firstPageMarginZero()&&(t+=`margin: 0${e(this.firstPageMarginZeroImportant())}; `),t+=this.firstPageOtherStyle(),t+="}\n"),this.forceHtmlBodyMarginZero()&&(t+=":root, body { margin: 0 !important; }\n"),this.baseFontSizeSpecified()||this.baseLineHeightSpecified()||this.baseFontFamilySpecified()||this.rootOtherStyle()){t+=":root { ";const i=this.baseFontSize();if(this.baseFontSizeSpecified())if(this.viewerFontSize&&this.viewerFontSize()!=y.viewerFontSize&&!i.endsWith("%")){t+=`font-size: calc(${this.fontSizePxToPercent(Number(this.viewerFontSize()),1,5)} * ${i})${e(this.baseFontSizeImportant())}; `}else t+=`font-size: ${this.baseFontSize()}${e(this.baseFontSizeImportant())}; `;this.baseLineHeightSpecified()&&(t+=`line-height: ${this.baseLineHeight()}${e(this.baseLineHeightImportant())}; `),this.baseFontFamilySpecified()&&(t+=`font-family: ${this.baseFontFamily()}${e(this.baseFontFamilyImportant())}; `),t+=this.rootOtherStyle(),t+="}\n"}return(this.baseFontSizeSpecified()&&this.baseFontSizeImportant()||this.baseLineHeightSpecified()&&this.baseLineHeightImportant()||this.baseFontFamilySpecified()&&this.baseFontFamilyImportant())&&(t+="body { ",this.baseFontSizeSpecified()&&this.baseFontSizeImportant()&&(t+="font-size: inherit !important; "),this.baseLineHeightSpecified()&&this.baseLineHeightImportant()&&(t+="line-height: inherit !important; "),this.baseFontFamilySpecified()&&this.baseFontFamilyImportant()&&(t+="font-family: inherit !important; "),t+="}\n"),this.widowsOrphans()&&(t+="* { ",t+=`widows: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+=`orphans: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+="}\n"),(this.imageMaxSizeToFitPage()||this.imageKeepAspectRatio())&&(t+="img, svg { ",this.imageMaxSizeToFitPage()&&(t+=`max-inline-size: 100%${e(this.imageMaxSizeToFitPageImportant())}; `,t+=`max-block-size: 100vb${e(this.imageMaxSizeToFitPageImportant())}; `),this.imageKeepAspectRatio()&&(t+=`object-fit: contain${e(this.imageKeepAspectRatioImportant())}; `),t+="}\n"),t+="/*</viewer>*/\n",t+=this.afterOtherStyle(),t}copyFrom(e){this.pageSizeMode(e.pageSizeMode()),this.presetSize(e.presetSize()),this.isLandscape(e.isLandscape()),this.customWidth(e.customWidth()),this.customHeight(e.customHeight()),this.pageSizeImportant(e.pageSizeImportant()),this.pageMarginMode(e.pageMarginMode()),this.customMargin(e.customMargin()),this.pageMarginImportant(e.pageMarginImportant()),this.firstPageMarginZero(e.firstPageMarginZero()),this.firstPageMarginZeroImportant(e.firstPageMarginZeroImportant()),this.forceHtmlBodyMarginZero(e.forceHtmlBodyMarginZero()),this.widowsOrphans(e.widowsOrphans()),this.widowsOrphansImportant(e.widowsOrphansImportant()),this.imageMaxSizeToFitPage(e.imageMaxSizeToFitPage()),this.imageMaxSizeToFitPageImportant(e.imageMaxSizeToFitPageImportant()),this.imageKeepAspectRatio(e.imageKeepAspectRatio()),this.imageKeepAspectRatioImportant(e.imageKeepAspectRatioImportant()),this.baseFontSize(e.baseFontSize()),this.baseFontSizeSpecified(e.baseFontSizeSpecified()),this.baseFontSizeImportant(e.baseFontSizeImportant()),this.baseLineHeight(e.baseLineHeight()),this.baseLineHeightSpecified(e.baseLineHeightSpecified()),this.baseLineHeightImportant(e.baseLineHeightImportant()),this.baseFontFamily(e.baseFontFamily()),this.baseFontFamilySpecified(e.baseFontFamilySpecified()),this.baseFontFamilyImportant(e.baseFontFamilyImportant()),this.cropMarks(e.cropMarks()),this.cropMarksSpecified(e.cropMarksSpecified()),this.cropMarksImportant(e.cropMarksImportant()),this.bleed(e.bleed()),this.bleedSpecified(e.bleedSpecified()),this.bleedImportant(e.bleedImportant()),this.cropOffset(e.cropOffset()),this.cropOffsetSpecified(e.cropOffsetSpecified()),this.cropOffsetImportant(e.cropOffsetImportant()),this.allImportant(e.allImportant()),this.pageOtherStyle(e.pageOtherStyle()),this.firstPageOtherStyle(e.firstPageOtherStyle()),this.rootOtherStyle(e.rootOtherStyle()),this.beforeOtherStyle(e.beforeOtherStyle()),this.afterOtherStyle(e.afterOtherStyle()),this.viewerFontSize&&e.viewerFontSize&&this.viewerFontSize(e.viewerFontSize()),this.customStyleAsUserStyle(e.customStyleAsUserStyle())}equivalentTo(e){return this.pageSizeMode()===e.pageSizeMode()&&((this.pageSizeMode()!==g.Preset||this.presetSize()===e.presetSize())&&((this.pageSizeMode()!==g.Preset||this.isLandscape()===e.isLandscape())&&((this.pageSizeMode()!==g.Custom||this.customWidth()===e.customWidth())&&((this.pageSizeMode()!==g.Custom||this.customHeight()===e.customHeight())&&(this.pageSizeImportant()===e.pageSizeImportant()&&(this.pageMarginMode()===e.pageMarginMode()&&((this.pageMarginMode()!==g.Custom||this.customMargin()===e.customMargin())&&(this.pageMarginImportant()===e.pageMarginImportant()&&(this.firstPageMarginZero()===e.firstPageMarginZero()&&(this.firstPageMarginZeroImportant()===e.firstPageMarginZeroImportant()&&(this.forceHtmlBodyMarginZero()===e.forceHtmlBodyMarginZero()&&(this.widowsOrphans()===e.widowsOrphans()&&(this.widowsOrphansImportant()===e.widowsOrphansImportant()&&(this.imageMaxSizeToFitPage()===e.imageMaxSizeToFitPage()&&(this.imageMaxSizeToFitPageImportant()===e.imageMaxSizeToFitPageImportant()&&(this.imageKeepAspectRatio()===e.imageKeepAspectRatio()&&(this.imageKeepAspectRatioImportant()===e.imageKeepAspectRatioImportant()&&(this.baseFontSizeSpecified()===e.baseFontSizeSpecified()&&((!this.baseFontSizeSpecified()||this.baseFontSize()===e.baseFontSize())&&(this.baseFontSizeImportant()===e.baseFontSizeImportant()&&(this.baseLineHeightSpecified()===e.baseLineHeightSpecified()&&((!this.baseLineHeightSpecified()||this.baseLineHeight()===e.baseLineHeight())&&(this.baseLineHeightImportant()===e.baseLineHeightImportant()&&(this.baseFontFamilySpecified()===e.baseFontFamilySpecified()&&((!this.baseFontFamilySpecified()||this.baseFontFamily()===e.baseFontFamily())&&(this.baseFontFamilyImportant()===e.baseFontFamilyImportant()&&(this.cropMarksSpecified()===e.cropMarksSpecified()&&((!this.cropMarksSpecified()||this.cropMarks()===e.cropMarks())&&(this.cropMarksImportant()===e.cropMarksImportant()&&(this.bleedSpecified()===e.bleedSpecified()&&((!this.bleedSpecified()||this.bleed()===e.bleed())&&(this.bleedImportant()===e.bleedImportant()&&(this.cropOffsetSpecified()===e.cropOffsetSpecified()&&((!this.cropOffsetSpecified()||this.cropOffset()===e.cropOffset())&&(this.cropOffsetImportant()===e.cropOffsetImportant()&&(this.customStyleAsUserStyle()===e.customStyleAsUserStyle()&&(this.allImportant()===e.allImportant()&&(this.pageOtherStyle()===e.pageOtherStyle()&&(this.firstPageOtherStyle()===e.firstPageOtherStyle()&&(this.rootOtherStyle()===e.rootOtherStyle()&&(this.beforeOtherStyle()===e.beforeOtherStyle()&&(this.afterOtherStyle()===e.afterOtherStyle()&&!(!this.viewerFontSize!=!e.viewerFontSize||this.viewerFontSize&&this.viewerFontSize()!==e.viewerFontSize())))))))))))))))))))))))))))))))))))))))))))}}w.Mode=g,w.Constants=y,w.PresetSize=v;var x={escapeUnicodeChar:e=>`\\u${(65536|e.charCodeAt(0)).toString(16).substring(1)}`,escapeUnicodeString(e){return e.replace(/[^-a-zA-Z0-9_]/g,this.escapeUnicodeChar)},percentEncodeAmpersandAndUnencodedPercent:e=>e.replace(/%(?![0-9A-Fa-f]{2})/g,"%25").replace(/&/g,"%26"),percentEncodeAmpersandAndPercent:e=>e.replace(/%/g,"%25").replace(/&/g,"%26"),percentDecodeAmpersandAndPercent:e=>e.replace(/%26/g,"&").replace(/%25/g,"%"),percentEncodeForDataURI:e=>encodeURI(e).replace(/\?/g,"%3F").replace(/#/g,"%23").replace(/&/g,"%26")};function S(e){return new RegExp(`[#&]${x.escapeUnicodeString(e)}=([^&]*)`,"g")}const C=new class{constructor(){this.localStorageKey=null,this.history=window.history,this.location=window.location,this.storedUrl=this.location.href}getBaseURL(){let e=this.location.href;return e=e.replace(/#.*$/,""),e.replace(/\/[^/]*$/,"/")}hasParameter(e){const t=this.location.href;return S(e).test(t)}getParameter(e){const t=this.location.href,i=S(e),n=[];let r;for(;r=i.exec(t);)n.push(r[1]);return n}setParameter(e,t,i){var n;const r=this.location.href;let o=r;const s=S(e);let a=s.exec(r);if(a&&i)for(;i-- >=1;)a=s.exec(r);if(a){const e=a[1].length,i=a.index+a[0].length-e;o=r.substring(0,i)+t+r.substring(i+e)}else o=`${r+(r.match(/[#&]$/)?"":r.match(/#/)?"&":"#")+e}=${t}`,"src"===e&&(o=o.replace(/#(?!src)(.*?)&(src=[^&]*)/,"#$2&$1"));o!==r&&((null===(n=this.history)||void 0===n?void 0:n.replaceState)?this.history.replaceState(null,"",o):this.location.href=o,this.storedUrl=o,this.saveViewSettings())}removeParameter(e,t){var i;const n=this.location.href;let r=n;const o=S(e);let s=o.exec(n);if(s&&t&&(s=o.exec(n)),s){for(;s;s=o.exec(r)){const e=s.index+s[0].length;r="#"==s[0].charAt(0)?r.substring(0,s.index+1)+r.substring(e+1):r.substring(0,s.index)+r.substring(e),o.lastIndex-=s[0].length}r=r.replace(/^(.*?)[#&]$/,"$1")}r!==n&&((null===(i=this.history)||void 0===i?void 0:i.replaceState)?this.history.replaceState(null,"",r):this.location.href=r,this.storedUrl=r,this.saveViewSettings())}enableRestoreView(e){const t=this.generateLocalStorageKey();if(e)this.localStorageKey=t;else{this.localStorageKey=null;try{window.localStorage.removeItem(t)}catch(e){}}}isEnabledRestoreView(){return!!this.localStorageKey}saveViewSettings(){if(this.localStorageKey){this.hasParameter("f")||this.setParameter("f","epubcfi()");try{window.localStorage.setItem(this.localStorageKey,this.location.hash)}catch(e){}}}generateLocalStorageKey(){const e=this.getParameter("src").join();return e?"view@"+e:null}restoreViewSettings(){const e=this.generateLocalStorageKey();if(e)try{const t=window.localStorage.getItem(e);if(t)return this.location.hash=t,!0}catch(e){}return!1}};class k{constructor(e){var t;const i=function(){const e=C.getParameter("src"),t=C.getParameter("b"),i=C.getParameter("x"),n=C.getParameter("bookMode")[0],r=C.getParameter("f")[0],o=C.getParameter("style"),s=C.getParameter("userStyle");return{srcUrls:e.length?e:t.length?t:i.length?i:null,bookMode:"true"===n||"false"!==n&&(!!t.length||!i.length&&!(e.length>1)&&null),fragment:r||null,authorStyleSheet:o.length?o:[],userStyleSheet:s.length?s:[]}}();this.srcUrls=a.observable(i.srcUrls||null),this.bookMode=a.observable(null!==(t=i.bookMode)&&void 0!==t?t:e),this.fragment=a.observable(i.fragment||""),this.authorStyleSheet=a.observable(i.authorStyleSheet),this.userStyleSheet=a.observable(i.userStyleSheet),this.pageStyle=new w,this.dataCustomStyleIndex=-1,this.bookMode.subscribe(t=>{t===e?C.removeParameter("bookMode"):C.setParameter("bookMode",t.toString())}),this.fragment.subscribe(e=>{if(/^epubcfi\(\/([246]\/)?2!\)/.test(e)&&!C.isEnabledRestoreView())C.removeParameter("f");else{const t=e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent);C.setParameter("f",t)}});const n=(e,t)=>{if(/^data:,.*?\/\*(?:<|%3C)viewer(?:>|%3E)\*\//.test(e)){this.dataCustomStyleIndex=t;const i=e.replace(/^data:,/,"").replace(/%(?![0-9A-Fa-f]{2})/g,"%25"),n=decodeURIComponent(i);return this.pageStyle.cssText(n),!0}return!1};i.authorStyleSheet.find(n)||i.userStyleSheet.find(n)&&this.pageStyle.customStyleAsUserStyle(!0),this.pageStyle.cssText.subscribe(e=>{this.updateCustomStyleSheetFromCSSText(e)})}toObject(){function e(e){return e.map(e=>({url:e}))}return{fragment:this.fragment(),authorStyleSheet:e(this.authorStyleSheet()),userStyleSheet:e(this.userStyleSheet())}}updateCustomStyleSheetFromCSSText(e){null==e&&(e=this.pageStyle.toCSSText());const t=this.pageStyle.customStyleAsUserStyle(),i=t?"userStyle":"style",n=t?this.userStyleSheet:this.authorStyleSheet,r=n();if((!e||/^\s*(\/\*([^*]|\*(?!\/))*\*\/\s*)*$/.test(e))&&r.length<=(-1==this.dataCustomStyleIndex?0:1))return r.pop(),this.dataCustomStyleIndex=-1,n(r),void C.removeParameter(i);const o="data:,"+x.percentEncodeForDataURI(e.trim());-1==this.dataCustomStyleIndex?(r.push(o),this.dataCustomStyleIndex=r.length-1):r[this.dataCustomStyleIndex]=o,n(r),C.setParameter(i,o,this.dataCustomStyleIndex)}switchCustomStyleUserOrAuthorStyleSheets(){const e=this.pageStyle.customStyleAsUserStyle();if(-1!==this.dataCustomStyleIndex){const[t,i]=e?["style","userStyle"]:["userStyle","style"],[n,r]=e?[this.authorStyleSheet,this.userStyleSheet]:[this.userStyleSheet,this.authorStyleSheet],o=n(),s=r(),a=o[this.dataCustomStyleIndex];a&&(o.splice(this.dataCustomStyleIndex,1),s.push(a),this.dataCustomStyleIndex=s.length-1,n(o),r(s),C.removeParameter(t),C.removeParameter(i),o.forEach((e,i)=>{C.setParameter(t,e,i)}),s.forEach((e,t)=>{C.setParameter(i,e,t)}))}}}class E{toSpreadViewString(){switch(this){case P.SPREAD:return"true";case P.SINGLE_PAGE:return"false";case P.AUTO_SPREAD:return"auto";default:throw new Error("Invalid PageViewMode")}}toString(){switch(this){case P.SPREAD:return"spread";case P.SINGLE_PAGE:return"singlePage";case P.AUTO_SPREAD:return"autoSpread";default:throw new Error("Invalid PageViewMode")}}}const P={AUTO_SPREAD:new E,SINGLE_PAGE:new E,SPREAD:new E,defaultMode(){return this.AUTO_SPREAD},fromSpreadViewString(e){switch(e){case"true":return this.SPREAD;case"false":return this.SINGLE_PAGE;default:return this.AUTO_SPREAD}},of(e){switch(e){case m.PageViewMode.SPREAD:return this.SPREAD;case m.PageViewMode.SINGLE_PAGE:return this.SINGLE_PAGE;case m.PageViewMode.AUTO_SPREAD:return this.AUTO_SPREAD;default:throw new Error(`Invalid PageViewMode name: ${e}`)}}};class N{constructor(e){this.zoom=e}get fitToScreen(){return null}getCurrentZoomFactor(e){return 1}toggleFitToScreen(){return new N(1)}zoomIn(e){return new I(1.25*this.getCurrentZoomFactor(e))}zoomOut(e){return new I(.8*this.getCurrentZoomFactor(e))}zoomToActualSize(){return new I(1)}static createDefaultOptions(){return new T}static createFromZoomFactor(e){return new I(e)}}class T extends N{constructor(){super(1)}get fitToScreen(){return!0}toggleFitToScreen(){return new I(1)}getCurrentZoomFactor(e){return e.queryZoomFactor(m.ZoomType.FIT_INSIDE_VIEWPORT)}}class I extends N{get fitToScreen(){return!1}toggleFitToScreen(){return new T}getCurrentZoomFactor(){return this.zoom}}function A(){return{allowScripts:!0,renderAllPages:!0,fontSize:16,profile:!1,pageViewMode:P.defaultMode(),zoom:N.createDefaultOptions(),pixelRatio:8,enableMarker:!1}}function _(e){return e.toPrecision(10).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")}class R{constructor(e){var t,i,n;const r="boolean"==typeof e?e:void 0,o="object"==typeof e?e:void 0;if(this.allowScripts=a.observable(),this.renderAllPages=a.observable(),this.fontSize=a.observable(),this.profile=a.observable(),this.pageViewMode=a.observable(),this.zoom=a.observable(),this.pixelRatio=a.observable(),this.enableMarker=a.observable(),o)this.copyFrom(o);else{const e=A(),o=function(){const e=C.getParameter("allowScripts")[0],t=C.getParameter("renderAllPages")[0],i=C.getParameter("fontSize")[0],n=C.getParameter("enableMarker")[0],r=/^([\d.]+)(?:(%25|%)|\/([\d.]+))?$/.exec(i);let o=null;if(r){const[,e,t,i]=r;o=parseFloat(e),(t||i)&&(o=16*o/(t?100:parseFloat(i))),o<5&&(o=5),o>72&&(o=72)}const s=C.getParameter("zoom")[0],a=parseFloat(s),l=C.getParameter("pixelRatio")[0],h=l&&parseFloat(l);return{allowScripts:"true"===e||"false"!==e&&null,renderAllPages:"true"===t||"false"!==t&&!C.hasParameter("b")&&null,fontSize:o,profile:"true"===C.getParameter("profile")[0],pageViewMode:P.fromSpreadViewString(C.getParameter("spread")[0]),zoom:a>0?N.createFromZoomFactor(a):N.createDefaultOptions(),pixelRatio:h,enableMarker:"true"===n||"false"!==n&&null}}();this.allowScripts(null!==(t=o.allowScripts)&&void 0!==t?t:e.allowScripts),this.renderAllPages(null!==(i=o.renderAllPages)&&void 0!==i?i:r),this.fontSize(o.fontSize||e.fontSize),this.profile(o.profile||e.profile),this.pageViewMode(o.pageViewMode||e.pageViewMode),this.zoom(o.zoom||e.zoom),this.pixelRatio(null!==(n=o.pixelRatio)&&void 0!==n?n:e.pixelRatio),this.enableMarker(o.enableMarker||e.enableMarker),this.pageViewMode.subscribe(t=>{t===e.pageViewMode?C.removeParameter("spread"):C.setParameter("spread",t.toSpreadViewString())}),this.renderAllPages.subscribe(e=>{e===r?C.removeParameter("renderAllPages"):C.setParameter("renderAllPages",e.toString())}),this.fontSize.subscribe(t=>{"number"==typeof t&&(t=_(t)),Number(t)==e.fontSize?C.removeParameter("fontSize"):C.setParameter("fontSize",`${t}/${e.fontSize}`)}),this.zoom.subscribe(e=>{e.fitToScreen?C.removeParameter("zoom"):C.setParameter("zoom",_(e.getCurrentZoomFactor()))}),this.enableMarker.subscribe(e=>{e?C.setParameter("enableMarker","true"):C.removeParameter("enableMarker")})}}copyFrom(e){this.allowScripts(e.allowScripts()),this.renderAllPages(e.renderAllPages()),this.fontSize(e.fontSize()),this.profile(e.profile()),this.pageViewMode(e.pageViewMode()),this.zoom(e.zoom()),this.pixelRatio(e.pixelRatio()),this.enableMarker(e.enableMarker())}toObject(){return{allowScripts:this.allowScripts(),renderAllPages:this.renderAllPages(),fontSize:Number(this.fontSize()),pageViewMode:this.pageViewMode().toString(),fitToScreen:this.zoom().fitToScreen,zoom:this.zoom().zoom,pixelRatio:this.pixelRatio()}}}R.getDefaultValues=A;var L,F=a.observableArray();!function(e){e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(L||(L={}));class O{static getLogger(){return new O}constructor(){this.logLevel=L.Error}setLogLevel(e){this.logLevel=e}debug(e){this.logLevel===L.Debug&&F.push({type:"debug",content:e})}info(e){this.logLevel!==L.Debug&&this.logLevel!==L.Info||F.push({type:"info",content:e})}warn(e){this.logLevel!==L.Debug&&this.logLevel!==L.Info&&this.logLevel!==L.Warn||F.push({type:"warn",content:e})}error(e){var t;if(this.logLevel===L.Debug||this.logLevel===L.Info||this.logLevel===L.Warn||this.logLevel===L.Error){if(null===(t=null==e?void 0:e.error)||void 0===t?void 0:t.toString().includes("history.replaceState()"))return;F.push({type:"error",content:e})}}}const B={readonlyObservable(e){const t=a.observable(e);return{getter:a.pureComputed(()=>t()),value:t}}};class M{constructor(e,t){this.viewerOptions=t,this.documentOptions=null,this.coreViewer=new m.CoreViewer(e,t.toObject());const i=this.privState={status:B.readonlyObservable(m.ReadyState.LOADING),pageProgression:B.readonlyObservable(m.PageProgression.LTR)};this.state={status:i.status.getter.extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"},notify:"always"}),navigatable:a.pureComputed(()=>i.status.value()&&i.status.value()!==m.ReadyState.LOADING),fixedLayout:a.observable(),pageProgression:i.pageProgression.getter},this.epage=a.observable(),this.epageCount=a.observable(),this.firstPage=a.observable(),this.lastPage=a.observable(),this.tocVisible=a.observable(),this.tocPinned=a.observable(),this.inputUrl=a.observable(""),this.rerenderTrigger=a.observable(!1),this.setupViewerEventHandler(),this.setupViewerOptionSubscriptions(),window.coreViewer=this.coreViewer}setupViewerEventHandler(){const e=O.getLogger();this.coreViewer.addListener("debug",t=>{e.debug(t.content)}),this.coreViewer.addListener("info",t=>{e.info(t.content)}),this.coreViewer.addListener("warn",t=>{e.warn(t.content)}),this.coreViewer.addListener("error",t=>{e.error(t.content)}),this.coreViewer.addListener("readystatechange",()=>{const e=this.coreViewer.readyState;e!==m.ReadyState.INTERACTIVE&&e!==m.ReadyState.COMPLETE||this.privState.pageProgression.value(this.coreViewer.getCurrentPageProgression()),this.privState.status.value(e)}),this.coreViewer.addListener("loaded",()=>{this.viewerOptions.profile()&&m.profiler.printTimings(),this.rerenderTrigger(!this.rerenderTrigger())});let t=0;this.coreViewer.addListener("nav",e=>{var i,n,r,o;const{cfi:s,first:a,last:l,epage:h,epageCount:u,metadata:c,docTitle:d}=e;if(this.rerenderTrigger(!this.rerenderTrigger()),s&&(t&&window.clearTimeout(t),t=window.setTimeout(()=>{this.documentOptions.fragment(s),t=0},300)),void 0!==h&&this.epage(h),void 0!==u&&this.epageCount(u),void 0!==a&&this.firstPage(a),void 0!==l&&this.lastPage(l),c||d){let e=document.title;const t=null===(n=null===(i=null==c?void 0:c["http://purl.org/dc/terms/title"])||void 0===i?void 0:i[0])||void 0===n?void 0:n.v;e=t?!d||d===t||this.firstPage()||/\.xhtml$/.test(d)?t:`${d} | ${t}`:d||"Vivliostyle Viewer",e!==document.title&&(document.title=e);const s=null===(o=null===(r=null==c?void 0:c["http://www.idpf.org/vocab/rendition/#layout"])||void 0===r?void 0:r[0])||void 0===o?void 0:o.v;s&&this.state.fixedLayout("pre-paginated"===s)}const p=this.tocVisible(),f=this.coreViewer.isTOCVisible();p&&!f||this.tocVisible(f)}),this.coreViewer.addListener("hyperlink",e=>{e.internal?(window.history.pushState(null,null),this.navigateToInternalUrl(e.href),this.tocVisible()&&this.tocVisible(!1),document.getElementById("vivliostyle-viewer-viewport").focus()):window.location.href=e.href})}setupViewerOptionSubscriptions(){a.computed(()=>{const e=this.viewerOptions.toObject();this.coreViewer.setOptions(e)}).extend({rateLimit:0})}loadDocument(e,t){this.privState.status.value(m.ReadyState.LOADING),t&&this.viewerOptions.copyFrom(t),this.documentOptions=e,e.srcUrls()?e.bookMode()?this.coreViewer.loadPublication(e.srcUrls()[0],e.toObject(),this.viewerOptions.toObject()):this.coreViewer.loadDocument(e.srcUrls(),e.toObject(),this.viewerOptions.toObject()):this.privState.status.value(void 0)}navigateToPrevious(){this.coreViewer.navigateToPage(m.Navigation.PREVIOUS)}navigateToNext(){this.coreViewer.navigateToPage(m.Navigation.NEXT)}navigateToLeft(){this.coreViewer.navigateToPage(m.Navigation.LEFT)}navigateToRight(){this.coreViewer.navigateToPage(m.Navigation.RIGHT)}navigateToFirst(){this.coreViewer.navigateToPage(m.Navigation.FIRST)}navigateToLast(){this.coreViewer.navigateToPage(m.Navigation.LAST)}navigateToEPage(e){this.coreViewer.navigateToPage(m.Navigation.EPAGE,e)}navigateToInternalUrl(e){this.coreViewer.navigateToInternalUrl(e)}navigateToPosition(e){this.coreViewer.navigateToPosition(e)}queryZoomFactor(e){return this.coreViewer.queryZoomFactor(e)}epageToPageNumber(e){if(!e&&0!=e)return;return Math.round(e+1)}epageFromPageNumber(e){if(!e&&0!=e)return;return e-1}showTOC(e,t){if(null==this.coreViewer.isTOCVisible())return;const i=null==e?!this.tocVisible():e;this.tocVisible(i),this.tocPinned(!!i&&!t),this.coreViewer.showTOC(i,t)}}const z={Unidentified:"Unidentified",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",Home:"Home",End:"End",PageDown:"PageDown",PageUp:"PageUp",Escape:"Escape",Enter:"Enter",Space:" "};var D={Keys:z,identifyKeyFromEvent:function(e){const t=e.key,i=e.keyIdentifier,n=e.location;return t===z.ArrowDown||"Down"===t||"Down"===i?e.metaKey?z.End:z.ArrowDown:t===z.ArrowLeft||"Left"===t||"Left"===i?z.ArrowLeft:t===z.ArrowRight||"Right"===t||"Right"===i?z.ArrowRight:t===z.ArrowUp||"Up"===t||"Up"===i?e.metaKey?z.Home:z.ArrowUp:t===z.Escape||"Esc"===t||"U+001B"===i?z.Escape:t===z.Enter||"Enter"===i?z.Enter:t===z.Space||"U+0020"===i?z.Space:"0"===t||"U+0030"===i?"0":"+"===t||"Add"===t||"U+002B"===i||"U+00BB"===i||"U+004B"===i&&n===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"+":"-"===t||"Subtract"===t||"U+002D"===i||"U+00BD"===i||"U+004D"===i&&n===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"-":t||i||z.Unidentified}};const V=(e,t)=>{let i=e.x-t.x,n=e.y-t.y,r=e.width,o=e.height;const s=document.getElementById("vivliostyle-viewer-viewport").style,a=parseFloat(s.getPropertyValue("--viv-outputScale")||"1");return a&&!isNaN(a)&&(i/=a,n/=a,r/=a,o/=a),new DOMRect(i,n,r,o)},U=p.i18n.t.bind(p.i18n),H=e=>{switch(e){case"red":return"rgba(255,0, 0,0.2)";case"green":return"rgba(0,255,0,0.2)";case"yellow":return"rgba(255,217,0,0.3)";default:return""}},$=e=>{if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}},j=e=>{let t;return t=1==e.nodeType?e:e.parentElement,!!t.closest("[data-adapt-eloff]")},W=e=>!!e.parentElement.closest("rt,[data-adapt-spec]"),G=(e,t)=>{const i=[];for(let n=e.node;n;n=$(n)){if(3==n.nodeType&&!W(n)&&j(n)){const r=n;if(r.data.trim().length>0){const o=n==e.node?e.offset:0,s=n==t.node?t.offset:r.data.length;s>o&&i.push({t:r,startOffset:o,endOffset:s})}}if(n==t.node)break}return i},q=e=>{const t=document.createRange();return t.setStart(e.t,e.startOffset),t.setEnd(e.t,e.endOffset),[...t.getClientRects()]},X=(e,t)=>!!t.querySelector(`[${ne.idAttr}="${e}"]`),Y=(e,t)=>{t.background&&(e.style.background=t.background)},K=(e,t,i,n)=>{const r=e.node.parentElement.closest("[data-vivliostyle-page-container='true']"),o=t.node.parentElement.closest("[data-vivliostyle-page-container='true']");if(n&&X(n.uniqueIdentifier,r)&&X(n.uniqueIdentifier,o))return"";const s=G(e,t),a=(null==n?void 0:n.uniqueIdentifier)||ne.notCreatedId,l=e=>{const t=e.clientX,i=e.clientY;pe.openEditMenu(t,i,a)};let h=0;const u=[];return s.forEach(e=>{u.push(e.t.data.slice(e.startOffset,e.endOffset));const t=e.t.parentElement.closest("[data-vivliostyle-page-container='true']"),n=t.getBoundingClientRect(),r=Z(t),o=J(t);for(const s of q(e)){const e=V(s,n),u=`${o}-${r}-${h++}`;if(document.querySelector(`[${ne.idAttr}='${a}'][data-mn='${u}']`))return;const c=document.createElement("div");c.style.position="absolute",c.style.margin="0",c.style.padding="0",c.style.top=`${e.top}px`,c.style.left=`${e.left}px`,c.style.width=`${e.width}px`,c.style.height=`${e.height}px`,Y(c,i),c.setAttribute(ne.idAttr,a),c.setAttribute("data-mn",`${u}`),c.addEventListener("click",l),t.appendChild(c)}}),u.join("")},Z=e=>{const t=parseInt(e.getAttribute("data-vivliostyle-page-index"));return isNaN(t)?-1:t},J=e=>{const t=parseInt(e.getAttribute("data-vivliostyle-spine-index"));return isNaN(t)?-1:t},Q=(e,t)=>{const i=e.parentElement.closest("[data-vivliostyle-page-container]"),n=J(i),r=e.parentElement.closest("[data-adapt-eloff]"),o=[];let s=e;for(;s&&s!==r;)o.unshift(s),s=s.parentElement;const a=parseInt(r.getAttribute("data-adapt-eloff"));let l=a+t;const h=te(n,a);let u=0,c=-1,d=0;for(const e of h.values()){if(e==r)break;const t=[...e.childNodes].filter(e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec")));let i=t.length;if(i>0){l+=t.map(e=>e.textContent.length).reduce((e,t)=>e+t),3==t[0].nodeType&&3==c&&(i-=1);const e=t[t.length-1];c=e.nodeType,3==c?d+=e.data.length:d=0}u+=i}const p=[...r.childNodes].filter(e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec"))),f=p.indexOf(o[0]);f>0&&(l+=p.map((e,t)=>t<f?e.textContent.length:0).reduce((e,t)=>e+t));const g=[];if(0==f&&3==o[0].nodeType&&3==c)t+=d,o.length>1&&console.warn("should not reach here; nodePath[0] is text and nodePath is deeper"),g.push(u-1);else{u+=f+1,3==c&&3==p[0].nodeType&&u--,g.push(u-1);let e=0;for(;e<o.length-1;){const t=[...o[e].childNodes].indexOf(o[e+1]);g.push(t),e++}}return new ie(n,a,g,t,l)},ee=e=>{const t=te(e.spineIndex,e.eloff);let i,n=0,r=-1,o=0;for(const s of t.values()){const t=[...s.childNodes].filter(e=>!(1==e.nodeType&&e.hasAttribute("data-adapt-spec"))),a=t.length;if(a>0){3==t[0].nodeType&&3==r&&n--;const s=n+a;if(s>e.nodePath[0])if(n==e.nodePath[0]&&3==t[0].nodeType){const n=t[0];if(o<=e.offset&&e.offset<=o+n.data.length){i=n;break}}else{if(s!=e.nodePath[0]+1||3!=t[t.length-1].nodeType){let r=t[e.nodePath[0]-n];for(let t=1;t<e.nodePath.length;t++)r.childNodes&&r.childNodes.length>e.nodePath[t]&&(r=r.childNodes[e.nodePath[t]]);i=r,o=0;break}{const n=t[t.length-1];if(e.offset<=n.data.length){i=n,o=0;break}}}const l=t[t.length-1];r=l.nodeType,3==r?o+=l.data.length:o=0}n+=a}return i?{node:i,offset:e.offset-o}:null},te=(e,t)=>{const i=`[data-vivliostyle-spine-index='${e}'] [data-adapt-eloff='${t}']`;return Array.from(document.querySelectorAll(i)).filter(e=>!e.querySelector(i))};class ie{constructor(e,t,i,n,r){this.spineIndex=e,this.eloff=t,this.nodePath=i,this.offset=n,this.offsetInItem=r}toString(){return`${this.spineIndex}-${this.eloff}-${this.nodePath.join("/")}-${this.offset}-${this.offsetInItem}`}static fromString(e){const[t,i,n,r,o]=e.split("-").map(e=>e.trim()),s=n.split("/").map(e=>parseInt(e));return new ie(parseInt(t),parseInt(i),s,parseInt(r),parseInt(o))}}class ne{constructor(e,t,i,n,r){this.start=e,this.end=t,this.color=i,this.memo=n,this.markedText=r,this.uniqueIdentifier=ne.notCreatedId}markInfoString(){return`${this.start},${this.end},${this.color}`}toMarkJson(){return{mark:this.markInfoString(),id:this.uniqueIdentifier,memo:this.memo,markedText:this.markedText}}isPersisted(){return this.uniqueIdentifier&&this.uniqueIdentifier!=ne.notCreatedId}static fromMarkInfoString(e){const[t,i,n]=e.split(","),r=ie.fromString(t),o=ie.fromString(i);return new ne(r,o,n,"","")}static fromMarkJson(e){const t=ne.fromMarkInfoString(e.mark);return t.uniqueIdentifier=e.id,t.memo=e.memo,t.markedText=e.markedText,t}}ne.idAttr="data-viv-marker-id",ne.notCreatedId="not-created";const re=e=>{pe.openStartButton(e)};class oe{currentId(){return""}deletable(){return!1}cancellable(){return!1}applyEditing(){}colorChanged(){}deleteCurrentEditing(){}close(){}}class se{constructor(){this.start=(e,t)=>{this.currentStart=e,this.currentEnd=t;const i=ee(this.currentStart),n=ee(this.currentEnd);if(i&&n){const e=H(pe.currentEditingColor());return this.currentText=K(i,n,{background:e}),!0}return!1},this.deletable=()=>!1,this.cancellable=()=>!0,this.deleteCurrentEditing=async()=>{},this.currentId=()=>ne.notCreatedId,this.applyEditing=async()=>{if(this.currentStart&&this.currentEnd){const e=new ne(this.currentStart,this.currentEnd,pe.currentEditingColor(),pe.currentEditingMemo(),this.currentText);await de.persistMark(e)}pe.closeMenu()},this.colorChanged=async()=>{0==this.cancellable()&&this.applyEditing()},this.close=async()=>{document.querySelectorAll(`[${ne.idAttr}="${ne.notCreatedId}"]`).forEach(e=>{e.remove()})}}}class ae{constructor(){this.deletable=()=>!0,this.cancellable=()=>!0,this.deleteCurrentEditing=async()=>{this.currentEditing&&await de.removeMark(this.currentEditing)},this.currentId=()=>{var e;return null===(e=this.currentEditing)||void 0===e?void 0:e.uniqueIdentifier},this.applyEditing=async()=>{this.currentEditing&&(pe.currentEditingColor()==this.currentEditing.color&&pe.currentEditingMemo()==this.currentEditing.memo||(this.currentEditing.color=pe.currentEditingColor(),this.currentEditing.memo=pe.currentEditingMemo(),de.updateMark(this.currentEditing))),pe.closeMenu()},this.colorChanged=async()=>{},this.close=async()=>{if(this.currentEditing){const e=H(this.currentEditing.color);e.length>0&&document.querySelectorAll(`[${ne.idAttr}="${this.currentEditing.uniqueIdentifier}"]`).forEach(t=>{t.style.background=e}),this.currentEditing=void 0}}}}class le{constructor(e){this.parent=e,this.editingColorChanged=async e=>{if(!de.enabled())return;const t=this.markAction().currentId(),i=H(e);i.length>0&&document.querySelectorAll(`[${ne.idAttr}="${t}"]`).forEach(e=>{e.style.background=i}),await this.markAction().colorChanged()},this.openMenu=(e,t)=>{if(this.menuOpened())return;const i=document.getElementById("vivliostyle-text-selection-edit-menu");i&&(i.style.top=`${t}px`,i.style.left=`${e}px`);const n=this.menuOpened.subscribe(t=>{if(t){const t=document.getElementById("vivliostyle-text-selection-edit-menu"),i=document.querySelector("[data-vivliostyle-outer-zoom-box]");if(t&&i){const n=t.getBoundingClientRect(),r=i.getBoundingClientRect();let o=e-n.width;o+n.width>r.right&&(o=r.right-n.width-10),o<r.left&&(o=r.left),t.style.left=`${o}px`,n.bottom>r.bottom&&(t.style.top=r.bottom-n.height-10+"px")}}n.dispose()});this.startButtonOpened(!1),this.menuOpened(!0)},this.closeStartButton=()=>{de.enabled()&&this.startButtonOpened(!1)},this.openEditMenu=async(e,t,i)=>{if(!de.enabled())return;const n=await this.parent.getMark(i);this.currentEditingColor(n.color),this.currentEditingMemo(n.memo),this.editAction.currentEditing=n,this.markAction(this.editAction),this.openMenu(e,t)},this.closeMenu=async()=>{de.enabled()&&(await this.markAction().close(),this.markAction(this.emptyAction),this.menuOpened(!1))},this.applyEditing=async()=>{de.enabled()&&await this.markAction().applyEditing()},this.deleteCurrentEditing=async()=>{de.enabled()&&(confirm(U("CONFIRM_DELETE"))&&await this.markAction().deleteCurrentEditing(),await this.closeMenu())},this.openSelectionMenu=(e,t,i,n,r)=>{de.enabled()&&(this.currentEditingColor("yellow"),this.currentEditingMemo(""),this.newMarkAction.start(i,n)&&(r.empty(),this.markAction(this.newMarkAction),this.openMenu(e,t)))},this.openStartButton=async e=>{if(de.enabled()&&"Range"==e.type){const t=e.getRangeAt(0);if(!t.commonAncestorContainer.parentElement.closest("[data-vivliostyle-outer-zoom-box]"))return;const i=document.getElementById("vivliostyle-text-selection-start-button"),n={node:t.startContainer,offset:t.startOffset},r={node:t.endContainer,offset:t.endOffset},o=G(n,r);if(0==o.length)return;const s=o.reduce((e,t)=>e.concat(q(t)),[]);if(0==s.length)return;const a=Q(o[0].t,o[0].startOffset),l=Q(o[o.length-1].t,o[o.length-1].endOffset),h=s[s.length-1].left,u=s[s.length-1].bottom,c=t=>{t.stopPropagation(),i&&i.removeEventListener("click",c),this.openSelectionMenu(h,u,a,l,e)};i&&(i.style.top=`${u}px`,i.style.left=`${h}px`,i.addEventListener("click",c));const d=this.startButtonOpened.subscribe(e=>{if(e){const e=document.querySelector("[data-vivliostyle-outer-zoom-box]");if(i&&e){const t=i.getBoundingClientRect(),n=e.getBoundingClientRect();let r=h-t.width;r+t.width>n.right&&(r=n.right-t.width-10),r<n.left&&(r=n.left),i.style.left=`${r}px`,t.bottom>n.bottom&&(i.style.top=n.bottom-t.height-10+"px")}}else i.removeEventListener("click",c),d.dispose()});this.startButtonOpened(!0)}},this.menuOpened=a.observable(!1),this.startButtonOpened=a.observable(!1),this.currentEditingColor=a.observable(""),this.currentEditingMemo=a.observable(""),this.currentEditingColor.subscribe(this.editingColorChanged),this.editAction=new ae,this.newMarkAction=new se,this.emptyAction=new oe,this.markAction=a.observable(this.emptyAction),this.deletable=a.pureComputed(()=>this.markAction().deletable()).extend({notify:"always"}),this.cancellable=a.pureComputed(()=>this.markAction().cancellable()).extend({notify:"always"})}init(){const e=document.getElementById("vivliostyle-text-selection-edit-menu");let t=0,i=0;const n=n=>{const r=n.clientX-t,o=n.clientY-i;t=n.clientX,i=n.clientY,e.style.top=`${e.offsetTop+o}px`,e.style.left=`${e.offsetLeft+r}px`};e.addEventListener("mousedown",e=>{"vivliostyle-memo-edit-area"!==e.target.id&&(t=e.clientX,i=e.clientY,document.addEventListener("mousemove",n),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",n)}))})}}let he=0;class ue{constructor(){this.markArray=[],this.documentId="",this.markKeyToArrayIndex=new Map}async init(e){C.getParameter("mark").forEach(e=>{const t=this.urlStringToMark(e);this.pushMarkInternal(t,"doNotAddToUrl","persist")}),this.documentId=e}async persistMark(e){return this.pushMarkInternal(e,"addToUrl","persist")}async updateMark(e){await this.removeMark(e),this.pushMarkInternal(e,"addToUrl","doNotPersist")}async getMark(e){const t=this.markKeyToArrayIndex.get(e);return this.markArray[t]}async removeMark(e){const t=this.markKeyToArrayIndex.get(e.id);this.markArray.splice(t,1),this.markRemoved()}async allMarks(){return this.markArray}async allMarksIterator(){const e=this.markArray;return async function*(){let t=0;for(;t<e.length;){const i=e[t++];yield i}}()}markToURLString(e){const t=e.memo?encodeURIComponent(e.memo):"",i=e.markedText?encodeURIComponent(e.markedText):"";return`${e.mark}%1F${t}%1F${i}`}urlStringToMark(e){const[t,i,n]=e.split("%1F",3);return{mark:t,id:"",memo:i?decodeURIComponent(i):"",markedText:n?decodeURIComponent(n):""}}pushMarkInternal(e,t,i){if("persist"==i&&(e.id=""+he++),this.markArray.push(e),this.markKeyToArrayIndex.set(e.id,this.markArray.length-1),"addToUrl"==t){const t=C.getParameter("mark").length;C.setParameter("mark",this.markToURLString(e),t)}return e.id}async markRemoved(){this.markKeyToArrayIndex.clear(),C.removeParameter("mark"),this.markArray.forEach((e,t)=>{C.setParameter("mark",this.markToURLString(e),t),this.markKeyToArrayIndex.set(e.id,t)})}}class ce{constructor(e){this.parent=e,this.removeAllMarks=async()=>{if(confirm(U("CONFIRM_REMOVE_ALL"))){const e=this.list.removeAll();for(const t of e)await this.parent.removeMark(t)}},this.removeOneMark=async e=>{confirm(U("CONFIRM_REMOVE"))&&await this.parent.removeMark(e)},this.updateActualMark=async e=>{this.parent.actualStore.updateMark(e.toMarkJson())},this.navigateToMark=e=>{const{spineIndex:t,offsetInItem:i}=e.start;window.history.pushState(null,null),this.parent.viewer.navigateToPosition({spineIndex:t,offsetInItem:i}),this.pinned()||(this.detailsElement.open=!1)},this.hasMarks=()=>this.list().length>0&&this.parent.enabled(),this.pinned=a.observable(!1),this.list=a.observableArray()}init(){this.detailsElement=document.getElementById("vivliostyle-marks-box")}addMarkToList(e){let t=-1;const i=this.list();for(let n=0;n<i.length;n++){const r=i[n];if(r.uniqueIdentifier===e.uniqueIdentifier)return void this.list.replace(r,e);if(r.start.spineIndex===e.start.spineIndex){if(r.start.offsetInItem>e.start.offsetInItem){t=n;break}}else if(r.start.spineIndex>e.start.spineIndex){t=n;break}}-1===t&&(t=i.length),this.list.splice(t,0,e)}removeMarkFromList(e){this.list.remove(t=>t.uniqueIdentifier===e.uniqueIdentifier)}}const de=new class{constructor(){this.menuStatus=new le(this),this.marksBox=new ce(this),this.initialized=!1,this.justClicked=!1}enabled(){return this.initialized&&this.viewerOptions.enableMarker()}async init(e,t){if(e&&(this.viewerOptions=e),t&&(this.viewer=t),!this.viewerOptions||!this.viewerOptions.enableMarker())return;this.menuStatus.init(),this.marksBox.init(),window.marksStorePlugin?this.actualStore=window.marksStorePlugin:this.actualStore=new ue;const i=C.getParameter("src").join();await this.actualStore.init(i),this.initialized=!0}async toggleEnableMarker(){this.enabled()?this.justClicked?(this.justClicked=!1,this.marksBox.pinned(!0),this.marksBox.detailsElement.open=!0):(document.querySelectorAll(`[${ne.idAttr}]`).forEach(e=>{e.remove()}),this.menuStatus.startButtonOpened()&&this.menuStatus.closeStartButton(),this.menuStatus.menuOpened()&&this.menuStatus.closeMenu(),this.viewerOptions.enableMarker(!1),this.justClicked=!0,window.setTimeout(()=>{this.justClicked=!1},300)):(this.viewerOptions.enableMarker(!0),this.justClicked?(this.justClicked=!1,this.marksBox.pinned(!0),this.marksBox.detailsElement.open=!0):(this.marksBox.pinned(!1),this.justClicked=!0,window.setTimeout(()=>{this.marksBox.detailsElement.firstElementChild.focus(),this.justClicked=!1},300)),this.initialized||await this.init(),await this.retryHighlightMarks())}async persistMark(e){if(!this.initialized)return;const t=await this.actualStore.persistMark(e.toMarkJson());e.uniqueIdentifier=t,this.highlightMark(e)}async updateMark(e){this.initialized&&(this.unhighlightMark(e),this.highlightMark(e),this.actualStore.updateMark(e.toMarkJson()))}async getMark(e){if(this.initialized)return ne.fromMarkJson(await this.actualStore.getMark(e))}async removeMark(e){this.initialized&&(this.unhighlightMark(e),await this.actualStore.removeMark(e.toMarkJson()))}async retryHighlightMarks(){if(this.enabled())if(this.actualStore.allMarksIterator){const e=await this.actualStore.allMarksIterator();for await(const t of e)t&&this.highlightMark(ne.fromMarkJson(t))}else for await(const e of await this.actualStore.allMarks())e&&this.highlightMark(ne.fromMarkJson(e))}unhighlightMark(e){document.querySelectorAll(`[${ne.idAttr}="${e.uniqueIdentifier}"]`).forEach(e=>{e.remove()}),this.marksBox.removeMarkFromList(e)}highlightMark(e,t=!1){if(!e.isPersisted&&!t)throw"mark is not persisted.";const i=ee(e.start);let n=ee(e.end);if(!i||n||this.viewerOptions.renderAllPages()||(console.log(),n=((e,t)=>{let i=e.node;for(let n=e.node;n;n=$(n)){if(1==n.nodeType){const e=n;if(e.hasAttribute("data-vivliostyle-outer-zoom-box"))break;if(e.hasAttribute("data-vivliostyle-page-container")&&J(e)>t.spineIndex)break}3==n.nodeType&&j(n)&&(i=n)}return{node:i,offset:i.data.length}})(i,e.end)),i&&n){const t=H(e.color);K(i,n,{background:t},e)}this.marksBox.addMarkToList(e)}},pe=de.menuStatus,{Keys:fe}=D;class ge{constructor(e,t,i,n){this.viewerOptions=e,this.viewer=t,this.settingsPanel=i,this.navigateToPrevious=()=>!this.isNavigateToPreviousDisabled()&&(this.viewer.navigateToPrevious(),!0),this.navigateToNext=()=>!this.isNavigateToNextDisabled()&&(this.viewer.navigateToNext(),!0),this.navigateToLeft=()=>!this.isNavigateToLeftDisabled()&&(this.viewer.navigateToLeft(),!0),this.navigateToRight=()=>!this.isNavigateToRightDisabled()&&(this.viewer.navigateToRight(),!0),this.navigateToFirst=()=>!this.isNavigateToFirstDisabled()&&(window.history.pushState(null,null),this.viewer.navigateToFirst(),!0),this.navigateToLast=()=>!this.isNavigateToLastDisabled()&&(window.history.pushState(null,null),this.viewer.navigateToLast(),!0),this.zoomIn=()=>{if(this.isZoomInDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomIn(this.viewer)),!0}},this.zoomOut=()=>{if(this.isZoomOutDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomOut(this.viewer)),!0}},this.zoomToActualSize=()=>{if(this.isZoomToActualSizeDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.zoomToActualSize()),!0}},this.toggleFitToScreen=()=>{if(this.isToggleFitToScreenDisabled())return!1;{const e=this.viewerOptions.zoom();return this.viewerOptions.zoom(e.toggleFitToScreen()),!0}},this.increaseFontSize=()=>{if(this.isIncreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions.fontSize());return e=e<10?Math.floor(e)+1:e<20?2*(Math.floor(e/2)+1):e<40?4*(Math.floor(e/4)+1):e<72?8*(Math.floor(e/8)+1):72,this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.decreaseFontSize=()=>{if(this.isDecreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions.fontSize());return e=e>40?8*(Math.ceil(e/8)-1):e>20?4*(Math.ceil(e/4)-1):e>10?2*(Math.ceil(e/2)-1):e>5?Math.ceil(e)-1:5,this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.defaultFontSize=()=>{if(this.isDefaultFontSizeDisabled())return!1;{const e=R.getDefaultValues().fontSize;return this.viewerOptions.fontSize(e),this.updateFontSizeSettings(),!0}},this.onfocusPageNumber=(e,t)=>{const i=t.currentTarget;return window.setTimeout(()=>{i.setSelectionRange(0,i.value.length)},0),!0},this.onmouseupPageSlider=(e,t)=>{if(this.viewerOptions.renderAllPages())return!0;const i=document.getElementById("vivliostyle-page-number"),n=Number(i.value),r=this.viewer.epageFromPageNumber(n);return this.viewer.navigateToEPage(r),!0},this.onwheelPageSlider=(e,t)=>(t.preventDefault(),this.justPageMovedByWheel||0===t.deltaMode&&Math.abs(t.deltaX)<4&&Math.abs(t.deltaY)<4||(Math.abs(t.deltaX)>=Math.abs(t.deltaY)?t.deltaX<0?this.navigateToLeft():this.navigateToRight():t.deltaY<0?this.navigateToPrevious():this.navigateToNext(),"vivliostyle-page-slider"!==t.currentTarget.id&&(this.justPageMovedByWheel=!0,window.setTimeout(()=>{this.justPageMovedByWheel=!1},166))),!0),this.onwheelViewport=(e,t)=>{const i=document.getElementById("vivliostyle-viewer-viewport");return!!(this.viewer.tocVisible()&&i!=document.activeElement||i.scrollWidth>i.clientWidth||i.scrollHeight>i.clientHeight)||this.onwheelPageSlider(e,t)},this.onclickViewport=(e,t)=>{if(this.pageNumber(),this.settingsPanel.justClicked)return!0;if(this.viewer.tocVisible()&&!this.viewer.tocPinned()){const e=document.querySelector("[data-vivliostyle-toc-box]");e&&!e.contains(document.activeElement)&&this.toggleTOC()}return this.settingsPanel.opened()&&!this.settingsPanel.pinned()&&this.settingsPanel.close(),de.enabled()&&de.marksBox.detailsElement.open&&!de.marksBox.pinned()&&(de.marksBox.detailsElement.open=!1),!0},this.toggleTOC=()=>{if(this.isTOCToggleDisabled())return!1;{let e=0;return this.viewer.tocVisible()?this.justClicked?(this.viewer.showTOC(!0,!1),this.justClicked=!1):(e&&(window.clearInterval(e),e=0),this.viewer.showTOC(!1),this.justClicked=!0,window.setTimeout(()=>{this.justClicked&&(document.getElementById("vivliostyle-viewer-viewport").focus(),this.justClicked=!1)},300)):(this.justClicked?(this.viewer.showTOC(!0,!1),this.justClicked=!1):(this.viewer.showTOC(!0,!0),this.justClicked=!0),e=window.setInterval(()=>{const t=document.querySelector("[data-vivliostyle-toc-box]");t&&"visible"===t.style.visibility&&(t.tabIndex=0,t.focus(),window.clearInterval(e),e=0),this.justClicked=!1},300)),!0}},this.navigateTOC=e=>{const t=Array.from(document.querySelectorAll("[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) [tabindex='0'],[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) a[href]:not([tabindex='-1'])"));let i=t.indexOf(document.activeElement);const n=e=>t[e]&&"button"===t[e].getAttribute("role"),r=e=>t[e]&&"true"===t[e].getAttribute("aria-expanded");switch(e){case fe.ArrowLeft:if(-1==i){i=t.length-1;break}if(!n(i)&&n(i-1)&&i--,n(i)&&r(i))t[i].click();else for(let e=i-1;e>=0;e--)if(n(e)&&t[e].parentElement.contains(t[i])){i=e;break}break;case fe.ArrowRight:if(-1==i){i=0;break}!n(i)&&n(i-1)&&i--,n(i)&&(r(i)?i+=2:t[i].click());break;case fe.ArrowDown:i++;break;case fe.ArrowUp:if(-1==i){i=t.length-1;break}i>0&&n(--i)&&i--;break;case fe.Home:i=0;break;case fe.End:i=t.length-1;break;case fe.Space:!n(i)&&n(i-1)&&i--,n(i)&&t[i].click()}return n(i)&&i++,t[i]&&t[i].focus(),!0},this.toggleMarker=()=>!this.isMarkerToggleDisabled()&&(de.toggleEnableMarker(),!0),this.handleKey=e=>{if(this.settingsPanel.opened()&&this.settingsPanel.settingsToggle.contains(document.activeElement))return!0;const t=document.getElementById("vivliostyle-page-number"),i=document.getElementById("vivliostyle-viewer-viewport"),n=i.scrollWidth>i.clientWidth,r=i.scrollHeight>i.clientHeight,o=t===document.activeElement,s=this.viewer.tocVisible()&&!o&&i!=document.activeElement;if(!s&&i!=document.activeElement&&i.contains(document.activeElement))return!0;switch(e){case"+":return o||!this.increaseFontSize();case"-":return o||!this.decreaseFontSize();case"0":return o||!this.defaultFontSize();case"1":return o||!this.zoomToActualSize();case fe.ArrowLeft:return s?!this.navigateTOC(e):o||n||!this.navigateToLeft();case fe.ArrowRight:return s?!this.navigateTOC(e):o||n||!this.navigateToRight();case fe.ArrowDown:return s?!this.navigateTOC(e):(i.focus(),r||!this.navigateToNext());case fe.ArrowUp:return s?!this.navigateTOC(e):(i.focus(),r||!this.navigateToPrevious());case fe.PageDown:return!!s||(i.focus(),!this.navigateToNext());case fe.PageUp:return!!s||(i.focus(),!this.navigateToPrevious());case fe.Home:return s?!this.navigateTOC(e):(i.focus(),!this.navigateToFirst());case fe.End:return s?!this.navigateTOC(e):(i.focus(),!this.navigateToLast());case"o":case"O":return i.focus(),!this.zoomOut();case"i":case"I":return i.focus(),!this.zoomIn();case"p":case"P":return i.focus(),!this.print();case"f":case"F":return i.focus(),!this.toggleFitToScreen();case"g":case"G":return t.focus(),!1;case"t":case"T":return i.focus(),!this.toggleTOC();case"m":case"M":return i.focus(),!this.toggleMarker();case fe.Escape:if(de.enabled()){if(de.menuStatus.startButtonOpened())return de.menuStatus.closeStartButton(),!1;if(de.menuStatus.menuOpened())return"vivliostyle-memo-edit-area"===document.activeElement.id||(de.menuStatus.closeMenu(),!1);if(de.marksBox.detailsElement.open)return de.marksBox.detailsElement.open=!1,!1}return this.viewer.tocVisible()?!this.toggleTOC():(i.focus(),!0);case fe.Space:return s?!this.navigateTOC(e):"button"!==document.activeElement.getAttribute("role")||(document.activeElement.click(),!1);default:return!0}},this.print=()=>!this.isPrintDisabled()&&(window.print(),!0),this.justClicked=!1,this.justPageMovedByWheel=!1,this.isDisabled=a.pureComputed(()=>this.settingsPanel.opened()&&!this.settingsPanel.pinned()||!this.viewer.state.navigatable());const r=a.pureComputed(()=>n.disablePageNavigation||this.isDisabled());r.subscribe(e=>{const t=document.getElementById("vivliostyle-page-number");t&&(t.disabled=e)}),this.isPageNumberDisabled=a.pureComputed(()=>r()),this.isPageSliderDisabled=a.pureComputed(()=>!(!n.disablePageSlider&&!r())||Number(this.totalPages())<=1),this.isNavigateToPreviousDisabled=a.pureComputed(()=>!!r()||void 0!==this.viewer.state.status&&this.viewer.firstPage()),this.isNavigateToNextDisabled=a.pureComputed(()=>!!r()||void 0!==this.viewer.state.status&&((!this.viewerOptions.renderAllPages()||this.viewer.state.status()==m.ReadyState.COMPLETE)&&this.viewer.lastPage())),this.isNavigateToLeftDisabled=a.pureComputed(()=>!!r()||void 0!==this.viewer.state.pageProgression&&(this.viewer.state.pageProgression()===m.PageProgression.LTR?this.isNavigateToPreviousDisabled():this.isNavigateToNextDisabled())),this.isNavigateToRightDisabled=a.pureComputed(()=>!!r()||void 0!==this.viewer.state.pageProgression&&(this.viewer.state.pageProgression()===m.PageProgression.LTR?this.isNavigateToNextDisabled():this.isNavigateToPreviousDisabled())),this.isNavigateToFirstDisabled=this.isNavigateToPreviousDisabled,this.isNavigateToLastDisabled=a.pureComputed(()=>!!r()||void 0!==this.viewer.state.status&&(!(!this.viewerOptions.renderAllPages()||this.viewer.state.status()==m.ReadyState.COMPLETE)||this.viewer.lastPage())),this.hidePageNavigation=!!n.disablePageNavigation;const o=a.pureComputed(()=>n.disableZoom||this.isDisabled());this.isZoomOutDisabled=o,this.isZoomInDisabled=o,this.isZoomToActualSizeDisabled=o,this.isToggleFitToScreenDisabled=o,this.hideZoom=!!n.disableZoom,this.fitToScreen=a.pureComputed(()=>e.zoom().fitToScreen);const s=a.pureComputed(()=>n.disableFontSizeChange||this.isDisabled()||this.viewer.state.fixedLayout());if(this.isIncreaseFontSizeDisabled=a.pureComputed(()=>!!s()||Number(this.viewerOptions.fontSize())>=72),this.isDecreaseFontSizeDisabled=a.pureComputed(()=>!!s()||Number(this.viewerOptions.fontSize())<=5),this.isDefaultFontSizeDisabled=s,this.hideFontSizeChange=!!n.disableFontSizeChange,this.isTOCToggleDisabled=a.pureComputed(()=>n.disableTOCNavigation||this.isDisabled()||null==this.viewer.tocVisible()),this.hideTOCNavigation=!!n.disableTOCNavigation,this.hidePageSlider=!!n.disablePageSlider,this.isFindBoxDisabled=a.pureComputed(()=>n.disableFind||this.isDisabled()||this.viewer.state.fixedLayout()),this.hideFind=!!n.disableFind,this.isMarkerToggleDisabled=a.pureComputed(()=>n.disableMarker||this.isDisabled()),this.hideMarker=!!n.disableMarker,this.isPrintDisabled=a.pureComputed(()=>!(!n.disablePrint&&!this.isDisabled()&&this.viewer.state.status()==m.ReadyState.COMPLETE)),this.hidePrint=!!n.disablePrint,n.disablePrint){const e=document.createElement("style");e.setAttribute("media","print"),e.textContent="*{display:none}",document.head.appendChild(e)}this.pageNumber=a.pureComputed({read(){return this.viewer.epageToPageNumber(this.viewer.epage())},write(e){const t=this.viewer.epage(),i=this.viewer.epageToPageNumber(t);let n=parseFloat(e.toString().replace(/[-]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)))||0;if(/^[-+]/.test(e.toString())&&(n=i+n),n<1)n=1;else{const e=this.viewer.epageCount();this.viewerOptions.renderAllPages()?n>e&&(n=e):n>e+1&&(n=e+1)}const r=this.viewer.epageFromPageNumber(n),o=document.getElementById("vivliostyle-page-number");o.value=n.toString(),window.history.pushState(null,null),this.viewer.navigateToEPage(r),window.setTimeout(()=>{this.viewer.state.status()!=m.ReadyState.LOADING&&this.viewer.epage()===t&&(o.value=i.toString()),document.getElementById("vivliostyle-viewer-viewport").focus()},10)},owner:this}),this.totalPages=a.pureComputed(()=>{let e=this.viewer.epageCount();if(!e)return e;const t=Number(this.pageNumber());return this.viewer.lastPage()||t>e?e=t:t==e&&e++,e}),this.pageSlider=a.pureComputed({read(){const e=Number(this.pageNumber()),t=document.getElementById("vivliostyle-page-slider");return Number(t.max)<e&&(t.max=String(e)),e},write(e){if(this.viewerOptions.renderAllPages()){const t=Number(e),i=this.viewer.epageFromPageNumber(t);this.viewer.navigateToEPage(i)}else{document.getElementById("vivliostyle-page-number").value=String(e)}},owner:this}),this.pageSliderMax=this.totalPages}updateFontSizeSettings(){this.settingsPanel.state.viewerOptions.fontSize(this.viewerOptions.fontSize()),this.viewer.documentOptions.pageStyle.baseFontSizeSpecified()&&(this.viewer.documentOptions.updateCustomStyleSheetFromCSSText(),this.viewer.loadDocument(this.viewer.documentOptions,this.viewerOptions))}}const{Keys:me}=D;class be{constructor(e,t,i,n,r){this.viewerOptions=e,this.documentOptions=t,this.viewer=i,this.close=()=>{this.opened(!1),this.pinned(!1);const e=document.getElementById("vivliostyle-viewer-viewport");e&&e.focus()},this.toggle=()=>{this.opened()?this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.close(),this.justClicked=!0,window.setTimeout(()=>{this.justClicked=!1},300)):(this.viewer.tocPinned()||this.viewer.showTOC(!1),this.opened(!0),this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.pinned(!1),this.justClicked=!0,this.focusToFirstItem(),window.setTimeout(()=>{this.justClicked=!1},300)))},this.apply=()=>{const e=this.documentOptions.pageStyle.customStyleAsUserStyle()!==this.state.pageStyle.customStyleAsUserStyle();this.documentOptions.pageStyle.copyFrom(this.state.pageStyle),e&&this.documentOptions.switchCustomStyleUserOrAuthorStyleSheets(),this.documentOptions.pageStyle.baseFontSizeSpecified()&&this.documentOptions.updateCustomStyleSheetFromCSSText(),this.viewer.loadDocument(this.documentOptions,this.state.viewerOptions),this.pinned()?this.focusToFirstItem():this.close()},this.cancel=()=>{this.state.viewerOptions.copyFrom(this.viewerOptions),this.state.pageStyle.copyFrom(this.documentOptions.pageStyle),this.close()},this.uiLanguage=a.pureComputed({read:()=>f.i18n.language,write:e=>{f.setLanguage(e),C.hasParameter("lng")&&C.setParameter("lng",e);try{window.localStorage.setItem("i18nextLng",e)}catch(e){}}}),this.isPageStyleChangeDisabled=!!r.disablePageStyleChange,this.isPageViewModeChangeDisabled=!!r.disablePageViewModeChange,this.isBookModeChangeDisabled=!!r.disableBookModeChange,this.isRenderAllPagesChangeDisabled=!!r.disableRenderAllPagesChange,this.isRestoreViewChangeDisabled=!!r.disableRestoreViewChange,this.isUILanguageChangeDisabled=!!r.disableUILanguageChange,this.justClicked=!1,this.settingsToggle=document.getElementById("vivliostyle-menu-item_settings-toggle"),this.opened=a.observable(!1),this.pinned=a.observable(!1),this.state={viewerOptions:new R(e),pageStyle:new w(t.pageStyle),pageViewMode:a.pureComputed({read:()=>this.state.viewerOptions.pageViewMode().toString(),write:e=>{this.state.viewerOptions.pageViewMode(P.of(e))}}),bookMode:a.observable(t.bookMode()),renderAllPages:a.pureComputed({read:()=>this.state.viewerOptions.renderAllPages(),write:e=>{this.state.viewerOptions.renderAllPages(e)}}),restoreView:a.observable(C.isEnabledRestoreView())},this.state.pageStyle.setViewerFontSizeObservable(this.state.viewerOptions.fontSize),this.defaultPageStyle=new w,this.defaultPageStyle.setViewerFontSizeObservable(a.observable(16)),n.visible.subscribe(e=>{e&&this.close()}),this.state.bookMode.subscribe(e=>{t.bookMode(e)}),this.state.renderAllPages.subscribe(t=>{e.renderAllPages(t)}),this.state.restoreView.subscribe(e=>{C.enableRestoreView(e),e?C.setParameter("restoreView","true"):C.removeParameter("restoreView")}),this.resetCustomStyle=a.pureComputed({read(){if(!this.state.pageStyle.equivalentTo(this.defaultPageStyle))return!1;return document.getElementsByName("vivliostyle-settings_reset-custom-style")[0].checked},write(e){e&&(this.state.pageStyle.copyFrom(this.defaultPageStyle),this.state.viewerOptions.fontSize(R.getDefaultValues().fontSize))},owner:this})}focusToFirstItem(e){const t=e||this.settingsToggle,i=["input","textarea","summary","select"].includes(t.localName)?t:Array.from(t.getElementsByTagName("input")).find(e=>!e.disabled&&("radio"!=e.type||e.checked));if(i){for(let e=i.parentElement;e&&e!=this.settingsToggle;e=e.parentElement)"details"==e.localName&&(e.open=!0);i.focus()}}handleKey(e){const t=this.opened()&&this.settingsToggle.contains(document.activeElement),i=t&&("text"==document.activeElement.type||"select"==document.activeElement.localName),n=t&&"textarea"==document.activeElement.localName,r=t&&!i&&!n;switch(e){case me.Escape:return this.opened()&&(this.cancel(),this.close()),!0;case"s":case"S":return!(!this.opened()||r||!t)||(this.toggle(),!1);case"l":case"L":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_ui-language")[0]),!1);case"p":case"P":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-and-rendering").firstElementChild),!1);case"v":case"V":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-mode")),!1);case"b":case"B":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_book-mode")[0]),!1);case"a":case"A":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_render-all-pages")[0]),!1);case"c":case"C":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_custom-style").firstElementChild),!1);case"m":case"M":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_custom-style_more").firstElementChild),!1);case"z":case"Z":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-size")),!1);case"o":case"O":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_crop-marks")),!1);case"g":case"G":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-margin")),!1);case"k":case"K":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-breaks")),!1);case"i":case"I":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_images")),!1);case"t":case"T":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_text")),!1);case"y":case"Y":return!r||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_priority")),!1);case"e":case"E":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_edit-css")[0]),!1);case"r":case"R":return!r||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_reset-custom-style")[0]),!1);case me.Enter:return!(i||r&&"vivliostyle-menu-button_apply"!==document.activeElement.id&&"vivliostyle-menu-button_cancel"!==document.activeElement.id)||(document.getElementById("vivliostyle-menu-button_apply").focus(),!1);default:return!0}}}const{Keys:ve}=D;var ye;!function(e){e.Default="",e.Searching="Searching",e.Found="Found",e.NotFound="Not Found"}(ye||(ye={}));class we{constructor(e,t){this.viewer=e,this.navigation=t,this.cancel=!1,this.intervalID=0,this.foundRange=null,this.toggle=()=>this.opened()?this.close():this.open(),this.open=()=>!this.navigation.isFindBoxDisabled()&&(this.opened(!0),window.setTimeout(()=>{document.getElementById("vivliostyle-find-box").focus()},0),!0),this.close=()=>!this.navigation.isFindBoxDisabled()&&(this.opened(!1),this.status()===ye.Searching&&(this.cancel=!0),this.status(ye.Default),this.foundRange=null,this.fixHighlight(),!0),this.findPrevious=()=>this.findSub(!0),this.findNext=()=>this.findSub(!1),this.opened=a.observable(),this.text=a.observable(""),this.status=a.observable(ye.Default),this.text.subscribe(e=>{""!=e?C.setParameter("find",x.percentEncodeAmpersandAndUnencodedPercent(e)):C.removeParameter("find")})}findSub(e){if(this.navigation.isFindBoxDisabled()||this.status()===ye.Searching)return!1;if(this.intervalID)return window.clearInterval(this.intervalID),this.intervalID=0,!0;const t=this.text();if(!t)return!1;const i=this.viewer.epage();let n=-1,r=!1;return this.status(ye.Searching),this.intervalID=window.setInterval(()=>{if(this.cancel)return this.cancel=!1,this.status(ye.Default),window.clearInterval(this.intervalID),void(this.intervalID=0);if(n===this.viewer.epage())return;n=this.viewer.epage(),(r||n!==i)&&window.getSelection().empty();if(this.findText(t,e))return this.status(ye.Found),window.clearInterval(this.intervalID),void(this.intervalID=0);!r&&(e?this.viewer.firstPage():this.viewer.lastPage())?(r=!0,this.viewer.firstPage()&&this.viewer.lastPage()?n=-1:e?this.viewer.navigateToLast():this.viewer.navigateToFirst()):!r||(e?n>i:n<i)?e?this.viewer.navigateToPrevious():this.viewer.navigateToNext():(this.status(ye.NotFound),window.clearInterval(this.intervalID),this.intervalID=0,n!==i&&this.viewer.navigateToEPage(i))},4),!0}findText(e,t){var i,n;const r=window.getSelection();"Range"!==r.type&&r.empty();const o=window,s=document.getElementById("vivliostyle-menu-find-box");s.style.visibility="hidden",this.foundRange&&0===r.rangeCount&&(r.addRange(this.foundRange),this.foundRange=null,this.fixHighlight());const a=o.find(e,!1,t);return s.style.visibility="",!!a&&((null===(n=null===(i=r.anchorNode)||void 0===i?void 0:i.parentElement)||void 0===n?void 0:n.closest("[data-adapt-eloff]"))?(this.foundRange=r.getRangeAt(0),this.fixHighlight(),!0):this.findText(e,t))}fixHighlight(){if(!/iPad|iPhone|iPod/.test(navigator.userAgent))return;const e=document.querySelectorAll("[data-viv-found-highlight='true']");for(const t of e)t.remove();if(!this.foundRange)return;const t=this.foundRange.startContainer.parentElement.closest("[data-vivliostyle-page-container='true']"),i=t.getBoundingClientRect();for(const e of this.foundRange.getClientRects()){const n=V(e,i),r=document.createElement("div");r.setAttribute("data-viv-found-highlight","true"),r.style.position="absolute",r.style.left=`${n.left}px`,r.style.top=`${n.top}px`,r.style.width=`${n.width}px`,r.style.height=`${n.height}px`,r.style.backgroundColor="#0080ff33",t.appendChild(r)}}handleKey(e,t,i){const n=t.ctrlKey||t.metaKey;switch(e){case ve.Escape:if(n||!this.opened())return!0;if(this.status()===ye.Searching)return this.cancel=!0,!1;if(i&&""!==this.text())return this.text(""),this.status(ye.Default),!1;if(this.close())return!1;break;case"Enter":if(n||!this.opened())return!0;if(i&&document.getElementById("vivliostyle-find-box").blur(),t.shiftKey?this.findPrevious():this.findNext())return!1;break;case"f":case"F":if(!n)return!0;if(this.open())return!1;break;default:this.status(ye.Default)}return!0}}class xe{constructor(e){this.list=e,this.visible=a.pureComputed(()=>e().length>0)}getDisplayMessage(e){var t,i;return null!==(i=null===(t=e.error)||void 0===t?void 0:t.toString())&&void 0!==i?i:e.messages.join("\n")}}const{Keys:Se}=D;class Ce{constructor(){var e,t;this.t=f.t,this.i18n=f.i18n;const i=[].concat(null!==(e=document.documentElement.getAttribute("data-vivliostyle-viewer-flags"))&&void 0!==e?e:[],C.getParameter("flags")).join(),n=i.includes("S"),r={disablePageStyleChange:n||i.includes("P"),disablePageViewModeChange:n||i.includes("V"),disableBookModeChange:n||i.includes("B"),disableRenderAllPagesChange:n||i.includes("A"),disableRestoreViewChange:n||i.includes("R"),disableUILanguageChange:n||i.includes("L")},o={disableTOCNavigation:i.includes("T"),disableFind:i.includes("f"),disableMarker:i.includes("m"),disablePageNavigation:i.includes("N"),disableZoom:i.includes("Z"),disableFontSizeChange:i.includes("F"),disablePageSlider:i.includes("s"),disablePrint:i.includes("p")},s=i.includes("c"),a=!i.includes("k"),l=!i.includes("a"),h=i.includes("d");if(n){const e=document.getElementById("vivliostyle-welcome");e&&e.remove();const t=document.querySelector(".vivliostyle-menu-detail"),i=document.querySelector(".vivliostyle-menu-detail-main");t&&i&&(i.style.visibility="hidden",t.style.height="auto")}s&&(document.oncontextmenu=()=>!1),this.documentOptions=new k(a),this.viewerOptions=new R(l),h&&this.viewerOptions.allowScripts(!1),this.documentOptions.pageStyle.setViewerFontSizeObservable(this.viewerOptions.fontSize),this.viewerOptions.profile()&&b.profiler.enable(),this.isDebug="true"===C.getParameter("debug")[0],this.viewerSettings={userAgentRootURL:`${C.getBaseURL()}resources/`,viewportElement:document.getElementById("vivliostyle-viewer-viewport"),debug:this.isDebug};const u=C.getParameter("src"),c=C.getParameter("b"),d=C.getParameter("x");u.length||(c.length?(C.setParameter("src",c[0]),C.hasParameter("bookMode")||C.setParameter("bookMode","true"),C.hasParameter("renderAllPages")||C.setParameter("renderAllPages","false")):d.length&&(d.forEach((e,t)=>{C.setParameter("src",e,t)}),C.hasParameter("bookMode")||C.setParameter("bookMode","false")));let p=C.getParameter("restoreView")[0];"false"!==p&&(C.hasParameter("f")||C.restoreViewSettings()&&(p=C.getParameter("restoreView")[0]),"true"===p&&C.enableRestoreView(!0)),C.removeParameter("b"),C.removeParameter("x"),C.removeParameter("f",!0),C.removeParameter("spread",!0),C.removeParameter("bookMode",!0),C.removeParameter("allowScripts",!0),C.removeParameter("renderAllPages",!0),C.removeParameter("fontSize",!0),C.removeParameter("zoom",!0),C.removeParameter("find",!0),C.removeParameter("profile",!0),C.removeParameter("debug",!0),C.removeParameter("pixelRatio",!0),C.removeParameter("restoreView",!0),C.removeParameter("lng",!0),this.viewer=new M(this.viewerSettings,this.viewerOptions),this.viewer.inputUrl.subscribe(e=>{""!=e?(C.hasParameter("src")||C.history.pushState&&C.history.pushState(null,""),e=e.startsWith("<")?"data:,"+x.percentEncodeForDataURI(e):x.percentEncodeAmpersandAndUnencodedPercent(e),C.setParameter("src",e),this.documentOptions.srcUrls(C.getParameter("src"))):C.removeParameter("src")}),this.messageDialog=new xe(F),this.settingsPanel=new be(this.viewerOptions,this.documentOptions,this.viewer,this.messageDialog,r),this.navigation=new ge(this.viewerOptions,this.viewer,this.settingsPanel,o),this.findBox=new we(this.viewer,this.navigation);const g=decodeURIComponent(null!==(t=C.getParameter("find")[0])&&void 0!==t?t:"");g&&this.findBox.text(g),this.marksStore=de,this.marksStore.init(this.viewerOptions,this.viewer),this.marksMenuStatus=de.menuStatus,this.marksBox=de.marksBox,this.viewer.rerenderTrigger.subscribe(()=>{this.marksStore.retryHighlightMarks()}),this.viewer.loadDocument(this.documentOptions),window.onhashchange=()=>{window.location.href!=C.storedUrl&&window.location.reload()}}handleKey(e,t){if(t.isComposing||t.keyCode&&("Enter"===t.key&&13!==t.keyCode&&16!==t.keyCode||"Escape"===t.key&&27!==t.keyCode))return!0;const i=D.identifyKeyFromEvent(t);if("vivliostyle-input-url"===document.activeElement.id)return"Enter"!==i||(this.viewer.loadDocument(this.documentOptions),!1);if("vivliostyle-find-box"===document.activeElement.id)return this.findBox.handleKey(i,t,!0);let n=this.findBox.handleKey(i,t,!1);return!!n&&(!(i===Se.Escape||!document.activeElement.closest("#vivliostyle-marks-box, #vivliostyle-text-selection-start-button, #vivliostyle-text-selection-edit-menu, [data-vivliostyle-page-container]"))||(!!("Home"!==i&&"End"!==i&&"p"!==i&&"P"!==i&&(t.ctrlKey||t.metaKey)||t.altKey||t.shiftKey)||(n=this.settingsPanel.handleKey(i),n&&(n=this.navigation.handleKey(i)),n)))}}const ke="ontouchstart"in window;a.bindingHandlers.menuButton={init(e,t){a.unwrap(t())&&(ke?(e.addEventListener("touchstart",()=>{a.utils.toggleDomNodeCssClass(e,"hover active",!0)}),e.addEventListener("touchend",()=>{a.utils.toggleDomNodeCssClass(e,"hover active",!1)})):(e.addEventListener("mouseover",()=>{a.utils.toggleDomNodeCssClass(e,"hover",!0)}),e.addEventListener("mousedown",()=>{a.utils.toggleDomNodeCssClass(e,"active",!0)}),e.addEventListener("mouseup",()=>{a.utils.toggleDomNodeCssClass(e,"active",!1)}),e.addEventListener("mouseout",()=>{a.utils.toggleDomNodeCssClass(e,"hover",!1),a.utils.toggleDomNodeCssClass(e,"active",!1)})))}};const Ee="ontouchstart"in window;let Pe=null,Ne=null,Te=null;a.bindingHandlers.swipePages={init(e,t){Ee&&a.unwrap(t())&&(e.addEventListener("touchstart",e=>{if(e.touches.length>1)return;if(window.visualViewport&&window.visualViewport.scale>1)return;const t=document.getElementById("vivliostyle-viewer-viewport");t&&t.scrollWidth>t.clientWidth||"Range"!==document.getSelection().type&&(Pe=e.touches[0].clientX,Ne=e.touches[0].clientY)}),e.addEventListener("touchmove",e=>{if(!(e.touches.length>1)&&"Range"!==document.getSelection().type&&null!==Pe&&null!==Ne){const t=e.touches[0].clientX-Pe,i=e.touches[0].clientY-Ne;Math.abs(t)>Math.abs(i)&&(Te=t<0?document.getElementById("vivliostyle-page-navigation-right"):document.getElementById("vivliostyle-page-navigation-left")),Math.abs(t)+Math.abs(i)>=16&&(Te&&(Te.click(),a.utils.toggleDomNodeCssClass(Te,"active",!0)),Pe=null,Ne=null)}}),e.addEventListener("touchend",()=>{Te&&a.utils.toggleDomNodeCssClass(Te,"active",!1),Te=null,Pe=null,Ne=null}))}},a.bindingHandlers.textSelection={init(e,t){const i=/iPad|iPhone|iPod/.test(navigator.userAgent);let n=!1;if(a.unwrap(t())){e.addEventListener("mousedown",()=>{n||"Range"===document.getSelection().type||(n=!0)}),document.addEventListener("mouseup",()=>{n&&(de.enabled()&&re(document.getSelection()),n=!1)});const t=document.getElementById("vivliostyle-page-navigation-left"),r=document.getElementById("vivliostyle-page-navigation-right");t&&r&&(t.onpointermove=r.onpointermove=()=>!1,t.ontouchmove=r.ontouchmove=()=>!1);let o=0;document.addEventListener("selectionchange",()=>{const e=document.getSelection();if("Range"!==e.type)return;const s=e.getRangeAt(0);if(!s.commonAncestorContainer.parentElement.closest("[data-vivliostyle-spread-container]"))return;const a=s.commonAncestorContainer.parentElement.closest("[data-vivliostyle-page-box] > div"),l=null==a?void 0:a.style.zIndex;o||(t&&r&&(i?(t.style.display="none",r.style.display="none"):(t.style.height="min-content",r.style.height="min-content")),a&&"0"===l&&(a.style.zIndex="1"),o=window.setTimeout(()=>{t&&r&&(t.style.display="",r.style.display="",t.style.height="",r.style.height=""),a&&(a.style.zIndex=l),o=0},1e3)),!n&&de.enabled()&&(pe.menuOpened()&&pe.applyEditing(),pe.startButtonOpened()&&pe.startButtonOpened(!1),re(e))})}}},a.bindingHandlers.clickOutside={init(e,t){const i=a.utils.unwrapObservable(t());document.addEventListener("mousedown",t=>{"none"!=window.getComputedStyle(e).display&&(e.contains(t.target)||e===t.target||i())})}};const Ie={en:{translation:{UI_LNG:"en",TIP_UI_Language:"Language of UI",CONFIRM_DELETE:"Do you really want to delete it?",CONFIRM_REMOVE:"Do you really want to remove it?",CONFIRM_REMOVE_ALL:"Do you really want to remove all?",Input_:"Input a document URL or HTML code",Book_Mode:"Book Mode",Render_All_Pages:"Render All Pages",Apply:"Apply",Supported_document_types_:"Supported document types:",HTML_documents_:"HTML documents, with CSS for paged media",Book_like_publications_:"Book-like publications, with Table of Contents",Web_publications_:"Web publications (a collection of HTML documents): specify URL of the first HTML or the manifest file.",Unzipped_EPUB_:"Unzipped EPUB: specify URL of OPF file or top directory of the unzipped EPUB files.",Notes_:"Notes:",GitHub_:"GitHub and Gist URLs can be directly specified. Vivliostyle loads raw github/gist content when such URL is specified.",WARN_Mixed_Content_:"Mixed Content (http: URL is specified to https: Vivliostyle Viewer) is usually blocked by browser.",WARN_Cross_Origin_:"Cross-Origin (request to different domain) is usually blocked by browser unless the server is configured to allow Cross-Origin Resource Sharing (CORS).",URL_parameter_options_:"URL parameter options:",document_URL:"document URL",default_:"(default)",for_Book_like_:"for Book-like publications",DESC_Book_Mode_:"When an HTML document URL is specified, a series of HTML documents linked from the publication manifest or Table of Contents (e.g., marked up with '<nav role=\"doc-toc\">') are automatically loaded.",for_single_HTML_:"for single HTML documents",for_Print_:"for Print (all pages printable, page count works as expected)",for_Read_:"for Read (quick loading with rough page count)",Page_Spread_View:"Page Spread View",Spread_view:"Spread view",Single_page_view:"Single page view",Auto_spread_view:"Auto spread view",additional_stylesheet_URL:"additional (custom) stylesheet URL",user_stylesheet_URL:"user stylesheet URL",Settings:"Settings",DESC_Options_also_1:"Options can also be set in the ",DESC_Options_also_2:" panel.",See_documentation_:"For more details, see documentation:",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle User Guide",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"navigate to left",navigate_to_right:"navigate to right",Highlight_:"Highlight",Marker_Yellow:"Marker: Yellow",Marker_Red:"Marker: Red",Marker_Green:"Marker: Green",OK:"OK",Cancel:"Cancel",Delete:"Delete",TIP_Settings:"Settings (S), Double click/type to pin",Page_View_Mode:"Page View Mode",Auto:"Auto",Single_page:"Single page",Spread:"Spread",TIP_Book_Mode:"On: for Book-like publications, with Table of Contents\nOff: for single HTML documents",TIP_Render_All_Pages:"On: for Print (all pages printable, page count works)\nOff: for Read (quick loading with rough page count)",Restore_View:"Restore View",TIP_Restore_View:"Restore view settings when reopening documents",Custom_Style_Settings:"Custom Style Settings",Page_Size:"Page Size",Default:"Default",DESC_page_size_default:"(=Auto unless specified elsewhere)",DESC_page_size_auto:"(use entire window area)",Preset:"Preset",Landscape:"Landscape",Custom_size:"Custom size",Width:"Width",Height:"Height",More_:"More",Crop_Marks:"Crop Marks",Crop_marks:"Crop marks",Bleed:"Bleed",Crop_offset:"Crop offset",Page_Margins:"Page Margins",DESC_page_margin_default:"(=10% unless specified elsewhere)",Set_page_margin_to_0:"Set page margin to 0",Custom_margin:"Custom margin",Top_Right_Bottom_Left:"Top/Right/Bottom/Left",Set_first_page_margin_to_0:"Set first page margin to 0",Force_html_body_margin_to_0:"Force html/body margin to 0",Page_Breaks:"Page Breaks",Default_widows_orphans_control:"Default widows/orphans control",Allow_widows_and_orphans:"Allow widows and orphans",Avoid_page_break_inside_paragraph:"Avoid page break inside paragraph",Images:"Images",Set_image_max_size_to_fit_page:"Set image max-size to fit page",Keep_aspect_ratio:"Keep aspect ratio",Text:"Text",Font_size:"Font size",Base_font_size:"Base font-size",Base_line_height:"Base line-height",Base_font_family:"Base font-family",Custom_Style_Priority:"Custom Style Priority",Set_as_user_stylesheet:"Set as user stylesheet",DESC_user_stylesheet:"(lower priority unless !important)",Force_override_document_style:"Force override document style",important_:"(!important)",Edit_CSS:"Edit CSS",Dont_edit_:"Don't edit between /*<viewer>*/ and /*</viewer>*/.",Reset_Custom_Style:"Reset Custom Style",Reset_all_to_default:"Reset all to default",TIP_ToC:"Table of Contents (T), Double click/type to pin",TIP_Marker:"Marker (M), Double click/type to pin",Marks_and_Memos:"Marks and Memos",Remove_All:"Remove All",Remove:"Remove",Memo:"Memo",TIP_Find:"Find (Ctrl/Cmd+F)",TIP_Find_Previous:"Find Previous (Shift+Enter)",TIP_Find_Next:"Find Next (Enter)",Find:"Find",TIP_First_Page:"First Page (Home)",TIP_Previous_Page:"Previous Page ()",TIP_Next_Page:"Next Page ()",TIP_Last_Page:"Last Page (End)",TIP_Go_to_Page:"Go to Page (G)",Total_pages:"Total pages",TIP_Text_Smaller:"Text: Smaller (-)",TIP_Text_Larger:"Text: Larger (+)",TIP_Text_Default_Size:"Text: Default Size (0)",TIP_Zoom_Out:"Zoom: Out (O)",TIP_Zoom_In:"Zoom: In (I)",TIP_Zoom_Actual_Size:"Zoom: Actual Size (1)",TIP_Zoom_Fit_to_Screen:"Zoom: Fit to Screen (F)",TIP_Print:"Print (P)"}},ja:{translation:{UI_LNG:"ja",TIP_UI_Language:"UI (L)",CONFIRM_DELETE:"",CONFIRM_REMOVE:"",CONFIRM_REMOVE_ALL:"",Input_:"URLHTML",Book_Mode:"Book",Render_All_Pages:"",Apply:"",Supported_document_types_:"",HTML_documents_:"HTMLCSS",Book_like_publications_:"",Web_publications_:"WebHTML: HTMLURL",Unzipped_EPUB_:"ZIPEPUB: OPFURLEPUB",Notes_:"",GitHub_:"GitHubGistURLURLVivliostyle  github/gist  raw ",WARN_Mixed_Content_:"Mixedhttp: URL https:  Vivliostyle Viewer ",WARN_Cross_Origin_:"Cross-Origin Cross-Origin Resource Sharing (CORS) ",URL_parameter_options_:"URL",document_URL:"URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL'<nav role=\"doc-toc\">' HTML",for_single_HTML_:"HTML",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:"URL",user_stylesheet_URL:"URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:"Vivliostyle",HREF_User_Guide:"../docs/#/ja/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/ja/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"OK",Cancel:"",Delete:"",TIP_Settings:" (S), ",Page_View_Mode:" (P)",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"ON: \nOFF: HTML",TIP_Render_All_Pages:"ON: \nOFF: ",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:" (C)",Page_Size:"",Default:"",DESC_page_size_default:"(=)",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:" (M)",Crop_Marks:"",Crop_marks:"Crop marks",Bleed:"Bleed",Crop_offset:"Crop offset",Page_Margins:"",DESC_page_margin_default:"(=10%)",Set_page_margin_to_0:"0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:"0",Force_html_body_margin_to_0:"html/body0",Page_Breaks:"",Default_widows_orphans_control:"widows/orphans",Allow_widows_and_orphans:"widow/orphan",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" font-size",Base_line_height:" line-height",Base_font_family:" font-family",Custom_Style_Priority:"",Set_as_user_stylesheet:"",DESC_user_stylesheet:"(!important )",Force_override_document_style:"",important_:"(!important)",Edit_CSS:"CSS (E)",Dont_edit_:"/*<viewer>*/  /*</viewer>*/ ",Reset_Custom_Style:" (R)",Reset_all_to_default:"",TIP_ToC:" (T), ",TIP_Marker:" (M), ",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:" (End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:" (-)",TIP_Text_Larger:" (+)",TIP_Text_Default_Size:" (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:" (1)",TIP_Zoom_Fit_to_Screen:" (F)",TIP_Print:" (P)"}},"zh-Hans":{translation:{UI_LNG:"zh-Hans",TIP_UI_Language:"",CONFIRM_DELETE:"?",CONFIRM_REMOVE:"?",CONFIRM_REMOVE_ALL:"?",Input_:"URLHTML",Book_Mode:"",Render_All_Pages:"",Apply:"",Supported_document_types_:":",HTML_documents_:"css HTML ",Book_like_publications_:",",Web_publications_:"Web(HTML): HTMLURL",Unzipped_EPUB_:"EPUB:OPFURLEPUB",Notes_:":",GitHub_:"GitHubGist,VivliostyleGitHub/Gist",WARN_Mixed_Content_:"(http:URLhttps:Vivliostyle Viewer)",WARN_Cross_Origin_:"(CORS)",URL_parameter_options_:"URL :",document_URL:" URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL, (,  '<nav role=\"doc-toc\">')html",for_single_HTML_:" HTML ",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:" ()  URL",user_stylesheet_URL:" URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:":",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"",Cancel:"",Delete:"",TIP_Settings:" (S),/",Page_View_Mode:"",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"On: \nOff:  HTML ",TIP_Render_All_Pages:"On: (, )\nOff:  ()",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:"",Page_Size:"",Default:"",DESC_page_size_default:"(= )",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:"...",Crop_Marks:"",Crop_marks:"",Bleed:"",Crop_offset:"",Page_Margins:"",DESC_page_margin_default:"(=10% )",Set_page_margin_to_0:" 0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:" 0",Force_html_body_margin_to_0:" html/body  0",Page_Breaks:"",Default_widows_orphans_control:" widows/orphans ",Allow_widows_and_orphans:"widows  orphans",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" ",Base_line_height:" ",Base_font_family:" ",Custom_Style_Priority:" Style ",Set_as_user_stylesheet:"",DESC_user_stylesheet:"( !important)",Force_override_document_style:"document",important_:"(!important)",Edit_CSS:" CSS",Dont_edit_:" /*<viewer>*/  /*</viewer>*/",Reset_Custom_Style:"",Reset_all_to_default:"",TIP_ToC:" (T), /",TIP_Marker:" (M), /",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:"(End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:":  (-)",TIP_Text_Larger:":  (+)",TIP_Text_Default_Size:":  (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:":  (1)",TIP_Zoom_Fit_to_Screen:":  (F)",TIP_Print:" (P)"}},"zh-Hant":{translation:{UI_LNG:"zh-Hant",TIP_UI_Language:"",CONFIRM_DELETE:"?",CONFIRM_REMOVE:"?",CONFIRM_REMOVE_ALL:"?",Input_:"URLHTML",Book_Mode:"",Render_All_Pages:"",Apply:"",Supported_document_types_:":",HTML_documents_:"css HTML ",Book_like_publications_:",",Web_publications_:"Web(HTML): HTMLURL",Unzipped_EPUB_:"EPUB:OPFURLEPUB",Notes_:":",GitHub_:"GitHubGist,VivliostyleGitHub/Gist",WARN_Mixed_Content_:"(http:URLhttps:Vivliostyle Viewer)",WARN_Cross_Origin_:"(CORS)",URL_parameter_options_:"URL :",document_URL:" URL",default_:"()",for_Book_like_:"",DESC_Book_Mode_:"HTMLURL, (,  '<nav role=\"doc-toc\">')html",for_single_HTML_:" HTML ",for_Print_:"",for_Read_:"",Page_Spread_View:"",Spread_view:"",Single_page_view:"",Auto_spread_view:"",additional_stylesheet_URL:" ()  URL",user_stylesheet_URL:" URL",Settings:"",DESC_Options_also_1:"",DESC_Options_also_2:"",See_documentation_:":",HREF_User_Guide:"../docs/#/user-guide",Vivliostyle_User_Guide:"Vivliostyle ",HREF_Vivlistyle_Home:"https://vivliostyle.org/",navigate_to_left:"",navigate_to_right:"",Highlight_:"",Marker_Yellow:": ",Marker_Red:": ",Marker_Green:": ",OK:"",Cancel:"",Delete:"",TIP_Settings:" (S),/",Page_View_Mode:"",Auto:"",Single_page:"",Spread:"",TIP_Book_Mode:"On: \nOff:  HTML ",TIP_Render_All_Pages:"On: (, )\nOff:  ()",Restore_View:"",TIP_Restore_View:"",Custom_Style_Settings:"",Page_Size:"",Default:"",DESC_page_size_default:"(= )",DESC_page_size_auto:"()",Preset:"",Landscape:"",Custom_size:"",Width:"",Height:"",More_:"...",Crop_Marks:"",Crop_marks:"",Bleed:"",Crop_offset:"",Page_Margins:"",DESC_page_margin_default:"(=10% )",Set_page_margin_to_0:" 0",Custom_margin:"",Top_Right_Bottom_Left:"///",Set_first_page_margin_to_0:" 0",Force_html_body_margin_to_0:" html/body  0",Page_Breaks:"",Default_widows_orphans_control:" widows/orphans ",Allow_widows_and_orphans:"widows  orphans",Avoid_page_break_inside_paragraph:"",Images:"",Set_image_max_size_to_fit_page:"",Keep_aspect_ratio:"",Text:"",Font_size:"",Base_font_size:" ",Base_line_height:" ",Base_font_family:" ",Custom_Style_Priority:" Style ",Set_as_user_stylesheet:"",DESC_user_stylesheet:"( !important)",Force_override_document_style:"document",important_:"(!important)",Edit_CSS:" CSS",Dont_edit_:" /*<viewer>*/  /*</viewer>*/",Reset_Custom_Style:"",Reset_all_to_default:"",TIP_ToC:" (T), /",TIP_Marker:" (M), /",Marks_and_Memos:"",Remove_All:"",Remove:"",Memo:"",TIP_Find:" (Ctrl/Cmd+F)",TIP_Find_Previous:" (Shift+Enter)",TIP_Find_Next:" (Enter)",Find:"",TIP_First_Page:" (Home)",TIP_Previous_Page:" ()",TIP_Next_Page:" ()",TIP_Last_Page:"(End)",TIP_Go_to_Page:" (G)",Total_pages:"",TIP_Text_Smaller:":  (-)",TIP_Text_Larger:":  (+)",TIP_Text_Default_Size:":  (0)",TIP_Zoom_Out:" (O)",TIP_Zoom_In:" (I)",TIP_Zoom_Actual_Size:":  (1)",TIP_Zoom_Fit_to_Screen:":  (F)",TIP_Print:" (P)"}}};f.init(Ie,function(){var e;try{let t=null===(e=/[?&#]lng=([^?&#]+)/.exec(window.location.href))||void 0===e?void 0:e[1];if(t||(t=window.localStorage.getItem("i18nextLng"),t||(t=navigator.language)),t&&(t=/^(zh(-cmn)?|cmn)-(TW|HK|Hant)\b/i.test(t)?"zh-Hant":/^(zh|cmn)\b/i.test(t)?"zh-Hans":t.toLowerCase().replace(/-.*/,""),t in Ie))return t}catch(e){}return"en"}(),a),{start(){function e(){a.applyBindings(new Ce)}window.__loaded?e():window.onload=e}}.start()});
//# sourceMappingURL=vivliostyle-viewer.js.map
